

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Gond">
  <meta name="keywords" content="">
  
    <meta name="description" content="k8s pod debugå¼€å‘è°ƒè¯•è°ƒè¯•æ—¥å¸¸å¼€å‘å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¸å…éœ€è¦é€šè¿‡è§‚å¯Ÿç¨‹åºè¡Œä¸ºæ¥æ’æŸ¥é—®é¢˜ï¼Œæ‰“æ—¥å¿—æˆ–æ‰“ç¨‹åºæ–­ç‚¹ã€‚å¯¹äºäº‘åŸç”Ÿåº”ç”¨æ¥è¯´æ‰“æ—¥å¿—éœ€è¦æ”¹ä»£ç åè·‘æµæ°´çº¿é‡æ–°æ‰“åŒ…ï¼Œæ›´æ–°æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆï¼Œæ•ˆç‡ä½ä¸‹ï¼Œå¹¶ä¸”æ˜¯é‡å¤æ€§å·¥ä½œä¸å…ä½¿äººå¿ƒçƒ¦æ°”èºï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œæä¾›äº†ä¸¤ç§åŠæ³•è¿›è¡Œè¿œç¨‹è°ƒè¯•ï¼Œå„æœ‰ä¼˜åŠ£ï¼Œè¯·å¼€å‘è€…é…Œæƒ…é€‰æ‹©åˆé€‚çš„è°ƒè¯•æ‰‹æ®µè¿›è¡Œè°ƒè¯•ã€‚    åç§° ä¼˜ç‚¹ ç¼ºç‚¹    è¿œç¨‹è°ƒè¯•è¾¹è½¦å®¹å™¨ ç®€å•æ˜“ç”¨ï¼Œæ–°å¢ä¸€ä¸ªè¾¹è½¦å®¹å™¨ï¼Œ">
<meta property="og:type" content="article">
<meta property="og:title" content="k8s pod è¿œç¨‹debugå¼€å‘">
<meta property="og:url" content="http://gondmhd.github.io/2026/01/28/go/k8s%20debug%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/index.html">
<meta property="og:site_name" content="Gond">
<meta property="og:description" content="k8s pod debugå¼€å‘è°ƒè¯•è°ƒè¯•æ—¥å¸¸å¼€å‘å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¸å…éœ€è¦é€šè¿‡è§‚å¯Ÿç¨‹åºè¡Œä¸ºæ¥æ’æŸ¥é—®é¢˜ï¼Œæ‰“æ—¥å¿—æˆ–æ‰“ç¨‹åºæ–­ç‚¹ã€‚å¯¹äºäº‘åŸç”Ÿåº”ç”¨æ¥è¯´æ‰“æ—¥å¿—éœ€è¦æ”¹ä»£ç åè·‘æµæ°´çº¿é‡æ–°æ‰“åŒ…ï¼Œæ›´æ–°æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆï¼Œæ•ˆç‡ä½ä¸‹ï¼Œå¹¶ä¸”æ˜¯é‡å¤æ€§å·¥ä½œä¸å…ä½¿äººå¿ƒçƒ¦æ°”èºï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œæä¾›äº†ä¸¤ç§åŠæ³•è¿›è¡Œè¿œç¨‹è°ƒè¯•ï¼Œå„æœ‰ä¼˜åŠ£ï¼Œè¯·å¼€å‘è€…é…Œæƒ…é€‰æ‹©åˆé€‚çš„è°ƒè¯•æ‰‹æ®µè¿›è¡Œè°ƒè¯•ã€‚    åç§° ä¼˜ç‚¹ ç¼ºç‚¹    è¿œç¨‹è°ƒè¯•è¾¹è½¦å®¹å™¨ ç®€å•æ˜“ç”¨ï¼Œæ–°å¢ä¸€ä¸ªè¾¹è½¦å®¹å™¨ï¼Œ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/debug_svc_nodeport-BPRALkhZ.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/debug_port-CuV2Pu9L-1761292607810-12.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/start_debug-CojXUUme.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/goland_remote_debug-CTR2nd1Y.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/open6443port-BjiSPj7j.png?raw=true">
<meta property="og:image" content="https://raw.githubusercontent.com/gondmhd/blogImage/refs/heads/main/img/k8s_pod%E8%B0%83%E8%AF%95/nocalhost_connect_to_cluster-CBP_YCoO.png">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/edit_nocalhost_dev_config-DHtJPh2t.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/editing_nocalhost_dev_config-CA3cCjJK.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251024102001102.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/add_nocalhost_debug_type-DlN7wOa3.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251024145226464.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251024145302177.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251027091157509.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251027091231288.png?raw=true">
<meta property="og:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251027084932318.png?raw=true">
<meta property="article:published_time" content="2026-01-28T09:05:14.121Z">
<meta property="article:modified_time" content="2026-01-28T09:05:14.122Z">
<meta property="article:author" content="Gond">
<meta property="article:tag" content="Go">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/debug_svc_nodeport-BPRALkhZ.png?raw=true">
  
  
  
  <title>k8s pod è¿œç¨‹debugå¼€å‘ - Gond</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"gondmhd.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Gond</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="k8s pod è¿œç¨‹debugå¼€å‘"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2026-01-28 17:05" pubdate>
          2026å¹´1æœˆ28æ—¥ ä¸‹åˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          12k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          103 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">k8s pod è¿œç¨‹debugå¼€å‘</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="k8s-pod-debugå¼€å‘è°ƒè¯•"><a href="#k8s-pod-debugå¼€å‘è°ƒè¯•" class="headerlink" title="k8s pod debugå¼€å‘è°ƒè¯•"></a>k8s pod debugå¼€å‘è°ƒè¯•</h1><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>æ—¥å¸¸å¼€å‘å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¸å…éœ€è¦é€šè¿‡è§‚å¯Ÿç¨‹åºè¡Œä¸ºæ¥æ’æŸ¥é—®é¢˜ï¼Œæ‰“æ—¥å¿—æˆ–æ‰“ç¨‹åºæ–­ç‚¹ã€‚å¯¹äºäº‘åŸç”Ÿåº”ç”¨æ¥è¯´æ‰“æ—¥å¿—éœ€è¦æ”¹ä»£ç åè·‘æµæ°´çº¿é‡æ–°æ‰“åŒ…ï¼Œæ›´æ–°æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆï¼Œæ•ˆç‡ä½ä¸‹ï¼Œå¹¶ä¸”æ˜¯é‡å¤æ€§å·¥ä½œä¸å…ä½¿äººå¿ƒçƒ¦æ°”èºï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œæä¾›äº†ä¸¤ç§åŠæ³•è¿›è¡Œè¿œç¨‹è°ƒè¯•ï¼Œå„æœ‰ä¼˜åŠ£ï¼Œè¯·å¼€å‘è€…é…Œæƒ…é€‰æ‹©åˆé€‚çš„è°ƒè¯•æ‰‹æ®µè¿›è¡Œè°ƒè¯•ã€‚</p>
<table>
<thead>
<tr>
<th align="left">åç§°</th>
<th align="left">ä¼˜ç‚¹</th>
<th align="left">ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è¿œç¨‹è°ƒè¯•è¾¹è½¦å®¹å™¨</td>
<td align="left">ç®€å•æ˜“ç”¨ï¼Œæ–°å¢ä¸€ä¸ªè¾¹è½¦å®¹å™¨ï¼Œä½¿ç”¨nodeportæ‰“å¼€æš´éœ²æœåŠ¡åï¼Œä½¿ç”¨ideçš„è¿œç¨‹è°ƒè¯•åŠŸèƒ½è¿ä¸Šå³å¯ä½¿ç”¨</td>
<td align="left">1. åŠŸèƒ½ç®€å•ï¼Œä»…èƒ½æ‰“æ–­ç‚¹è°ƒè¯•ï¼Œä¸èƒ½æ”¹ä»£ç  2. ä¸å¯ä»¥è°ƒè¯•åŠ å¯†é•œåƒ 3. æ¯æ¬¡æ‰“å¼€nodeportåï¼Œè¦é…ç½®é˜²ç«å¢™æ”¾é€šç«¯å£</td>
</tr>
<tr>
<td align="left">nocalhost</td>
<td align="left">å¯ä»¥ç›´æ¥åœ¨k8sé›†ç¾¤ä¸­è¿›è¡Œå¼€å‘ï¼Œæœ¬åœ°æ”¹ä»£ç å³å¯åŒæ­¥åˆ°ç¯å¢ƒä¸­ï¼Œå¼€å‘é€Ÿåº¦å¿«</td>
<td align="left">å‰ç½®éœ€è¦å‡†å¤‡çš„æ­¥éª¤å¤šï¼Œé…ç½®èµ·æ¥æ¯”è¾ƒéº»çƒ¦</td>
</tr>
</tbody></table>
<h2 id="è¿œç¨‹è°ƒè¯•å˜è½¦å®¹å™¨"><a href="#è¿œç¨‹è°ƒè¯•å˜è½¦å®¹å™¨" class="headerlink" title="è¿œç¨‹è°ƒè¯•å˜è½¦å®¹å™¨"></a>è¿œç¨‹è°ƒè¯•å˜è½¦å®¹å™¨</h2><h3 id="å¼€æ”¾nodeport"><a href="#å¼€æ”¾nodeport" class="headerlink" title="å¼€æ”¾nodeport"></a>å¼€æ”¾nodeport</h3><p>åœ¨serviceå¼€8384ç«¯å£å¯¹åº”çš„nodePortï¼ˆè¿™é‡Œä»¥31675ä¸ºç¤ºä¾‹ï¼Œå®é™…å„ä¸ç›¸åŒï¼‰</p>
<p>æ³¨ï¼šè¿™ä¸ª8384æ˜¯æœ€ç»ˆdlvç›‘å¬ä¸»è¿›ç¨‹æš´éœ²çš„ç«¯å£ï¼Œå¯ä»¥è‡ªè¡Œå®šä¹‰ï¼Œåªè¦ä¿è¯å’Œdlvç›‘å¬çš„ç«¯å£ä¸€è‡´å³å¯</p>
<p>å¦‚ï¼šå¼€appstore serviceçš„8384ç«¯å£</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl -n appstore edit svc appstore<br></code></pre></td></tr></table></figure>

<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/debug_svc_nodeport-BPRALkhZ.png?raw=true" srcset="/img/loading.gif" lazyload alt="debug_svc_nodeport-BPRALkhZ"></p>
<p>é˜²ç«å¢™å¼€æ”¾ç«¯å£</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl edit GlobalNetworkPolicy allow-external-ingress <br></code></pre></td></tr></table></figure>

<p>åœ¨ä¸‹è¿°åœ°æ–¹å¡«å…¥31675åï¼Œè¾“å…¥*:wq*ä¿å­˜é€€å‡ºå³å¯</p>
<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/debug_port-CuV2Pu9L-1761292607810-12.png?raw=true" srcset="/img/loading.gif" lazyload alt="debug_port-CuV2Pu9L"></p>
<h3 id="åŠ¨å¹¶è¿›å…¥è°ƒè¯•å®¹å™¨"><a href="#åŠ¨å¹¶è¿›å…¥è°ƒè¯•å®¹å™¨" class="headerlink" title="åŠ¨å¹¶è¿›å…¥è°ƒè¯•å®¹å™¨"></a>åŠ¨å¹¶è¿›å…¥è°ƒè¯•å®¹å™¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl debug -it -n å‘½åç©ºé—´  podå   --image-pull-policy=Always --image=docker.sangfor.com/xdr/xdr-debug:go-1.20 --target=å®¹å™¨å -- bash<br></code></pre></td></tr></table></figure>

<p>å¦‚ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl debug -it -n appstore  appstore-84ffd79559-xbgrv    --image-pull-policy=Always --image=docker.sangfor.com/xdr/xdr-debug:go-1.20 --target=appstore -- bash<br></code></pre></td></tr></table></figure>

<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/start_debug-CojXUUme.png?raw=true" srcset="/img/loading.gif" lazyload alt="start_debug-CojXUUme"></p>
<h3 id="åœ¨å®¹å™¨å†…ç›‘å¬è¿›ç¨‹"><a href="#åœ¨å®¹å™¨å†…ç›‘å¬è¿›ç¨‹" class="headerlink" title="åœ¨å®¹å™¨å†…ç›‘å¬è¿›ç¨‹"></a>åœ¨å®¹å™¨å†…ç›‘å¬è¿›ç¨‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">dlv attach è¿›ç¨‹<span class="hljs-built_in">id</span> --headless --listen  0.0.0.0:8384 --api-version=2  --accept-multiclient<br></code></pre></td></tr></table></figure>

<h3 id="Golandè¿æ¥ç›‘å¬çš„dlvè¿›ç¨‹"><a href="#Golandè¿æ¥ç›‘å¬çš„dlvè¿›ç¨‹" class="headerlink" title="Golandè¿æ¥ç›‘å¬çš„dlvè¿›ç¨‹"></a>Golandè¿æ¥ç›‘å¬çš„dlvè¿›ç¨‹</h3><p>goland è¿œç¨‹è¿æ¥k8sé›†ç¾¤ip 8384çš„nodePort</p>
<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/goland_remote_debug-CTR2nd1Y.png?raw=true" srcset="/img/loading.gif" lazyload alt="goland_remote_debug-CTR2nd1Y"></p>
<h2 id="nocalhost"><a href="#nocalhost" class="headerlink" title="nocalhost"></a>nocalhost</h2><p>é€šå¸¸æˆ‘ä»¬å°†åº”ç”¨<a target="_blank" rel="noopener" href="https://devops.xdr.sangfor.com/docs/openness/app-development-guide/versions/v3/02-scaffolding/01-flow.html#%E5%AE%89%E8%A3%85%E8%BF%90%E8%A1%8C">å®‰è£…å¹¶è¿è¡Œ</a>åœ¨ç¯å¢ƒåï¼Œå¾€å¾€ä¼šç¢°åˆ°ä¸€äº›é—®é¢˜éœ€è¦è¿›è¡Œæ’æŸ¥æˆ–è°ƒè¯•ï¼Œè¿™æ—¶æ’æŸ¥åŠæ³•å¾€å¾€æ˜¯åŸºäº æ—¥å¿—è¿›è¡Œåˆ†æã€‚å¼€å‘é˜¶æ®µå¾€å¾€éœ€è¦é¢‘ç¹çš„ä¿®æ”¹ä»£ç ï¼Œå¦‚æœæ¯æ¬¡éƒ½éœ€è¦é€šè¿‡æ—¥å¿—åšæ’æŸ¥æˆ–è°ƒè¯•ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿéœ€è¦é¢‘ç¹çš„åœ¨æµæ°´çº¿è¿›è¡Œæ‰“åŒ…ä¸Šä¼ ï¼Œåœ¨ç¯å¢ƒä¸Šæ›´æ–°é•œåƒç­‰æ“ä½œã€‚</p>
<p>è¿™äº›æ­¥éª¤ååˆ†ç¹çï¼Œå¦‚æœä½ åŒå€¦äº†è¿™æ ·çš„è°ƒè¯•æ–¹æ³•ï¼Œä¸å¦¨å¯ä»¥çœ‹çœ‹è¿™é‡Œæˆ‘ä»¬ç»™å‡ºçš„å»ºè®®ï¼Œä½¿ç”¨<a target="_blank" rel="noopener" href="https://nocalhost.dev/zh-CN/">nocalhostopen in new window</a>è¿›è¡Œå¼€å‘è°ƒè¯•ã€‚</p>
<p>nocalhost æ˜¯ä¸€æ¬¾é¢å‘äº‘åŸç”ŸæœåŠ¡çš„å¼€å‘è°ƒè¯•å·¥å…·</p>
<ul>
<li>ç›´æ¥åœ¨ Kubernetes é›†ç¾¤ä¸­æ„å»ºã€æµ‹è¯•å’Œè°ƒè¯•åº”ç”¨ç¨‹åº</li>
<li>æä¾›æ˜“äºä½¿ç”¨çš„ IDE æ’ä»¶ï¼ˆæ”¯æŒ <strong>VS Code</strong> å’Œ <strong>JetBrains</strong>ï¼‰ï¼Œå³ä½¿åœ¨ Kubernetes é›†ç¾¤ä¸­è¿›è¡Œå¼€å‘å’Œè°ƒè¯•ï¼ŒNocalhost ä¹Ÿèƒ½ä¿æŒå’Œæœ¬åœ°å¼€å‘ä¸€æ ·çš„å¼€å‘ä½“éªŒ</li>
<li>ä½¿ç”¨å³æ—¶æ–‡ä»¶åŒæ­¥è¿›è¡Œå¼€å‘ï¼š å³æ—¶å°†æ‚¨çš„ä»£ç æ›´æ”¹åŒæ­¥åˆ°è¿œç«¯å®¹å™¨ï¼Œè€Œæ— éœ€é‡å»ºé•œåƒæˆ–é‡æ–°å¯åŠ¨å®¹å™¨ã€‚</li>
</ul>
<h3 id="å®‰è£…nocalhost"><a href="#å®‰è£…nocalhost" class="headerlink" title="å®‰è£…nocalhost"></a>å®‰è£…nocalhost</h3><p>è·Ÿéšå®˜æ–¹<a target="_blank" rel="noopener" href="https://nocalhost.dev/zh-CN/docs/installation">å®‰è£…æ–‡æ¡£open in new window</a>æ¥å³å¯ï¼Œç”±äºæˆ‘ä»¬åœ¨å†…ç½‘å¼€å‘ï¼Œéœ€è¦åœ¨å¤–ç½‘ä¸‹è½½å¥½å®‰è£…åŒ…æ‹·è´åˆ°å†…ç½‘ä¸­è¿›è¡Œæ‰‹åŠ¨å®‰è£…ã€‚</p>
<p>åœ¨å®‰è£…ä¸­æŒ‡å—ä¸­è¯·é€‰æ‹©<strong>Manual Installation</strong></p>
<p>é€šè¿‡git bashå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰¾åˆ°ç”¨æˆ·çš„æ ¹ç›®å½•</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">realpath ~<br># /c/Users/User<br><br></code></pre></td></tr></table></figure>

<p>å°†nhctl.exeæ‹·è´åˆ°<code>~/.nh/bin/</code>ç›®å½•ä¸‹å³å¯</p>
<h3 id="è¿œç¨‹è°ƒè¯•"><a href="#è¿œç¨‹è°ƒè¯•" class="headerlink" title="è¿œç¨‹è°ƒè¯•"></a>è¿œç¨‹è°ƒè¯•</h3><p>ç”±äºåœ¨å†…ç½‘ï¼Œå®˜æ–¹çš„é•œåƒéƒ½åœ¨å¤–ç½‘ä»–ä»¬è‡ªå·±çš„é•œåƒç«™é‡Œï¼Œä¸€èˆ¬å¾ˆéš¾æ‹‰å–åˆ°ï¼Œæ‰€ä»¥é€šè¿‡å®˜æ–¹æ–‡æ¡£æ˜¯æ— æ³•ç›´æ¥è¿è¡Œçš„ï¼Œæˆ‘ä»¬éœ€è¦æ”¹åŠ¨ä¸€äº›åœ°æ–¹æ‰å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>è¿™é‡Œç”¨Golandæ¼”ç¤ºï¼ŒVSCodeå¯ä¸¾ä¸€åä¸‰</p>
<h3 id="æ”¾é€š6443ç«¯å£"><a href="#æ”¾é€š6443ç«¯å£" class="headerlink" title="æ”¾é€š6443ç«¯å£"></a>æ”¾é€š6443ç«¯å£</h3><p>è¿›å…¥ç¯å¢ƒï¼Œè¾“å…¥</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl edit GlobalNetworkPolicy allow-external-ingress <br></code></pre></td></tr></table></figure>

<p>åœ¨ä¸‹è¿°åœ°æ–¹å¡«å…¥6443åï¼Œè¾“å…¥*:wq*ä¿å­˜é€€å‡ºå³å¯</p>
<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/open6443port-BjiSPj7j.png?raw=true" srcset="/img/loading.gif" lazyload alt="open6443port-BjiSPj7j"></p>
<h3 id="é…ç½®åŸŸå"><a href="#é…ç½®åŸŸå" class="headerlink" title="é…ç½®åŸŸå"></a>é…ç½®åŸŸå</h3><p>ä¿®æ”¹æœ¬åœ°ä½äº<em>C:\Windows\System32\drivers\etc</em>çš„<em>hosts</em>æ–‡ä»¶ï¼Œæ·»åŠ </p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">10.65.196.221 k8s.server.sr<br></code></pre></td></tr></table></figure>

<p>10.65.196.221 æ”¹ä¸ºä½ ä½¿ç”¨çš„æœºå™¨çš„IPåœ°å€å†å¡«å…¥</p>
<blockquote>
<p>ğŸ’¡æç¤º</p>
<p>hostsæ–‡ä»¶ä¸èƒ½åŸåœ°ä¿®æ”¹ï¼Œéœ€è¦å…ˆæ‹·è´å‡ºæ¥ï¼Œæ”¹å¥½åå†è¦†ç›–å›å»</p>
</blockquote>
<h3 id="æ·»åŠ ç¯å¢ƒ"><a href="#æ·»åŠ ç¯å¢ƒ" class="headerlink" title="æ·»åŠ ç¯å¢ƒ"></a>æ·»åŠ ç¯å¢ƒ</h3><p>ç‚¹å‡» <em>Connect to Cluster</em> æŒ‰é’®åï¼Œé€‰æ‹© <em>Paste as Text</em></p>
<p><img src="https://raw.githubusercontent.com/gondmhd/blogImage/refs/heads/main/img/k8s_pod%E8%B0%83%E8%AF%95/nocalhost_connect_to_cluster-CBP_YCoO.png" srcset="/img/loading.gif" lazyload alt="open6443port-BjiSPj7j"></p>
<p>åœ¨k8sç¯å¢ƒä¸­è¾“å…¥</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> ~/.kube/config<br></code></pre></td></tr></table></figure>

<p>è·å¾—è¾“å‡º ,å°†è¾“å‡ºè´´åˆ°<code>aste as Text</code>å¯¹è¯æ¡†ä¸­</p>
<p>å®Œæˆåå³å¯åœ¨å³è¾¹çœ‹åˆ°æ–°åŠ çš„é›†ç¾¤ï¼Œå±•å¼€åå¯ä»¥åˆ—å‡ºæ‰€æœ‰å‘½åç©ºé—´</p>
<h4 id="ä¿®æ”¹nocalhosté…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹nocalhosté…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹nocalhosté…ç½®æ–‡ä»¶"></a>ä¿®æ”¹nocalhosté…ç½®æ–‡ä»¶</h4><p>åœ¨å³è¾¹æ‰¾åˆ°éœ€è¦è¿œç¨‹è°ƒè¯•çš„æœåŠ¡ï¼Œå³é”®ç‚¹å‡»<em>Dev Config</em>å¼¹å‡ºæ–‡ä»¶</p>
<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/edit_nocalhost_dev_config-DHtJPh2t.png?raw=true" srcset="/img/loading.gif" lazyload alt="edit_nocalhost_dev_config-DHtJPh2t"></p>
<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/editing_nocalhost_dev_config-CA3cCjJK.png?raw=true" srcset="/img/loading.gif" lazyload alt="editing_nocalhost_dev_config-CA3cCjJK"></p>
<p>å¡«å……ä¸‹åˆ—å†…å®¹ï¼Œæ³¨æ„app-goéœ€è¦æ›¿æ¢æˆä½ æœåŠ¡çš„deploymentçš„åå­—ï¼Œcontainersé‡Œçš„nameä¹Ÿè¦æ›¿æ¢æˆå¯¹åº”å®¹å™¨çš„åå­—ï¼Œé™¤éä¸€ä¸ªpodè·‘äº†å¥½å‡ ä¸ªå®¹å™¨ï¼Œ ä¸ç„¶ä¸€èˆ¬æƒ…å†µä¸‹podåè·Ÿå®¹å™¨åæ˜¯ä¸€æ ·çš„ </p>
<blockquote>
<p>ä¸‹è¿°ä¿®æ”¹é…ç½®å±äºå†…ç½‘é…ç½®ç›¸å…³ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œé€šè¿‡deployment å³é”®start devmode ç­‰å¾…ä¸‹æ–¹è¿æ¥åˆ°podå†…éƒ¨å³å¯ ä½¿ç”¨start devMode(é»˜è®¤æ¨¡å¼) åŸæœ¬è¿è¡Œçš„podä¼šåœæ­¢ï¼Œåœ¨end devModeä¹‹åä¼šæ¢å¤åˆå§‹çš„podç›¸å…³é…ç½®ï¼Œä½¿ç”¨Duplicate æ¨¡å¼åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å‰¯æœ¬</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">app-go</span><br><span class="hljs-attr">serviceType:</span> <span class="hljs-string">deployment</span><br><span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">chongqingshuiliju-uploadlog</span><br>      <span class="hljs-attr">dev:</span><br>      <span class="hljs-comment"># å…¶ä»–å·²æœ‰é…ç½®...</span><br>      <span class="hljs-attr">securityContext:</span><br>        <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">0</span>  <span class="hljs-comment"># ä»¥ root ç”¨æˆ·è¿è¡Œï¼ˆä¸´æ—¶è°ƒè¯•ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼‰</span><br>        <span class="hljs-attr">allowPrivilegeEscalation:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># å…è®¸æƒé™æå‡</span><br>        <span class="hljs-attr">capabilities:</span><br>          <span class="hljs-attr">add:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">SYS_PTRACE</span>  <span class="hljs-comment"># æ·»åŠ  ptrace èƒ½åŠ›ï¼Œç”¨äºè°ƒè¯•è·Ÿè¸ªè¿›ç¨‹</span><br>        <span class="hljs-attr">readOnlyRootFilesystem:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># ç¡®ä¿æ ¹æ–‡ä»¶ç³»ç»Ÿå¯å†™ï¼ˆå…è®¸ç”Ÿæˆè°ƒè¯•äºŒè¿›åˆ¶ï¼‰ </span><br>      <span class="hljs-attr">gitUrl:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">docker.sangfor.com/cicd_2729/centos8-compiler:latest</span><br>      <span class="hljs-attr">shell:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">workDir:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">storageClass:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">resources:</span><br>        <span class="hljs-attr">limits:</span><br>          <span class="hljs-attr">memory:</span> <span class="hljs-string">4Gi</span><br>          <span class="hljs-attr">cpu:</span> <span class="hljs-string">&quot;2&quot;</span><br>        <span class="hljs-attr">requests:</span><br>          <span class="hljs-attr">memory:</span> <span class="hljs-string">2Gi</span><br>          <span class="hljs-attr">cpu:</span> <span class="hljs-string">&quot;1&quot;</span><br>      <span class="hljs-attr">persistentVolumeDirs:</span> []<br>      <span class="hljs-attr">command:</span><br>        <span class="hljs-attr">debug:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">./run.sh</span><br>      <span class="hljs-attr">debug:</span><br>        <span class="hljs-attr">remoteDebugPort:</span> <span class="hljs-number">5005</span><br>      <span class="hljs-attr">hotReload:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">sync:</span> <span class="hljs-literal">null</span><br>      <span class="hljs-attr">env:</span> []<br>      <span class="hljs-attr">portForward:</span> []<br>      <span class="hljs-attr">sidecarImage:</span> <span class="hljs-string">hub.ngsoc.site/nocalhost/nocalhost-sidecar:sshversion</span><br><br></code></pre></td></tr></table></figure>

<p><strong><code>image</code><strong>ï¼šå®šä¹‰äº†</strong>å¼€å‘å®¹å™¨çš„é•œåƒ</strong>ã€‚å½“ä½ è¿›å…¥<code>DevMode</code>æ—¶ï¼ŒåŸå§‹çš„ä¸šåŠ¡å®¹å™¨ä¼šè¢«è¿™ä¸ªé•œåƒæ›¿æ¢ã€‚è¿™ä¸ªé•œåƒåº”è¯¥åŒ…å«ä½ å¼€å‘æ‰€éœ€çš„å…¨å¥—ç¯å¢ƒï¼Œä¾‹å¦‚Goè¯­è¨€ç¼–è¯‘å™¨ã€è°ƒè¯•å™¨ã€å¿…è¦çš„ç³»ç»Ÿåº“ç­‰ã€‚ä½¿ç”¨ä¸€ä¸ªè¶³å¤Ÿå®Œå¤‡çš„é•œåƒå¯¹äºé¡ºåˆ©å¼€å‘è‡³å…³é‡è¦ã€‚</p>
<p><strong><code>sidecarImage:</code><strong>Nocalhosté€šè¿‡åœ¨ä¸šåŠ¡Podä¸­æ³¨å…¥ä¸€ä¸ª<code>sidecar</code>å®¹å™¨æ¥</strong>å®ç°æ–‡ä»¶åŒæ­¥ã€ç«¯å£è½¬å‘ç­‰åŠŸèƒ½</strong>ã€‚è¿™ä¸ªé…ç½®æŒ‡å®šäº†æ‰€ä½¿ç”¨çš„sidecaré•œåƒã€‚é€šå¸¸ä½¿ç”¨é»˜è®¤å³å¯ï¼Œé™¤éæœ‰ç‰¹æ®Šè¦æ±‚æˆ–å†…éƒ¨registryå®šåˆ¶ã€‚</p>
<p>æ­¤å¤„å› ä¸ºæ˜¯å†…ç½‘ç¯å¢ƒï¼Œéœ€è¦åœ¨å¤–ç½‘ç¯å¢ƒpullé•œåƒ <code>hub.ngsoc.site/nocalhost/nocalhost-sidecar:sshversion</code> ä¸Šä¼ åˆ°å†…ç½‘ï¼Œä¿®æ”¹é•œåƒåç§°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull nocalhost-docker.pkg.coding.net/nocalhost/public/nocalhost-sidecar:sshversion			<span class="hljs-comment"># pull é•œåƒ</span><br>docker save -o sidecar.tar nocalhost-docker.pkg.coding.net/nocalhost/public/nocalhost-sidecar:sshversion	<span class="hljs-comment"># å¯¼å‡ºé•œåƒ</span><br>docker load -i sidecar.tar			<span class="hljs-comment"># å¯¼å…¥é•œåƒ</span><br>docker tag nocalhost-docker.pkg.coding.net/nocalhost/public/nocalhost-sidecar:sshversion hub.ngsoc.site/nocalhost/nocalhost-sidecar:sshversion		<span class="hljs-comment">#ä¿®æ”¹é•œåƒåç§°</span><br></code></pre></td></tr></table></figure>



<h4 id="è°ƒè¯•é…ç½®ä¸çƒ­åŠ è½½"><a href="#è°ƒè¯•é…ç½®ä¸çƒ­åŠ è½½" class="headerlink" title="è°ƒè¯•é…ç½®ä¸çƒ­åŠ è½½"></a>è°ƒè¯•é…ç½®ä¸çƒ­åŠ è½½</h4><ul>
<li><p><strong><code>command.debug: [&quot;./run.sh&quot;]</code></strong> ä¸ <strong><code>debug.remoteDebugPort: 5005</code></strong><br>è¿™æ˜¯ä½ é…ç½®ä¸­çš„<strong>ä¸€é”®Debugå‘½ä»¤</strong>ã€‚</p>
<ul>
<li><p>å½“ä½ é€‰æ‹©<code>Remote Debug</code>æ—¶ï¼ŒNocalhostä¼šåœ¨å¼€å‘å®¹å™¨ä¸­æ‰§è¡Œ<code>command.debug</code>å®šä¹‰çš„å‘½ä»¤ã€‚</p>
</li>
<li><p><code>remoteDebugPort: 5005</code><strong>å¿…é¡»</strong>ä¸ä½ è°ƒè¯•å‘½ä»¤ä¸­ç¨‹åºç›‘å¬çš„ç«¯å£ä¸€è‡´ã€‚å¯¹äºGoåº”ç”¨ï¼ˆä½¿ç”¨Delveï¼‰ï¼Œä½ çš„<code>run.sh</code>è„šæœ¬å¯èƒ½éœ€è¦è¿™æ ·å¯åŠ¨è°ƒè¯•å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åœ¨run.shä¸­ï¼Œè®©Delveåœ¨5005ç«¯å£ç›‘å¬</span><br>dlv debug --headless --listen=:5005 --api-version=2 --accept-multiclient ./your-main-go-file.go<br></code></pre></td></tr></table></figure>


</li>
<li><p>åœ¨æœ¬åœ°IDEä¸­é…ç½®å¥½è¿œç¨‹è°ƒè¯•ï¼ˆè¿æ¥åˆ°å®¹å™¨çš„5005ç«¯å£ï¼‰ï¼Œå³å¯è¿›è¡Œæ–­ç‚¹è°ƒè¯•ã€‚</p>
</li>
</ul>
</li>
<li><p><strong><code>hotReload: false</code></strong></p>
<ul>
<li>å½“è®¾ç½®ä¸º<code>false</code>æ—¶ï¼Œä½ ä¿®æ”¹ä»£ç åï¼Œé€šå¸¸éœ€è¦<strong>æ‰‹åŠ¨é‡å¯</strong>åº”ç”¨è¿›ç¨‹æ‰èƒ½ç”Ÿæ•ˆã€‚</li>
<li>å¦‚æœè®¾ç½®ä¸º<code>true</code>ï¼ŒNocalhostä¼šåœ¨ä»£ç åŒæ­¥åï¼Œè‡ªåŠ¨é‡å¯<code>command.run</code>æˆ–<code>command.debug</code>ä¸­å®šä¹‰çš„å‘½ä»¤ã€‚å¯¹äºGoè¿™ç±»ç¼–è¯‘å‹è¯­è¨€ï¼Œè‡ªåŠ¨é‡å¯å¯èƒ½ä»éœ€è¦ç¼–è¯‘æ—¶é—´ï¼Œä½†å¯ä»¥çœå»æ‰‹åŠ¨æ“ä½œã€‚</li>
</ul>
</li>
</ul>
<h4 id="æ–‡ä»¶åŒæ­¥ã€ç¯å¢ƒå˜é‡ä¸ç«¯å£è½¬å‘"><a href="#æ–‡ä»¶åŒæ­¥ã€ç¯å¢ƒå˜é‡ä¸ç«¯å£è½¬å‘" class="headerlink" title="æ–‡ä»¶åŒæ­¥ã€ç¯å¢ƒå˜é‡ä¸ç«¯å£è½¬å‘"></a>æ–‡ä»¶åŒæ­¥ã€ç¯å¢ƒå˜é‡ä¸ç«¯å£è½¬å‘</h4><p><strong><code>sync: null</code></strong></p>
<p>æ–‡ä»¶åŒæ­¥é…ç½®ä¸ºç©ºï¼Œæ„å‘³ç€<strong>æœ¬åœ°ä»£ç ä¿®æ”¹ä¸ä¼šè‡ªåŠ¨åŒæ­¥åˆ°è¿œç«¯å¼€å‘å®¹å™¨</strong>ã€‚ä½ é€šå¸¸éœ€è¦é…ç½®å®ƒæ¥å®ç°å®æ—¶å¼€å‘</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sync:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">&quot;send&quot;</span> <span class="hljs-comment"># ä¸€èˆ¬è®¾ç½®sendå°±è¡Œ:cite[2]</span><br>  <span class="hljs-attr">mode:</span> <span class="hljs-string">&quot;pattern&quot;</span> <span class="hljs-comment"># æˆ– &quot;gitIgnore&quot;:cite[1]:cite[2]</span><br>  <span class="hljs-attr">filePattern:</span> <span class="hljs-comment"># å¦‚æœmodeä¸ºpatternï¼ŒæŒ‡å®šéœ€è¦åŒæ­¥çš„æ–‡ä»¶</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;**/*.go&quot;</span><br>  <span class="hljs-attr">ignoreFilePattern:</span> <span class="hljs-comment"># æŒ‡å®šå¿½ç•¥åŒæ­¥çš„æ–‡ä»¶</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;.git&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;bin/**&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>ä½¿ç”¨<code>mode: gitIgnore</code>å¯ä»¥åŸºäºé¡¹ç›®çš„<code>.gitignore</code>æ–‡ä»¶æ¥å†³å®šåŒæ­¥å“ªäº›æ–‡ä»¶ã€‚</p>
</li>
<li><p><strong><code>env: []</code></strong> ä¸ <strong><code>portForward: []</code></strong></p>
<ul>
<li><p><code>env</code>: å¯ä»¥åœ¨è¿™é‡Œä¸ºå¼€å‘å®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚<code>GOPROXY</code>ç­‰ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">env:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">GOPROXY</span><br>    <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;https://goproxy.cn,direct&quot;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p><code>portForward</code>: é…ç½®ç«¯å£è½¬å‘éå¸¸æœ‰ç”¨ï¼Œå®ƒå¯ä»¥å°†å¼€å‘å®¹å™¨å†…çš„ç«¯å£æ˜ å°„åˆ°æœ¬åœ°ï¼Œæ–¹ä¾¿ä½ ç›´æ¥é€šè¿‡æœ¬åœ°åœ°å€è®¿é—®å®¹å™¨å†…çš„æœåŠ¡</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">portForward:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">8080</span><span class="hljs-string">:8080</span>   <span class="hljs-comment"># å°†å®¹å™¨å†…8080ç«¯å£æ˜ å°„åˆ°æœ¬åœ°8080</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">3306</span><span class="hljs-string">:3306</span>   <span class="hljs-comment"># å¦‚æœéœ€è¦è¿æ¥å®¹å™¨å†…çš„æ•°æ®åº“</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251024102001102.png?raw=true" srcset="/img/loading.gif" lazyload alt="image-20251024102001102"></p>
<p>æœ¬åœ°å·¥ç¨‹æ ¹ç›®å½•åˆ›å»º<font color="Tomato" id="dst_run">run.sh</font>è„šæœ¬ï¼Œå¡«å…¥ä¸‹è¿°ä»£ç åï¼Œæ·»åŠ nocalhost-goç±»å‹ï¼Œç‚¹å‡»<em>Debug</em>æŒ‰é’®å³å¯è¿›è¡Œè¿œç¨‹è°ƒè¯•</p>
<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/add_nocalhost_debug_type-DlN7wOa3.png?raw=true" srcset="/img/loading.gif" lazyload alt="add_nocalhost_debug_type-DlN7wOa3"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#! /usr/bin/bash</span><br><br>use_go_version.sh 1.20<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;10.223.0.2 hub.ngsoc.site&quot;</span> &gt;&gt; /etc/hosts<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;200.200.24.5 code.sangfor.org&quot;</span> &gt;&gt; /etc/hosts<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;200.200.1.241 mirrors.sangfor.org&quot;</span> &gt;&gt; /etc/hosts<br>git config --global url.http://oauth2:uykygo4rfhYC8brmiyzs@code.sangfor.org/.insteadOf https://code.sangfor.org/<br>go install github.com/go-delve/delve/cmd/dlv@latest<br><br>dlv --headless --<span class="hljs-built_in">log</span> --listen :5005 --api-version 2 --accept-multiclient debug \<br>    app-go/app-go.go -- -f /app/config/config.yaml -s /etc/xdr/app/secrets.yaml<br><br></code></pre></td></tr></table></figure>



<h3 id="å†…ç½‘å¼€å‘é…ç½®ï¼š"><a href="#å†…ç½‘å¼€å‘é…ç½®ï¼š" class="headerlink" title="å†…ç½‘å¼€å‘é…ç½®ï¼š"></a>å†…ç½‘å¼€å‘é…ç½®ï¼š</h3><p>æ­¤å¤„æƒ…å†µï¼Œæ— æ³•é…ç½®pod ä»£ç†åˆ°å†…éƒ¨çš„ä¾èµ–å¹³å°ï¼Œé‡‡ç”¨ kubectl cp å‘½ä»¤æˆ–è€…åŒæ­¥é¡¹ç›®ä¾èµ–ä¾èµ–åˆ°podä¸­ä½¿ç”¨</p>
<blockquote>
<p>å¦‚é‡åˆ° kubectlæ— æ³• cp ä½¿ç”¨cat è¿›è¡Œå¤åˆ¶</p>
<p>åŸå› ï¼šæ ¸å¿ƒé—®é¢˜æ˜¯<strong>å®¹å™¨å†…ç¼ºå°‘ <code>tar</code> å·¥å…·</strong>ï¼ˆ<code>kubectl cp</code> åº•å±‚ä¾èµ– <code>tar</code>ï¼‰ï¼Œå†…ç½‘æ— æ³•å®‰è£…tar</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯ä½¿ç”¨ kubectl exec + ç®¡é“ + cat å®ç°æ–‡ä»¶æ‹·è´ï¼Œå®Œå…¨ä¸ä¾èµ–å®¹å™¨å†…ä»»ä½•å·¥å…·ï¼Œæ˜¯æ‹·è´æ–‡ä»¶çš„ã€Œä¸‡èƒ½æ–¹æ¡ˆã€</span><br><span class="hljs-comment"># æ ¼å¼ï¼šcat æœ¬åœ°æ–‡ä»¶ | kubectl exec -i -n å‘½åç©ºé—´ PODåç§° -- sh -c &quot;cat &gt; å®¹å™¨å†…ç›®æ ‡è·¯å¾„/æ–‡ä»¶å&quot;</span><br><span class="hljs-built_in">cat</span> ./dlv | kubectl <span class="hljs-built_in">exec</span> -i -n appstore-official kabffapi-5747f6b996-8g5pm -- sh -c <span class="hljs-string">&quot;cat &gt; /usr/local/bin/dlv&quot;</span><br><br><span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨å†…ç›®æ ‡è·¯å¾„çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span><br>kubectl <span class="hljs-built_in">exec</span> -n appstore-official kabffapi-5747f6b996-8g5pm -- <span class="hljs-built_in">ls</span> -l /usr/local/bin/dlv<br><br><span class="hljs-comment"># ï¼ˆå¯é€‰ï¼‰ç»™ dlv æ·»åŠ æ‰§è¡Œæƒé™ï¼ˆæ‹·è´åå¯èƒ½ç¼ºå°‘æ‰§è¡Œæƒé™ï¼Œæ–¹ä¾¿åç»­è°ƒè¯•ï¼‰</span><br>kubectl <span class="hljs-built_in">exec</span> -n appstore-official kabffapi-5747f6b996-8g5pm -- <span class="hljs-built_in">chmod</span> +x /usr/local/bin/dlv<br></code></pre></td></tr></table></figure>

<p><strong>å‘½ä»¤æ‹†è§£ï¼ˆç†è§£ä¸‡èƒ½æ‹·è´çš„åŸç†ï¼‰</strong></p>
<ol>
<li><code>cat ./dlv</code>ï¼šæœ¬åœ°è¯»å– <code>dlv</code> æ–‡ä»¶çš„å†…å®¹ï¼Œè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆç®¡é“ï¼‰ï¼›</li>
<li><code>|</code>ï¼šç®¡é“ç¬¦ï¼Œå°†æœ¬åœ° <code>cat</code> è¾“å‡ºçš„æ–‡ä»¶å†…å®¹ä¼ é€’ç»™åç»­çš„ <code>kubectl exec</code> å‘½ä»¤ï¼›</li>
<li><code>kubectl exec -i</code>ï¼š<code>-i</code> è¡¨ç¤ºã€Œäº¤äº’å¼ä¿æŒæ ‡å‡†è¾“å…¥ã€ï¼Œæ¥æ”¶ç®¡é“ä¼ é€’çš„æ–‡ä»¶å†…å®¹ï¼›</li>
<li><code>sh -c &quot;cat &gt; /usr/local/bin/dlv&quot;</code>ï¼šå®¹å™¨å†…æ‰§è¡Œå‘½ä»¤ï¼Œå°†æ¥æ”¶çš„æ ‡å‡†è¾“å…¥å†…å®¹å†™å…¥ <code>/usr/local/bin/dlv</code> æ–‡ä»¶ï¼Œå®Œæˆæ‹·è´ã€‚</li>
</ol>
<p>ç¯å¢ƒï¼š</p>
<ul>
<li>å¼€å‘ï¼šdlv+gosdk+go.modç›¸å…³ä¾èµ–</li>
<li>debugï¼šdlv+ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯</li>
</ul>
<h4 id="degugç¯å¢ƒå‡†å¤‡"><a href="#degugç¯å¢ƒå‡†å¤‡" class="headerlink" title="degugç¯å¢ƒå‡†å¤‡"></a>degugç¯å¢ƒå‡†å¤‡</h4><p>1ã€å…‹éš† <a target="_blank" rel="noopener" href="https://github.com/go-delve/delve">dlvé¡¹ç›®</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/DisMisPres/article/details/128866995">dlvå‘½ä»¤è¯´æ˜</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> delve<br><span class="hljs-comment"># ç¼–è¯‘dlv</span><br>go build -o dlv github.com/go-delve/delve/cmd/dlv<br><br><span class="hljs-comment"># window å®‰è£…dlv1.20</span><br>GOOS=linux GOARCH=amd6 GO111MODULE=on go install github.com/go-delve/delve/cmd/dlv@v1.20.0<br><span class="hljs-comment"># 1ã€windowä¸‹é€šè¿‡git bashçª—å£æ‰“å¼€ï¼ŒæŸ¥çœ‹å®‰è£…è·¯å¾„(æœªæ˜æ˜¾è®¾ç½®ï¼Œä¸€èˆ¬æ˜¯è¿™ä¸ªè·¯å¾„)</span><br>$ go <span class="hljs-built_in">env</span> GOPATH<br>C:\Users\User\go<br><br><br><span class="hljs-comment">#  2ã€æ‰¾åˆ°å¯¹åº”çš„è·¯å¾„ï¼ŒæŸ¥çœ‹æ–‡ä»¶</span><br>$ <span class="hljs-built_in">ls</span> /c/Users/User/go/bin/<br>dlv.exe*  linux_amd64/  linux_arm64/<br></code></pre></td></tr></table></figure>

<p>2ã€é…ç½®dlvæ‰§è¡Œç¯å¢ƒ(å¯ä»¥æ‰‹åŠ¨cpåˆ°å®¹å™¨å†…éƒ¨æˆ–è€…cp)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> dlv /usr/local/bin/<br><span class="hljs-built_in">chmod</span> +x /usr/local/bin/dlv<br></code></pre></td></tr></table></figure>

<p>3ã€ä¸Šè¿°çš„<a href="#dst_run">run.sh</a>å‘½ä»¤ä¿®æ”¹ä¸‹</p>
<p>æ‰§è¡Œgoæ–‡ä»¶éœ€è¦ gosdk</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#! /usr/bin/bash</span><br><br><span class="hljs-comment"># ä¸ä½¿ç”¨vendor ç¦»çº¿ä¾èµ–</span><br>dlv --headless --<span class="hljs-built_in">log</span> --listen :5005 --api-version 2 --accept-multiclient debug \<br>    ./app-go.go -- -f /app/config/config.yaml -s /etc/xdr/app/secrets.yaml<br><br></code></pre></td></tr></table></figure>

<p>åœ¨æ²¡æœ‰go sdk  podé‡Œé¢æ‰§è¡Œ åˆ™éœ€è¦æå‰æ„å»ºåˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼ŒåŒæ­¥åˆ°podé‡Œé¢</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># é™æ€æ„å»º</span><br>CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build  -gcflags=<span class="hljs-string">&quot;all=-N -l&quot;</span> -ldflags=<span class="hljs-string">&quot;-s -w&quot;</span> -o app-go app-go.go<br><span class="hljs-comment"># goland é‡Œé¢å¦‚æœæ‰§è¡Œä¸äº† æ£€æŸ¥ç›¸å…³ç¯å¢ƒå˜é‡ ä½¿ç”¨ä¸‹è¿°å‘½ä»¤è®¾ç½® æ‰§è¡Œ</span><br>go <span class="hljs-built_in">env</span> -w GOOS=windows  <span class="hljs-comment"># è®¾ç½®go env å‘½ä»¤</span><br>...<br><br>go build  -gcflags=<span class="hljs-string">&quot;all=-N -l&quot;</span> -ldflags=<span class="hljs-string">&quot;-s -w&quot;</span> -o app-go app-go.go<br><br><br><br>./dlv --headless --<span class="hljs-built_in">log</span> --listen :5005 --api-version 2 --accept-multiclient debug \<br>   ./app-go -- -f /app/config/config.yaml -s /etc/xdr/app/secrets.yaml<br></code></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>CGO_ENABLED=0</code>ï¼š<strong>å…³é”®è®¾ç½®</strong>ï¼Œç¦æ­¢ä½¿ç”¨CGOï¼Œç¡®ä¿ç”Ÿæˆ<strong>çº¯é™æ€</strong>äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸ä¾èµ–glibcç­‰å¤–éƒ¨Cåº“ã€‚</li>
<li><code>GOOS=linux</code> å’Œ <code>GOARCH=amd64</code>ï¼šæŒ‡å®šç›®æ ‡ä¸ºLinux 64ä½ç³»ç»Ÿã€‚</li>
<li><code>-gcflags=&quot;all=-N -l&quot;</code>ï¼š<strong>å…³é”®è®¾ç½®</strong>ï¼Œç¦æ­¢ç¼–è¯‘å™¨çš„å†…è”å’Œä¼˜åŒ–ï¼Œè¿™æ˜¯<strong>ä¿ç•™è°ƒè¯•ä¿¡æ¯</strong>æ‰€å¿…éœ€çš„ã€‚</li>
<li><code>-ldflags=&quot;-s -w&quot;</code>ï¼šå¯é€‰ï¼Œç”¨äºå‡å°äºŒè¿›åˆ¶æ–‡ä»¶ä½“ç§¯ï¼ˆä¼šå»é™¤ç¬¦å·è¡¨å’ŒDWARFè°ƒè¯•ä¿¡æ¯ï¼Œ<strong>ä½†ä¸Šé¢<code>-gcflags</code>å·²ä¿ç•™å¿…è¦è°ƒè¯•ä¿¡æ¯</strong>ï¼‰</li>
</ul>
<h4 id="å¼€å‘ç¯å¢ƒå‡†å¤‡ï¼š"><a href="#å¼€å‘ç¯å¢ƒå‡†å¤‡ï¼š" class="headerlink" title="å¼€å‘ç¯å¢ƒå‡†å¤‡ï¼š"></a>å¼€å‘ç¯å¢ƒå‡†å¤‡ï¼š</h4><blockquote>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸Šè¿°ä¸¤ç§æ–¹æ¡ˆ debugå¿«é€Ÿå¼€å‘è°ƒè¯•ï¼Œæ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯éƒ¨åˆ†å®¹å™¨æˆ–è€…podæ— æ³•èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œåˆ™é‡‡ç”¨ä¸‹é¢æ–¹æ¡ˆ</p>
</blockquote>
<p>åŸºäºæ­£å¸¸å¯ä»¥è¿è¡Œçš„docker image è¿›è¡Œè¿›è¡ŒäºŒæ¬¡æ„å»ºï¼Œæ‰“åŒ…è¿›å»dlvå’Œgo sdk ï¼Œç„¶åç»“åˆ æºç çš„æ–¹å¼è¿›è¡Œgo build å¼€å‘è°ƒè¯•</p>
<p>ç¯å¢ƒæ–‡ä»¶ç›®å½•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">XDR2.0.35.0(10.74.121.46) ~/mhd/baseDocker <span class="hljs-comment"># tree -L 1</span><br>.<br>â”œâ”€â”€ dlv							<span class="hljs-comment"># ç¼–è¯‘å¥½çš„dlvæ–‡ä»¶</span><br>â”œâ”€â”€ dockerfile					<span class="hljs-comment"># äºŒæ¬¡æ„å»ºçš„dockerfile</span><br>â”œâ”€â”€ go							<span class="hljs-comment"># è§£å‹å¥½çš„go sdk</span><br>â””â”€â”€ go1.20.8.linux-amd64.tar.gz	  <span class="hljs-comment"># åŸå§‹ç‰ˆæœ¬ go sdk</span><br></code></pre></td></tr></table></figure>

<p>ä½¿ç”¨cdæ„å»ºå‡ºæ¥çš„é•œåƒä½œä¸ºåŸºç¡€é•œåƒ</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># ä½¿ç”¨æ‚¨æä¾›çš„åŸºç¡€é•œåƒ</span><br><span class="hljs-keyword">FROM</span> docker.sangfor.com/xdr-appstore-image/chongqingshuiliju-uploadlog:feature-<span class="hljs-number">1038473</span>-mhd-merge-<span class="hljs-number">20251023183126</span>-b24c152c<br><br><span class="hljs-keyword">USER</span> root<br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /tmp</span><br><br><span class="hljs-comment"># å¤åˆ¶dlv</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> dlv /tmp/</span><br><br><span class="hljs-comment"># å¤åˆ¶Goç›®å½•ï¼ˆå®¿ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„goç›®å½•ï¼‰åˆ°é•œåƒçš„/usr/local</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> go /usr/local/go</span><br><br><span class="hljs-comment"># å®‰è£…dlv</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /usr/local/bin &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">mv</span> /tmp/dlv /usr/local/bin/dlv &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">chmod</span> +x /usr/local/bin/dlv</span><br>    <br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> -R 755 /usr/local/go/bin/ &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">chmod</span> -R 755 /usr/local/go/pkg/tool/</span><br><br><span class="hljs-comment"># è®¾ç½®ç¯å¢ƒå˜é‡</span><br><span class="hljs-keyword">ENV</span> PATH=<span class="hljs-string">&quot;/usr/local/go/bin:$&#123;PATH&#125;&quot;</span><br><span class="hljs-keyword">ENV</span> GOPATH=<span class="hljs-string">&quot;/go&quot;</span><br><span class="hljs-keyword">ENV</span> GOROOT=<span class="hljs-string">&quot;/usr/local/go&quot;</span><br><br><span class="hljs-comment"># åˆ›å»ºGoå·¥ä½œç›®å½•</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /go/src /go/bin /go/pkg &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">chmod</span> 755 /go /go/src /go/bin /go/pkg</span><br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> 755 /app</span><br><br><span class="hljs-comment"># éªŒè¯å®‰è£…</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> go version &amp;&amp; \</span><br><span class="language-bash">    dlv version &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Installation verified successfully&quot;</span></span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;tail&quot;</span>, <span class="hljs-string">&quot;-f&quot;</span>, <span class="hljs-string">&quot;/dev/null&quot;</span>]</span><br><br></code></pre></td></tr></table></figure>
<p><code>ubuntu åŸºç¡€é•œåƒï¼Œå¦‚æœéœ€è¦è°ƒè¯•çš„é•œåƒæ— æ³•è¿è¡Œï¼Œæ›´æ¢åŸºç¡€é•œåƒ</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># ä½¿ç”¨æ‚¨æä¾›çš„åŸºç¡€é•œåƒ</span><br><span class="hljs-keyword">FROM</span> docker.io/library/ubuntu:<span class="hljs-number">22.04</span><br><br><span class="hljs-keyword">USER</span> root<br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /tmp</span><br><br><span class="hljs-comment"># å¤åˆ¶dlv</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> dlv /tmp/</span><br><br><span class="hljs-comment"># å¤åˆ¶Goç›®å½•ï¼ˆå®¿ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„goç›®å½•ï¼‰åˆ°é•œåƒçš„/usr/local</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> go /usr/local/go</span><br><br><span class="hljs-comment"># å®‰è£…dlv</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /usr/local/bin &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">mv</span> /tmp/dlv /usr/local/bin/dlv &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">chmod</span> +x /usr/local/bin/dlv</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> -R 755 /usr/local/go/bin/ &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">chmod</span> -R 755 /usr/local/go/pkg/tool/</span><br><br><span class="hljs-comment"># è®¾ç½®ç¯å¢ƒå˜é‡</span><br><span class="hljs-keyword">ENV</span> PATH=<span class="hljs-string">&quot;/usr/local/go/bin:$&#123;PATH&#125;&quot;</span><br><span class="hljs-keyword">ENV</span> GOPATH=<span class="hljs-string">&quot;/go&quot;</span><br><span class="hljs-keyword">ENV</span> GOROOT=<span class="hljs-string">&quot;/usr/local/go&quot;</span><br><br><span class="hljs-comment"># åˆ›å»ºGoå·¥ä½œç›®å½•</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /go/src /go/bin /go/pkg &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">chmod</span> 755 /go /go/src /go/bin /go/pkg</span><br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> 755 /app</span><br><br><span class="hljs-comment"># éªŒè¯å®‰è£…</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> go version &amp;&amp; \</span><br><span class="language-bash">    dlv version &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Installation verified successfully&quot;</span></span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;tail&quot;</span>, <span class="hljs-string">&quot;-f&quot;</span>, <span class="hljs-string">&quot;/dev/null&quot;</span>]</span><br></code></pre></td></tr></table></figure>



<p>æ„å»ºå‘½ä»¤</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker build --progress=plain --no-cache -t baseimage .			<span class="hljs-comment">#  æ„å»ºæ—¶æ˜¾ç¤ºè¯¦ç»†è¾“å‡º</span><br>docker tag baseimage:latest www.gond.com/baseimage:debug		<span class="hljs-comment">#  å°†é•œåƒåç§°è‡ªå®šä¹‰ä¸€ä¸‹ ä¸ç„¶ä¼špullé•œåƒ</span><br>docker build --progress=plain --no-cache -t www.gond.com/baseimage:debug . <span class="hljs-comment"># æˆ–è€…ç›´æ¥å®šä¹‰å¥½é•œåƒåç§°</span><br></code></pre></td></tr></table></figure>

<p><code>go mod vendor</code>å‘½ä»¤å°†ä¾èµ–å¤åˆ¶åˆ°æœ¬åœ°é¡¹ç›®vendorç›®å½•ä¸‹</p>
<p>å‡†å¤‡å®Œæˆä¸Šè¿°å‰ç½®ä¾èµ–ä¹‹åï¼Œåœ¨<code>nocalhost</code>ä¸­é€‰ä¸­éœ€è¦è°ƒè¯•çš„deploymentsè¿›è¡Œè¿æ¥ï¼Œæ­¤å¤„ä¸ä½¿ç”¨ Dev Configè¿›è¡Œé…ç½®ï¼Œåé¢è¿‡ç¨‹ä¸­å¯ä»¥æ‰‹åŠ¨é…ç½®</p>
<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251024145226464.png?raw=true" srcset="/img/loading.gif" lazyload alt="image-20251024145226464"></p>
<p>ç¦»çº¿ç¯å¢ƒç›´æ¥è¿›å…¥ï¼Œç„¶åé…ç½®å‰é¢æ„å»ºè‡ªå®šä¹‰çš„ <code>www.gond.com/baseimage:debug</code>é•œåƒ</p>
<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251024145302177.png?raw=true" srcset="/img/loading.gif" lazyload alt="image-20251024145302177"></p>
<p>æç¤ºè°ƒæ•´é»˜è®¤é…ç½®ï¼Œç‚¹å‡»okå³å¯</p>
<p>ä½¿ç”¨é¡¹ç›®å†…éƒ¨çš„<code>vendorä¾èµ–è¿è¡Œ</code> å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä½¿ç”¨vendorç¦»çº¿ä¾èµ–è¿è¡Œ</span><br>dlv --headless --build-flags=<span class="hljs-string">&quot;-mod=vendor&quot;</span> --<span class="hljs-built_in">log</span> --listen :5005 --api-version 2 --accept-multiclient debug . -- -f /app/config/config.yaml -s /etc/xdr/app/secrets.yaml<br><br><span class="hljs-comment"># ä¸Šè¿°è¿è¡Œå¦‚æœå‡ºç°ç›®å½•æƒé™æ‹’ç»</span><br><span class="hljs-comment"># ç›´æ¥åœ¨å‘½ä»¤å‰è®¾ç½®ç¯å¢ƒå˜é‡</span><br>GOCACHE=/tmp/go-cache GOTMPDIR=/tmp dlv --headless --build-flags=<span class="hljs-string">&quot;-mod=vendor&quot;</span> --<span class="hljs-built_in">log</span> --listen :5005 --api-version 2 --accept-multiclient debug . -- -f /app/config/config.yaml -s /etc/xdr/app/secrets.yaml<br>    <br><span class="hljs-comment"># ç›´æ¥è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>dlv --headless --listen :5005 --api-version 2 --accept-multiclient <span class="hljs-built_in">exec</span> ./app-go -- -f /app/config/config.yaml -s /etc/xdr/app/secrets.yaml<br></code></pre></td></tr></table></figure>

<p>å‰©ä¸‹çš„å°±æ˜¯dlv è¿æ¥è¿œç¨‹debug</p>
<p>é…ç½®æ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œé…ç½®port Forward ï¼Œå¼€å‘ç«¯å£</p>
<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251027091157509.png?raw=true" srcset="/img/loading.gif" lazyload alt="image-20251027091157509"></p>
<p>é…ç½®å®Œæˆç«¯å£è½¬å‘ä¹‹åï¼Œgoland å¢åŠ Go Remote è§£é‡Šå™¨åœ°å€ï¼ŒPorté…ç½®è½¬å‘çš„5005ç«¯å£ï¼Œä¸Šè¿°é…ç½®æ˜¯è½¬å‘çš„å¼€å‘ç¯å¢ƒæœ¬æœºç«¯å£</p>
<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251027091231288.png?raw=true" srcset="/img/loading.gif" lazyload alt="image-20251027091231288"></p>
<p>é…ç½®å®Œæˆä¹‹åï¼Œç›´æ¥æ­£å¸¸æ‰“æ–­ç‚¹å³å¯è¿›è¡Œè°ƒè¯•debugğŸ‰ğŸ‰ğŸ‰</p>
<blockquote>
<p>ğŸ’¡ æ­¤å¤„å¯èƒ½å‡ºç° æƒé™æ‹’ç»è¿è¡Œé—®é¢˜</p>
</blockquote>
<p><code>dev config æ¨¡ç‰ˆ</code></p>
<p>åœ¨æƒé™æ‹’ç»æˆ–è€…å†…å­˜ä¸æ»¡è¶³çš„æƒ…å†µä¸‹ å¯ä»¥åŸºäºæ¨¡ç‰ˆé€‚å½“è°ƒæ•´</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">chongqingshuiliju-uploadlog</span><br><span class="hljs-attr">serviceType:</span> <span class="hljs-string">deployment</span><br><span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">chongqingshuiliju-uploadlog</span><br>      <span class="hljs-attr">dev:</span><br>        <span class="hljs-attr">gitUrl:</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">www.gond.com/baseimage:debug1027</span><br>        <span class="hljs-attr">shell:</span> <span class="hljs-string">bash</span><br>        <span class="hljs-attr">workDir:</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">storageClass:</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">limits:</span><br>                <span class="hljs-attr">memory:</span> <span class="hljs-string">2048Mi</span><br>                <span class="hljs-attr">cpu:</span> <span class="hljs-string">&quot;2&quot;</span><br>            <span class="hljs-attr">requests:</span><br>                <span class="hljs-attr">memory:</span> <span class="hljs-string">2048Mi</span><br>                <span class="hljs-attr">cpu:</span> <span class="hljs-string">&quot;2&quot;</span><br>        <span class="hljs-attr">securityContext:</span>			<span class="hljs-comment"># å®¹å™¨çš„å®‰å…¨ç­–ç•¥</span><br>          <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">0</span>			   <span class="hljs-comment"># ä»¥ root ç”¨æˆ·èº«ä»½è¿è¡Œå®¹å™¨</span><br>          <span class="hljs-attr">allowPrivilegeEscalation:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># å…è®¸å®¹å™¨å†…çš„è¿›ç¨‹å‡çº§æƒé™</span><br>          <span class="hljs-attr">capabilities:</span>				<span class="hljs-comment"># æ·»åŠ å®¹å™¨çš„ Linux ç‰¹æƒèƒ½åŠ›</span><br>            <span class="hljs-attr">add:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">SYS_PTRACE</span>		  <span class="hljs-comment"># ç”¨äºè°ƒè¯•</span><br>        <span class="hljs-attr">readOnlyRootFilesystem:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">persistentVolumeDirs:</span> []<br>        <span class="hljs-attr">command:</span><br>            <span class="hljs-attr">run:</span> []<br>            <span class="hljs-attr">debug:</span> []<br>        <span class="hljs-attr">debug:</span><br>            <span class="hljs-attr">remoteDebugPort:</span> <span class="hljs-number">0</span><br>            <span class="hljs-attr">language:</span> <span class="hljs-string">go</span><br>        <span class="hljs-attr">hotReload:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">sync:</span> <span class="hljs-literal">null</span><br>        <span class="hljs-attr">env:</span> []<br>        <span class="hljs-attr">portForward:</span> []<br><br><br></code></pre></td></tr></table></figure>

<p>å¦‚æœè°ƒæ•´demoæ¨¡ç‰ˆé‡Œé¢çš„ç­–ç•¥æ— æ•ˆï¼Œå¯ä»¥åœ¨<code>Start DevMode</code>è¿æ¥ä¹‹åï¼Œä¿®æ”¹Deploymentsé…ç½®ä¿¡æ¯ï¼Œè°ƒæ•´é‡Œé¢çš„å®‰å…¨é…ç½®ç­–ç•¥ï¼Œä½¿ç”¨rootæƒé™è¿è¡Œ</p>
<p><img src="https://github.com/gondmhd/blogImage/blob/main/img/k8s_pod%E8%B0%83%E8%AF%95/image-20251027084932318.png?raw=true" srcset="/img/loading.gif" lazyload alt="image-20251027084932318"></p>
<p>ä¿®æ”¹ <code>spec.template.spec.containers[0].securityContext</code>ä¸‹é¢çš„é…ç½®ä¿¡æ¯</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yaml"> <span class="hljs-attr">securityContext:</span><br>   <span class="hljs-attr">allowPrivilegeEscalation:</span> <span class="hljs-literal">false</span><br>   <span class="hljs-attr">capabilities:</span><br>       <span class="hljs-attr">drop:</span><br>           <span class="hljs-bullet">-</span> <span class="hljs-string">ALL</span><br>   <span class="hljs-attr">privileged:</span> <span class="hljs-literal">false</span><br>   <span class="hljs-attr">runAsGroup:</span> <span class="hljs-number">5000</span><br>   <span class="hljs-attr">runAsNonRoot:</span> <span class="hljs-literal">true</span><br>   <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">5000</span><br>   <span class="hljs-attr">seccompProfile:</span><br>       <span class="hljs-attr">type:</span> <span class="hljs-string">RuntimeDefault</span><br>       <br><span class="hljs-comment"># ä¿®æ”¹å</span><br>  <span class="hljs-attr">securityContext:</span><br>   <span class="hljs-attr">allowPrivilegeEscalation:</span> <span class="hljs-literal">true</span><br>   <span class="hljs-attr">capabilities:</span><br>       <span class="hljs-attr">add:</span><br>           <span class="hljs-bullet">-</span> <span class="hljs-string">SYS_PTRACE</span><br>   <span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span>			<span class="hljs-comment"># true è¡¨ç¤ºå®¹å™¨æ‹¥æœ‰ä¸»æœºçš„å‡ ä¹æ‰€æœ‰æƒé™</span><br>   <span class="hljs-attr">runAsGroup:</span> <span class="hljs-number">0</span>			   <span class="hljs-comment"># è®¾ç½®å®¹å™¨å†…è¿›ç¨‹å±äº root ç”¨æˆ·ç»„</span><br>   <span class="hljs-attr">runAsNonRoot:</span> <span class="hljs-literal">false</span>			<span class="hljs-comment"># å…è®¸ä»¥ root ç”¨æˆ·è¿è¡Œ</span><br>   <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">0</span>			   <span class="hljs-comment"># å®¹å™¨å†…è¿›ç¨‹ä»¥ root èº«ä»½è¿è¡Œ</span><br>   <span class="hljs-attr">seccompProfile:</span><br>       <span class="hljs-attr">type:</span> <span class="hljs-string">RuntimeDefault</span>                <br></code></pre></td></tr></table></figure>

<p>ä¿®æ”¹ <code>spec.template.spec.securityContext</code> é…ç½®ä¿¡æ¯</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">securityContext:</span><br>    <span class="hljs-attr">fsGroup:</span> <span class="hljs-number">5000</span><br>    <span class="hljs-attr">runAsGroup:</span> <span class="hljs-number">5000</span><br>    <span class="hljs-attr">runAsNonRoot:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">5000</span><br><span class="hljs-comment"># ä¿®æ”¹å</span><br><span class="hljs-attr">securityContext:</span><br>    <span class="hljs-attr">fsGroup:</span> <span class="hljs-number">0</span>			<span class="hljs-comment"># å·å†…æ–‡ä»¶çš„å±ç»„ä¼šè¢«è®¾ç½®ä¸º root ç»„ã€‚</span><br>    <span class="hljs-attr">runAsGroup:</span> <span class="hljs-number">0</span><br>    <span class="hljs-attr">runAsNonRoot:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">0</span>            <br></code></pre></td></tr></table></figure>

<p>ä¿®æ”¹å®Œéœ€è¦ç­‰ä¸€ä¸¤åˆ†é’Ÿ</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">dlv</span> <span class="hljs-literal">--</span><span class="hljs-comment">headless</span> <span class="hljs-literal">--</span><span class="hljs-comment">log</span> <span class="hljs-literal">--</span><span class="hljs-comment">listen :5005</span> <span class="hljs-literal">--</span><span class="hljs-comment">api</span><span class="hljs-literal">-</span><span class="hljs-comment">version 2</span> <span class="hljs-literal">--</span><span class="hljs-comment">accept</span><span class="hljs-literal">-</span><span class="hljs-comment">multiclient debug  app</span><span class="hljs-literal">-</span><span class="hljs-comment">go</span><br></code></pre></td></tr></table></figure>






                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Go%E7%AC%94%E8%AE%B0/" class="category-chain-item">Goç¬”è®°</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Go/" class="print-no-link">#Go</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>k8s pod è¿œç¨‹debugå¼€å‘</div>
      <div>http://gondmhd.github.io/2026/01/28/go/k8s debugå¼€å‘æ–‡æ¡£/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Gond</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2026å¹´1æœˆ28æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2026/01/28/%E7%B3%BB%E7%BB%9F/linux%E5%91%BD%E4%BB%A4/" title="å¸¸ç”¨linuxç¬”è®°">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å¸¸ç”¨linuxç¬”è®°</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2026/01/04/tools/MongoDb%E5%85%A5%E9%97%A8/" title="MongoDb ä»‹ç»">
                        <span class="hidden-mobile">MongoDb ä»‹ç»</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
