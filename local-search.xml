<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Typora ç”¨æ³•</title>
    <link href="/2025/09/28/tools/Typora%E7%AC%94%E8%AE%B0/"/>
    <url>/2025/09/28/tools/Typora%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="Typoraçš„è¯­æ³•"><a href="#Typoraçš„è¯­æ³•" class="headerlink" title="Typoraçš„è¯­æ³•"></a>Typoraçš„è¯­æ³•</h2><h3 id="1-æ ¼å¼"><a href="#1-æ ¼å¼" class="headerlink" title="1 æ ¼å¼"></a>1 æ ¼å¼</h3><p><strong>è¡¨æ ¼</strong><br>å¯ä»¥åœ¨â€”åˆ†å‰²çº¿åŠ å…¥ï¼šè®¾ç½®è¡¨æ ¼å¯¹é½æ–¹å¼<br>â€œ:â€”â€”â€“â€œè¡¨ç¤ºå·¦å¯¹é½ï¼Œâ€:â€”â€”â€”:â€œè¡¨ç¤ºå±…ä¸­å¯¹é½ï¼Œâ€â€”â€”â€”-:â€è¡¨ç¤ºå³å¯¹é½</p><p><strong>æ— åºåˆ—è¡¨ï¼š</strong><code>-</code> + ç©ºæ ¼<br>æœ‰åºåˆ—è¡¨ï¼š<code>1.</code> + ç©ºæ ¼<br><strong>å¼•ç”¨ï¼š</strong><code>&gt;</code> + ç©ºæ ¼</p><p><strong>åˆ†å‰²çº¿:</strong> <code>---</code>å›è½¦å³å¯</p><p><strong>å¼•ç”¨</strong> <code>md</code> æ–‡ä»¶å†…éƒ¨å†…å®¹ï¼š</p><ul><li><p><code>[éœ€è¦è·³è½¬çš„æ–‡æœ¬](#destination)</code></p></li><li><p><code>&lt;a id=&quot;destination&quot;&gt;æ­£å¸¸æ˜¾ç¤ºçš„æ–‡æœ¬&lt;/a&gt;</code></p></li></ul><p>ä½¿ç”¨ä¸Šè¿°è¯­æ³•ï¼Œå³å¯é€šè¿‡<code>éœ€è¦è·³è½¬çš„æ–‡æœ¬</code>è·³è½¬åˆ°<code>æ­£å¸¸æ˜¾ç¤ºçš„æ–‡æœ¬</code> ä¾‹å¦‚ <a href="#enjoy">è¡¨æƒ…</a></p><p>é«˜äº®: </p><ul><li><code>==é«˜äº®æ–‡æœ¬==</code> typoraéœ€è¦åå¥½è®¾ç½®é‡Œé¢å¼€å¯ä¸€ä¸‹</li><li><code>&lt;mark&gt;highlight 2&lt;/mark&gt;</code></li></ul><p><strong>å¤é€‰æ¡†ï¼š</strong></p><ul><li><input disabled="" type="checkbox"> æœªå®Œæˆçš„ä»»åŠ¡</li><li><input checked="" disabled="" type="checkbox"> å·²å®Œæˆçš„ä»»åŠ¡</li><li><input disabled="" type="checkbox"> å¦ä¸€ä¸ªæœªå®Œæˆçš„ä»»åŠ¡</li></ul><p>æ­¤å¤„typora éœ€è¦å…ˆå†™<code>- </code>åé¢çš„å†…å®¹ å› ä¸º <code>-</code> ç©ºæ ¼ç›´æ¥å°±å˜æˆæ— åºäº†</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>[ ] æœªå®Œæˆçš„ä»»åŠ¡<br><span class="hljs-bullet">- </span>[x] å·²å®Œæˆçš„ä»»åŠ¡<br><span class="hljs-bullet">- </span>[ ] å¦ä¸€ä¸ªæœªå®Œæˆçš„ä»»åŠ¡<br></code></pre></td></tr></table></figure><p><strong>æ³¨è§£ï¼š</strong></p><p>åˆ›å»ºè„šæ³¨æ ¼å¼ç±»ä¼¼è¿™æ · [^RUNOOB]ã€‚</p><p>[^RUNOOB]: èœé¸Ÿæ•™ç¨‹ â€“ å­¦çš„ä¸ä»…æ˜¯æŠ€æœ¯ï¼Œæ›´æ˜¯æ¢¦æƒ³ï¼ï¼ï¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">åˆ›å»ºè„šæ³¨æ ¼å¼ç±»ä¼¼è¿™æ · [^RUNOOB]ã€‚<br><br>[<span class="hljs-symbol">^RUNOOB</span>]: <span class="hljs-link">èœé¸Ÿæ•™ç¨‹ -- å­¦çš„ä¸ä»…æ˜¯æŠ€æœ¯ï¼Œæ›´æ˜¯æ¢¦æƒ³ï¼ï¼ï¼</span><br></code></pre></td></tr></table></figure><hr><h3 id="2ã€å¿«æ·é”®"><a href="#2ã€å¿«æ·é”®" class="headerlink" title="2ã€å¿«æ·é”®"></a>2ã€å¿«æ·é”®</h3><p>æ ‡é¢˜ï¼šctrl + æ•°å­—<br>è¡¨æ ¼ï¼šctrl + t</p><p>è¡¨æ ¼å¢åŠ ä¸€è¡Œå¿«æ·é”®ï¼šé€‰æ‹©è¡Œæ•° æŒ‰ä¸‹ctrl+enther </p><p>ç”Ÿæˆç›®å½•ï¼š[TOC] + å›è½¦<br>é€‰ä¸­ä¸€æ•´è¡Œï¼šctrl + l<br>é€‰ä¸­å•è¯ï¼šctrl + d<br>é€‰ä¸­ç›¸åŒæ ¼å¼çš„æ–‡å­—ï¼šctrl + e<br>è·³è½¬åˆ°æ–‡ç« å¼€å¤´ï¼šctrl + home<br>è·³è½¬åˆ°æ–‡ç« ç»“å°¾ï¼šctrl + end<br>æœç´¢ï¼šctrl + f<br>æ›¿æ¢ï¼šctrl + h<br>åŠ ç²—ï¼šctrl + b<br>å€¾æ–œï¼šctrl + i<br>ä¸‹åˆ’çº¿ï¼šctrl + u<br>åˆ é™¤çº¿ï¼šalt + shift + 5<br>æ’å…¥å›¾ç‰‡ï¼šç›´æ¥æ‹–åŠ¨åˆ°æŒ‡å®šä½ç½®å³å¯æˆ–è€…ctrl + shift + i<br>æ’å…¥é“¾æ¥ï¼šctrl + k</p><hr><h3 id="3ã€è¡¨æƒ…"><a href="#3ã€è¡¨æƒ…" class="headerlink" title="3ã€è¡¨æƒ…"></a>3ã€<a id="enjoy">è¡¨æƒ…</a></h3><p><a href="https://blog.csdn.net/qq_40896997/article/details/106551767">è¡¨æƒ…</a></p><p>:white_check_mark:  <code>:white_check_mark:</code></p><p>:x: <code>:x:</code></p><p>:heavy_check_mark: <code>:heavy_check_mark:</code></p><p>window å¿«æ·é”® <code>win + .</code></p><p><strong>å¸¸ç”¨é¢œè‰²</strong><br><code>&lt;font color=maroon&gt;çº¢è‰²&lt;/font&gt;</code> <font color=maroon>çº¢è‰²</font><br>color&#x3D;grey<br>color&#x3D;silver<br>color&#x3D;lightgrey<br>color&#x3D;HotPink<br>color&#x3D;DeepPink<br>color&#x3D;VioletRed<br>color&#x3D;Purple<br>color&#x3D;navy<br>color&#x3D;Blue<br>color&#x3D;DeepSkyBlue<br>color&#x3D;LightSkyBlue<br>color&#x3D;aqua<br>color&#x3D;DarkTurquoise<br>color&#x3D;LightSeaGreen<br>color&#x3D;YellowGreen<br>color&#x3D;LawnGreen<br>color&#x3D;GreenYellow<br>color&#x3D;Yellow<br>color&#x3D;Tomato<br>color&#x3D;red<br>color&#x3D;fuchsia<br>color&#x3D;MediumOrchid<br>color&#x3D;DarkViolet</p><hr><h3 id="4ã€ä¸»é¢˜"><a href="#4ã€ä¸»é¢˜" class="headerlink" title="4ã€ä¸»é¢˜"></a>4ã€ä¸»é¢˜</h3><p>å¯¼å‡ºpdfä¸»é¢˜ï¼Œé€‰æ‹©<code>Drake</code> </p>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux æ³¨å†Œå•å…ƒæœåŠ¡</title>
    <link href="/2025/09/25/%E7%B3%BB%E7%BB%9F/linux%E6%B3%A8%E5%86%8C%E5%8D%95%E5%85%83%E6%9C%8D%E5%8A%A1/"/>
    <url>/2025/09/25/%E7%B3%BB%E7%BB%9F/linux%E6%B3%A8%E5%86%8C%E5%8D%95%E5%85%83%E6%9C%8D%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="Linux-æ³¨å†Œå•å…ƒæœåŠ¡"><a href="#Linux-æ³¨å†Œå•å…ƒæœåŠ¡" class="headerlink" title="Linux æ³¨å†Œå•å…ƒæœåŠ¡"></a>Linux æ³¨å†Œå•å…ƒæœåŠ¡</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><blockquote><p>systemctlæ˜¯ä¸€ä¸ªç³»ç»Ÿè½¯ä»¶æœåŠ¡çš„ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºå¯åŠ¨ã€åœæ­¢ã€é‡å¯å’Œé‡æ–°åŠ è½½æœåŠ¡ï¼ŒæŸ¥çœ‹æœåŠ¡çŠ¶æ€ä»¥åŠè®¾ç½®é»˜è®¤å¯åŠ¨çº§åˆ«ç­‰ã€‚å®ƒè¿˜å¯ä»¥ç®¡ç†æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå®šåˆ¶æœåŠ¡é…ç½®ï¼Œå¹¶å¯¹æœåŠ¡çš„æ—¥å¿—è¿›è¡Œç®¡ç†</p></blockquote><blockquote><p>Linuxä¸­ï¼Œå®šä¹‰è½¯ä»¶æœåŠ¡çš„æ–‡ä»¶é€šå¸¸æ˜¯systemdæœåŠ¡å•å…ƒæ–‡ä»¶ï¼Œå…·æœ‰<code>.service</code>åç¼€ï¼Œè¿™äº›æ–‡ä»¶é€šå¸¸ä½äºä»¥ä¸‹ç›®å½•ï¼š</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">/etc/systemd/system/<br><br>/usr/lib/systemd/system<br><br>/lib/systemd/system<br></code></pre></td></tr></table></figure><h2 id="Serviceæ–‡ä»¶"><a href="#Serviceæ–‡ä»¶" class="headerlink" title="Serviceæ–‡ä»¶"></a>Serviceæ–‡ä»¶</h2><h3 id="æ ¼å¼è¯´æ˜"><a href="#æ ¼å¼è¯´æ˜" class="headerlink" title="æ ¼å¼è¯´æ˜"></a>æ ¼å¼è¯´æ˜</h3><p>serviceæ–‡ä»¶é€šå¸¸ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs te">[Unit]ï¼šå®šä¹‰ä¸Unitç±»å‹æ— å…³çš„é€šç”¨é€‰é¡¹ï¼Œç”¨äºæä¾›unitçš„æè¿°ä¿¡æ¯ã€unitè¡Œä¸ºåŠä¾èµ–å…³ç³»ç­‰<br><br>[Service]ï¼šä¸ç‰¹å®šç±»å‹ç›¸å…³çš„ä¸“ç”¨é€‰é¡¹ï¼Œæ­¤å¤„ä¸ºServiceç±»å‹<br><br>[Install]ï¼šå®šä¹‰ç”±â€œsystemctl enableâ€ä»¥åŠ&quot;systemctl disableâ€œå‘½ä»¤åœ¨å®ç°æœåŠ¡å¯ç”¨æˆ–ç¦ç”¨æ—¶ç”¨åˆ°çš„ä¸€äº›é€‰é¡¹<br></code></pre></td></tr></table></figure><p>æ³¨æ„</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tex">ä»¥<span class="hljs-params">#</span>å¼€å¤´çš„è¡Œåé¢çš„å†…å®¹ä¼šè¢«è®¤ä¸ºæ˜¯æ³¨é‡Š<br><br>1ã€yesã€onã€trueä»£è¡¨å¼€å¯ï¼Œ0ã€noã€offã€falseä»£è¡¨å…³é—­<br><br>æ—¶é—´å•ä½é»˜è®¤æ˜¯ç§’ï¼Œå¯ä»¥ç”¨æ¯«ç§’ï¼ˆmsï¼‰åˆ†é’Ÿï¼ˆmï¼‰ç­‰é¡»æ˜¾å¼è¯´æ˜<br></code></pre></td></tr></table></figure><h3 id="Unitéƒ¨åˆ†"><a href="#Unitéƒ¨åˆ†" class="headerlink" title="Unitéƒ¨åˆ†"></a>Unitéƒ¨åˆ†</h3><table><thead><tr><th>å¯é€‰é¡¹</th><th>æè¿°</th></tr></thead><tbody><tr><td>Description</td><td>å¯¹å½“å‰æœåŠ¡çš„ç®€å•æè¿°</td></tr><tr><td>After</td><td>å¯ä»¥æŒ‡å®šåœ¨å“ªäº›æœåŠ¡ä¹‹åè¿›è¡Œå¯åŠ¨</td></tr><tr><td>Before</td><td>å¯ä»¥æŒ‡å®šæœåŠ¡ä¾èµ–äºå“ªäº›æœåŠ¡(è¿™ç§ä¾èµ–æ˜¯â€å¼ºä¾èµ–â€ï¼Œä¸€æ—¦æ‰€ä¾èµ–çš„æœåŠ¡å¼‚å¸¸ï¼Œå½“å‰çš„æœåŠ¡ä¹Ÿéšä¹‹åœæ­¢)</td></tr><tr><td>Requires</td><td>å¯ä»¥æŒ‡å®šæœåŠ¡ä¾èµ–äºå“ªäº›æœåŠ¡(è¿™ç§ä¾èµ–æ˜¯â€å¼±ä¾èµ–â€ï¼Œå³ä½¿æ‰€ä¾èµ–çš„æœåŠ¡çš„å¯åŠ¨æƒ…å†µä¸å½±å“å½“å‰çš„æœåŠ¡æ˜¯å¦å¯åŠ¨)</td></tr><tr><td>Wants</td><td>å¯ä»¥æŒ‡å®šæœåŠ¡ä¾èµ–äºå“ªäº›æœåŠ¡(è¿™ç§ä¾èµ–æ˜¯â€å¼±ä¾èµ–â€ï¼Œå³ä½¿æ‰€ä¾èµ–çš„æœåŠ¡çš„å¯åŠ¨æƒ…å†µä¸å½±å“å½“å‰çš„æœåŠ¡æ˜¯å¦å¯åŠ¨)</td></tr><tr><td>Conflicts</td><td>å®šä¹‰unitsé—´çš„å†²çªå…³ç³»</td></tr></tbody></table><h3 id="Serviceéƒ¨åˆ†"><a href="#Serviceéƒ¨åˆ†" class="headerlink" title="Serviceéƒ¨åˆ†"></a>Serviceéƒ¨åˆ†</h3><table><thead><tr><th>å¯é€‰é¡¹</th><th>æè¿°</th></tr></thead><tbody><tr><td>EnvironmentFile</td><td>ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼Œç”¨æ¥æŒ‡å®šå½“å‰æœåŠ¡å¯åŠ¨çš„ç¯å¢ƒå˜é‡</td></tr><tr><td>ExecStart</td><td>æŒ‡å®šæœåŠ¡å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬</td></tr><tr><td>ExecStartPre</td><td>æŒ‡å®šæœåŠ¡å¯åŠ¨å‰æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬</td></tr><tr><td>ExecStartPost</td><td>æŒ‡å®šæœåŠ¡å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬</td></tr><tr><td>ExecStop</td><td>æŒ‡æ˜åœæ­¢æœåŠ¡è¦è¿è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬</td></tr><tr><td>ExecStopPost</td><td>æŒ‡å®šæœåŠ¡åœæ­¢ä¹‹åæ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬</td></tr><tr><td>RestartSec</td><td>æŒ‡å®šæœåŠ¡åœ¨é‡å¯æ—¶ç­‰å¾…çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’</td></tr><tr><td>ExecReload</td><td>æŒ‡æ˜é‡å¯æœåŠ¡è¦è¿è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬</td></tr><tr><td>Restart</td><td>å½“è®¾å®šRestart&#x3D;1 æ—¶ï¼Œåˆ™å½“æ¬¡daemonæœåŠ¡æ„å¤–ç»ˆæ­¢åï¼Œä¼šå†æ¬¡è‡ªåŠ¨å¯åŠ¨æ­¤æœåŠ¡ï¼Œå…·ä½“çœ‹ä¸‹åˆ—ç±»å‹</td></tr><tr><td>PrivateTmp</td><td>è®¾å®šä¸ºyesæ—¶ï¼Œä¼šåœ¨ç”Ÿæˆ&#x2F;tmp&#x2F;systemd-private-UUID-NAME.service-XXXXX&#x2F;tmp&#x2F;ç›®å½•</td></tr><tr><td>KillMode</td><td>æŒ‡å®šåœæ­¢çš„æ–¹å¼ï¼Œå…·ä½“è§ä¸‹é¢</td></tr><tr><td>Restart</td><td>æŒ‡å®šé‡å¯æ—¶çš„ç±»å‹ï¼Œå…·ä½“è§ä¸‹é¢</td></tr><tr><td>Type</td><td>æŒ‡å®šå¯åŠ¨ç±»å‹ï¼Œå…·ä½“è§ä¸‹é¢</td></tr></tbody></table><p>Typeçš„å¯é€‰å€¼</p><table><thead><tr><th><strong>typeå¯é€‰é¡¹</strong></th><th>æè¿°</th></tr></thead><tbody><tr><td>simple</td><td>æŒ‡å®šExecStartå­—æ®µçš„è¿›ç¨‹ä¸ºä¸»è¿›ç¨‹</td></tr><tr><td>forking</td><td>æŒ‡å®šä»¥fork() å­è¿›ç¨‹æ‰§è¡ŒExecStartå­—æ®µçš„è¿›ç¨‹</td></tr><tr><td>oneshot</td><td>æ‰§è¡Œä¸€æ¬¡</td></tr><tr><td>notify</td><td>å¯åŠ¨åå‘é€ä¼šå‘é€é€šçŸ¥ä¿¡å·é€šçŸ¥systemd</td></tr><tr><td>idle</td><td>ç­‰å…¶ä»–ä»»åŠ¡ç»“æŸåæ‰è¿è¡Œ</td></tr></tbody></table><p>Restartçš„å¯é€‰å€¼</p><table><thead><tr><th>Restartå¯é€‰é¡¹</th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>no</td><td>é€€å‡ºåä¸ä¼šé‡å¯</td></tr><tr><td>on-success</td><td>å½“è¿›ç¨‹æ­£å¸¸é€€å‡ºæ—¶(é€€å‡ºç ä¸º0) æ‰§è¡Œé‡å¯</td></tr><tr><td>on-failure</td><td>å½“è¿›ç¨‹ä¸æ­£å¸¸é€€å‡ºæ—¶(é€€å‡ºç ä¸ä¸º0) æ‰§è¡Œé‡å¯</td></tr><tr><td>on-abnormal</td><td>å½“è¢«ä¿¡å·ç»ˆæ­¢å’Œè¶…æ—¶æ‰§è¡Œé‡å¯</td></tr><tr><td>on-abort</td><td>å½“æ”¶åˆ°æ²¡æœ‰æ•æ‰åˆ°çš„ä¿¡å·ç»ˆæ­¢æ—¶æ‰§è¡Œé‡å¯</td></tr><tr><td>on-watchdog</td><td>å½“çœ‹é—¨ç‹—è¶…æ—¶æ—¶æ‰§è¡Œé‡å¯</td></tr><tr><td>always</td><td>ä¸€ç›´é‡å¯</td></tr></tbody></table><p>KillModeå¯é€‰å€¼</p><table><thead><tr><th>KillModeå¯é€‰é¡¹</th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>control-group</td><td>æ€æ‰å½“å‰è¿›ç¨‹ä¸­æ‰€æœ‰çš„è¿›ç¨‹</td></tr><tr><td>process</td><td>æ€æ‰å½“å‰è¿›ç¨‹çš„ä¸»è¿›ç¨‹</td></tr><tr><td>mixed</td><td>ä¸»è¿›ç¨‹å°†æ”¶åˆ° SIGTERM ä¿¡å·ï¼Œå­è¿›ç¨‹æ”¶åˆ° SIGKILL ä¿¡å·</td></tr><tr><td>none</td><td>ä¸æ€æ‰ä»»ä½•è¿›ç¨‹</td></tr></tbody></table><h3 id="Installéƒ¨åˆ†"><a href="#Installéƒ¨åˆ†" class="headerlink" title="Installéƒ¨åˆ†"></a>Installéƒ¨åˆ†</h3><table><thead><tr><th>Installå¯é€‰é¡¹</th><th>æè¿°</th></tr></thead><tbody><tr><td>Alias</td><td>åˆ«åï¼Œå¯ä½¿ç”¨systemctl command Alias.service</td></tr><tr><td>RequiredBy</td><td>è¢«å“ªäº›unitsæ‰€ä¾èµ–ï¼Œå¼ºä¾èµ–</td></tr><tr><td>WantedBy</td><td>è¢«å“ªäº›unitsæ‰€ä¾èµ–ï¼Œå¼±ä¾èµ–</td></tr><tr><td>Also</td><td>å®‰è£…æœ¬æœåŠ¡çš„æ—¶å€™è¿˜è¦å®‰è£…åˆ«çš„ç›¸å…³æœåŠ¡</td></tr><tr><td>Install</td><td>ä¸€èˆ¬å¡«ä¸ºWantedBy&#x3D;multi-user.target</td></tr></tbody></table><p>æ³¨æ„</p><blockquote><p>å¯¹äºæ–°åˆ›å»ºçš„unitæ–‡ä»¶ï¼Œæˆ–è€…ä¿®æ”¹äº†çš„unitæ–‡ä»¶ï¼Œè¦é€šçŸ¥systemdé‡è½½æ­¤é…ç½®æ–‡ä»¶,è€Œåå¯ä»¥é€‰æ‹©é‡å¯ï¼Œä½¿ç”¨å‘½ä»¤ <code>systemctl daemon-reload</code></p></blockquote><h2 id="è‡ªå®šä¹‰ServiceæœåŠ¡"><a href="#è‡ªå®šä¹‰ServiceæœåŠ¡" class="headerlink" title="è‡ªå®šä¹‰ServiceæœåŠ¡"></a>è‡ªå®šä¹‰ServiceæœåŠ¡</h2><blockquote><p>è¿™é‡Œå°†ä¸€ä¸ªfrpcè½¯ä»¶å®šä¹‰æˆä¸€ä¸ªæœåŠ¡ï¼Œé€šè¿‡ä½¿ç”¨<code>systemctl</code>å‘½ä»¤è¿›è¡Œå¯åŠ¨ã€åœæ­¢ç­‰çš„ç®¡ç†æ“ä½œã€‚</p></blockquote><h3 id="åˆ›å»ºserviceæ–‡ä»¶"><a href="#åˆ›å»ºserviceæ–‡ä»¶" class="headerlink" title="åˆ›å»ºserviceæ–‡ä»¶"></a>åˆ›å»ºserviceæ–‡ä»¶</h3><p>æ–°å»º<code>frpc.service</code>çš„serviceæ–‡ä»¶ï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹ï¼Œé…ç½®æ–‡ä»¶ä¿¡æ¯æ ¹æ®è½¯ä»¶(frpc)æ–‡ä»¶è·¯å¾„æ›´æ”¹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">[Unit]<br>Description=Frpc Client Service<br>After=network.target<br> <br>[Service]<br>Type=simple<br>Restart=always<br>TimeoutStartSec=30<br>Restart=on-failure<br>RestartSec=5s<br>ExecStart=/usr/local/program/frp/frpc -c /usr/local/program/frp/frpc.ini<br>ExecStop=/bin/kill <span class="hljs-variable">$MAINPID</span><span class="hljs-comment"># å¼ºåˆ¶ç»ˆæ­¢ å…³é—­ä¸»è¿›ç¨‹ ç›¸å¯¹è€Œè¨€ ç›´æ¥ä½¿ç”¨systemctl stop æ›´ä¼˜é›… ç»™æœåŠ¡æ›´å¤šæœºä¼šé‡Šæ”¾èµ„æº </span><br>ExecReload=/usr/local/program/frp/frpc reload -c /usr/local/program/frp/frpc.ini<br> <br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h3 id="å¯åŠ¨ç³»ç»ŸæœåŠ¡"><a href="#å¯åŠ¨ç³»ç»ŸæœåŠ¡" class="headerlink" title="å¯åŠ¨ç³»ç»ŸæœåŠ¡"></a>å¯åŠ¨ç³»ç»ŸæœåŠ¡</h3><p>å°†<code>frpc.service</code>æ–‡ä»¶å¤åˆ¶åˆ°<code>/lib/systemd/system</code>é‡Œé¢ï¼Œç„¶åé‡æ–°åŠ è½½systemctlé…ç½®æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> ./frpc.service /lib/systemd/system<br>systemctl <span class="hljs-built_in">enable</span> frpc  <br>systemctl daemon-reload<br></code></pre></td></tr></table></figure><p>å¯åŠ¨åˆ›å»ºå¥½çš„æœåŠ¡ï¼Œå¹¶è®¾ç½®è‡ªå¯åŠ¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span><br>systemctl daemon-reload<br> <br><span class="hljs-comment"># å¯åŠ¨frpcæœåŠ¡</span><br>systemctl start frpc<br> <br><span class="hljs-comment"># å¼€æœºè‡ªå¯åŠ¨frpcæœåŠ¡</span><br>systemctl <span class="hljs-built_in">enable</span> frpc<br> <br><span class="hljs-comment"># æŸ¥çœ‹frpcå½“å‰çŠ¶æ€</span><br>systemctl status frpc<br></code></pre></td></tr></table></figure><h2 id="systemctlå‘½ä»¤é›†åˆ"><a href="#systemctlå‘½ä»¤é›†åˆ" class="headerlink" title="systemctlå‘½ä»¤é›†åˆ"></a>systemctlå‘½ä»¤é›†åˆ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¯­æ³•</span><br>systemctl COMMAND name.service<br><span class="hljs-comment">#å¯åŠ¨</span><br>systemctl start name.service<br><span class="hljs-comment">#åœæ­¢</span><br>systemctl stop name.service<br><span class="hljs-comment">#é‡å¯</span><br>systemctl restart name.service<br><span class="hljs-comment">#æŸ¥çœ‹çŠ¶æ€</span><br>systemctl status name.service<br><span class="hljs-comment">#ç¦æ­¢è‡ªåŠ¨å’Œæ‰‹åŠ¨å¯åŠ¨</span><br>systemctl mask name.service<br><span class="hljs-comment">#å–æ¶ˆç¦æ­¢</span><br>systemctl unmask name.service<br><span class="hljs-comment">#æŸ¥çœ‹æŸæœåŠ¡å½“å‰æ¿€æ´»ä¸å¦çš„çŠ¶æ€</span><br>systemctl is-active name.service<br><span class="hljs-comment">#æŸ¥çœ‹æ‰€æœ‰å·²ç»æ¿€æ´»çš„æœåŠ¡</span><br>systemctl list-units --<span class="hljs-built_in">type</span>|-t service<br><span class="hljs-comment">#æŸ¥çœ‹æ‰€æœ‰æœåŠ¡</span><br>systemctl list-units --<span class="hljs-built_in">type</span> service --all<br><span class="hljs-comment">#è®¾å®šæŸæœåŠ¡å¼€æœºè‡ªå¯ï¼Œç›¸å½“äºchkconfig name on</span><br>systemctl <span class="hljs-built_in">enable</span> name.service<br><span class="hljs-comment">#è®¾å®šæŸæœåŠ¡å¼€æœºç¦æ­¢å¯åŠ¨ï¼šç›¸å½“äºchkconfig name off</span><br>systemctl <span class="hljs-built_in">disable</span> name.service<br><span class="hljs-comment">#æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„å¼€æœºè‡ªå¯çŠ¶æ€ï¼Œç›¸å½“äºchkconfig --list</span><br>systemctl list-unit-files --<span class="hljs-built_in">type</span> service<br><span class="hljs-comment">#ç”¨æ¥åˆ—å‡ºè¯¥æœåŠ¡åœ¨å“ªäº›è¿è¡Œçº§åˆ«ä¸‹å¯ç”¨å’Œç¦ç”¨ï¼šchkconfig â€“list name</span><br><span class="hljs-built_in">ls</span> /etc/systemd/system/*.wants/name.service<br><span class="hljs-comment">#æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¼€æœºè‡ªå¯</span><br>systemctl is-enabled name.service<br><span class="hljs-comment">#åˆ—å‡ºå¤±è´¥çš„æœåŠ¡</span><br>systemctl --failed --<span class="hljs-built_in">type</span>=service<br><span class="hljs-comment">#å¼€æœºå¹¶ç«‹å³å¯åŠ¨æˆ–åœæ­¢</span><br>systemctl <span class="hljs-built_in">enable</span> --now postfix<br>systemctl <span class="hljs-built_in">disable</span>  --now postfix<br><span class="hljs-comment">#æŸ¥çœ‹æœåŠ¡çš„ä¾èµ–å…³ç³»</span><br>systemctl list-dependencies name.service<br><span class="hljs-comment">#æ€æ‰è¿›ç¨‹</span><br>systemctl <span class="hljs-built_in">kill</span> unitname<br><span class="hljs-comment">#é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span><br>systemctl daemon-reload<br><span class="hljs-comment">#å…³æœº</span><br>systemctl haltã€systemctl poweroff<br><span class="hljs-comment">#é‡å¯</span><br>systemctl reboot<br><span class="hljs-comment">#æŒ‚èµ·</span><br>systemctl <span class="hljs-built_in">suspend</span><br><span class="hljs-comment">#ä¼‘çœ </span><br>systemctl hibernate<br><span class="hljs-comment">#ä¼‘çœ å¹¶æŒ‚èµ·</span><br>systemctl hybrid-sleep<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windowç¯å¢ƒé…ç½®</title>
    <link href="/2025/09/25/%E7%B3%BB%E7%BB%9F/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <url>/2025/09/25/%E7%B3%BB%E7%BB%9F/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h1><h2 id="go-è§£é‡Šå™¨é…ç½®-window"><a href="#go-è§£é‡Šå™¨é…ç½®-window" class="headerlink" title="go è§£é‡Šå™¨é…ç½®(window)"></a>go è§£é‡Šå™¨é…ç½®(window)</h2><p><a href="https://github.com/moovweb/gvm">linuxä½¿ç”¨gvmé…ç½®</a></p><p><a href="https://github.com/voidint/g/blob/master/README_CN.md">windowä½¿ç”¨gé…ç½®</a></p><h4 id="æ£€æŸ¥æœ¬æœºæ˜¯å¦å­˜åœ¨golangè§£é‡Šå™¨"><a href="#æ£€æŸ¥æœ¬æœºæ˜¯å¦å­˜åœ¨golangè§£é‡Šå™¨" class="headerlink" title="æ£€æŸ¥æœ¬æœºæ˜¯å¦å­˜åœ¨golangè§£é‡Šå™¨"></a>æ£€æŸ¥æœ¬æœºæ˜¯å¦å­˜åœ¨golangè§£é‡Šå™¨</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span> version<br></code></pre></td></tr></table></figure><h4 id="æ­¥éª¤-1ï¼šè®¾ç½®-GOROOTï¼ˆ-Go-ç¯å¢ƒæ‰€åœ¨ç›®å½•çš„é…ç½®ï¼‰"><a href="#æ­¥éª¤-1ï¼šè®¾ç½®-GOROOTï¼ˆ-Go-ç¯å¢ƒæ‰€åœ¨ç›®å½•çš„é…ç½®ï¼‰" class="headerlink" title="æ­¥éª¤ 1ï¼šè®¾ç½®Â GOROOTï¼ˆ Go ç¯å¢ƒæ‰€åœ¨ç›®å½•çš„é…ç½®ï¼‰"></a>æ­¥éª¤ 1ï¼šè®¾ç½®Â <code>GOROOT</code>ï¼ˆ Go ç¯å¢ƒæ‰€åœ¨ç›®å½•çš„é…ç½®ï¼‰</h4><blockquote><p>ä¸ºäº†ä½¿æ‰€æœ‰çš„è®¡ç®—æœºç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ Go ç¯å¢ƒï¼Œæˆ‘ä»¬å°±åœ¨ç³»ç»Ÿå˜é‡ä¹‹ä¸­é…ç½®ã€‚ç‚¹å‡»ç³»ç»Ÿå˜é‡ä¸‹çš„æ–°å»ºï¼Œåœ¨å˜é‡åä¸€æ è¾“å…¥ GOROOT ï¼Œåœ¨å˜é‡å€¼ä¸€æ è¾“å…¥ ä½ è§£å‹æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•D:\è·¯å¾„\goã€‚<br>æœ€åç‚¹å‡»ç¡®å®šï¼Œå°±å°† GOROOT æ–°å»ºå®Œæ¯•ã€‚</p></blockquote><ol><li>å³é”®ã€Œæ­¤ç”µè„‘ã€â†’ é€‰æ‹©ã€Œå±æ€§ã€â†’ ç‚¹å‡»ã€Œé«˜çº§ç³»ç»Ÿè®¾ç½®ã€â†’ ç‚¹å‡»ã€Œç¯å¢ƒå˜é‡ã€ã€‚</li><li>åœ¨ã€Œç³»ç»Ÿå˜é‡ã€ä¸­ç‚¹å‡»ã€Œæ–°å»ºã€ã€‚</li><li>å˜é‡åï¼š<code>GOROOT</code></li><li>å˜é‡å€¼ï¼šGo çš„å®‰è£…ç›®å½•ï¼ˆå¦‚Â <code>C:\Program Files\Go</code>Â æˆ–Â <code>D:\Go</code>ï¼‰ã€‚</li></ol><h4 id="æ­¥éª¤-2ï¼šè®¾ç½®-GOPATHï¼ˆå·¥ä½œåŒºè·¯å¾„ï¼Œå­˜æ”¾é¡¹ç›®å’Œä¾èµ–ï¼‰"><a href="#æ­¥éª¤-2ï¼šè®¾ç½®-GOPATHï¼ˆå·¥ä½œåŒºè·¯å¾„ï¼Œå­˜æ”¾é¡¹ç›®å’Œä¾èµ–ï¼‰" class="headerlink" title="æ­¥éª¤ 2ï¼šè®¾ç½®Â GOPATHï¼ˆå·¥ä½œåŒºè·¯å¾„ï¼Œå­˜æ”¾é¡¹ç›®å’Œä¾èµ–ï¼‰"></a>æ­¥éª¤ 2ï¼šè®¾ç½®Â <code>GOPATH</code>ï¼ˆå·¥ä½œåŒºè·¯å¾„ï¼Œå­˜æ”¾é¡¹ç›®å’Œä¾èµ–ï¼‰</h4><blockquote><p>GOPATHå’ŒGOROOTçš„é…ç½®ç•¥æœ‰ä¸åŒï¼Œæˆ‘å»ºè®®é…ç½®ä¸¤ä¸ªGOPATHç›®å½•ï¼Œç¬¬ä¸€ä¸ªç”¨äºæ”¾ Go è¯­è¨€çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œç¬¬äºŒä¸ªç”¨äºæ”¾è‡ªå·±çš„å¼€å‘ä»£ç ã€‚æˆ‘ä»¬æ¥æ–°å»ºGOPATHã€‚ç‚¹å‡»ç³»ç»Ÿå˜é‡ä¸‹çš„æ–°å»ºï¼Œåœ¨å˜é‡åä¸€æ è¾“å…¥GOPATHï¼Œåœ¨å˜é‡å€¼ä¸€æ è¾“å…¥ä»»æ„ä¸¤ä¸ªç›®å½•ï¼Œä¸­é—´ç”¨è‹±æ–‡åˆ†å·éš”å¼€ã€‚</p><p>ç¤ºä¾‹ï¼šD:\è·¯å¾„\go\library;D:\è·¯å¾„\go\workspace</p></blockquote><ol><li>åœ¨ã€Œç³»ç»Ÿå˜é‡ã€ä¸­ç‚¹å‡»ã€Œæ–°å»ºã€ï¼ˆè‹¥ä¸å­˜åœ¨åˆ™æ–°å»ºï¼‰ã€‚</li><li>å˜é‡åï¼š<code>GOPATH</code></li><li>å˜é‡å€¼ï¼šè‡ªå®šä¹‰å·¥ä½œåŒºè·¯å¾„ï¼ˆå¦‚Â <code>D:\è·¯å¾„\go\library;D:\è·¯å¾„\go\workspace</code>ï¼Œå»ºè®®å•ç‹¬åˆ›å»ºç©ºç›®å½•ï¼‰ã€‚<ul><li>è¯´æ˜ï¼šGo 1.13 åæ”¯æŒæ¨¡å—ï¼ˆ<code>go mod</code>ï¼‰ï¼Œ<code>GOPATH</code>Â çš„ä½œç”¨å¼±åŒ–ï¼Œä½†ä»ç”¨äºå­˜æ”¾Â <code>go install</code>Â å®‰è£…çš„å·¥å…·ï¼ˆå¦‚Â <code>gopls</code>Â è¯­è¨€æœåŠ¡å™¨ï¼‰ã€‚</li></ul></li></ol><h4 id="æ­¥éª¤-3ï¼šè®¾ç½®-Pathï¼ˆæ·»åŠ -Go-å‘½ä»¤è·¯å¾„ï¼‰"><a href="#æ­¥éª¤-3ï¼šè®¾ç½®-Pathï¼ˆæ·»åŠ -Go-å‘½ä»¤è·¯å¾„ï¼‰" class="headerlink" title="æ­¥éª¤ 3ï¼šè®¾ç½®Â Pathï¼ˆæ·»åŠ  Go å‘½ä»¤è·¯å¾„ï¼‰"></a>æ­¥éª¤ 3ï¼šè®¾ç½®Â <code>Path</code>ï¼ˆæ·»åŠ  Go å‘½ä»¤è·¯å¾„ï¼‰</h4><ol><li>åœ¨ã€Œç³»ç»Ÿå˜é‡ã€ä¸­æ‰¾åˆ°Â <code>Path</code>Â å˜é‡ï¼ŒåŒå‡»æ‰“å¼€ç¼–è¾‘ç•Œé¢ã€‚</li><li>ç‚¹å‡»ã€Œæ–°å»ºã€ï¼Œæ·»åŠ ä»¥ä¸‹è·¯å¾„ï¼š<ul><li><code>%GOROOT%\bin</code>ï¼ˆGo ç¼–è¯‘å™¨ã€å·¥å…·ï¼ˆå¦‚Â <code>go</code>ã€<code>gofmt</code>ï¼‰çš„è·¯å¾„ï¼‰ã€‚</li></ul></li></ol><h4 id="æ ¡éªŒæ˜¯å¦é…ç½®æˆåŠŸ"><a href="#æ ¡éªŒæ˜¯å¦é…ç½®æˆåŠŸ" class="headerlink" title="æ ¡éªŒæ˜¯å¦é…ç½®æˆåŠŸ"></a>æ ¡éªŒæ˜¯å¦é…ç½®æˆåŠŸ</h4><blockquote><p><strong>windows+R è¾“å…¥ cmd æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥go versionï¼Œå¦‚æœè¾“å‡ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåˆ™å®‰è£…æˆåŠŸã€‚</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bssh">#æŸ¥çœ‹Goç‰ˆæœ¬<br>go version<br><br>#æŸ¥çœ‹Goç¯å¢ƒå˜é‡<br>go env<br><br><br>$ go env<br>set GO111MODULE=on<br>set GOARCH=amd64<br>set GOBIN=<br>set GOCACHE=C:\Users\mhd\AppData\Local\go-build<br>set GOENV=C:\Users\mhd\AppData\Roaming\go\env<br>set GOEXE=.exe<br>set GOEXPERIMENT=<br>set GOFLAGS=<br>set GOHOSTARCH=amd64<br>set GOHOSTOS=windows<br>set GOINSECURE=<br>set GOMODCACHE=D:\go-work\go\library\pkg\mod<br>set GONOPROXY=<br>set GONOSUMDB=<br>set GOOS=windows<br>set GOPATH=D:\go-work\go\library;D:\go-work\go\workspace<br>set GOPRIVATE=<br>set GOPROXY=https://goproxy.cn,direct<br>set GOROOT=D:\go-sdk\go1.23.12.windows-amd64\go<br>set GOSUMDB=off<br>set GOTMPDIR=<br>set GOTOOLCHAIN=auto<br>set GOTOOLDIR=D:\go-sdk\go1.23.12.windows-amd64\go\pkg\tool\windows_amd64<br>set GOVCS=<br>set GOVERSION=go1.23.12<br>set GODEBUG=<br>set GOTELEMETRY=local<br>set GOTELEMETRYDIR=C:\Users\mhd\AppData\Roaming\go\telemetry<br>set GCCGO=gccgo<br>set GOAMD64=v1<br>set AR=ar<br>set CC=gcc<br>set CXX=g++<br>set CGO_ENABLED=0<br>set GOMOD=NUL<br>set GOWORK=<br>set CGO_CFLAGS=-O2 -g<br>set CGO_CPPFLAGS=<br>set CGO_CXXFLAGS=-O2 -g<br>set CGO_FFLAGS=-O2 -g<br>set CGO_LDFLAGS=-O2 -g<br>set PKG_CONFIG=pkg-config<br>set GOGCCFLAGS=-m64 -fno-caret-diagnostics -Qunused-arguments -Wl,--no-gc-sectio<br>ns -fmessage-length=0 -ffile-prefix-map=C:\Users\mhd\AppData\Local\Temp\go-build<br>3401154908=/tmp/go-build -gno-record-gcc-switches<br><br></code></pre></td></tr></table></figure><h4 id="é…ç½®-GO111MODULEã€GOPROXYã€GOSUMDB"><a href="#é…ç½®-GO111MODULEã€GOPROXYã€GOSUMDB" class="headerlink" title="é…ç½® GO111MODULEã€GOPROXYã€GOSUMDB"></a>é…ç½® GO111MODULEã€GOPROXYã€GOSUMDB</h4><blockquote><p>Goé»˜è®¤çš„GOPROXYçš„å€¼æ˜¯ï¼šGOPROXY&#x3D;<a href="https://proxy.golang.org,direct.è¿™ä¸ªgoproxyåœ¨ä½¿ç”¨go/">https://proxy.golang.org,directã€‚è¿™ä¸ªgoproxyåœ¨ä½¿ç”¨go</a> getå®‰è£…ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œå¯¼è‡´æ— æ³•ä¸‹è½½æˆåŠŸï¼Œæ‰€ä»¥å¿…é¡»è¦ä¿®æ”¹ä¸€ä¸‹ã€‚</p><p>æ¯”å¦‚æ”¹ä¸ºï¼š<a href="https://goproxy.io,direct/">https://goproxy.io,direct</a> ï¼ˆä¸ƒç‰›é•œåƒï¼‰æˆ– <a href="https://mirrors.aliyun.com/goproxy%EF%BC%88%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%EF%BC%89">https://mirrors.aliyun.com/goproxyï¼ˆé˜¿é‡Œäº‘é•œåƒï¼‰</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#å¼€å¯modæ¨¡å¼ï¼ˆé¡¹ç›®ç®¡ç†éœ€è¦ç”¨åˆ°ï¼‰</span><br>go <span class="hljs-built_in">env</span> -w GO111MODULE=on<br><span class="hljs-comment">#é‡æ–°è®¾ç½®æˆä¸ƒç‰›é•œåƒæºï¼ˆæ¨èï¼‰æˆ–é˜¿é‡Œé•œåƒæºï¼ˆç”¨åŸæœ‰çš„ä¼šæ¯”è¾ƒæ…¢ï¼‰</span><br>go <span class="hljs-built_in">env</span> -w GOPROXY=https://goproxy.cn,direct<br>go <span class="hljs-built_in">env</span> -w GOPROXY=https://mirrors.aliyun.com/goproxy<br><br><span class="hljs-comment">#å…³é—­åŒ…çš„MD5æ ¡éªŒ</span><br>go <span class="hljs-built_in">env</span> -w GOSUMDB=off<br><br><span class="hljs-comment">#æŸ¥çœ‹ç¯å¢ƒå˜é‡</span><br>go <span class="hljs-built_in">env</span><br><br>...<br></code></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹é…ç½®çš„ç¯å¢ƒå˜é‡"><a href="#æŸ¥çœ‹é…ç½®çš„ç¯å¢ƒå˜é‡" class="headerlink" title="æŸ¥çœ‹é…ç½®çš„ç¯å¢ƒå˜é‡"></a>æŸ¥çœ‹é…ç½®çš„ç¯å¢ƒå˜é‡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> %GOPATH%<br><span class="hljs-built_in">echo</span> %GOROOT%<br></code></pre></td></tr></table></figure><p><strong>è‡³æ­¤,é…ç½®å®ŒæˆğŸ‰</strong></p><h4 id="windowå¤šç‰ˆæœ¬golangé…ç½®"><a href="#windowå¤šç‰ˆæœ¬golangé…ç½®" class="headerlink" title="windowå¤šç‰ˆæœ¬golangé…ç½®"></a>windowå¤šç‰ˆæœ¬golangé…ç½®</h4><p>åªéœ€è¦åœ¨<code>goland</code> -&gt; GO-&gt; GOROOT é€‰æ‹©ä¸åŒçš„goè§£é‡Šå™¨è·¯å¾„å³å¯</p><h2 id="java-è§£é‡Šå™¨é…ç½®"><a href="#java-è§£é‡Šå™¨é…ç½®" class="headerlink" title="java è§£é‡Šå™¨é…ç½®"></a>java è§£é‡Šå™¨é…ç½®</h2><h3 id="1ã€æ£€æŸ¥æœ¬åœ°æ˜¯å¦é…ç½®java-jdkç¯å¢ƒ"><a href="#1ã€æ£€æŸ¥æœ¬åœ°æ˜¯å¦é…ç½®java-jdkç¯å¢ƒ" class="headerlink" title="1ã€æ£€æŸ¥æœ¬åœ°æ˜¯å¦é…ç½®java jdkç¯å¢ƒ"></a>1ã€æ£€æŸ¥æœ¬åœ°æ˜¯å¦é…ç½®java jdkç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">java -version  # æŸ¥çœ‹ JDK ç‰ˆæœ¬ï¼ˆåº”è¾“å‡º &quot;jdk 11.x.x&quot;ï¼‰<br>javac -version  # æŸ¥çœ‹ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼ˆåº”è¾“å‡º &quot;javac 11.x.x&quot;ï¼‰<br></code></pre></td></tr></table></figure><p>ä¸å­˜åœ¨åˆ™é…ç½®ç¯å¢ƒå˜é‡</p><h3 id="2ã€ä¸‹è½½jdk11ç‰ˆæœ¬"><a href="#2ã€ä¸‹è½½jdk11ç‰ˆæœ¬" class="headerlink" title="2ã€ä¸‹è½½jdk11ç‰ˆæœ¬"></a>2ã€ä¸‹è½½jdk11ç‰ˆæœ¬</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">é€šè¿‡é•œåƒç«™ä¸‹è½½ <br>https://repo.huaweicloud.com/java/jdk/11.0.2+9/<br></code></pre></td></tr></table></figure><h3 id="3ã€windowç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®"><a href="#3ã€windowç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®" class="headerlink" title="3ã€windowç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®"></a>3ã€windowç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®</h3><h4 id="æ­¥éª¤-1ï¼šæ‰“å¼€ç¯å¢ƒå˜é‡è®¾ç½®ç•Œé¢"><a href="#æ­¥éª¤-1ï¼šæ‰“å¼€ç¯å¢ƒå˜é‡è®¾ç½®ç•Œé¢" class="headerlink" title="æ­¥éª¤ 1ï¼šæ‰“å¼€ç¯å¢ƒå˜é‡è®¾ç½®ç•Œé¢"></a>æ­¥éª¤ 1ï¼šæ‰“å¼€ç¯å¢ƒå˜é‡è®¾ç½®ç•Œé¢</h4><ul><li><strong>Windows 11&#x2F;10</strong>ï¼šå³é”®ã€Œæ­¤ç”µè„‘ã€â†’ é€‰æ‹©ã€Œå±æ€§ã€â†’ ç‚¹å‡»å·¦ä¾§ã€Œé«˜çº§ç³»ç»Ÿè®¾ç½®ã€â†’ ç‚¹å‡»å³ä¸‹è§’ã€Œç¯å¢ƒå˜é‡ã€ã€‚</li></ul><h4 id="æ­¥éª¤-2ï¼šè®¾ç½®-JAVA-HOMEï¼ˆå¿…é€‰ï¼‰"><a href="#æ­¥éª¤-2ï¼šè®¾ç½®-JAVA-HOMEï¼ˆå¿…é€‰ï¼‰" class="headerlink" title="æ­¥éª¤ 2ï¼šè®¾ç½®Â JAVA_HOMEï¼ˆå¿…é€‰ï¼‰"></a>æ­¥éª¤ 2ï¼šè®¾ç½®Â <code>JAVA_HOME</code>ï¼ˆå¿…é€‰ï¼‰</h4><ol><li>åœ¨ã€Œç³»ç»Ÿå˜é‡ã€åŒºåŸŸç‚¹å‡»ã€Œæ–°å»ºã€ã€‚</li><li>å˜é‡åï¼š<code>JAVA_HOME</code>ï¼ˆä¸¥æ ¼åŒºåˆ†å¤§å°å†™ï¼‰ã€‚</li><li>å˜é‡å€¼ï¼šJDK çš„å®‰è£…ç›®å½•ï¼ˆå¦‚Â <code>C:\Program Files\Java\jdk-11.0.20</code>ï¼Œéœ€æ ¹æ®å®é™…å®‰è£…è·¯å¾„è°ƒæ•´ï¼‰ã€‚<ul><li>éªŒè¯ï¼šç¡®ä¿è·¯å¾„æœ«å°¾æ˜¯Â <code>jdk-11.x.x</code>ï¼ˆéÂ <code>jre</code>Â ç›®å½•ï¼‰ï¼Œä¸”åŒ…å«Â <code>bin</code>ã€<code>lib</code>Â å­ç›®å½•ã€‚</li></ul></li></ol><h4 id="æ­¥éª¤-3ï¼šè®¾ç½®-Pathï¼ˆå¿…é€‰ï¼‰"><a href="#æ­¥éª¤-3ï¼šè®¾ç½®-Pathï¼ˆå¿…é€‰ï¼‰" class="headerlink" title="æ­¥éª¤ 3ï¼šè®¾ç½®Â Pathï¼ˆå¿…é€‰ï¼‰"></a>æ­¥éª¤ 3ï¼šè®¾ç½®Â <code>Path</code>ï¼ˆå¿…é€‰ï¼‰</h4><ol><li>åœ¨ã€Œç³»ç»Ÿå˜é‡ã€ä¸­æ‰¾åˆ°Â <code>Path</code>Â å˜é‡ï¼ŒåŒå‡»æ‰“å¼€ç¼–è¾‘ç•Œé¢ã€‚</li><li>ç‚¹å‡»ã€Œæ–°å»ºã€ï¼Œæ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªè·¯å¾„ï¼ˆæŒ‰é¡ºåºï¼‰ï¼š<ul><li><code>%JAVA_HOME%\bin</code>ï¼ˆJDK å‘½ä»¤å·¥å…·è·¯å¾„ï¼Œå¦‚Â <code>java</code>ã€<code>javac</code>ï¼‰ã€‚</li><li><code>%JAVA_HOME%\jre\bin</code>ï¼ˆå¯é€‰ï¼Œè‹¥éœ€å…¼å®¹æ—§ç‰ˆ JRE ç›¸å…³å·¥å…·ï¼‰ã€‚</li><li>æ³¨æ„ï¼šWindows 10&#x2F;11 æ”¯æŒç›´æ¥è¾“å…¥å˜é‡åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§£æä¸ºÂ <code>C:\Program Files\Java\jdk-11.0.20\bin</code>ã€‚</li></ul></li></ol><h4 id="æ­¥éª¤-4ï¼šè®¾ç½®-CLASSPATHï¼ˆå¯é€‰ï¼Œä»…æ—§é¡¹ç›®éœ€è¦ï¼‰"><a href="#æ­¥éª¤-4ï¼šè®¾ç½®-CLASSPATHï¼ˆå¯é€‰ï¼Œä»…æ—§é¡¹ç›®éœ€è¦ï¼‰" class="headerlink" title="æ­¥éª¤ 4ï¼šè®¾ç½®Â CLASSPATHï¼ˆå¯é€‰ï¼Œä»…æ—§é¡¹ç›®éœ€è¦ï¼‰"></a>æ­¥éª¤ 4ï¼šè®¾ç½®Â <code>CLASSPATH</code>ï¼ˆå¯é€‰ï¼Œä»…æ—§é¡¹ç›®éœ€è¦ï¼‰</h4><ol><li><p>åœ¨ã€Œç³»ç»Ÿå˜é‡ã€ä¸­ç‚¹å‡»ã€Œæ–°å»ºã€ï¼ˆè‹¥ä¸å­˜åœ¨åˆ™æ–°å»ºï¼‰ã€‚</p></li><li><p>å˜é‡åï¼š<code>CLASSPATH</code>ã€‚</p></li><li><p>å˜é‡å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">.;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar<br></code></pre></td></tr></table></figure></li></ol><ul><li>è¯´æ˜ï¼š<code>.</code>Â è¡¨ç¤ºå½“å‰ç›®å½•ï¼ˆè¿è¡Œç±»æ–‡ä»¶æ—¶éœ€ä¾èµ–ï¼‰ï¼Œ<code>dt.jar</code>Â å’ŒÂ <code>tools.jar</code>Â æ˜¯ JDK æ ¸å¿ƒåº“ï¼ˆæ—§ç‰ˆé¡¹ç›®å¯èƒ½éœ€è¦ï¼‰ã€‚</li></ul><h3 id="4ã€éªŒè¯æ˜¯å¦é…ç½®æˆåŠŸ"><a href="#4ã€éªŒè¯æ˜¯å¦é…ç½®æˆåŠŸ" class="headerlink" title="4ã€éªŒè¯æ˜¯å¦é…ç½®æˆåŠŸ"></a>4ã€éªŒè¯æ˜¯å¦é…ç½®æˆåŠŸ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">java -version  # æŸ¥çœ‹ JDK ç‰ˆæœ¬ï¼ˆåº”è¾“å‡º &quot;jdk 11.x.x&quot;ï¼‰<br>javac -version  # æŸ¥çœ‹ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼ˆåº”è¾“å‡º &quot;javac 11.x.x&quot;ï¼‰<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>window</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginxé›†æˆkeycloak</title>
    <link href="/2025/09/25/%E7%B3%BB%E7%BB%9F/nginx%20%E6%8E%A5%E5%85%A5keycloak%20sso%E5%B9%B3%E5%8F%B0/"/>
    <url>/2025/09/25/%E7%B3%BB%E7%BB%9F/nginx%20%E6%8E%A5%E5%85%A5keycloak%20sso%E5%B9%B3%E5%8F%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="nginx-æ¥å…¥keycloak-ssoå¹³å°"><a href="#nginx-æ¥å…¥keycloak-ssoå¹³å°" class="headerlink" title="nginx æ¥å…¥keycloak ssoå¹³å°"></a>nginx æ¥å…¥keycloak ssoå¹³å°</h1><blockquote><p>èƒŒæ™¯</p></blockquote><p>æœ‰è®¸å¤šç”¨äºéªŒè¯ API è°ƒç”¨çš„é€‰é¡¹ï¼Œä½†æ˜¯ï¼ŒOAuth 2.0 èº«ä»½éªŒè¯æœºåˆ¶æ˜¯ä¸»è¦ä½¿ç”¨çš„ä¸€ç§ã€‚åœ¨è¿™é‡Œï¼ŒOAuth 2.0 è®¿é—®ä»¤ç‰Œæ˜¯ä»å®¢æˆ·ç«¯ä¼ é€’åˆ° API æœåŠ¡å™¨çš„èº«ä»½éªŒè¯å‡­æ®ï¼Œé€šå¸¸ä½œä¸º HTTP æ ‡å¤´æºå¸¦ã€‚</p><p>Keycloakæ”¯æŒOIDCï¼ˆOAuth 2.0çš„æ‰©å±•ï¼‰ï¼Œå¹¶åœ¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯æ—¶å……å½“IdPã€‚</p><p>ä½¿ç”¨ IdP éªŒè¯è®¿é—®ä»¤ç‰Œçš„æ ‡å‡†æ–¹æ³•ç§°ä¸º<em>ä»¤ç‰Œè‡ªæ£€</em>ã€‚Nginx å……å½“ OAuth 2.0 <a href="https://en.wikipedia.org/wiki/Relying_party">ä¿¡èµ–æ–¹</a>ï¼Œå°†è®¿é—®ä»¤ç‰Œå‘é€åˆ° IdP è¿›è¡ŒéªŒè¯ï¼Œå³ä»¤ç‰Œè‡ªæ£€ï¼Œå¹¶ä¸”ä»…ä»£ç†é€šè¿‡éªŒè¯è¿‡ç¨‹çš„è¯·æ±‚ ã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦åœ¨Nginxæ‰§è¡Œä»¤ç‰ŒéªŒè¯"><a href="#ä¸ºä»€ä¹ˆè¦åœ¨Nginxæ‰§è¡Œä»¤ç‰ŒéªŒè¯" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åœ¨Nginxæ‰§è¡Œä»¤ç‰ŒéªŒè¯"></a>ä¸ºä»€ä¹ˆè¦åœ¨Nginxæ‰§è¡Œä»¤ç‰ŒéªŒè¯</h2><p>åœ¨æ¯ä¸ªåç«¯æœåŠ¡æˆ–åº”ç”¨ç¨‹åºä¸Šæ‰§è¡ŒéªŒè¯ä¼šå¯¼è‡´å¤§é‡é‡å¤ä»£ç å’Œä¸å¿…è¦çš„å¤„ç†ã€‚éœ€è¦è€ƒè™‘å„ç§é”™è¯¯æ¡ä»¶å’Œè¾¹ç¼˜æƒ…å†µï¼Œåœ¨æ¯ä¸ªåç«¯æœåŠ¡ä¸­è¿™æ ·åšä¼šå¯¼è‡´å®ç°ä¸ä¸€è‡´ï¼Œä»è€Œå¯¼è‡´ä¸å¯é¢„æµ‹çš„ç”¨æˆ·ä½“éªŒã€‚</p><p>ä¸ºäº†é¿å…ä»£ç é‡å¤å’Œç”±æ­¤äº§ç”Ÿçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Nginx ä»£è¡¨åç«¯æœåŠ¡éªŒè¯è®¿é—®ä»¤ç‰Œã€‚</p><h2 id="è‡ªå®šä¹‰Nginx"><a href="#è‡ªå®šä¹‰Nginx" class="headerlink" title="è‡ªå®šä¹‰Nginx"></a>è‡ªå®šä¹‰Nginx</h2><p>è¦å°† Nginx ä¸ Keycloak é›†æˆï¼Œæˆ‘ä»¬éœ€è¦ Lua ä¾èµ–ã€‚æˆ‘ä»¬æ²¡æœ‰å‘Nginxæ·»åŠ ä¾èµ–é¡¹ï¼Œè€Œæ˜¯ä½¿ç”¨Openrestyï¼Œè¿™æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨Nginxä¹‹ä¸Šçš„WebæœåŠ¡å™¨ã€‚</p><p>ä»¥ä¸‹æ˜¯ç”¨äºæ„å»º Nginx æ˜ åƒæ‰€éœ€çš„å†…å®¹ã€‚<code>Dockerfile</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">FROM openresty/openresty:alpine-fat<br> <br>RUN <span class="hljs-built_in">mkdir</span> /var/log/nginx<br> <br>RUN apk add --no-cache openssl-dev<br>RUN apk add --no-cache git<br>RUN apk add --no-cache gcc<br>RUN luarocks install lua-resty-openidc<br> <br>ENTRYPOINT [<span class="hljs-string">&quot;/usr/local/openresty/nginx/sbin/nginx&quot;</span>, <span class="hljs-string">&quot;-g&quot;</span>, <span class="hljs-string">&quot;daemon off;&quot;</span>]<br>EXPOSE 80<br></code></pre></td></tr></table></figure><p>åœ¨ä¸‹é¢çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¿æŠ¤äº†ä¸¤ä¸ªåç«¯åº”ç”¨ç¨‹åºã€‚<code>nginx.conf</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs json">  server <span class="hljs-punctuation">&#123;</span><br>       listen   <span class="hljs-number">8888</span> ssl;<br>       root     /opt/nginx/html;<br>       #ssl on;<br>       ssl_certificate /etc/nginx/certs/cert.pem;<br>       ssl_certificate_key /etc/nginx/certs/key.pem;<br>       access_by_lua &#x27;<br>         local opts = <span class="hljs-punctuation">&#123;</span><br>           redirect_uri_path = <span class="hljs-string">&quot;/redirect_uri&quot;</span><span class="hljs-punctuation">,</span><br>           accept_none_alg = <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>           discovery = <span class="hljs-string">&quot;http://192.168.0.179:3333/auth/realms/test/.well-known/openid-configuration&quot;</span><span class="hljs-punctuation">,</span><br>           client_id = <span class="hljs-string">&quot;nginx&quot;</span><span class="hljs-punctuation">,</span><br>           client_secret = <span class="hljs-string">&quot;j6KPHwwNW5l5wGVrMFeIEkyZzj6Fh56I&quot;</span><span class="hljs-punctuation">,</span><br>           redirect_uri_scheme = <span class="hljs-string">&quot;https&quot;</span><span class="hljs-punctuation">,</span>  #é‡å®šå‘åè®®<br>           logout_path = <span class="hljs-string">&quot;/logout&quot;</span><span class="hljs-punctuation">,</span><br>           redirect_after_logout_uri = <span class="hljs-string">&quot;http://192.168.0.135:3333/auth/realms/test/protocol/openid-connect/logout&quot;</span><span class="hljs-punctuation">,</span><br>           redirect_after_logout_with_id_token_hint = <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>           session_contents = <span class="hljs-punctuation">&#123;</span>id_token=<span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">&#125;</span><br>         <span class="hljs-punctuation">&#125;</span><br>         -- call introspect for OAuth <span class="hljs-number">2.0</span> Bearer Access Token validation<br>         local res<span class="hljs-punctuation">,</span> err = require(<span class="hljs-string">&quot;resty.openidc&quot;</span>).authenticate(opts)<br>         if err then<br>           ngx.status = <span class="hljs-number">403</span><br>           ngx.say(err)<br>           ngx.exit(ngx.HTTP_FORBIDDEN)<br>         end<br>      &#x27;;<br> <br>      # I disabled caching so the browser won&#x27;t cache the site.<br>      expires           <span class="hljs-number">0</span>;<br>      add_header        Cache-Control private;<br>      <br>      location / <span class="hljs-punctuation">&#123;</span><br>          proxy_pass    https<span class="hljs-punctuation">:</span><span class="hljs-comment">//nginx-proxy;# nginxè½¬å‘çš„åœ°å€</span><br>          proxy_set_header    X-Forwarded-For         $remote_addr;<br>          proxy_set_header Host arkime.malcolm.local;<br>          #proxy_set_header http_auth_http_user $authenticated_user;<br>          proxy_set_header Authorization <span class="hljs-string">&quot;&quot;</span>;<br>      <span class="hljs-punctuation">&#125;</span><br>      <br>      # redirect server error pages to the static page /<span class="hljs-number">40</span>x.html<br>      #<br>      error_page <span class="hljs-number">404</span> /<span class="hljs-number">404.</span>html;<br>          location = /<span class="hljs-number">40</span>x.html <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-punctuation">&#125;</span><br> <br>      # redirect server error pages to the static page /<span class="hljs-number">50</span>x.html<br>      #<br>      error_page <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> /<span class="hljs-number">50</span>x.html;<br>          location = /<span class="hljs-number">50</span>x.html <span class="hljs-punctuation">&#123;</span><br>            root /usr/share/nginx/html;<br>      <span class="hljs-punctuation">&#125;</span><br><br>      <br><span class="hljs-punctuation">&#125;</span><br><br>server <span class="hljs-punctuation">&#123;</span><br>       listen   <span class="hljs-number">8889</span> ;<br>       root     /opt/nginx/html;<br>       #ssl on;<br>       ssl_certificate /etc/nginx/certs/cert.pem;<br>       ssl_certificate_key /etc/nginx/certs/key.pem;<br>       access_by_lua &#x27;<br>         local opts = <span class="hljs-punctuation">&#123;</span><br>           redirect_uri_path = <span class="hljs-string">&quot;/redirect_uri&quot;</span><span class="hljs-punctuation">,</span><br>           accept_none_alg = <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>           discovery = <span class="hljs-string">&quot;http://192.168.0.179:3333/auth/realms/test/.well-known/openid-configuration&quot;</span><span class="hljs-punctuation">,</span><br>           client_id = <span class="hljs-string">&quot;nginx&quot;</span><span class="hljs-punctuation">,</span><br>           client_secret = <span class="hljs-string">&quot;j6KPHwwNW5l5wGVrMFeIEkyZzj6Fh56I&quot;</span><span class="hljs-punctuation">,</span><br>           redirect_uri_scheme = <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>           logout_path = <span class="hljs-string">&quot;/logout&quot;</span><span class="hljs-punctuation">,</span><br>           redirect_after_logout_uri = <span class="hljs-string">&quot;http://192.168.0.135:3333/auth/realms/test/protocol/openid-connect/logout&quot;</span><span class="hljs-punctuation">,</span><br>           redirect_after_logout_with_id_token_hint = <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>           session_contents = <span class="hljs-punctuation">&#123;</span>id_token=<span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">&#125;</span><br>         <span class="hljs-punctuation">&#125;</span><br>         -- call introspect for OAuth <span class="hljs-number">2.0</span> Bearer Access Token validation<br>         local res<span class="hljs-punctuation">,</span> err = require(<span class="hljs-string">&quot;resty.openidc&quot;</span>).authenticate(opts)<br>         if err then<br>           ngx.status = <span class="hljs-number">403</span><br>           ngx.say(err)<br>           ngx.exit(ngx.HTTP_FORBIDDEN)<br>         end<br>      &#x27;;<br> <br>      # I disabled caching so the browser won&#x27;t cache the site.<br>      expires           <span class="hljs-number">0</span>;<br>      add_header        Cache-Control private;<br>      <br>      location / <span class="hljs-punctuation">&#123;</span><br>          proxy_pass    https<span class="hljs-punctuation">:</span><span class="hljs-comment">//nginx-proxy;    # nginxè½¬å‘çš„åœ°å€</span><br>          proxy_set_header    X-Forwarded-For         $remote_addr;<br>          proxy_set_header Host arkime.malcolm.local;<br>          #proxy_set_header http_auth_http_user $authenticated_user;<br>          proxy_set_header Authorization <span class="hljs-string">&quot;&quot;</span>;<br>      <span class="hljs-punctuation">&#125;</span><br>      <br>      # redirect server error pages to the static page /<span class="hljs-number">40</span>x.html<br>      #<br>      error_page <span class="hljs-number">404</span> /<span class="hljs-number">404.</span>html;<br>          location = /<span class="hljs-number">40</span>x.html <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-punctuation">&#125;</span><br> <br>      # redirect server error pages to the static page /<span class="hljs-number">50</span>x.html<br>      #<br>      error_page <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> /<span class="hljs-number">50</span>x.html;<br>          location = /<span class="hljs-number">50</span>x.html <span class="hljs-punctuation">&#123;</span><br>            root /usr/share/nginx/html;<br>      <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="Keycloak"><a href="#Keycloak" class="headerlink" title="Keycloak"></a>Keycloak</h2><p>åœ¨å¯åŠ¨ Docker å®¹å™¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—® Keycloak ç®¡ç†é—¨æˆ·ï¼Œç½‘å€ä¸º ã€‚ç™»å½•åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°é¢†åŸŸä»¥æ·»åŠ å®¢æˆ·ç«¯ã€‚<code>http://localhost:3333``myrealm</code></p><p>åˆ›å»ºå®¢æˆ·ç«¯ <code>nginx</code>  æˆ‘ä»¬éœ€è¦å°†é€‰é¡¹å¡ä¸­çš„å¯†é’¥æ·»åŠ åˆ° Nginx é…ç½®æ–‡ä»¶ä¸­ã€‚<code>Credentials</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Access Type :</span> <span class="hljs-string">confidential</span><br><span class="hljs-attr">Valid Redirect URIs:</span> <span class="hljs-string">*</span> <span class="hljs-comment"># é‡å®šå‘åŒ¹é…æ‰€æœ‰</span><br><span class="hljs-string">Web</span> <span class="hljs-string">Originsï¼š*</span> <span class="hljs-comment"># é‡å®šå‘åŒ¹é…æ‰€æœ‰</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºå®¢æˆ·ç«¯ç”¨æˆ·å¯†ç ï¼ˆç”¨æˆ·å¯†ç è·Ÿéšé¢†åŸŸï¼‰</p><p>è®¾ç½®å¯†ç </p><h2 id="ä½¿ç”¨docker-composeéƒ¨ç½²ç¯å¢ƒ"><a href="#ä½¿ç”¨docker-composeéƒ¨ç½²ç¯å¢ƒ" class="headerlink" title="ä½¿ç”¨docker-composeéƒ¨ç½²ç¯å¢ƒ"></a>ä½¿ç”¨docker-composeéƒ¨ç½²ç¯å¢ƒ</h2><p>æˆ‘ä»¬ä½¿ç”¨ Postgres ä½œä¸º keycloak çš„åç«¯æ•°æ®åº“æ¥å­˜å‚¨å®¢æˆ·ç«¯è®¾ç½®ã€‚Nginx å®¹å™¨ç”¨äºè¡¨ç¤ºæ¼”ç¤ºåº”ç”¨ç¨‹åºï¼Œä»¥åŠ .<code>app_1``app_2</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs xml">version: &#x27;3.7&#x27;<br>x-tz-variables: &amp;tz-variables<br>  TZ : &#x27;Asia/Shanghai&#x27;<br>networks:<br>    mynetwork:<br>        name: mynetwork<br> <br>volumes:<br>    postgres_data:<br>    <br>services:<br>  postgres:<br>    image: postgres<br>    container_name: postgres<br>    volumes:<br>      - postgres_data:/var/lib/postgresql/data<br>      - ./keycloak_nginx/keycloak.sql:/docker-entrypoint-initdb.d/keycloak.sql:rw<br>    environment: <br>      POSTGRES_DB: keycloak<br>      POSTGRES_USER: keycloak<br>      POSTGRES_PASSWORD: keycloak<br>    ports:<br>      - 5433:5432<br>    networks: <br>      - default<br>  keycloak:<br>    image: super/keycloak:16.1.1<br>    container_name: keycloak<br>    environment:<br>      DB_VENDOR: POSTGRES<br>      DB_ADDR: postgres<br>      DB_DATABSE: keycloak<br>      DB_USER: keycloak<br>      DB_SCHEMA: public<br>      DB_PASSWORD: keycloak<br>      KEYCLOAK_USER: admin<br>      KEYCLOAK_PASSWORD: keycloak            <br>    ports:<br>      - 3333:8080<br>    depends_on:<br>      - postgres<br>    networks:<br>      - default<br>  keycloak_nginx:<br>    build:<br>      context: ./keycloak_nginx<br>      dockerfile: nginx.dockerfile<br>    image: nginx:keycloak<br>    container_name: keycloak_nginx<br>    #environment:<br>    #  KEYCLOAK_IP: 192.168.0.71<br>    ports:<br>      - 8888:8888 <br>      - 8889:8889           <br>    networks:<br>      - default<br>    volumes: <br>      - ./keycloak_nginx/nginx.conf:/etc/nginx/conf.d/default.conf<br>      - ./keycloak_nginx/certs:/etc/nginx/certs<br></code></pre></td></tr></table></figure><p>ä¸€æ—¦ä¸€åˆ‡å¯åŠ¨å¹¶è¿è¡Œï¼Œä»»ä½•è®¿é—®ç«¯å£ä¸Šçš„åº”ç”¨ç¨‹åºçš„å°è¯•éƒ½åº”è¯¥å—åˆ°ä¿æŠ¤ï¼Œç”¨æˆ·å°†è¢«Keycloaké‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚æˆåŠŸç™»å½•åï¼Œç”¨æˆ·å°†èƒ½å¤Ÿè®¿é—®è¯·æ±‚çš„èµ„æº</p><blockquote><p>æ­¤å¤„nginxé…ç½®äº†http\https æ¨¡å¼ï¼Œå› iframe å†…åµŒç½‘é¡µæ— æ³•éªŒè¯ä¿¡ä»»sslè¯ä¹¦ ï¼Œä½¿ç”¨nginxå……å½“httpåå‘ä»£ç†</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¼–è¯‘</title>
    <link href="/2025/09/25/go/Golang%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/"/>
    <url>/2025/09/25/go/Golang%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/</url>
    
    <content type="html"><![CDATA[<h1 id="Golangäº¤å‰ç¼–è¯‘"><a href="#Golangäº¤å‰ç¼–è¯‘" class="headerlink" title="Golangäº¤å‰ç¼–è¯‘"></a>Golangäº¤å‰ç¼–è¯‘</h1><p><strong>çŸ¥è¯†ç‚¹</strong></p><ul><li>è·¨å¹³å°ç¼–è¯‘</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">CGO_ENABLED=0 GOOS=ç³»ç»Ÿ go build -a -installsuffix cgo -o go-gin-example .</span><br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€CGO-ENABLED"><a href="#ä¸€ã€CGO-ENABLED" class="headerlink" title="ä¸€ã€CGO_ENABLED"></a>ä¸€ã€CGO_ENABLED</h2><p><strong>ä½œç”¨</strong></p><p>ç”¨äºæ ‡è¯†ï¼ˆå£°æ˜ï¼‰ cgoå·¥å…·æ˜¯å¦å¯ç”¨</p><p><strong>æ„ä¹‰</strong></p><p>å­˜åœ¨äº¤å‰ç¼–è¯‘çš„æƒ…å†µä¸‹ï¼Œcgoå·¥å…·æ˜¯ä¸å¯ç”¨çš„ã€‚åœ¨æ ‡å‡†goå‘½ä»¤çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œäº¤å‰ç¼–è¯‘æ„å‘³ç€ç¨‹åºæ„å»ºç¯å¢ƒä¸­çš„ç›®æ ‡è®¡ç®—æ¶æ„çš„æ ‡è¯†ä¸ç¨‹åºè¿è¡Œç¯å¢ƒçš„ç›®æ ‡è®¾è®¡æ¶æ„çš„æ ‡è¯†ä¸åŒï¼Œæˆ–è€…ç¨‹åºæ„å»ºç¯å¢ƒçš„ç›®æ ‡æ“ä½œç³»ç»Ÿçš„æ ‡è¯†ä¸ç¨‹åºè¿è¡Œç¯å¢ƒçš„ç›®æ ‡æ“ä½œç³»ç»Ÿçš„æ ‡è¯†ä¸åŒ</p><p><strong>å°ç»“</strong></p><p>æˆ‘ä»¬åœ¨å®¿ä¸»æœºç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œåœ¨ <code>Scratch</code> é•œåƒè¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼›æ˜¾ç„¶ä¸¤è€…çš„è®¡ç®—æœºæ¶æ„ã€è¿è¡Œç¯å¢ƒæ ‡è¯†ä½ æ— æ³•ç¡®å®šå®ƒæ˜¯å¦ä¸€è‡´ï¼ˆæ¯•ç«Ÿæ„å»ºçš„ <code>docker</code> é•œåƒè¿˜å¯ä»¥ç»™ä»–äººä½¿ç”¨ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦è¿›è¡Œäº¤å‰ç¼–è¯‘ï¼Œè€Œäº¤å‰ç¼–è¯‘ä¸æ”¯æŒ <code>cgo</code>ï¼Œå› æ­¤è¿™é‡Œè¦ç¦ç”¨æ‰å®ƒ</p><p>å…³é—­ <code>cgo</code> åï¼Œåœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¼šå¿½ç•¥ <code>cgo</code> å¹¶é™æ€é“¾æ¥æ‰€æœ‰çš„ä¾èµ–åº“ï¼Œè€Œå¼€å¯ <code>cgo</code> åï¼Œæ–¹å¼å°†è½¬ä¸ºåŠ¨æ€é“¾æ¥</p><p><strong>è¡¥å……</strong></p><p><code>golang</code> æ˜¯é»˜è®¤å¼€å¯ <code>cgo</code> å·¥å…·çš„ï¼Œå¯æ‰§è¡Œ <code>go env</code> å‘½ä»¤æŸ¥çœ‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">super@super:~/GO_Work/gin_study/go-gin-example$ go env | grep CGO<br>GCCGO=&quot;gccgo&quot;<br>CGO_ENABLED=&quot;1&quot;<br>CGO_CFLAGS=&quot;-O2 -g&quot;<br>CGO_CPPFLAGS=&quot;&quot;<br>CGO_CXXFLAGS=&quot;-O2 -g&quot;<br>CGO_FFLAGS=&quot;-O2 -g&quot;<br>CGO_LDFLAGS=&quot;-O2 -g&quot;<br></code></pre></td></tr></table></figure><h2 id="äºŒã€GOOS"><a href="#äºŒã€GOOS" class="headerlink" title="äºŒã€GOOS"></a>äºŒã€GOOS</h2><p>ç”¨äºæ ‡è¯†ï¼ˆå£°æ˜ï¼‰ç¨‹åºæ„å»ºç¯å¢ƒä¸­çš„ç›®æ ‡æ“ä½œç³»ç»Ÿ</p><p>å¦‚ï¼š</p><ul><li>linux</li><li>window</li></ul><h2 id="ä¸‰ã€GOARCH"><a href="#ä¸‰ã€GOARCH" class="headerlink" title="ä¸‰ã€GOARCH"></a>ä¸‰ã€GOARCH</h2><p>ç”¨äºæ ‡è¯†(å£°æ˜)ç¨‹åºæ„å»ºç¯å¢ƒçš„ç›®æ ‡è®¡ç®—æ¶æ„</p><p>è‹¥ä¸è®¾ç½®ï¼Œé»˜è®¤å€¼ä¸ç¨‹åºè¿è¡Œç¯å¢ƒçš„ç›®æ ‡è®¡ç®—æ¶æ„ä¸€è‡´</p><p>å¦‚ï¼š</p><ul><li>amd64</li><li>386</li></ul><table><thead><tr><th>ç³»ç»Ÿ</th><th>GOOS</th><th>GOARCH</th></tr></thead><tbody><tr><td>Windows 32 ä½</td><td>windows</td><td>386</td></tr><tr><td>Windows 64 ä½</td><td>windows</td><td>amd64</td></tr><tr><td>OS X 32 ä½</td><td>darwin</td><td>386</td></tr><tr><td>OS X 64 ä½</td><td>darwin</td><td>amd64</td></tr><tr><td>Linux 32 ä½</td><td>linux</td><td>386</td></tr><tr><td>Linux 64 ä½</td><td>linux</td><td>amd64</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">GOOS=ç³»ç»Ÿ GOARCH=amd64 go build -o yourprogram<span class="hljs-comment"># ä¸ºlinuxç³»ç»Ÿç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶</span><br>GOOS=windows GOARCH=amd64 go build -o yourprogram.exe<span class="hljs-comment"># ä¸ºwindowç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶</span><br></code></pre></td></tr></table></figure><h2 id="å››ã€GOHOSTOS"><a href="#å››ã€GOHOSTOS" class="headerlink" title="å››ã€GOHOSTOS"></a>å››ã€GOHOSTOS</h2><p>ç”¨äºæ ‡è¯†ï¼ˆå£°æ˜ï¼‰ç¨‹åºè¿è¡Œç¯å¢ƒçš„ç›®æ ‡æ“ä½œç³»ç»Ÿ</p><h2 id="äº”ã€GOHOSTARCH"><a href="#äº”ã€GOHOSTARCH" class="headerlink" title="äº”ã€GOHOSTARCH"></a>äº”ã€GOHOSTARCH</h2><p>ç”¨äºæ ‡è¯†ï¼ˆå£°æ˜ï¼‰ç¨‹åºè¿è¡Œç¯å¢ƒçš„ç›®æ ‡è®¡ç®—æ¶æ„</p><h2 id="å…­ã€go-build"><a href="#å…­ã€go-build" class="headerlink" title="å…­ã€go build"></a>å…­ã€go build</h2><p><strong>-a</strong></p><p>å¼ºåˆ¶é‡æ–°ç¼–è¯‘ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸åˆ©ç”¨ç¼“å­˜æˆ–å·²ç¼–è¯‘å¥½çš„éƒ¨åˆ†æ–‡ä»¶ï¼Œç›´æ¥æ‰€æœ‰åŒ…éƒ½æ˜¯æœ€æ–°çš„ä»£ç é‡æ–°ç¼–è¯‘å’Œå…³è”</p><h4 id="installsuffix"><a href="#installsuffix" class="headerlink" title="-installsuffix"></a><strong>-installsuffix</strong></h4><p>ä½œç”¨ï¼š</p><p>åœ¨è½¯ä»¶åŒ…å®‰è£…çš„ç›®å½•ä¸­å¢åŠ åç¼€æ ‡è¯†ï¼Œä»¥ä¿æŒè¾“å‡ºä¸é»˜è®¤ç‰ˆæœ¬åˆ†å¼€</p><p><strong>è¡¥å……ï¼š</strong></p><p>å¦‚æœä½¿ç”¨ -race æ ‡è¯†ï¼Œåˆ™åç¼€å°±ä¼šé»˜è®¤è®¾ç½®ä¸º  -raceæ ‡è¯†ï¼Œç”¨äºåŒºåˆ†raceå’Œæ™®é€šçš„ç‰ˆæœ¬</p><p><strong>-o</strong></p><p>æŒ‡å®šç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶åç§°</p><h2 id="ä¸ƒ-Go-é™æ€ç¼–è¯‘æœºåˆ¶"><a href="#ä¸ƒ-Go-é™æ€ç¼–è¯‘æœºåˆ¶" class="headerlink" title="ä¸ƒ Go é™æ€ç¼–è¯‘æœºåˆ¶"></a>ä¸ƒ Go é™æ€ç¼–è¯‘æœºåˆ¶</h2><h3 id="GO-çš„å¯ç§»æ¤æ€§"><a href="#GO-çš„å¯ç§»æ¤æ€§" class="headerlink" title="GO çš„å¯ç§»æ¤æ€§"></a>GO çš„å¯ç§»æ¤æ€§</h3><p>Goè¯­è¨€çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶æä½³çš„å¯ç§»æ¤æ€§ã€‚å®ƒçš„æºä»£ç å¯ä»¥åœ¨ä»»ä½•å¹³å°ä¸Šç¼–è¯‘ï¼Œç”Ÿæˆçš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥åœ¨åŒç§ç±»å‹çš„æ“ä½œç³»ç»Ÿä¸‹è¿è¡Œï¼Œä¸åŒäºå¦‚Javaè¯¸å¦‚æ­¤ç±»éœ€è¦ç‰¹å®šè¿è¡Œç¯å¢ƒçš„è¯­è¨€ï¼ŒGoçš„äºŒè¿›åˆ©ç”¨äº†é™æ€é“¾æ¥ï¼Œä¸éœ€è¦ä»»ä½•å¤–éƒ¨ä¾èµ–å°±èƒ½è¿è¡Œã€‚</p><p>ä¸ºäº†å®ç°è¿™æ ·çš„å¯ç§»æ¤æ€§ï¼ŒGoæ ‡å‡†åº“ä¸ºå¸¸è§çš„æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶æ¶æ„æä¾›äº†ç¼–è¯‘æ”¯æŒã€‚è¿™æ„å‘³ç€åªéœ€æ”¹å˜ç¼–è¯‘é€‰é¡¹ï¼ŒGoä»£ç å°±å¯ä»¥è½»æ¾åœ°åœ¨Windowsã€Linuxã€macOSã€ARMã€AMD64ç­‰å¹³å°ä¸Šç¼–è¯‘å’Œè¿è¡Œã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å¯ä»¥ç¼–è¯‘ä¸€ä¸ªé€‚ç”¨äºLinuxçš„AMD64äºŒè¿›åˆ¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GOOS=ç³»ç»Ÿ GOARCH=amd64 go build -o app ./main.go<br></code></pre></td></tr></table></figure><h3 id="GO-çš„é™æ€é“¾æ¥"><a href="#GO-çš„é™æ€é“¾æ¥" class="headerlink" title="GO çš„é™æ€é“¾æ¥"></a>GO çš„é™æ€é“¾æ¥</h3><p>Goç¨‹åºçš„å¯ç§»æ¤æ€§å¤§éƒ¨åˆ†å½’åŠŸäºå…¶é™æ€é“¾æ¥çš„ç‰¹æ€§ã€‚é™æ€é“¾æ¥æ„å‘³ç€æ‰€æœ‰ç¨‹åºéœ€æ±‚çš„åº“éƒ½ä¼šè¢«åŒ…å«åœ¨ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚</p><p>ä¾‹å¦‚ï¼ŒGoå»é™¤äº†Cè¯­è¨€é‡Œå¸¸è§çš„ä¾èµ–äºglibcçš„åŠ¨æ€é“¾æ¥ï¼Œè€Œé€‰æ‹©ç›´æ¥ä¸æ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿè°ƒç”¨æ¥å£äº¤äº’ã€‚è¿™ä½¿å¾—Goç¨‹åºä¸ä»…åœ¨è¿è¡Œç¯å¢ƒçš„é€‰æ‹©ä¸Šæœ‰æ›´å¤§è‡ªç”±åº¦ï¼ŒåŒæ—¶ï¼Œé™æ€é“¾æ¥ä¹Ÿä½¿å¾—ç¨‹åºåœ¨é€Ÿåº¦ã€å®‰å…¨æ€§ç­‰æ–¹é¢æœ‰æ˜¾è‘—ä¼˜åŠ¿ã€‚</p><p>å¯¹é™æ€é“¾æ¥çš„ç†è§£å¯ä»¥ä»ä»¥ä¸‹å¸¸è§å‘½ä»¤å¼€å§‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">go build -ldflags=<span class="hljs-string">&quot;-s -w&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™æ¡æŒ‡ä»¤å±è”½äº†æ‰€æœ‰ç¬¦å·è¡¨å’Œè°ƒè¯•ä¿¡æ¯ï¼Œä½¿å¾—äºŒè¿›åˆ¶æ–‡ä»¶æ›´åŠ ç´§å‡‘ã€‚å¸¸è§é”™è¯¯ä¹‹ä¸€å°±æ˜¯å¿˜è®°åœ¨ç¼–è¯‘æ—¶æ·»åŠ è¿™ä¸ªé€‰é¡¹ï¼Œå¯¼è‡´äº§ç”Ÿçš„æ–‡ä»¶è¿‡å¤§ã€‚</p><h3 id="CGO-å½±å“å¯ç§»æ¤æ€§"><a href="#CGO-å½±å“å¯ç§»æ¤æ€§" class="headerlink" title="CGO å½±å“å¯ç§»æ¤æ€§"></a>CGO å½±å“å¯ç§»æ¤æ€§</h3><p>è™½ç„¶Goè¯­è¨€å¼ºå¤§å¹¶ä¸”ç®€æ´ï¼Œä½†ä¹Ÿå¹¶éä¸‡èƒ½ã€‚ä¸€äº›ç‰¹å®šçš„ä»»åŠ¡å¯èƒ½éœ€è¦è°ƒç”¨ç”±å…¶ä»–è¯­è¨€å†™çš„åº“ï¼Œå°¤å…¶æ˜¯Cè¯­è¨€ã€‚è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨cgoã€‚</p><p>ä½†æ˜¯cgoç»™Goå¸¦æ¥çš„é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œcgoä¼šç ´åGoåŸç”Ÿçš„é™æ€é“¾æ¥ï¼Œå¯¼è‡´ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¾èµ–äºCåº“ï¼Œå¹¶å¯¹ç‰¹å®šçš„ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿäº§ç”Ÿä¾èµ–ã€‚</p><p>å…³é—­cgoçš„ç¼–è¯‘å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">CGO_ENABLED=0 go build -ldflags=<span class="hljs-string">&quot;-s -w&quot;</span><br></code></pre></td></tr></table></figure><h3 id="çº¯é™æ€ç¼–è¯‘"><a href="#çº¯é™æ€ç¼–è¯‘" class="headerlink" title="çº¯é™æ€ç¼–è¯‘"></a>çº¯é™æ€ç¼–è¯‘</h3><p>Goç¨‹åºçš„çº¯é™æ€ç¼–è¯‘æ˜¯ä¿è¯å…¶æœ‰å¾ˆé«˜å¯ç§»æ¤æ€§çš„é‡è¦æ–¹å¼ã€‚çº¯é™æ€ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶æ²¡æœ‰ä»»ä½•åŠ¨æ€é“¾æ¥ä¾èµ–ï¼Œå¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸‹è¿è¡Œã€‚</p><p>çº¯é™æ€ç¼–è¯‘çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">CGO_ENABLED=0 GOOS=ç³»ç»Ÿ go build -a -ldflags <span class="hljs-string">&#x27;-extldflags &quot;-static&quot;&#x27;</span><br></code></pre></td></tr></table></figure><p>ç„¶è€Œçº¯é™æ€ç¼–è¯‘ä¹Ÿä¸æ˜¯å®Œç¾çš„ï¼Œä¸€äº›åŸºäºglibcçš„åŠŸèƒ½ï¼Œå¦‚DNSè§£æï¼Œå¯èƒ½ä¼šåœ¨é™æ€ç¼–è¯‘ä¸‹å¤±æ•ˆã€‚</p><p>æ€»ç»“è€Œè¨€ï¼ŒGoè¯­è¨€çš„å¯ç§»æ¤æ€§ï¼Œé™æ€é“¾æ¥ç­‰ç‰¹æ€§ä½¿å…¶åœ¨ç¼–è¯‘å¤æ‚ç¨‹åºæ—¶æœ‰ç€æ˜¾è‘—ä¼˜åŠ¿ã€‚ç„¶è€Œä½¿ç”¨cgoæ—¶éœ€è¦æ³¨æ„å¯èƒ½å¸¦æ¥çš„é—®é¢˜ï¼Œè€Œçº¯é™æ€ç¼–åˆ¶å¯èƒ½ä¼šå½±å“GoæŸäº›åŸºäºglibcåŠŸèƒ½çš„æ­£å¸¸ä½¿ç”¨ï¼Œè¿™éœ€è¦æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µåšé€‚å½“è°ƒæ•´ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>golang docker è¿œç¨‹ç¯å¢ƒè°ƒè¯•</title>
    <link href="/2025/09/25/go/goland%E8%BF%9E%E6%8E%A5docker%E8%BF%9B%E8%A1%8Cdebug/"/>
    <url>/2025/09/25/go/goland%E8%BF%9E%E6%8E%A5docker%E8%BF%9B%E8%A1%8Cdebug/</url>
    
    <content type="html"><![CDATA[<h1 id="golandè¿æ¥dockerè¿›è¡Œdebug"><a href="#golandè¿æ¥dockerè¿›è¡Œdebug" class="headerlink" title="golandè¿æ¥dockerè¿›è¡Œdebug"></a>golandè¿æ¥dockerè¿›è¡Œdebug</h1><h2 id="1-é’ˆå¯¹-golang-ç¨‹åºæ‰“æ–­ç‚¹æœ‰å“ªå‡ ç§æƒ…å†µ"><a href="#1-é’ˆå¯¹-golang-ç¨‹åºæ‰“æ–­ç‚¹æœ‰å“ªå‡ ç§æƒ…å†µ" class="headerlink" title="1 é’ˆå¯¹ golang ç¨‹åºæ‰“æ–­ç‚¹æœ‰å“ªå‡ ç§æƒ…å†µ"></a>1 é’ˆå¯¹ golang ç¨‹åºæ‰“<a href="https://so.csdn.net/so/search?q=%E6%96%AD%E7%82%B9&spm=1001.2101.3001.7020">æ–­ç‚¹</a>æœ‰å“ªå‡ ç§æƒ…å†µ</h2><ul><li><strong>ä¸´æ—¶è¿›ç¨‹</strong>ï¼šé’ˆå¯¹ä¸´æ—¶è¿è¡Œä¸€æ¬¡çš„ Golang è„šæœ¬ï¼Œæ¯”å¦‚å®šæ—¶ç»Ÿè®¡è„šæœ¬ï¼Œå®šæ—¶æ¨é€è„šæœ¬ã€‚</li><li><strong>å¸¸é©»è¿›ç¨‹</strong>ï¼šé’ˆå¯¹ä¸€ç›´åœ¨åå°è¿è¡Œçš„ Golang ç¨‹åºï¼Œæ¯”å¦‚ HTTP æˆ–è€… GRPC æœåŠ¡ã€‚</li></ul><h2 id="2-ä¸´æ—¶è¿›ç¨‹æ–­ç‚¹-debugï¼Ÿ"><a href="#2-ä¸´æ—¶è¿›ç¨‹æ–­ç‚¹-debugï¼Ÿ" class="headerlink" title="2 ä¸´æ—¶è¿›ç¨‹æ–­ç‚¹ debugï¼Ÿ"></a>2 ä¸´æ—¶è¿›ç¨‹æ–­ç‚¹ debugï¼Ÿ</h2><p>2.1<strong>æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ª å«æœ‰ Golang ç¨‹åºçš„å®¹å™¨ä¸­å®‰è£…</strong> delveï¼ˆç®€ç§°dlvï¼‰</p><p>ç¬¬ä¸€ç§å®‰è£…æ–¹å¼ï¼š<code>go install github.com/go-delve/delve/cmd/dlv@latest</code></p><p><strong>ç¬¬äºŒç§å®‰è£…æ–¹å¼ï¼ˆæ¨èï¼‰</strong>ï¼šé’ˆå¯¹æˆ‘ä»¬ä½¿ç”¨çš„ golang é•œåƒï¼Œè¿›è¡ŒäºŒæ¬¡å®šåˆ¶ï¼Œç›´æ¥å°† delve æ‰“åŒ…è¿›è¡Œï¼Œdockerfile å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">FROM</span> <span class="hljs-string">golang:1.20.2</span> <span class="hljs-string">AS</span> <span class="hljs-string">builder</span><br> <br><span class="hljs-string">WORKDIR</span> <span class="hljs-string">/build</span><br> <br><span class="hljs-comment"># è¿™é‡Œä»–çš„ main.go æ²¡æœ‰ç›´æ¥åœ¨é¡¹ç›®ä¸»ç›®å½•ï¼Œä¸åŒäºå…¶ä»– golang å¼€æºé¡¹ç›®ã€‚</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">git</span> <span class="hljs-string">clone</span> <span class="hljs-string">--depth</span> <span class="hljs-number">1</span> <span class="hljs-string">--branch</span> <span class="hljs-string">v1.20.2</span> <span class="hljs-string">https://github.com/go-delve/delve.git</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">cd</span> <span class="hljs-string">/build/delve/cmd/dlv</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">go</span> <span class="hljs-string">build</span> <span class="hljs-string">-o</span> <span class="hljs-string">/build/delve/bin/dlv</span><br> <br> <br><span class="hljs-string">FROM</span> <span class="hljs-string">golang:1.20.2</span><br> <br><span class="hljs-string">COPY</span> <span class="hljs-string">--from=builder</span> <span class="hljs-string">/build/delve/bin/dlv</span> <span class="hljs-string">/usr/local/bin/dlv</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼ˆåŒç‰ˆæœ¬ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker buildx build --platform ç³»ç»Ÿ/amd64,ç³»ç»Ÿ/arm64 -t golang:1.20.2-debug .<br>æˆ–è€…<br>docker  build  -t golang:1.20.2-debug . æ­£å¸¸æ„å»º<br></code></pre></td></tr></table></figure><p><strong>2.2ï¼Œåœ¨ä¸‹è½½å¥½dlvçš„å®¹å™¨ä¸­çš„ç¨‹åºä¸»ç›®å½•ï¼Œè¿è¡Œdlvçš„å‘½ä»¤</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dlv debug --headless --listen=:4000 --api-version=2 --accept-multiclient<br></code></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾ä»£è¡¨å¯åŠ¨æˆåŠŸï¼Œå¹¶ä¸”ç›‘å¬ 4000ç«¯å£ï¼Œç­‰å¾…è¿œç¨‹çš„ debug å·¥å…·ï¼ˆGoland&#x2F;vscodeç­‰ï¼‰è¿æ¥</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20250611222952923.png?raw=true" alt="image-20250611222952923"></p><p>é…ç½®å¯¹åº”remote ä¿¡æ¯ï¼Œhosté…ç½®æˆæœåŠ¡å™¨åœ°å€ä¿¡æ¯</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20250611223444271.png?raw=true" alt="image-20250611223444271"></p><p><strong>2.3ï¼Œé…ç½® goland è¿æ¥ç¬¬äºŒæ­¥è¿è¡Œçš„dlv</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ–¹å¼ä¸€ï¼šç›´æ¥åœ¨å®¹å™¨ä¸­å¯åŠ¨dlvè°ƒè¯•æŒ‡å®šç¨‹åºï¼ˆå¤åˆ¶å‘½ä»¤çš„æ—¶å€™åˆ é™¤æ³¨é‡Šï¼‰</span><br>docker run -it --rm \<br>-p 4000:4000 \# æ˜ å°„è°ƒè¯•ç«¯å£<br>-v $&#123;PWD&#125;:/app \# æŒ‚è½½é¡¹ç›®ç›®å½•ï¼ˆå¯é€‰ï¼Œç”¨äºæºç åŒæ­¥ï¼‰<br>-e &quot;RUNNING_IN_CONTAINER=true&quot; \  # æ·»åŠ ç¯å¢ƒå˜é‡<br>golang:1.20.2-debug \<br>dlv debug --headless --listen=:4000 --api-version=2 --accept-multiclient /app/main.go<br><br>docker run -it --rm \<br>-p 4000:4000 \<br>-v $&#123;PWD&#125;:/app \<br>-e &quot;RUNNING_IN_CONTAINER=true&quot; \<br>golang:1.20.2-debug \<br>dlv debug --headless --listen=:4000 --api-version=2 --accept-multiclient /app/main.go<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ–¹å¼äºŒï¼šè¿›å…¥å®¹å™¨åæ‰‹åŠ¨å¯åŠ¨dlvï¼ˆé€‚åˆäº¤äº’å¼è°ƒè¯•ï¼‰</span><br>docker run -it --rm \<br>  -p 4000:4000 \<br>  -v $&#123;PWD&#125;:/app \<br>  golang:1.20.2-debug \<br>  sh -c &quot;cd /app &amp;&amp; dlv debug --headless --listen=:4000 --api-version=2 --accept-multiclient main.go&quot;<br></code></pre></td></tr></table></figure><h2 id="3-å¸¸é©»è¿›ç¨‹æ–­ç‚¹-debugï¼Ÿ"><a href="#3-å¸¸é©»è¿›ç¨‹æ–­ç‚¹-debugï¼Ÿ" class="headerlink" title="3 å¸¸é©»è¿›ç¨‹æ–­ç‚¹ debugï¼Ÿ"></a>3 å¸¸é©»è¿›ç¨‹æ–­ç‚¹ debugï¼Ÿ</h2><p>å¦‚æœä½ åªè°ƒè¯•ä¸€ä¸ªå¸¸é©»è¿›ç¨‹ä¹Ÿå¯ä»¥åƒä¸´æ—¶è¿›ç¨‹è¿›è¡Œä¸€æ · debugï¼Œä¸è¿‡å½“ä½ æœ‰å¤šä¸ªå¾®æœåŠ¡ç”¨ docker-compose éƒ¨ç½²èµ·æ¥ä»¥åï¼Œä¸€èˆ¬éƒ½æ˜¯å¯åŠ¨ docker å°±å¯åŠ¨å¯¹åº”çš„ golang ç¨‹åºã€‚è¿™ä¸ªæ—¶å€™è¦å»æ€æ­»è¿™ä¸ªè¿›ç¨‹å†ç”¨dlvè¿›è¡Œå¯åŠ¨ï¼Œä¼šå‘ç°æ¯”è¾ƒéº»çƒ¦ã€‚</p><p>è¿™é‡Œæä¾›ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•ã€‚å°±æ˜¯åŸæ¥çš„å¾®æœåŠ¡é…ç½®å…¨éƒ¨ä¸åŠ¨ã€‚ç„¶å</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">FROM</span> <span class="hljs-string">golang:1.20.2</span> <span class="hljs-string">AS</span> <span class="hljs-string">builder</span><br><br><span class="hljs-string">WORKDIR</span> <span class="hljs-string">/build</span><br><br><span class="hljs-comment"># è¿™é‡Œä»–çš„ main.go æ²¡æœ‰ç›´æ¥åœ¨é¡¹ç›®ä¸»ç›®å½•ï¼Œä¸åŒäºå…¶ä»– golang å¼€æºé¡¹ç›®ã€‚</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">git</span> <span class="hljs-string">clone</span> <span class="hljs-string">--depth</span> <span class="hljs-number">1</span> <span class="hljs-string">--branch</span> <span class="hljs-string">v1.20.2</span> <span class="hljs-string">https://github.com/go-delve/delve.git</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">cd</span> <span class="hljs-string">/build/delve/cmd/dlv</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">go</span> <span class="hljs-string">build</span> <span class="hljs-string">-o</span> <span class="hljs-string">/build/delve/bin/dlv</span><br><br><br><span class="hljs-string">FROM</span> <span class="hljs-string">golang:1.20.2</span><br><br><span class="hljs-string">COPY</span> <span class="hljs-string">--from=builder</span> <span class="hljs-string">/build/delve/bin/dlv</span> <span class="hljs-string">/usr/local/bin/dlv</span><br><span class="hljs-comment"># è®¾ç½®Goç¯å¢ƒå˜é‡ï¼Œæ·»åŠ ä»£ç†æ”¯æŒ</span><br><span class="hljs-string">ENV</span> <span class="hljs-string">GO111MODULE=on</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">GOPROXY=https://goproxy.cn,direct</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">GOSUMDB=off</span><br><span class="hljs-string">WORKDIR</span> <span class="hljs-string">/app</span><br><span class="hljs-string">COPY</span> <span class="hljs-string">.</span> <span class="hljs-string">/app</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">go</span> <span class="hljs-string">mod</span> <span class="hljs-string">download</span><br><span class="hljs-comment"># ç¼–è¯‘å¸¦æœ‰è°ƒè¯•ä¿¡æ¯çš„äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">go</span> <span class="hljs-string">build</span> <span class="hljs-string">-gcflags=&quot;all=-N</span> <span class="hljs-string">-l&quot;</span> <span class="hljs-string">-o</span> <span class="hljs-string">app</span><br><span class="hljs-comment"># æš´éœ²è°ƒè¯•ç«¯å£</span><br><span class="hljs-string">EXPOSE</span> <span class="hljs-number">8080</span><br><span class="hljs-string">EXPOSE</span> <span class="hljs-number">4000</span><br><br><span class="hljs-comment"># å¯åŠ¨è°ƒè¯•</span><br><span class="hljs-string">CMD</span> [<span class="hljs-string">&quot;./dlv_debug.sh&quot;</span>]<br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker build -f DockerfileHttp -t golang-http:1.20.2-debug .<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸€ä¸ª shell è„šæœ¬ï¼Œè·å–åˆ°å®¹å™¨é‡Œé¢è¿è¡Œå¾®æœåŠ¡çš„pidã€‚<br>é€šè¿‡ dlvçš„ attach æ“ä½œç›´æ¥å…¥ä¾µæ­£åœ¨è¿è¡Œçš„goalngç¨‹åº åŒæ—¶æš´éœ² 4000 ç«¯å£ã€‚<br>é€šè¿‡ goland çš„ go remote è¿æ¥æš´éœ²çš„ 4000 ç«¯å£ã€‚</p><p><strong>åœ¨å®¹å™¨å†…ï¼Œç¼–è¯‘å¹¶è¿è¡Œï¼ˆæˆ–è€…ç›´æ¥ä¿®æ”¹ docker-compose ä¸­çš„ commandï¼‰ä¸€ä¸ª golang web æœåŠ¡</strong> <strong>ç¼–è¯‘å¹¶ä¸”è¿è¡Œï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cobol">go build -gcflags=&quot;-N -l&quot; -o app<br>./app<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå…ˆ build æ˜¯å› ä¸ºéœ€è¦æ·»åŠ  -gcflags&#x3D;â€-N -lâ€ è¿™ä¸ªå‚æ•°ï¼Œå› ä¸ºå½“ä½¿ç”¨go runå‘½ä»¤è¿è¡ŒGoä»£ç æ—¶ï¼Œæ— æ³•ç›´æ¥æ·»åŠ ç¼–è¯‘å™¨æ ‡å¿—ï¼ˆä¾‹å¦‚-gcflags&#x3D;â€-N -lâ€ï¼‰ï¼Œè€Œåªæœ‰åŠ äº†è¿™ä¸ªå‚æ•°æ‰å¯ä»¥é¿å… golang åœ¨åšç¼–è¯‘æ—¶æŠŠä¸€äº›ä»£ç è¿›è¡Œå¿½ç•¥ï¼Œå¯¼è‡´golandæ— æ³•å†æŸä¸€è¡Œä»£ç ä¸Šæ‰“æ–­ç‚¹ä¸”ä¼šæŠ¥é”™ï¼šcould not find statement at &#x2F;usr&#x2F;local&#x2F;go&#x2F;src&#x2F;cmd&#x2F; go&#x2F;main.go:24, please use a line with a statement<br><strong>é€šè¿‡ä¸€ä¸ªshell è„šæœ¬ï¼ˆdlv_debug.shï¼‰å¯åŠ¨ dlv</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åå°å¯åŠ¨åº”ç”¨  ä¾æ®å®é™…éœ€æ±‚ç¼–å†™æ‰§è¡Œ</span><br>./app &amp;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç­‰å¾…åº”ç”¨å¯åŠ¨</span><br>sleep 2<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é…ç½®è¿™ä¸ªç¨‹åºçš„åå­—</span><br>program_name=&quot;/app&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è·å–æ‰€æœ‰ç¨‹åº</span><br>program_list=$(ps -ef | grep -v &quot;air&quot; | grep -v &quot;/bin/sh&quot;)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è·å–åŒ…å« program_name çš„ç¨‹åºçš„PID</span><br>go_app_pid=$(echo &quot;$program_list&quot; | awk -v pname=&quot;$program_name&quot; &#x27;$0 ~ pname &#123;print $2&#125;&#x27;)<br><br>echo &quot;====== get golang programï¼Œnameï¼š$program_name pid: $go_app_pid ======&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿è¡Œdlvå‘½ä»¤</span><br>dlv attach &quot;$go_app_pid&quot; --headless --listen=:4000 --api-version=2 --accept-multiclient<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">debug:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">golang-http:1.20.2-debug</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8081:8000&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;4000:4000&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./dlv_debug.sh:/app/dlv_debug.sh</span><br>    <span class="hljs-attr">cap_add:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">SYS_PTRACE</span><br>    <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;./dlv_debug.sh&quot;</span>]<br><span class="hljs-comment">#    command: [&quot;./app&quot;]  # æ³¨é‡Šæ‰è„šæœ¬çš„è‡ªåŠ¨å¯åŠ¨ app ç„¶åå¯åŠ¨dlv ä¸ä¼šå‡ºç°åˆæ¬¡å¿…é¡»ä½¿ç”¨ æœ¬åœ°è¿æ¥ä¸Šå»æ‰å¯ä»¥è¿›è¡Œ æµ‹è¯•</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥åœ¨å®¿ä¸»æœº é€šè¿‡å‘½ä»¤æ‰§è¡Œå®¹å™¨å†… shell è„šæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec -t golanddebug-debug-1 /bin/sh -c &quot;bash dlv_debug.sh&quot;<br></code></pre></td></tr></table></figure><p><strong>æŒ‰ç…§ä¸´æ—¶ç¨‹åºçš„debugæµç¨‹ä¸€æ ·é…ç½®golandï¼Œå¯åŠ¨ debug</strong></p><p><a href="https://blog.csdn.net/qq_19734597/article/details/134195506">å‚è€ƒé“¾æ¥</a></p><blockquote><p>è¡¥å……:ç›®å½•è¯´æ˜å’Œè¡¥å……main.goæ–‡ä»¶</p></blockquote><p>é¡¹ç›®ç›®å½•ç»“æ„</p><p>APP</p><p>â”œâ”€â”€ dlv_debug.sh# å®¹å™¨å†… debugè„šæœ¬<br>â”œâ”€â”€ docker-compose.yaml# docker-composeå¯åŠ¨å®¹å™¨é…ç½®<br>â”œâ”€â”€ Dockerfile# ä¸´æ—¶è¿›ç¨‹dockerfile<br>â”œâ”€â”€ DockerfileHttp# å¸¸é©»è¿›ç¨‹dockerfile<br>â”œâ”€â”€ golandè¿æ¥dockerè¿›è¡Œdebug.md    # è¯´æ˜æ–‡æ¡£<br>â”œâ”€â”€ go.mod<br>â”œâ”€â”€ go.sum<br>â””â”€â”€ main.go# æ‰§è¡Œä»£ç </p><p>main.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">/*// åˆ¤æ–­æ˜¯å¦å­˜åœ¨å®¹å™¨ç¯å¢ƒå˜é‡</span><br><span class="hljs-comment">isInContainer := os.Getenv(&quot;RUNNING_IN_CONTAINER&quot;) == &quot;true&quot;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">for i := 0; i &lt;= 10; i++ &#123;</span><br><span class="hljs-comment">if isInContainer &#123;</span><br><span class="hljs-comment">fmt.Printf(&quot;è¿™æ˜¯å®¹å™¨å†…ç¬¬%séæ‰§è¡Œ \n&quot;, strconv.Itoa(i))</span><br><span class="hljs-comment">&#125; else &#123;</span><br><span class="hljs-comment">fmt.Printf(&quot;è¿™æ˜¯å®¿ä¸»æœºç¬¬%séæ‰§è¡Œ \n&quot;, strconv.Itoa(i))</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">&#125;*/</span><br><br><span class="hljs-comment">//1 åˆ›å»ºè·¯ç”±</span><br>r := gin.Default()<br><span class="hljs-comment">// 2.ç»‘å®šè·¯ç”±è§„åˆ™ï¼Œæ‰§è¡Œçš„å‡½æ•°</span><br><span class="hljs-comment">// gin.Contextï¼Œå°è£…äº†requestå’Œresponse</span><br>r.GET(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>c.String(http.StatusOK, <span class="hljs-string">&quot;hello World!&quot;</span>)<br>&#125;)<br><span class="hljs-comment">// 3.ç›‘å¬ç«¯å£ï¼Œé»˜è®¤åœ¨8080</span><br><span class="hljs-comment">// Run(&quot;é‡Œé¢ä¸æŒ‡å®šç«¯å£å·é»˜è®¤ä¸º8080&quot;)</span><br>r.Run(<span class="hljs-string">&quot;0.0.0.0:8000&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>golang ç³»ç»Ÿ è¿œç¨‹ç¯å¢ƒè°ƒè¯•</title>
    <link href="/2025/09/25/go/linux%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91debug/"/>
    <url>/2025/09/25/go/linux%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91debug/</url>
    
    <content type="html"><![CDATA[<h1 id="golangè¿œç¨‹linuxç¯å¢ƒå¼€å‘è°ƒè¯•"><a href="#golangè¿œç¨‹linuxç¯å¢ƒå¼€å‘è°ƒè¯•" class="headerlink" title="golangè¿œç¨‹linuxç¯å¢ƒå¼€å‘è°ƒè¯•"></a>golangè¿œç¨‹linuxç¯å¢ƒå¼€å‘è°ƒè¯•</h1><h2 id="1ã€linuxç¯å¢ƒé…ç½®goç¯å¢ƒ-æœ€å¥½å’Œæœ¬åœ°ç›¸åŒ"><a href="#1ã€linuxç¯å¢ƒé…ç½®goç¯å¢ƒ-æœ€å¥½å’Œæœ¬åœ°ç›¸åŒ" class="headerlink" title="1ã€linuxç¯å¢ƒé…ç½®goç¯å¢ƒ(æœ€å¥½å’Œæœ¬åœ°ç›¸åŒ)"></a>1ã€linuxç¯å¢ƒé…ç½®goç¯å¢ƒ(æœ€å¥½å’Œæœ¬åœ°ç›¸åŒ)</h2><p><a href="https://go.dev/dl/go1.20.8.linux-amd64.tar.gz">go_1.20 Sdkä¸‹è½½åœ°å€</a></p><p>ä¸‹è½½sdk æ­¤å¤„ä½¿ç”¨1.20ç‰ˆæœ¬ ,å°†ä¸‹è½½å¥½çš„tar.gz ä¸Šä¼ åˆ°linuxæœåŠ¡å™¨ &#x2F;usr&#x2F;local ä¸Šé¢ ,ç„¶åè§£å‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -xzvf go1.20.8.ç³»ç»Ÿ-amd64.tar.gz<br></code></pre></td></tr></table></figure><p>åˆ›å»ºGOPATHç›®å½•(ç›¸å½“äºworkplace)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir  /root/mhd/code/go<br><br>cd  /root/mhd/code/go<br>mkdir &#123;bin,src,pkg&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">srcé‡Œé¢æ¯ä¸€ä¸ªå­ç›®å½• å°±æ˜¯ä¸€ä¸ªåŒ… åŒ…å†…æ˜¯Goçš„æºç æ–‡ä»¶</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">pkgç¼–è¯‘åç”Ÿæˆçš„ åŒ…çš„ç›®æ ‡æ–‡ä»¶</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">bin ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p>ç¼–è¾‘é…ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo vim /etc/profile<br>export GOROOT=&quot;/usr/local/go&quot; # goæºç åŒ…æ‰€åœ¨è·¯å¾„<br>export GOPATH=/root/mhd/code/go  #å·¥ä½œå¼€å‘ä»£ç æ‰€åœ¨çš„è·¯å¾„,å¯éšä¾¿æŒ‡å®š<br>export PATH=$PATH:$GOROOT/bin:$GOPATH/bin # go install å‘½ä»¤å®‰è£…çš„åŒ…,ä¼šå®‰è£…åˆ°GOPATH/BINç›®å½•<br><br><br>ä¿å­˜ ä¹‹å soucrce ç¯å¢ƒå˜é‡æ–‡ä»¶<br>source /etc/profile<br></code></pre></td></tr></table></figure><p>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">XDR2.0.40.0(10.65.196.101) ~/mhd/code/go # go version<br>go version go1.20.8 ç³»ç»Ÿ/amd64<br></code></pre></td></tr></table></figure><h2 id="2ã€goland-é…ç½®ssh-session-è¿æ¥ä¼šè¯"><a href="#2ã€goland-é…ç½®ssh-session-è¿æ¥ä¼šè¯" class="headerlink" title="2ã€goland é…ç½®ssh session è¿æ¥ä¼šè¯"></a>2ã€goland é…ç½®ssh session è¿æ¥ä¼šè¯</h2><p>goland-file-setting é‡Œé¢æœç´¢ SSH Configurations é…ç½® å¥½sshæœåŠ¡å™¨ä¿¡æ¯ è¿›è¡Œä¿å­˜</p><p>goland-tools-start ssh session é€‰æ‹©é…ç½®çš„sshæœåŠ¡å™¨è¿æ¥</p><h2 id="3ã€goland-é…ç½®è¿œç¨‹-æ‰§è¡Œ"><a href="#3ã€goland-é…ç½®è¿œç¨‹-æ‰§è¡Œ" class="headerlink" title="3ã€goland é…ç½®è¿œç¨‹ æ‰§è¡Œ"></a>3ã€goland é…ç½®è¿œç¨‹ æ‰§è¡Œ</h2><p>å³ä¸Šè§’runçš„ä½ç½® ä¸‹æ‹‰ Edit Configurations</p><p>ç‚¹å‡»åŠ å·  é€‰æ‹© go build  ç„¶å Run oné€‰æ‹© ssh é€‰åˆ°å‰é¢é…ç½®çš„sshè¿æ¥ ç­‰å¾…æ£€éªŒ</p><p>RUN kind é€‰æ‹© Directory</p><p>Directory é€‰æ‹© æœ¬åœ°ç›®å½•</p><p>Working directory é€‰æ‹©æœ¬åœ°ç›®å½•</p><p>ç„¶åé€šè¿‡é…ç½®å¥½çš„ go build è¿›è¡Œdebug æˆ–è€…runå³å¯</p><h2 id="4ã€golandé…ç½®æ–‡ä»¶æ˜ å°„"><a href="#4ã€golandé…ç½®æ–‡ä»¶æ˜ å°„" class="headerlink" title="4ã€golandé…ç½®æ–‡ä»¶æ˜ å°„"></a>4ã€golandé…ç½®æ–‡ä»¶æ˜ å°„</h2><p><strong>4.1 é…ç½®è¿œç¨‹å¼€å‘æœº</strong></p><p>ctl+alt+sï¼ˆè®¾ç½®ï¼‰  - æœç´¢Deployment - Configuration - â• - SFTP - é…ç½®ä¸»æœºIPã€ç«¯å£ã€ç™»å½•ç”¨æˆ·ã€é‰´æƒæ–¹å¼ç­‰</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20250823144826129.png?raw=true" alt="image-20250823144826129"></p><p>é€‰æ‹©è¿œç¨‹ä¸»æœºé…ç½® ï¼ŒRoot path å¯ä»¥é€‰æ‹©ä¸å¡« ä¹Ÿå¯ä»¥è‡ªåŠ¨å¡«å……ï¼Œç›¸å½“äºmappingé‡Œé¢çš„å‰ç¼€</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20250823145220032.png?raw=true" alt="image-20250823145220032"></p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20250823145421902.png?raw=true" alt="image-20250823145421902"></p><p>åˆ›å»ºå®Œæˆåº”ç”¨å³å¯ ï¼Œæ˜ å°„æ˜¯é’ˆå¯¹ç›®å½•çº§åˆ«çš„</p><p><strong>4.2 æŸ¥çœ‹è¿œç¨‹å¼€å‘é…ç½®</strong></p><p>Tools - Deployment - Browse Remote Host</p><p>æ­¤å¤„ç”±äºæ–‡ä»¶è¿‡å¤š æ›´æ”¹æˆäº†javaç›®å½•</p><p>ç»¿è‰²çš„å°±æ˜¯æ˜ å°„çš„ç›®å½•äº†</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20250823150244043.png?raw=true" alt="image-20250823150244043"></p><p><strong>4.3 ç¬¬ä¸€æ¬¡åŒæ­¥éœ€è¦æ‰‹åŠ¨</strong></p><p>Tools - Deployment - Sync with local - Synchronize All</p><p><strong>4.4 å‹¾é€‰è‡ªåŠ¨åŒæ­¥</strong></p><p>Tools - Deployment - Automatic Upload (Always)<br>è¿™æ—¶å€™åœ¨Golandçš„ä¿®æ”¹éƒ½ä¼šè‡ªåŠ¨åŒæ­¥åˆ°è¿œç¨‹å¼€å‘æœºäº†</p><p><strong>4.5 è‡³æ­¤é…ç½®å®Œæˆ</strong></p>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu_for_clash</title>
    <link href="/2025/09/25/tools/Ubuntu_for_clash/"/>
    <url>/2025/09/25/tools/Ubuntu_for_clash/</url>
    
    <content type="html"><![CDATA[<h1 id="Ubuntué…ç½®ç¿»å¢™è½¯ä»¶"><a href="#Ubuntué…ç½®ç¿»å¢™è½¯ä»¶" class="headerlink" title="Ubuntué…ç½®ç¿»å¢™è½¯ä»¶"></a>Ubuntué…ç½®ç¿»å¢™è½¯ä»¶</h1><p><a href="https://opclash.com/article/302.html">å‚è€ƒåœ°å€</a></p><h2 id="å®‰è£…åŒ…é…ç½®"><a href="#å®‰è£…åŒ…é…ç½®" class="headerlink" title="å®‰è£…åŒ…é…ç½®"></a><strong>å®‰è£…åŒ…é…ç½®</strong></h2><h3 id="1ã€ä¸‹è½½å®‰è£…åŒ…"><a href="#1ã€ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="1ã€ä¸‹è½½å®‰è£…åŒ…"></a>1ã€ä¸‹è½½å®‰è£…åŒ…</h3><h3 id="åˆ›å»ºæ–‡ä»¶å¤¹"><a href="#åˆ›å»ºæ–‡ä»¶å¤¹" class="headerlink" title="åˆ›å»ºæ–‡ä»¶å¤¹"></a>åˆ›å»ºæ–‡ä»¶å¤¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> clash &amp;&amp; <span class="hljs-built_in">cd</span> clash<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://github.com/Dreamacro/clash/releases/download/v1.18.0/clash-linux-amd64-v1.18.0.gz<br></code></pre></td></tr></table></figure><h3 id="2ã€è§£å‹æˆæƒ"><a href="#2ã€è§£å‹æˆæƒ" class="headerlink" title="2ã€è§£å‹æˆæƒ"></a>2ã€è§£å‹æˆæƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è§£å‹æ–‡ä»¶</span><br>gzip -d clash-ç³»ç»Ÿ-amd64-v1.18.0.gz<br><br><span class="hljs-comment"># ç»™äºˆæƒé™</span><br><span class="hljs-built_in">chmod</span> +x clash-ç³»ç»Ÿ-amd64-v1.18.0<br><br><br><span class="hljs-comment"># æŸ¥çœ‹ç‰ˆæœ¬</span><br>./clash-ç³»ç»Ÿ-amd64-v1.18.0 -v<br></code></pre></td></tr></table></figure><h3 id="3ã€å¯åŠ¨åˆ›å»ºæ–‡ä»¶å¤¹"><a href="#3ã€å¯åŠ¨åˆ›å»ºæ–‡ä»¶å¤¹" class="headerlink" title="3ã€å¯åŠ¨åˆ›å»ºæ–‡ä»¶å¤¹"></a>3ã€å¯åŠ¨åˆ›å»ºæ–‡ä»¶å¤¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯åŠ¨ Clash</span><br>./clash-ç³»ç»Ÿ-amd64-v1.18.0<br><br><span class="hljs-comment"># è¿›å…¥ç›®å½•</span><br><span class="hljs-built_in">cd</span> ~/.config/clash/<br><br><span class="hljs-comment"># å¯¼å…¥è®¢é˜…(å°è¯•å¤±è´¥)</span><br>wget -O config.yaml è®¢é˜…åœ°å€<br><br><span class="hljs-comment"># æ‰‹åŠ¨èŠ‚ç‚¹ï¼ˆé€‚ç”¨äºè‡ªå»º å¤åˆ¶configåœ°å€ä¿¡æ¯ï¼‰</span><br><br>vim ~/.config/clash/config.yaml<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/gondmhd/blogImage/main/img/202310271642850.png" alt="image-20231027164226790"></p><h3 id="4ã€é…ç½®ç¯å¢ƒå˜é‡"><a href="#4ã€é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="4ã€é…ç½®ç¯å¢ƒå˜é‡"></a>4ã€é…ç½®ç¯å¢ƒå˜é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;export http_proxy=http://127.0.0.1:7890\nexport https_proxy=http://127.0.0.1:7890&quot;</span> &gt;&gt; ~/.bashrc<br></code></pre></td></tr></table></figure><p>ä¸ºé˜²æ­¢æ„å¤–ï¼Œæ‰“å¼€Ubuntuçš„â€œè®¾ç½®â€ ç®¡ç†ï¼Œåœ¨ç½‘ç»œå†…å°†â€œç½‘ç»œä»£ç†â€çš„è‡ªåŠ¨æ”¹ä¸ºâ€œæ‰‹åŠ¨â€</p><p><img src="https://raw.githubusercontent.com/gondmhd/blogImage/main/img/202310271644906.png" alt="image-20231027164429813"></p><h3 id="5ã€å¯åŠ¨clash"><a href="#5ã€å¯åŠ¨clash" class="headerlink" title="5ã€å¯åŠ¨clash"></a>5ã€å¯åŠ¨clash</h3><p>è¿›å…¥clash äºŒè¿›åˆ¶æ–‡ä»¶ç›®å½•</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">./clash-linux-amd64-<span class="hljs-built_in">v1</span>.<span class="hljs-number">18</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>webé¡µé¢cat </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># èŠ‚ç‚¹ç®¡ç†</span><br>http://clash.razord.top/<span class="hljs-comment">#/proxies</span><br><br><span class="hljs-comment">#è®¾ç½®å‡­è¯å¯†ç </span><br></code></pre></td></tr></table></figure><p>éœ€è¦åå°è¿è¡Œ</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nohup</span> ./clash-linux-amd64-v1.<span class="hljs-number">18</span>.<span class="hljs-number">0</span> &gt;/dev/null <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> &amp;<br></code></pre></td></tr></table></figure><p>åœæ­¢æŸ¥çœ‹è¿›ç¨‹id kill</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">super</span>@super:~/work/tools/clash$ ps -ef | grep clash<br><span class="hljs-attribute">super</span>      <span class="hljs-number">63953</span>   <span class="hljs-number">51347</span>  <span class="hljs-number">0</span> <span class="hljs-number">16</span>:<span class="hljs-number">47</span> pts/<span class="hljs-number">0</span>    <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> ./clash-linux-amd64-v1.<span class="hljs-number">18</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">super</span>      <span class="hljs-number">64324</span>   <span class="hljs-number">64035</span>  <span class="hljs-number">0</span> <span class="hljs-number">16</span>:<span class="hljs-number">54</span> pts/<span class="hljs-number">4</span>    <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> grep --color=auto clash<br><br><span class="hljs-attribute">super</span>@super:~/work/tools/clash$ kill <span class="hljs-number">63953</span><br></code></pre></td></tr></table></figure><p>åœæ­¢ä¸èƒ½è®¿é—®ç½‘ç»œå°†ä»£ç†è®¾ç½®ç¦ç”¨å³å¯</p><p>è„šæœ¬proxy.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>status=$1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‡è®¾ status å‚æ•°ç”¨äºå†³å®šæ˜¯å¦å¼€å¯æˆ–å…³é—­ä»£ç†é…ç½®</span><br>if [ &quot;$status&quot; = &quot;on&quot; ]; then<br>    echo &quot;å¼€å¯ä»£ç†é…ç½®&quot;<br>    sed -i &#x27;s/#export http_proxy/export http_proxy/g&#x27; ~/.bashrc<br>    sed -i &#x27;s/#export https_proxy/export https_proxy/g&#x27; ~/.bashrc<br>    source ~/.bashrc<br>    echo &quot;å¯åŠ¨clashæœåŠ¡&quot;<br>    clash<br>elif [ &quot;$status&quot; = &quot;off&quot; ]; then<br>    echo &quot;å…³é—­ä»£ç†é…ç½®&quot;<br>    sed -i &#x27;s/export http_proxy/#export http_proxy/g&#x27; ~/.bashrc<br>    sed -i &#x27;s/export https_proxy/#export https_proxy/g&#x27; ~/.bashrc<br>    source ~/.bashrc<br>else<br>    echo &quot;æœªçŸ¥çš„çŠ¶æ€æŒ‡ä»¤ï¼Œè¯·è¾“å…¥ &#x27;on&#x27; æˆ– &#x27;off&#x27;&quot;<br>fi<br><br></code></pre></td></tr></table></figure><p>é€šè¿‡å‚æ•°æ§åˆ¶æ˜¯å¦é…ç½®æœ¬åœ°ä»£ç†ç¯å¢ƒï¼Œæ¯æ¬¡å»ºè®®æ‰‹åŠ¨å¼€å¯ç³»ç»Ÿç•Œé¢çš„ç½‘ç»œé…ç½®</p><h2 id="docker-compose-yml-é…ç½®"><a href="#docker-compose-yml-é…ç½®" class="headerlink" title="docker-compose.yml é…ç½®"></a>docker-compose.yml é…ç½®</h2><h3 id="1ã€ä¿®æ”¹config-yamlé…ç½®"><a href="#1ã€ä¿®æ”¹config-yamlé…ç½®" class="headerlink" title="1ã€ä¿®æ”¹config.yamlé…ç½®"></a>1ã€ä¿®æ”¹config.yamlé…ç½®</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim  config.yaml<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å°†hostä»127.0.0.1 æ”¹ç§°0.0.0.0 é…åˆuiè·å–æ¥å£</span><br>external-controller: &#x27;0.0.0.0:9090&#x27;<br></code></pre></td></tr></table></figure><h3 id="2ã€é…ç½®ç¯å¢ƒå˜é‡ä»£ç†"><a href="#2ã€é…ç½®ç¯å¢ƒå˜é‡ä»£ç†" class="headerlink" title="2ã€é…ç½®ç¯å¢ƒå˜é‡ä»£ç†"></a>2ã€é…ç½®ç¯å¢ƒå˜é‡ä»£ç†</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">sh proxy.sh on<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>status=$1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‡è®¾ status å‚æ•°ç”¨äºå†³å®šæ˜¯å¦å¼€å¯æˆ–å…³é—­ä»£ç†é…ç½®</span><br>if [ &quot;$status&quot; = &quot;on&quot; ]; then<br>    echo &quot;å¼€å¯ä»£ç†é…ç½®&quot;<br>    sed -i &#x27;s/#export http_proxy/export http_proxy/g&#x27; ~/.bashrc<br>    sed -i &#x27;s/#export https_proxy/export https_proxy/g&#x27; ~/.bashrc<br>    source ~/.bashrc<br>elif [ &quot;$status&quot; = &quot;off&quot; ]; then<br>    echo &quot;å…³é—­ä»£ç†é…ç½®&quot;<br>    sed -i &#x27;s/export http_proxy/#export http_proxy/g&#x27; ~/.bashrc<br>    sed -i &#x27;s/export https_proxy/#export https_proxy/g&#x27; ~/.bashrc<br>    source ~/.bashrc<br>else<br>    echo &quot;æœªçŸ¥çš„çŠ¶æ€æŒ‡ä»¤ï¼Œè¯·è¾“å…¥ &#x27;on&#x27; æˆ– &#x27;off&#x27;&quot;<br>fi<br></code></pre></td></tr></table></figure><p>å¹¶ä¸”åœ¨ç³»ç»Ÿç½‘ç»œé‡Œé¢é…ç½®ç½‘ç»œä»£ç†ï¼Œæ‰‹åŠ¨â€”â€”http&#x2F;httpsä»£ç† 127.0.0.1:7890   Socksä¸»æœº 127.0.0.1:7891</p><h3 id="3ã€å¯åŠ¨clashæœåŠ¡"><a href="#3ã€å¯åŠ¨clashæœåŠ¡" class="headerlink" title="3ã€å¯åŠ¨clashæœåŠ¡"></a>3ã€å¯åŠ¨clashæœåŠ¡</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">docker-compose</span> <span class="hljs-string">up</span> <span class="hljs-string">-d</span><br><br><br><span class="hljs-comment"># docker-compose.yml</span><br><br><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.7&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">clash-server:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dreamacro/clash</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">clash</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9090:9090&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;7890:7890&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;7891:7891&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./config.yaml:/root/.config/clash/config.yaml</span><br><br>  <span class="hljs-attr">clash-ui:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">haishanh/yacd</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">clash-ui</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">5080</span><span class="hljs-string">:80</span><br></code></pre></td></tr></table></figure><h3 id="4ã€è®¿é—®http-127-0-0-1-5080"><a href="#4ã€è®¿é—®http-127-0-0-1-5080" class="headerlink" title="4ã€è®¿é—®http://127.0.0.1:5080"></a>4ã€è®¿é—®<a href="http://127.0.0.1:5080/">http://127.0.0.1:5080</a></h3><p>é…ç½® API Base URLï¼š<a href="http://localhost:9090/">http://localhost:9090</a>  ,ç‚¹å‡»add</p>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¸¸ç”¨linuxç¬”è®°</title>
    <link href="/2025/09/25/%E7%B3%BB%E7%BB%9F/linux%E5%91%BD%E4%BB%A4/"/>
    <url>/2025/09/25/%E7%B3%BB%E7%BB%9F/linux%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h1 id="1ã€Linuxç³»ç»Ÿå‘½ä»¤"><a href="#1ã€Linuxç³»ç»Ÿå‘½ä»¤" class="headerlink" title="1ã€Linuxç³»ç»Ÿå‘½ä»¤"></a>1ã€Linuxç³»ç»Ÿå‘½ä»¤</h1><h2 id="linuxç¦»çº¿å®‰è£…net-tools"><a href="#linuxç¦»çº¿å®‰è£…net-tools" class="headerlink" title="linuxç¦»çº¿å®‰è£…net-tools"></a>linuxç¦»çº¿å®‰è£…net-tools</h2><p>éœ€é•œåƒç«™ä¸‹è½½å·¥å…·ç¦»çº¿åŒ…</p><p>rpm -Uvh net-tools-2.0-0.25.20131004git.el7.x86_64.rpm     #è¾“å…¥æ­¤å‘½ä»¤è¿›è¡Œå®‰è£…</p><p>centosä¿®æ”¹hostæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">ä¿®æ”¹hostsæ–‡ä»¶<br><br>vim /etc/hosts<br>å¦‚ï¼š<br><br>127.0.0.1 http://www.baidu.com<br><br>ä¿®æ”¹å®Œæˆåç”Ÿæ•ˆå‘½ä»¤<br><br>/etc/init.d/network restart<br><br>nano /etc/ssh/sshd_config<br>ctl O<br>ctl X<br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æœºå™¨æ˜¯å¦è™šæ‹ŸåŒ–"><a href="#æŸ¥çœ‹æœºå™¨æ˜¯å¦è™šæ‹ŸåŒ–" class="headerlink" title="æŸ¥çœ‹æœºå™¨æ˜¯å¦è™šæ‹ŸåŒ–"></a>æŸ¥çœ‹æœºå™¨æ˜¯å¦è™šæ‹ŸåŒ–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /proc/cpuinfo |grep vmx<br><span class="hljs-comment"># æœ‰è¾“å‡ºä¸ºæ”¯æŒè™šæ‹ŸåŒ–</span><br></code></pre></td></tr></table></figure><h2 id="echoå‘½ä»¤å†™å…¥æ–‡ä»¶"><a href="#echoå‘½ä»¤å†™å…¥æ–‡ä»¶" class="headerlink" title="echoå‘½ä»¤å†™å…¥æ–‡ä»¶"></a>echoå‘½ä»¤å†™å…¥æ–‡ä»¶</h2><ul><li><p>echo â€œå†…å®¹â€ &gt;&gt; æ–‡ä»¶ ç­‰ä»·äºæœ«å°¾è¿½åŠ </p></li><li><p>echo â€œå†…å®¹â€ &gt; æ–‡ä»¶ ç­‰ä»·äºæ¸…ç©ºåŸå†…å®¹å¹¶é‡å†™</p></li><li><p>æ·»åŠ \næ¢è¡Œç¬¦å¯ä»¥å®ç°å¤šè¡Œå†™å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">result.log <span class="hljs-comment"># æ¸…ç©ºæ–‡ä»¶å†…å®¹</span></span><br>echo &quot;å†…å®¹&quot; &gt;&gt; logfile.logï¼ˆè‡ªåŠ¨æ¢è¡Œè¿½åŠ ï¼Œæœ€å¸¸ç”¨ï¼‰ã€‚<br>echo -e &quot;&quot;å†…å®¹1\nå†…å®¹2&quot;&quot; &gt;&gt; logfile.logï¼ˆæ‰‹åŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼Œç¡®ä¿æ¢è¡Œï¼‰ã€‚\n<br></code></pre></td></tr></table></figure></li></ul><h3 id="å•å¼•å·ï¼ˆ-ï¼‰åŒ…è£¹å†…å®¹ï¼ˆå˜é‡ä¸ä¼šè¢«è§£æï¼‰"><a href="#å•å¼•å·ï¼ˆ-ï¼‰åŒ…è£¹å†…å®¹ï¼ˆå˜é‡ä¸ä¼šè¢«è§£æï¼‰" class="headerlink" title="å•å¼•å·ï¼ˆ&#39;&#39;ï¼‰åŒ…è£¹å†…å®¹ï¼ˆå˜é‡ä¸ä¼šè¢«è§£æï¼‰"></a>å•å¼•å·ï¼ˆ<code>&#39;&#39;</code>ï¼‰åŒ…è£¹å†…å®¹ï¼ˆå˜é‡ä¸ä¼šè¢«è§£æï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªå˜é‡ linuxä¸‹é¢ç›´æ¥è¾“å…¥å³å¯å®šä¹‰å˜é‡ï¼ˆå˜é‡é€‚ç”¨äºå½“å‰ä¼šè¯çª—å£ï¼‰</span><br>name=<span class="hljs-string">&quot;æµ‹è¯•&quot;</span><br><span class="hljs-comment"># ç”¨å•å¼•å·åŒ…è£¹å†…å®¹ï¼ŒåŒ…å«å˜é‡$name</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ç¬¬ä¸€è¡Œï¼š$name</span><br><span class="hljs-string">ç¬¬äºŒè¡Œï¼šå˜é‡ä¸ä¼šè¢«è§£æ</span><br><span class="hljs-string">&#x27;</span> &gt; test1.txt<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç¬¬ä¸€è¡Œï¼š\$name</span><br><span class="hljs-string">ç¬¬äºŒè¡Œï¼šå˜é‡ä¸ä¼šè¢«è§£æ</span><br><span class="hljs-string">&quot;</span> &gt; test1.txt<br></code></pre></td></tr></table></figure><p><strong>ç»“æœ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ç¬¬ä¸€è¡Œï¼š<span class="hljs-variable">$name</span><br>ç¬¬äºŒè¡Œï¼šå˜é‡ä¸ä¼šè¢«è§£æ<br></code></pre></td></tr></table></figure><p><strong>åŸå› </strong>ï¼šå•å¼•å·ä¼šå°†æ‰€æœ‰å†…å®¹è§†ä¸º â€œçº¯å­—ç¬¦ä¸²â€ï¼Œ<strong>ä¸ä¼šè§£æå˜é‡</strong>ï¼ˆ<code>$name</code> ä¼šè¢«åŸæ ·ä¿ç•™ï¼‰ï¼Œä¹Ÿä¸ä¼šå¤„ç†è½¬ä¹‰å­—ç¬¦ã€‚</p><h3 id="åŒå¼•å·ï¼ˆ-ï¼‰åŒ…è£¹å†…å®¹ï¼ˆå˜é‡ä¼šè¢«è§£æï¼‰"><a href="#åŒå¼•å·ï¼ˆ-ï¼‰åŒ…è£¹å†…å®¹ï¼ˆå˜é‡ä¼šè¢«è§£æï¼‰" class="headerlink" title="åŒå¼•å·ï¼ˆ&quot;&quot;ï¼‰åŒ…è£¹å†…å®¹ï¼ˆå˜é‡ä¼šè¢«è§£æï¼‰"></a>åŒå¼•å·ï¼ˆ<code>&quot;&quot;</code>ï¼‰åŒ…è£¹å†…å®¹ï¼ˆå˜é‡ä¼šè¢«è§£æï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªå˜é‡</span><br>name=<span class="hljs-string">&quot;æµ‹è¯•&quot;</span><br><span class="hljs-comment"># ç”¨åŒå¼•å·åŒ…è£¹å†…å®¹ï¼ŒåŒ…å«å˜é‡$name</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç¬¬ä¸€è¡Œï¼š<span class="hljs-variable">$name</span></span><br><span class="hljs-string">ç¬¬äºŒè¡Œï¼šå˜é‡ä¼šè¢«è§£æ</span><br><span class="hljs-string">&quot;</span> &gt; test2.txt<br></code></pre></td></tr></table></figure><p><strong>ç»“æœ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ç¬¬ä¸€è¡Œï¼šæµ‹è¯•<br>ç¬¬äºŒè¡Œï¼šå˜é‡ä¼šè¢«è§£æ<br></code></pre></td></tr></table></figure><p><strong>åŸå› </strong>ï¼šåŒå¼•å·ä¼š<strong>è§£æå˜é‡</strong>ï¼ˆ<code>$name</code> ä¼šè¢«æ›¿æ¢ä¸ºå®é™…å€¼ â€œæµ‹è¯•â€ï¼‰ï¼ŒåŒæ—¶ä¿ç•™è¾“å…¥æ—¶çš„ç‰©ç†æ¢è¡Œï¼ˆæ— éœ€æ‰‹åŠ¨åŠ  <code>\n</code>)ï¼Œå¯¹äºä¸æƒ³è¢«è§£æçš„å˜é‡ä½¿ç”¨è½¬ç§»ç¬¦å· <code>\</code></p><h2 id="Here-Documentï¼ˆheredocï¼‰å†™å…¥æ–‡ä»¶"><a href="#Here-Documentï¼ˆheredocï¼‰å†™å…¥æ–‡ä»¶" class="headerlink" title="Here-Documentï¼ˆheredocï¼‰å†™å…¥æ–‡ä»¶"></a>Here-Documentï¼ˆheredocï¼‰å†™å…¥æ–‡ä»¶</h2><p>Here-Documentï¼ˆç®€ç§° â€œheredocâ€ï¼‰æ˜¯ Linux Shell ä¸­ä¸€ç§<strong>å¤„ç†å¤šè¡Œæ–‡æœ¬è¾“å…¥</strong>çš„è¯­æ³•ï¼Œé€šè¿‡å®šä¹‰ â€œå®šç•Œç¬¦â€ï¼ˆDelimiterï¼‰æ¥æ ‡è®°æ–‡æœ¬çš„å¼€å§‹å’Œç»“æŸï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼ˆ<code>\n</code>ï¼‰æˆ–è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚å¼•å·ã€<code>$</code>ã€<code>*</code> ç­‰ï¼‰ï¼Œèƒ½å®Œæ•´ä¿ç•™æ–‡æœ¬çš„æ ¼å¼å’Œè¯­ä¹‰</p><h3 id="åŸºæœ¬è¯­æ³•ç»“æ„"><a href="#åŸºæœ¬è¯­æ³•ç»“æ„" class="headerlink" title="åŸºæœ¬è¯­æ³•ç»“æ„"></a>åŸºæœ¬è¯­æ³•ç»“æ„</h3><p>heredoc é€šå¸¸é…åˆ <code>cat</code> å‘½ä»¤ä½¿ç”¨ï¼ˆä¹Ÿå¯ç”¨äºå…¶ä»–æ¥å—æ ‡å‡†è¾“å…¥çš„å‘½ä»¤ï¼Œå¦‚ <code>ssh</code>ã€<code>sed</code> ç­‰ï¼‰ï¼Œæ ¸å¿ƒè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">å‘½ä»¤ &lt;&lt; å®šç•Œç¬¦<br>å¤šè¡Œæ–‡æœ¬å†…å®¹<br>ï¼ˆå¯åŒ…å«å˜é‡ã€ç‰¹æ®Šå­—ç¬¦ã€ä»£ç å—ç­‰ï¼‰<br>å®šç•Œç¬¦<br></code></pre></td></tr></table></figure><p><strong>å…³é”®è§„åˆ™</strong></p><ol><li>ç¬¬ä¸€è¡Œçš„ <code>&lt;&lt; å®šç•Œç¬¦</code> è¡¨ç¤º â€œå¼€å§‹æ¥æ”¶å¤šè¡Œè¾“å…¥ï¼Œç›´åˆ°é‡åˆ°å•ç‹¬ä¸€è¡Œçš„å®šç•Œç¬¦ä¸ºæ­¢â€ã€‚</li><li>ç»“å°¾çš„<strong>å®šç•Œç¬¦å¿…é¡»å•ç‹¬å ä¸€è¡Œ</strong>ï¼Œä¸”å‰åä¸èƒ½æœ‰ä»»ä½•å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºæ ¼ã€Tabï¼‰ï¼Œå¦åˆ™ä¼šå¤±æ•ˆã€‚</li><li>å®šç•Œç¬¦å¯è‡ªå®šä¹‰ï¼ˆå¦‚ <code>EOF</code>ã€<code>TEXT</code>ã€<code>SCRIPT</code> ç­‰ï¼Œé€šå¸¸ç”¨ <code>EOF</code> ä½œä¸ºé»˜è®¤å€¼ï¼Œå³ â€œEnd Of Fileâ€ çš„ç¼©å†™ï¼‰</li></ol><p>heredoc çš„æ ¸å¿ƒçµæ´»æ€§æ¥è‡ª<strong>å®šç•Œç¬¦æ˜¯å¦åŠ å¼•å·</strong>ï¼Œè¿™ç›´æ¥å†³å®šäº†æ–‡æœ¬ä¸­ â€œå˜é‡æ˜¯å¦è§£æâ€â€œç‰¹æ®Šå­—ç¬¦æ˜¯å¦è½¬ä¹‰â€ï¼Œåˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼š</p><table><thead><tr><th>å®šç•Œç¬¦æ ¼å¼</th><th>å˜é‡è§£æ</th><th>ç‰¹æ®Šå­—ç¬¦å¤„ç†ï¼ˆå¦‚ <code>$</code>ã€<code>&quot;</code>ã€<code>\</code>ï¼‰</th><th>æœ¬è´¨</th></tr></thead><tbody><tr><td>æ— å¼•å·ï¼ˆå¦‚ <code>EOF</code>ï¼‰</td><td>ä¼šè§£æï¼ˆæ›¿æ¢ä¸ºå®é™…å€¼ï¼‰</td><td>éœ€æ‰‹åŠ¨è½¬ä¹‰ï¼ˆå¦åˆ™æŒ‰ Shell è¯­æ³•è§£æï¼‰</td><td>ç±»ä¼¼ <code>echo &quot;åŒå¼•å·å†…å®¹&quot;</code></td></tr><tr><td>å¸¦å¼•å·ï¼ˆå¦‚ <code>&quot;EOF&quot;</code>ã€<code>&#39;EOF&#39;</code>ã€<code>\EOF</code>ï¼‰</td><td>ä¸è§£æï¼ˆåŸæ ·ä¿ç•™ï¼‰</td><td>æ— éœ€è½¬ä¹‰ï¼ˆå…¨éƒ¨è§†ä¸ºçº¯æ–‡æœ¬ï¼‰</td><td>ç±»ä¼¼ <code>echo &#39;å•å¼•å·å†…å®¹&#39;</code></td></tr></tbody></table><h5 id="ç¤ºä¾‹-1ï¼šå†™å…¥å¸¦å˜é‡ã€ç‰¹æ®Šå­—ç¬¦çš„è„šæœ¬ï¼ˆæ— å¼•å·å®šç•Œç¬¦ï¼‰"><a href="#ç¤ºä¾‹-1ï¼šå†™å…¥å¸¦å˜é‡ã€ç‰¹æ®Šå­—ç¬¦çš„è„šæœ¬ï¼ˆæ— å¼•å·å®šç•Œç¬¦ï¼‰" class="headerlink" title="ç¤ºä¾‹ 1ï¼šå†™å…¥å¸¦å˜é‡ã€ç‰¹æ®Šå­—ç¬¦çš„è„šæœ¬ï¼ˆæ— å¼•å·å®šç•Œç¬¦ï¼‰"></a>ç¤ºä¾‹ 1ï¼šå†™å…¥å¸¦å˜é‡ã€ç‰¹æ®Šå­—ç¬¦çš„è„šæœ¬ï¼ˆæ— å¼•å·å®šç•Œç¬¦ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®šä¹‰å˜é‡ï¼ˆheredoc ä¸­ä¼šè§£æï¼‰</span><br>SAVE_DIR=<span class="hljs-string">&quot;./test_scripts&quot;</span><br><span class="hljs-comment"># ç”¨ heredoc å†™å…¥è„šæœ¬ï¼Œå®šç•Œç¬¦ EOF æ— å¼•å·</span><br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF &gt; create.sh</span><br><span class="hljs-string">#!/bin/bash</span><br><span class="hljs-string">set -e</span><br><span class="hljs-string"></span><br><span class="hljs-string"># é…ç½®æ–‡ä»¶ä¿å­˜ç›®å½•ï¼ˆä½¿ç”¨å¤–éƒ¨å˜é‡ï¼‰</span><br><span class="hljs-string">SAVE_DIR=&quot;$SAVE_DIR&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string"># æ£€æŸ¥ç›®å½•</span><br><span class="hljs-string">if [ ! -d &quot;$SAVE_DIR&quot; ]; then</span><br><span class="hljs-string">    echo &quot;åˆ›å»ºç›®å½•: $SAVE_DIR&quot;</span><br><span class="hljs-string">    mkdir -p &quot;$SAVE_DIR&quot;</span><br><span class="hljs-string">fi</span><br><span class="hljs-string"></span><br><span class="hljs-string">echo &quot;ç›®å½•å‡†å¤‡å®Œæˆ: $SAVE_DIR&quot;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><ul><li><strong>æ•ˆæœ</strong>ï¼šè„šæœ¬ä¸­çš„ <code>$SAVE_DIR</code> ä¼šè¢«æ›¿æ¢ä¸º <code>./test_scripts</code>ï¼Œä¿ç•™ <code>if</code> è¯­å¥çš„è¯­æ³•æ ¼å¼ï¼Œæ— éœ€è½¬ä¹‰å¼•å·ã€‚</li></ul><h5 id="ç¤ºä¾‹-2ï¼šåŸæ ·å†™å…¥å«ç‰¹æ®Šå­—ç¬¦çš„æ–‡æœ¬ï¼ˆå¸¦å¼•å·å®šç•Œç¬¦ï¼‰"><a href="#ç¤ºä¾‹-2ï¼šåŸæ ·å†™å…¥å«ç‰¹æ®Šå­—ç¬¦çš„æ–‡æœ¬ï¼ˆå¸¦å¼•å·å®šç•Œç¬¦ï¼‰" class="headerlink" title="ç¤ºä¾‹ 2ï¼šåŸæ ·å†™å…¥å«ç‰¹æ®Šå­—ç¬¦çš„æ–‡æœ¬ï¼ˆå¸¦å¼•å·å®šç•Œç¬¦ï¼‰"></a>ç¤ºä¾‹ 2ï¼šåŸæ ·å†™å…¥å«ç‰¹æ®Šå­—ç¬¦çš„æ–‡æœ¬ï¼ˆå¸¦å¼•å·å®šç•Œç¬¦ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span> &gt; script_template.txt<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œ$NAME æ˜¯å¾…æ›¿æ¢çš„å˜é‡</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello, <span class="hljs-variable">$NAME</span>! ä½ çš„ç›®å½•æ˜¯ <span class="hljs-variable">$SAVE_DIR</span>&quot;</span><br>EOF<br></code></pre></td></tr></table></figure><ul><li><strong>æ•ˆæœ</strong>ï¼šæ–‡ä»¶ä¸­ä¼šåŸæ ·ä¿ç•™ <code>$NAME</code>ã€<code>$SAVE_DIR</code>ï¼Œä¸ä¼šè¢«è§£æä¸ºå®é™…å˜é‡ï¼Œä¸”åŒå¼•å·æ— éœ€è½¬ä¹‰ã€‚</li></ul><h5 id="ç¤ºä¾‹-3ï¼šé…åˆå…¶ä»–å‘½ä»¤ï¼ˆæ‰©å±•ç”¨æ³•ï¼‰"><a href="#ç¤ºä¾‹-3ï¼šé…åˆå…¶ä»–å‘½ä»¤ï¼ˆæ‰©å±•ç”¨æ³•ï¼‰" class="headerlink" title="ç¤ºä¾‹ 3ï¼šé…åˆå…¶ä»–å‘½ä»¤ï¼ˆæ‰©å±•ç”¨æ³•ï¼‰"></a>ç¤ºä¾‹ 3ï¼šé…åˆå…¶ä»–å‘½ä»¤ï¼ˆæ‰©å±•ç”¨æ³•ï¼‰</h5><p>heredoc ä¸ä»…èƒ½å†™å…¥æ–‡ä»¶ï¼Œè¿˜èƒ½ç›´æ¥ä½œä¸ºå‘½ä»¤è¾“å…¥ï¼Œæ¯”å¦‚æ‰¹é‡åˆ›å»ºç”¨æˆ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># ç”¨ heredoc ç»™ passwd å‘½ä»¤ä¼ è¾“å…¥ï¼ˆè®¾ç½®å¯†ç ï¼‰</span><br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF | sudo passwd testuser</span><br><span class="hljs-string">123456</span><br><span class="hljs-string">123456</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºæŒ‡å®šæ—¶é—´è„šæœ¬"><a href="#åˆ›å»ºæŒ‡å®šæ—¶é—´è„šæœ¬" class="headerlink" title="åˆ›å»ºæŒ‡å®šæ—¶é—´è„šæœ¬"></a>åˆ›å»ºæŒ‡å®šæ—¶é—´è„šæœ¬</h2><p>create.bat</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">setlocal</span> enabledelayedexpansion<br><br>:: è®¾ç½®æ–‡ä»¶ä¿å­˜ç›®å½•ï¼ˆé»˜è®¤ä¸ºå½“å‰ç›®å½•ï¼Œå¯ä¿®æ”¹ä¸ºå…¶ä»–è·¯å¾„å¦‚D:\test\ï¼‰<br><span class="hljs-built_in">set</span> &quot;saveDir=.&quot;<br><br>:: éªŒè¯ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exist</span> &quot;<span class="hljs-variable">%saveDir%</span>&quot; (<br>    <span class="hljs-built_in">mkdir</span> &quot;<span class="hljs-variable">%saveDir%</span>&quot;<br>    <span class="hljs-built_in">echo</span> å·²åˆ›å»ºç›®å½•ï¼š<span class="hljs-variable">%saveDir%</span><br>)<br><br>:: å®šä¹‰<span class="hljs-number">2024</span>å¹´<span class="hljs-number">1</span>-<span class="hljs-number">10</span>æœˆçš„æµ‹è¯•æ—¶é—´ï¼ˆæ ¼å¼ï¼šYYYY-MM-DD HH:MM:SSï¼‰<br><span class="hljs-built_in">set</span> &quot;times[<span class="hljs-number">1</span>]=<span class="hljs-number">2024</span>-<span class="hljs-number">01</span>-<span class="hljs-number">15</span> <span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-number">00</span>&quot;<br><span class="hljs-built_in">set</span> &quot;times[<span class="hljs-number">2</span>]=<span class="hljs-number">2024</span>-<span class="hljs-number">02</span>-<span class="hljs-number">20</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">00</span>&quot;<br><span class="hljs-built_in">set</span> &quot;times[<span class="hljs-number">3</span>]=<span class="hljs-number">2024</span>-<span class="hljs-number">03</span>-<span class="hljs-number">05</span> <span class="hljs-number">10</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>&quot;<br><span class="hljs-built_in">set</span> &quot;times[<span class="hljs-number">4</span>]=<span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">18</span> <span class="hljs-number">16</span>:<span class="hljs-number">45</span>:<span class="hljs-number">00</span>&quot;<br><span class="hljs-built_in">set</span> &quot;times[<span class="hljs-number">5</span>]=<span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">10</span> <span class="hljs-number">08</span>:<span class="hljs-number">20</span>:<span class="hljs-number">00</span>&quot;<br><span class="hljs-built_in">set</span> &quot;times[<span class="hljs-number">6</span>]=<span class="hljs-number">2024</span>-<span class="hljs-number">06</span>-<span class="hljs-number">25</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">00</span>&quot;<br><span class="hljs-built_in">set</span> &quot;times[<span class="hljs-number">7</span>]=<span class="hljs-number">2024</span>-<span class="hljs-number">07</span>-<span class="hljs-number">08</span> <span class="hljs-number">15</span>:<span class="hljs-number">30</span>:<span class="hljs-number">00</span>&quot;<br><span class="hljs-built_in">set</span> &quot;times[<span class="hljs-number">8</span>]=<span class="hljs-number">2024</span>-<span class="hljs-number">08</span>-<span class="hljs-number">22</span> <span class="hljs-number">13</span>:<span class="hljs-number">10</span>:<span class="hljs-number">00</span>&quot;<br><span class="hljs-built_in">set</span> &quot;times[<span class="hljs-number">9</span>]=<span class="hljs-number">2024</span>-<span class="hljs-number">09</span>-<span class="hljs-number">30</span> <span class="hljs-number">09</span>:<span class="hljs-number">05</span>:<span class="hljs-number">00</span>&quot;<br><span class="hljs-built_in">set</span> &quot;times[<span class="hljs-number">10</span>]=<span class="hljs-number">2024</span>-<span class="hljs-number">10</span>-<span class="hljs-number">12</span> <span class="hljs-number">17</span>:<span class="hljs-number">25</span>:<span class="hljs-number">00</span>&quot;<br><br>:: å¾ªç¯åˆ›å»º<span class="hljs-number">10</span>ä¸ªæ–‡ä»¶å¹¶è®¾ç½®æ—¶é—´<br><span class="hljs-keyword">for</span> /l <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>) <span class="hljs-keyword">do</span> (<br>    :: å®šä¹‰æ–‡ä»¶åï¼ˆå¦‚test_20240115_0930.txtï¼‰<br>    <span class="hljs-built_in">set</span> &quot;timeStr=<span class="hljs-variable">!times[%%i]!</span>&quot;<br>    <span class="hljs-built_in">set</span> &quot;fileDate=<span class="hljs-variable">!timeStr:~0,10!</span>&quot;<br>    <span class="hljs-built_in">set</span> &quot;fileTime=<span class="hljs-variable">!timeStr:~11,8!</span>&quot;<br>    <span class="hljs-built_in">set</span> &quot;fileName=test_<span class="hljs-variable">!fileDate:~0,4!</span><span class="hljs-variable">!fileDate:~5,2!</span><span class="hljs-variable">!fileDate:~8,2!</span>_<span class="hljs-variable">!fileTime:~0,2!</span><span class="hljs-variable">!fileTime:~3,2!</span>.txt&quot;<br>    <span class="hljs-built_in">set</span> &quot;fullPath=<span class="hljs-variable">!saveDir!</span>\<span class="hljs-variable">!fileName!</span>&quot;<br><br>    :: åˆ›å»ºç©ºæ–‡ä»¶<br>    <span class="hljs-built_in">type</span> <span class="hljs-built_in">nul</span> &gt; &quot;<span class="hljs-variable">!fullPath!</span>&quot;<br><br>    :: ä½¿ç”¨PowerShellè®¾ç½®æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´<br>    PowerShell -Command &quot;$file = Get-Item &#x27;<span class="hljs-variable">!fullPath!</span>&#x27;; $file.CreationTime = &#x27;<span class="hljs-variable">!timeStr!</span>&#x27;; $file.LastWriteTime = &#x27;<span class="hljs-variable">!timeStr!</span>&#x27;&quot;<br><br>    <span class="hljs-built_in">echo</span> åˆ›å»ºæ–‡ä»¶ï¼š<span class="hljs-variable">!fileName!</span>  æ—¶é—´ï¼š<span class="hljs-variable">!timeStr!</span><br>)<br><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> æ“ä½œå®Œæˆï¼Œå…±åˆ›å»º<span class="hljs-number">10</span>ä¸ª<span class="hljs-number">2024</span>å¹´æµ‹è¯•æ–‡ä»¶ï¼Œä¿å­˜è·¯å¾„ï¼š<span class="hljs-variable">%saveDir%</span><br><span class="hljs-built_in">endlocal</span><br><span class="hljs-built_in">pause</span><br></code></pre></td></tr></table></figure><p>create.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;</span><br><span class="hljs-string">#!/bin/bash</span><br><span class="hljs-string">set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º</span><br><span class="hljs-string"></span><br><span class="hljs-string"># é…ç½®æ–‡ä»¶ä¿å­˜ç›®å½•ï¼ˆå¯ä¿®æ”¹ä¸ºç»å¯¹è·¯å¾„ï¼Œå¦‚ /tmp/test_filesï¼‰</span><br><span class="hljs-string">SAVE_DIR=&quot;/tmp/xdr-log/&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string"># æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º</span><br><span class="hljs-string">if [ ! -d &quot;$SAVE_DIR&quot; ]; then</span><br><span class="hljs-string">    echo &quot;åˆ›å»ºç›®å½•: $SAVE_DIR&quot;</span><br><span class="hljs-string">    mkdir -p &quot;$SAVE_DIR&quot;</span><br><span class="hljs-string">fi</span><br><span class="hljs-string"></span><br><span class="hljs-string"># å®šä¹‰2024å¹´çš„10ä¸ªæµ‹è¯•æ—¶é—´ï¼ˆæ ¼å¼ï¼šYYYY-MM-DD HH:MM:SSï¼‰</span><br><span class="hljs-string">declare -a TIMES=(</span><br><span class="hljs-string">    &quot;2024-01-05 08:30:00&quot;</span><br><span class="hljs-string">    &quot;2024-02-12 10:15:00&quot;</span><br><span class="hljs-string">    &quot;2024-03-20 14:45:00&quot;</span><br><span class="hljs-string">    &quot;2024-04-08 16:20:00&quot;</span><br><span class="hljs-string">    &quot;2024-05-15 09:10:00&quot;</span><br><span class="hljs-string">    &quot;2024-06-30 11:50:00&quot;</span><br><span class="hljs-string">    &quot;2024-07-18 15:30:00&quot;</span><br><span class="hljs-string">    &quot;2024-08-25 13:05:00&quot;</span><br><span class="hljs-string">    &quot;2024-09-10 07:40:00&quot;</span><br><span class="hljs-string">    &quot;2025-09-17 18:25:00&quot;</span><br><span class="hljs-string">)</span><br><span class="hljs-string"></span><br><span class="hljs-string"># å¾ªç¯åˆ›å»ºæ–‡ä»¶å¹¶è®¾ç½®æ—¶é—´</span><br><span class="hljs-string">for index in &quot;$&#123;!TIMES[@]&#125;&quot;; do</span><br><span class="hljs-string">    # è·å–å½“å‰æ—¶é—´å­—ç¬¦ä¸²</span><br><span class="hljs-string">    time_str=&quot;$&#123;TIMES[$index]&#125;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    # æå–æ—¥æœŸå’Œæ—¶é—´éƒ¨åˆ†ï¼Œç”¨äºç”Ÿæˆæ–‡ä»¶å</span><br><span class="hljs-string">    date_part=&quot;$&#123;time_str:0:10&#125;&quot;  # æˆªå–æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰</span><br><span class="hljs-string">    time_part=&quot;$&#123;time_str:11:8&#125;&quot;  # æˆªå–æ—¶é—´ï¼ˆHH:MM:SSï¼‰</span><br><span class="hljs-string"></span><br><span class="hljs-string">    # æ ¼å¼åŒ–æ–‡ä»¶åï¼ˆå»é™¤åˆ†éš”ç¬¦ï¼Œå¦‚ test_20240105_0830.txtï¼‰</span><br><span class="hljs-string">    file_name=&quot;test_$(echo &quot;$date_part&quot; | tr -d &#x27;</span>-<span class="hljs-string">&#x27;)_$(echo &quot;$time_part&quot; | tr -d &#x27;</span>:<span class="hljs-string">&#x27;).txt&quot;</span><br><span class="hljs-string">    file_path=&quot;$&#123;SAVE_DIR&#125;/$&#123;file_name&#125;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    # åˆ›å»ºç©ºæ–‡ä»¶</span><br><span class="hljs-string">    touch &quot;$file_path&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    # è®¾ç½®æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´å’Œè®¿é—®æ—¶é—´ï¼ˆLinux ä¸‹é€šè¿‡ touch å‘½ä»¤ï¼‰</span><br><span class="hljs-string">    touch -d &quot;$time_str&quot; &quot;$file_path&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    echo &quot;å·²åˆ›å»º: $file_name ï¼ˆæ—¶é—´: $time_strï¼‰&quot;</span><br><span class="hljs-string">done</span><br><span class="hljs-string"></span><br><span class="hljs-string">echo -e &quot;\næ“ä½œå®Œæˆï¼&quot;</span><br><span class="hljs-string">echo &quot;æ–‡ä»¶ä¿å­˜è·¯å¾„: $(realpath &quot;$SAVE_DIR&quot;)&quot;</span><br><span class="hljs-string">echo &quot;å…±åˆ›å»º $&#123;#TIMES[@]&#125; ä¸ªæµ‹è¯•æ–‡ä»¶&quot;</span><br><span class="hljs-string">&#x27;</span> &gt; create.sh<br></code></pre></td></tr></table></figure><h2 id="sedå‘½ä»¤å†™å…¥"><a href="#sedå‘½ä»¤å†™å…¥" class="headerlink" title="sedå‘½ä»¤å†™å…¥"></a>sedå‘½ä»¤å†™å…¥</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs gradle">å‘æ–‡ä»¶æ·»åŠ è¡Œ:<br>sed -i <span class="hljs-string">&#x27;è¡Œå·a æ·»åŠ çš„å†…å®¹&#x27;</span> æ–‡ä»¶<br><br>ä¾‹å¦‚åœ¨ç¬¬ä¸€è¡Œæ·»åŠ :<br>sed -i <span class="hljs-string">&#x27;1a æ·»åŠ çš„ç¬¬ä¸€è¡Œ&#x27;</span> <span class="hljs-keyword">file</span><br><br>æ›¿æ¢æ–‡ä»¶å†…å®¹:<br>sed -i <span class="hljs-string">&#x27;s/old/new/g&#x27;</span> <span class="hljs-keyword">file</span><br><br>åˆ é™¤æ–‡ä»¶æŸä¸€è¡Œ:<br>sed -i <span class="hljs-string">&#x27;è¡Œå·d&#x27;</span> <span class="hljs-keyword">file</span><br><br>å°†å‘½ä»¤è¾“å‡ºå†™å…¥æ–‡ä»¶:<br>command | sed <span class="hljs-string">&#x27;è„šæœ¬&#x27;</span> &gt; <span class="hljs-keyword">file</span><br><br>å°†æ–‡ä»¶å†…å®¹è¾“å‡ºåˆ°å…¶ä»–æ–‡ä»¶:<br>sed <span class="hljs-string">&#x27;è„šæœ¬&#x27;</span> <span class="hljs-keyword">file</span> &gt; new_file<br><br>ç›´æ¥å†™å…¥æ–‡ä»¶ä¸è¯»å…¥:<br>sed -i <span class="hljs-string">&#x27;å†™å…¥æŒ‡ä»¤&#x27;</span> <span class="hljs-keyword">file</span><br><br>ä¾‹å¦‚åœ¨æ–‡ä»¶æœ€åä¸€è¡Œæ·»åŠ å†…å®¹:<br><br>sed -i <span class="hljs-string">&#x27;$a æ–°å†…å®¹&#x27;</span> <span class="hljs-keyword">file</span><br>ä¾‹å¦‚<br>sed -i <span class="hljs-string">&#x27;s/192.168.0.102/192.168.0.195/g&#x27;</span> <span class="hljs-regexp">/home/</span><span class="hljs-keyword">super</span><span class="hljs-regexp">/superdraw-v23.11.0/</span>datahub<span class="hljs-regexp">/tools/</span>setup_superdraw.sh<br><br>åˆ›å»ºæ–°æ–‡ä»¶å¹¶å†™å…¥å†…å®¹<br>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨å°±æ–°å»º:<br><br>sed -i <span class="hljs-string">&#x27;1i\content&#x27;</span> new_file<br><br>æ›¿æ¢/ä¿®æ”¹æŒ‡å®šè¡Œå†…å®¹<br>ä¾‹å¦‚æ›¿æ¢ç¬¬<span class="hljs-number">5</span>è¡Œå†…å®¹:<br><br>sed -i <span class="hljs-string">&#x27;5c\replaced line&#x27;</span> <span class="hljs-keyword">file</span># replaced line ä¸ºè¦æ›¿æ¢çš„å†…å®¹<br></code></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ip"><a href="#ä¿®æ”¹ip" class="headerlink" title="ä¿®æ”¹ip"></a>ä¿®æ”¹ip</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /etc/sysconfig/network-scripts/ifcfg-ç½‘å¡å</span><br>æˆ‘ä»¬éœ€è¦ä¿®æ”¹BOOTPROTO=<span class="hljs-string">&quot;static&quot;</span>ä¹Ÿå°±æ˜¯å°†dhcpæ”¹ä¸ºstaticï¼Œ<br><br>ä¿®æ”¹ONBOOT=<span class="hljs-string">&quot;yes&quot;</span> æ„æ€æ˜¯å°†ç½‘å¡è®¾ç½® ä¸ºå¼€æœºå¯ç”¨ï¼Œ<br><br>åŒæ—¶åœ¨æ–‡å­—ä¸‹æ–¹æ·»åŠ <br><br>IPADDR=192.168.0.230 <span class="hljs-comment">#</span><br>é™æ€IP  <br><br>GATEWAY=192.168.0.1 <span class="hljs-comment">#é»˜è®¤ç½‘å…³  </span><br><br>NETMASK=255.255.255.0 <span class="hljs-comment">#å­ç½‘æ©ç   </span><br><br>DNS1=192.168.0.1 <span class="hljs-comment">#DNS é…ç½®  </span><br><br>DNS2=8.8.8.8        <span class="hljs-comment">#è°·æ­Œåœ°å€</span><br>é‡å¯ç½‘å¡<br>systemctl restart NetworkManager.service<br></code></pre></td></tr></table></figure><h2 id="è·å–å…¬ç½‘ip"><a href="#è·å–å…¬ç½‘ip" class="headerlink" title="è·å–å…¬ç½‘ip"></a>è·å–å…¬ç½‘ip</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ç³»ç»Ÿ å‘½ä»¤ï¼šcurl cip.cc<br></code></pre></td></tr></table></figure><h2 id="shutdownå‘½ä»¤"><a href="#shutdownå‘½ä»¤" class="headerlink" title="shutdownå‘½ä»¤"></a>shutdownå‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">shutdown [é€‰é¡¹] æ—¶é—´ [è­¦å‘Šä¿¡æ¯]<br>é€‰é¡¹:<br>-cï¼šå–æ¶ˆå·²ç»æ‰§è¡Œçš„ shutdown å‘½ä»¤ï¼›<br>-hï¼šå…³æœºï¼›<br>-rï¼šé‡å¯ï¼›<br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹ç›®å½•æ–‡ä»¶å¤§å°"><a href="#æŸ¥çœ‹ç›®å½•æ–‡ä»¶å¤§å°" class="headerlink" title="æŸ¥çœ‹ç›®å½•æ–‡ä»¶å¤§å°"></a>æŸ¥çœ‹ç›®å½•æ–‡ä»¶å¤§å°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">1.æŸ¥çœ‹å½“å‰æ–‡ä»¶ç›®å½•å„ä¸ªæ–‡ä»¶å¤¹å¤§å°<br><span class="hljs-built_in">du</span> -h --max-depth=1<br><span class="hljs-comment">#æŸ¥çœ‹æŒ‡å®šç›®å½•  du -h --max-depth=1 /path</span><br>2ã€æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ç›®å½•åŠå­ç›®å½•å¤§å°<br><span class="hljs-built_in">du</span> -h - .<br>â€œ.â€ä»£è¡¨å½“å‰ç›®å½•ä¸‹ã€‚ä¹Ÿå¯ä»¥æ¢æˆä¸€ä¸ªæ˜ç¡®çš„è·¯å¾„<br><br>-hè¡¨ç¤ºç”¨Kã€Mã€Gçš„äººæ€§åŒ–å½¢å¼æ˜¾ç¤º<br>Filesystemï¼šæ–‡ä»¶ç³»ç»Ÿ<br>Sizeï¼š åˆ†åŒºå¤§å°<br>Usedï¼š å·²ä½¿ç”¨å®¹é‡<br>Availï¼š è¿˜å¯ä»¥ä½¿ç”¨çš„å®¹é‡<br>Use%ï¼š å·²ç”¨ç™¾åˆ†æ¯”<br>Mounted onï¼š æŒ‚è½½ç‚¹ã€€<br>ç›¸å…³å‘½ä»¤ï¼š<br><br><span class="hljs-built_in">df</span> -hlï¼šæŸ¥çœ‹ç£ç›˜å‰©ä½™ç©ºé—´<br><span class="hljs-built_in">df</span> -hï¼šæŸ¥çœ‹æ¯ä¸ªæ ¹è·¯å¾„çš„åˆ†åŒºå¤§å°<br><span class="hljs-built_in">du</span> -sh [ç›®å½•å]ï¼šè¿”å›è¯¥ç›®å½•çš„å¤§å°<br><span class="hljs-built_in">du</span> -sm [æ–‡ä»¶å¤¹]ï¼šè¿”å›è¯¥æ–‡ä»¶å¤¹æ€»Mæ•°<br><span class="hljs-built_in">du</span> -h [ç›®å½•å]ï¼šæŸ¥çœ‹æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤§å°ï¼ˆåŒ…å«å­æ–‡ä»¶å¤¹ï¼‰<br><br>æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—é…ç½®æ–‡ä»¶<br><span class="hljs-built_in">cat</span> /etc/rsyslog.conf<br></code></pre></td></tr></table></figure><h2 id="æŸ¥æ‰¾æ–‡ä»¶æˆ–è€…ç›®å½•"><a href="#æŸ¥æ‰¾æ–‡ä»¶æˆ–è€…ç›®å½•" class="headerlink" title="æŸ¥æ‰¾æ–‡ä»¶æˆ–è€…ç›®å½•"></a>æŸ¥æ‰¾æ–‡ä»¶æˆ–è€…ç›®å½•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥æ‰¾ç›®å½•ä¸‹æ˜¯å¦åŒ…å«æŸä¸ªç›®å½•</span><br>find /path/to/directory -type d -name &quot;directory_name&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥æ‰¾ç›®å½•ä¸‹æ˜¯å¦åŒ…å«æŸä¸ªæ–‡ä»¶</span><br>find /path/to/directory -type f -name &quot;file_name&quot;<br><br></code></pre></td></tr></table></figure><h2 id="ç”Ÿæˆç›®å½•ç»“æ„æ ‘"><a href="#ç”Ÿæˆç›®å½•ç»“æ„æ ‘" class="headerlink" title="ç”Ÿæˆç›®å½•ç»“æ„æ ‘"></a>ç”Ÿæˆç›®å½•ç»“æ„æ ‘</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">å®‰è£…treeå·¥å…·<br>sudo apt install tree<br>ç®€å•ä½¿ç”¨<br>tree -L 2     <span class="hljs-comment"># 2ä»£è¡¨å±‚çº§</span><br><br>ç”Ÿæˆå¯¹åº”ç›®å½•ç»“æ„<br>.<br>â”œâ”€â”€ mysql<br>â”‚Â Â  â””â”€â”€ docker-compose.yml<br>â””â”€â”€ portainer<br>    â”œâ”€â”€ docker-compose.yml<br>    â”œâ”€â”€ portainer.tar<br>    â””â”€â”€ start.sh<br><br>å‚æ•°<br>-d åªæ˜¾ç¤ºæ–‡ä»¶å¤¹<br>-h æ˜¾ç¤ºæ–‡ä»¶å¤§å°<br>-D æ˜¾ç¤ºå®Œæ•´çš„æ—¶é—´æˆ³ä¿¡æ¯<br>-t æŒ‰ä¿®æ”¹æ—¶é—´æ’åº<br>-s æŒ‰æ–‡ä»¶å¤§å°æ’åº<br></code></pre></td></tr></table></figure><h2 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">å¯åŠ¨é˜²ç«å¢™ï¼š systemctl start firewalld<br>æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ï¼š systemctl status firewalld<br>åœæ­¢é˜²ç«å¢™ï¼š systemctl stop firewalld<br>ç¦ç”¨é˜²ç«å¢™ï¼š systemctl <span class="hljs-built_in">disable</span> firewalld<br>æŸ¥çœ‹å·²ç»å¼€æ”¾çš„ç«¯å£ firewall-cmd --list-ports<br><br>å¼€å¯æŒ‡å®šç«¯å£ï¼ˆéœ€ systemctl reload firewalldï¼‰<br>firewall-cmd --zone=public --add-port=[ç«¯å£å·]/[åè®®] --permanent<br>firewall-cmd --zone=public --add-port=80/tcp --permanent<br><br>--zone=&lt;zone&gt; <span class="hljs-comment"># æŒ‡å®š zone</span><br>--add-port=&lt;portid&gt;]/&lt;protocol&gt; <span class="hljs-comment"># ç«¯å£id / åè®®</span><br>--permanent <span class="hljs-comment"># æ°¸ä¹…å¼€å¯ï¼Œä¸æ·»åŠ åˆ™é‡å¯å¤±æ•ˆ</span><br><br>å…³é—­æŒ‡å®šç«¯å£ï¼ˆéœ€ systemctl reload firewalldï¼‰<br>firewall-cmd --zone=public â€“remove-port=[ç«¯å£å·]/[åè®®] --permanent<br>firewall-cmd --zone=public â€“remove-port=80/tcp --permanent<br></code></pre></td></tr></table></figure><p>centos scpä¼ è¾“å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">scp -P 46022 ./code.tar.gz root@192.168.5.16:/root/laozhao/SA_V3.1.1.0323-Release<span class="hljs-comment"># ä¸Šä¼ </span><br>scp -P 46022 root@1192.168.5.16:/home/tools/docker-20.10.21.tgz ./<span class="hljs-comment"># ä¸‹è½½</span><br></code></pre></td></tr></table></figure><h2 id="tarä½¿ç”¨å‘½ä»¤"><a href="#tarä½¿ç”¨å‘½ä»¤" class="headerlink" title="tarä½¿ç”¨å‘½ä»¤"></a>tarä½¿ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar x[z|J]f SMC-V1.0.0-2021xxxxxx-ç³»ç»Ÿ-x86_64-singleton.tar.[gz|xz]<br>ä¸åŒæ ¼å¼å‹ç¼©åŒ…ä½¿ç”¨ä¸åŒå‘½ä»¤å‚æ•°è§£å‹ï¼Œgz æ ¼å¼ä½¿ç”¨ xzf å‚æ•°è§£å‹ï¼Œxz æ ¼å¼ä½¿ç”¨ xJf å‚æ•°è§£å‹<br></code></pre></td></tr></table></figure><h2 id="Centos7æ€§èƒ½æŸ¥çœ‹"><a href="#Centos7æ€§èƒ½æŸ¥çœ‹" class="headerlink" title="Centos7æ€§èƒ½æŸ¥çœ‹"></a>Centos7æ€§èƒ½æŸ¥çœ‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">ç³»ç»Ÿ CPUå¤§å°<br><span class="hljs-built_in">cat</span> /proc/cpuinfo |grep <span class="hljs-string">&quot;model name&quot;</span> &amp;&amp; <span class="hljs-built_in">cat</span> /proc/cpuinfo |grep <span class="hljs-string">&quot;physical id&quot;</span><br>æˆ–è€… lscpu<br>å†…å­˜å¤§å°<br><span class="hljs-built_in">cat</span> /proc/meminfo |grep MemTotalæˆ–è€…ï¼ˆfree -m  totalæ˜¾ç¤ºæ€»å†…å­˜ ï¼‰<br>ç¡¬ç›˜å¤§å°<br>fdisk -l |grep Disk<br></code></pre></td></tr></table></figure><h2 id="centos7æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬"><a href="#centos7æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬" class="headerlink" title="centos7æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬"></a>centos7æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /etc/redhat-release<br></code></pre></td></tr></table></figure><h2 id="centos7æŸ¥çœ‹è¿›ç¨‹å ç”¨ç«¯å£"><a href="#centos7æŸ¥çœ‹è¿›ç¨‹å ç”¨ç«¯å£" class="headerlink" title="centos7æŸ¥çœ‹è¿›ç¨‹å ç”¨ç«¯å£"></a>centos7æŸ¥çœ‹è¿›ç¨‹å ç”¨ç«¯å£</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"> netstat -tunlp | grep ç«¯å£å·<br> <span class="hljs-comment">#tï¼šè¡¨ç¤ºæŸ¥çœ‹tcp</span><br> <span class="hljs-comment">#uï¼šè¡¨ç¤ºæŸ¥çœ‹udp</span><br> <span class="hljs-comment">#pï¼šè¡¨ç¤ºå ç”¨ç«¯å£çš„è¿›ç¨‹</span><br> <span class="hljs-comment">#nï¼šè¡¨ç¤ºç«¯å£ä»¥æ•°å­—å½¢å¼è¡¨ç¤ºï¼Œæ²¡æœ‰nç›´æ¥æ˜¾ç¤ºæœåŠ¡å</span><br> <span class="hljs-comment">#lï¼šè¡¨ç¤ºæ˜¾ç¤ºæ‰€ç›‘å¬çš„ç«¯å£</span><br><br>æŸ¥çœ‹æ‰€æœ‰tcpè¿æ¥åŒ…æ‹¬LISTENçŠ¶æ€<br><span class="hljs-comment"># netstat -an |grep tcp</span><br></code></pre></td></tr></table></figure><h2 id="yumå®‰è£…å¡ä½"><a href="#yumå®‰è£…å¡ä½" class="headerlink" title="yumå®‰è£…å¡ä½"></a>yumå®‰è£…å¡ä½</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum clean all<br>yum makecache  <span class="hljs-comment">#å¡ä½ç­‰å¾…è¿è¡Œå®Œ</span><br>yum update<br></code></pre></td></tr></table></figure><h2 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">1. å®‰è£…tcpdumpå·¥å…·<br>rpm -ql tcpdumpã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="hljs-comment">#æŸ¥çœ‹tcpdumpæ˜¯å¦å®‰è£…</span><br>yum install tcpdump -y<br>2.  tcpdumpæŠ“åŒ…<br>æ ¹æ®åè®®å’Œç«¯å£æŠ“åŒ…<br>tcpdump -i eth0 udp port 694 -nã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ <span class="hljs-comment">#-iæŒ‡å®šç½‘å¡ä¿¡æ¯  udpåè®®</span><br>tcpdump -i eth0 tcp  port 8088 -nã€€ã€€  ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ <span class="hljs-comment">#port 8088ç«¯å£   tcpåè®®</span><br>tcpdump -i eth0 port 8088 -c 3 -t -w /tmp/tcpdump.pcapã€€ã€€ã€€<span class="hljs-comment">#-cæŒ‡å®šæŠ“åŒ…æ•°é‡   -tä¸æ˜¾ç¤ºæ—¶é—´æˆ³  -wæŒ‡å®šå­˜æ”¾è·¯å¾„ã€€</span><br>æ ¹æ®ä¸»æœºæŠ“åŒ…<br>tcpdump host 192.168.0.204 and 192.168.0.205ã€€ã€€ã€€ã€€ã€€ã€€<span class="hljs-comment">#ä¸¤å°ä¸»æœºä¹‹é—´é€šä¿¡æŠ“åŒ…</span><br></code></pre></td></tr></table></figure><h2 id="linux-ä¸‹æŸ¥çœ‹ç½‘å¡æµé‡"><a href="#linux-ä¸‹æŸ¥çœ‹ç½‘å¡æµé‡" class="headerlink" title="linux ä¸‹æŸ¥çœ‹ç½‘å¡æµé‡"></a>linux ä¸‹æŸ¥çœ‹ç½‘å¡æµé‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#yum install -y iftop </span><br>iftop -i ç½‘å¡å<br></code></pre></td></tr></table></figure><p>centos7é…ç½®æ¸…åæº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">å¤‡ä»½åŸæ–‡ä»¶<br>sudo sed -e <span class="hljs-string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> \<br>         -e <span class="hljs-string">&#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos|g&#x27;</span> \<br>         -i.bak \<br>         /etc/yum.repos.d/CentOS-*.repo<br>sudo yum clean all<br>sudo yum makecache<br>yum update<br></code></pre></td></tr></table></figure><h2 id="Debian12é…ç½®æ¸…åæº"><a href="#Debian12é…ç½®æ¸…åæº" class="headerlink" title="Debian12é…ç½®æ¸…åæº"></a>Debian12é…ç½®æ¸…åæº</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.back<span class="hljs-comment"># å¤‡ä»½æ–‡ä»¶</span><br><br><span class="hljs-built_in">cat</span> &gt; /etc/apt/sources.list &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware </span><br><span class="hljs-string">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware</span><br><span class="hljs-string">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware</span><br><span class="hljs-string">deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h2 id="æ¸…ç†æ‰€æœ‰ç›¸å…³è¿›ç¨‹"><a href="#æ¸…ç†æ‰€æœ‰ç›¸å…³è¿›ç¨‹" class="headerlink" title="æ¸…ç†æ‰€æœ‰ç›¸å…³è¿›ç¨‹"></a>æ¸…ç†æ‰€æœ‰ç›¸å…³è¿›ç¨‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps -ef | grep benthos* | grep -v grep | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="hljs-built_in">kill</span> -9   <span class="hljs-comment"># benthos* è¿›ç¨‹å</span><br></code></pre></td></tr></table></figure><h2 id="Debian12ç³»ç»Ÿæ‰“åŒ…è½¯ä»¶ç¦»çº¿åŒ…"><a href="#Debian12ç³»ç»Ÿæ‰“åŒ…è½¯ä»¶ç¦»çº¿åŒ…" class="headerlink" title="Debian12ç³»ç»Ÿæ‰“åŒ…è½¯ä»¶ç¦»çº¿åŒ…"></a>Debian12ç³»ç»Ÿæ‰“åŒ…è½¯ä»¶ç¦»çº¿åŒ…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰“åŒ…</span><br>mkdir packages &amp;&amp; cd packages<br>apt download vim iftop sudo telnet -d   # ä¼šåœ¨packagesç›®å½•ä¸‹ç”Ÿæˆdebç¦»çº¿åŒ…ï¼Œæ‹·è´åˆ°åˆ«çš„æœåŠ¡å™¨<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£…</span><br>dpkg -i *.deb<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç°å®æƒ…å†µ éœ€è¦å°†æŸå°å®‰è£…å¥½çš„æœåŠ¡å™¨ä¸Šçš„è½¯ä»¶åŒ…å…¨éƒ¨æ‰“åŒ…</span><br>cd /var/cache/apt/archives<br>tar -czvf archives.tar.gz archives/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šä¼ å®‰è£…</span><br>dpkg -i *.deb<br></code></pre></td></tr></table></figure><h2 id="ubuntu-èµ„æºç›‘è§†å™¨"><a href="#ubuntu-èµ„æºç›‘è§†å™¨" class="headerlink" title="ubuntu èµ„æºç›‘è§†å™¨"></a>ubuntu èµ„æºç›‘è§†å™¨</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">gnome-system-monitor<br></code></pre></td></tr></table></figure><h2 id="linuxå»ºç«‹è½¯è¿æ¥"><a href="#linuxå»ºç«‹è½¯è¿æ¥" class="headerlink" title="linuxå»ºç«‹è½¯è¿æ¥"></a>linuxå»ºç«‹è½¯è¿æ¥</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s æºæ–‡ä»¶ ç›®æ ‡è¿æ¥<br></code></pre></td></tr></table></figure><h1 id="2ã€centosä¸‹å®‰è£…mysqlæ•°æ®åº“"><a href="#2ã€centosä¸‹å®‰è£…mysqlæ•°æ®åº“" class="headerlink" title="2ã€centosä¸‹å®‰è£…mysqlæ•°æ®åº“"></a>2ã€centosä¸‹å®‰è£…mysqlæ•°æ®åº“</h1><h2 id="1ã€æ·»åŠ MariaDBçš„repoæºï¼š"><a href="#1ã€æ·»åŠ MariaDBçš„repoæºï¼š" class="headerlink" title="1ã€æ·»åŠ MariaDBçš„repoæºï¼š"></a>1ã€æ·»åŠ MariaDBçš„repoæºï¼š</h2><p>è¿›å…¥&#x2F;etc&#x2F;yum.repos.dä¸‹ï¼Œæ·»åŠ CentOS-MariaDB.repoæ–‡ä»¶ï¼Œå…¶ä¸­æ·»åŠ å†…å®¹å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># MariaDB 10.3 CentOS repository list - created 2018-05-26 07:55 UTC</span><br><span class="hljs-comment"># http://downloads.mariadb.org/mariadb/repositories/</span><br>[mariadb]<br>name = MariaDB<br>baseurl = http://yum.mariadb.org/10.3/centos7-amd64<br>gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB<br>gpgcheck=1<br><span class="hljs-comment"># å¸è½½mariadbä»“åº“</span><br>rpm -qa | grep mariadb<br>rpm -e --nodeps mariadb-libs-5.5.68-1.el7.x86_64<br></code></pre></td></tr></table></figure><h2 id="2ã€æ¸…é™¤Yumçš„ç¼“å­˜å¹¶é‡æ–°å»ºç«‹"><a href="#2ã€æ¸…é™¤Yumçš„ç¼“å­˜å¹¶é‡æ–°å»ºç«‹" class="headerlink" title="2ã€æ¸…é™¤Yumçš„ç¼“å­˜å¹¶é‡æ–°å»ºç«‹"></a>2ã€æ¸…é™¤Yumçš„ç¼“å­˜å¹¶é‡æ–°å»ºç«‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum clean all<br>yum makecache<br></code></pre></td></tr></table></figure><h2 id="3ã€æ‰“å°MariaDBæºä¸­çš„è½¯ä»¶åŒ…ï¼š"><a href="#3ã€æ‰“å°MariaDBæºä¸­çš„è½¯ä»¶åŒ…ï¼š" class="headerlink" title="3ã€æ‰“å°MariaDBæºä¸­çš„è½¯ä»¶åŒ…ï¼š"></a>3ã€æ‰“å°MariaDBæºä¸­çš„è½¯ä»¶åŒ…ï¼š</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum list --disablerepo=\* --enablerepo=mariadb<br><br><span class="hljs-built_in">test</span>ä¸ºæµ‹è¯•å·¥å…·ï¼Œbackupä¸ºå¤‡ä»½å·¥å…·<br></code></pre></td></tr></table></figure><h2 id="4ã€å®‰è£…MariaDBæ•°æ®åº“ï¼š"><a href="#4ã€å®‰è£…MariaDBæ•°æ®åº“ï¼š" class="headerlink" title="4ã€å®‰è£…MariaDBæ•°æ®åº“ï¼š"></a>4ã€å®‰è£…MariaDBæ•°æ®åº“ï¼š</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install MariaDB-client MariaDB-server MariaDB-devel -y<br></code></pre></td></tr></table></figure><h2 id="5ã€å¯åŠ¨æ•°æ®åº“å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯"><a href="#5ã€å¯åŠ¨æ•°æ®åº“å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯" class="headerlink" title="5ã€å¯åŠ¨æ•°æ®åº“å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯"></a>5ã€å¯åŠ¨æ•°æ®åº“å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">1ã€å¯åŠ¨maria DBæœåŠ¡:<br><span class="hljs-comment"># systemctl start mariadb.service</span><br>2ã€æ·»åŠ è‡³å¼€æœºè‡ªå¯åŠ¨ï¼š<br><span class="hljs-comment"># systemctl enable mariadb.service</span><br>3ã€æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€<br><span class="hljs-comment"># systemctl status mariadb</span><br></code></pre></td></tr></table></figure><h2 id="6ã€åˆå§‹åŒ–æ•°æ®åº“ï¼Œå¹¶åˆ é™¤æµ‹è¯•æ•°æ®åº“åŠæ›´æ”¹æƒé™å’Œè®¾ç½®å¯†ç "><a href="#6ã€åˆå§‹åŒ–æ•°æ®åº“ï¼Œå¹¶åˆ é™¤æµ‹è¯•æ•°æ®åº“åŠæ›´æ”¹æƒé™å’Œè®¾ç½®å¯†ç " class="headerlink" title="6ã€åˆå§‹åŒ–æ•°æ®åº“ï¼Œå¹¶åˆ é™¤æµ‹è¯•æ•°æ®åº“åŠæ›´æ”¹æƒé™å’Œè®¾ç½®å¯†ç "></a>6ã€åˆå§‹åŒ–æ•°æ®åº“ï¼Œå¹¶åˆ é™¤æµ‹è¯•æ•°æ®åº“åŠæ›´æ”¹æƒé™å’Œè®¾ç½®å¯†ç </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">åˆå§‹åŒ–æ•°æ®åº“é…ç½®<br><br>mysql_secure_installation<br><br>é¦–å…ˆæ˜¯è®¾ç½®å¯†ç ï¼Œä¼šæç¤ºå…ˆè¾“å…¥å¯†ç ï¼š<br><br>è®¾ç½®å¯†ç <br><br>Enter current password <span class="hljs-keyword">for</span> root (enter <span class="hljs-keyword">for</span> none):&lt;â€“ç›´æ¥å›è½¦<br><br>Set root password? [Y/n] &lt;â€“ æ˜¯å¦è®¾ç½®rootç”¨æˆ·å¯†ç ï¼Œè¾“å…¥yå¹¶å›è½¦æˆ–ç›´æ¥å›è½¦<br>New password: &lt;â€“ è®¾ç½®rootç”¨æˆ·çš„å¯†ç <br>Re-enter new password: &lt;â€“ å†è¾“å…¥ä¸€æ¬¡ä½ è®¾ç½®çš„å¯†ç <br>å…¶ä»–é…ç½®<br><br>Remove anonymous <span class="hljs-built_in">users</span>? [Y/n] &lt;â€“ æ˜¯å¦åˆ é™¤åŒ¿åç”¨æˆ·ï¼ŒYå›è½¦<br><br>Disallow root login remotely? [Y/n] &lt;â€“æ˜¯å¦ç¦æ­¢rootè¿œç¨‹ç™»å½•, Nå›è½¦,<br><br>Remove <span class="hljs-built_in">test</span> database and access to it? [Y/n] &lt;â€“ æ˜¯å¦åˆ é™¤<span class="hljs-built_in">test</span>æ•°æ®åº“ï¼ŒYå›è½¦<br><br>Reload privilege tables now? [Y/n] &lt;â€“ æ˜¯å¦é‡æ–°åŠ è½½æƒé™è¡¨ï¼ŒYå›è½¦<br><br>åˆå§‹åŒ–MariaDBå®Œæˆï¼Œæ¥ä¸‹æ¥æµ‹è¯•æœ¬åœ°ç™»å½•ã€‚<br><br></code></pre></td></tr></table></figure><h2 id="7-æ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸ"><a href="#7-æ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸ" class="headerlink" title="7.æ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸ"></a>7.æ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl status mysqld.service<br></code></pre></td></tr></table></figure><h2 id="8-é€šè¿‡å¯†ç ç™»å½•ï¼Œè¿›è¡Œä¿®æ”¹å¯†ç æ“ä½œ-å¯ä¸æ“ä½œ"><a href="#8-é€šè¿‡å¯†ç ç™»å½•ï¼Œè¿›è¡Œä¿®æ”¹å¯†ç æ“ä½œ-å¯ä¸æ“ä½œ" class="headerlink" title="8.é€šè¿‡å¯†ç ç™»å½•ï¼Œè¿›è¡Œä¿®æ”¹å¯†ç æ“ä½œ(å¯ä¸æ“ä½œ)"></a>8.é€šè¿‡å¯†ç ç™»å½•ï¼Œè¿›è¡Œä¿®æ”¹å¯†ç æ“ä½œ(å¯ä¸æ“ä½œ)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql -uroot -p<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;super000&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="9-æˆæƒå…¶ä»–æœºå™¨è¿œç¨‹ç™»å½•"><a href="#9-æˆæƒå…¶ä»–æœºå™¨è¿œç¨‹ç™»å½•" class="headerlink" title="9.æˆæƒå…¶ä»–æœºå™¨è¿œç¨‹ç™»å½•"></a>9.æˆæƒå…¶ä»–æœºå™¨è¿œç¨‹ç™»å½•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">GRANT ALL PRIVILEGES ON *.* TO <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;super000&#x27;</span> WITH GRANT OPTION;<br> <br>FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure><h2 id="10ã€è¿æ¥æ•°æ®åº“ï¼Œå¹¶æŸ¥è¯¢ç‰ˆæœ¬"><a href="#10ã€è¿æ¥æ•°æ®åº“ï¼Œå¹¶æŸ¥è¯¢ç‰ˆæœ¬" class="headerlink" title="10ã€è¿æ¥æ•°æ®åº“ï¼Œå¹¶æŸ¥è¯¢ç‰ˆæœ¬"></a>10ã€è¿æ¥æ•°æ®åº“ï¼Œå¹¶æŸ¥è¯¢ç‰ˆæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql -uroot -p -A<br><br>å…¶ä¸­-uåˆ¶å®šç”¨æˆ·ï¼Œ-pä½¿ç”¨å¯†ç ï¼Œ-Aä¸ºä¸é¢„å…ˆè¯»å–æ•°æ®åº“ã€‚<br><br>MariaDB [(none)]&gt; <span class="hljs-keyword">select</span> version();<br>+-----------------+<br>| version()       |<br>+-----------------+<br>| 10.3.32-MariaDB |<br>+-----------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.000 sec)<br><br>show full processlist;<br>å¯æŸ¥çœ‹å½“å‰ç”¨æˆ·ï¼ŒåŠç™»é™†åœ°å€ï¼Œé€‰æ‹©çš„æ•°æ®åº“ï¼Œæ•°æ®åº“å¼•æ“ã€‚<br><br></code></pre></td></tr></table></figure><h2 id="11-è®¾ç½®Mariadbçš„å­—ç¬¦é›†ä¸ºUTF-8ï¼Œä»¤å…¶æ”¯æŒä¸­æ–‡"><a href="#11-è®¾ç½®Mariadbçš„å­—ç¬¦é›†ä¸ºUTF-8ï¼Œä»¤å…¶æ”¯æŒä¸­æ–‡" class="headerlink" title="11.è®¾ç½®Mariadbçš„å­—ç¬¦é›†ä¸ºUTF-8ï¼Œä»¤å…¶æ”¯æŒä¸­æ–‡"></a>11.è®¾ç½®Mariadbçš„å­—ç¬¦é›†ä¸ºUTF-8ï¼Œä»¤å…¶æ”¯æŒä¸­æ–‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">1.æŸ¥çœ‹å½“å‰ç¼–ç ï¼š<br>show variables like <span class="hljs-string">&#x27;character%&#x27;</span>; <br>show variables like <span class="hljs-string">&#x27;collation%&#x27;</span>;<br>2.é€€å‡ºæ•°æ®åº“ï¼ˆ<span class="hljs-built_in">exit</span>ï¼‰ï¼Œ<br>3.ä¿®æ”¹é…ç½®æ–‡ä»¶ vim /etc/my.cnf.d/server.cnf<br>åœ¨mysqldä¸‹æ·»åŠ  character-set-server = utf8<br>              collation-server = utf8_general_ci<br>              skip-character-set-client-handshake<br>              æ³¨æ„å»æ‰å‰é¢çš„<span class="hljs-comment">#å·</span><br>4.é‡å¯ æ•°æ®åº“ systemctl restart mariadb<br>5.è¿›å…¥æ•°æ®åº“ mysql -uroot -p<br>6.æŸ¥çœ‹å­—ç¬¦é›†ç¼–ç <br></code></pre></td></tr></table></figure><h2 id="12-é˜²ç«å¢™å¼€æ”¾3306ç«¯å£"><a href="#12-é˜²ç«å¢™å¼€æ”¾3306ç«¯å£" class="headerlink" title="12.é˜²ç«å¢™å¼€æ”¾3306ç«¯å£"></a>12.é˜²ç«å¢™å¼€æ”¾3306ç«¯å£</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --state<br>firewall-cmd --zone=public --add-port=3306/tcp --permanent<br>firewall-cmd --zone=public --add-port=80-90/tcp --permanent   <span class="hljs-comment">#ä½œç”¨åŸŸæ˜¯publicï¼Œæ‰¹é‡å¼€æ”¾tcpåè®®çš„80-90ç«¯å£ï¼Œä¸€ç›´æœ‰æ•ˆ</span><br>firewall-cmd --zone=public --add-port=80/tcp --add-port=90/tcp --permanent  <span class="hljs-comment">#ä½œç”¨åŸŸæ˜¯publicï¼Œæ‰¹é‡å¼€æ”¾tcpåè®®çš„80ã€90ç«¯å£ï¼Œä¸€ç›´æœ‰æ•ˆ</span><br>firewall-cmd --zone=public --add-service=http --permanent <span class="hljs-comment">#å¼€æ”¾çš„æœåŠ¡æ˜¯httpåè®®ï¼Œä¸€ç›´æœ‰æ•ˆ</span><br>firewall-cmd --reload<br><br>åœæ­¢é˜²ç«å¢™ï¼š systemctl stop firewalld<br>ç¦ç”¨é˜²ç«å¢™ï¼š systemctl <span class="hljs-built_in">disable</span> firewalld<br></code></pre></td></tr></table></figure><h2 id="13-æ•°æ®åº“çš„æ“ä½œ"><a href="#13-æ•°æ®åº“çš„æ“ä½œ" class="headerlink" title="13.æ•°æ®åº“çš„æ“ä½œ"></a>13.<a href="https://cloud.tencent.com/solution/database?from=10680">æ•°æ®åº“</a>çš„æ“ä½œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">ï¼ˆ1ï¼‰æŸ¥çœ‹mysqlæ˜¯å¦å¯åŠ¨ï¼šservice mariadb status<br><br>å¯åŠ¨mysqlï¼šsystemctl start mariadb<br><br>åœæ­¢mysqlï¼šsystemctl stop mariadb<br><br>é‡å¯mysqlï¼šsystemctl restart mariadb<br><br>ï¼ˆ2ï¼‰æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬ mysql -V<br></code></pre></td></tr></table></figure><h2 id="14-JDKé…ç½®"><a href="#14-JDKé…ç½®" class="headerlink" title="14 JDKé…ç½®"></a>14 JDKé…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹æœåŠ¡å™¨ä¸Šæ˜¯å¦æœ‰Javaå®‰è£…åŒ…</span><br>rpm -qa | grep java<br><br><span class="hljs-comment"># æŸ¥çœ‹Linuxç³»ç»Ÿæ˜¯å¦æœ‰è‡ªå¸¦çš„jdk</span><br>java -version<br><br><span class="hljs-comment"># ä¸Šä¼ å®‰è£…åŒ… è§£å‹ï¼Œé…ç½®/etc/profile</span><br>tar -xzvf jdk-11.0.1_linux-x64_bin.tar.gz<br>[root@ecs-dc44 data]<span class="hljs-comment"># cd jdk-11.0.1</span><br>[root@ecs-dc44 jdk-11.0.1]<span class="hljs-comment"># pwd</span><br>/data/jdk-11.0.1<br><br><span class="hljs-comment"># é…ç½®æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-built_in">export</span> JAVA_HOME=/data/jdk-11.0.1<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> CLASSPATH=.:<span class="hljs-variable">$JAVA_HOME</span>/lib/dt.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib/tools.jar<br><br><span class="hljs-comment"># åˆ·æ–°</span><br><span class="hljs-built_in">source</span> /etc/profile<br><br></code></pre></td></tr></table></figure><h1 id="3ã€Linuxä¸‹å®‰è£…python3"><a href="#3ã€Linuxä¸‹å®‰è£…python3" class="headerlink" title="3ã€Linuxä¸‹å®‰è£…python3"></a>3ã€Linuxä¸‹å®‰è£…python3</h1><h3 id="1ã€ä¾èµ–å®‰è£…"><a href="#1ã€ä¾èµ–å®‰è£…" class="headerlink" title="1ã€ä¾èµ–å®‰è£…"></a>1ã€ä¾èµ–å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">gccæ˜¯ä¸€ä¸ªç”¨äºlinuxç³»ç»Ÿä¸‹ç¼–ç¨‹çš„ç¼–è¯‘å™¨ï¼Œç”±äºpython3éœ€è¦ç¼–è¯‘å®‰è£…ï¼Œå› æ­¤ï¼Œéœ€è¦é¦–å…ˆå®‰è£…gccã€‚å…ˆæŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿä¸­ï¼Œæ˜¯å¦å®‰è£…äº†gccã€‚<br><span class="hljs-comment"># gcc -version</span><br>æœªå®‰è£…éœ€è¦å®‰è£…<br><span class="hljs-comment"># yum -y install gcc</span><br>ç¼–è¯‘å®‰è£…python3è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®ç³»ç»Ÿæœ¬èº«çš„ä¾èµ–ï¼Œå¯èƒ½å‡ºç°çš„ä¸åŒçš„æŠ¥é”™ä¿¡æ¯ã€‚æå‰æŒ‰ç…§å¥½ä¾èµ–åŒ…<br>yum -y install zlib* libffi-devel openssl-devel wget<br></code></pre></td></tr></table></figure><h3 id="2-python3-ä¸‹è½½"><a href="#2-python3-ä¸‹è½½" class="headerlink" title="2 python3 ä¸‹è½½"></a>2 python3 ä¸‹è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cd ~ </span><br><span class="hljs-comment"># wget https://www.python.org/ftp/python/3.7.0/Python-3.7.0.tgz</span><br><span class="hljs-comment"># wget https://www.python.org/ftp/python/3.9.9/Python-3.9.9.tgz</span><br></code></pre></td></tr></table></figure><h3 id="3-python3ç¼–è¯‘å®‰è£…"><a href="#3-python3ç¼–è¯‘å®‰è£…" class="headerlink" title="3 python3ç¼–è¯‘å®‰è£…"></a>3 python3ç¼–è¯‘å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">è§£å‹ä¸‹è½½çš„python3å‹ç¼©åŒ…<br><span class="hljs-comment"># tar -zxvf Python-3.7.0.tgz</span><br>æ–°å»ºä¸€ä¸ªpython3çš„å®‰è£…ç›®å½•(ä½ç½®å¯è‡ªå®šä¹‰)<br><span class="hljs-comment"># mkdir /usr/lib/python3.7</span><br>è¿›å…¥Python-3.7.0ç›®å½•ä¸‹ï¼Œã€ŒæŒ‡å®šå®‰è£…ç›®å½•ï¼Œè®¾ç½®å¯ç”¨sslåŠŸèƒ½<br><span class="hljs-comment"># cd Python-3.7.0</span><br>./configure --prefix=/usr/lib/python3.7 --with-ssl<br>ç¼–è¯‘å®‰è£…<br><span class="hljs-comment"># make &amp;&amp; make install</span><br></code></pre></td></tr></table></figure><h3 id="4åˆ›å»ºè½¯è¿æ¥"><a href="#4åˆ›å»ºè½¯è¿æ¥" class="headerlink" title="4åˆ›å»ºè½¯è¿æ¥"></a>4åˆ›å»ºè½¯è¿æ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">ä¸Šè¿°æ­¥éª¤å®Œæˆåï¼Œå…¶å®python3å·²ç»å®‰è£…å®Œæ¯•ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œä¸€èˆ¬ä¼šåˆ›å»ºpython3å’Œpip3çš„è½¯è¿æ¥ã€‚åˆ›å»ºåå¯ç›´æ¥åœ¨ç»ˆç«¯é€šè¿‡pythonå‘½ä»¤è¿›å…¥pythonå’Œpip3å‘½ä»¤å®‰è£…pythonåŒ…<br><br>åˆ›å»ºpython3å’Œpip3è½¯è¿æ¥ï¼š<br><span class="hljs-comment"># ln -s /usr/lib/python3.7/bin/python3.7 /usr/bin/python3</span><br><span class="hljs-comment"># ln -s /usr/lib/python3.7/bin/pip3.7 /usr/bin/pip3</span><br><span class="hljs-comment"># ln -s /usr/bin/pip3 /usr/bin/pip</span><br><br>ç³»ç»Ÿé»˜è®¤çš„pythonè½¯è¿æ¥æŒ‡å‘çš„æ˜¯python2ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ›´æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥åˆ é™¤åŸæœ‰çš„pythonè½¯è¿æ¥ï¼Œå¹¶å»ºç«‹æ–°çš„pythonè½¯è¿æ¥æŒ‡å‘python3<br><br><span class="hljs-comment"># rm -f /usr/bin/python</span><br><span class="hljs-comment"># ln -s /usr/bin/python3 /usr/bin/python</span><br><br>æŸ¥çœ‹æœ€æ–°çš„æœ‰pythonçš„è½¯è¿æ¥<br><span class="hljs-comment"># python --version</span><br></code></pre></td></tr></table></figure><h3 id="5ä¿®æ”¹yumé…ç½®"><a href="#5ä¿®æ”¹yumé…ç½®" class="headerlink" title="5ä¿®æ”¹yumé…ç½®"></a>5ä¿®æ”¹yumé…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ä¿®æ”¹yumé…ç½®æ–‡ä»¶ï¼Œä¸‹é¢ä¸¤ä¸ªæ–‡ä»¶éƒ½è¦ä¿®æ”¹<br><span class="hljs-comment"># vi /usr/bin/yum</span><br><span class="hljs-comment"># vi /usr/libexec/urlgrabber-ext-down</span><br>æŒ‰iè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œåœ¨ç¬¬ä¸€è¡Œ<span class="hljs-comment">#!/usr/bin/pythonæŠŠä¿®æ”¹ä¸º#!/usr/bin/python2.7</span><br></code></pre></td></tr></table></figure><h3 id="6è”ç½‘å¿«é€Ÿå®‰è£…æ–¹æ³•"><a href="#6è”ç½‘å¿«é€Ÿå®‰è£…æ–¹æ³•" class="headerlink" title="6è”ç½‘å¿«é€Ÿå®‰è£…æ–¹æ³•"></a>6è”ç½‘å¿«é€Ÿå®‰è£…æ–¹æ³•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">3ã€å®‰è£…Python3ï¼šï¼ˆæ­¤æ–¹æ³•é»˜è®¤ä¸º3.6ï¼Œæ— æ³•å®‰è£…3.7ï¼‰<br>yum install python3 -y<br>yum -y install epel-release<br>yum -y install python-pip<br><br>å¤‡ä»½æ—§çš„Pythonçš„é»˜è®¤æ‰§è¡Œç¨‹åºã€€ã€€<br><span class="hljs-built_in">mv</span> /usr/bin/python /usr/bin/python.bak.$(<span class="hljs-built_in">date</span> +%F).$(<span class="hljs-built_in">date</span> +%R)<br>ä½¿ç”¨Python3è½¯é“¾æ¥æ›¿ä»£Pythoné»˜è®¤æ‰§è¡Œç¨‹åºã€€ã€€<br><span class="hljs-built_in">ln</span> -s /usr/bin/python3 /usr/bin/python<br><br>ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶çš„å¼€å¤´ç¬¬ä¸€è¡Œå†…å®¹ï¼ŒæŠŠpythonæ”¹æˆpython2.7(ä¸ä¿®æ”¹yumå‘½ä»¤æ— æ³•ä½¿ç”¨)<br><br>/usr/bin/yum<br>/usr/libexec/urlgrabber-ext-down<br>/usr/bin/yum-config-manager<br>æŸ¥çœ‹Pythonæ›¿æ¢æ­£å¸¸ï¼Œä¸”yumå¯ç”¨ã€€ã€€<br>yum --version<br>python --version<br><br>å¸è½½python3.6.x<br><br>rpm -qa|grep python3|xargs rpm -ev --allmatches --nodeps<br>whereis python3 |xargs <span class="hljs-built_in">rm</span> -frv<br></code></pre></td></tr></table></figure><h1 id="4ã€linux-è‡ªå¸¦python-æ­å»ºhttpæœåŠ¡"><a href="#4ã€linux-è‡ªå¸¦python-æ­å»ºhttpæœåŠ¡" class="headerlink" title="4ã€linux è‡ªå¸¦python æ­å»ºhttpæœåŠ¡"></a>4ã€linux è‡ªå¸¦python æ­å»ºhttpæœåŠ¡</h1><h2 id="1ã€ç‰ˆæœ¬è¯´æ˜ï¼ˆå†…ç½®åº“ï¼‰"><a href="#1ã€ç‰ˆæœ¬è¯´æ˜ï¼ˆå†…ç½®åº“ï¼‰" class="headerlink" title="1ã€ç‰ˆæœ¬è¯´æ˜ï¼ˆå†…ç½®åº“ï¼‰"></a>1ã€ç‰ˆæœ¬è¯´æ˜ï¼ˆå†…ç½®åº“ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">å¦‚æœpythonç‰ˆæœ¬ä¸º2.xï¼Œè¾“å…¥å‘½ä»¤ï¼š<br><br>python -m SimpleHTTPServer 8000<br><br>ï¼ˆ8000ä¸ºç«¯å£å·ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™é»˜è®¤8000ç«¯å£ï¼‰<br><br><span class="hljs-comment">######################################</span><br><br>å¦‚æœpythonç‰ˆæœ¬ä¸º3.xï¼Œè¾“å…¥å‘½ä»¤ï¼š<br><br>python -m http.server 8000<br><br>ï¼ˆ8000ä¸ºç«¯å£å·ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™é»˜è®¤8000ç«¯å£ï¼‰<br><br>é»˜è®¤ä½å½“å‰ç›®å½•<br></code></pre></td></tr></table></figure><h2 id="2ã€é…ç½®åå°å…³é—­bashçª—å£è¿è¡Œ"><a href="#2ã€é…ç½®åå°å…³é—­bashçª—å£è¿è¡Œ" class="headerlink" title="2ã€é…ç½®åå°å…³é—­bashçª—å£è¿è¡Œ"></a>2ã€é…ç½®åå°å…³é—­bashçª—å£è¿è¡Œ</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs markdown">nohup python -m SimpleHTTPServer 8000 &amp;    #python2.0<br><br>nohup python -m http.server 8000 &amp;# python3.0<br><br>åœ¨å‘½ä»¤çš„å¼€å¤´åŠ ä¸€ä¸ªnohupï¼Œå¿½ç•¥æ‰€æœ‰çš„æŒ‚æ–­ä¿¡å·ï¼Œå¦‚æœå½“å‰bashå…³é—­ï¼Œåˆ™å½“å‰è¿›ç¨‹ä¼šæŒ‚è½½åˆ°initè¿›ç¨‹ä¸‹ï¼Œæˆä¸ºå…¶å­è¿›ç¨‹ï¼Œè¿™æ ·å³ä½¿é€€å‡ºå½“å‰ç”¨æˆ·ï¼Œå…¶8000ç«¯å£ä¹Ÿå¯ä»¥ä½¿ç”¨<br>åœ¨ä¸Šè¿°å‘½ä»¤çš„æœ€ååŠ ä¸€ä¸ª &amp; ï¼Œåˆ™è¯¥å‘½ä»¤äº§ç”Ÿçš„è¿›ç¨‹åœ¨åå°è¿è¡Œï¼Œä¸ä¼šå½±å“å½“å‰ç»ˆç«¯çš„ä½¿ç”¨ï¼ˆæˆ‘ä»¬åœ¨åªæœ‰ä¸€ä¸ªbashçš„ç¯å¢ƒä¸‹ï¼‰<br><br>é…ç½®shè„šæœ¬<br>nohup python -m SimpleHTTPServer 8080 &gt;/home/httplog/http.log 2&gt;&amp;1 &amp;  # /home/httplog/http.logä¸ºè¾“å‡ºæ–‡ä»¶æ—¥å¿—è·¯å¾„<br></code></pre></td></tr></table></figure><h1 id="5ã€xshellä»£ç†æœåŠ¡å™¨è¿æ¥"><a href="#5ã€xshellä»£ç†æœåŠ¡å™¨è¿æ¥" class="headerlink" title="5ã€xshellä»£ç†æœåŠ¡å™¨è¿æ¥"></a>5ã€xshellä»£ç†æœåŠ¡å™¨è¿æ¥</h1><h2 id="5ã€1-windowè®¾ç½®"><a href="#5ã€1-windowè®¾ç½®" class="headerlink" title="5ã€1 windowè®¾ç½®"></a>5ã€1 windowè®¾ç½®</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs tex">1ã€æœ¬åœ°ä¸‹è¼‰openSSHï¼Œæ ¹æ®ä»£ç†æœåŠ¡å™¨çš„ç¯å¢ƒä¸‹è½½<br>ä¸‹è½½åœ°å€ï¼šhttps://github.com/PowerShell/Win32-OpenSSH/releases<br>2ã€ä¸‹è½½å®Œæ¯•è§£å‹å®‰è£…<br>ä»¥ç®¡ç†å‘˜èº«ä»½cmdè¿›å…¥è§£å‹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ<br>powershell.exe -ExecutionPolicy Bypass -File install-sshd.ps1<br>3ã€é˜²ç«å¢™é«˜çº§è®¾ç½®é‡Œé¢æ·»åŠ 22ç«¯å£çš„tcpå…¥ç«™è§„åˆ™<br>4ã€ç³»ç»ŸæœåŠ¡é‡Œé¢å¯åŠ¨openSSHç›¸å…³æœåŠ¡<br></code></pre></td></tr></table></figure><h2 id="5-2-xshelléš§é“ä»£ç†è®¾ç½®"><a href="#5-2-xshelléš§é“ä»£ç†è®¾ç½®" class="headerlink" title="5.2  xshelléš§é“ä»£ç†è®¾ç½®"></a>5.2  xshelléš§é“ä»£ç†è®¾ç½®</h2><h3 id="5-2-1-å»ºç«‹è·³æ¿æœºè¿æ¥"><a href="#5-2-1-å»ºç«‹è·³æ¿æœºè¿æ¥" class="headerlink" title="5.2.1 å»ºç«‹è·³æ¿æœºè¿æ¥"></a>5.2.1 å»ºç«‹è·³æ¿æœºè¿æ¥</h3><p>é¦–å…ˆå»ºç«‹è·³æ¿æœºçš„è¿æ¥ï¼Œå¹¶é…ç½®éš§é“ã€‚æ‰“å¼€<a href="https://so.csdn.net/so/search?q=XShell&spm=1001.2101.3001.7020">XShell</a>ç‚¹å‡»æ–‡ä»¶èœå•å†ç‚¹å‡»æ–°å»ºå¼¹å‡ºæ–°å»ºä¼šè¯å±æ€§çª—å£ï¼Œåç§°å°±å–ä¸ºè·³æ¿æœºï¼Œç«¯å£æ˜¯22ï¼Œä¸»æœºå¡«å†™å‰é¢å‡è®¾çš„ipåœ°å€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://typrao-mhd.oss-cn-hangzhou.aliyuncs.com/picture/202306071154535.png" alt="image-20220630163450501"></p><h3 id="5-2-2-å¡«å†™è·³æ¿æœºç”¨æˆ·åå¯†ç "><a href="#5-2-2-å¡«å†™è·³æ¿æœºç”¨æˆ·åå¯†ç " class="headerlink" title="5.2.2 å¡«å†™è·³æ¿æœºç”¨æˆ·åå¯†ç "></a>5.2.2 å¡«å†™è·³æ¿æœºç”¨æˆ·åå¯†ç </h3><p>ç‚¹å‡»ç”¨æˆ·èº«ä»½éªŒè¯ï¼Œå¡«å†™ç™»å½•è·³æ¿æœºçš„<a href="https://so.csdn.net/so/search?q=SSH&spm=1001.2101.3001.7020">SSH</a>ç”¨æˆ·åå’Œå¯†ç å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://typrao-mhd.oss-cn-hangzhou.aliyuncs.com/picture/202306071155281.png" alt="image-20220630163646503"></p><h3 id="5-2-3-é˜²æ­¢è·³æ¿æœºè¿æ¥è¿‡ä¹…è‡ªåŠ¨æ–­å¼€"><a href="#5-2-3-é˜²æ­¢è·³æ¿æœºè¿æ¥è¿‡ä¹…è‡ªåŠ¨æ–­å¼€" class="headerlink" title="5.2.3 é˜²æ­¢è·³æ¿æœºè¿æ¥è¿‡ä¹…è‡ªåŠ¨æ–­å¼€"></a>5.2.3 é˜²æ­¢è·³æ¿æœºè¿æ¥è¿‡ä¹…è‡ªåŠ¨æ–­å¼€</h3><p>ä¸ºé˜²æ­¢è·³æ¿æœºè¿æ¥è¿‡ä¹…è‡ªåŠ¨æ–­å¼€ï¼Œæ‰€ä»¥è¿™é‡Œæ·»åŠ ç™»å½•è„šæœ¬ç›´æ¥å‘é€topå‘½ä»¤ã€‚ç‚¹å‡»ç™»å½•è„šæœ¬ï¼Œå‹¾é€‰ä¸Šæ‰§è¡Œä»¥ä¸‹ç­‰å¾…å¹¶å‘é€è§„åˆ™ï¼Œç‚¹å‡»æ·»åŠ å¼¹å‡ºç­‰å¾…å‘é€è§„åˆ™æ·»åŠ çª—å£ï¼Œåœ¨å‘é€æ¡†å¡«å†™topã€‚å…·ä½“é…ç½®çœ‹å›¾ï¼š</p><p><img src="https://typrao-mhd.oss-cn-hangzhou.aliyuncs.com/picture/202306071155510.png" alt="image-20220630163747497"></p><h3 id="5-2-4-é…ç½®å†…ç½‘éš§é“"><a href="#5-2-4-é…ç½®å†…ç½‘éš§é“" class="headerlink" title="5.2.4 é…ç½®å†…ç½‘éš§é“"></a>5.2.4 <strong>é…ç½®å†…ç½‘éš§é“</strong></h3><p>æ¥ä¸‹æ¥ç»§ç»­é…ç½®è¿æ¥å†…ç½‘æœåŠ¡å™¨çš„éš§é“ï¼Œç‚¹å‡»éš§é“å†ç‚¹å‡»æ·»åŠ æŒ‰é’®è¿›å…¥éš§é“æ·»åŠ é¡µé¢ï¼Œæºä¸»æœºä¸ºæœ¬æœºlocalhostï¼Œä¾¦å¬ç«¯å£å¯ä»¥åœ¨æœ‰æ•ˆèŒƒå›´å†…éšä¾¿å¡«å†™ï¼Œè¿™é‡Œä¸ºäº†åŒºåˆ†è¿æ¥å†…ç½‘å“ªå°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ç”¨å†…ç½‘æœåŠ¡å™¨ipæœ€åä¸€ä½åŠ 22å³522ä½œä¸ºä¾¦å¬ç«¯å£ã€‚ç›®æ ‡ä¸»æœºå°±æ˜¯æˆ‘ä»¬è¦é€šè¿‡è·³æ¿æœºè®¿é—®çš„å†…ç½‘ä¸»æœºï¼Œç«¯å£æ˜¯22ã€‚åŒæ ·çš„æ“ä½œå†é…ç½®ä¸€ä¸ªè¿æ¥192.168.100.6çš„éš§é“ï¼Œç«¯å£ä¸èƒ½ä¸522å†²çªï¼ŒæŒ‰åˆšæ‰çš„è§„åˆ™å¯ä»¥ç”¨622ç«¯å£ã€‚å…·ä½“é…ç½®å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://typrao-mhd.oss-cn-hangzhou.aliyuncs.com/picture/202306071157969.png" alt="image-20220630163839280"></p><h3 id="5-2-5-ç™»å½•è·³æ¿æœºå¹¶è¿æ¥å†…ç½‘æœåŠ¡å™¨"><a href="#5-2-5-ç™»å½•è·³æ¿æœºå¹¶è¿æ¥å†…ç½‘æœåŠ¡å™¨" class="headerlink" title="5.2.5 ç™»å½•è·³æ¿æœºå¹¶è¿æ¥å†…ç½‘æœåŠ¡å™¨"></a>5.2.5 <strong>ç™»å½•è·³æ¿æœºå¹¶è¿æ¥å†…ç½‘æœåŠ¡å™¨</strong></h3><p>åˆ°æ­¤è·³æ¿æœºçš„é…ç½®å·²ç»å®Œæˆäº†ï¼Œä¸‹é¢æ¥å»ºç«‹é€šè¿‡è·³æ¿æœºç™»å½•å†…ç½‘æœåŠ¡å™¨çš„è¿æ¥ä¼šè¯ï¼Œé¦–å…ˆè¿˜æ˜¯è¿›å…¥æ–°å»ºä¼šè¯å±æ€§çª—å£ï¼Œæ³¨æ„ä¸€ä¸‹è¿™æ¬¡çš„é…ç½®ï¼Œä¸»æœºä¸ºlocalhostï¼Œä¾¦å¬ç«¯å£ä¸ºåˆšæ‰çš„522ï¼Œå³è¿™ä¸ªé…ç½®è¿æ¥ä¹‹åæ˜¯è®¿é—®å†…ç½‘çš„192.168.100.5æœåŠ¡å™¨</p><h1 id="6ã€å…è®¸ä»¥rootç”¨æˆ·ç™»å½•æ“ä½œç³»ç»Ÿ"><a href="#6ã€å…è®¸ä»¥rootç”¨æˆ·ç™»å½•æ“ä½œç³»ç»Ÿ" class="headerlink" title="6ã€å…è®¸ä»¥rootç”¨æˆ·ç™»å½•æ“ä½œç³»ç»Ÿ"></a>6ã€<strong>å…è®¸ä»¥rootç”¨æˆ·ç™»å½•æ“ä½œç³»ç»Ÿ</strong></h1><h3 id="6-1-ä¿®æ”¹-etc-gdm3-daemon-confæ–‡ä»¶"><a href="#6-1-ä¿®æ”¹-etc-gdm3-daemon-confæ–‡ä»¶" class="headerlink" title="6.1 ä¿®æ”¹&#x2F;etc&#x2F;gdm3&#x2F;daemon.confæ–‡ä»¶"></a>6.1 ä¿®æ”¹&#x2F;etc&#x2F;gdm3&#x2F;daemon.confæ–‡ä»¶</h3><p>æ–°å¢ä¸‹é¢ä¸€è¡ŒAllowRoot &#x3D; true</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex">[security]<br> <br>AllowRoot = true<br></code></pre></td></tr></table></figure><h4 id="6-2ä¿®æ”¹-etc-pam-d-gdm-password"><a href="#6-2ä¿®æ”¹-etc-pam-d-gdm-password" class="headerlink" title="6.2ä¿®æ”¹&#x2F;etc&#x2F;pam.d&#x2F;gdm-password"></a>6.2ä¿®æ”¹&#x2F;etc&#x2F;pam.d&#x2F;gdm-password</h4><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex">æ³¨é‡Šæ‰ä¸‹é¢å†…å®¹<br><br><span class="hljs-params">#</span>auth required pam<span class="hljs-built_in">_</span>succeed<span class="hljs-built_in">_</span>if.so user != root quiet<span class="hljs-built_in">_</span>success<br></code></pre></td></tr></table></figure><h3 id="6-3ä¿®æ”¹-etc-ssh-sshd-config"><a href="#6-3ä¿®æ”¹-etc-ssh-sshd-config" class="headerlink" title="6.3ä¿®æ”¹&#x2F;etc&#x2F;ssh&#x2F;sshd_config"></a>6.3ä¿®æ”¹&#x2F;etc&#x2F;ssh&#x2F;sshd_config</h3><p>å°†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">PermitRootLogin prohibit-password<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">PermitRootLogin <span class="hljs-built_in">yes</span><br></code></pre></td></tr></table></figure><h1 id="7ã€linuxæ ¼å¼åŒ–ç¡¬ç›˜-æŒ‚è½½"><a href="#7ã€linuxæ ¼å¼åŒ–ç¡¬ç›˜-æŒ‚è½½" class="headerlink" title="7ã€linuxæ ¼å¼åŒ–ç¡¬ç›˜ æŒ‚è½½"></a>7ã€linuxæ ¼å¼åŒ–ç¡¬ç›˜ æŒ‚è½½</h1><h2 id="1ã€æŸ¥çœ‹ç¡¬ç›˜ä¿¡æ¯"><a href="#1ã€æŸ¥çœ‹ç¡¬ç›˜ä¿¡æ¯" class="headerlink" title="1ã€æŸ¥çœ‹ç¡¬ç›˜ä¿¡æ¯"></a>1ã€æŸ¥çœ‹ç¡¬ç›˜ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># fdisk -l</span><br><br>Disk /dev/sda: 146.1 GB, 146163105792 bytes<br><br>255 heads, 63 sectors/track, 17769 cylinders<br><br>Units = cylinders of 16065 * 512 = 8225280 bytes<br><br>    Device Boot       Start          End       Blocks    Id   System<br><br>/dev/sda1    *            1           13       104391    83   Linux<br><br>/dev/sda2               14         5112     40957717+   83   Linux<br><br>/dev/sda3             5113         5243      1052257+   82   Linux swap /<br><br>Solaris<br><br>/dev/sda4             5244        17769    100615095     5   Extended<br><br>/dev/sda5             5244        17769    100615063+   83   Linux<br><br>Disk /dev/sdb: 291.3 GB, 291331192320 bytes<br><br>255 heads, 63 sectors/track, 17769 cylinders<br><br>Units = cylinders of 16065 * 512 = 8225280 bytes<br><br>Disk /dev/sdb1: 291.3 GB, 291331192320 bytes<br></code></pre></td></tr></table></figure><h2 id="2ã€åˆ›å»ºæ–°ç¡¬ç›˜åˆ†åŒº"><a href="#2ã€åˆ›å»ºæ–°ç¡¬ç›˜åˆ†åŒº" class="headerlink" title="2ã€åˆ›å»ºæ–°ç¡¬ç›˜åˆ†åŒº"></a>2ã€åˆ›å»ºæ–°ç¡¬ç›˜åˆ†åŒº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">fdiskå¯ä»¥ç”¨må‘½ä»¤æ¥çœ‹fdiskå‘½ä»¤çš„å†…éƒ¨å‘½ä»¤ï¼›<br><br>aï¼šå‘½ä»¤æŒ‡å®šå¯åŠ¨åˆ†åŒºï¼›<br><br>dï¼šå‘½ä»¤åˆ é™¤ä¸€ä¸ªå­˜åœ¨çš„åˆ†åŒºï¼›<br><br>lï¼šå‘½ä»¤æ˜¾ç¤ºåˆ†åŒºIDå·çš„åˆ—è¡¨ï¼›<br><br>mï¼šæŸ¥çœ‹fdiskå‘½ä»¤å¸®åŠ©ï¼›<br><br>nï¼šå‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°åˆ†åŒºï¼›<br><br>pï¼šå‘½ä»¤æ˜¾ç¤ºåˆ†åŒºåˆ—è¡¨ï¼›<br><br>tï¼šå‘½ä»¤ä¿®æ”¹åˆ†åŒºçš„ç±»å‹IDå·ï¼›<br><br>wï¼šå‘½ä»¤æ˜¯å°†å¯¹åˆ†åŒºè¡¨çš„ä¿®æ”¹å­˜ç›˜è®©å®ƒå‘ç”Ÿä½œç”¨ã€‚<br><br> <span class="hljs-comment">#fdisk /dev/sdb</span><br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>):n<br><br>Command action<br><br>ã€€ã€€   e    extended    //è¾“å…¥eä¸ºåˆ›å»ºæ‰©å±•åˆ†åŒº<br><br>ã€€ã€€   p    primary partition (1-4)<br><br>Partion number(1-4)ï¼š1<br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): w<br><br>è¾“å…¥nå›è½¦ï¼Œå†è¾“å…¥på›è½¦ï¼Œå†è¾“å‡º1å›è½¦ï¼Œä¸€è·¯å›è½¦ï¼Œæœ€åè¾“å…¥wå›è½¦ä¿å­˜ã€‚<br><br>æŸ¥çœ‹ä¸€ä¸‹ï¼š<br><br>fdisk -l<br><br>å¯ä»¥çœ‹åˆ°/dev/sdb1åˆ†åŒº<br></code></pre></td></tr></table></figure><h2 id="3ã€æ ¼å¼åŒ–åˆ†åŒº"><a href="#3ã€æ ¼å¼åŒ–åˆ†åŒº" class="headerlink" title="3ã€æ ¼å¼åŒ–åˆ†åŒº"></a>3ã€æ ¼å¼åŒ–åˆ†åŒº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkfs.ext3 /dev/sdb1<br></code></pre></td></tr></table></figure><h2 id="4ã€åˆ›å»º-data1ç›®å½•ï¼š"><a href="#4ã€åˆ›å»º-data1ç›®å½•ï¼š" class="headerlink" title="4ã€åˆ›å»º&#x2F;data1ç›®å½•ï¼š"></a>4ã€åˆ›å»º&#x2F;data1ç›®å½•ï¼š</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> /data1<br></code></pre></td></tr></table></figure><h2 id="5ã€æŒ‚è½½åˆ†åŒº"><a href="#5ã€æŒ‚è½½åˆ†åŒº" class="headerlink" title="5ã€æŒ‚è½½åˆ†åŒº"></a>5ã€æŒ‚è½½åˆ†åŒº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount /dev/sdb1 /data1<br></code></pre></td></tr></table></figure><h2 id="6ã€é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½"><a href="#6ã€é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½" class="headerlink" title="6ã€é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½"></a>6ã€é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">å› ä¸ºmountæŒ‚è½½åœ¨é‡å¯æœåŠ¡å™¨åä¼šå¤±æ•ˆï¼Œæ‰€ä»¥éœ€è¦å°†åˆ†åŒºä¿¡æ¯å†™åˆ°/etc/fstabæ–‡ä»¶ä¸­è®©å®ƒæ°¸ä¹…æŒ‚è½½ï¼š<br><br>vi /etc/fstab<br><br>åŠ å…¥ï¼š<br><br>LABEL=/data1             /data1                   ext3     defaults         1 2<br><br>æŸ¥çœ‹<span class="hljs-built_in">cat</span> /etc/fstab<br><br>LABEL=/                  /                        ext3     defaults         1 1<br><br>LABEL=/data              /data                    ext3     defaults         1 2<br><br>LABEL=/data1             /data1                   ext3     defaults         1 2<br><br>LABEL=/boot              /boot                    ext3     defaults         1 2<br><br>tmpfs                    /dev/shm                 tmpfs    defaults         0 0<br><br>devpts                   /dev/pts                 devpts   gid=5,mode=620   0 0<br><br>sysfs                    /sys                     sysfs    defaults         0 0<br><br>proc                     /proc                    proc     defaults         0 0<br><br>LABEL=SWAP-hda3          swap                     swap     defaults         0 0<br><br>é‡å¯ç³»ç»Ÿ<br></code></pre></td></tr></table></figure><h1 id="8-opensslç”Ÿæˆè¯ä¹¦æ–‡ä»¶"><a href="#8-opensslç”Ÿæˆè¯ä¹¦æ–‡ä»¶" class="headerlink" title="8 opensslç”Ÿæˆè¯ä¹¦æ–‡ä»¶"></a>8 opensslç”Ÿæˆè¯ä¹¦æ–‡ä»¶</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">ç­¾ç½²è¯ä¹¦æ—¶ä¸èƒ½ç›´æ¥ç»‘å®š IP åœ°å€ï¼Œå› ä¸ºè¯ä¹¦æ˜¯ç”¨äºç¡®è®¤åŸŸåçš„èº«ä»½ï¼Œè€Œä¸æ˜¯ç‰¹å®šçš„ IP åœ°å€ã€‚<br><br>ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨è¯ä¹¦ä¸­çš„ SANï¼ˆSubject Alternative Nameï¼‰æ‰©å±•æ¥ç»‘å®šå¤šä¸ªåŸŸåå’Œ IP åœ°å€ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ç”Ÿæˆ CSR æ–‡ä»¶æ—¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š<br><br>openssl req -newkey rsa:2048 -nodes -keyout mykey.key -out mycsr.csr -subj <span class="hljs-string">&quot;/C=US/ST=California/L=San Francisco/O=Example Inc./CN=example.com/subjectAltName=DNS:example.com,IP:0.0.0.0&quot;</span><br><br>ä»¥ä¸Šå‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„ CSR æ–‡ä»¶ï¼š<br><br>    ä¸»åŸŸåï¼šexample.com<br>    IP åœ°å€ï¼š0.0.0.0<br><br>é¢å‘æœºæ„å°†ä½¿ç”¨è¯¥ CSR ç­¾ç½²è¯ä¹¦ï¼Œå¹¶åœ¨è¯ä¹¦ä¸­åŒ…æ‹¬ä¸»åŸŸåå’Œ IP åœ°å€çš„ä¿¡æ¯ã€‚<br><br>ä½¿ç”¨ OpenSSL ç”Ÿæˆ p12 æ ¼å¼è¯ä¹¦å¹¶é…ç½®çš„è¯¦ç»†ç¤ºä¾‹ï¼š<br><br>    é¦–å…ˆï¼Œç”Ÿæˆä¸€å¯¹ç§é’¥å’Œè¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼š<br><br>openssl req -newkey rsa:2048 -nodes -keyout mykey.key -out mycsr.csr<br><br>    æ‚¨éœ€è¦è¾“å…¥ä¸€äº›ä¿¡æ¯ï¼Œå¦‚å›½å®¶ã€çœä»½ã€åŸå¸‚ã€ç»„ç»‡åç§°ç­‰ï¼Œè¯ä¹¦è¯·æ±‚æ–‡ä»¶ mycsr.csr å°†ä½¿ç”¨è¿™äº›ä¿¡æ¯ç”Ÿæˆã€‚<br><br>    ä½¿ç”¨ç§é’¥å’Œè¯ä¹¦è¯·æ±‚æ–‡ä»¶ç”Ÿæˆè¯ä¹¦ï¼š<br><br>openssl x509 -req -days 365 -<span class="hljs-keyword">in</span> mycsr.csr -signkey mykey.key -out mycert.crt<br><br>    æœ€åï¼Œä½¿ç”¨è¯ä¹¦å’Œç§é’¥ç”Ÿæˆ p12 æ ¼å¼è¯ä¹¦ï¼š<br><br>openssl pkcs12 -<span class="hljs-built_in">export</span> -<span class="hljs-keyword">in</span> mycert.crt -inkey mykey.key -out mycert.p12<br><br>    æ‚¨éœ€è¦è¾“å…¥ä¸€ä¸ªå¯†ç ï¼Œè¯¥å¯†ç å°†ç”¨äºä¿æŠ¤ p12 è¯ä¹¦çš„å®‰å…¨ã€‚è¯·è®°ä½æ‚¨è¾“å…¥çš„å¯†ç ï¼Œå› ä¸ºæ‚¨å°†éœ€è¦åœ¨ä½¿ç”¨è¯ä¹¦æ—¶è¾“å…¥è¯¥å¯†ç ã€‚<br>    <br> <br></code></pre></td></tr></table></figure><p>è„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment"># FastAPI é€‚é…è¯ä¹¦ç”Ÿæˆè„šæœ¬</span><br><span class="hljs-comment"># ç”ŸæˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¯ä¹¦ï¼Œé€‚åˆ FastAPI HTTPS å’ŒåŒå‘è®¤è¯</span><br><br><span class="hljs-comment"># è®¾ç½®å˜é‡</span><br>OUTPUT_DIR=<span class="hljs-string">&quot;/root/mhd/ssl&quot;</span><br>DOMAIN=<span class="hljs-string">&quot;FastAPI_Server&quot;</span><br>CLIENT_DOMAIN=<span class="hljs-string">&quot;FastAPI_Client&quot;</span><br>DAYS=$(( (<span class="hljs-number">2999</span> - $(date +&quot;%Y&quot;)) * 365 ))<br><br><span class="hljs-comment"># åˆ›å»ºè¾“å‡ºç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$OUTPUT_DIR</span>&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-string">&quot;<span class="hljs-variable">$OUTPUT_DIR</span>&quot;</span> || <span class="hljs-built_in">exit</span><br><br><span class="hljs-comment"># ç”Ÿæˆ CA ç§é’¥å’Œè‡ªç­¾åè¯ä¹¦</span><br>openssl genrsa -out ca.key 2048<br>openssl req -new -x509 -key ca.key -out ca.crt -days <span class="hljs-string">&quot;<span class="hljs-variable">$DAYS</span>&quot;</span> \<br>    -subj <span class="hljs-string">&quot;/C=CN/ST=State/L=City/O=FastAPI Org/OU=Dev/CN=FastAPI Root CA&quot;</span><br><br><span class="hljs-comment"># ç”ŸæˆæœåŠ¡ç«¯ç§é’¥å’Œè¯ä¹¦è¯·æ±‚</span><br>openssl genrsa -out server.key 2048<br>openssl req -new -key server.key -out server.csr \<br>    -subj <span class="hljs-string">&quot;/C=CN/ST=State/L=City/O=FastAPI Org/OU=Server/CN=<span class="hljs-variable">$DOMAIN</span>&quot;</span><br><br><span class="hljs-comment"># åˆ›å»ºæœåŠ¡ç«¯è¯ä¹¦æ‰©å±•é…ç½®æ–‡ä»¶</span><br><span class="hljs-built_in">cat</span> &gt; server.ext &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">authorityKeyIdentifier=keyid,issuer</span><br><span class="hljs-string">basicConstraints=CA:FALSE</span><br><span class="hljs-string">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class="hljs-string">extendedKeyUsage = serverAuth</span><br><span class="hljs-string">subjectAltName = @alt_names</span><br><span class="hljs-string"></span><br><span class="hljs-string">[alt_names]</span><br><span class="hljs-string">DNS.1 = $DOMAIN</span><br><span class="hljs-string">DNS.2 = localhost</span><br><span class="hljs-string">IP.1 = 127.0.0.1</span><br><span class="hljs-string">IP.2 = ::1</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment"># ç­¾å‘æœåŠ¡ç«¯è¯ä¹¦</span><br>openssl x509 -req -<span class="hljs-keyword">in</span> server.csr -CA ca.crt -CAkey ca.key -CAcreateserial \<br>    -out server.crt -days <span class="hljs-string">&quot;<span class="hljs-variable">$DAYS</span>&quot;</span> -extfile server.ext<br><br><span class="hljs-comment"># ç”Ÿæˆå®¢æˆ·ç«¯ç§é’¥å’Œè¯ä¹¦è¯·æ±‚</span><br>openssl genrsa -out client.key 2048<br>openssl req -new -key client.key -out client.csr \<br>    -subj <span class="hljs-string">&quot;/C=CN/ST=State/L=City/O=FastAPI Org/OU=Client/CN=<span class="hljs-variable">$CLIENT_DOMAIN</span>&quot;</span><br><br><span class="hljs-comment"># åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦æ‰©å±•é…ç½®æ–‡ä»¶</span><br><span class="hljs-built_in">cat</span> &gt; client.ext &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">authorityKeyIdentifier=keyid,issuer</span><br><span class="hljs-string">basicConstraints=CA:FALSE</span><br><span class="hljs-string">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class="hljs-string">extendedKeyUsage = clientAuth</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment"># ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦</span><br>openssl x509 -req -<span class="hljs-keyword">in</span> client.csr -CA ca.crt -CAkey ca.key \<br>    -out client.crt -days <span class="hljs-string">&quot;<span class="hljs-variable">$DAYS</span>&quot;</span> -extfile client.ext<br><br><span class="hljs-comment"># ç”ŸæˆPEMæ ¼å¼æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰</span><br><span class="hljs-built_in">cat</span> server.key server.crt &gt; server.pem<br><span class="hljs-built_in">cat</span> client.key client.crt &gt; client.pem<br><br><span class="hljs-comment"># æ¸…ç†ä¸´æ—¶æ–‡ä»¶</span><br><span class="hljs-built_in">rm</span> -f server.csr client.csr server.ext client.ext ca.srl<br><br><span class="hljs-comment"># è®¾ç½®æƒé™</span><br><span class="hljs-built_in">chmod</span> 600 *.key<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;==============================================&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;è¯ä¹¦ç”Ÿæˆå®Œæˆï¼æ–‡ä»¶ä¿å­˜åœ¨ <span class="hljs-variable">$OUTPUT_DIR</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;==============================================&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æœåŠ¡ç«¯è¯ä¹¦:&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;  server.key - æœåŠ¡ç«¯ç§é’¥&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;  server.crt - æœåŠ¡ç«¯è¯ä¹¦&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;  server.pem - ç§é’¥+è¯ä¹¦ç»„åˆ&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;----------------------------------------------&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;å®¢æˆ·ç«¯è¯ä¹¦:&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;  client.key - å®¢æˆ·ç«¯ç§é’¥&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;  client.crt - å®¢æˆ·ç«¯è¯ä¹¦&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;  client.pem - ç§é’¥+è¯ä¹¦ç»„åˆ&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;----------------------------------------------&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;CAè¯ä¹¦:&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;  ca.key - CAç§é’¥ï¼ˆå®‰å…¨ä¿å­˜ï¼‰&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;  ca.crt - CAæ ¹è¯ä¹¦ï¼ˆç”¨äºä¿¡ä»»é“¾ï¼‰&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;==============================================&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ–‡ä»¶åˆ—è¡¨:&quot;</span><br><span class="hljs-built_in">ls</span> -l<br></code></pre></td></tr></table></figure><h1 id="9ã€condaä½¿ç”¨"><a href="#9ã€condaä½¿ç”¨" class="headerlink" title="9ã€condaä½¿ç”¨"></a>9ã€condaä½¿ç”¨</h1><h2 id="condaæ˜¯ä¸€æ¬¾è½¯ä»¶ç®¡ç†å·¥å…·"><a href="#condaæ˜¯ä¸€æ¬¾è½¯ä»¶ç®¡ç†å·¥å…·" class="headerlink" title="condaæ˜¯ä¸€æ¬¾è½¯ä»¶ç®¡ç†å·¥å…·"></a>condaæ˜¯ä¸€æ¬¾è½¯ä»¶ç®¡ç†å·¥å…·</h2><ul><li>miniconda åªåŒ…å«äº†condaã€pythonã€å’Œä¸€äº›å¿…å¤‡çš„è½¯ä»¶å·¥å…·</li><li>anaconda åŒ…å«äº†æ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ è¦ç”¨åˆ°çš„å¾ˆå¤šè½¯ä»¶</li></ul><p>å¸¸è§å¼€å‘ä½¿ç”¨minicondaå³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget -c https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-latest-Linux-x86_64.sh --no-check-certificate<br><span class="hljs-comment"># ä¸‹è½½minicoda -cå‚æ•°æä¾›ç«¯ç‚¹ç»­ä¼ </span><br>bash Miniconda3-latest-Linux-x86_64.sh <span class="hljs-comment">#æ‰§è¡Œè„šæœ¬å®‰è£…</span><br>conda init<span class="hljs-comment">#conda åˆå§‹åŒ–</span><br>conda create -n your_env_name python=3.9<span class="hljs-comment">#conda åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span><br>conda activate your_env_name<span class="hljs-comment">#condaæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span><br>conda config --add envs_dirs newdir <span class="hljs-comment">#å¢åŠ ç¯å¢ƒè·¯å¾„newdir</span><br>conda <span class="hljs-built_in">env</span> list<span class="hljs-comment">#æŸ¥çœ‹æœ‰å“ªäº›è™šæ‹Ÿè·¯å¾„ä»¥åŠå®ƒä»¬çš„å­˜å‚¨è·¯å¾„ï¼Œ* å·è¡¨ç¤ºå½“å‰æ‰€å¤„çš„ç¯å¢ƒ</span><br>conda <span class="hljs-built_in">env</span> remove --name PySanic<span class="hljs-comment">#åˆ é™¤è™šæ‹Ÿç¯å¢ƒ</span><br>deactivate<span class="hljs-comment"># é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</span><br>conda update conda<span class="hljs-comment"># condaå‡çº§</span><br>conda config --show<span class="hljs-comment"># æ˜¾ç¤ºé…ç½®ä¿¡æ¯</span><br><span class="hljs-comment">## è®¾ç½®æ¸…åé•œåƒæº</span><br>sudo vim ~/.condarc<br><br>å°†ä»¥ä¸‹å†…å®¹è¦†ç›–â€™.codnarcâ€™æ–‡ä»¶é‡Œé¢æ‰€æœ‰å†…å®¹<br>channels:<br>  - defaults<br>show_channel_urls: <span class="hljs-literal">true</span><br>default_channels:<br>  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main<br>  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r<br>  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2<br>custom_channels:<br>  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud<br>  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud<br>  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud<br>  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud<br>  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud<br>  pytorch-lts: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud<br>  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud<br>  deepmodeling: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/<br>  <br> <span class="hljs-comment"># é…ç½®å®Œæ¸…é™¤ç´¢å¼•ç¼“å­˜</span><br> conda clean -i<br><br><span class="hljs-comment"># å¸è½½Anaconda</span><br><span class="hljs-built_in">rm</span> -rf ~/anaconda3<br></code></pre></td></tr></table></figure><p><strong>å…³é—­åˆå§‹åŒ–conda</strong></p><p>æŸ¥çœ‹é…ç½®</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">conda <span class="hljs-built_in">config</span> <span class="hljs-comment">--show | grep auto_activate_base</span><br></code></pre></td></tr></table></figure><p>å…³é—­åˆå§‹åŒ–</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">conda<span class="hljs-built_in"> config </span>--<span class="hljs-built_in">set</span> auto_activate_base <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h1 id="10-gitä½¿ç”¨"><a href="#10-gitä½¿ç”¨" class="headerlink" title="10 gitä½¿ç”¨"></a>10 gitä½¿ç”¨</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs shell">git branch [branch name]#åˆ›å»ºæœ¬åœ°åˆ†æ”¯<br>git checkout [branch name]#åˆ‡æ¢åˆ°æ–°åˆ†æ”¯<br>git checkout -b [branch name#åˆ›å»ºåˆ†æ”¯åŒæ—¶ä¹Ÿåˆ‡æ¢åˆ†æ”¯<br>git stash # æš‚å­˜æ–‡ä»¶<br>git stash list # æŸ¥çœ‹stashäº†å“ªäº›å­˜å‚¨<br>git stash apply stash@&#123;$num&#125;# åº”ç”¨æŸä¸ªå‚¨å­˜<br>git stash pop# æ¢å¤ç¼“å­˜ä¹‹å‰<br>git stash drop stash@&#123;$num&#125;# ä¸¢å¼ƒstash@&#123;$num&#125;å­˜å‚¨ï¼Œä»åˆ—è¡¨ä¸­åˆ é™¤è¿™ä¸ªå­˜å‚¨<br>git stash clear# åˆ é™¤æ‰€æœ‰ç¼“å­˜çš„stash<br>git branch -d [branch-name]# åˆ é™¤æœ¬åœ°åˆ†æ”¯<br>git branch -vv     # æŸ¥çœ‹åˆ†æ”¯çŠ¶æ€<br>git fetch --prune  # æ›´æ–°è¿œç¨‹å¼•ç”¨ï¼š é¦–å…ˆï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ›´æ–°æ‚¨çš„æœ¬åœ°ä»“åº“å¹¶è‡ªåŠ¨åˆ é™¤æœ¬åœ°å¯¹å·²åˆ é™¤è¿œç¨‹åˆ†æ”¯çš„å¼•ç”¨ï¼š<br>git branch --unset-upstream    # åˆ é™¤æœ¬åœ°åˆ†æ”¯çš„è¿œç¨‹å¼•ç”¨<br>git push -u origin feature-1010250-mhdï¼ˆæ¨èåŒåï¼‰# æ¨é€æœ¬åœ°åˆ†æ”¯åˆ°è¿œç¨‹åˆ†æ”¯ï¼ˆè‡ªåŠ¨è®¾ç½®è·Ÿè¸ªï¼‰<br><br>é¡¹ç›®ç›®å½•åˆ›å»º .gitignore æ–‡ä»¶ å¿½ç•¥å¢åŠ åˆ°gitçš„ç›®å½•æˆ–è€…æ–‡ä»¶<br>git rm --cached -r ./test/# åˆ é™¤å¢åŠ è¿‡çš„æ–‡ä»¶æˆ–è€…ç›®å½•ç¼“å­˜<br>git revert &lt;commit-hash&gt;# æ’¤é”€æäº¤<br>git reset [--mixed/soft/hard] HEAD^   æ’¤é”€ä¸Šæ¬¡çš„æäº¤<br>//å¦‚æœæƒ³æ’¤é”€Næ¬¡commit,ä½¿ç”¨HEAD~N<br>1ã€--mixed   ä¸åˆ é™¤å·¥ä½œç©ºé—´æ”¹åŠ¨ä»£ç ï¼Œæ’¤é”€commitï¼Œå¹¶ä¸”æ’¤é”€git add .æ“ä½œã€‚è¿™ä¸ªä¸ºé»˜è®¤å‚æ•°,git reset --mixed HEAD^ å’Œgit reset HEAD^ æ•ˆæœç›¸åŒ<br>2ã€--soft    ä¸åˆ é™¤å·¥ä½œç©ºé—´æ”¹åŠ¨ä»£ç ï¼Œæ’¤é”€commitï¼Œä¸æ’¤é”€git add .<br>3ã€--hard    åˆ é™¤å·¥ä½œç©ºé—´æ”¹åŠ¨ä»£ç ï¼Œæ’¤é”€commitï¼Œæ’¤é”€git add . æ³¨æ„å®Œæˆè¿™ä¸ªæ“ä½œåï¼Œå°±æ¢å¤åˆ°äº†ä¸Šä¸€æ¬¡çš„commitçŠ¶æ€<br><br>Tips:å¦‚æœåªæ˜¯æƒ³æ›´æ”¹æäº¤çš„æ³¨é‡Šä¿¡æ¯,ä½¿ç”¨git commit --amend å³å¯è¿›å…¥vimç¼–è¾‘å™¨ä¿®æ”¹,ä¸ç”¨æ’¤é”€commitæ“ä½œ<br><br>git log    è·å–å†å²æäº¤çš„ç‰ˆæœ¬å·     Tips:ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®çš„.git/logs/refs/heads/masteræ–‡ä»¶ä¸­æŸ¥çœ‹æ“ä½œæ—¥å¿—<br>git reset --hard e7a98b4eabc91afebd7e3f3d7c474276146c6c2f(ç‰ˆæœ¬å·)    æ¢å¤åˆ°æŒ‡å®šçš„å†å²ç‰ˆæœ¬<br><br>//å¦‚æœéœ€è¦åŒæ­¥è¿œç¨‹<br>git push origin source -f    å¼ºåˆ¶ push æ›´æ–°è¿œç¨‹åˆ†æ”¯<br><br>git revert æ˜¯ä¸€ç§æ›´å®‰å…¨ã€æ›´é€æ˜çš„æ’¤é”€æ–¹å¼ï¼Œå› ä¸ºå®ƒä¿ç•™äº†å†å²çš„å®Œæ•´æ€§ï¼Œé€‚ç”¨äºå…¬å¼€çš„ã€å·²æ¨é€çš„æäº¤ã€‚<br>git reset æä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’Œæ§åˆ¶ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†æ›´å¤§çš„é£é™©ï¼Œå°¤å…¶æ˜¯åœ¨å¤šäººåä½œçš„ç¯å¢ƒä¸­ã€‚<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‹ç¼©æäº¤ï¼ˆå¯åœ¨æ“ä½œå‰ æäº¤checkout ä¸€ä¸ªå¤‡ä»½åˆ†æ”¯ å‡ºç°é—®é¢˜å›æ»šï¼‰</span><br>git rebase -i HEAD<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‹ç¼©æœ€åä¸¤æ¡æäº¤è®°å½• é¿å…è¿‡å¤šé‡å¤æäº¤è®°å½• æ‰§è¡Œå‘½ä»¤ä¹‹å  é™¤ç¬¬ä¸€è¡Œçš„æ”¹æˆsæˆ–è€…squash ä¿å­˜é€€å‡ºå³å¯</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¼šæç¤ºä¸€ä¸ªä¿ç•™è®°å½•çš„çª—å£ æ ¹æ®éœ€æ±‚ä¿ç•™å³å¯</span><br>git rebase -i HEAD~2    <br>git push --force origin &lt;branch_name&gt;         #  å¼ºåˆ¶æäº¤<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">git cherry-pick  åˆå¹¶æäº¤</span><br>A feature-1035635-mhd-back<br>B feature-1035635-mhd<br><span class="hljs-meta prompt_"># </span><span class="language-bash">éœ€è¦å°† Aåˆ†æ”¯çš„æŸä¸ªæäº¤åˆå¹¶åˆ°Båˆ†æ”¯</span><br>git checkout feature-1035635-mhd        # åˆ‡æ¢åˆ°éœ€è¦è¢«åˆå…¥çš„åˆ†æ”¯<br>git log feature-1035635-mhd-back        # æŸ¥çœ‹ æä¾› æäº¤è®°å½•çš„ åˆ†æ”¯log<br>    commit 059d894191fa81debf01466aa09de34e10855596 (feature-1035635-mhd-back)<br>    Author: mhd_z82303 &lt;82303@sangfor.com&gt;<br>    Date:   Tue Jul 8 14:45:32 2025 +0800<br>    <br>    [ADD]å¢åŠ é™µè¿¦èœœç½è§„åˆ™_3098<br><br>git cherry-pick 059d8941        # æ ¹æ®commit idè¿›è¡Œ æäº¤åˆå¹¶<br>git cherry-pick &#123;a_id&#125;^..&#123;b_id&#125;    # æ”¯æŒèŒƒå›´æäº¤åˆå¹¶<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚æœå‡ºç°å†²çª å’Œmerge ä¸€æ ·å¤„ç† è¯¥ addå°±add è§£å†³å†²çª å¯ä»¥ä¸ä¿®æ”¹commitä¿¡æ¯</span><br>git cherry-pick --continue    # è§£å†³å†²çªä¹‹å ç»§ç»­åˆå¹¶<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">git merge å’Œgit rebase åŒºåˆ«</span><br>    # git merge å‘½ä»¤ä¼šå°† ä¿©ä¸ªåˆ†æ”¯ çš„å†å²è®°å½•åˆå¹¶æˆä¸€ä¸ªæ–°çš„æäº¤ å®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åˆå¹¶æäº¤ è¯¥æäº¤åŒ…å«ä¸¤ä¸ªåˆ†æ”¯çš„æ‰€æœ‰æ›´æ”¹<br>    # ã€‚è¿™ç§åˆå¹¶æ–¹å¼ä¼šä¿ç•™åŸå§‹åˆ†æ”¯çš„å†å²è®°å½•ã€‚<br>    <br>    # git rebase å‘½ä»¤ä¼šå°†å½“å‰åˆ†æ”¯çš„æäº¤â€œé‡æ–°æ’­æ”¾â€ åˆ°å¦ä¸€ä¸ªåˆ†æ”¯çš„é¡¶éƒ¨ã€‚ä»–ä¼šå°†å½“å‰çš„æäº¤æŒ‰ç…§é¡ºåºåº”ç”¨åˆ°ç›®æ ‡åˆ†æ”¯ä¸Šï¼Œä»è€Œ<br>    # åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤å†å²è®°å½•ã€‚è¿™ç§åˆå¹¶æ–¹å¼ä¼šä½¿æäº¤å†å²è®°å½•æ›´åŠ çº¿æ€§ã€‚å› ä¸ºå®ƒä¼šå°†å½“å‰åˆ†æ”¯çš„æäº¤åº”ç”¨åˆ°ç›®æ ‡åˆ†æ”¯çš„é¡¶éƒ¨ï¼Œè€Œ<br>    # ä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„åˆå¹¶æäº¤ã€‚è¿™ç§æ–¹å¼å¯ä»¥æ˜¯æäº¤å†å²è®°å½•æ›´åŠ æ¸…æ™°ï¼Œä½†ä¹Ÿå¯èƒ½å¯¼è‡´å†²çªå’Œåˆå¹¶é—®é¢˜ã€‚<br>        <br></code></pre></td></tr></table></figure><h1 id="11-å®‰è£…docker"><a href="#11-å®‰è£…docker" class="headerlink" title="11 å®‰è£…docker"></a>11 å®‰è£…docker</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£docker</span><br>yum install -y yum-utils device-mapper-persistent-data net-tools telnet<br>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br>yum -y install docker-ce.x86_64 <br>systemctl start docker <br>systemctl enable docker<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£docker-compose(ä¸Šä¼ docker-compose,ç§»åŠ¨åˆ°/usr/local/binç›®å½•ä¸‹ï¼Œå¹¶æˆæƒ)</span><br>mv docker-compose /usr/local/bin/<br>chmod +x /usr/local/bin/docker-compose<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…docker-compose</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸‹è½½æœ€æ–°docker-compose ä¿å­˜åˆ°/usr/local/bin/docker-compose</span><br>sudo curl -L &quot;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æˆæƒ</span><br>sudo chmod +x /usr/local/bin/docker-compose<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¸è½½</span><br>sudo rm /usr/local/bin/docker-compose<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦æœ‰dockerç”¨æˆ·ç»„</span><br>cat /etc/group ï½œ grep docker<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ²¡æœ‰çš„è¯æ·»åŠ </span><br>sudo groupadd docker<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç»„</span><br>sudo usermod -aG docker $USER<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ›´æ–°ç”¨æˆ·ç»„</span><br>newgrp docker                      <br></code></pre></td></tr></table></figure><h3 id="dockeré…ç½®é•œåƒåŠ é€Ÿæ–¹æ¡ˆ"><a href="#dockeré…ç½®é•œåƒåŠ é€Ÿæ–¹æ¡ˆ" class="headerlink" title="dockeré…ç½®é•œåƒåŠ é€Ÿæ–¹æ¡ˆ"></a>dockeré…ç½®é•œåƒåŠ é€Ÿæ–¹æ¡ˆ</h3><p>ç”±äºå›½å†…é•œåƒæºå˜åŠ¨å°ç¦é—®é¢˜ æ¨èä½¿ç”¨ <a href="https://1ms.run/">æ¯«ç§’é•œåƒ</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">    &quot;registry-mirrors&quot;:[</span><br><span class="hljs-string">        &quot;https://hub.uuuadc.top&quot;,</span><br><span class="hljs-string">        &quot;https://docker.anyhub.us.kg&quot;,</span><br><span class="hljs-string">        &quot;https://dockerhub.jobcher.com&quot;,</span><br><span class="hljs-string">        &quot;https://dockerhub.icu&quot;,</span><br><span class="hljs-string">        &quot;https://docker.ckyl.me&quot;,</span><br><span class="hljs-string">        &quot;https://docker.awsl9527.cn&quot;</span><br><span class="hljs-string">    ],</span><br><span class="hljs-string">    &quot;data-root&quot;:&quot;/home/dockerdate&quot;,</span><br><span class="hljs-string">    &quot;log-driver&quot;:&quot;json-file&quot;,</span><br><span class="hljs-string">    &quot;log-opts&quot;:&#123;</span><br><span class="hljs-string">        &quot;max-size&quot;:&quot;512m&quot;,&quot;max-file&quot;:&quot;3&quot;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;&#x27;</span> | sudo <span class="hljs-built_in">tee</span> /etc/docker/daemon.json<br></code></pre></td></tr></table></figure><p>é‡å¯docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl restart docker<br></code></pre></td></tr></table></figure><h1 id="12ã€Debianå®‰è£…Wireshark"><a href="#12ã€Debianå®‰è£…Wireshark" class="headerlink" title="12ã€Debianå®‰è£…Wireshark"></a>12ã€Debianå®‰è£…Wireshark</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">1.æ‰“å¼€ç»ˆç«¯å¹¶ä»¥rootç”¨æˆ·èº«ä»½ç™»å½•ã€‚<br><br>2. è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥æ·»åŠ Wiresharkçš„è½¯ä»¶æºï¼š <br>echo &quot;deb http://deb.debian.org/debian buster main&quot; &gt;&gt; /etc/apt/sources.list<br>echo &quot;deb-src http://deb.debian.org/debian buster main&quot; &gt;&gt; /etc/apt/sources.list<br>echo &quot;deb http://security.debian.org/debian-security buster/updates main&quot; &gt;&gt; /etc/apt/sources.list<br>echo &quot;deb-src http://security.debian.org/debian-security buster/updates main&quot; &gt;&gt; /etc/apt/sources.list <br><br>3. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š apt-get update <br>4. ç°åœ¨ï¼Œæ‚¨åº”è¯¥å¯ä»¥å®‰è£…Wiresharkäº†ï¼š  apt-get install wireshark tshark -y<br></code></pre></td></tr></table></figure><h1 id="13-Kafkaå‘½ä»¤"><a href="#13-Kafkaå‘½ä»¤" class="headerlink" title="13 Kafkaå‘½ä»¤"></a>13 Kafkaå‘½ä»¤</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">1ã€ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ Kafka ä¸»é¢˜ï¼š<br>kafka-topics.sh --list --bootstrap-server localhost:9092<br>2ã€åˆªé™¤ä¸»é¡Œ<br>kafka-topics.sh --delete --bootstrap-server localhost:9092 --topic your_topic_name<br>3ã€åˆ›å»ºä¸»é¢˜<br>kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic my-topic<br><br>    --createï¼šåˆ›å»ºä¸€ä¸ªæ–°ä¸»é¢˜ã€‚<br>    --bootstrap-serverï¼šæŒ‡å®šè¦ç”¨äºè¿æ¥åˆ° Kafka é›†ç¾¤çš„å¼•å¯¼æœåŠ¡å™¨åœ°å€ã€‚è¿™åº”è¯¥æ˜¯ Kafka æ¶ˆæ¯ä»£ç†çš„ä¸»æœºåå’Œç«¯å£å·ï¼Œä¾‹å¦‚ localhost:9092ã€‚<br>    --replication-factorï¼šæŒ‡å®šè¦ä¸ºæ¯ä¸ªåˆ†åŒºä¿ç•™å¤šå°‘ä¸ªå‰¯æœ¬ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸å°†å‰¯æœ¬å› å­è®¾ç½®ä¸º 2 æˆ–æ›´é«˜ï¼Œä»¥ç¡®ä¿æ•°æ®å†—ä½™æ€§å’Œé«˜å¯ç”¨æ€§ã€‚å•ä¸€å‰¯æœ¬çš„ä¸»é¢˜åªæœ‰åœ¨æµ‹è¯•æˆ–å¼€å‘ç¯å¢ƒä¸­æ‰æœ‰æ„ä¹‰ã€‚<br>    --partitionsï¼šæŒ‡å®šè¦ä¸ºä¸»é¢˜åˆ›å»ºçš„åˆ†åŒºæ•°ã€‚å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œè¯·åœ¨ç”Ÿäº§ä¸­åˆ›å»ºå¤šä¸ªåˆ†åŒºä»¥æ”¯æŒæ›´å¥½çš„ä¼¸ç¼©æ€§å’Œååé‡ã€‚<br>    --topicï¼šæŒ‡å®šè¦åˆ›å»ºçš„ä¸»é¢˜åç§°ã€‚<br></code></pre></td></tr></table></figure><h1 id="14-k8sç›¸å…³å‘½ä»¤"><a href="#14-k8sç›¸å…³å‘½ä»¤" class="headerlink" title="14 k8sç›¸å…³å‘½ä»¤"></a>14 k8sç›¸å…³å‘½ä»¤</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">1ã€ æŸ¥çœ‹èŠ‚ç‚¹<br>kubectl get nodes<br>2ã€æŸ¥çœ‹Pod<br> kubectl get pods<br>3ã€åˆ é™¤Pods<br>kubectl delete pod &lt;pod-name&gt;<br>4ã€k8sæŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´<br>kubectl get namespaces<br>5ã€åˆ‡æ¢è¿›å…¥å‘½åç©ºé—´<br>kubectl config set-context --current --namespace=&lt;namespace&gt;<br>6ã€æŸ¥çœ‹services<br>kubectl get services<br>7ã€åˆªé™¤å‘½åç©ºé—´<br>kubectl delete namespace &lt;namespace-name&gt;<br>8ã€åˆ›å»ºå‘½ä»¤ç©ºé—´<br>kubectl create namespace &lt;namespace-name&gt;<br></code></pre></td></tr></table></figure><h1 id="15-ESç›¸å…³å‘½ä»¤"><a href="#15-ESç›¸å…³å‘½ä»¤" class="headerlink" title="15 ESç›¸å…³å‘½ä»¤"></a>15 ESç›¸å…³å‘½ä»¤</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs apl">1ã€åˆ›å»ºç´¢å¼•ï¼šï¼ˆæŒ‡å®šç´¢å¼•æœ€å¤§å­—æ®µæ•°ï¼‰<br>PUT /benthos<br>&#123;<br>  &quot;settings&quot;: &#123;<br>    &quot;index.mapping.total_fields.limit&quot;: 10000<br>  &#125;<br>  &#125;<br><br>2ã€æŸ¥çœ‹ç´¢å¼•åˆ—è¡¨ï¼š<br>curl -X GET &quot;localhost:9200/_cat/indices?v&quot;<br><br>3ã€å‘ç´¢å¼•ä¸­æ·»åŠ æ–‡æ¡£ï¼š<br>curl -X POST &quot;localhost:9200/your_index/_doc&quot; -H &#x27;Content-Type: application/json&#x27; -d &#x27;&#123;<br>  &quot;field1&quot;: &quot;value1&quot;,<br>  &quot;field2&quot;: &quot;value2&quot;<br>&#125;&#x27;<br><br>4ã€è·å–å•ä¸ªæ–‡æ¡£ï¼š<br>curl -X GET &quot;localhost:9200/your_index/_doc/your_document_id?pretty&quot;<br><br>5ã€æ›´æ–°æ–‡æ¡£ï¼š<br>curl -X POST &quot;localhost:9200/your_index/_doc/your_document_id/_update&quot; -H &#x27;Content-Type: application/json&#x27; -d &#x27;&#123;<br>  &quot;doc&quot;: &#123;<br>    &quot;new_field&quot;: &quot;new_value&quot;<br>  &#125;<br>&#125;&#x27;<br><br>6ã€åˆ é™¤ç´¢å¼•ï¼š<br><br>7ã€æŸ¥çœ‹ç´¢å¼•å†…å®¹ï¼š<br>http://192.168.0.71:9200/benthos/_search?q=*<br><br>8ã€ä¿®æ”¹ç´¢å¼•å­—æ®µæ•°<br>PUT /ç´¢å¼•å/_settings<br>&#123;<br>  &quot;index.mapping.total_fields.limit&quot;: æ–°çš„æœ€å¤§å­—æ®µæ•°<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="16-Tsharkåˆ†åŒ…å‘½ä»¤"><a href="#16-Tsharkåˆ†åŒ…å‘½ä»¤" class="headerlink" title="16 Tsharkåˆ†åŒ…å‘½ä»¤"></a>16 Tsharkåˆ†åŒ…å‘½ä»¤</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">å®‰è£…<br>sudo apt install -y tshark<br><br>1 ä½¿ç”¨tsharkåˆ†å‰²åŒ…<br>tshark -r input.pcap -w output -C 1 -b filesize:1024<br><span class="hljs-comment"># tshark åŒæ­¥å‘é€</span><br>tshark -i eth0 -w capture.pcap &amp;&amp; $ rsync -avz capture.pcap user@remote.server:/path/to/remote/dir<br><span class="hljs-comment"># tshark ç”Ÿæˆek josnæ¸…é™¤ ç´¢å¼•è¡Œ</span><br>tshark -r test2.pcap -T ek -E header=y -E separator=, -E occurrence=f | sed <span class="hljs-string">&#x27;/&#123;&quot;index&quot;:&#123;.*&#125;&#125;/d&#x27;</span> &gt; testek.json<br><span class="hljs-comment"># tsharkè¿‡æ»¤å­—æ®µ</span><br> é€‰é¡¹ç”¨äºè¿‡æ»¤è¦æ˜¾ç¤ºæˆ–å¤„ç†çš„æ•°æ®åŒ…ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Wireshark Display Filters è¯­æ³•æ¥å®šä¹‰è¿‡æ»¤æ¡ä»¶ï¼Œä»¥é™åˆ¶ç»“æœé›†ä¸­çš„æ•°æ®åŒ…ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ -Y <span class="hljs-string">&quot;ip.src == 192.168.0.1&quot;</span> æ¥ä»…æ˜¾ç¤ºæºIPåœ°å€ä¸º 192.168.0.1 çš„æ•°æ®åŒ…ã€‚<br><br>-e é€‰é¡¹ç”¨äºæŒ‡å®šåœ¨è¾“å‡ºä¸­æ˜¾ç¤ºçš„å­—æ®µã€‚æ‚¨å¯ä»¥ä½¿ç”¨ tshark çš„å­—æ®µåç§°æˆ–ç¼–ç æ¥æå–æ„Ÿå…´è¶£çš„ç‰¹å®šå­—æ®µã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ -e frame.number -e ip.src -e tcp.dstport æ¥è·å–æ¯ä¸ªæ•°æ®åŒ…çš„å¸§ç¼–å·ã€æºIPåœ°å€å’Œç›®æ ‡TCPç«¯å£å·ã€‚<br>tshark -r <span class="hljs-string">&quot;<span class="hljs-variable">$pcap_file</span>&quot;</span> -Y <span class="hljs-string">&quot;<span class="hljs-variable">$filter</span>&quot;</span> -T ek -E header=y -E separator=, -E occurrence=f | sed <span class="hljs-string">&#x27;/&#123;&quot;index&quot;:&#123;.*&#125;&#125;/d&#x27;</span> &gt;  <span class="hljs-string">&quot;<span class="hljs-variable">$output_file</span>&quot;</span> <br><br>tshark -r test2.pcap -T ek -e -E header=y -E separator=, -E occurrence=f | sed <span class="hljs-string">&#x27;/&#123;&quot;index&quot;:&#123;.*&#125;&#125;/d&#x27;</span> &gt; testek.json<br><br><span class="hljs-built_in">nohup</span> bash tshark_benthos.sh &gt; output.log 2&gt;&amp;1 &amp;<br><br><br></code></pre></td></tr></table></figure><h1 id="17-linuxç¯å¢ƒå˜é‡ç­‰çº§"><a href="#17-linuxç¯å¢ƒå˜é‡ç­‰çº§" class="headerlink" title="17 linuxç¯å¢ƒå˜é‡ç­‰çº§"></a>17 linuxç¯å¢ƒå˜é‡ç­‰çº§</h1><h2 id="åœ¨Linuxç¯å¢ƒä¸­ï¼Œå­˜åœ¨ä¸åŒçš„ç¯å¢ƒå˜é‡ç­‰çº§ï¼Œå®ƒä»¬å†³å®šäº†å˜é‡çš„ä½œç”¨èŒƒå›´å’Œä¼˜å…ˆçº§"><a href="#åœ¨Linuxç¯å¢ƒä¸­ï¼Œå­˜åœ¨ä¸åŒçš„ç¯å¢ƒå˜é‡ç­‰çº§ï¼Œå®ƒä»¬å†³å®šäº†å˜é‡çš„ä½œç”¨èŒƒå›´å’Œä¼˜å…ˆçº§" class="headerlink" title="åœ¨Linuxç¯å¢ƒä¸­ï¼Œå­˜åœ¨ä¸åŒçš„ç¯å¢ƒå˜é‡ç­‰çº§ï¼Œå®ƒä»¬å†³å®šäº†å˜é‡çš„ä½œç”¨èŒƒå›´å’Œä¼˜å…ˆçº§"></a>åœ¨Linuxç¯å¢ƒä¸­ï¼Œå­˜åœ¨ä¸åŒçš„ç¯å¢ƒå˜é‡ç­‰çº§ï¼Œå®ƒä»¬å†³å®šäº†å˜é‡çš„ä½œç”¨èŒƒå›´å’Œä¼˜å…ˆçº§</h2><ol><li>å…¨å±€ç³»ç»Ÿçº§åˆ«ï¼ˆGlobal System Levelï¼‰ï¼š<br>è¿™æ˜¯æœ€é«˜çº§åˆ«çš„ç¯å¢ƒå˜é‡ï¼Œé€‚ç”¨äºæ•´ä¸ªç³»ç»Ÿçš„æ‰€æœ‰ç”¨æˆ·å’Œè¿›ç¨‹ã€‚è¿™äº›ç¯å¢ƒå˜é‡é€šå¸¸å®šä¹‰åœ¨ç³»ç»ŸèŒƒå›´çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚<code>/etc/profile</code>ã€<code>/etc/environment</code>å’Œ<code>/etc/profile.d/</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ä¿®æ”¹è¿™äº›æ–‡ä»¶éœ€è¦rootæƒé™ã€‚</li><li>ç”¨æˆ·çº§åˆ«ï¼ˆUser Levelï¼‰ï¼š<br>ç”¨æˆ·çº§åˆ«çš„ç¯å¢ƒå˜é‡ä»…é€‚ç”¨äºç‰¹å®šç”¨æˆ·ã€‚æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„ç¯å¢ƒå˜é‡é…ç½®ï¼Œé€šå¸¸ä¿å­˜åœ¨ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­çš„æ–‡ä»¶ä¸­ã€‚æœ€å¸¸è§çš„æ˜¯<code>~/.bashrc</code>å’Œ<code>~/.bash_profile</code>æ–‡ä»¶ï¼Œå®ƒä»¬åœ¨ç”¨æˆ·ç™»å½•æ—¶ä¼šè¢«åŠ è½½ã€‚ä¿®æ”¹è¿™äº›æ–‡ä»¶åªä¼šå½±å“åˆ°ç›¸åº”ç”¨æˆ·ã€‚</li><li>ä¼šè¯çº§åˆ«ï¼ˆSession Levelï¼‰ï¼š<br>ä¼šè¯çº§åˆ«çš„ç¯å¢ƒå˜é‡ä»…é€‚ç”¨äºå½“å‰ä¼šè¯ã€‚å½“ç”¨æˆ·ç™»å½•åï¼Œä¼šè¯çº§åˆ«çš„ç¯å¢ƒå˜é‡ä¼šè¢«åˆ›å»ºï¼Œå¹¶åœ¨ç”¨æˆ·é€€å‡ºç™»å½•åè¢«é”€æ¯ã€‚è¿™äº›ç¯å¢ƒå˜é‡å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ä¸­ç›´æ¥è®¾ç½®å˜é‡æ¥å®šä¹‰ï¼Œä¾‹å¦‚ä½¿ç”¨<code>export</code>å‘½ä»¤ã€‚</li><li>ä¼šè¯çº§åˆ«ï¼ˆSession Levelï¼‰ï¼š<br>ä¼šè¯çº§åˆ«çš„ç¯å¢ƒå˜é‡ä»…é€‚ç”¨äºå½“å‰ä¼šè¯ã€‚å½“ç”¨æˆ·ç™»å½•åï¼Œä¼šè¯çº§åˆ«çš„ç¯å¢ƒå˜é‡ä¼šè¢«åˆ›å»ºï¼Œå¹¶åœ¨ç”¨æˆ·é€€å‡ºç™»å½•åè¢«é”€æ¯ã€‚è¿™äº›ç¯å¢ƒå˜é‡å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ä¸­ç›´æ¥è®¾ç½®å˜é‡æ¥å®šä¹‰ï¼Œä¾‹å¦‚ä½¿ç”¨<code>export</code>å‘½ä»¤ã€‚</li></ol><h1 id="18-Ubuntu-å®‰è£…ç¬¬ä¸‰æ–¹åŒ…ï¼ˆdebï¼‰"><a href="#18-Ubuntu-å®‰è£…ç¬¬ä¸‰æ–¹åŒ…ï¼ˆdebï¼‰" class="headerlink" title="18 Ubuntu å®‰è£…ç¬¬ä¸‰æ–¹åŒ…ï¼ˆdebï¼‰"></a>18 Ubuntu å®‰è£…ç¬¬ä¸‰æ–¹åŒ…ï¼ˆdebï¼‰</h1><p><strong>å®‰è£…å®ä¾‹</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ä¸‹è½½å¥½å¯¹åº”çš„debåŒ…<br>sudo dpkg -<span class="hljs-selector-tag">i</span> com<span class="hljs-selector-class">.alibabainc</span><span class="hljs-selector-class">.dingtalk_7</span>.<span class="hljs-number">1.0</span>.<span class="hljs-number">31120</span>_amd64<span class="hljs-selector-class">.deb</span> <br></code></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹å®‰è£…çš„åŒ…</strong></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">sudo dpkg -l <span class="hljs-string">| grep dingtalk</span><br></code></pre></td></tr></table></figure><p><strong>å¸è½½å·²å®‰è£…çš„åŒ…</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">sudo dpkg-r dingtalk</span><br></code></pre></td></tr></table></figure><p><strong>debåŒ…é»˜è®¤æš‚å­˜è·¯å¾„</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/var/</span>cache<span class="hljs-regexp">/apt/</span>archives/<br></code></pre></td></tr></table></figure><h1 id="19-è°·æ­Œæµè§ˆå™¨æŠ€å·§"><a href="#19-è°·æ­Œæµè§ˆå™¨æŠ€å·§" class="headerlink" title="19 è°·æ­Œæµè§ˆå™¨æŠ€å·§"></a>19 è°·æ­Œæµè§ˆå™¨æŠ€å·§</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs txt"># æˆªå›¾<br>1. æŒ‰F12<br>2. Ctrl + Shift + P<br>3. è¾“å…¥å‘½ä»¤ `Capture full size screenshot`<br><br># éšè—å¹¿å‘Š<br>1. æŒ‰F12<br>2. Elements<br>3. Styleså¢åŠ  displayï¼šnone<br></code></pre></td></tr></table></figure><h1 id="20-è½¬æ¢æ–‡ä»¶åç¼–ç "><a href="#20-è½¬æ¢æ–‡ä»¶åç¼–ç " class="headerlink" title="20 è½¬æ¢æ–‡ä»¶åç¼–ç "></a>20 è½¬æ¢æ–‡ä»¶åç¼–ç </h1><p>Windowsä¸‹å‹ç¼©çš„zipæ–‡ä»¶ï¼Œåœ¨ Ubuntuä¸‹è§£å¼€æ—¶ï¼Œä¸­æ–‡æ–‡ä»¶åä¼šæ˜¾ç¤ºä¹±ç ï¼Œå¯ä»¥ç”¨convmvè§£å†³ã€‚</p><p>å®‰è£…convmvï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install convmv<br></code></pre></td></tr></table></figure><p>è½¬æ¢æ–‡ä»¶æˆ–ç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">convmv -f gbk -t utf8 -r --notest *<br><br>--notest: è¿™ä¸ªé€‰é¡¹å‘Šè¯‰ convmv å®é™…æ‰§è¡Œè½¬æ¢æ“ä½œï¼Œè€Œä¸æ˜¯ä»…ä»…æµ‹è¯•å“ªäº›æ–‡ä»¶åéœ€è¦è½¬æ¢ã€‚å¦‚æœä¸åŠ æ­¤é€‰é¡¹ï¼Œconvmv ä¼šæ˜¾ç¤ºå“ªäº›æ–‡ä»¶åä¼šè¢«ä¿®æ”¹ï¼Œä½†ä¸ä¼šçœŸæ­£ä¿®æ”¹å®ƒä»¬<br><br>*: æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œä»£è¡¨å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚ç»“åˆ -r é€‰é¡¹ï¼Œè¿™å°†å½±å“åˆ°ç›®å½•æ ‘ä¸­æ‰€æœ‰å±‚çº§çš„æ–‡ä»¶å<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼€å‘å·¥å…·</title>
    <link href="/2025/09/18/tools/%E5%8A%9E%E5%85%AC%E5%B7%A5%E5%85%B7/"/>
    <url>/2025/09/18/tools/%E5%8A%9E%E5%85%AC%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<h2 id="1ã€å¼€å‘å·¥å…·"><a href="#1ã€å¼€å‘å·¥å…·" class="headerlink" title="1ã€å¼€å‘å·¥å…·"></a>1ã€å¼€å‘å·¥å…·</h2><table><thead><tr><th>å·¥å…·åç§°</th><th>ä¸‹è½½åœ°å€</th></tr></thead><tbody><tr><td>golang sdk 1.21</td><td><a href="https://go.dev/dl/">All Realease</a></td></tr><tr><td>goland2024.1 ï¼ˆnocal æ”¯æŒåˆ°è¿™ä¸ªç‰ˆæœ¬ï¼‰</td><td><a href="https://www.jetbrains.com/zh-cn/go/download/other.html">å…¶ä»–ç‰ˆæœ¬</a></td></tr><tr><td>jdk11</td><td><a href="https://repo.huaweicloud.com/java/jdk/">jdk</a></td></tr><tr><td>MobaXterm_Personal æ±‰åŒ–</td><td><a href="https://github.com/RipplePiam/MobaXterm-Chinese-Simplified">æ±‰åŒ–</a></td></tr><tr><td>MobaXterm_Personal ç ´è§£</td><td><a href="https://github.com/Paper-Dragon/mobaxterm-crack">ç ´è§£</a></td></tr><tr><td>hexhub ï¼ˆlinuxè¿œç¨‹å·¥å…·ï¼‰</td><td><a href="https://www.hexhub.cn/">hexhubè¿œç¨‹ä¸‰åˆä¸€</a></td></tr><tr><td>postman&#x2F;apifox&#x2F;apipost</td><td></td></tr><tr><td>dbeaver&#x2F;Navicat Premium 16</td><td><a href="https://dbeaver.io/download/">dbeaver</a> <a href="https://github.com/shuhongfan/NavicatCracker">navicatç ´è§£</a></td></tr><tr><td>Git Bash</td><td></td></tr><tr><td>ES-King.exe&#x2F;Kafka-King.exe</td><td><a href="https://github.com/Bronya0/ES-King">es-king</a> <a href="https://github.com/Bronya0/Kafka-King">kafka-king</a></td></tr><tr><td>Typora</td><td><a href="https://github.com/eglfiv/typora-activation">typoraç ´è§£</a></td></tr><tr><td>Typoraä¸»é¢˜</td><td><a href="https://github.com/liangjingkanji/DrakeTyporaTheme">ä¸»é¢˜</a></td></tr><tr><td>æ€ç»ªæ€ç»´å¯¼å›¾</td><td><a href="https://wanglin2.github.io/mind-map-docs/course/course1.html">æ€ç»ªå¯¼å›¾</a></td></tr><tr><td>Snipaste</td><td><a href="https://zh.snipaste.com/download.html">sni</a></td></tr><tr><td>vscode</td><td></td></tr><tr><td>Everything</td><td><a href="https://www.voidtools.com/zh-cn/">everything</a></td></tr><tr><td>tiny RDM redisç®¡ç†å·¥å…·</td><td><a href="https://redis.tinycraft.cc/">tiny RDM</a></td></tr><tr><td>compress mongoç®¡ç†å·¥å…·</td><td><a href="https://www.mongodb.com/try/download/compass">mongoå¯è§†åŒ–</a></td></tr></tbody></table><h2 id="2ã€å¼€å‘æ’ä»¶"><a href="#2ã€å¼€å‘æ’ä»¶" class="headerlink" title="2ã€å¼€å‘æ’ä»¶"></a>2ã€å¼€å‘æ’ä»¶</h2><p><a href="https://plugins.jetbrains.com/">ç½‘ç«™æ’ä»¶åœ°å€</a></p><table><thead><tr><th>æ’ä»¶åç§°</th><th>æ’ä»¶è¯´æ˜</th></tr></thead><tbody><tr><td>key Promoter X</td><td>å¿«æ·é”®æç¤º</td></tr><tr><td>plantuml4idea</td><td>ä»£ç å³æ¶æ„</td></tr><tr><td>trae</td><td>aiæ’ä»¶</td></tr><tr><td>Nocalhost</td><td>k8sé›†ç¾¤é…ç½®æ’ä»¶</td></tr><tr><td>Open Markdown with Typora</td><td>ideé‡Œé¢å¿«æ·æ‰“å¼€typoraç¼–è¾‘</td></tr></tbody></table><h2 id="3ã€ideå·¥å…·æ¿€æ´»"><a href="#3ã€ideå·¥å…·æ¿€æ´»" class="headerlink" title="3ã€ideå·¥å…·æ¿€æ´»"></a>3ã€ideå·¥å…·æ¿€æ´»</h2><p><a href="https://3.jetbra.in/">æ’ä»¶æ¿€æ´»å·¥å…·åœ°å€</a></p><p>ä½¿ç”¨ï¼š </p><p>1 ä¸‹è½½å¥½ ç ´è§£æ’ä»¶ä¹‹å è§£å‹ è¿›å…¥scripts ç›®å½• å…ˆæ‰§è¡Œ uinstall è„šæœ¬ ç„¶å installè„šæœ¬</p><p>2 å®‰è£…å¥½ä¼ä¸šç‰ˆpycharm</p><p>3  é€šè¿‡activation code è¿›è¡Œæ¿€æ´»ä½¿ç”¨</p><p>æ¿€æ´» å‡ºç°<code>Unable to Save Data</code>é—®é¢˜ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Bash">C:\Users\User\AppData\Roaming\JetBrains\IntelliJIdea2022.2\idea.key<br>ä¸€èˆ¬æ˜¯ä¼šæç¤ºè¿™ä¸ªç›®å½•æ‹’ç»è®¿é—®<br><br>æ‰¾åˆ°å¯¹åº”çš„key é‡å‘½åä¸€ä¸‹ï¼Œé‡æ–°æ‰“å¼€ideaæˆ–è€…å¯¹åº”çš„ç¼–è¾‘å™¨ åˆ™ä¼šé‡æ–°ç”Ÿæˆå¯¹åº”çš„key<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kubectlå¸¸ç”¨å‘½ä»¤</title>
    <link href="/2025/06/12/docker/k8s%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2025/06/12/docker/k8s%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h1 id="kubectlå¸¸ç”¨å‘½ä»¤"><a href="#kubectlå¸¸ç”¨å‘½ä»¤" class="headerlink" title="kubectlå¸¸ç”¨å‘½ä»¤"></a>kubectlå¸¸ç”¨å‘½ä»¤</h1><h2 id="1ã€kubectl-pod-å¸¸ç”¨å‘½ä»¤ä»‹ç»"><a href="#1ã€kubectl-pod-å¸¸ç”¨å‘½ä»¤ä»‹ç»" class="headerlink" title="1ã€kubectl  pod å¸¸ç”¨å‘½ä»¤ä»‹ç»"></a>1ã€kubectl  pod å¸¸ç”¨å‘½ä»¤ä»‹ç»</h2><p>æŸ¥çœ‹å·¥ä½œè´Ÿè½½å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get pod -A | grep asset-web<br><br>XDR2.0.40.0(10.65.196.101) ~ # kubectl get pod -A | grep asset-web<br> å‘½åç©ºé—´ï¼ˆNAMESPACEï¼‰Pod åç§°ï¼ˆNAMEï¼‰                     å°±ç»ªçŠ¶æ€ï¼ˆREADYï¼‰     çŠ¶æ€ï¼ˆSTATUSï¼‰     é‡å¯æ¬¡æ•°ï¼ˆRESTARTSï¼‰è¿è¡Œæ—¶é—´ï¼ˆAGEï¼‰<br>platform                asset-web-dc97f6c47-fjwss             0/1     Running            0                27m<br>platform                asset-web-f5b46d577-6j7cc             1/1      Running            0                27d<br></code></pre></td></tr></table></figure><p>ç¼–è¾‘å·¥ä½œè´Ÿè½½é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl -n platform edit deployments.apps asset-web<br><br>image: docker.sangfor.com/local-xdr/arm64/xdr-asset-enc:feature-1016958-jingneng-lyg-20250521101602-1e7f10cb<br>æ›¿æ¢docker.sangfor.com<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹podé…ç½®å‘½ä»¤ -oæŒ‡å®šæŸ¥çœ‹æ ¼å¼</span><br>kubectl -n platform get deploy asset-web -o yaml<br>kubectl -n platform get deploy asset-web -o json<br><br>å¯åœ¨å®¹å™¨å†…æŸ¥çœ‹é…ç½®æ–‡ä»¶<br>...<br> volumeMounts:<br>        - mountPath: /etc/ngsoc-lib/conf.json<br>          name: config<br>          subPath: ngsoc-lib<br>...<br></code></pre></td></tr></table></figure><p>æ’æŸ¥å·¥ä½œè´Ÿè½½podè¿è¡Œå‘½ä»¤ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ç»ªçŠ¶æ€ä¸º 0/1 çš„ Podé—®é¢˜å¦‚ä½•æ’æŸ¥å¤„ç†</span><br>æ­¥éª¤ 1ï¼šç¡®è®¤ Pod åŸºç¡€çŠ¶æ€<br>é¦–å…ˆé€šè¿‡ kubectl describe å‘½ä»¤è·å– Pod çš„è¯¦ç»†ä¿¡æ¯ï¼Œé‡ç‚¹å…³æ³¨ Statusã€Events å’Œ Containers éƒ¨åˆ†<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ›¿æ¢ &lt;å‘½åç©ºé—´&gt; å’Œ &lt;Podåç§°&gt; ä¸ºå®é™…å€¼</span><br>kubectl describe pod -n &lt;å‘½åç©ºé—´&gt; &lt;Podåç§°&gt;<br><br>Statusï¼šPod çš„æ•´ä½“çŠ¶æ€ï¼ˆå¦‚ Runningã€Pendingã€CrashLoopBackOff ç­‰ï¼‰ã€‚<br>è‹¥çŠ¶æ€ä¸º CrashLoopBackOffï¼šå®¹å™¨åå¤å´©æºƒï¼Œå¯èƒ½æ˜¯å¯åŠ¨å¤±è´¥æˆ–åº”ç”¨å¼‚å¸¸ã€‚<br>è‹¥çŠ¶æ€ä¸º Running ä½†å°±ç»ªçŠ¶æ€ 0/1ï¼šåº”ç”¨å¯èƒ½æœªé€šè¿‡å°±ç»ªæ¢é’ˆï¼Œæˆ–ä»åœ¨åˆå§‹åŒ–ã€‚<br>Eventsï¼šKubernetes è®°å½•çš„å…³é”®äº‹ä»¶ï¼ˆå¦‚è°ƒåº¦å¤±è´¥ã€å®¹å™¨å¯åŠ¨å¤±è´¥ã€æ¢é’ˆå¤±è´¥ç­‰ï¼‰ã€‚<br>ç¤ºä¾‹é”™è¯¯ï¼šFailed to pull image &quot;xxx&quot;ï¼ˆé•œåƒæ‹‰å–å¤±è´¥ï¼‰ã€Unhealthyï¼ˆæ¢é’ˆå¤±è´¥ï¼‰ã€‚<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æ—¥å¿—å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span><br>kubectl logs -f -n platform asset-web-bdb6695b4-4nksn<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‹¥å®¹å™¨é‡å¯ï¼ŒæŸ¥çœ‹ä¹‹å‰çš„æ—¥å¿—ï¼ˆåŠ  --previousï¼‰ï¼š</span><br>kubectl logs -n platform --previous asset-web-bdb6695b4-4nksn<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ä¸Šä¸‹10è¡Œ (linuxä¸‹æ—¥å¿—ä¾¿æ·å‘½ä»¤)</span><br>cat /home/fantom/apps/asset_web/app/view/asset_detail/business.py | grep -C 10 &quot;show_hardware_info&quot;<br></code></pre></td></tr></table></figure><p>è¿›å…¥pod å®¹å™¨å‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿›å…¥æŒ‡å®šå®¹å™¨</span><br><span class="hljs-comment"># è¯­æ³•ï¼škubectl exec -it -n &lt;å‘½åç©ºé—´&gt; &lt;Podåç§°&gt; -- &lt;å®¹å™¨å†…Shellå‘½ä»¤&gt;</span><br>kubectl <span class="hljs-built_in">exec</span> -it -n platform  asset-web-bdb6695b4-4nksn /bin/sh<br><span class="hljs-comment"># è¿›å…¥å®¹å™¨æŸ¥çœ‹æ–‡ä»¶å†…å®¹</span><br>kubectl <span class="hljs-built_in">exec</span> -it -n platform asset-web-dc97f6c47-fjwss -- <span class="hljs-built_in">cat</span> /app/config.yaml<br></code></pre></td></tr></table></figure><p>æ‹·è´å®¿ä¸»æœºæ–‡ä»¶å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æœ¬åœ°æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ï¼škubectl <span class="hljs-built_in">cp</span> &lt;æœ¬åœ°è·¯å¾„&gt; &lt;å‘½åç©ºé—´&gt;/&lt;Podåç§°&gt;:&lt;å®¹å™¨å†…è·¯å¾„&gt; [-c &lt;å®¹å™¨å&gt;]</span><br>kubectl cp ./business.py -n platform asset-web-bdb6695b4-4nksn:/home/fantom/apps/asset_web/app/view/asset/business.py<br></code></pre></td></tr></table></figure><p>å¤‡ä»½å·¥ä½œè´Ÿè½½é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¤‡ä»½å·¥ä½œè´Ÿè½½é…ç½®</span><br>kubectl -n platform get deployment asset-inner -o yaml &gt; asset-inner-deployment.yaml<br></code></pre></td></tr></table></figure><p>å·¥ä½œè´Ÿè½½pod å¯åŠ¨ç›¸å…³</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ é™¤pod å®ç°é‡å¯</span><br>kubectl delete pod &lt;statefulset-pod-name&gt; -n &lt;namespace&gt;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¹³æ»‘é‡å¯æ‰€æœ‰ Podï¼Œéµå¾ªæ»šåŠ¨ç­–ç•¥ï¼Œä¿è¯æœåŠ¡å¯ç”¨æ€§ï¼Œé€‚ç”¨äºé…ç½®æ›´æ–°åçš„æ‰¹é‡é‡å¯</span><br>kubectl rollout restart deployment  &lt;deployment&gt;  -n &lt;namespace&gt; <br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‡å°‘deployment replicas podæ•°é‡</span><br>kubectl scale deployment &lt;deployment-name&gt; --replicas=0 -n &lt;namespace&gt;<br>kubectl scale deployment feature-identity-provider-secret  --replicas=0 -n appstore-official<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹å·¥ä½œè´Ÿè½½ç›¸å…³å‘½ä»¤</p><table><thead><tr><th>æ“ä½œåœºæ™¯</th><th>å‘½ä»¤ç¤ºä¾‹</th></tr></thead><tbody><tr><td>æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´æ‰€æœ‰å·¥ä½œè´Ÿè½½</td><td><code>kubectl get deploy,sts,ds,jobs,cronjobs -n &lt;namespace&gt;</code></td></tr><tr><td>æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´å·¥ä½œè´Ÿè½½</td><td><code>kubectl get deploy,sts,ds,jobs,cronjobs --all-namespaces</code></td></tr><tr><td>æŸ¥çœ‹ Deployment è¯¦æƒ…</td><td><code>kubectl describe deploy &lt;name&gt; -n &lt;namespace&gt;</code></td></tr><tr><td>æŒ‰æ ‡ç­¾ç­›é€‰å·¥ä½œè´Ÿè½½</td><td><code>kubectl get deploy,sts -l app=my-app -n &lt;namespace&gt;</code></td></tr><tr><td>è¾“å‡º JSON æ ¼å¼</td><td><code>kubectl get deploy -n &lt;namespace&gt; -o json</code></td></tr></tbody></table><h2 id="2ã€kubectl-svc-å¸¸ç”¨å‘½ä»¤ä»‹ç»"><a href="#2ã€kubectl-svc-å¸¸ç”¨å‘½ä»¤ä»‹ç»" class="headerlink" title="2ã€kubectl  svc å¸¸ç”¨å‘½ä»¤ä»‹ç»"></a>2ã€kubectl  svc å¸¸ç”¨å‘½ä»¤ä»‹ç»</h2><p>æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„ Service</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„ Serviceï¼ˆéœ€è¦æƒé™ï¼‰</span><br>kubectl get services --all-namespaces<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹mongoçš„ nodeportç«¯å£é…ç½®ä¿¡æ¯ ä½¿ç”¨å·¥å…·è¿æ¥ï¼ˆipä¸ºssh çš„ip - å¯èƒ½æœ‰ç½‘å…³ è¿›è¡Œè¿æ¥ï¼‰</span><br>XDR2.0.35.0(10.64.2.202) ~/mhd/asset #  kubectl get svc -n mongo<br>NAME                                    TYPE        CLUSTER-IP        EXTERNAL-IP   PORT(S)           AGE<br>mongo-mongodb-sharded                   NodePort    192.128.128.232   &lt;none&gt;        27017:30056/TCPï¼ˆå¤–éƒ¨ç«¯å£ï¼‰   447d<br>mongo-mongodb-sharded-headless          ClusterIP   None              &lt;none&gt;        27017/TCP         447d<br>mongo-mongodb-sharded-mongos-headless   ClusterIP   None <br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ Pod æ‰€å±çš„å·¥ä½œè´Ÿè½½ï¼ˆå¦‚ Deploymentã€StatefulSetï¼‰ç»‘å®šçš„ Service</p><p>æ–¹æ³• 1ï¼šé€šè¿‡ Pod æ ‡ç­¾åæŸ¥ Service</p><p>Kubernetes ä¸­ï¼ŒService é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆ<code>selector</code>ï¼‰ä¸ Pod ç»‘å®šã€‚å› æ­¤ï¼Œå¯é€šè¿‡ Pod çš„æ ‡ç­¾åæ¨å…³è”çš„ Serviceã€‚</p><p>æ­¥éª¤ 1ï¼šè·å– Pod çš„æ ‡ç­¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get pod &lt;pod-name&gt; -n &lt;namespace&gt; -o jsonpath=<span class="hljs-string">&#x27;&#123;.metadata.labels&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹è¾“å‡ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;app&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;nginx&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;v1&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æ­¥éª¤ 2ï¼šæŸ¥æ‰¾åŒ¹é…æ ‡ç­¾çš„ Service</p><p>ä½¿ç”¨ <code>kubectl get services</code> ç»“åˆ <code>--selector</code> å‚æ•°ç­›é€‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get services -n &lt;namespace&gt; --selector=<span class="hljs-string">&quot;app=nginx,version=v1&quot;</span><br></code></pre></td></tr></table></figure><p><strong>å®Œæ•´å‘½ä»¤ç¤ºä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è·å– Pod æ ‡ç­¾å¹¶ç›´æ¥ç”¨äºæŸ¥è¯¢ Service</span><br>POD_LABELS=$(kubectl get pod &lt;pod-name&gt; -n &lt;namespace&gt; -o jsonpath=<span class="hljs-string">&#x27;&#123;.metadata.labels&#125;&#x27;</span> | <span class="hljs-built_in">tr</span> -d <span class="hljs-string">&#x27;&#123;&#125;&quot;&#x27;</span>)<br>kubectl get services -n &lt;namespace&gt; --selector=<span class="hljs-string">&quot;<span class="hljs-variable">$POD_LABELS</span>&quot;</span><br></code></pre></td></tr></table></figure><p><strong>æ–¹æ³• 2ï¼šé€šè¿‡å·¥ä½œè´Ÿè½½ç±»å‹ï¼ˆDeployment&#x2F;StatefulSetï¼‰é—´æ¥æŸ¥æ‰¾</strong></p><p>è‹¥ Pod ç”± Deployment&#x2F;StatefulSet ç®¡ç†ï¼Œå¯å…ˆæ‰¾åˆ°å¯¹åº”æ§åˆ¶å™¨ï¼Œå†æŸ¥æ‰¾å…³è”çš„ Serviceã€‚</p><p><strong>æ­¥éª¤ 1ï¼šç¡®å®š Pod æ‰€å±çš„æ§åˆ¶å™¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt; | grep <span class="hljs-string">&quot;Controlled By&quot;</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹è¾“å‡º</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Controlled By:  Deployment/nginx-deployment<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 2ï¼šè·å–æ§åˆ¶å™¨çš„æ ‡ç­¾é€‰æ‹©å™¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯¹äº Deployment</span><br>kubectl get deployment &lt;deployment-name&gt; -n &lt;namespace&gt; -o jsonpath=<span class="hljs-string">&#x27;&#123;.spec.selector.matchLabels&#125;&#x27;</span><br><br><span class="hljs-comment"># å¯¹äº StatefulSet</span><br>kubectl get statefulset &lt;statefulset-name&gt; -n &lt;namespace&gt; -o jsonpath=<span class="hljs-string">&#x27;&#123;.spec.selector.matchLabels&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 3ï¼šä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨æŸ¥æ‰¾ Service</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å‡è®¾æ§åˆ¶å™¨æ ‡ç­¾ä¸º app=nginx</span><br>kubectl get services -n &lt;namespace&gt; --selector=<span class="hljs-string">&quot;app=nginx&quot;</span><br></code></pre></td></tr></table></figure><p><strong>æ–¹æ³• 3ï¼šä½¿ç”¨å·¥å…·æ‰¹é‡å…³è”ï¼ˆæ¨èï¼‰</strong></p><p>è‹¥éœ€é¢‘ç¹æŸ¥è¯¢ï¼Œå¯ä½¿ç”¨ <code>kubectl-tree</code> æ’ä»¶ï¼ˆéœ€å…ˆå®‰è£…ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®‰è£… kubectl-treeï¼ˆéœ€å…ˆå®‰è£… krewï¼‰</span><br>kubectl krew install tree<br><br><span class="hljs-comment"># æŸ¥çœ‹ Pod åŠå…¶å…³è”çš„ Service</span><br>kubectl tree pod &lt;pod-name&gt; -n &lt;namespace&gt;<br></code></pre></td></tr></table></figure><p><strong>é€šè¿‡ SVC æŸ¥æ‰¾å…³è”çš„å·¥ä½œè´Ÿè½½æˆ– Pod</strong></p><ul><li><strong>æŸ¥çœ‹ SVC çš„è¯¦ç»†ä¿¡æ¯</strong>ï¼šä½¿ç”¨<code>kubectl get svc &lt;svc - name&gt; -n &lt;namespace&gt;</code>å‘½ä»¤ï¼Œå¯è·å– SVC çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶é€‰æ‹©å™¨ç­‰ã€‚è‹¥è¦æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¯ä½¿ç”¨<code>kubectl describe svc &lt;svc - name&gt; -n &lt;namespace&gt;</code>ï¼Œåœ¨è¾“å‡ºä¸­<code>Selector</code>å­—æ®µæ˜¾ç¤ºäº†é€‰æ‹© Pod çš„æ ‡ç­¾æ¡ä»¶ï¼Œ<code>Endpoints</code>å­—æ®µåˆ—å‡ºäº†å…³è” Pod çš„ IP åœ°å€å’Œç«¯å£13ã€‚</li><li><strong>æ ¹æ®é€‰æ‹©å™¨æŸ¥æ‰¾å·¥ä½œè´Ÿè½½</strong>ï¼šæ ¹æ® SVC çš„é€‰æ‹©å™¨æ ‡ç­¾ï¼Œé€šè¿‡<code>kubectl get</code>å‘½ä»¤ç»“åˆæ ‡ç­¾é€‰æ‹©å™¨æ¥æŸ¥æ‰¾å…³è”çš„å·¥ä½œè´Ÿè½½ã€‚ä¾‹å¦‚ï¼ŒSVC çš„é€‰æ‹©å™¨æ˜¯<code>app=my - app</code>ï¼Œé‚£ä¹ˆå¯ä»¥æ‰§è¡Œ<code>kubectl get deployments -l app=my - app -n &lt;namespace&gt;</code>æ¥æŸ¥æ‰¾ç›¸å…³çš„ Deployment å·¥ä½œè´Ÿè½½ã€‚å¦‚æœè¦æŸ¥æ‰¾å…³è”çš„ Podï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>kubectl get pods -l app=my - app -n &lt;namespace&gt;</code>ã€‚</li></ul><p><strong>ç¼–è¾‘ä¿®æ”¹svc nodeport</strong></p><p>1ã€æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ‰“å¼€äº†ç«¯å£ </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">kubectl <span class="hljs-keyword">get</span> svc -n postgresql<br># ç±»å‹æ˜¯ ClusterIP ï¼Œ<span class="hljs-number">5432</span>/TCP åªæ˜¯å®¹å™¨å†…ç«¯å£ï¼Œå¤–éƒ¨æ— æ³•è®¿é—® # <span class="hljs-type">NAME</span>                                <span class="hljs-keyword">TYPE</span>       <span class="hljs-keyword">CLUSTER</span>-IP      <span class="hljs-keyword">EXTERNAL</span>-IP   PORT(S)             AGE<br></code></pre></td></tr></table></figure><p>2ã€ç¼–è¾‘ å°† spec.type çš„ ClusterIP æ”¹æˆ NodePort </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">kubectl</span> <span class="hljs-string">edit</span> <span class="hljs-string">svc</span> <span class="hljs-string">postgresql-stolon-proxy</span> <span class="hljs-string">-n</span> <span class="hljs-string">postgresql</span><br><br><span class="hljs-comment"># ä¸‹è¿°ä¸ºä¸€ä¸ªdemo svc</span><br><span class="hljs-string">kubectl</span> <span class="hljs-string">-n</span> <span class="hljs-string">appstore</span> <span class="hljs-string">edit</span> <span class="hljs-string">svc</span> <span class="hljs-string">appstore</span><br><br><span class="hljs-comment"># Please edit the object below. Lines beginning with a &#x27;#&#x27; will be ignored,</span><br><span class="hljs-comment"># and an empty file will abort the edit. If an error occurs while saving this file will be</span><br><span class="hljs-comment"># reopened with the relevant failures.</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">annotations:</span><br>    <span class="hljs-attr">fabric8.io/expose:</span> <span class="hljs-string">&quot;true&quot;</span><br>    <span class="hljs-attr">fabric8.io/ingress.annotations:</span> <span class="hljs-string">&#x27;kubernetes.io/ingress.class: nginx&#x27;</span><br>    <span class="hljs-attr">meta.helm.sh/release-name:</span> <span class="hljs-string">asset-web</span><br>    <span class="hljs-attr">meta.helm.sh/release-namespace:</span> <span class="hljs-string">platform</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-string">&quot;2024-10-16T03:59:50Z&quot;</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">asset-web</span><br>    <span class="hljs-attr">app.kubernetes.io/instance:</span> <span class="hljs-string">asset-web</span><br>    <span class="hljs-attr">app.kubernetes.io/managed-by:</span> <span class="hljs-string">Helm</span><br>    <span class="hljs-attr">app.kubernetes.io/name:</span> <span class="hljs-string">asset-web</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">asset-web</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">platform</span><br>  <span class="hljs-attr">resourceVersion:</span> <span class="hljs-string">&quot;25060&quot;</span><br>  <span class="hljs-attr">uid:</span> <span class="hljs-string">b3344b08-35de-45fe-867d-4d8115b753a0</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">clusterIP:</span> <span class="hljs-number">196.12</span><span class="hljs-number">.29</span><span class="hljs-number">.189</span><br>  <span class="hljs-attr">clusterIPs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">196.12</span><span class="hljs-number">.29</span><span class="hljs-number">.189</span><br>  <span class="hljs-attr">internalTrafficPolicy:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">ipFamilies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">IPv4</span><br>  <span class="hljs-attr">ipFamilyPolicy:</span> <span class="hljs-string">SingleStack</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">asset-web</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">9443</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9443</span><br>    <span class="hljs-attr">nodePort:</span> <span class="hljs-number">9443</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">debug</span><span class="hljs-comment"># å‡è®¾éœ€è¦åœ¨svc è®¾ç½®debug  portè‡ªå®šä¹‰</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">9443</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9443</span><br>    <span class="hljs-attr">nodePort:</span> <span class="hljs-number">9443</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">asset-web</span><br>    <span class="hljs-attr">app.kubernetes.io/instance:</span> <span class="hljs-string">asset-web</span><br>    <span class="hljs-attr">app.kubernetes.io/name:</span> <span class="hljs-string">asset-web</span><br>  <span class="hljs-attr">sessionAffinity:</span> <span class="hljs-string">None</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span> <br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">loadBalancer:</span> &#123;&#125;<br><br></code></pre></td></tr></table></figure><p>3ã€æŸ¥çœ‹æœåŠ¡ç«¯å£</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl <span class="hljs-built_in">get</span> svc -n postgresql<br><span class="hljs-comment"># NAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)             AGE</span><br><span class="hljs-comment"># postgresql-stolon-proxy             NodePort    30.30.132.251   &lt;none&gt;        5432:30483/TCP      320d</span><br><br><span class="hljs-comment">#ï¼ˆå¯ä»¥è·³è¿‡æ”¹æ­¥éª¤ï¼‰è¿™é‡Œå¯ä»¥çœ‹åˆ° 5432:30483/TCP ï¼Œè¯´æ˜å®¹å™¨å†…ç«¯å£æ˜ å°„åˆ°äº†å¤–éƒ¨çš„ 30483ï¼Œå¯ä»¥å…ˆæœ¬åœ°æµ‹è¯•ä¸€ä¸‹è¿æ¥</span><br>nc -vz localhost 30483<br><span class="hljs-comment"># ä¸‹é¢çš„è¾“å‡º Connected to 127.0.0.1:30483. åº”è¯¥æ˜¯è¿ä¸Šäº†</span><br><span class="hljs-comment"># Ncat: Version 7.80 ( https://nmap.org/ncat )</span><br><span class="hljs-comment"># Ncat: Connected to 127.0.0.1:30483.</span><br><span class="hljs-comment"># Ncat: 0 bytes sent, 0 bytes received in 0.01 seconds.</span><br></code></pre></td></tr></table></figure><p>4ã€è·å–å¯†ç </p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit">kubectl get secrets root-account -n xdr-comm-config -o jsonpath=<span class="hljs-string">&#x27;&#123;.data.account&#125;&#x27;</span> | base64 -d<br><span class="hljs-meta"># <span class="hljs-string">&quot;postgresql_password&quot;</span>: <span class="hljs-string">&quot;...&quot;</span></span><br><span class="hljs-meta"># <span class="hljs-string">&quot;postgresql_username&quot;</span>: <span class="hljs-string">&quot;...&quot;</span></span><br></code></pre></td></tr></table></figure><p> 5ã€æ‹¿åˆ°å¯†ç åå»è¿æ¥æ•°æ®åº“(Navicat)ï¼Œå¦‚æœè¿æ¥ä¸ä¸Šå¯èƒ½æ˜¯é˜²ç«å¢™æ²¡æœ‰æ”¾é€š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰ç«¯å£æƒ…å†µ</span><br>kubectl <span class="hljs-built_in">get</span> globalnetworkpolicies allow-external-ingress -o yaml<br>å¦‚æœæ²¡æœ‰æ”¾é€šç«¯å£ ä¿®æ”¹é…ç½® æ·»åŠ ç«¯å£å¦‚ä¸‹<br><br><span class="hljs-comment"># å¦‚æœæ²¡æœ‰æ”¾é€šï¼Œå¯ä»¥ä¿®æ”¹é…ç½®ï¼Œæ·»åŠ ç«¯å£å¦‚ä¸‹</span><br>kubectl <span class="hljs-built_in">edit</span> globalnetworkpolicies allow-external-ingress<br><span class="hljs-comment"># spec:</span><br><span class="hljs-comment">#   applyOnForward: true</span><br><span class="hljs-comment">#   ingress:</span><br><span class="hljs-comment">#   - action: Allow</span><br><span class="hljs-comment">#     destination:</span><br><span class="hljs-comment">#       ports:</span><br><span class="hljs-comment">#       - 514</span><br><span class="hljs-comment">#       - 30483 # æ·»åŠ ç«¯å£</span><br><span class="hljs-comment">#     protocol: TCP</span><br></code></pre></td></tr></table></figure><h2 id="3ã€k8s-podå¼‚å¸¸ä¸æ•…éšœæ’æŸ¥åŠé—®é¢˜æ€è·¯"><a href="#3ã€k8s-podå¼‚å¸¸ä¸æ•…éšœæ’æŸ¥åŠé—®é¢˜æ€è·¯" class="headerlink" title="3ã€k8s podå¼‚å¸¸ä¸æ•…éšœæ’æŸ¥åŠé—®é¢˜æ€è·¯"></a>3ã€k8s podå¼‚å¸¸ä¸æ•…éšœæ’æŸ¥åŠé—®é¢˜æ€è·¯</h2><p>é€šå¸¸æŒ‰ç…§è¿™ä¸‰ä¸ªæµç¨‹æ”¶é›†æ—¥å¿—ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shel">kubectl get pod &lt;pod-name&gt; -o yaml æŸ¥çœ‹ Pod çš„é…ç½®æ˜¯å¦æ­£ç¡®<br>kubectl describe pod &lt;pod-name&gt; æŸ¥çœ‹ Pod çš„äº‹ä»¶<br>kubectl logs &lt;pod-name&gt; [-c &lt;container-name&gt;] æŸ¥çœ‹å®¹å™¨æ—¥å¿—<br></code></pre></td></tr></table></figure><p><strong>Pod Pending çŠ¶æ€</strong></p><p>å¦‚æœä¸€ä¸ª Pod å¤„äº Pending çŠ¶æ€ï¼Œè¡¨ç¤º Pod æ²¡æœ‰è¢«è°ƒåº¦åˆ°èŠ‚ç‚¹ä¸Šã€‚é€šå¸¸è¿™æ˜¯å› ä¸ºæŸç§ç±»å‹çš„èµ„æºä¸è¶³å¯¼è‡´æ— æ³•è°ƒåº¦ã€‚ æŸ¥çœ‹ä¸Šé¢çš„ kubectl describe â€¦ å‘½ä»¤çš„è¾“å‡ºï¼Œå…¶ä¸­åº”è¯¥æ˜¾ç¤ºäº†ä¸ºä»€ä¹ˆæ²¡è¢«è°ƒåº¦çš„åŸå› ã€‚ å¸¸è§åŸå› å¦‚ä¸‹ï¼š</p><ul><li>èµ„æºä¸è¶³: ä½ å¯èƒ½è€—å°½äº†é›†ç¾¤ä¸Šæ‰€æœ‰çš„ CPU æˆ–å†…å­˜ã€‚æ­¤æ—¶ï¼Œä½ éœ€è¦åˆ é™¤ Podã€è°ƒæ•´èµ„æºè¯·æ±‚æˆ–è€…ä¸ºé›†ç¾¤æ·»åŠ èŠ‚ç‚¹ã€‚<br>å…³äºpodçš„èµ„æºè®¡ç®—å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://kubernetes.io/zh/docs/concepts/configuration/manage-resources-containers/">https://kubernetes.io/zh/docs/concepts/configuration/manage-resources-containers/</a></li><li>ä½¿ç”¨äº† hostPort: å¦‚æœç»‘å®š Pod åˆ° hostPortï¼Œé‚£ä¹ˆèƒ½å¤Ÿè¿è¡Œè¯¥ Pod çš„èŠ‚ç‚¹å°±æœ‰é™äº†ã€‚å¤šæ•°æƒ…å†µä¸‹ï¼ŒhostPort æ˜¯éå¿…è¦çš„ï¼Œè€Œåº”è¯¥é‡‡ç”¨ Service å¯¹è±¡æ¥æš´éœ² Podã€‚ å¦‚æœç¡®å®éœ€è¦ä½¿ç”¨hostPortï¼Œé‚£ä¹ˆé›†ç¾¤ä¸­èŠ‚ç‚¹çš„ä¸ªæ•°å°±æ˜¯æ‰€èƒ½åˆ›å»ºçš„ Pod çš„æ•°é‡ä¸Šé™ã€‚é€šå¸¸æƒ…å†µä¸‹æ˜¯HostPort å·²è¢«å ç”¨</li></ul><p><strong>Pod åœ¨ Waiting çŠ¶æ€æˆ–è€…ContainerCreating çŠ¶æ€</strong></p><p>å¦‚æœ Pod å¤„äº Waiting çŠ¶æ€ï¼Œåˆ™è¡¨ç¤º Pod å·²ç»è¢«è°ƒåº¦åˆ°æŸå·¥ä½œèŠ‚ç‚¹ï¼Œä½†æ˜¯æ— æ³•åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ åŒæ ·ï¼Œkubectl describe â€¦ å‘½ä»¤çš„è¾“å‡ºå¯èƒ½å¾ˆæœ‰ç”¨ã€‚ Waiting çŠ¶æ€çš„æœ€å¸¸è§åŸå› æ˜¯æ‹‰å–é•œåƒå¤±è´¥ã€‚è¦æ£€æŸ¥çš„æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li>ç¡®ä¿é•œåƒåå­—æ‹¼å†™æ­£ç¡®æ ¸å®æ˜¯å¦æ˜¯é…ç½®äº†é”™è¯¯çš„é•œåƒ</li><li>kubeletæ— æ³•è®¿é—®é•œåƒï¼ˆå›½å†…ç¯å¢ƒè®¿é—®éƒ¨åˆ†å¸¦æœ‰gcr.ioéœ€è¦åšé¢å¤–ç‰¹æ®Šè®¾ç½®ï¼‰</li><li>æ ¸å®ç§æœ‰é•œåƒçš„å¯†é’¥ã€å…å¯†è®¾ç½®ç­‰</li><li>é•œåƒå¤ªå¤§ï¼Œæ‹‰å–è¶…æ—¶ï¼ˆå¯ä»¥é€‚å½“è°ƒæ•´ kubelet çš„ â€“image-pull-progress-deadline å’Œ â€“runtime-request-timeout é€‰é¡¹ï¼‰</li><li>ç¡®ä¿é•œåƒå·²è¢«æ¨é€åˆ°é•œåƒä»“åº“ ç”¨æ‰‹åŠ¨å‘½ä»¤ docker pull &lt;é•œåƒ&gt; è¯•è¯•çœ‹</li><li>é•œåƒæ˜¯å¦å¯æ‹‰å–</li></ol><p><strong>pod å¼‚å¸¸æ—¥å¿—æŠ›å‡ºCNIç½‘ç»œé”™è¯¯ä»¥åŠæ— æ³•å¯åŠ¨</strong><br>CNI ç½‘ç»œé”™è¯¯æ— æ³•é…ç½®podç½‘ç»œæˆ–æ— æ³•åˆ†é…ipåœ°å€ï¼Œä¸€èˆ¬éœ€è¦æ£€æŸ¥ CNI ç½‘ç»œæ’ä»¶çš„é…ç½®ã€‚<br>å®¹å™¨æ— æ³•å¯åŠ¨ï¼Œåˆ™éœ€è¦æ£€æŸ¥ä½¿ç”¨çš„é•œåƒå’Œå®¹å™¨é…ç½®çš„å‚æ•°æ˜¯å¦æ— è¯¯ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ç”±äºæ²¡æœ‰å¸¸é©»è¿›ç¨‹å’Œå‚æ•°è®¾ç½®é€ æˆã€‚</p><p><strong>Pod å¤„äº Crashing æˆ–åˆ«çš„ä¸å¥åº·çŠ¶æ€</strong><br>ä¸€èˆ¬æƒ…å†µæ˜¯podè¢«è°ƒåº¦åï¼Œå®¹å™¨èµ„æºç®¡ç†çº¦æŸé€ æˆï¼Œæ’æŸ¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://kubernetes.io/zh/docs/concepts/configuration/manage-resources-containers/">https://kubernetes.io/zh/docs/concepts/configuration/manage-resources-containers/</a></p><p><strong>Pod å¤„äº ImagePullBackOff çŠ¶æ€</strong><br>è¿™ç§æƒ…å†µé€šå¸¸æ˜¯é•œåƒåç§°é…ç½®é”™è¯¯æˆ–è€…ç§æœ‰é•œåƒçš„å¯†é’¥é…ç½®é”™è¯¯å¯¼è‡´ã€‚å¯ä»¥ä½¿ç”¨docker pull <image> æ¥éªŒè¯é•œåƒæ˜¯å¦å¯ä»¥æ­£å¸¸æ‹‰å–.<br>å¦‚æ˜¯ç§æœ‰é•œåƒä»“åº“ï¼Œéœ€è¦é¦–å…ˆåˆ›å»ºä¸€ä¸ªdocker-registry ç±»å‹çš„ Secret ï¼ˆä½¿ç”¨çš„äº‘æœåŠ¡çš„ä»“åº“å¦‚é˜¿é‡Œé•œåƒä»“åº“å¦‚ä½¿ç”¨å…å¯†æ’ä»¶éœ€è¦å»æ‰è¿™ä¸ªsecretï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl create secret docker-registry my-secret --docker-server=DOCKER_REGISTRY_SERVER --docker-username=DOCKER_USER --docker-password=DOCKER_PASSWORD --docker-email=DOCKER_EMAIL<br></code></pre></td></tr></table></figure><p>åœ¨å®¹å™¨ä¸­å¼•ç”¨secret</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">spec:<br>  containers:<br>  - name: private-reg-container<br>    image: &lt;your-private-image&gt;<br>  imagePullSecrets:<br>  - name: my-secret<br></code></pre></td></tr></table></figure><p><strong>Pod ä¸€ç›´å¤„äº CrashLoopBackOff çŠ¶æ€</strong><br>CrashLoopBackOff çŠ¶æ€è¯´æ˜å®¹å™¨æ›¾ç»å¯åŠ¨äº†ï¼Œä½†åˆå¼‚å¸¸é€€å‡ºäº†ã€‚å¯ä»¥å…ˆæŸ¥çœ‹ä¸€ä¸‹å®¹å™¨çš„æ—¥å¿—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl logs &lt;pod-name&gt;<br>kubectl logs --previous &lt;pod-name&gt;<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬é€€å‡ºåŸå› æœ‰ï¼š</p><ul><li>å®¹å™¨è¿›ç¨‹é€€å‡ºï¼ˆæ— å¸¸é©»è¿›ç¨‹æˆ–è€…æœåŠ¡è¿›ç¨‹æ„å¤–é€€å‡ºå¯¼è‡´ï¼‰</li><li>å¥åº·æˆ–å­˜æ´»æ£€æŸ¥å¤±è´¥é€€å‡º</li><li>ä¹Ÿå¯ä»¥ç™»å½•podæ‰€åœ¨èŠ‚ç‚¹æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—åŠkubeletã€dockeræ—¥å¿—è¿›ä¸€æ­¥æ’æŸ¥</li></ul><p><strong>Pod å¤„äº Error çŠ¶æ€</strong><br>é€šå¸¸å¤„äº Error çŠ¶æ€è¯´æ˜ Pod å¯åŠ¨è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ã€‚å¸¸è§çš„åŸå› åŒ…æ‹¬<br>ä¾èµ–çš„ ConfigMapã€Secret æˆ–è€… PV ç­‰ä¸å­˜åœ¨<br>è¯·æ±‚çš„èµ„æºè¶…è¿‡äº†ç®¡ç†å‘˜è®¾ç½®çš„é™åˆ¶ï¼Œæ¯”å¦‚è¶…è¿‡äº† LimitRange ç­‰<br>è¿åé›†ç¾¤çš„å®‰å…¨ç­–ç•¥ï¼Œæ¯”å¦‚è¿åäº† PodSecurityPolicy ç­‰<br>å®¹å™¨æ— æƒæ“ä½œé›†ç¾¤å†…çš„èµ„æºï¼Œæ¯”å¦‚å¼€å¯ RBAC åï¼Œéœ€è¦ä¸º ServiceAccount é…ç½®è§’è‰²ç»‘å®š</p><h2 id="4ã€kubectlç¼–è¾‘ï¼ˆkubectl-editï¼‰"><a href="#4ã€kubectlç¼–è¾‘ï¼ˆkubectl-editï¼‰" class="headerlink" title="4ã€kubectlç¼–è¾‘ï¼ˆkubectl editï¼‰"></a>4ã€kubectlç¼–è¾‘ï¼ˆ<code>kubectl edit</code>ï¼‰</h2><p>ç”¨äºåœ¨çº¿ç¼–è¾‘ Kubernetes èµ„æºçš„é…ç½®ï¼ˆä¼šæ‰“å¼€é»˜è®¤ç¼–è¾‘å™¨ï¼Œä¿å­˜åè‡ªåŠ¨ç”Ÿæ•ˆï¼‰ï¼Œè¯­æ³•ï¼š <code>kubectl edit &lt;èµ„æºç±»å‹&gt; &lt;èµ„æºåç§°&gt;</code></p><table><thead><tr><th>èµ„æºç±»å‹</th><th>å®Œæ•´ç±»å‹</th><th>ç¼©å†™</th><th>ç¼–è¾‘å‘½ä»¤ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Pod</td><td>pod</td><td>pod</td><td>kubectl edit pod my-pod</td><td>ç¼–è¾‘æŒ‡å®š Pod çš„é…ç½®</td></tr><tr><td>Serviceï¼ˆsvcï¼‰</td><td>service</td><td>svc</td><td>kubectl edit svc my-svc</td><td>ç¼–è¾‘æŒ‡å®š Service çš„é…ç½®</td></tr><tr><td>Deployment</td><td>deployment</td><td>deploy</td><td>kubectl edit deploy my-deploy</td><td>ç¼–è¾‘æŒ‡å®š Deploymentï¼ˆæ— çŠ¶æ€å·¥ä½œè´Ÿè½½ï¼‰</td></tr><tr><td>StatefulSet</td><td>statefulset</td><td>sts</td><td>kubectl edit sts my-sts</td><td>ç¼–è¾‘æŒ‡å®š StatefulSetï¼ˆæœ‰çŠ¶æ€å·¥ä½œè´Ÿè½½ï¼‰</td></tr><tr><td>DaemonSet</td><td>daemonset</td><td>ds</td><td>kubectl edit ds my-ds</td><td>ç¼–è¾‘æŒ‡å®š DaemonSetï¼ˆèŠ‚ç‚¹çº§å·¥ä½œè´Ÿè½½ï¼‰</td></tr><tr><td>ReplicaSet</td><td>replicaset</td><td>rs</td><td>kubectl edit rs my-rs</td><td>ç¼–è¾‘æŒ‡å®š ReplicaSetï¼ˆå‰¯æœ¬é›†ï¼ŒDeployment çš„åº•å±‚æ§åˆ¶å™¨ï¼‰</td></tr><tr><td>Job</td><td>job</td><td>job</td><td>kubectl edit job my-job</td><td>ç¼–è¾‘æŒ‡å®š Jobï¼ˆä¸€æ¬¡æ€§ä»»åŠ¡ï¼‰</td></tr><tr><td>CronJob</td><td>cronjob</td><td>cj</td><td>kubectl edit cj my-cronjob</td><td>ç¼–è¾‘æŒ‡å®š CronJobï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰</td></tr></tbody></table><h2 id="5-æŸ¥çœ‹èµ„æºè¯¦æƒ…ï¼ˆkubectl-describeï¼‰"><a href="#5-æŸ¥çœ‹èµ„æºè¯¦æƒ…ï¼ˆkubectl-describeï¼‰" class="headerlink" title="5 æŸ¥çœ‹èµ„æºè¯¦æƒ…ï¼ˆkubectl describeï¼‰"></a>5 æŸ¥çœ‹èµ„æºè¯¦æƒ…ï¼ˆ<code>kubectl describe</code>ï¼‰</h2><table><thead><tr><th>èµ„æºç±»å‹</th><th>å®Œæ•´ç±»å‹</th><th>ç¼©å†™</th><th>æŸ¥çœ‹å‘½ä»¤ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Pod</td><td>pod</td><td>pod</td><td>kubectl describe pod my-pod</td><td>æŸ¥çœ‹æŒ‡å®š Pod çš„è¯¦ç»†çŠ¶æ€ï¼ˆåŒ…æ‹¬å®¹å™¨ã€äº‹ä»¶ã€æŒ‚è½½ç­‰ï¼‰</td></tr><tr><td>Serviceï¼ˆsvcï¼‰</td><td>service</td><td>svc</td><td>kubectl describe svc my-svc</td><td>æŸ¥çœ‹æŒ‡å®š Service çš„è¯¦æƒ…ï¼ˆåŒ…æ‹¬ endpointsã€ç«¯å£æ˜ å°„ç­‰ï¼‰</td></tr><tr><td>Deployment</td><td>deployment</td><td>deploy</td><td>kubectl describe deploy my-deploy</td><td>æŸ¥çœ‹ Deployment çš„è¯¦æƒ…ï¼ˆåŒ…æ‹¬å‰¯æœ¬æ•°ã€æ›´æ–°ç­–ç•¥ã€å…³è” RS ç­‰ï¼‰</td></tr><tr><td>StatefulSet</td><td>statefulset</td><td>sts</td><td>kubectl describe sts my-sts</td><td>æŸ¥çœ‹ StatefulSet çš„è¯¦æƒ…ï¼ˆåŒ…æ‹¬æœ‰åºéƒ¨ç½²ã€ç¨³å®šç½‘ç»œæ ‡è¯†ç­‰ï¼‰</td></tr><tr><td>DaemonSet</td><td>daemonset</td><td>ds</td><td>kubectl describe ds my-ds</td><td>æŸ¥çœ‹ DaemonSet çš„è¯¦æƒ…ï¼ˆåŒ…æ‹¬èŠ‚ç‚¹é€‰æ‹©ã€è¿è¡ŒèŠ‚ç‚¹ç­‰ï¼‰</td></tr><tr><td>ReplicaSet</td><td>replicaset</td><td>rs</td><td>kubectl describe rs my-rs</td><td>æŸ¥çœ‹ ReplicaSet çš„è¯¦æƒ…ï¼ˆåŒ…æ‹¬å…³è” Podã€å‰¯æœ¬çŠ¶æ€ç­‰ï¼‰</td></tr><tr><td>Job</td><td>job</td><td>job</td><td>kubectl describe job my-job</td><td>æŸ¥çœ‹ Job çš„è¯¦æƒ…ï¼ˆåŒ…æ‹¬ä»»åŠ¡çŠ¶æ€ã€å®Œæˆæƒ…å†µç­‰ï¼‰</td></tr><tr><td>CronJob</td><td>cronjob</td><td>cj</td><td>kubectl describe cj my-cronjob</td><td>æŸ¥çœ‹ CronJob çš„è¯¦æƒ…ï¼ˆåŒ…æ‹¬å®šæ—¶è§„åˆ™ã€å†å²ä»»åŠ¡ç­‰ï¼‰</td></tr></tbody></table><h2 id="6-configmapç›¸å…³"><a href="#6-configmapç›¸å…³" class="headerlink" title="6 configmapç›¸å…³"></a>6 configmapç›¸å…³</h2><p><strong>å¸¸ç”¨å‘½ä»¤</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs Shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å½“å‰å‘½åç©ºé—´</span><br>kubectl get cm<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰€æœ‰å‘½åç©ºé—´</span><br>kubectl get cm --all-namespaces<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span><br>kubectl describe cm my-config<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŒ‡å®šæ ¼å¼</span><br>kubectl get cm my-config -o yaml<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ç‰¹å®šé”®å€¼å¯¹</span><br>kubectl get cm my-config -o jsonpath=&#x27;&#123;.data.key1&#125;&#x27;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å…ˆå¯¼å‡ºå½“å‰ ConfigMap åˆ°æ–‡ä»¶</span><br>kubectl get cm my-config -o yaml &gt; configmap.yaml<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¿®æ”¹æ–‡ä»¶åæ›¿æ¢</span><br>kubectl replace -f configmap.yaml<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ é™¤</span><br>kubectl delete cm my-config<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ é™¤æ‰€æœ‰ ConfigMapï¼ˆæ…ç”¨ï¼‰</span><br>kubectl delete cm --all<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é«˜çº§æ“ä½œ</span><br>kubectl get cm my-config -o yaml &gt; configmap.yaml    # å¯¼å‡º ConfigMap ä¸º YAML æ–‡ä»¶<br>kubectl apply -f configmap.yaml        # ä» YAML æ–‡ä»¶æ¢å¤<br>kubectl set env deployment/my-deploy --from=configmap/my-config # æ³¨å…¥åˆ° Deployment ç¯å¢ƒå˜é‡<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åœ¨ Pod å®šä¹‰ä¸­ä½¿ç”¨ subPathvolumes:- name: config-volume æŒ‚è½½åˆ° Pod ç‰¹å®šè·¯å¾„ï¼ˆé¿å…è¦†ç›–ç›®å½•ï¼‰</span><br>volumes:- name: config-volume<br>  configMap:name: my-config<br>containers:- name: my-container<br>  volumeMounts:- name: config-volume<br>    mountPath: /etc/conf/specific-file.conf<br>    subPath: specific-key<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹comfigmapæµç¨‹</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">kubectl <span class="hljs-built_in">get</span> configmap chat-agent -n <span class="hljs-built_in">platform</span> -o yaml &gt; configmap.yaml                <span class="hljs-comment"># yamlæ ¼å¼åŒ–è¾“å‡ºåˆ°comfigmap.yamlæ–‡ä»¶</span><br>cp configmap.yaml ./back-config/configmap-$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H-%M-%S).yaml        <span class="hljs-comment"># é€šè¿‡æ—¶é—´æ ¼å¼å¤‡ä»½æ–‡ä»¶</span><br>kubectl apply -f configmap.yaml -n <span class="hljs-built_in">platform</span>                                        <span class="hljs-comment"># é€šè¿‡yamlæ–‡ä»¶æ›´æ–°configmapé…ç½®</span><br>kubectl <span class="hljs-built_in">get</span> configmap aiagent-imforward -n appstore-official -o yaml  <span class="hljs-comment"># æŸ¥çœ‹comfigmapé…ç½®ä¿¡æ¯ æ ¼å¼åŒ–</span><br>kubectl <span class="hljs-built_in">delete</span> pod chat-agent<span class="hljs-number">-875</span>c6c445-p4jwt -n <span class="hljs-built_in">platform</span>                <span class="hljs-comment"># ä¿®æ”¹å®Œæˆä¹‹åéœ€è¦é‡å¯pod</span><br></code></pre></td></tr></table></figure><h2 id="7-helm-ç›¸å…³"><a href="#7-helm-ç›¸å…³" class="headerlink" title="7 helm ç›¸å…³"></a>7 helm ç›¸å…³</h2><p>å¿«é€Ÿä½¿ç”¨å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># helm é…ç½® æ›´æ–°</span><br>helm get values -n platform chat-agent &gt; chat-agent.yaml  <span class="hljs-comment"># å¯¼å‡ºåŸé…ç½®ä¿¡æ¯ï¼Œå¤‡ä»½ï¼Œä¿®æ”¹ dataupgrade.image(init-enc é•œåƒ) å’Œ image.url(encé•œåƒ)</span><br>helm upgrade -i -n platform chat-agent chat-agent-0.1.0-feature-1023755-mhd-9ddbc574.tgz -f chat-agent.yaml<br></code></pre></td></tr></table></figure><p>1 å®‰è£… Helm</p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œç¡®ä¿ä½ å·²ç»å®‰è£…äº† Helm, æ¨èä½¿ç”¨ Helm v3ï¼ˆHelm v2 çš„ Tiller å·²è¢«ç§»é™¤ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># Linux ä¸Šå®‰è£… Helm</span><br>curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3<br><span class="hljs-built_in">chmod</span> 700 get_helm.sh<br>./get_helm.sh<br></code></pre></td></tr></table></figure><p>2 ä½¿ç”¨ helm create åˆ›å»º Chart æ¨¡æ¿</p><p>Helm æä¾›äº† create å‘½ä»¤æ¥ç”Ÿæˆä¸€ä¸ªåŸºæœ¬çš„ Chart æ¨¡æ¿ç»“æ„ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">helm create <span class="hljs-keyword">my</span>-chart<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œåä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«ä»¥ä¸‹ç»“æ„çš„ç›®å½•ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">my</span>-chart/<br>â”œâ”€â”€ Chart.yaml        <span class="hljs-comment"># åŒ…å« Chart çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ˆåç§°ã€ç‰ˆæœ¬ã€æè¿°ç­‰ï¼‰</span><br>â”œâ”€â”€ values.yaml       <span class="hljs-comment"># Chart çš„é»˜è®¤é…ç½®å‚æ•°</span><br>â”œâ”€â”€ charts/           <span class="hljs-comment"># ä¾èµ–çš„å…¶ä»– Chartï¼ˆå¦‚å­ Chartï¼‰</span><br>â”œâ”€â”€ templates/        <span class="hljs-comment"># Kubernetes èµ„æºæ¨¡æ¿ï¼ˆDeploymentã€Serviceã€ConfigMap ç­‰ï¼‰</span><br>â”‚   â”œâ”€â”€ deployment.yaml<br>â”‚   â”œâ”€â”€ service.yaml<br>â”‚   â””â”€â”€ _helpers.tpl  <span class="hljs-comment"># å…¬å…±çš„æ¨¡æ¿è¾…åŠ©å‡½æ•°</span><br>â””â”€â”€ README.md         <span class="hljs-comment"># Chart çš„æè¿°è¯´æ˜</span><br></code></pre></td></tr></table></figure><p>ğŸ”§ values.yaml æ˜¯ç”¨æˆ·è‡ªå®šä¹‰é…ç½®çš„æ¥æºï¼Œtemplates&#x2F; ä¸­çš„æ–‡ä»¶é€šè¿‡ <code> &#123;&#123; .Values &#125;&#125;</code> è·å–é…ç½®ã€‚</p><p>Helm Chart ç»“æ„è¯´æ˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Bash">Chart.yamlï¼šå®šä¹‰ Chart çš„å…ƒæ•°æ®ï¼ˆåç§°ã€ç‰ˆæœ¬ã€æè¿°ç­‰ï¼‰<br>values.yamlï¼šå®šä¹‰é…ç½®å‚æ•°ï¼ˆæ”¯æŒåµŒå¥—ã€æ³¨é‡Šã€ç¯å¢ƒåŒºåˆ†ï¼‰<br>templates/ ï¼šæ‰€æœ‰ Kubernetes èµ„æºæ–‡ä»¶ï¼Œä½¿ç”¨ Go æ¨¡æ¿è¯­æ³•<br>charts/ ï¼šç”¨äºå¼•å…¥ä¾èµ–çš„ Chartï¼ˆå­ Chartï¼‰<br>_helpers.tplï¼šä¾¿äºå¤ç”¨çš„æ¨¡æ¿ç‰‡æ®µ<br>README.mdï¼šChart çš„ç®€ä»‹æˆ–ä½¿ç”¨æ–‡æ¡£<br></code></pre></td></tr></table></figure><p>Helm Chart çš„åŸºæœ¬å¼€å‘æµç¨‹</p><p>1 ç¼–è¾‘æ¨¡æ¿æ–‡ä»¶</p><ul><li>åœ¨ my-chart&#x2F;templates&#x2F; ä¸­ç¼–å†™ Kubernetes èµ„æºæ¨¡æ¿ï¼ˆå¦‚ Deploymentã€Service ç­‰ï¼‰</li><li>ä½¿ç”¨ Helm æ¨¡æ¿è¯­æ³• <code>&#123;&#123; .Values &#125;&#125;</code> æ¥åŠ¨æ€ç”Ÿæˆéƒ¨ç½²å‚æ•°</li></ul><p>2 ä¿®æ”¹ values.yaml é…ç½®</p><ul><li>å®šä¹‰é»˜è®¤å€¼ï¼ˆæ¯”å¦‚é•œåƒç‰ˆæœ¬ã€èµ„æºè¯·æ±‚ã€ç¯å¢ƒå˜é‡ç­‰ï¼‰</li><li>å¯ä»¥ä½¿ç”¨æ›´å¤æ‚çš„ç»“æ„ï¼ˆå¦‚ env: { debug: true }ï¼‰æ¥ç»„ç»‡é…ç½®</li></ul><p>3 æ£€æŸ¥ Chart æ˜¯å¦ç¬¦åˆè§„èŒƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">helm lint my-chart<br></code></pre></td></tr></table></figure><p>4 æ‰“åŒ… Chart</p><p>åœ¨ Chart ç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆ .tgz æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">helm package my-chart<br></code></pre></td></tr></table></figure><ul><li>ç”Ÿæˆçš„åŒ…ä¼šä¿å­˜ä¸º my-chart-<version>.tgz</li><li>ä½¿ç”¨ â€“dry-run å‚æ•°å¯é¢„è§ˆæ‰“åŒ…è¿‡ç¨‹ï¼Œä¸çœŸæ­£ç”Ÿæˆæ–‡ä»¶ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">helm package my-chart --dry-run<br></code></pre></td></tr></table></figure><p>5 æµ‹è¯• Chartï¼ˆå¯é€‰ï¼‰</p><p><code>helm template</code> å‘½ä»¤å…è®¸ä½ æœ¬åœ°æ¸²æŸ“ Chart æ¨¡æ¿å¹¶è¾“å‡ºç”Ÿæˆåçš„ YAML æ¸…å•ï¼Œè€Œæ— éœ€çœŸæ­£å®‰è£…åˆ° Kubernetes é›†ç¾¤ä¸­ã€‚è¿™å¯¹äºè°ƒè¯•å’ŒéªŒè¯æ¨¡æ¿æ˜¯å¦æ­£ç¡®éå¸¸æœ‰ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">helm template [RELEASE_NAME] [CHART_PATH] --debug --dry-run<br></code></pre></td></tr></table></figure><p>æˆ–è€…æ›´å…·ä½“åœ°ï¼Œå¦‚æœä½ åªæƒ³æŸ¥çœ‹ ConfigMap çš„ç”Ÿæˆæƒ…å†µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">helm template [RELEASE_NAME] [CHART_PATH] --show-only templates/configmap.yaml --debug --dry-run<br></code></pre></td></tr></table></figure><ul><li>**<code>[RELEASE_NAME]</code>**ï¼šä¸ºä½ è¿™æ¬¡æ£€æŸ¥éšæ„èµ·ä¸ªåå­—ã€‚</li><li>**<code>[CHART_PATH]</code>**ï¼šä½ çš„ Chart ç›®å½•çš„è·¯å¾„ã€‚</li><li>**<code>--debug --dry-run</code>**ï¼šè¿™ä¸¤ä¸ªé€‰é¡¹ç»„åˆä½¿ç”¨ï¼Œå‘Šè¯‰ Helm åªæ¸²æŸ“æ¨¡æ¿å¹¶è¾“å‡ºç»“æœï¼Œè€Œä¸è¿›è¡Œå®é™…å®‰è£…5ã€‚</li><li>**<code>--show-only</code>**ï¼šè¿™ä¸ªé€‰é¡¹éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥æŒ‡å®šåªæ¸²æŸ“å’Œæ˜¾ç¤ºç‰¹å®šæ¨¡æ¿æ–‡ä»¶ï¼ˆä¾‹å¦‚ä½ çš„ <code>configmap.yaml</code>ï¼‰çš„è¾“å‡ºï¼Œé¿å…è¢«å…¶ä»–èµ„æºæ¸…å•å¹²æ‰°ã€‚</li></ul><p>æ‰“åŒ… Helm Chart çš„å®Œæ•´ç¤ºä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">cd</span> my-chart<br>helm lint<br>helm package . --version v1.0.0 --destination ./charts<br></code></pre></td></tr></table></figure><p>Helm å¸¸ç”¨å‘½ä»¤</p><table><thead><tr><th align="left">å‘½ä»¤</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">helm create <chart-name></td><td align="left">åˆ›å»ºä¸€ä¸ªæ–°çš„ Chart é¡¹ç›®ç»“æ„</td></tr><tr><td align="left">helm lint <chart-path></td><td align="left">æ£€æŸ¥ Chart æ˜¯å¦ç¬¦åˆè§„èŒƒ</td></tr><tr><td align="left">helm package <chart-path></td><td align="left">å°† Chart æ‰“åŒ…ä¸º .tgz æ–‡ä»¶</td></tr><tr><td align="left">helm install <release-name> <chart-path></td><td align="left">å®‰è£… Chart åˆ° Kubernetes é›†ç¾¤</td></tr><tr><td align="left">helm upgrade <release-name> <chart-path></td><td align="left">å‡çº§å·²å®‰è£…çš„ç‰ˆæœ¬</td></tr><tr><td align="left">helm rollback <release-name> <revision-number></td><td align="left">å›æ»šåˆ°æŸä¸ªå†å²ç‰ˆæœ¬</td></tr><tr><td align="left">helm get all <release-name></td><td align="left">æŸ¥çœ‹å·²å®‰è£…çš„é‡Šæ”¾çš„è¯¦ç»†ä¿¡æ¯</td></tr><tr><td align="left">helm list</td><td align="left">åˆ—å‡ºå½“å‰é›†ç¾¤ä¸­æ‰€æœ‰å·²å®‰è£…çš„ Chart å‘å¸ƒç‰ˆæœ¬</td></tr><tr><td align="left">helm repo add <repo-name> <repo-url></td><td align="left">æ·»åŠ è¿œç¨‹ Helm ä»“åº“</td></tr><tr><td align="left">helm repo update</td><td align="left">æ›´æ–°æœ¬åœ° Chart ä»“åº“ç¼“å­˜</td></tr><tr><td align="left">helm search repo <keyword></td><td align="left">æœç´¢è¿œç¨‹ä»“åº“ä¸­çš„ Chart</td></tr><tr><td align="left">helm repo list</td><td align="left">æŸ¥çœ‹å½“å‰é…ç½®çš„è¿œç¨‹ä»“åº“åˆ—è¡¨</td></tr><tr><td align="left">helm repo remove <repo-name></td><td align="left">ç§»é™¤è¿œç¨‹ä»“åº“</td></tr><tr><td align="left">helm rollback <release-name> <revision></td><td align="left">å›æ»šæŸä¸ªå‘å¸ƒçš„å†å²ç‰ˆæœ¬</td></tr><tr><td align="left">helm history <release-name></td><td align="left">æŸ¥çœ‹æŸä¸ªå‘å¸ƒçš„å†å²ç‰ˆæœ¬è®°å½•</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlåˆ†åŒºè¡¨</title>
    <link href="/2025/04/14/tools/mysql%E5%88%86%E5%8C%BA%E8%A1%A8/"/>
    <url>/2025/04/14/tools/mysql%E5%88%86%E5%8C%BA%E8%A1%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="mysqlåˆ†åŒºè¡¨"><a href="#mysqlåˆ†åŒºè¡¨" class="headerlink" title="mysqlåˆ†åŒºè¡¨"></a>mysqlåˆ†åŒºè¡¨</h1><h2 id="1ã€åˆ†åŒºçš„åŸºæœ¬æ¦‚å¿µ"><a href="#1ã€åˆ†åŒºçš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1ã€åˆ†åŒºçš„åŸºæœ¬æ¦‚å¿µ"></a>1ã€åˆ†åŒºçš„åŸºæœ¬æ¦‚å¿µ</h2><p>MySQLåˆ†åŒº æ˜¯ä¸€ç§æ•°æ®åº“ä¼˜åŒ–çš„æŠ€æœ¯ï¼Œå®ƒå…è®¸å°†ä¸€ä¸ªå¤§çš„è¡¨ã€ç´¢å¼•æˆ–å…¶å­é›†åˆ†å‰²æˆå¤šä¸ªè¾ƒå°çš„ã€æ›´æ˜“äºç®¡ç†çš„ç‰‡æ®µï¼Œè¿™äº›ç‰‡æ®µç§°ä¸ºâ€œåˆ†åŒºâ€ã€‚æ¯ä¸ªåˆ†åŒºéƒ½å¯ä»¥ç‹¬ç«‹äºå…¶ä»–åˆ†åŒºè¿›è¡Œå­˜å‚¨ã€å¤‡ä»½ã€ç´¢å¼•å’Œå…¶ä»–æ“ä½œã€‚è¿™ç§æŠ€æœ¯ä¸»è¦æ˜¯ä¸ºäº†æ”¹å–„å¤§å‹æ•°æ®åº“è¡¨çš„æŸ¥è¯¢æ€§èƒ½ã€ç»´æŠ¤çš„æ–¹ä¾¿æ€§ä»¥åŠæ•°æ®ç®¡ç†æ•ˆç‡ã€‚</p><p><strong>ç‰©ç†å­˜å‚¨ä¸é€»è¾‘åˆ†å‰²</strong></p><ul><li>ç‰©ç†ä¸Šï¼Œæ¯ä¸ªåˆ†åŒºå¯ä»¥å­˜å‚¨åœ¨ä¸åŒçš„æ–‡ä»¶æˆ–ç›®å½•ä¸­ï¼Œè¿™å–å†³äºåˆ†åŒºç±»å‹å’Œé…ç½®ã€‚</li><li>é€»è¾‘ä¸Šï¼Œè¡¨æ•°æ®æ ¹æ®åˆ†åŒºé”®çš„å€¼è¢«åˆ†å‰²åˆ°ä¸åŒçš„åˆ†åŒºé‡Œã€‚</li></ul><p><strong>æŸ¥è¯¢æ€§èƒ½æå‡</strong></p><ul><li>å½“æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼ŒMySQLèƒ½å¤Ÿç¡®å®šå“ªäº›åˆ†åŒºåŒ…å«ç›¸å…³æ•°æ®ï¼Œå¹¶åªåœ¨è¿™äº›åˆ†åŒºä¸Šè¿›è¡Œæœç´¢ã€‚è¿™å‡å°‘äº†éœ€è¦æœç´¢çš„æ•°æ®é‡ï¼Œä»è€Œæé«˜äº†æŸ¥è¯¢æ€§èƒ½ã€‚</li><li>å¯¹äºèŒƒå›´æŸ¥è¯¢æˆ–ç‰¹å®šå€¼çš„æŸ¥è¯¢ï¼Œåˆ†åŒºå¯ä»¥æ˜¾è‘—å‡å°‘æ‰«æçš„æ•°æ®é‡ã€‚</li></ul><p><strong>æ•°æ®ç®¡ç†ä¸ç»´æŠ¤</strong></p><ul><li>åˆ†åŒºå¯ä»¥ä½¿å¾—æ•°æ®ç®¡ç†æ›´åŠ çµæ´»ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç‹¬ç«‹åœ°å¤‡ä»½ã€æ¢å¤æˆ–ä¼˜åŒ–æŸä¸ªåˆ†åŒºï¼Œè€Œæ— éœ€å¯¹æ•´ä¸ªè¡¨è¿›è¡Œæ“ä½œã€‚</li><li>å¯¹äºå…·æœ‰æ—¶æ•ˆæ€§çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡åˆ é™¤æˆ–å½’æ¡£æŸä¸ªåˆ†åŒºæ¥å¿«é€Ÿé‡Šæ”¾å­˜å‚¨ç©ºé—´ã€‚</li></ul><p><strong>æ‰©å±•æ€§ä¸å¹¶è¡Œå¤„ç†</strong></p><ul><li>åˆ†åŒºæŠ€æœ¯ä½¿å¾—æ•°æ®åº“è¡¨æ›´å®¹æ˜“æ‰©å±•åˆ°æ›´å¤§çš„æ•°æ®é›†ã€‚å½“è¡¨çš„å¤§å°è¶…è¿‡å•ä¸ªå­˜å‚¨è®¾å¤‡çš„å®¹é‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åˆ†åŒºå°†æ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªå­˜å‚¨è®¾å¤‡ä¸Šã€‚</li><li>ç”±äºæ¯ä¸ªåˆ†åŒºå¯ä»¥ç‹¬ç«‹å¤„ç†ï¼Œå› æ­¤å¯ä»¥å¹¶è¡Œæ‰§è¡ŒæŸ¥è¯¢å’Œå…¶ä»–æ•°æ®åº“æ“ä½œï¼Œä»è€Œè¿›ä¸€æ­¥æé«˜æ€§èƒ½</li></ul><h2 id="2ã€åˆ†åŒºåŸç†"><a href="#2ã€åˆ†åŒºåŸç†" class="headerlink" title="2ã€åˆ†åŒºåŸç†"></a>2ã€åˆ†åŒºåŸç†</h2><p>åˆ†åŒºæŠ€æœ¯æ˜¯å°†è¡¨ä¸­çš„è®°å½•åˆ†æ•£åˆ°ä¸åŒçš„ç‰©ç†æ–‡ä»¶ä¸­ï¼Œå³æ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ª.idbæ–‡ä»¶ã€‚è¿™æ˜¯MySQL 5.1åŠä»¥åç‰ˆæœ¬æ”¯æŒçš„ä¸€é¡¹é«˜çº§åŠŸèƒ½ï¼Œæ—¨åœ¨æé«˜å¤§æ•°æ®è¡¨çš„ç®¡ç†æ•ˆç‡å’ŒæŸ¥è¯¢æ€§èƒ½ã€‚</p><ol><li><strong>åˆ†åŒºç±»å‹</strong>ï¼šMySQLæ”¯æŒæ°´å¹³åˆ†åŒºï¼Œå³æ ¹æ®æŸäº›æ¡ä»¶å°†è¡¨ä¸­çš„è¡Œåˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºä¸­ã€‚è¿™äº›åˆ†åŒºåœ¨ç‰©ç†ä¸Šæ˜¯ç‹¬ç«‹çš„ï¼Œå¯ä»¥å•ç‹¬å¤„ç†ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ•´ä½“å¤„ç†ã€‚ </li><li><strong>æ€§èƒ½å’Œå½±å“</strong>ï¼šè™½ç„¶åˆ†åŒºå¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½å’Œç®¡ç†æ•ˆç‡ï¼Œä½†å¦‚æœä¸æ°å½“ä½¿ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨åˆ†åŒºæ—¶åº”è°¨æ…è¯„ä¼°å…¶å½±å“ã€‚ </li><li><strong>ç´¢å¼•ä¸åˆ†åŒº</strong>ï¼šåœ¨MySQLä¸­ï¼Œåˆ†åŒºæ˜¯å±€éƒ¨çš„ï¼Œæ„å‘³ç€æ•°æ®å’Œç´¢å¼•éƒ½å­˜å‚¨åœ¨å„è‡ªçš„åˆ†åŒºå†…ã€‚ç›®å‰ï¼ŒMySQLå°šä¸æ”¯æŒå…¨å±€åˆ†åŒºç´¢å¼•ã€‚ </li><li><strong>åˆ†åŒºé”®ä¸å”¯ä¸€ç´¢å¼•</strong>ï¼šå½“è¡¨å­˜åœ¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ—¶ï¼Œåˆ†åŒºåˆ—å¿…é¡»æ˜¯è¿™äº›ç´¢å¼•çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿åˆ†åŒºçš„å”¯ä¸€æ€§å’ŒæŸ¥è¯¢æ•ˆç‡ã€‚</li></ol><p>é€šè¿‡åˆç†åˆ©ç”¨åˆ†åŒºæŠ€æœ¯ï¼Œå¯ä»¥ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½ã€æé«˜ç®¡ç†æ•ˆç‡ï¼Œå¹¶æ›´å¥½åœ°é€‚åº”å¤§è§„æ¨¡æ•°æ®å¤„ç†çš„éœ€æ±‚ã€‚ç„¶è€Œï¼Œä¸ºäº†å……åˆ†åˆ©ç”¨è¿™ä¸€åŠŸèƒ½ï¼Œ<a href="https://cloud.tencent.com/product/dmc?from_column=20065&from=20065">æ•°æ®åº“ç®¡ç†</a>å‘˜å’Œå¼€å‘è€…éœ€è¦æ·±å…¥äº†è§£å…¶å·¥ä½œåŸç†å’Œæœ€ä½³å®è·µ</p><h6 id="åˆ†åŒºç±»å‹"><a href="#åˆ†åŒºç±»å‹" class="headerlink" title="åˆ†åŒºç±»å‹"></a>åˆ†åŒºç±»å‹</h6><p>MySQLæ”¯æŒå‡ ç§ä¸åŒç±»å‹çš„åˆ†åŒºæ–¹å¼ï¼ŒåŒ…æ‹¬RANGEã€LISTã€HASHå’ŒKEYã€‚ä¸‹é¢ç®€è¦ä»‹ç»è¿™äº›åˆ†åŒºæ–¹å¼çš„å·¥ä½œåŸç†ï¼š</p><ol><li><strong>RANGEåˆ†åŒº</strong>ï¼šåŸºäºåˆ—çš„å€¼èŒƒå›´å°†æ•°æ®åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ ¹æ®æ—¥æœŸèŒƒå›´å°†æ•°æ®åˆ†é…åˆ°ä¸åŒçš„æœˆä»½æˆ–å¹´ä»½çš„åˆ†åŒºä¸­ã€‚</li><li><strong>LISTåˆ†åŒº</strong>ï¼šç±»ä¼¼äºRANGEåˆ†åŒºï¼Œä½†LISTåˆ†åŒºæ˜¯åŸºäºåˆ—çš„ç¦»æ•£å€¼é›†åˆæ¥åˆ†é…æ•°æ®çš„ã€‚å¯ä»¥æŒ‡å®šä¸€ä¸ªæšä¸¾åˆ—è¡¨æ¥å®šä¹‰æ¯ä¸ªåˆ†åŒºçš„å€¼ã€‚</li><li><strong>HASHåˆ†åŒº</strong>ï¼šåŸºäºç”¨æˆ·å®šä¹‰çš„è¡¨è¾¾å¼çš„å“ˆå¸Œå€¼æ¥åˆ†é…æ•°æ®åˆ°ä¸åŒçš„åˆ†åŒºã€‚è¿™ç§åˆ†åŒºæ–¹å¼é€‚ç”¨äºç¡®ä¿æ•°æ®åœ¨å„ä¸ªåˆ†åŒºä¹‹é—´å‡åŒ€åˆ†å¸ƒã€‚</li><li><strong>KEYåˆ†åŒº</strong>ï¼šç±»ä¼¼äºHASHåˆ†åŒºï¼Œä½†KEYåˆ†åŒºæ”¯æŒè®¡ç®—ä¸€åˆ—æˆ–å¤šåˆ—çš„å“ˆå¸Œå€¼æ¥åˆ†é…æ•°æ®ã€‚å®ƒæ”¯æŒå¤šåˆ—ä½œä¸ºåˆ†åŒºé”®ï¼Œå¹¶ä¸”æä¾›äº†æ›´å¥½çš„æ•°æ®åˆ†å¸ƒå’ŒæŸ¥è¯¢æ€§èƒ½ã€‚</li></ol><h2 id="3ã€åˆ†åŒºçš„ä¼˜åŠ¿å’Œä½¿ç”¨åœºæ™¯"><a href="#3ã€åˆ†åŒºçš„ä¼˜åŠ¿å’Œä½¿ç”¨åœºæ™¯" class="headerlink" title="3ã€åˆ†åŒºçš„ä¼˜åŠ¿å’Œä½¿ç”¨åœºæ™¯"></a>3ã€åˆ†åŒºçš„ä¼˜åŠ¿å’Œä½¿ç”¨åœºæ™¯</h2><p>MySQLåˆ†åŒºå¸¦æ¥äº†è®¸å¤šä¼˜åŠ¿ï¼Œé€‚ç”¨äºå„ç§ä½¿ç”¨åœºæ™¯ï¼š</p><ol><li><strong>æ€§èƒ½æå‡</strong>ï¼šé€šè¿‡å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªåˆ†åŒºä¸­ï¼Œå¯ä»¥å¹¶è¡Œå¤„ç†æŸ¥è¯¢ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚åŒæ—¶ï¼Œå¯¹äºæ¶‰åŠå¤§é‡æ•°æ®çš„ç»´æŠ¤æ“ä½œï¼ˆå¦‚å¤‡ä»½å’Œæ¢å¤ï¼‰ï¼Œå¯ä»¥å•ç‹¬å¤„ç†æ¯ä¸ªåˆ†åŒºï¼Œå‡å°‘äº†æ“ä½œçš„å¤æ‚æ€§å’Œæ—¶é—´æˆæœ¬ã€‚</li><li><strong>ç®¡ç†ç®€åŒ–</strong>ï¼šåˆ†åŒºå¯ä»¥ä½¿å¾—æ•°æ®ç®¡ç†æ›´åŠ çµæ´»ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç‹¬ç«‹åœ°å¤‡ä»½ã€æ¢å¤æˆ–ä¼˜åŒ–æŸä¸ªåˆ†åŒºï¼Œè€Œæ— éœ€å¯¹æ•´ä¸ªè¡¨è¿›è¡Œæ“ä½œã€‚è¿™å¯¹äºå¤§å‹æ•°æ®åº“è¡¨æ¥è¯´å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥æ˜¾è‘—å‡å°‘ç»´æŠ¤æ—¶é—´å’Œèµ„æºæ¶ˆè€—ã€‚</li><li><strong>æ•°æ®å½’æ¡£****å’Œæ¸…ç†</strong>ï¼šå¯¹äºå…·æœ‰æ—¶é—´å±æ€§çš„æ•°æ®ï¼ˆå¦‚æ—¥å¿—ã€äº¤æ˜“è®°å½•ç­‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨åˆ†åŒºæ¥è½»æ¾å½’æ¡£æ—§æ•°æ®æˆ–åˆ é™¤ä¸å†éœ€è¦çš„æ•°æ®ã€‚é€šè¿‡ç®€å•åœ°åˆ é™¤æˆ–å½’æ¡£æŸä¸ªåˆ†åŒºï¼Œå¯ä»¥å¿«é€Ÿé‡Šæ”¾å­˜å‚¨ç©ºé—´å¹¶æé«˜æ€§èƒ½ã€‚</li><li><strong>å¯æ‰©å±•æ€§</strong>ï¼šåˆ†åŒºæŠ€æœ¯ä½¿å¾—æ•°æ®åº“è¡¨æ›´å®¹æ˜“æ‰©å±•åˆ°æ›´å¤§çš„æ•°æ®é›†ã€‚å½“è¡¨çš„å¤§å°è¶…è¿‡å•ä¸ªå­˜å‚¨è®¾å¤‡çš„å®¹é‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åˆ†åŒºå°†æ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªå­˜å‚¨è®¾å¤‡ä¸Šï¼Œä»è€Œå®ç°æ°´å¹³æ‰©å±•ã€‚</li></ol><h2 id="4ã€å¦‚ä½•å®æ–½åˆ†åŒº"><a href="#4ã€å¦‚ä½•å®æ–½åˆ†åŒº" class="headerlink" title="4ã€å¦‚ä½•å®æ–½åˆ†åŒº"></a>4ã€å¦‚ä½•å®æ–½åˆ†åŒº</h2><p>å®æ–½MySQLåˆ†åŒºéœ€è¦ä»”ç»†è§„åˆ’å’Œè®¾è®¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®çš„æ­¥éª¤ï¼š</p><ol><li><p><strong>ç¡®å®šåˆ†åŒºé”®</strong>ï¼šé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„åˆ—ä½œä¸ºåˆ†åŒºé”®ï¼Œè¯¥åˆ—çš„å€¼å°†ç”¨äºå°†æ•°æ®åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºä¸­ã€‚é€šå¸¸é€‰æ‹©å…·æœ‰è¿ç»­å€¼æˆ–ç¦»æ•£å€¼çš„åˆ—ä½œä¸ºåˆ†åŒºé”®ã€‚</p></li><li><p><strong>é€‰æ‹©åˆé€‚çš„åˆ†åŒºç±»å‹</strong>ï¼šæ ¹æ®æ•°æ®çš„ç‰¹ç‚¹å’ŒæŸ¥è¯¢éœ€æ±‚é€‰æ‹©åˆé€‚çš„åˆ†åŒºç±»å‹ï¼ˆRANGEã€LISTã€HASHæˆ–KEYï¼‰ã€‚ç¡®ä¿æ‰€é€‰çš„åˆ†åŒºç±»å‹èƒ½å¤Ÿå‡åŒ€åœ°åˆ†å¸ƒæ•°æ®å¹¶æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</p></li><li><p><strong>åˆ›å»ºåˆ†åŒºè¡¨</strong>ï¼šä½¿ç”¨<code>CREATE TABLE</code>è¯­å¥åˆ›å»ºåˆ†åŒºè¡¨ï¼Œå¹¶æŒ‡å®šåˆ†åŒºé”®å’Œåˆ†åŒºç±»å‹ç­‰å‚æ•°ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨RANGEåˆ†åŒºç±»å‹åˆ›å»ºä¸€ä¸ªæŒ‰æœˆåˆ†åŒºçš„é”€å”®æ•°æ®è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sales (<br>    sale_id <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    sale_date <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    ...<br>) <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (<span class="hljs-keyword">YEAR</span>(sale_date)) (<br>    <span class="hljs-keyword">PARTITION</span> p0 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-number">2022</span>),<br>    <span class="hljs-keyword">PARTITION</span> p1 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-number">2023</span>),<br>    <span class="hljs-keyword">PARTITION</span> p2 <span class="hljs-keyword">VALUES</span> LESS THAN MAXVALUE<br>);<br></code></pre></td></tr></table></figure></li></ol><p>4.<strong>æŸ¥è¯¢å’Œç»´æŠ¤</strong>ï¼šä¸€æ—¦åˆ›å»ºäº†åˆ†åŒºè¡¨ï¼Œå°±å¯ä»¥åƒæ™®é€šè¡¨ä¸€æ ·æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚MySQLä¼šè‡ªåŠ¨å®šä½åˆ°ç›¸åº”çš„åˆ†åŒºä¸Šæ‰§è¡ŒæŸ¥è¯¢ã€‚åŒæ—¶ï¼Œå¯ä»¥ç‹¬ç«‹åœ°å¤‡ä»½ã€æ¢å¤æˆ–ä¼˜åŒ–æ¯ä¸ªåˆ†åŒºã€‚</p><p>5.<strong>ç›‘æ§å’Œè°ƒæ•´</strong>ï¼šå®šæœŸç›‘æ§åˆ†åŒºçš„æ€§èƒ½å’Œå­˜å‚¨ä½¿ç”¨æƒ…å†µï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ æ–°çš„åˆ†åŒºæ¥å®¹çº³æ–°æ•°æ®ï¼Œæˆ–è€…åˆ é™¤æ—§çš„åˆ†åŒºä»¥é‡Šæ”¾å­˜å‚¨ç©ºé—´ã€‚</p><h2 id="5ã€åˆ†åŒºè¡¨çš„æ“ä½œ"><a href="#5ã€åˆ†åŒºè¡¨çš„æ“ä½œ" class="headerlink" title="5ã€åˆ†åŒºè¡¨çš„æ“ä½œ"></a>5ã€åˆ†åŒºè¡¨çš„æ“ä½œ</h2><p>åŒ…æ‹¬åˆ›å»ºåˆ†åŒºè¡¨ã€ä¿®æ”¹åˆ†åŒºå’Œåˆ é™¤ã€åˆå¹¶ã€æ‹†åˆ†ç­‰ã€‚</p><h3 id="5-1-åˆ›å»ºå¸¦æœ‰åˆ†åŒºçš„è¡¨"><a href="#5-1-åˆ›å»ºå¸¦æœ‰åˆ†åŒºçš„è¡¨" class="headerlink" title="5.1. åˆ›å»ºå¸¦æœ‰åˆ†åŒºçš„è¡¨"></a>5.1. åˆ›å»ºå¸¦æœ‰åˆ†åŒºçš„è¡¨</h3><h4 id="RANGE-åˆ†åŒº"><a href="#RANGE-åˆ†åŒº" class="headerlink" title="RANGE åˆ†åŒº"></a><strong>RANGE åˆ†åŒº</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- åˆ›å»ºè®¢å•è¡¨ï¼ŒæŒ‰å¹´åˆ†åŒº</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    order_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    order_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    status TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-keyword">PRIMARY</span> KEY (id, order_time),<br>    KEY idx_user_id (user_id),<br>    KEY idx_order_time (order_time)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB<br><span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (<span class="hljs-keyword">YEAR</span>(order_time)) (<br>    <span class="hljs-keyword">PARTITION</span> p_2020 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-number">2021</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_2021 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-number">2022</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_2022 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-number">2023</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_2023 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-number">2024</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_max <span class="hljs-keyword">VALUES</span> LESS THAN MAXVALUE<br>);<br></code></pre></td></tr></table></figure><h4 id="LIST-åˆ†åŒº"><a href="#LIST-åˆ†åŒº" class="headerlink" title="LIST åˆ†åŒº"></a><strong>LIST åˆ†åŒº</strong></h4><p>5.7ç‰ˆæœ¬åˆ†åŒºåˆ—å¿…é¡»æ˜¯intç±»å‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> products (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    category_id <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;1:ç”µå­äº§å“, 2:å®¶å±…ç”¨å“, 3:æœè£…, 4:é£Ÿå“&#x27;</span>,<br>    price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    stock <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    <span class="hljs-keyword">PRIMARY</span> KEY (id, category_id)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB<br><span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> LIST (category_id) (<br>    <span class="hljs-keyword">PARTITION</span> p_electronics <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">IN</span> (<span class="hljs-number">1</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_home <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">IN</span> (<span class="hljs-number">2</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_clothing <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">IN</span> (<span class="hljs-number">3</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_food <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">IN</span> (<span class="hljs-number">4</span>)<br>);<br><br><span class="hljs-comment">-- æ’å…¥å•†å“æ•°æ®</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> products (name, category_id, price, stock) <span class="hljs-keyword">VALUES</span><br>(<span class="hljs-string">&#x27;æ™ºèƒ½æ‰‹æœº&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2999.00</span>, <span class="hljs-number">100</span>),<br>(<span class="hljs-string">&#x27;ç¬”è®°æœ¬ç”µè„‘&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5999.00</span>, <span class="hljs-number">50</span>),<br>(<span class="hljs-string">&#x27;æ²™å‘&#x27;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1999.00</span>, <span class="hljs-number">30</span>),<br>(<span class="hljs-string">&#x27;Tæ¤&#x27;</span>, <span class="hljs-number">3</span>, <span class="hljs-number">99.00</span>, <span class="hljs-number">200</span>),<br>(<span class="hljs-string">&#x27;å·§å…‹åŠ›&#x27;</span>, <span class="hljs-number">4</span>, <span class="hljs-number">39.00</span>, <span class="hljs-number">150</span>);<br></code></pre></td></tr></table></figure><h4 id="HASH-åˆ†åŒº"><a href="#HASH-åˆ†åŒº" class="headerlink" title="HASH åˆ†åŒº"></a><strong>HASH åˆ†åŒº</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- åˆ›å»ºå•†å“è¯„è®ºè¡¨ï¼ŒæŒ‰ç”¨æˆ·IDå“ˆå¸Œåˆ†åŒº</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> product_comments (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    product_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    content TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    rating TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    create_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-keyword">PRIMARY</span> KEY (id, user_id),<br>    KEY idx_product_id (product_id),<br>    KEY idx_create_time (create_time)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB<br><span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> HASH(user_id)<br>PARTITIONS <span class="hljs-number">8</span>;<br></code></pre></td></tr></table></figure><h4 id="KEY-åˆ†åŒº"><a href="#KEY-åˆ†åŒº" class="headerlink" title="KEY åˆ†åŒº"></a>KEY åˆ†åŒº</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> device_metrics (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    device_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    metric_type <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    metric_value <span class="hljs-keyword">DOUBLE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    recorded_at DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-keyword">PRIMARY</span> KEY (id, device_id)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB<br><span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> KEY(device_id)<br>PARTITIONS <span class="hljs-number">5</span>;<br><br><span class="hljs-comment">-- è¿™äº›è®°å½•ä¼šæ ¹æ®device_idçš„KEYå“ˆå¸Œåˆ†é…åˆ°ä¸åŒåˆ†åŒº</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> device_metrics (device_id, metric_type, metric_value, recorded_at)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;DVC-1001-A23&#x27;</span>, <span class="hljs-string">&#x27;temperature&#x27;</span>, <span class="hljs-number">23.5</span>, <span class="hljs-string">&#x27;2023-05-10 08:30:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> device_metrics (device_id, metric_type, metric_value, recorded_at)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;DVC-1002-B45&#x27;</span>, <span class="hljs-string">&#x27;humidity&#x27;</span>, <span class="hljs-number">65.2</span>, <span class="hljs-string">&#x27;2023-05-10 08:31:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> device_metrics (device_id, metric_type, metric_value, recorded_at)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;DVC-1003-C67&#x27;</span>, <span class="hljs-string">&#x27;pressure&#x27;</span>, <span class="hljs-number">1013.2</span>, <span class="hljs-string">&#x27;2023-05-10 08:32:00&#x27;</span>);<br></code></pre></td></tr></table></figure><h4 id="å¤åˆåˆ†åŒºç¤ºä¾‹-RANGE-HASH"><a href="#å¤åˆåˆ†åŒºç¤ºä¾‹-RANGE-HASH" class="headerlink" title="å¤åˆåˆ†åŒºç¤ºä¾‹(RANGE + HASH)"></a>å¤åˆåˆ†åŒºç¤ºä¾‹(RANGE + HASH)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> order_details (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    order_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    product_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    quantity <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    order_date <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-keyword">PRIMARY</span> KEY (id, order_date, order_id)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB<br><span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (<span class="hljs-keyword">YEAR</span>(order_date))<br>SUBPARTITION <span class="hljs-keyword">BY</span> HASH(order_id)<br>SUBPARTITIONS <span class="hljs-number">4</span> (<br>    <span class="hljs-keyword">PARTITION</span> p_2020 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-number">2021</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_2021 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-number">2022</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_2022 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-number">2023</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_2023 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-number">2024</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_future <span class="hljs-keyword">VALUES</span> LESS THAN MAXVALUE<br>);<br><br><span class="hljs-comment">-- 2021å¹´è®¢å•(è¿›å…¥p_2021åˆ†åŒºï¼Œç„¶åæ ¹æ®order_idå“ˆå¸Œåˆ°å­åˆ†åŒº)</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> order_details (order_id, product_id, quantity, price, order_date)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10001</span>, <span class="hljs-number">501</span>, <span class="hljs-number">2</span>, <span class="hljs-number">199.99</span>, <span class="hljs-string">&#x27;2021-03-15&#x27;</span>);<br><br><span class="hljs-comment">-- 2022å¹´è®¢å•(è¿›å…¥p_2022åˆ†åŒºï¼Œç„¶åæ ¹æ®order_idå“ˆå¸Œåˆ°å­åˆ†åŒº)</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> order_details (order_id, product_id, quantity, price, order_date)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10002</span>, <span class="hljs-number">502</span>, <span class="hljs-number">1</span>, <span class="hljs-number">89.50</span>, <span class="hljs-string">&#x27;2022-07-22&#x27;</span>);<br><br><span class="hljs-comment">-- 2023å¹´è®¢å•(è¿›å…¥p_2023åˆ†åŒºï¼Œç„¶åæ ¹æ®order_idå“ˆå¸Œåˆ°å­åˆ†åŒº)</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> order_details (order_id, product_id, quantity, price, order_date)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10003</span>, <span class="hljs-number">503</span>, <span class="hljs-number">3</span>, <span class="hljs-number">45.00</span>, <span class="hljs-string">&#x27;2023-01-10&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="5-2ã€åˆ†åŒºç®¡ç†æ“ä½œ"><a href="#5-2ã€åˆ†åŒºç®¡ç†æ“ä½œ" class="headerlink" title="5.2ã€åˆ†åŒºç®¡ç†æ“ä½œ"></a>5.2ã€åˆ†åŒºç®¡ç†æ“ä½œ</h3><p>æŸ¥çœ‹åˆ†åŒºæ•°æ®åˆ†å¸ƒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> partition_name, table_rows <br><span class="hljs-keyword">FROM</span> information_schema.partitions <br><span class="hljs-keyword">WHERE</span> table_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;log_records&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æ·»åŠ æ–°åˆ†åŒº(RANGE)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> log_records REORGANIZE <span class="hljs-keyword">PARTITION</span> p_future <span class="hljs-keyword">INTO</span> (<br>    <span class="hljs-keyword">PARTITION</span> p_202305 <span class="hljs-keyword">VALUES</span> LESS THAN (TO_DAYS(<span class="hljs-string">&#x27;2023-06-01&#x27;</span>)),<br>    <span class="hljs-keyword">PARTITION</span> p_future <span class="hljs-keyword">VALUES</span> LESS THAN MAXVALUE<br>);<br></code></pre></td></tr></table></figure><p>åˆå¹¶åˆ†åŒº(LIST)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> sales REORGANIZE <span class="hljs-keyword">PARTITION</span> p_north, p_east <span class="hljs-keyword">INTO</span> (<br>    <span class="hljs-keyword">PARTITION</span> p_north_east <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;BJ&#x27;</span>, <span class="hljs-string">&#x27;TJ&#x27;</span>, <span class="hljs-string">&#x27;HEB&#x27;</span>, <span class="hljs-string">&#x27;SH&#x27;</span>, <span class="hljs-string">&#x27;JS&#x27;</span>, <span class="hljs-string">&#x27;ZJ&#x27;</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_south <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;GD&#x27;</span>, <span class="hljs-string">&#x27;GX&#x27;</span>, <span class="hljs-string">&#x27;FJ&#x27;</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_west <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;SC&#x27;</span>, <span class="hljs-string">&#x27;CQ&#x27;</span>, <span class="hljs-string">&#x27;YN&#x27;</span>),<br>    <span class="hljs-keyword">PARTITION</span> p_other <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">DEFAULT</span>)<br>);<br></code></pre></td></tr></table></figure><h3 id="5-3-ä¼˜åŒ–åˆ†åŒº"><a href="#5-3-ä¼˜åŒ–åˆ†åŒº" class="headerlink" title="5.3 ä¼˜åŒ–åˆ†åŒº"></a><strong>5.3 ä¼˜åŒ–åˆ†åŒº</strong></h3><p>å½“ä»åˆ†åŒºä¸­åˆ é™¤äº†å¤§é‡æ•°æ®ï¼Œæˆ–è€…å¯¹åŒ…å«å¯å˜é•¿åº¦å­—æ®µï¼ˆå¦‚VARCHARæˆ–TEXTç±»å‹åˆ—ï¼‰çš„åˆ†åŒºè¿›è¡Œäº†å¤šæ¬¡ä¿®æ”¹åï¼Œä¼˜åŒ–åˆ†åŒºå¯ä»¥å›æ”¶æœªä½¿ç”¨çš„ç©ºé—´å¹¶æ•´ç†æ•°æ®ç¢ç‰‡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tbl_name OPTIMIZE <span class="hljs-keyword">PARTITION</span> partition_name_list;<br><br>å®ä¾‹<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tbl_users OPTIMIZE <span class="hljs-keyword">PARTITION</span> p2, p3;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œæ­¤æ“ä½œåï¼Œ<code>p2</code>å’Œ<code>p3</code>åˆ†åŒºå°†ä¼šæ›´åŠ ç´§å‡‘ï¼Œæœªä½¿ç”¨çš„ç©ºé—´å°†è¢«å›æ”¶ã€‚</p><blockquote><p><a href="https://cloud.tencent.com/developer/article/2420277">å‚è€ƒå­¦ä¹ é“¾æ¥</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlä¸»ä»å¤åˆ¶å®è·µ</title>
    <link href="/2025/04/13/go/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%AE%9E%E8%B7%B5/"/>
    <url>/2025/04/13/go/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<h1 id="mysqlä¸»ä»å¤åˆ¶å®è·µ"><a href="#mysqlä¸»ä»å¤åˆ¶å®è·µ" class="headerlink" title="mysqlä¸»ä»å¤åˆ¶å®è·µ"></a>mysqlä¸»ä»å¤åˆ¶å®è·µ</h1><h2 id="1ã€éƒ¨ç½²ä¸»ä»ä¸¤ä¸ªmysqlèŠ‚ç‚¹"><a href="#1ã€éƒ¨ç½²ä¸»ä»ä¸¤ä¸ªmysqlèŠ‚ç‚¹" class="headerlink" title="1ã€éƒ¨ç½²ä¸»ä»ä¸¤ä¸ªmysqlèŠ‚ç‚¹"></a>1ã€éƒ¨ç½²ä¸»ä»ä¸¤ä¸ªmysqlèŠ‚ç‚¹</h2><p>æœ¬æ¬¡ä½¿ç”¨docker-compose.yml è¿›è¡Œéƒ¨ç½²</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">mysql1:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">admin</span><br>      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">Demo</span><br>      <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">admin</span><br>      <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">admin</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">33307</span><span class="hljs-string">:3306</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql_data1:/var/lib/mysql</span><br>      <span class="hljs-comment"># - ./master/config/my.cnf:/etc/my.cnf</span><br>  <span class="hljs-attr">mysql2:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">admin</span><br>      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">Demo</span><br>      <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">admin</span><br>      <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">admin</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">33308</span><span class="hljs-string">:3306</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql_data2:/var/lib/mysql</span><br>      <span class="hljs-comment"># - ./slaver/config/my.cnf:/etc/my.cnf</span><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">mysql_data1:</span><br>  <span class="hljs-attr">mysql_data2:</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨docker-composeå¯åŠ¨mysqlä¸»ä»å®¹å™¨ï¼Œç„¶åä½¿ç”¨å‘½ä»¤ä»å®¹å™¨å†…éƒ¨å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°ä¸»æœºé‡Œé¢ï¼Œå°†æ³¨é‡Šå»æ‰é‡å¯å®¹å™¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker-compose <span class="hljs-built_in">cp</span> mysql1:/etc/my.cnf ./master/config/my.cnf<span class="hljs-comment"># ä¸»èŠ‚ç‚¹é…ç½®æ–‡ä»¶copy</span><br>docker-compose <span class="hljs-built_in">cp</span> mysql2:/etc/my.cnf ./slaver/config/my.cnf<span class="hljs-comment"># ä»èŠ‚ç‚¹é…ç½®æ–‡ä»¶æ‹·è´</span><br></code></pre></td></tr></table></figure><h2 id="2ã€ä¿®æ”¹ä¸»ä»å¤åˆ¶é…ç½®æ–‡ä»¶"><a href="#2ã€ä¿®æ”¹ä¸»ä»å¤åˆ¶é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€ä¿®æ”¹ä¸»ä»å¤åˆ¶é…ç½®æ–‡ä»¶"></a>2ã€ä¿®æ”¹ä¸»ä»å¤åˆ¶é…ç½®æ–‡ä»¶</h2><p>ä¸»æ–‡ä»¶ä¿®æ”¹ï¼šç›´æ¥è¦†ç›–æ–‡ä»¶</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs txt">vim my.cnf<br><br>[mysqld]#ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼švim /etc/my.cnf<br>[mysqld]<br># ä¸»åº“å”¯ä¸€ IDï¼ˆä»åº“éœ€è®¾ä¸ºä¸åŒå€¼ï¼Œå¦‚ 2ï¼‰<br>server-id=1<br># å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—<br>log-bin=mysql-bin<br># äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ï¼ˆROW æ¨¡å¼æ›´é€‚åˆä¸»ä»å¤åˆ¶ï¼‰<br>binlog-format=ROW<br># ä¸è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—çš„æ•°æ®åº“ï¼ˆæŒ‰éœ€é…ç½®ï¼‰<br># binlog-ignore-db=mysql<br># å…è®¸ä»åº“è¿æ¥çš„ IP èŒƒå›´ï¼ˆ% è¡¨ç¤ºæ‰€æœ‰ï¼‰<br>bind-address=0.0.0.0<br># å­—ç¬¦é›†<br>character-set-server=utf8mb4<br># è·³è¿‡ DNS è§£æï¼ˆæé«˜è¿æ¥é€Ÿåº¦ï¼‰<br>skip-name-resolve<br><br></code></pre></td></tr></table></figure><p>ä»æ–‡ä»¶ä¿®æ”¹ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs txt">[mysqld]<br>#ä»æœåŠ¡å™¨å”¯ä¸€ID<br>server-id=2<br>#å¯ç”¨ä¸­ç»§æ—¥å¿—<br>relay-log=mysql-relay<br></code></pre></td></tr></table></figure><p>é‡å¯å®¹å™¨é…ç½®</p><h2 id="3ã€æ­å»ºä¸»ä»å¤åˆ¶"><a href="#3ã€æ­å»ºä¸»ä»å¤åˆ¶" class="headerlink" title="3ã€æ­å»ºä¸»ä»å¤åˆ¶"></a>3ã€æ­å»ºä¸»ä»å¤åˆ¶</h2><p>3.1ä¸»æœºè®¾ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose exec -it mysql1  /bin/bash# è¿›å…¥å®¹å™¨<br>mysql -uroot -padmin# ç™»é™†æ•°æ®åº“<br>æˆ–è€…<br>docker-compose exec -it mysql1 mysql -uroot -padmin<br></code></pre></td></tr></table></figure><p> 3.1 ä¸»æœºä¸Šå»ºç«‹å¸æˆ·å¹¶æˆæƒ slave</p><p>ç»™ä»æœºæˆæƒï¼Œä¸ºäº†è®©ä»æœºèƒ½å¤Ÿå’Œä¸»æœºè¿æ¥èµ·æ¥ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql&gt; GRANT REPLICATION SLAVE ON *.* TO <span class="hljs-string">&#x27;slave&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;123456&#x27;</span>;<br>Query OK, 0 rows affected, 1 warning (0.01 sec)<br><br></code></pre></td></tr></table></figure><p>3.3 æŸ¥è¯¢masterçŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">show master status; <span class="hljs-comment">#æŸ¥è¯¢masterçš„çŠ¶æ€</span><br><br>mysql&gt; show master status;<br>+------------------+----------+--------------+------------------+-------------------+<br>| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |<br>+------------------+----------+--------------+------------------+-------------------+<br>| mysql-bin.000001 |      154 |              |                  |                   |<br>+------------------+----------+--------------+------------------+-------------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>Binlog_Do_DBï¼šéœ€è¦å¤åˆ¶çš„æ•°æ®åº“ã€‚<br>Binlog_Ignore_DBï¼šä¸éœ€è¦å¤åˆ¶çš„æ•°æ®åº“ã€‚<br></code></pre></td></tr></table></figure><p>3.4 ä»æœºè®¾ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose <span class="hljs-built_in">exec</span> -it mysql2  /bin/bash<span class="hljs-comment"># è¿›å…¥å®¹å™¨</span><br>mysql -uroot -padmin<span class="hljs-comment"># ç™»é™†æ•°æ®åº“</span><br>æˆ–è€…<br>docker-compose <span class="hljs-built_in">exec</span> -it mysql2 mysql -uroot -padmin<br></code></pre></td></tr></table></figure><p>å¤åˆ¶ä¸»æœºçš„å‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">CHANGE MASTER TO MASTER_HOST=<span class="hljs-string">&#x27;mysql1&#x27;</span>,MASTER_USER=<span class="hljs-string">&#x27;slave&#x27;</span>,MASTER_PASSWORD=<span class="hljs-string">&#x27;123456&#x27;</span>,MASTER_PORT=3306, MASTER_LOG_FILE=<span class="hljs-string">&#x27;mysql-bin.000001&#x27;</span>,MASTER_LOG_POS=154;<br><span class="hljs-comment">#è§£é‡Šï¼š</span><br><span class="hljs-comment"># CHANGE MASTER TO MASTER_HOST=&#x27;172.16.0.3&#x27;,ä½¿ç”¨å®¹å™¨åç§°</span><br><span class="hljs-comment">#MASTER_USER=&#x27;slave&#x27;(åˆšåˆšé…ç½®çš„ç”¨æˆ·å),</span><br><span class="hljs-comment">#MASTER_PASSWORD=&#x27;123456&#x27;(åˆšåˆšæˆæƒçš„å¯†ç ),</span><br><span class="hljs-comment">#master_port=ä¸»æœºå¼€æ”¾çš„ç«¯å£ ä½¿ç”¨å®¹å™¨å†…éƒ¨ç½‘ç»œç«¯å£3306,</span><br><span class="hljs-comment">#MASTER_LOG_FILE=&#x27;mysql-bin.å…·ä½“æ•°å­—&#x27;,</span><br><span class="hljs-comment">#MASTER_LOG_POS=å…·ä½“å€¼(ä¹‹å‰çš„Position);</span><br><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql&gt; CHANGE MASTER TO MASTER_HOST=<span class="hljs-string">&#x27;mysql1&#x27;</span>,MASTER_USER=<span class="hljs-string">&#x27;slave&#x27;</span>,MASTER_PASSWORD=<span class="hljs-string">&#x27;123456&#x27;</span>,MASTER_PORT=3306, MASTER_LOG_FILE=<span class="hljs-string">&#x27;mysql-bin.000001&#x27;</span>,MASTER_LOG_POS=154;<br>Query OK, 0 rows affected, 2 warnings (0.03 sec)<br></code></pre></td></tr></table></figure><p>&#x3D;&#x3D;æ³¨æ„äº‹é¡¹ï¼š&#x3D;&#x3D;è¿™é‡Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œå…ˆé‡ç½®ã€‚æ‰§è¡Œå®Œä¸‹é¢ä¸¤æ¡å‘½ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">stop slave;<br>reset master;<br></code></pre></td></tr></table></figure><p><strong>å¯åŠ¨ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql&gt; start slave;<br>Query OK, 0 rows affected (0.05 sec)<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ä»æœåŠ¡å™¨çŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs sh">show slave status\G;<br><br>*************************** 1. row ***************************<br>               Slave_IO_State: Waiting <span class="hljs-keyword">for</span> master to send event<br>                  Master_Host: mysql1<br>                  Master_User: slave<br>                  Master_Port: 3306<br>                Connect_Retry: 60<br>              Master_Log_File: mysql-bin.000001<br>          Read_Master_Log_Pos: 154<br>               Relay_Log_File: mysql-relay.000002<br>                Relay_Log_Pos: 320<br>        Relay_Master_Log_File: mysql-bin.000001<br>             Slave_IO_Running: Yes<br>            Slave_SQL_Running: Yes<br>              Replicate_Do_DB: <br>          Replicate_Ignore_DB: <br>           Replicate_Do_Table: <br>       Replicate_Ignore_Table: <br>      Replicate_Wild_Do_Table: <br>  Replicate_Wild_Ignore_Table: <br>                   Last_Errno: 0<br>                   Last_Error: <br>                 Skip_Counter: 0<br>          Exec_Master_Log_Pos: 154<br>              Relay_Log_Space: 523<br>              Until_Condition: None<br>               Until_Log_File: <br>                Until_Log_Pos: 0<br>           Master_SSL_Allowed: No<br>           Master_SSL_CA_File: <br>           Master_SSL_CA_Path: <br>              Master_SSL_Cert: <br>            Master_SSL_Cipher: <br>               Master_SSL_Key: <br>        Seconds_Behind_Master: 0<br>Master_SSL_Verify_Server_Cert: No<br>                Last_IO_Errno: 0<br>                Last_IO_Error: <br>               Last_SQL_Errno: 0<br>               Last_SQL_Error: <br>  Replicate_Ignore_Server_Ids: <br>             Master_Server_Id: 1<br>                  Master_UUID: 6b47696b-17ad-11f0-8b0f-0242ac160002<br>             Master_Info_File: /var/lib/mysql/master.info<br>                    SQL_Delay: 0<br>          SQL_Remaining_Delay: NULL<br>      Slave_SQL_Running_State: Slave has <span class="hljs-built_in">read</span> all relay <span class="hljs-built_in">log</span>; waiting <span class="hljs-keyword">for</span> more updates<br>           Master_Retry_Count: 86400<br>                  Master_Bind: <br>      Last_IO_Error_Timestamp: <br>     Last_SQL_Error_Timestamp: <br>               Master_SSL_Crl: <br>           Master_SSL_Crlpath: <br>           Retrieved_Gtid_Set: <br>            Executed_Gtid_Set: <br>                Auto_Position: 0<br>         Replicate_Rewrite_DB: <br>                 Channel_Name: <br>           Master_TLS_Version: <br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>ERROR: <br>No query specified<br><br></code></pre></td></tr></table></figure><p>ä¸‹é¢ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Yesï¼Œåˆ™è¯´æ˜ä¸»ä»é…ç½®æˆåŠŸï¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Slave_IO_Running:</span> <span class="hljs-literal">Yes</span> <br><span class="hljs-attr">Slave_SQL_Running:</span> <span class="hljs-literal">Yes</span><br></code></pre></td></tr></table></figure><h2 id="4ã€æµ‹è¯•ä¸»ä»å¤åˆ¶"><a href="#4ã€æµ‹è¯•ä¸»ä»å¤åˆ¶" class="headerlink" title="4ã€æµ‹è¯•ä¸»ä»å¤åˆ¶"></a>4ã€æµ‹è¯•ä¸»ä»å¤åˆ¶</h2><p>è¿ä¸Š ä¸»æ•°æ®åº“ï¼Œæœ¬åœ°è¿æ¥é…ç½®ï¼Œçœ‹docker-compose.ymlæ–‡ä»¶ä¸­çš„mysql1</p><p>è¿ä¸Š ä»æ•°æ®åº“ï¼Œæœ¬åœ°è¿æ¥é…ç½®ï¼Œçœ‹docker-compose.ymlæ–‡ä»¶ä¸­çš„mysql2</p><p>åœ¨ä¸»æ•°æ®åº“ä¸­æ‰§è¡Œå‘½ä»¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE test;<br>USE test;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT, name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>));<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users (name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;Alice&#x27;</span>), (<span class="hljs-string">&#x27;Bob&#x27;</span>);<br></code></pre></td></tr></table></figure><p>å‘ç°ä»æ•°æ®åº“ä¹Ÿå¢åŠ äº†å¯¹åº”çš„åº“è¡¨ã€‚</p><h2 id="5ã€é‡ç½®é…ç½®ä¸»ä»"><a href="#5ã€é‡ç½®é…ç½®ä¸»ä»" class="headerlink" title="5ã€é‡ç½®é…ç½®ä¸»ä»"></a>5ã€é‡ç½®é…ç½®ä¸»ä»</h2><p>å¦‚ä½•åœæ­¢ä»æœåŠ¡é…ç½®åŠŸèƒ½</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">stop slave; <br></code></pre></td></tr></table></figure><p>å¦‚ä½•é‡æ–°é…ç½®ä¸»ä» ï¼ˆå³æ¸…é™¤ä¹‹å‰çš„ä¸»ä»é…ç½®ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">stop slave;<br>reset master;<br></code></pre></td></tr></table></figure><h2 id="6ã€golang-ç®€å•ä½¿ç”¨"><a href="#6ã€golang-ç®€å•ä½¿ç”¨" class="headerlink" title="6ã€golang ç®€å•ä½¿ç”¨"></a>6ã€golang ç®€å•ä½¿ç”¨</h2><p>ä¸‹è½½ä¾èµ–</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">go get <span class="hljs-string">&quot;gorm.io/driver/mysql&quot;</span><br>go get <span class="hljs-string">&quot;gorm.io/gorm&quot;</span><br>go get <span class="hljs-string">&quot;gorm.io/plugin/dbresolver&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br><span class="hljs-string">&quot;gorm.io/driver/mysql&quot;</span><br><span class="hljs-string">&quot;gorm.io/gorm&quot;</span><br><span class="hljs-string">&quot;gorm.io/plugin/dbresolver&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> DBConfig <span class="hljs-keyword">struct</span> &#123;<br>MasterDSN <span class="hljs-type">string</span><br>SlaveDSNs []<span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Users <span class="hljs-keyword">struct</span> &#123;<br>ID        <span class="hljs-type">uint</span><br>Name      <span class="hljs-type">string</span><br>Email     <span class="hljs-type">string</span><br>CreatedAt time.Time<br>&#125;<br><br><span class="hljs-comment">// TableName æ–¹æ³•ä¸º Users ç»“æ„ä½“æŒ‡å®šè¡¨åˆ«å</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(Users)</span></span> TableName() <span class="hljs-type">string</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user&quot;</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>dbConfig := DBConfig&#123;<br>MasterDSN: <span class="hljs-string">&quot;root:admin@tcp(127.0.0.1:33307)/test?parseTime=true&quot;</span>,<br>SlaveDSNs: []<span class="hljs-type">string</span>&#123;<br><span class="hljs-string">&quot;root:admin@tcp(127.0.0.1:33308)/test?parseTime=true&quot;</span>,<br>&#125;,<br>&#125;<br><br><span class="hljs-comment">// åˆå§‹åŒ–æ•°æ®åº“è¿æ¥</span><br>db, err := gorm.Open(mysql.Open(dbConfig.MasterDSN), &amp;gorm.Config&#123;&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;failed to connect database&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// é…ç½®è¯»å†™åˆ†ç¦»</span><br>err = db.Use(dbresolver.Register(dbresolver.Config&#123;<br>Sources: []gorm.Dialector&#123;mysql.Open(dbConfig.MasterDSN)&#125;, <span class="hljs-comment">// å†™æ“ä½œæº</span><br>Replicas: []gorm.Dialector&#123; <span class="hljs-comment">// è¯»æ“ä½œæº</span><br>mysql.Open(dbConfig.SlaveDSNs[<span class="hljs-number">0</span>]),<br>&#125;,<br>Policy: dbresolver.RandomPolicy&#123;&#125;, <span class="hljs-comment">// ä½¿ç”¨éšæœºé€‰æ‹©ä»åº“</span><br>&#125;))<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;failed to setup db resolver&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// é…ç½®è¿æ¥æ± </span><br>sqlDB, err := db.DB()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br>sqlDB.SetMaxIdleConns(<span class="hljs-number">10</span>)<br>sqlDB.SetMaxOpenConns(<span class="hljs-number">100</span>)<br>sqlDB.SetConnMaxLifetime(time.Hour)<br><br><span class="hljs-comment">/*// è‡ªåŠ¨è¿ç§»è¡¨ç»“æ„</span><br><span class="hljs-comment">db.AutoMigrate(&amp;Users&#123;&#125;)*/</span><br><br><span class="hljs-comment">//testCS(db)</span><br><span class="hljs-comment">//readFromMasterV2(db)</span><br><span class="hljs-comment">//transactionDemo(db)</span><br><br><span class="hljs-comment">// äº‹åŠ¡å¤–æ··åˆæ“ä½œ</span><br>db.Transaction(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *gorm.DB)</span></span> <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">// è‡ªåŠ¨ä½¿ç”¨ä¸»åº“</span><br><span class="hljs-keyword">var</span> u Users<br>tx.First(&amp;u, <span class="hljs-number">1</span>) <span class="hljs-comment">// è‡ªåŠ¨ä¸»åº“</span><br>log.Println(u)<br><br><span class="hljs-keyword">if</span> err := tx.Create(&amp;Users&#123;Name: <span class="hljs-string">&quot;Bob&quot;</span>&#125;).Error; err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><br>db.Clauses(dbresolver.Read).First(&amp;u, <span class="hljs-number">1</span>) <span class="hljs-comment">// æ˜¾å¼æŒ‡å®šï¼ˆéå¿…é¡»ï¼‰ ä½¿ç”¨tx ä¼šè‡ªåŠ¨è¯»å–ä¸»åº“ dbåˆ™ä¼šæ ¹æ®éœ€æ±‚è¯»å–</span><br>log.Println(u)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testCS</span><span class="hljs-params">(db *gorm.DB)</span></span> &#123;<br><span class="hljs-comment">// å†™æ“ä½œç¤ºä¾‹ï¼ˆä½¿ç”¨ä¸»åº“ï¼‰</span><br>user := Users&#123;Name: <span class="hljs-string">&quot;John3&quot;</span>, Email: <span class="hljs-string">&quot;john3@example.com&quot;</span>&#125;<br>result := db.Create(&amp;user)<br><span class="hljs-keyword">if</span> result.Error != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(result.Error)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;Created user ID: %d\n&quot;</span>, user.ID)<br><br><span class="hljs-comment">// è¯»æ“ä½œç¤ºä¾‹ï¼ˆä½¿ç”¨ä»åº“ï¼‰</span><br><span class="hljs-keyword">var</span> readUser Users<br>db.First(&amp;readUser, user.ID)<br>fmt.Printf(<span class="hljs-string">&quot;Read user: %+v\n&quot;</span>, readUser)<br><br><span class="hljs-comment">// æ›´æ–°æ“ä½œç¤ºä¾‹ï¼ˆä½¿ç”¨ä¸»åº“ï¼‰</span><br>db.Model(&amp;user).Update(<span class="hljs-string">&quot;Email&quot;</span>, <span class="hljs-string">&quot;new@example.com&quot;</span>)<br><br><span class="hljs-comment">// æŸ¥è¯¢æ“ä½œç¤ºä¾‹ï¼ˆä½¿ç”¨ä»åº“ï¼‰</span><br><span class="hljs-keyword">var</span> updatedUser Users<br>db.First(&amp;updatedUser, <span class="hljs-number">1</span>)<br>fmt.Printf(<span class="hljs-string">&quot;Updated user: %+v\n&quot;</span>, updatedUser)<br>&#125;<br><br><span class="hljs-comment">// æ–¹å¼ 1ï¼šä½¿ç”¨ Clauses å¼ºåˆ¶èµ°ä¸»åº“</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">readFromMaster</span><span class="hljs-params">(db *gorm.DB)</span></span> &#123;<br><span class="hljs-keyword">var</span> user Users<br>db.Clauses(dbresolver.Write).First(&amp;user, <span class="hljs-number">1</span>)<br>fmt.Println(<span class="hljs-string">&quot;ä»ä¸»åˆ†æ”¯ï¼š&quot;</span>, user)<br>&#125;<br><br><span class="hljs-comment">// æ–¹å¼ 2ï¼šä½¿ç”¨ Session é…ç½®</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">readFromMasterV2</span><span class="hljs-params">(db *gorm.DB)</span></span> &#123;<br><span class="hljs-keyword">var</span> user Users<br>db.Session(&amp;gorm.Session&#123;QueryFields: <span class="hljs-literal">true</span>&#125;).Clauses(dbresolver.Write).First(&amp;user, <span class="hljs-number">1</span>)<br>fmt.Println(<span class="hljs-string">&quot;From master:&quot;</span>, user)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">transactionDemo</span><span class="hljs-params">(db *gorm.DB)</span></span> &#123;<br><span class="hljs-comment">// å¼€å§‹äº‹åŠ¡</span><br>tx := db.Begin()<br><span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">if</span> r := <span class="hljs-built_in">recover</span>(); r != <span class="hljs-literal">nil</span> &#123;<br>tx.Rollback()<br>&#125;<br>&#125;()<br><br><span class="hljs-comment">// äº‹åŠ¡å†…æ“ä½œï¼ˆè‡ªåŠ¨ä½¿ç”¨ä¸»åº“ï¼‰</span><br><span class="hljs-comment">// åˆ›å»ºç”¨æˆ·</span><br>newUser := Users&#123;Name: <span class="hljs-string">&quot;Alice&quot;</span>, Email: <span class="hljs-string">&quot;alice@example.com&quot;</span>&#125;<br><span class="hljs-keyword">if</span> err := tx.Create(&amp;newUser).Error; err != <span class="hljs-literal">nil</span> &#123;<br>tx.Rollback()<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-comment">// äº‹åŠ¡å†…æŸ¥è¯¢ï¼ˆè‡ªåŠ¨ä½¿ç”¨ä¸»åº“ï¼‰</span><br><span class="hljs-keyword">var</span> latestUser Users<br><span class="hljs-keyword">if</span> err := tx.Last(&amp;latestUser).Error; err != <span class="hljs-literal">nil</span> &#123;<br>tx.Rollback()<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-comment">// æ›´æ–°æ“ä½œ</span><br><span class="hljs-keyword">if</span> err := tx.Model(&amp;latestUser).Update(<span class="hljs-string">&quot;email&quot;</span>, <span class="hljs-string">&quot;new_alice@example.com&quot;</span>).Error; err != <span class="hljs-literal">nil</span> &#123;<br>tx.Rollback()<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-comment">// æäº¤äº‹åŠ¡</span><br><span class="hljs-keyword">if</span> err := tx.Commit().Error; err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;commit failed: &quot;</span> + err.Error())<br>&#125;<br>log.Println(<span class="hljs-string">&quot;äº‹åŠ¡æ“ä½œæˆåŠŸ&quot;</span>)<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯ç®€å•çš„è¯»å†™åˆ†ç¦»æ“ä½œäº†ï¼Œäº‹åŠ¡é‡Œé¢çš„æ“ä½œé»˜è®¤æ˜¯èµ°çš„ä¸»åº“ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š</p>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»£ç è®¾è®¡æ¨¡å¼</title>
    <link href="/2025/04/11/go/golang%20%E4%BB%A3%E7%A0%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <url>/2025/04/11/go/golang%20%E4%BB%A3%E7%A0%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="golang-è®¾è®¡æ¨¡å¼"><a href="#golang-è®¾è®¡æ¨¡å¼" class="headerlink" title="golang è®¾è®¡æ¨¡å¼"></a>golang è®¾è®¡æ¨¡å¼</h1><h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå¯¹è±¡çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»ï¼ŒæŠŠå¯¹è±¡åˆ›å»ºé€»è¾‘å°è£…åœ¨ä¸€ä¸ªå·¥å‚ç±»æˆ–å·¥å‚å‡½æ•°ä¸­ï¼Œè¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p><h3 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h3><ul><li><strong>ç®€å•å·¥å‚æ¨¡å¼</strong>ï¼šä¸€ä¸ªå·¥å‚ç±»è´Ÿè´£åˆ›å»ºæ‰€æœ‰ç±»å‹çš„å¯¹è±¡ã€‚</li><li><strong>å·¥å‚æ–¹æ³•æ¨¡å¼</strong>ï¼šå®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚</li><li><strong>æŠ½è±¡å·¥å‚æ¨¡å¼</strong>ï¼šæä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚</li></ul><p><strong>Go è¯­è¨€å®ç°ç®€å•å·¥å‚æ¨¡å¼ç¤ºä¾‹</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-comment">// Product å®šä¹‰äº§å“æ¥å£</span><br><span class="hljs-keyword">type</span> Product <span class="hljs-keyword">interface</span> &#123;<br>    Use()<br>&#125;<br><br><span class="hljs-comment">// ConcreteProductA å…·ä½“äº§å“A</span><br><span class="hljs-keyword">type</span> ConcreteProductA <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *ConcreteProductA)</span></span> Use() &#123;<br>    fmt.Println(<span class="hljs-string">&quot;Using ConcreteProductA&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// ConcreteProductB å…·ä½“äº§å“B</span><br><span class="hljs-keyword">type</span> ConcreteProductB <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *ConcreteProductB)</span></span> Use() &#123;<br>    fmt.Println(<span class="hljs-string">&quot;Using ConcreteProductB&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// Factory ç®€å•å·¥å‚</span><br><span class="hljs-keyword">type</span> Factory <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-comment">// CreateProduct æ ¹æ®ç±»å‹åˆ›å»ºäº§å“</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *Factory)</span></span> CreateProduct(productType <span class="hljs-type">string</span>) Product &#123;<br>    <span class="hljs-keyword">switch</span> productType &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;A&quot;</span>:<br>        <span class="hljs-keyword">return</span> &amp;ConcreteProductA&#123;&#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;B&quot;</span>:<br>        <span class="hljs-keyword">return</span> &amp;ConcreteProductB&#123;&#125;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    factory := &amp;Factory&#123;&#125;<br>    productA := factory.CreateProduct(<span class="hljs-string">&quot;A&quot;</span>)<br>    productA.Use()<br><br>    productB := factory.CreateProduct(<span class="hljs-string">&quot;B&quot;</span>)<br>    productB.Use()<br>&#125;    <br></code></pre></td></tr></table></figure><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul><li><strong>è§£è€¦å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨</strong>ï¼šä½¿ç”¨è€…åªéœ€å…³æ³¨äº§å“çš„ä½¿ç”¨ï¼Œæ— éœ€å…³å¿ƒäº§å“çš„åˆ›å»ºç»†èŠ‚ã€‚</li><li><strong>æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§</strong>ï¼šå½“éœ€è¦æ·»åŠ æ–°çš„äº§å“ç±»å‹æ—¶ï¼Œåªéœ€ä¿®æ”¹å·¥å‚ç±»çš„åˆ›å»ºé€»è¾‘ã€‚</li></ul><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul><li><strong>å·¥å‚ç±»èŒè´£è¿‡é‡</strong>ï¼šç®€å•å·¥å‚æ¨¡å¼ä¸­ï¼Œå·¥å‚ç±»è´Ÿè´£åˆ›å»ºæ‰€æœ‰ç±»å‹çš„å¯¹è±¡ï¼Œå½“äº§å“ç±»å‹è¿‡å¤šæ—¶ï¼Œå·¥å‚ç±»çš„ä»£ç ä¼šå˜å¾—å¤æ‚ã€‚</li><li><strong>ä¸ç¬¦åˆå¼€é—­åŸåˆ™</strong>ï¼šæ¯æ¬¡æ·»åŠ æ–°çš„äº§å“ç±»å‹ï¼Œéƒ½éœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç ã€‚</li></ul><h2 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h2><h3 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>ç­–ç•¥æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—çš„ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ç«¯ã€‚</p><p><strong>Go è¯­è¨€å®ç°ç­–ç•¥æ¨¡å¼ç¤ºä¾‹</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-comment">// Strategy å®šä¹‰ç­–ç•¥æ¥å£</span><br><span class="hljs-keyword">type</span> Strategy <span class="hljs-keyword">interface</span> &#123;<br>    Execute()<br>&#125;<br><br><span class="hljs-comment">// ConcreteStrategyA å…·ä½“ç­–ç•¥A</span><br><span class="hljs-keyword">type</span> ConcreteStrategyA <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ConcreteStrategyA)</span></span> Execute() &#123;<br>    fmt.Println(<span class="hljs-string">&quot;Executing Strategy A&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// ConcreteStrategyB å…·ä½“ç­–ç•¥B</span><br><span class="hljs-keyword">type</span> ConcreteStrategyB <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ConcreteStrategyB)</span></span> Execute() &#123;<br>    fmt.Println(<span class="hljs-string">&quot;Executing Strategy B&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// Context ä¸Šä¸‹æ–‡</span><br><span class="hljs-keyword">type</span> Context <span class="hljs-keyword">struct</span> &#123;<br>    strategy Strategy<br>&#125;<br><br><span class="hljs-comment">// SetStrategy è®¾ç½®ç­–ç•¥</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> SetStrategy(strategy Strategy) &#123;<br>    c.strategy = strategy<br>&#125;<br><br><span class="hljs-comment">// ExecuteStrategy æ‰§è¡Œç­–ç•¥</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> ExecuteStrategy() &#123;<br>    <span class="hljs-keyword">if</span> c.strategy != <span class="hljs-literal">nil</span> &#123;<br>        c.strategy.Execute()<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    context := &amp;Context&#123;&#125;<br><br>    strategyA := &amp;ConcreteStrategyA&#123;&#125;<br>    context.SetStrategy(strategyA)<br>    context.ExecuteStrategy()<br><br>    strategyB := &amp;ConcreteStrategyB&#123;&#125;<br>    context.SetStrategy(strategyB)<br>    context.ExecuteStrategy()<br>&#125;    <br></code></pre></td></tr></table></figure><h3 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul><li><strong>ç®—æ³•å¯æ›¿æ¢</strong>ï¼šå®¢æˆ·ç«¯å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åœ°é€‰æ‹©ä¸åŒçš„ç®—æ³•ã€‚</li><li><strong>ç¬¦åˆå¼€é—­åŸåˆ™</strong>ï¼šå½“éœ€è¦æ·»åŠ æ–°çš„ç®—æ³•æ—¶ï¼Œåªéœ€å®ç°ç­–ç•¥æ¥å£ï¼Œæ— éœ€ä¿®æ”¹ä¸Šä¸‹æ–‡ç±»ã€‚</li><li><strong>è§£è€¦ç®—æ³•å’Œå®¢æˆ·ç«¯</strong>ï¼šç®—æ³•çš„å®ç°å’Œä½¿ç”¨åˆ†ç¦»ï¼Œæé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</li></ul><h3 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul><li><strong>ç­–ç•¥ç±»æ•°é‡è¿‡å¤š</strong>ï¼šå½“ç­–ç•¥è¾ƒå¤šæ—¶ï¼Œä¼šå¯¼è‡´ç­–ç•¥ç±»çš„æ•°é‡å¢åŠ ï¼Œå¢åŠ ä»£ç çš„å¤æ‚åº¦ã€‚</li><li><strong>å®¢æˆ·ç«¯éœ€è¦äº†è§£æ‰€æœ‰ç­–ç•¥</strong>ï¼šå®¢æˆ·ç«¯éœ€è¦äº†è§£æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œæ‰èƒ½é€‰æ‹©åˆé€‚çš„ç­–ç•¥ã€‚</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å·¥å‚æ¨¡å¼ä¸»è¦å…³æ³¨å¯¹è±¡çš„åˆ›å»ºï¼Œé€šè¿‡å·¥å‚ç±»æˆ–å·¥å‚å‡½æ•°æ¥å°è£…å¯¹è±¡çš„åˆ›å»ºé€»è¾‘ï¼›è€Œç­–ç•¥æ¨¡å¼ä¸»è¦å…³æ³¨ç®—æ³•çš„å°è£…å’Œæ›¿æ¢ï¼Œé€šè¿‡å®šä¹‰ç­–ç•¥æ¥å£å’Œå…·ä½“ç­–ç•¥ç±»ï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥åŠ¨æ€åœ°é€‰æ‹©ä¸åŒçš„ç®—æ³•ã€‚è¿™ä¸¤ç§æ¨¡å¼éƒ½èƒ½æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œåœ¨å®é™…å¼€å‘ä¸­å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„è®¾è®¡æ¨¡å¼ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Go-Nacos</title>
    <link href="/2025/04/10/tools/Go-Nacos/"/>
    <url>/2025/04/10/tools/Go-Nacos/</url>
    
    <content type="html"><![CDATA[<h1 id="Go-Nacosé…ç½®ä¸­å¿ƒä½¿ç”¨"><a href="#Go-Nacosé…ç½®ä¸­å¿ƒä½¿ç”¨" class="headerlink" title="Go-Nacosé…ç½®ä¸­å¿ƒä½¿ç”¨"></a>Go-Nacosé…ç½®ä¸­å¿ƒä½¿ç”¨</h1><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>1ã€ç¼–å†™é…ç½®æ–‡ä»¶ <code>docker-compose.yaml</code></p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3.0&quot;</span><br><span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">Nacos</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nacos-standalone</span><br>    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nacos/nacos-server:v2.2.0</span><br>    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MODE=standalone</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">JVM_XMS=512m</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">JVM_MAX=512m</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">JVM_XMN=256m</span><br>    <span class="hljs-attribute">privileged</span><span class="hljs-punctuation">:</span> <span class="hljs-string">true</span><br>    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">$&#123;NACOS_DIR&#125;/data:/home/nacos/data</span><br>    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-comment"># 8848 ç«¯å£æ˜¯ Nacos æœåŠ¡çš„ä¸»ç«¯å£ï¼Œç”¨äº HTTP æœåŠ¡é€šä¿¡å’Œç®¡ç†æ§åˆ¶å°è®¿é—®</span><br>      <span class="hljs-comment"># å®¢æˆ·ç«¯é€šè¿‡è¯¥ç«¯å£è¿›è¡ŒæœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€é…ç½®è·å–ç­‰æ“ä½œ</span><br>      <span class="hljs-comment"># ä¹Ÿå¯é€šè¿‡æµè§ˆå™¨è®¿é—® http://nacos-server:8848/nacos æ‰“å¼€ç®¡ç†æ§åˆ¶å°</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">8848:8848</span><br>      <span class="hljs-comment"># 9848 ç«¯å£ç”¨äº Nacos æœåŠ¡å™¨ä¸æ”¯æŒ gRPC åè®®çš„å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡</span><br>      <span class="hljs-comment"># å®¢æˆ·ç«¯å¯ä½¿ç”¨è¯¥ç«¯å£å»ºç«‹ä¸ Nacos æœåŠ¡å™¨çš„é•¿è¿æ¥ï¼Œå®ç°é«˜æ•ˆçš„æ•°æ®äº¤äº’</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">9848:9848</span><br>      <span class="hljs-comment"># 9849 ç«¯å£ç”¨äº Nacos æœåŠ¡å™¨é›†ç¾¤å†…éƒ¨èŠ‚ç‚¹ä¹‹é—´é€šè¿‡ gRPC åè®®è¿›è¡Œé€šä¿¡</span><br>      <span class="hljs-comment"># ç¡®ä¿é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹çš„æ•°æ®åŒæ­¥å’Œä¸€è‡´æ€§</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">9849:9849    </span><br><br></code></pre></td></tr></table></figure><p>2ã€docker-compose.yaml åŒçº§ç›®å½•åˆ›å»ºéšè—æ–‡ä»¶ï¼Œåˆ›å»ºç¯å¢ƒå˜é‡.env</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">vim .env<br><br>NACOS_DIR=/home/gond/work/db/nacos<br></code></pre></td></tr></table></figure><p>3ã€ç¯å¢ƒå˜é‡ä¼˜ç§€çº§</p><ol><li><p>å‘½ä»¤è¡Œä¸­æ˜¾å¼è®¾ç½®çš„ç¯å¢ƒå˜é‡</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker-compose -e <span class="hljs-attribute">DB_HOST</span>=custom_host up -d<br></code></pre></td></tr></table></figure></li><li><p><code>.env</code> æ–‡ä»¶ä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">DB_HOST</span>=default_host<br><span class="hljs-attr">DB_PORT</span>=<span class="hljs-number">5432</span><br></code></pre></td></tr></table></figure></li><li><p><code>docker-compose.yml</code> æ–‡ä»¶ä¸­ç›´æ¥ç¡¬ç¼–ç çš„ç¯å¢ƒå˜é‡</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">myapp</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">myapp-image</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_HOST=hardcoded_host</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_PORT=5433</span><br></code></pre></td></tr></table></figure></li><li><p>ä¸»æœºç¯å¢ƒå˜é‡</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">DB_HOST</span>=host_env_host<br></code></pre></td></tr></table></figure></li></ol><blockquote><p>ç¯å¢ƒé»˜è®¤å€¼é…ç½®æŠ€å·§</p></blockquote><p>demo</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">myapp:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">myapp-image</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_HOST=$&#123;DB_HOST:-localhost&#125;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_PORT=$&#123;DB_PORT:-5432&#125;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">APP_ENV=$&#123;APP_ENV:-development&#125;</span>   <br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="ç™»é™†å¹³å°"><a href="#ç™»é™†å¹³å°" class="headerlink" title="ç™»é™†å¹³å°"></a>ç™»é™†å¹³å°</h3><p>è®¿é—®webåœ°å€</p><p>url: <a href="http://localhost:8848/nacos/#/login">http://localhost:8848/nacos/#/login</a></p><p>nacos&#x2F;nacos</p><h3 id="åˆ›å»ºå‘½åç©ºé—´"><a href="#åˆ›å»ºå‘½åç©ºé—´" class="headerlink" title="åˆ›å»ºå‘½åç©ºé—´"></a>åˆ›å»ºå‘½åç©ºé—´</h3><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20250410211114368.png?raw=true" alt="å‘½åç©ºé—´"></p><h3 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h3><p>æ‰¾å¯¹å¯¹åº”çš„å‘½åç©ºé—´ ä¸Šè¾¹æˆ‘ä»¬åˆ›å»ºçš„å‘½åç©ºé—´ä¸º mhd<br><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20250410211541269.png?raw=true" alt="é…ç½®æ–‡ä»¶"></p><h3 id="golangè·å–nacosé…ç½®ä¿¡æ¯"><a href="#golangè·å–nacosé…ç½®ä¿¡æ¯" class="headerlink" title="golangè·å–nacosé…ç½®ä¿¡æ¯"></a>golangè·å–nacosé…ç½®ä¿¡æ¯</h3><p>å®‰è£…ä¾èµ–</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">go</span> <span class="hljs-built_in">get</span> -<span class="hljs-keyword">u</span> github.<span class="hljs-keyword">com</span>/nacos-group/nacos-sdk-<span class="hljs-keyword">go</span>/v2<br></code></pre></td></tr></table></figure><p>ç®€å•è·å–nacosé…ç½®</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/nacos-group/nacos-sdk-go/v2/clients&quot;</span><br><span class="hljs-string">&quot;github.com/nacos-group/nacos-sdk-go/v2/common/constant&quot;</span><br><span class="hljs-string">&quot;github.com/nacos-group/nacos-sdk-go/v2/vo&quot;</span><br><br><span class="hljs-string">&quot;gopkg.in/yaml.v3&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-comment">// è§£æconfig.ymlé…ç½®æ–‡ä»¶ å’Œä¸Šè¾¹çš„å­—æ®µä¿æŒä¸€è‡´</span><br><br><span class="hljs-keyword">type</span> NacosTestConfig <span class="hljs-keyword">struct</span> &#123;<br>Name     <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;Name&quot;`</span><br>ListenOn <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;ListenOn&quot;`</span><br>Etcd     Etcd   <span class="hljs-string">`yaml:&quot;Etcd&quot;`</span><br>&#125;<br><span class="hljs-keyword">type</span> Etcd <span class="hljs-keyword">struct</span> &#123;<br>Hosts []<span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;Hosts&quot;`</span><br>Key   <span class="hljs-type">string</span>   <span class="hljs-string">`yaml:&quot;Key&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>serverConfig := []constant.ServerConfig&#123;<br>&#123;<br>IpAddr: <span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-comment">//nacos åœ°å€</span><br>Port:   <span class="hljs-number">8848</span>,        <span class="hljs-comment">//nacos ç«¯å£</span><br>&#125;,<br>&#125;<br><br>clientConfig := &amp;constant.ClientConfig&#123;<br>NamespaceId:         <span class="hljs-string">&quot;1d920a58-2a12-48dd-8354-88170c2dc758&quot;</span>, <span class="hljs-comment">//å‘½åç©ºé—´ æ¯”è¾ƒé‡è¦ æ‹¿å–åˆšæ‰åˆ›å»ºçš„å‘½åç©ºé—´ID</span><br>TimeoutMs:           <span class="hljs-number">5000</span>,<br>NotLoadCacheAtStart: <span class="hljs-literal">true</span>,<br>LogDir:              <span class="hljs-string">&quot;/tmp/nacos/log&quot;</span>,<br>CacheDir:            <span class="hljs-string">&quot;/tmp/nacos/cache&quot;</span>,<br>LogLevel:            <span class="hljs-string">&quot;debug&quot;</span>,<br>&#125;<br><br>configClient, err := clients.NewConfigClient(<br>vo.NacosClientParam&#123;<br>ClientConfig:  clientConfig,<br>ServerConfigs: serverConfig,<br>&#125;,<br>)<br><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">//è¯»å–é…ç½®æ–‡ä»¶å¤±è´¥</span><br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-keyword">var</span> dataId = <span class="hljs-string">&quot;config.yaml&quot;</span><br><span class="hljs-keyword">var</span> group = <span class="hljs-string">&quot;dev&quot;</span><br>content, err := configClient.GetConfig(vo.ConfigParam&#123;<br>DataId: dataId, <span class="hljs-comment">//é…ç½®æ–‡ä»¶å</span><br>Group:  group,  <span class="hljs-comment">//é…ç½®æ–‡ä»¶åˆ†ç»„</span><br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">//è¯»å–é…ç½®æ–‡ä»¶å¤±è´¥</span><br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><br>fmt.Println(content) <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬æ‰“å°ä¸€ä¸‹é…ç½®æ–‡ä»¶çš„å†…å®¹</span><br><br><span class="hljs-comment">// è§£æé…ç½®æ–‡ä»¶</span><br><span class="hljs-keyword">var</span> nacosTestConfig *NacosTestConfig<br>yaml.Unmarshal([]<span class="hljs-type">byte</span>(content), &amp;nacosTestConfig)<br>fmt.Println(nacosTestConfig) <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬æ‰“å°ä¸€ä¸‹è§£æåçš„é…ç½®æ–‡ä»¶å†…å®¹</span><br><br><span class="hljs-comment">// ç›‘å¬é…ç½®æ–‡ä»¶å˜åŒ–</span><br>err = configClient.ListenConfig(vo.ConfigParam&#123;<br>DataId: dataId, <span class="hljs-comment">//é…ç½®æ–‡ä»¶å</span><br>Group:  group,<br>OnChange: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(namespace, group, dataId, data <span class="hljs-type">string</span>)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;é…ç½®æ–‡ä»¶å‘ç”Ÿå˜åŒ–:&quot;</span>, dataId, group, namespace)<br>fmt.Println(data) <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬æ‰“å°ä¸€ä¸‹é…ç½®æ–‡ä»¶çš„å†…å®¹</span><br><span class="hljs-comment">// è§£æé…ç½®æ–‡ä»¶</span><br><span class="hljs-keyword">var</span> nacosTestConfig *NacosTestConfig<br>yaml.Unmarshal([]<span class="hljs-type">byte</span>(data), &amp;nacosTestConfig)<br>fmt.Println(nacosTestConfig) <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬æ‰“å°ä¸€ä¸‹è§£æåçš„é…ç½®æ–‡ä»¶å†…å®¹</span><br>&#125;,<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><br>time.Sleep(time.Second * <span class="hljs-number">100</span>) <span class="hljs-comment">// è¿™é‡Œæˆ‘ä»¬ä¼‘çœ 100ç§’ï¼Œç­‰å¾…é…ç½®æ–‡ä»¶å˜åŒ–</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs text">Name: usercenter.rpc<br>ListenOn: 0.0.0.0:8080<br>Etcd:<br>  Hosts:<br>  - 127.0.0.1:2379<br>  Key: usercenter.rpc<br><br>&amp;&#123;usercenter.rpc 0.0.0.0:8080 &#123;[127.0.0.1:2379] usercenter.rpc&#125;&#125;<br>é…ç½®æ–‡ä»¶å‘ç”Ÿå˜åŒ–: config.yaml dev 1d920a58-2a12-48dd-8354-88170c2dc758<br>Name: Testusercenter.rpc<br>ListenOn: 0.0.0.0:8080<br>Etcd:<br>  Hosts:<br>  - 127.0.0.1:2379<br>  Key: usercenter.rpc<br><br>&amp;&#123;Testusercenter.rpc 0.0.0.0:8080 &#123;[127.0.0.1:2379] usercenter.rpc&#125;&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDb ä»‹ç»</title>
    <link href="/2025/03/06/tools/MongoDb%E5%85%A5%E9%97%A8/"/>
    <url>/2025/03/06/tools/MongoDb%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="MongoDbå…¥é—¨"><a href="#MongoDbå…¥é—¨" class="headerlink" title="MongoDbå…¥é—¨"></a>MongoDbå…¥é—¨</h1><h2 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h2><h3 id="1ã€ç®€å•ä»‹ç»"><a href="#1ã€ç®€å•ä»‹ç»" class="headerlink" title="1ã€ç®€å•ä»‹ç»"></a>1ã€ç®€å•ä»‹ç»</h3><ul><li>MongoDBæ˜¯ä¸€ä¸ªåŸºäº<code>åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨</code>çš„æ•°æ®åº“</li><li>ç”±C++è¯­è¨€ç¼–å†™ï¼Œæ—¨åœ¨ä¸ºWEBåº”ç”¨æä¾›å¯æ‰©å±•çš„é«˜æ€§èƒ½æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚</li><li>MongoDBæ˜¯ä¸€ä¸ªä»‹äº<code>å…³ç³»æ•°æ®åº“</code>å’Œ<code>éå…³ç³»æ•°æ®åº“</code>ä¹‹é—´çš„äº§å“ï¼Œæ˜¯éå…³ç³»æ•°æ®åº“å½“ä¸­åŠŸèƒ½æœ€ä¸°å¯Œï¼Œæœ€åƒå…³ç³»æ•°æ®åº“çš„ã€‚</li><li>æ”¯æŒçš„æ•°æ®ç»“æ„éå¸¸æ¾æ•£ï¼Œæ˜¯ç±»ä¼¼<code>json</code>çš„<code>bson</code>æ ¼å¼ï¼Œå› æ­¤å¯ä»¥å­˜å‚¨æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç±»å‹ã€‚</li><li>Mongoæœ€å¤§çš„ç‰¹ç‚¹æ˜¯å®ƒæ”¯æŒçš„æŸ¥è¯¢è¯­è¨€éå¸¸å¼ºå¤§ï¼Œå…¶è¯­æ³•æœ‰ç‚¹ç±»ä¼¼äºé¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ï¼Œå‡ ä¹å¯ä»¥å®ç°ç±»ä¼¼å…³ç³»æ•°æ®åº“å•è¡¨æŸ¥è¯¢çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè€Œä¸”è¿˜æ”¯æŒå¯¹æ•°æ®å»ºç«‹<code>ç´¢å¼•</code></li></ul><h3 id="2-ä¸šåŠ¡åº”ç”¨åœºæ™¯"><a href="#2-ä¸šåŠ¡åº”ç”¨åœºæ™¯" class="headerlink" title="2. ä¸šåŠ¡åº”ç”¨åœºæ™¯"></a>2. ä¸šåŠ¡åº”ç”¨åœºæ™¯</h3><p>ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“(å¦‚MySQL)ï¼Œåœ¨æ•°æ®æ“ä½œçš„<code>ä¸‰é«˜</code>éœ€æ±‚ä»¥åŠåº”å¯¹Web2.0çš„ç½‘ç«™éœ€æ±‚é¢å‰ï¼Œæ˜¾å¾—åŠ›ä¸ä»å¿ƒï¼Œè€Œ <a href="https://so.csdn.net/so/search?q=MongoDB&spm=1001.2101.3001.7020">MongoDB</a>å¯åº”å¯¹â€œä¸‰é«˜â€œéœ€æ±‚</p><ul><li><code>High performance</code>ï¼šå¯¹æ•°æ®åº“é«˜å¹¶å‘è¯»å†™çš„éœ€æ±‚</li><li><code>Huge Storage</code>ï¼šå¯¹æµ·é‡æ•°æ®çš„é«˜æ•ˆç‡å­˜å‚¨å’Œè®¿é—®çš„éœ€æ±‚</li><li><code>High Scalability &amp;&amp; High Availability</code>ï¼šå¯¹æ•°æ®åº“çš„é«˜å¯æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§çš„éœ€æ±‚</li></ul><p><strong>å…·ä½“åº”ç”¨åœºæ™¯</strong>ï¼š</p><ol><li>ç¤¾äº¤åœºæ™¯ï¼Œä½¿ç”¨ MongoDBå­˜å‚¨å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥åŠç”¨æˆ·å‘è¡¨çš„æœ‹å‹åœˆä¿¡æ¯ï¼Œé€šè¿‡åœ°ç†ä½ç½®ç´¢å¼•å®ç°é™„è¿‘çš„äººã€åœ°ç‚¹ç­‰åŠŸèƒ½ã€‚</li><li>æ¸¸æˆåœºæ™¯ï¼Œä½¿ç”¨ MongoDBå­˜å‚¨æ¸¸æˆç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·çš„è£…å¤‡ã€ç§¯åˆ†ç­‰ç›´æ¥ä»¥å†…åµŒæ–‡æ¡£çš„å½¢å¼å­˜å‚¨ï¼Œæ–¹ä¾¿æŸ¥è¯¢ã€é«˜æ•ˆç‡å­˜å‚¨å’Œè®¿é—®ã€‚</li><li>ç‰©æµåœºæ™¯ï¼Œä½¿ç”¨ MongoDBå­˜å‚¨è®¢å•ä¿¡æ¯ï¼Œè®¢å•çŠ¶æ€åœ¨è¿é€è¿‡ç¨‹ä¸­ä¼šä¸æ–­æ›´æ–°ï¼Œä»¥ MongoDBå†…åµŒæ•°ç»„çš„å½¢å¼æ¥å­˜å‚¨ï¼Œä¸€æ¬¡æŸ¥è¯¢å°±èƒ½å°†è®¢å•æ‰€æœ‰çš„å˜æ›´è¯»å–å‡ºæ¥</li><li>ç‰©è”ç½‘åœºæ™¯ï¼Œä½¿ç”¨ MongoDBå­˜å‚¨æ‰€æœ‰æ¥å…¥çš„æ™ºèƒ½è®¾å¤‡ä¿¡æ¯ï¼Œä»¥åŠè®¾å¤‡æ±‡æŠ¥çš„æ—¥å¿—ä¿¡æ¯ï¼Œå¹¶å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œå¤šç»´åº¦çš„åˆ†æã€‚</li><li>è§†é¢‘ç›´æ’­ï¼Œä½¿ç”¨ MongoDBå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€ç‚¹èµäº’åŠ¨ä¿¡æ¯ç­‰ã€‚</li></ol><p>è¿™äº›åº”ç”¨åœºæ™¯ä¸­ï¼Œæ•°æ®æ“ä½œæ–¹é¢çš„å…±åŒç‰¹ç‚¹æ˜¯ï¼š</p><p>ï¼ˆ1ï¼‰æ•°æ®é‡å¤§</p><p>ï¼ˆ2ï¼‰å†™å…¥æ“ä½œé¢‘ç¹ï¼ˆè¯»å†™éƒ½å¾ˆé¢‘ç¹ï¼‰</p><p>ï¼ˆ3ï¼‰ä»·å€¼è¾ƒä½çš„æ•°æ®ï¼Œå¯¹äº‹åŠ¡æ€§è¦æ±‚ä¸é«˜</p><p>å¯¹äºè¿™æ ·çš„æ•°æ®ï¼Œæˆ‘ä»¬æ›´é€‚åˆä½¿ç”¨ MongoDBæ¥å®ç°æ•°æ®çš„å­˜å‚¨ã€‚</p><h3 id="3ã€ä»€ä¹ˆæ—¶å€™é€‰æ‹©MongoDB"><a href="#3ã€ä»€ä¹ˆæ—¶å€™é€‰æ‹©MongoDB" class="headerlink" title="3ã€ä»€ä¹ˆæ—¶å€™é€‰æ‹©MongoDB"></a>3ã€ä»€ä¹ˆæ—¶å€™é€‰æ‹©MongoDB</h3><ul><li>åº”ç”¨ä¸éœ€è¦äº‹åŠ¡åŠå¤æ‚joinæ”¯æŒ</li><li>æ–°åº”ç”¨ï¼Œéœ€æ±‚ä¼šå˜ï¼Œæ•°æ®æ¨¡å‹æ— æ³•ç¡®å®šï¼Œæƒ³å¿«é€Ÿè¿­ä»£å¼€å‘</li><li>åº”ç”¨éœ€è¦2000-3000ä»¥ä¸Šçš„è¯»å†™QPSï¼ˆæ›´é«˜ä¹Ÿå¯ä»¥ï¼‰</li><li>åº”ç”¨éœ€è¦TBç”šè‡³PBçº§åˆ«æ•°æ®å­˜å‚¨</li><li>åº”ç”¨è¦æ±‚å­˜å‚¨çš„æ•°æ®ä¸ä¸¢å¤±</li><li>åº”ç”¨éœ€è¦99.999%é«˜å¯ç”¨</li><li>åº”ç”¨éœ€è¦å¤§é‡çš„åœ°ç†ä½ç½®æŸ¥è¯¢ã€æ–‡æœ¬æŸ¥</li></ul><p>ç›¸å¯¹MySQLï¼Œåœ¨ä»¥ä¸Šä»¥ç”¨åœºæ™¯å¯ä»¥ä»¥æ›´ä½çš„æˆæœ¬è§£å†³é—®é¢˜ï¼ˆåŒ…æ‹¬å­¦ä¹ ã€å¼€å‘ã€è¿ç»´ç­‰æˆæœ¬ï¼‰</p><h3 id="4ã€ä½“ç³»æœºæ„"><a href="#4ã€ä½“ç³»æœºæ„" class="headerlink" title="4ã€ä½“ç³»æœºæ„"></a>4ã€ä½“ç³»æœºæ„</h3><table><thead><tr><th><strong>SQLæœ¯è¯­&#x2F;æ¦‚å¿µ</strong></th><th>MongoDBæœ¯è¯­&#x2F;æ¦‚å¿µ</th><th>è§£é‡Š&#x2F;è¯´æ˜</th></tr></thead><tbody><tr><td>database</td><td>database</td><td>æ•°æ®åº“</td></tr><tr><td>table</td><td>collection</td><td>æ•°æ®è¡¨&#x2F;é›†åˆ</td></tr><tr><td>row</td><td>document</td><td>æ•°æ®è®°å½•è¡Œ&#x2F;æ–‡æ¡£</td></tr><tr><td>column</td><td>field</td><td>æ•°æ®å­—æ®µ&#x2F;åŸŸ</td></tr><tr><td>index</td><td>index</td><td>ç´¢å¼•</td></tr><tr><td>table joins</td><td></td><td>è¡¨è¿æ¥ï¼ŒMongoDBä¸æ”¯æŒ</td></tr><tr><td></td><td>åµŒå…¥æ–‡æ¡£</td><td>MongoDBé€šè¿‡åµŒå…¥å¼æ–‡æ¡£æ¥ä»£æ›¿å¤šè¡¨è¿æ¥</td></tr><tr><td>primary key</td><td>primary key</td><td>ä¸»å¥ï¼ŒMongodb è‡ªåŠ¨å°†_idå­—æ®µè®¾ç½®ä¸ºä¸»å¥</td></tr></tbody></table><h3 id="5ã€æ•°æ®ç±»å‹"><a href="#5ã€æ•°æ®ç±»å‹" class="headerlink" title="5ã€æ•°æ®ç±»å‹"></a>5ã€æ•°æ®ç±»å‹</h3><p>MongoDBçš„æœ€å°å­˜å‚¨å•ä½å°±æ˜¯æ–‡æ¡£<code>document</code>å¯¹è±¡ã€‚æ–‡æ¡£<code>document</code>å¯¹è±¡å¯¹åº”äºå…³ç³»å‹æ•°æ®åº“çš„è¡Œã€‚æ•°æ®åœ¨MongoDBä¸­ä»¥<code>BSONï¼ˆBinary-JSONï¼‰</code>æ–‡æ¡£çš„æ ¼å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚</p><p>BSONï¼ˆBinary Serialized Document Formatï¼‰æ˜¯ä¸€ç§ç±»jsonçš„ä¸€ç§äºŒè¿›åˆ¶å½¢å¼çš„å­˜å‚¨æ ¼å¼ï¼Œç®€ç§° Binary JSONï¼›BSONå’ŒJSONä¸€æ ·ï¼Œæ”¯æŒå†…åµŒçš„æ–‡æ¡£å¯¹è±¡å’Œæ•°ç»„å¯¹è±¡ï¼Œä½†æ˜¯BSONæœ‰JSONæ²¡æœ‰çš„ä¸€äº›æ•°æ®ç±»å‹ï¼Œå¦‚Dateå’ŒBin Dataç±»å‹ã€‚</p><p>BSONé‡‡ç”¨äº†ç±»ä¼¼äºCè¯­è¨€ç»“æ„ä½“çš„åç§°ã€å¯¹è¡¨ç¤ºæ–¹æ³•ï¼Œæ”¯æŒå†…åµŒçš„æ–‡æ¡£å¯¹è±¡å’Œæ•°ç»„å¯¹è±¡ï¼Œå…·æœ‰è½»é‡æ€§ã€å¯éå†æ€§ã€é«˜æ•ˆæ€§çš„ä¸‰ä¸ªç‰¹ç‚¹ï¼Œå¯ä»¥æœ‰æ•ˆæè¿°éç»“æ„åŒ–æ•°æ®å’Œç»“æ„åŒ–æ•°æ®ã€‚è¿™ç§æ ¼å¼çš„ä¼˜ç‚¹æ˜¯çµæ´»æ€§é«˜ï¼Œä½†å®ƒçš„ç¼ºç‚¹æ˜¯ç©ºé—´åˆ©ç”¨ç‡ä¸æ˜¯å¾ˆç†æƒ³ã€‚</p><p>BSONä¸­ï¼Œé™¤äº†åŸºæœ¬JSONç±»å‹ï¼š stringï¼Œintegerï¼Œbooleanï¼Œdoubleï¼Œnullï¼Œarrayå’Œobjectï¼Œmongoè¿˜ä½¿ç”¨äº†ç‰¹æ®Šçš„æ•°æ®ç±»å‹ã€‚è¿™äº›ç±»å‹åŒ…æ‹¬ dateï¼Œ object idï¼Œ binary dataï¼Œ regular expressionå’Œcodeã€‚æ¯ä¸€ä¸ªé©±åŠ¨éƒ½ä»¥ç‰¹å®šè¯­è¨€çš„æ–¹å¼å®ç°äº†è¿™äº›ç±»å‹ï¼ŒæŸ¥çœ‹ä½ çš„é©±åŠ¨çš„æ–‡æ¡£æ¥è·å–è¯¦ç»†ä¿¡æ¯</p><p>BSONæ•°æ®ç±»å‹å‚è€ƒåˆ—è¡¨ï¼š</p><table><thead><tr><th><strong>æ•°æ®ç±»å‹</strong></th><th><strong>æè¿°</strong></th><th>ä¸¾åˆ—</th></tr></thead><tbody><tr><td>å­—ç¬¦ä¸²</td><td>UTF-8å­—ç¬¦ä¸²éƒ½å¯ä»¥è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®</td><td>{â€œxâ€ï¼šâ€œfoobarâ€}</td></tr><tr><td>å¯¹è±¡id</td><td>å¯¹è±¡idæ˜¯æ–‡æ¡£çš„12å­—èŠ‚çš„å”¯ä¸€ID</td><td>{â€œxâ€:â€ObjectId()â€}</td></tr><tr><td>å¸ƒå°”å€¼</td><td>çœŸæˆ–è€…å‡ï¼štrueæˆ–è€…false</td><td>{â€œxâ€:â€trueâ€}</td></tr><tr><td>æ•°ç»„</td><td>å€¼çš„é›†åˆæˆ–è€…åˆ—è¡¨éƒ½å¯ä»¥è¡¨ç¤ºæˆæ•°ç»„</td><td>shellæ˜¯ä¸æ”¯æŒè¯¥ç±»å‹çš„ï¼Œshellä¸­é»˜è®¤ä¼šè½¬æ¢æˆ64ä½æµ®ç‚¹æ•°</td></tr><tr><td>32ä½æ•´æ•°</td><td>ç±»å‹ä¸å¯ç”¨ã€‚Javascriptä»…æ”¯æŒ64ä½æµ®ç‚¹æ•°ï¼Œæ‰€ä»¥32ä½æ•´æ•°ä¼šè¢«è‡ªåŠ¨è½¬æ¢</td><td>shell æ˜¯ä¸æ”¯æŒè¯¥ç±»å‹çš„ï¼Œshellä¸­é»˜è®¤ä¼šè½¬æˆ64ä½æµ®ç‚¹æ•°</td></tr><tr><td>64ä½æ•´æ•°</td><td>ä¸æ”¯æŒè¿™ä¸ªç±»å‹ï¼Œshellä¼šä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å†…åµŒæ–‡æ¡£æ¥æ˜¾ç¤º64ä½æ•´æ•°</td><td>shell æ˜¯ä¸æ”¯æŒè¯¥ç±»å‹çš„ï¼Œshellä¸­é»˜è®¤ä¼šè½¬æˆ64ä½æµ®ç‚¹æ•°</td></tr><tr><td>64ä½æµ®ç‚¹æ•°</td><td>shellä¸­çš„æ•°å­—å°±æ˜¯è¿™ä¸€ç§ç±»å‹</td><td>{â€œxâ€:3.14159,â€yâ€:3}</td></tr><tr><td>null</td><td>è¡¨ç¤ºç©ºå€¼æˆ–è€…æœªå®šä¹‰ç±»å‹</td><td>{â€œxâ€:null}</td></tr><tr><td>undeined</td><td>æ–‡æ¡£ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨æœªå®šä¹‰ç±»å‹</td><td>{â€œxâ€:underfined}</td></tr><tr><td>ç¬¦å·</td><td>shellä¸æ”¯æŒï¼Œshellä¼šå°†æ•°æ®åº“ä¸­çš„ç¬¦å·ç±»å‹çš„æ•°æ®è‡ªåŠ¨è½¬æ¢æˆå­—ç¬¦ä¸²</td><td></td></tr><tr><td>æ­£åˆ™è¡¨è¾¾å¼</td><td>æ–‡æ¡£ä¸­å¯ä»¥åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‡‡ç”¨JavaScriptçš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•</td><td>{â€œxâ€:&#x2F;foobar&#x2F;}</td></tr><tr><td>ä»£ç </td><td>æ–‡æ¡£ä¸­è¿˜å¯ä»¥åŒ…å«JavaScriptä»£ç </td><td>{â€œxâ€:function(){&#x2F;<em>â€¦</em>&#x2F;}}</td></tr><tr><td>äºŒè¿›åˆ¶æ•°æ®</td><td>äºŒè¿›åˆ¶æ•°æ®å¯ä»¥ç”±ä»»æ„å­—èŠ‚çš„å–˜ç»„æˆï¼Œä¸è¿‡shellä¸­æ— æ³•ä½¿ç”¨</td><td></td></tr><tr><td>æœ€å¤§å€¼&#x2F;æœ€å°å€¼</td><td>BSONåŒ…æ‹¬ä¸€ä¸ªç‰¹æ®Šç±»å‹ï¼Œè¡¨ç¤ºå¯èƒ½çš„æœ€å¤§å€¼ï¼Œshellä¸­æ²¡æœ‰è¿™ä¸ªç±»å‹</td><td></td></tr></tbody></table><blockquote><p>æç¤ºï¼šshellé»˜è®¤ä½¿ç”¨64ä½æµ®ç‚¹å‹æ•°å€¼ã€‚{â€œxâ€:3.14æˆ–{â€œxâ€:3}ã€‚å¯¹äºæ•´å‹å€¼ï¼Œå¯ä»¥ä½¿ç”¨NumberIntï¼ˆ4å­—èŠ‚ç¬¦å·æ•´æ•°ï¼‰æˆ– NumberLongï¼ˆ8å­—èŠ‚ç¬¦å·æ•´æ•°ï¼‰ï¼Œ{â€œxâ€:NumberInt(â€œ3â€ ){â€œxâ€:NumberLong(â€œ3â€)}</p></blockquote><ol start="6"><li><p>ç‰¹ç‚¹</p><ol><li><p><strong>é«˜æ€§èƒ½</strong></p><p>MongoDBæä¾›é«˜æ€§èƒ½çš„æ•°æ®æŒä¹…æ€§ã€‚ç‰¹åˆ«æ˜¯ï¼Œ</p><p>å¯¹åµŒå…¥å¼æ•°æ®æ¨¡å‹çš„æ”¯æŒå‡å°‘äº†æ•°æ®åº“ç³»ç»Ÿä¸ŠI&#x2F;Oæ´»åŠ¨ã€‚</p><p>ç´¢å¼•æ”¯æŒæ›´å¿«çš„æŸ¥è¯¢ï¼Œå¹¶ä¸”å¯ä»¥åŒ…å«æ¥è‡ªåµŒå…¥å¼æ–‡æ¡£å’Œæ•°ç»„çš„é”®ã€‚ï¼ˆæ–‡æœ¬ç´¢å¼•è§£å†³æœç´¢çš„éœ€æ±‚ã€TTLç´¢å¼•è§£å†³å†å²æ•°æ®è‡ªåŠ¨è¿‡æœŸçš„éœ€æ±‚ã€åœ°ç†ä½ç½®ç´¢å¼•å¯ç”¨äºæ„å»ºå„ç§O2Oåº”ç”¨ï¼‰</p></li><li><p><strong>é«˜å¯ç”¨æ€§</strong></p><p>MongoDBçš„å¤åˆ¶å·¥å…·ç§°ä¸ºå‰¯æœ¬é›†ï¼ˆ replica setï¼‰ï¼Œå®ƒå¯æä¾›è‡ªåŠ¨æ•…éšœè½¬ç§»å’Œæ•°æ®å†—ä½™</p></li><li><p><strong>é«˜æ‰©å±•æ€§</strong></p><p>MongoDBæä¾›äº†æ°´å¹³å¯æ‰©å±•æ€§ä½œä¸ºå…¶æ ¸å¿ƒåŠŸèƒ½çš„ä¸€éƒ¨åˆ†ã€‚</p><p>MongoDBæ”¯æŒä¸°å¯Œçš„æŸ»è¯¢è¯­è¨€ï¼Œæ”¯æŒè¯»å’Œå†™æ“ä½œï¼ˆCRUDï¼‰ï¼Œæ¯”å¦‚æ•°æ®èšåˆã€æ–‡æœ¬æœç´¢å’Œåœ°ç†ç©ºé—´æŸ¥è¯¢ç­‰</p></li><li><p><strong>ä¸°å¯Œçš„æŸ¥è¯¢æ”¯æŒ</strong></p><p>MongoDBæ”¯æŒä¸°å¯Œçš„æŸ»è¯¢è¯­è¨€ï¼Œæ”¯æŒè¯»å’Œå†™æ“ä½œï¼ˆCRUDï¼‰ï¼Œæ¯”å¦‚æ•°æ®èšåˆã€æ–‡æœ¬æœç´¢å’Œåœ°ç†ç©ºé—´æŸ¥è¯¢ç­‰</p></li><li><p><strong>å…¶ä»–ç‰¹ç‚¹</strong></p><p>å¦‚æ— æ¨¡å¼ï¼ˆåŠ¨æ€æ¨¡å¼ï¼‰ã€çµæ´»çš„æ–‡æ¡£æ¨¡å‹</p></li></ol></li></ol><h2 id="äºŒã€éƒ¨ç½²"><a href="#äºŒã€éƒ¨ç½²" class="headerlink" title="äºŒã€éƒ¨ç½²"></a>äºŒã€éƒ¨ç½²</h2><p><strong>docker-composeéƒ¨ç½²</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.8&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">mongodb:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mongo:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mongo</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;27017:27017&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/db:/data/db</span>  <span class="hljs-comment"># æŒä¹…åŒ–æ•°æ®</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MONGO_INITDB_ROOT_USERNAME=admin</span>  <span class="hljs-comment"># åˆå§‹ç®¡ç†å‘˜ç”¨æˆ·å</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MONGO_INITDB_ROOT_PASSWORD=admin123</span>  <span class="hljs-comment"># åˆå§‹ç®¡ç†å‘˜å¯†ç </span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">mongod</span> <span class="hljs-string">--auth</span>  <span class="hljs-comment"># å¯ç”¨è®¤è¯</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å®˜æ–¹æä¾›çš„å®‰è£…åŒ…è®¿é—®</p><p><a href="https://www.mongodb.com/try/download/compass">MongoDB ComPass</a></p><p>ä½¿ç”¨å·¥å…·è¿æ¥çš„æ—¶å€™iå…ˆå…³é—­</p><p>ommand: mongod â€“auth  # å¯ç”¨è®¤è¯</p><h2 id="ä¸‰ã€ç®€å•ä½¿ç”¨"><a href="#ä¸‰ã€ç®€å•ä½¿ç”¨" class="headerlink" title="ä¸‰ã€ç®€å•ä½¿ç”¨"></a>ä¸‰ã€ç®€å•ä½¿ç”¨</h2><p><strong>å‰ç½®å‡†å¤‡</strong> </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> Client *mongo.Client<br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>Name <span class="hljs-type">string</span><br>Age  <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>ctx, cancel := context.WithTimeout(context.Background(), <span class="hljs-number">10</span>*time.Second)<br><span class="hljs-keyword">defer</span> cancel()<br><span class="hljs-comment">// è®¾ç½®å®¢æˆ·ç«¯è¿æ¥é…ç½®</span><br>clientOptions := options.Client().ApplyURI(<span class="hljs-string">&quot;mongodb://admin:admin123@localhost:27017&quot;</span>)<br>clientOptions.SetMaxPoolSize(<span class="hljs-number">10</span>)<br><span class="hljs-comment">// è¿æ¥åˆ°MongoDB</span><br><span class="hljs-keyword">var</span> err <span class="hljs-type">error</span><br>Client, err = mongo.Connect(ctx, clientOptions)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br><span class="hljs-comment">// æ£€æŸ¥è¿æ¥</span><br>err = Client.Ping(ctx, <span class="hljs-literal">nil</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;Connected to MongoDB!&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><ol><li><p>æ’å…¥</p><p><code>æ’å…¥å•æ¡æ•°æ®</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">insert</span><span class="hljs-params">(collect *mongo.Collection)</span></span> &#123;<br><br>student := User&#123;Name: <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, Age: <span class="hljs-number">18</span>&#125;<br>insertRes, err := collect.InsertOne(context.Context(context.Background()), student)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;å•æ¡æ’å…¥æˆåŠŸï¼Œæ’å…¥idä¸ºï¼šï¼š&quot;</span>, insertRes.InsertedID)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>æ’å…¥å¤šæ¡æ•°æ®</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InsertRows</span><span class="hljs-params">(collect *mongo.Collection)</span></span> &#123;<br>users := []<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<br>&amp;User&#123;Name: <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, Age: <span class="hljs-number">18</span>&#125;,<br>&amp;User&#123;Name: <span class="hljs-string">&quot;æå››&quot;</span>, Age: <span class="hljs-number">19</span>&#125;,<br>&amp;User&#123;Name: <span class="hljs-string">&quot;ç‹äº”&quot;</span>, Age: <span class="hljs-number">20</span>&#125;,<br>&#125;<br>info, err := collect.InsertMany(context.Context(context.Background()), users)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(<span class="hljs-string">&quot;å¤šæ¡æ’å…¥å¤±è´¥&quot;</span>, err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;å¤šæ¡æ’å…¥æˆåŠŸï¼Œæ’å…¥idä¸ºï¼šï¼š&quot;</span>, info.InsertedIDs)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹</p><p><code>ä¿®æ”¹å•ä¸ª</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">update</span><span class="hljs-params">(collect *mongo.Collection)</span></span> &#123;<br>filter := bson.D&#123;&#123;<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>&#125;&#125;<br>update := bson.D&#123;&#123;<span class="hljs-string">&quot;$set&quot;</span>, bson.D&#123;&#123;<span class="hljs-string">&quot;age&quot;</span>, <span class="hljs-number">31</span>&#125;&#125;&#125;&#125;<br>result, err := collect.UpdateOne(context.Background(), filter, update)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(<span class="hljs-string">&quot;ä¿®æ”¹å•ä¸ªæ–‡æ¡£å¤±è´¥&quot;</span>, err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;ä¿®æ”¹å•ä¸ªæ–‡æ¡£æˆåŠŸï¼Œå—å½±å“çš„æ–‡æ¡£æ•°ä¸ºï¼š&quot;</span>, result.ModifiedCount)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ä¿®æ”¹å¤šä¸ª</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">upateRows</span><span class="hljs-params">(collect *mongo.Collection)</span></span> &#123;<br>filter := bson.D&#123;&#123;<span class="hljs-string">&quot;age&quot;</span>, bson.D&#123;&#123;<span class="hljs-string">&quot;$gt&quot;</span>, <span class="hljs-number">25</span>&#125;&#125;&#125;&#125;<br>update := bson.D&#123;&#123;<span class="hljs-string">&quot;$set&quot;</span>, bson.D&#123;&#123;<span class="hljs-string">&quot;isAdult&quot;</span>, <span class="hljs-literal">true</span>&#125;&#125;&#125;&#125;<br>result, err := collect.UpdateMany(context.Background(), filter, update)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(<span class="hljs-string">&quot;ä¿®æ”¹å¤šä¸ªæ–‡æ¡£å¤±è´¥&quot;</span>, err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;ä¿®æ”¹å¤šä¸ªæ–‡æ¡£æˆåŠŸï¼Œå—å½±å“çš„æ–‡æ¡£æ•°ä¸ºï¼š&quot;</span>, result.ModifiedCount)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">delete</span><span class="hljs-params">(collect *mongo.Collection)</span></span> &#123;<br>filter := bson.D&#123;&#123;<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>&#125;&#125;<br>result, err := collect.DeleteOne(context.Background(), filter)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥&quot;</span>, err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;åˆ é™¤æˆåŠŸï¼Œå—å½±å“çš„æ–‡æ¡£æ•°ä¸ºï¼š&quot;</span>, result.DeletedCount)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢</p><p><code>æŸ¥è¯¢å•ä¸ª</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">query</span><span class="hljs-params">(collect *mongo.Collection)</span></span> &#123;<br>querinfo := bson.D&#123;&#123;<span class="hljs-string">&quot;age&quot;</span>, <span class="hljs-number">18</span>&#125;&#125;<br>info := &amp;User&#123;&#125;<br>err := collect.FindOne(context.Background(), querinfo).Decode(info)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(<span class="hljs-string">&quot;æŸ¥è¯¢å¤±è´¥&quot;</span>, err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;æŸ¥è¯¢æˆåŠŸï¼ŒæŸ¥è¯¢ç»“æœä¸ºï¼š&quot;</span>, info)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>æŸ¥è¯¢duoge</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">queryRows</span><span class="hljs-params">(collect *mongo.Collection)</span></span> &#123;<br><span class="hljs-comment">// æŸ¥è¯¢å¤šä¸ª</span><br><span class="hljs-comment">// å°†é€‰é¡¹ä¼ é€’ç»™Find()</span><br>findOptions := options.Find()<br>findOptions.SetLimit(<span class="hljs-number">2</span>) <span class="hljs-comment">// åŒ¹é…ä¸¤ä¸ª</span><br><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªåˆ‡ç‰‡ç”¨æ¥å­˜å‚¨æŸ¥è¯¢ç»“æœ</span><br><span class="hljs-keyword">var</span> results []User<br><span class="hljs-comment">//æŠŠbson.D&#123;&#123;&#125;&#125;ä½œä¸ºä¸€ä¸ªfilteræ¥åŒ¹é…æ‰€æœ‰æ–‡æ¡£ è¿™é‡Œæ˜¯æŸ¥æ‰¾æ–‡æ¡£ä¸­nameä¸ºå¼ ä¸‰çš„</span><br>cur, err := collect.Find(context.TODO(), bson.D&#123;&#123;<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>&#125;&#125;, findOptions)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><span class="hljs-keyword">for</span> cur.Next(context.TODO()) &#123;<br>str := User&#123;&#125;<br>err := cur.Decode(&amp;str)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>results = <span class="hljs-built_in">append</span>(results, str)<br>&#125;<br>cur.Close(context.TODO())<br>fmt.Println(results)<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>äº‹åŠ¡</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">transactionExample</span><span class="hljs-params">(collection *mongo.Collection)</span></span> &#123;<br>session, err := Client.StartSession()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Failed to start session: %v&quot;</span>, err)<br>&#125;<br><span class="hljs-keyword">defer</span> session.EndSession(context.Background())<br><br>err = session.StartTransaction()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Failed to start transaction: %v&quot;</span>, err)<br>&#125;<br><br><span class="hljs-comment">// åœ¨äº‹åŠ¡ä¸­æ’å…¥ä¸€æ¡è®°å½•</span><br>student := User&#123;Name: <span class="hljs-string">&quot;äº‹åŠ¡æ’å…¥ç”¨æˆ·&quot;</span>, Age: <span class="hljs-number">22</span>&#125;<br>_, err = collection.InsertOne(context.Background(), student)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>session.AbortTransaction(context.Background())<br>log.Fatalf(<span class="hljs-string">&quot;Failed to insert document in transaction: %v&quot;</span>, err)<br>&#125;<br><br><span class="hljs-comment">// åœ¨äº‹åŠ¡ä¸­æ›´æ–°ä¸€æ¡è®°å½•</span><br>filter := bson.D&#123;&#123;<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>&#125;&#125;<br>update := bson.D&#123;&#123;<span class="hljs-string">&quot;$set&quot;</span>, bson.D&#123;&#123;<span class="hljs-string">&quot;age&quot;</span>, <span class="hljs-number">35</span>&#125;&#125;&#125;&#125;<br>_, err = collection.UpdateOne(context.Background(), filter, update)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>session.AbortTransaction(context.Background())<br>log.Fatalf(<span class="hljs-string">&quot;Failed to update document in transaction: %v&quot;</span>, err)<br>&#125;<br><br><span class="hljs-comment">// æäº¤äº‹åŠ¡</span><br>err = session.CommitTransaction(context.Background())<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Failed to commit transaction: %v&quot;</span>, err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;Transaction completed successfully.&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlä¹‹B+æ ‘</title>
    <link href="/2024/12/10/tools/MySql%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B9%8BB+%E6%A0%91/"/>
    <url>/2024/12/10/tools/MySql%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B9%8BB+%E6%A0%91/</url>
    
    <content type="html"><![CDATA[<h1 id="MySqlçš„æ•°æ®å­˜å‚¨ä¹‹B-æ ‘"><a href="#MySqlçš„æ•°æ®å­˜å‚¨ä¹‹B-æ ‘" class="headerlink" title="MySqlçš„æ•°æ®å­˜å‚¨ä¹‹B+æ ‘"></a>MySqlçš„æ•°æ®å­˜å‚¨ä¹‹B+æ ‘</h1><h2 id="1-MySqlçš„å®é™…å­˜å‚¨ä½ç½®"><a href="#1-MySqlçš„å®é™…å­˜å‚¨ä½ç½®" class="headerlink" title="1 MySqlçš„å®é™…å­˜å‚¨ä½ç½®"></a>1 MySqlçš„å®é™…å­˜å‚¨ä½ç½®</h2><p>B+æ ‘æ˜¯MySqlæ•°æ®ç»“æ„çš„ä¸»æµå­˜å‚¨æ–¹å¼ï¼ŒåŒ…æ‹¬InnoDBå’ŒMYISAMå¼•æ“ï¼Œå®ƒä»¬çš„é»˜è®¤å­˜å‚¨ç»“æ„éƒ½æ˜¯B+æ ‘</p><p>äº†è§£B+æ ‘å‰ï¼Œæˆ‘ä»¬å…ˆè¦çŸ¥é“MySql çš„å®é™…å­˜å‚¨ä½ç½®åœ¨å“ªï¼Ÿ</p><p>æœ‰äººä¼šè¯´å®ƒå­˜åœ¨æˆ‘ä¹ˆçš„Dç›˜æˆ–Cç›˜çš„MySqlæ–‡ä»¶å¤¹çš„Dataç›®å½•é‡Œï¼Œè¿™ä¸ªå›ç­”æ²¡é”™ï¼Œæˆ‘ä»¬åœ¨æ·±å…¥çš„äº†è§£ä¸€ä¸‹å‘¢ï¼Ÿ</p><p>ä¸ç®¡æ˜¯åœ¨ä¸ªäººç”µè„‘ä¸Šä½¿ç”¨æœ¬æœºMySqlæˆ–è€…åœ¨äº’è”ç½‘ä¸ŠæŠŠä¿¡æ¯å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œå…¶å®å®ƒä»¬æœ€ç»ˆçš„å­˜å‚¨åœ°å€éƒ½æ˜¯è¢«å†™åœ¨äº†ç‰©ç†ç£ç›˜ä¸Šï¼Œåªæœ‰å­˜åœ¨ç‰©ç†ç£ç›˜ä¸Šï¼Œæ‰èƒ½ä¿è¯æ•°æ®é•¿ä¹…ä¸ä¸¢å¤±</p><p>ç‰©ç†ç£ç›˜ä¸€èˆ¬å¯ä»¥æè¿°ä¸ºï¼šæŸ±é¢ï¼Œç£é¢ï¼Œæ‰‡åŒºï¼Œé€šè¿‡è¿™ä¸‰ä¸ªå‚æ•°å¯ä»¥ç²¾å‡†å®šä½åˆ°æ•°æ®æ‰€åœ¨çš„åœ°æ–¹</p><p><strong>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªæ™®é€šçš„ç£é¢ï¼š</strong></p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/Screenshot1.png?raw=true" alt="ç£é¢å›¾"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªç£é¢ä¸Šè®°å½•ç€ç£é“å’Œæ‰‡åŒºï¼Œ</p><p>ä¸€èˆ¬ç£ç›˜å®šä½æœ‰å›ºå®šå¤´å’Œç§»åŠ¨å¤´ä¸¤ç§ï¼š</p><p>å›ºå®šå¤´æ¯ä¸ªç£é“ä¸Šéƒ½æœ‰ä¸€ä¸ªè¯»å†™å¤´ï¼Œé€ ä»·é«˜ï¼Œä½†æ˜¯è¯»å†™é€Ÿåº¦å¿«ï¼Œå®šä½æ—¶é—´çŸ­</p><p>ç§»åŠ¨å¤´æ¯ä¸ªç£é¢ä¸Šä¸€ä¸ªè¯»å†™å¤´ï¼Œé€ ä»·é€‚ä¸­ï¼Œè¯»å†™é€Ÿåº¦ä¸»è¦å–å†³äºå®šä½æ—¶é—´ï¼Œä»å®šä½ç£é“ï¼Œå†åˆ°å®šä½æ‰‡åŒºæ‰€åŒ–çš„æ—¶é—´ï¼Œç°è¡Œçš„ç‰©ç†ç£ç›˜å¤§å¤šéƒ½æ˜¯ä½¿ç”¨çš„ç§»åŠ¨å¤´å®šä½ã€‚</p><p>æˆ‘ä»¬åœ¨äº†è§£äº†æˆ‘ä»¬çš„ç£ç›˜å’Œç§»åŠ¨å¤´åï¼Œæˆ‘ä»¬å°±éœ€è¦äº†è§£ä¸€æ¬¡ç‰©ç†ç£ç›˜çš„I&#x2F;Oï¼Œå®ƒæŒ‡çš„æ˜¯å¯¹äºç£ç›˜æ¥è¯´ï¼Œä¸€æ¬¡ç£ç›˜çš„è¿ç»­è¯»æˆ–è€…è¿ç»­å†™ç§°ä¸ºä¸€æ¬¡ç£ç›˜ I&#x2F;O, ç£ç›˜çš„ IOPS å°±æ˜¯æ¯ç§’ç£ç›˜è¿ç»­è¯»æ¬¡æ•°å’Œè¿ç»­å†™æ¬¡æ•°ä¹‹å’Œã€‚</p><p>æˆ‘ä»¬è¿™é‡Œå°±æŠŠä»–å½“ä½œè¯»å†™ä¸€æ¬¡æ‰‡åŒºï¼Œå³ä¸€æ¬¡I&#x2F;Oåªè¯»å†™ä¸€ä¸ªæ‰‡åŒºï¼ˆå®é™…ä¸Šçš„I&#x2F;OæŒ‡çš„æ˜¯æ ¹æ®æŸ¥è¯¢çš„æ•°æ®å¤§å°ï¼Œå¯èƒ½ä¼šè¿ç»­è¯»å†™å¥½å‡ ä¸ªæˆ–è€…å‡ ç™¾ä¸ªæ‰‡åŒºï¼Œä½†æ˜¯ä¹Ÿåªè¿›è¡Œäº†ä¸€æ¬¡I&#x2F;Oï¼Œå› ä¸ºI&#x2F;Oè¯»å†™çš„æ—¶é—´å¼€é”€æœ€å¤§çš„è¿˜æ˜¯åœ¨ç§»åŠ¨å¤´çš„å®šä½æ—¶é—´ä¸Šï¼‰</p><p>ä¸€ä¸ªæ‰‡åŒºçš„å¤§å°æ¯”è¾ƒå…¬è®¤çš„æ˜¯512å­—èŠ‚ï¼ˆåé¢æ…¢æ…¢å‘å±•çš„ä¹Ÿæœ‰ä¸€ä¸ªæ‰‡åŒº2048å­—èŠ‚çš„ï¼Œæˆ‘ä»¬è¿™é‡Œå°±ä¸¾ä¾‹512å­—èŠ‚ï¼‰</p><p><strong>æˆ‘ä»¬å…ˆç®€å•çš„çœ‹ä¸€ä¸ªæ•°æ®è¡¨ï¼Œæ•°æ®åœ¨æ‰‡åŒºä¸Šæ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼š</strong></p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/2846424-20230513100745862-1612056196.png?raw=true" alt="2846424-20230513100745862-1612056196"></p><p>è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€å¼ è¡¨ï¼Œè¿˜æœ‰é‡Œé¢çš„æ•°æ®ï¼Œä»–æœ‰ä¸‰ä¸ªå±æ€§ï¼šid 8å­—èŠ‚ï¼Œname 40å­—èŠ‚ï¼Œno 16å­—èŠ‚</p><p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥æ¨å‡ºï¼šè¿™å¼ è¡¨çš„ä¸€æ¡è®°å½•å°±æ˜¯8+40+16&#x3D;64å­—èŠ‚ï¼Œæˆ‘ä»¬è¿™ä¼šå„¿å®šä¹‰çš„è¿™å¼ è¡¨çš„ä¸€æ¡è®°å½•å°±è¦å 64å­—èŠ‚</p><p>ä¸€ä¸ªæ‰‡åŒº512å­—èŠ‚ï¼š512&#x2F;64&#x3D;8</p><p>æ‰€ä»¥ä¸€ä¸ªæ‰‡åŒºå°±åªèƒ½è£…8æ¡è®°å½•ï¼Œæˆ‘ä»¬è¿™32æ¡è®°å½•å°±éœ€è¦32&#x2F;8&#x3D;4ï¼Œå°±éœ€è¦4ä¸ªæ‰‡åŒºå»è£…å…¥ï¼Œ</p><p>å¦‚æœæˆ‘ä»¬æŒ‰ç…§è§„å®šçš„ä¸€æ¬¡I&#x2F;Oè¯»å†™ä¸€ä¸ªæ‰‡åŒºï¼Œé‚£æˆ‘ä»¬è¦æ‰¾åˆ°32è¿™æ¡è®°å½•çš„è¯éœ€è¦4æ¬¡I&#x2F;Oæ“ä½œï¼Œ4æ¬¡è¿˜ç®—ä¸€èˆ¬æ€§èƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å¤§å‹çš„æ•°æ®åº“å­˜å‚¨ä¸€å¼ è¡¨å¯ä¸æ­¢32æ¡è®°å½•å“¦</p><p>ä½†æˆ‘ä»¬ç®€å•çš„æŠŠè®°å½•åŠ åˆ°800æ¡çš„æ—¶å€™ï¼š800&#x2F;8 &#x3D; 100 ï¼Œä¹Ÿå°±æ˜¯éœ€è¦100ä¸ªæ‰‡åŒºæ¥è£…å…¥ï¼Œé‚£æˆ‘ä»¬è¦æŸ¥æ‰¾ç¬¬800æ¡è®°å½•çš„æ—¶å€™å°±éœ€è¦100æ¬¡I&#x2F;Oæ“ä½œï¼Œæ˜¾ç„¶è¿™æ ·çš„I&#x2F;Oæ“ä½œå°±å¤ªæ…¢äº†ï¼Œè¦æ˜¯æœ‰1000ä¸ªäººéœ€è¦æŸ¥æ‰¾ï¼Œæ—¶é—´å¼€é”€å°±å¾ˆå¤§äº†</p><p>è¿™ç§æƒ…å†µæˆ‘ä»¬å°±éœ€è¦å¼•å…¥ç´¢å¼•ï¼›B+æ ‘çš„æ ¹èŠ‚ç‚¹å‡ ä¹å…¨æ˜¯ç´¢å¼•</p><h2 id="2-MySqlçš„ç´¢å¼•"><a href="#2-MySqlçš„ç´¢å¼•" class="headerlink" title="2 MySqlçš„ç´¢å¼•"></a>2 MySqlçš„ç´¢å¼•</h2><p>ä»€ä¹ˆæ˜¯ç´¢å¼•å‘¢ï¼Ÿ</p><p>ç´¢å¼•æ˜¯ä¸ºäº†åŠ é€Ÿå¯¹è¡¨ä¸­æ•°æ®è¡Œçš„æ£€ç´¢è€Œåˆ›å»ºçš„ä¸€ç§åˆ†æ•£çš„å­˜å‚¨ç»“æ„ã€‚ç´¢å¼•æ˜¯é’ˆå¯¹è¡¨è€Œå»ºç«‹çš„ï¼Œå®ƒæ˜¯ç”±æ•°æ®é¡µé¢ä»¥å¤–çš„ç´¢å¼•é¡µé¢ç»„æˆçš„ï¼Œæ¯ä¸ªç´¢å¼•é¡µé¢ä¸­çš„è¡Œéƒ½ä¼šå«æœ‰é€»è¾‘æŒ‡é’ˆï¼Œä»¥ä¾¿åŠ é€Ÿæ£€ç´¢ç‰©ç†æ•°æ®ã€‚</p><p>ç®€å•çš„è¯´ï¼Œç´¢å¼•å°±æ˜¯å»ºè¡¨æˆ–è€…åæœŸåŠ å…¥çš„ï¼Œå®ƒå¯ä»¥åˆ†ä¸ºä¸»é”®ç´¢å¼•ï¼Œå¤åˆç´¢å¼•ï¼Œæ™®é€šç´¢å¼•ï¼Œ</p><p>å½“æˆ‘ä»¬å»ºç«‹ç´¢å¼•ä»¥åï¼Œå°±ä¼šè‡ªåŠ¨çš„æŠŠå»ºç«‹ç´¢å¼•çš„å±æ€§æˆ–å±æ€§ç»„å•ç‹¬çš„æ‹¿å‡ºæ¥ç„¶åå’Œè¿™ä¸ªå±æ€§æ‰€åœ¨çš„ç‰©ç†åœ°å€ä¸€èµ·å•ç‹¬æ„æˆä¸€ä¸ªè¡¨æ¥å­˜æ”¾ï¼Œè™½ç„¶å¤šäº†ä¸€ä¸ªè¡¨ä½†æ˜¯å› ä¸ºå±æ€§è¾ƒå°‘ï¼Œæ‰€å çš„ç©ºé—´å°‘ï¼ŒæŸ¥è¯¢æ•ˆç‡é«˜äº†</p><p><strong>è¿™é‡Œæˆ‘ä»¬å†æ¥ç®€å•çš„çœ‹ä¸¤ä¸ªè¡¨ï¼š</strong></p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/2846424-20230513103130886-1795854003-17236910800611.png?raw=true" alt="2846424-20230513103130886-1795854003"></p><p> è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å³è¾¹çš„è¡¨å°±æ˜¯æˆ‘ä»¬çš„æ•°æ®è¡¨ï¼Œå®ƒè®°å½•ç€800æ¡è®°å½•ï¼Œä¸Šé¢æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†å®ƒè¦è¢«æŸ¥è¯¢åˆ°çš„è¯éœ€è¦100æ¬¡I&#x2F;Oï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ä¸ºidå»ºä¸€ä¸ªç´¢å¼•</p><p>å½“idè¢«é€‰ä¸ºç´¢å¼•ä»¥åï¼Œidä¼šå’Œidæ‰€åœ¨çš„å®é™…ç‰©ç†åœ°å€æ„æˆä¸€ä¸ªè¡¨ï¼Œè¿™ä¸ªè¡¨id 8å­—èŠ‚ï¼Œåœ°å€ 8å­—èŠ‚ï¼Œä¸€å…±16å­—èŠ‚ï¼Œå®ƒä¹Ÿæ˜¯å­˜åœ¨ä¸€ä¸ªæ‰‡åŒºçš„è¿˜æœ‰å¯èƒ½æ²¡æœ‰å’Œæ•°æ®åŸè¡¨åœ¨ç›¸é‚»çš„æ‰‡åŒº</p><p>ä¸€ä¸ªæ‰‡åŒºçš„çš„å¤§å°512å­—èŠ‚ï¼š512&#x2F;16 &#x3D; 32ï¼Œæ‰€ä»¥è¿™ä¸ªç´¢å¼•è¡¨æ‰€åœ¨çš„æ‰‡åŒºï¼Œå¯ä»¥è£…32æ¡è®°å½•</p><p>ç¬¬ä¸€æ¡è®°å½•ï¼šè®°å½•idä¸º1ï¼Œå®ƒæ‰€åœ¨çš„ç‰©ç†åœ°å€ï¼Œ</p><p>ç¬¬äºŒæ¡è®°å½•ï¼šè®°å½•idä¸º33ï¼Œå®ƒæ‰€åœ¨çš„ç‰©ç†åœ°å€ï¼Œ</p><p>ç¬¬ä¸‰åäºŒæ¡è®°å½•ï¼šè®°å½•idä¸º1023ï¼Œå®ƒæ‰€åœ¨çš„ç‰©ç†åœ°å€</p><p><strong>æœ‰äº†è¿™ä¸ªç´¢å¼•è¡¨ä¹‹åï¼Œæˆ‘ä»¬å†æŸ¥800æ¡è®°å½•æ•°æ®çš„è¿‡ç¨‹å°±ç®€å•åŒ–äº†</strong></p><p>é¦–å…ˆï¼Œä¸€æ¬¡I&#x2F;Oæ“ä½œä¼šæŠŠè¿™ä¸ªç´¢å¼•è¡¨æŸ¥å‡ºæ¥ï¼ˆè¦ç”¨åˆ°ç´¢å¼•æ‰èƒ½å‘½ä¸­ï¼Œä¹Ÿå°±æ˜¯å†sqlè¯­å¥ä¸­çš„æ¡ä»¶åˆ¤æ–­è¯­å¥å¸¦æœ‰idï¼‰ï¼Œè¿™é‡Œåªè¿›è¡Œäº†ä¸€æ¬¡I&#x2F;Oå°±æ‹¿åˆ°äº†1<del>33ï¼Œ33</del>65ï¼Œâ€¦.~1023è¿™äº›åŒºé—´çš„ä¿¡æ¯</p><p>ç„¶åï¼Œæˆ‘ä»¬æŸ¥ç¬¬800æ¡è®°å½•çš„æ—¶å€™æˆ‘ä»¬å¾ˆå¹¸è¿ï¼Œå› ä¸ºç´¢å¼•è¡¨ä¸­æœ‰ä¸€ä¸ªåŒºé—´æ˜¯800~833å°±å¯ä»¥é€šè¿‡åœ°å€ç›´æ¥å»è¯»800æ‰€åœ¨çš„æ‰‡åŒº è¿™é‡Œå°±ä¹Ÿåªç”¨äº†ä¸€æ¬¡I&#x2F;Oæ“ä½œ</p><p>è¿™æ˜¯æœ€å¥½çš„æƒ…å†µï¼š2æ¬¡I&#x2F;Oå°±æ‹¿åˆ°äº†ç¬¬800æ¡ä»¶è®°å½•</p><p>æˆ‘ä»¬çœ‹çœ‹æœ€åçš„æƒ…å†µï¼Œç»†å¿ƒçš„æœ‹å‹å¯ä»¥å‘ç°å†æ¯ä¸ªåŒºé—´éƒ½æœ‰ä¸€ä¸ªæœ€åæƒ…å†µï¼Œ</p><p>æ¯”å¦‚ï¼š</p><p>1~33åŒºé—´ä¸Šï¼Œå½“æˆ‘ä»¬è¦æŸ¥è¯¢32æ—¶åªèƒ½é€šè¿‡æ‰¾åˆ°id&#x3D;1çš„æ‰‡åŒºï¼Œç„¶åä¾æ¬¡è¯»å–ç›´åˆ°è¯»åˆ°id&#x3D;32çš„æ‰‡åŒº</p><p>33~65åŒºé—´ä¸Šï¼Œå½“æˆ‘ä»¬è¦æŸ¥è¯¢64æ—¶åªèƒ½é€šè¿‡æ‰¾åˆ°id&#x3D;33çš„æ‰‡åŒºï¼Œç„¶åä¾æ¬¡è¯»å–ç›´åˆ°è¯»åˆ°id&#x3D;64çš„æ‰‡åŒº</p><p>â€¦â€¦</p><p>800~833åŒºé—´ä¸Šï¼Œæˆ‘ä»¬å»æŸ¥æ‰¾832æ—¶ï¼š</p><p>åªä¼šç»™æˆ‘ä»¬æ‰¾åˆ°800çš„é¦–åœ°å€ï¼Œè¿™æ˜¯ä¸€æ¬¡I&#x2F;Oè¯»å†™äº†</p><p>ä»800è¯»åˆ°832ä¸€å…±æ˜¯32æ¡è®°å½•ï¼š32&#x2F;8&#x3D;4ï¼ˆæ‰‡åŒºï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦è¿ç»­è¯»å–4ä¸ªæ‰‡åŒºæ‰å¯ä»¥æ‰¾åˆ°id &#x3D; 832è¿™æ¡è®°å½•ï¼Œè¿™å°±éœ€è¦4æ¬¡I&#x2F;O</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿æ˜¯æœ€åçš„æƒ…å†µï¼š1+4&#x3D;5ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦5æ¬¡I&#x2F;Oå°±å¯ä»¥æ‹¿åˆ°ä»»æ„çš„æ•°æ®äº†</p><p>æ¯”èµ·æ²¡æœ‰ç´¢å¼•çš„æŸ¥è¯¢ï¼šä»ç¬¬32æ¡è®°å½•å¼€å§‹ï¼Œå°±ä¼šæˆæ¯”ä¾‹çš„ä¸æ–­å¢å¤§è¯»å†™æ¬¡æ•°</p><p>æœ‰ç´¢å¼•çš„æƒ…å†µçš„æŸ¥è¯¢ï¼šæœ€åçš„æƒ…å†µä¹Ÿå°±5æ¬¡I&#x2F;Oæ“ä½œï¼Œä½†æ˜¯ç´¢å¼•éœ€è¦å•ç‹¬å­˜å‚¨ï¼Œæ€»çš„æ¥è¯´è¿˜æ˜¯åˆ©å¤§äºå¼Šï¼Œä¸å»ºè®®å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•çš„ç»´æŠ¤éœ€è¦å¼€é”€ï¼Œä¸€èˆ¬åªä¼šç»™ç»</p><p>å¸¸æŸ¥è¯¢ä¸”ä¸å¸¸æ›´æ”¹çš„æ•°æ®åšç´¢å¼•</p><p><strong>ç»§ç»­åŠ å¤§æ•°æ®ï¼Œè¿™æ¬¡å­˜æ”¾80000æ¡è®°å½•ï¼š</strong></p><p>å½“æ•°æ®é‡è¾¾åˆ°80000æ¡çš„æ—¶å€™ï¼šæˆ‘ä»¬çš„ä¸€çº§ç´¢å¼•è¡¨ï¼ˆç´§è´´å®é™…æ•°æ®è¡¨çš„ç´¢å¼•è¡¨è¢«ç§°ä¸ºä¸€çº§ç´¢å¼•ï¼‰å°±æ˜¾å¾—çš„å¾ˆä¹åŠ›äº†ï¼Œ</p><p>æˆ‘ä»¬ç®€å•çš„è®¡ç®—ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ä¸€çº§ç´¢å¼•è¡¨åªèƒ½å­˜æ”¾1~1025è®°å½•çš„åŒºé—´åœ°å€ï¼Œå½“æ•°æ®ä¸º80000</p><p>80000&#x2F;1024 &#x3D; 78~79ï¼Œæˆ‘ä»¬éœ€è¦79ä¸ªæ‰‡åŒºæ¥å­˜å‚¨</p><p>å¦‚æœæ˜¯æœ€åçš„æƒ…å†µï¼šæˆ‘ä»¬è¦æŸ¥æ‰¾ç¬¬80000æ¡è®°å½•ï¼Œé‚£ä¹ˆåœ¨ä¸€çº§ç´¢å¼•è¡¨ä¸­æˆ‘ä»¬å°±è¿›è¡Œäº†79æ¬¡I&#x2F;Oæ“ä½œäº†ï¼Œå†åŠ ä¸Šä¸€çº§ç´¢å¼•è¡¨å»æŸ¥å®é™…æ•°æ®çš„åœ°å€åˆæ˜¯4æ¬¡I&#x2F;Oï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹å°±æ˜¯79+4&#x3D;83æ¬¡I&#x2F;O</p><p>å¯¹äº80000æ¡æ•°æ®æŸ¥è¯¢å°±éœ€è¦83æ¬¡I&#x2F;Oï¼Œå¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªI&#x2F;Oæ¬¡æ•°å¤ªå¤šäº†ï¼Œæˆ‘ä»¬å¾—æƒ³åŠæ³•æŠŠI&#x2F;Oæ¬¡æ•°å‹ä¸‹å»</p><p> è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„å¼€å‘è€…æƒ³åˆ°çš„å°±æ˜¯åŠ ä¸€å±‚ï¼ŒäºŒçº§ç´¢å¼•æ¥æŒ‡å‘ä¸€çº§ç´¢å¼•ï¼Œä¸€çº§ç´¢å¼•æŒ‡å‘æ•°æ®ï¼Œå¯¹äºB+æ ‘ç»“æ„æ¥è¯´å°±æ˜¯å¤šäº†ä¸€å±‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/2846424-20230513131455394-112588750.png?raw=true" alt="2846424-20230513131455394-112588750"></p><p>åœ¨äºŒçº§ç´¢å¼•ä¸Šçš„adresså­—æ®µå°±æ˜¯è®°å½•çš„ä¸€çº§ç´¢å¼•çš„åœ°å€ï¼Œè€Œä¸ç›´æ¥æŒ‡å‘æ•°æ®ï¼Œåœ¨äºŒçº§ç´¢å¼•å°±æ˜¯è®°å½•ä¸€ä¸ªä¸€çº§æ‰‡åŒºçš„ä½ç½®</p><p>æ¯”å¦‚ï¼š</p><p>ä¸€çº§ç´¢å¼•ä¸€ä¸ªæ‰‡åŒºçš„æ•°æ®åŒºé—´åœ¨1~1025</p><p>äºŒçº§ç´¢å¼•ä¸€æ¡è®°å½•çš„å°±æ˜¯ä¸€çº§ç´¢å¼•åŒºé—´çš„1~1025</p><p> æ‰€ä»¥ä¸€ä¸ªäºŒçº§ç´¢å¼•æ‰‡åŒºå¯ä»¥è®°å½•ä¸€çº§ç´¢å¼•åŒºé—´çš„èŒƒå›´æ˜¯ï¼š</p><p>1024 * 32 &#x3D; 32768</p><p>å¯¹äºæœ‰80000æ¡è®°å½•çš„è¡¨ï¼ŒäºŒçº§ç´¢å¼•æ‰‡åŒºåªéœ€è¦3ä¸ªå°±å¯ä»¥æ”¾ä¸‹</p><p><strong>è¿™ä¸ªæ—¶å€™åˆ©ç”¨äºŒçº§ç´¢å¼•æŸ¥æ‰¾80000ï¼š</strong></p><p>1.é¦–å…ˆæˆ‘ä»¬è¦æ‰¾åˆ°80000è¿™ä¸ªåŒºé—´ï¼Œä»–åœ¨ç¬¬ä¸‰ä¸ªæ‰‡åŒºä¸Šï¼Œé‚£ä¹ˆåœ¨äºŒçº§ç´¢å¼•ä¸Šçš„I&#x2F;Oè¯»å†™å°±éœ€è¦ 3æ¬¡</p><p>ç„¶åå»ä¸€çº§ç´¢å¼•ä¸Šæ‰¾ï¼Œç”±äºæ˜¯äºŒçº§ç´¢å¼•æä¾›çš„ç‰©ç†åœ°å€ï¼Œåªéœ€è¦ä¸€æ¬¡I&#x2F;Oå°±å¯ä»¥è¯»å–åˆ°é‚£ä¸ªæ‰‡åŒºï¼Œä¸€çº§ç´¢å¼•ä¸Šæœ‰ä¸€ä¸ªåŒºé—´å°±æ˜¯80000~81025ï¼Œ</p><p>æœ€åå»æ‰¾å®é™…çš„æ•°æ®åˆšå¥½80000å°±æ˜¯å¤´æŒ‡é’ˆï¼Œä¹Ÿåªéœ€è¦ä¸€æ¬¡I&#x2F;Oå°±å¯ä»¥å®Œæˆ</p><p>è¿™æ˜¯æœ€å¥½çš„ä¸€ç§æƒ…å†µï¼š3+1+1&#x3D;5ï¼Œæœ€å¥½çš„çŠ¶æ€5æ¬¡I&#x2F;Oå°±å¯ä»¥æ‹¿åˆ°æ•°æ®äº†</p><p> 2.æœ€åçš„æƒ…å†µä¹Ÿæ˜¯å‡ºç°åœ¨ä¸€çº§ç´¢å¼•å»æ‰¾æ•°æ®ï¼šå°±æ˜¯80000~80033è¿™ä¸ªåŒºé—´</p><p>æˆ‘ä»¬è¦æ‰¾80032çš„æ—¶å€™ï¼Œåªèƒ½é€šè¿‡é¦–åœ°å€ä¸º80000çš„åœ°å€å»æ‰¾ï¼Œè¦è¿ç»­æŸ¥æ‰¾4ä¸ªæ‰‡åŒºï¼Œå°±æ˜¯4æ¬¡I&#x2F;Oæ“ä½œæ‰èƒ½æ‹¿åˆ°</p><p>3+1+4&#x3D;8</p><p>æ‰€ä»¥åœ¨B+æ ‘ä¸ŠåŠ äº†ä¸€å±‚ä»¥åæœ€åï¼Œä¸ç®¡ä»€ä¹ˆæƒ…å†µä¸‹ï¼ŒæŸ¥æ‰¾ä»»æ„æ•°æ®éƒ½åªéœ€è¦8æ¬¡I&#x2F;Oæ“ä½œï¼Œ</p><p>ç»¼ä¸Šï¼šæŸ¥æ‰¾80000æ¡æ•°æ®ï¼ˆæœ€åçš„æƒ…å†µï¼‰</p><p>a.æ²¡æœ‰ç´¢å¼•ï¼Œä¸€ä¸ªæ‰‡åŒºä¸€ä¸ªæ‰‡åŒºçš„æŸ¥æ‰¾ï¼Œ80000&#x2F;8 &#x3D; 10000ï¼Œæ²¡æœ‰ç´¢å¼•éœ€è¦10000æ¬¡I&#x2F;Oæ“ä½œ</p><p>b.ä¸€çº§ç´¢å¼•ï¼Œç”±äºç¬¬80000æ¡è®°å½•åœ¨æœ€åä¸€ä¸ªæ‰‡åŒºä¸Šï¼Œ80000&#x2F;1024 &#x3D; 79 ï¼Œä¸€çº§ç´¢å¼•éœ€è¦79æ¬¡I&#x2F;Oï¼Œåˆ©ç”¨ä¸€çº§ç´¢å¼•å»æŸ¥æ‰¾æ•°æ®4æ¬¡I&#x2F;Oï¼Œä¸€çº§ç´¢å¼•éœ€è¦83æ¬¡I&#x2F;Oæ“ä½œ</p><p>c.äºŒçº§ç´¢å¼•ï¼Œç”±äºç¬¬80000æ¡è®°å½•åœ¨æœ€åä¸€ä¸ªæ‰‡åŒºä¸Šï¼Œ80000 &#x2F; 32768 &#x3D; 3ï¼ŒäºŒçº§ç´¢å¼•éœ€è¦3æ¬¡I&#x2F;Oï¼Œåˆ©ç”¨äºŒçº§ç´¢å¼•çš„åŒºé—´åœ°å€å»æ‰¾ä¸€çº§ç´¢å¼•åªéœ€è¦1æ¬¡I&#x2F;Oï¼Œç„¶åä¸€çº§ç´¢å¼•å»æ‰¾æ•°æ®éœ€è¦4æ¬¡I&#x2F;Oï¼ŒäºŒçº§ç´¢å¼•æŸ¥æ‰¾æ•°æ®å°±åªéœ€è¦8æ¬¡I&#x2F;Oæ“ä½œ</p><p><strong>å¯èƒ½å¯¹åšå®¢ä¸­çš„ä¾‹å­å­˜åœ¨çš„ç–‘é—®ï¼š</strong></p><p>a.ç´¢å¼•è¡¨çš„åŒºé—´èŒƒå›´ä¸€å®šæ˜¯32å—ï¼Ÿ</p><p>ä¸æ˜¯ï¼Œè¦æ ¹æ®å¼€å‘äººå‘˜çš„é»˜è®¤è®¾ç½®ï¼Œæˆ–è€…åæœŸæ•°æ®åº“ç®¡ç†å‘˜å»è°ƒæ•´ï¼Œä¸€èˆ¬äººæ˜¯æ›´æ”¹ä¸äº†ç‰©ç†å­˜å‚¨çš„ï¼Œåªèƒ½äº†è§£åŸç†</p><p>b.ç´¢å¼•çš„è¡¨æ¯æ¡è®°å½•éƒ½æ˜¯16å­—èŠ‚å—ï¼Ÿ</p><p>ä¸æ˜¯ï¼Œè¦æ ¹æ®å»ºç«‹ç´¢å¼•å±æ€§çš„å¤§å°å’Œå®é™…ç‰©ç†åœ°å€å¤§å°è€Œå®šï¼Œä¸ä¸€å®šæ¯ä¸ªæ‰‡åŒºéƒ½èƒ½å­˜åˆšå¥½å­˜32æ¡ç´¢å¼•è®°å½•</p><p>c.800æ¡è®°å½•æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µçœŸçš„è¦100æ¬¡I&#x2F;Oæ“ä½œå—ï¼Ÿ</p><p>ä¸æ˜¯ï¼Œè¦æ ¹æ®ä¸€æ¬¡è¯»å–çš„é¡µé¢å¤§å°ï¼ŒMySqlçš„é»˜è®¤è¯»å–æ˜¯16KBï¼š16kb &#x2F; 64 &#x3D;250 æ¡è®°å½•ï¼Œä¸€èˆ¬çš„æŸ¥è¯¢ä¸€æ¬¡I&#x2F;Oè‡³å°‘å°±æ˜¯250æ¡è®°å½•ï¼Œ</p><p>æ ¹æ®è®¡ç®—æœºå±€éƒ¨æ€§åŸç†ï¼Œå½“ä¸€ä¸ªæ‰‡åŒºçš„æ•°æ®è¢«ä½¿ç”¨åï¼Œå®ƒå‘¨å›´çš„æ•°æ®ææœ‰å¯èƒ½å†æœ€è¿‘ä¼šè¢«ç”¨åˆ°ï¼Œæ‰€ä»¥mysqlçš„ç¼“å­˜æœºåˆ¶ä¼šæ”¯æŒä¸€æ¬¡æŸ¥è¯¢è¿”å›4é¡µï¼Œå³ä»æŸ¥è¯¢çš„å½“å‰çš„é¡µå¼€å§‹å¾€åç£å¤´ç§»åŠ¨4é¡µçš„å¤§å°ï¼Œ4*16&#x3D;64kb</p><p>ä¹Ÿå°±æ˜¯64kb &#x2F; 64 &#x3D; 100æ¡è®°å½•ï¼Œåœ¨ç¼“å­˜ä¸­æœ‰ä¸€æ¬¡I&#x2F;Oæ˜¯æœ‰100æ¡è®°å½•è¢«è¿”å›ï¼Œç„¶åæ€ä¹ˆæŸ¥è¯¢å°±æ˜¯InnoDBå¼•æ“æ‰€è¦äº†è§£çš„çŸ¥è¯†äº†</p><h2 id="3-MySqlä¸­B-æ ‘ç´¢å¼•å­˜å‚¨ç»“æ„çš„å½¢æˆ"><a href="#3-MySqlä¸­B-æ ‘ç´¢å¼•å­˜å‚¨ç»“æ„çš„å½¢æˆ" class="headerlink" title="3 MySqlä¸­B+æ ‘ç´¢å¼•å­˜å‚¨ç»“æ„çš„å½¢æˆ"></a>3 MySqlä¸­B+æ ‘ç´¢å¼•å­˜å‚¨ç»“æ„çš„å½¢æˆ</h2><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/2846424-20230513140022983-1295848335.png?raw=true" alt="2846424-20230513140022983-1295848335"></p><p>è¿™å°±æ˜¯ä¸€é¢—è¾ƒä¸ºå®Œæ•´çš„B+æ ‘äº†ï¼Œæˆ‘ä»¬åœ¨ä»”ç»†çš„çœ‹çœ‹å¯ä»¥å‘ç°B+æ ‘çš„ç‰¹å¾</p><p>a.ç´¢å¼•åŒºé—´ç”±æ ¹èŠ‚ç‚¹ä¸æ–­çš„å˜å°ï¼Œæè¿°æ•°æ®æ‰€åœ¨çš„æ‰‡åŒºä¹Ÿè¶Šæ¥è¶Šç»†åŒ–</p><p>b.æ ¹èŠ‚ç‚¹å­˜æ”¾çš„éƒ½æ˜¯ç´¢å¼•ï¼Œåªæœ‰æœ€ä¸‹é¢ä¸€å±‚çš„å­èŠ‚ç‚¹æ‰æ˜¯æ•°æ®</p><p>æˆ‘ä»¬çœ‹å®Œäº†B+æ ‘çš„å½¢æˆè¿‡ç¨‹ä»¥åŠå®ƒçš„å¤§è‡´æ¨¡å‹ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸æä¸€ä¸‹å®ƒå’ŒBæ ‘çš„åŒºåˆ«äº†ï¼Œè¿™æ˜¯æ›´æ·±äº†è§£B+æ ‘çš„å…³é”®ï¼Œ</p><p>ç°åœ¨å›¾ç‰‡ä¸Šæè¿°çš„B+æ ‘ï¼Œå…¶å®Bæ ‘æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†éƒ½èƒ½åšåˆ°ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«å§</p><h3 id="Bæ ‘å’ŒB-æ ‘çš„åŒºåˆ«ï¼ˆä¸»è¦çš„åŒºåˆ«ï¼‰"><a href="#Bæ ‘å’ŒB-æ ‘çš„åŒºåˆ«ï¼ˆä¸»è¦çš„åŒºåˆ«ï¼‰" class="headerlink" title="Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«ï¼ˆä¸»è¦çš„åŒºåˆ«ï¼‰"></a><strong>Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«ï¼ˆä¸»è¦çš„åŒºåˆ«ï¼‰</strong></h3><h4 id="åŒºåˆ«1ï¼š"><a href="#åŒºåˆ«1ï¼š" class="headerlink" title="åŒºåˆ«1ï¼š"></a><strong>åŒºåˆ«1ï¼š</strong></h4><p>Bæ ‘çš„åœ¨æ ¹èŠ‚ç‚¹ä¹Ÿå­˜æœ‰æ•°æ®ï¼Œç„¶åæ ¹èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®åˆæ˜¯ç´¢å¼•ï¼Œåˆæ˜¯æ•°æ®</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/2846424-20230513142254511-1038566211.png?raw=true" alt="2846424-20230513142254511-1038566211"></p><p> å¦‚å›¾ï¼Œåœ¨ç´¢å¼•ä¸Šå‡ºç°çš„æ•°æ®å°±ä¸ä¼šåœ¨å­èŠ‚ç‚¹å‡ºç°äº†</p><p>å¯ä»¥è¯´çˆ¶èŠ‚ç‚¹å¯èƒ½æ—¢æœ‰ç´¢å¼•åˆæœ‰æ•°æ®ï¼Œè¿™å°±æ˜¯Bæ ‘çš„å­˜å‚¨æ–¹å¼</p><p>B+æ ‘æ ¹èŠ‚ç‚¹æ²¡æœ‰æ•°æ®ï¼Œåªå­˜æ”¾ç´¢å¼•</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/2846424-20230513143219545-2067039685.png?raw=true" alt="2846424-20230513143219545-2067039685"></p><p> å¦‚å›¾ï¼Œæ•°æ®éƒ½åœ¨æœ€ä¸‹é¢ä¸€å±‚çš„å­èŠ‚ç‚¹ä¸Šï¼Œé™¤äº†è¿™ä¸€å±‚ä»¥å¤–çš„çˆ¶èŠ‚ç‚¹å…¨æ˜¯ç´¢å¼•æ²¡æœ‰æ•°æ®</p><p>Bæ ‘ï¼Œå­˜åœ¨ä¸€ç§æƒ…å†µå°±æ˜¯æ‰€æŸ¥çš„æ•°æ®åœ¨æœ€ä¸Šå±‚ï¼Œå› ä¸ºèŠ‚ç‚¹æœ‰æ•°æ®å¯èƒ½ç¬¬80000æ¡è®°å½•åœ¨æœ€ä¸Šå±‚åŒºé—´ä¸Šï¼Œæ‰€ä»¥ä¸€æ¬¡I&#x2F;Oå°±å¯ä»¥æ‹¿åˆ°æ•°æ®ï¼Œæœ€åçš„æƒ…å†µå°±å’ŒB+æ ‘ä¸€æ ·ï¼Œè¦åˆ°æœ€åä¸€å±‚æ‰èƒ½æ‹¿åˆ°æ•°æ®</p><p>B+æ ‘ï¼Œæ¯æ¬¡æ‹¿æ•°æ®éƒ½éœ€è¦åœ¨æœ€ä¸‹ä¸€å±‚å»æ‹¿ï¼Œå³ä½¿æˆ‘ä»¬å»æ‹¿ä¸€ä¸ªè¡¨çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œå®ƒä¹Ÿä¼šä»æ ¹ç»“ç‚¹ä¸€çº§ä¸€çº§çš„å¾€ä¸‹ç›´åˆ°æœ€åä¸€å±‚æ‰æœ‰æ•°æ®</p><p>æ„Ÿè§‰æœ‰æ—¶å€™Bæ ‘æ¯”B+æ ‘å¿«å•Šï¼Œä¸ºä»€ä¹ˆMySqlè¦ç”¨B+æ ‘å‘¢ï¼Ÿ</p><p>å› ä¸ºB+æ ‘çš„æŸ¥è¯¢æ¯”Bæ ‘æ›´åŠ ç¨³å®šï¼Œæœ‰åˆ©äºå¼€å‘è€…ï¼Œæ•°æ®åº“ç®¡ç†å‘˜å¯¹å…¶è¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼Œè¿è¡Œæ—¶æ—¥å¿—æ£€æµ‹çš„æ•°æ®ä¹Ÿä¼šå¾ˆå‡†ç¡®</p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå°±ä»¥ä¸Šé¢ä¸¤å¼ å›¾ç‰‡ï¼šæˆ‘ä»¬è¦æŸ¥è¯¢ç¬¬7æ¡æ•°æ®å’Œç¬¬8æ¡æ•°æ®ï¼Œè¿™ä¸¤æ¡è®°å½•æ˜¯ç´§æŒ¨ç€çš„</p><p>ä½¿ç”¨Bæ ‘æŸ¥è¯¢ï¼š</p><p>ç¬¬ä¸ƒæ¡è®°å½•ï¼š1æ¬¡I&#x2F;O</p><p>ç¬¬å…«æ¡è®°å½•ï¼š2æ¬¡I&#x2F;O</p><p>ä½¿ç”¨B+æ ‘æŸ¥è¯¢ï¼š</p><p>ç¬¬ä¸ƒæ¡è®°å½•ï¼š2æ¬¡I&#x2F;O</p><p>ç¬¬å…«æ¡è®°å½•ï¼š2æ¬¡I&#x2F;O</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨Bæ ‘çš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢éœ€è¦1æ¬¡I&#x2F;Oï¼Œç¬¬äºŒä¸ªéœ€è¦2æ¬¡I&#x2F;Oï¼ŒB+æ ‘åˆ™éƒ½éœ€è¦ä¸¤æ¬¡</p><p>è¿™å°±å¾ˆæ˜æ˜¾é˜¿å¯ä»¥çœ‹å‡ºBæ ‘çš„æŸ¥è¯¢æ•ˆç‡å¾ˆä¸ç¨³å®šï¼Œå°¤å…¶æ˜¯å±‚æ•°å˜å¤šï¼Œæ•°æ®åŒºé—´å˜å¾—çš„æ—¶å€™ï¼Œå°±æ›´åŠ æ˜æ˜¾</p><h4 id="åŒºåˆ«2"><a href="#åŒºåˆ«2" class="headerlink" title="åŒºåˆ«2"></a><strong>åŒºåˆ«2</strong></h4><p>è¿™ä¸ªåŒºåˆ«æ˜¯B+æ ‘ç‰¹æœ‰çš„ï¼Œ</p><p>åœ¨Bæ ‘ä¸Šå­èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹æ˜¯ç›¸äº’éš”ç¦»å¼€çš„ï¼Œç°åœ¨æˆ‘ä»¬æ„é€ ä¸€ç§æƒ…å†µï¼ŒBæ ‘ä¸­æˆ‘ä»¬ä¸€æ¡æŸ¥è¯¢è¯­å¥éœ€è¦æŸ¥è¯¢ä¸¤æ¡è®°å½•ï¼Œ</p><p>æ¯”å¦‚  id &#x3D; 6  and id &#x3D; 8</p><p>ç”±äºè¿™æ˜¯ä¸€æ¡æŸ¥è¯¢è¯­å¥ï¼Œæ‰€ä»¥è¦ä¸€èµ·æ‰§è¡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Œæˆ‘ä»¬çš„ç£å¤´ä¼šå…ˆç§»åŠ¨åˆ°æ ¹èŠ‚ç‚¹è¿›è¡Œå®šä½ï¼Œç„¶åå°±å¯ä»¥id &#x3D; 6è¿™æ¡è®°å½•ï¼Œç„¶åä»æ–°å»æ ¹èŠ‚ç‚¹æŸ¥ç´¢å¼•ï¼Œç£å¤´å†å®š</p><p>ä½åˆ° id &#x3D; 8 è¿™æ¡è®°å½•</p><p>å¾ˆæ˜¾ç„¶æˆ‘ä»¬çš„Bæ ‘æŸ¥è¯¢è¿›è¡Œäº†ä¸¤æ¬¡ç£å¤´å®šä½ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨è¯»å†™ç£ç›˜æ—¶ï¼Œæœ€å¤§çš„å¼€é”€å°±æ˜¯ç£å¤´çš„å®šä½ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°½é‡å°‘çš„è¿›è¡Œç£å¤´å®šä½</p><p>æ‰€ä»¥ï¼ŒB+æ ‘åœ¨æœ€åä¸€å±‚çš„æ•°æ®ç»“ç‚¹ä¸Šéƒ½åŠ äº†æŒ‡é’ˆï¼ˆæŒ‡å‘çš„æ˜¯ç‰©ç†åœ°å€ï¼‰ï¼Œè®©å®ƒæŒ‡å‘ä¸‹ä¸€ä¸ªåŒºé—´çš„å¼€å§‹ä½ç½®ï¼ŒæŠŠå°¾éƒ¨çš„æ•°æ®åˆä¸²èµ·æ¥äº†ï¼Œå°±æ˜¯ä¸“é—¨å¯¹ä»˜è¿™ç§ç›¸é‚»åŒºé—´è¦é‡å¤ç£å¤´å®šä½çš„æƒ…å†µ</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/2846424-20230513151547063-131791169.png?raw=true" alt="2846424-20230513151547063-131791169"></p><p>æœ‰äº†è¿™ä¸ªå°¾éƒ¨æŒ‡é’ˆï¼Œæˆ‘ä»¬åœ¨ç”¨B+æ ‘å»æŸ¥æ‰¾ id &#x3D;6 å’Œ id &#x3D; 8çš„è®°å½•ï¼Œå½“ç»è¿‡ä¸€æ¬¡ç£å¤´å®šä½ä»¥åæ‰¾åˆ°äº†id &#x3D; 6 çš„è®°å½•ï¼Œå®ƒä¼šæ ¹æ®å°¾æŒ‡é’ˆç›´æ¥è¯»å– id &#x3D; 8çš„è®°å½•ï¼ŒåŠ å¿«äº†ç›¸é‚»æ‰‡æˆ–å‡ ä¸ªç›¸é‚»æ‰‡åŒºçš„è¯»å†™é€Ÿåº¦</p><h2 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4 æ€»ç»“"></a>4 æ€»ç»“</h2><p>åœ¨ B+æ ‘ä¸­ï¼ŒæŸ¥è¯¢ç›¸éš”å¤šä¸ªæ•°æ®é¡µçš„æ•°æ®æ—¶ï¼Œä¸€æ—¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ•°æ®é¡µï¼Œåç»­æŸ¥è¯¢é€šå¸¸ä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ã€‚è¿™æ˜¯å› ä¸º B+æ ‘çš„å¶å­èŠ‚ç‚¹ï¼ˆæ•°æ®é¡µï¼‰ä¹‹é—´é€šè¿‡åŒå‘é“¾æ¥ç›¸è¿ï¼Œä½¿å¾—å¯ä»¥ç›´æ¥ä»ä¸€ä¸ªå¶å­èŠ‚ç‚¹è·³è½¬åˆ°ç›¸é‚»çš„å¶å­èŠ‚ç‚¹ã€‚è¿™æ„å‘³ç€ä»ç¬¬ä¸€ä¸ªæ•°æ®é¡µå¼€å§‹ï¼Œå¯ä»¥ç›´æ¥éå†åˆ°ç¬¬äºŒä¸ªæ•°æ®é¡µï¼Œè€Œæ— éœ€å†æ¬¡ä»æ ¹èŠ‚ç‚¹å¼€å§‹ã€‚</p><p><strong>æŸ¥è¯¢æµç¨‹</strong></p><ol><li><strong>æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ•°æ®é¡µ</strong>ï¼š<ul><li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå† B+æ ‘ï¼Œä½¿ç”¨ç´¢å¼•é”®å€¼æ¥å®šä½åˆ°åŒ…å«ç›®æ ‡æ•°æ®çš„ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆæ•°æ®é¡µï¼‰ã€‚</li></ul></li><li><strong>è®¿é—®ç¬¬äºŒä¸ªæ•°æ®é¡µ</strong>ï¼š<ul><li>ä¸€æ—¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ•°æ®é¡µï¼Œå¯ä»¥ç›´æ¥é€šè¿‡è¯¥æ•°æ®é¡µä¸ç›¸é‚»å¶å­èŠ‚ç‚¹ä¹‹é—´çš„é“¾æ¥æ¥è®¿é—®ç¬¬äºŒä¸ªæ•°æ®é¡µã€‚</li><li>ä¸éœ€è¦å†æ¬¡ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå† B+æ ‘ã€‚</li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlä½¿ç”¨</title>
    <link href="/2024/12/10/tools/Mysql%E8%AF%AD%E5%8F%A5/"/>
    <url>/2024/12/10/tools/Mysql%E8%AF%AD%E5%8F%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="Mysqlç”¨æ³•"><a href="#Mysqlç”¨æ³•" class="headerlink" title="Mysqlç”¨æ³•"></a>Mysqlç”¨æ³•</h1><h2 id="1ã€æŸ¥è¯¢ç›¸å…³"><a href="#1ã€æŸ¥è¯¢ç›¸å…³" class="headerlink" title="1ã€æŸ¥è¯¢ç›¸å…³"></a>1ã€<code>æŸ¥è¯¢ç›¸å…³</code></h2><hr><p><strong>ä½¿ç”¨likeå…³é”®å­—è¿›è¡Œæ¨¡ç³ŠåŒ¹é…:</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">column</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27; %pattern%&#x27;</span>;<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒæŸ¥è¯¢:</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">column</span> regexp <span class="hljs-string">&#x27;pattern&#x27;</span>;<br></code></pre></td></tr></table></figure><p><strong>å­æŸ¥è¯¢ï¼ˆNested Queriesï¼‰</strong></p><p>å­æŸ¥è¯¢å…è®¸ä½ å°†ä¸€ä¸ªæŸ¥è¯¢çš„ç»“æœä½œä¸ºå¦ä¸€ä¸ªæŸ¥è¯¢çš„æ¡ä»¶ã€‚ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾è®¢å•é‡‘é¢å¤§äºå¹³å‡è®¢å•é‡‘é¢çš„è®¢å•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Orders<br><span class="hljs-keyword">WHERE</span> OrderAmount <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(OrderAmount) <span class="hljs-keyword">FROM</span> Orders);<br></code></pre></td></tr></table></figure><p><strong>è”æ¥æŸ¥è¯¢ï¼ˆJOINsï¼‰</strong></p><p><strong>student</strong> :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">---------------------- student-----------------------</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>id <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment,<br>name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>sex <span class="hljs-type">char</span>(<span class="hljs-number">1</span>),<br>submission_date <span class="hljs-type">date</span>,<br><span class="hljs-keyword">primary</span> key(id))engine<span class="hljs-operator">=</span>innodb <span class="hljs-type">character</span> <span class="hljs-keyword">set</span> utf8;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student (name, sex, submission_date)<br><span class="hljs-keyword">VALUES</span><br>    (&quot;å¼ ä¸‰&quot;, &quot;ç”·&quot;, &quot;2010-10-10&quot;),<br>    (&quot;æå››&quot;, &quot;ç”·&quot;, &quot;2010-10-10&quot;),<br>    (&quot;ç‹äº”&quot;, &quot;ç”·&quot;, &quot;2010-10-10&quot;),<br>    (&quot;èµµå…­&quot;, &quot;ç”·&quot;, &quot;2010-10-10&quot;),<br>    (&quot;å­™ä¸ƒ&quot;, &quot;ç”·&quot;, &quot;2010-10-10&quot;);<br></code></pre></td></tr></table></figure><table><thead><tr><th align="center">id</th><th align="center">name</th><th align="center">sex</th><th align="center">submission_date</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">å¼ ä¸‰</td><td align="center">ç”·</td><td align="center">2010-10-10</td></tr><tr><td align="center">2</td><td align="center">æå››</td><td align="center">ç”·</td><td align="center">2010-10-10</td></tr><tr><td align="center">3</td><td align="center">ç‹äº”</td><td align="center">ç”·</td><td align="center">2010-10-10</td></tr><tr><td align="center">4</td><td align="center">èµµå…­</td><td align="center">ç”·</td><td align="center">2010-10-10</td></tr><tr><td align="center">5</td><td align="center">å­™ä¸ƒ</td><td align="center">ç”·</td><td align="center">2010-10-10</td></tr></tbody></table><p><strong>grade</strong>:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">------------------- grade-------------</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> grade(<br>id <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment,<br>stuid <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>class <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>grade <span class="hljs-type">int</span>(<span class="hljs-number">3</span>),<br><span class="hljs-keyword">primary</span> key(id))engine<span class="hljs-operator">=</span>innodb <span class="hljs-type">character</span> <span class="hljs-keyword">set</span> utf8;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student (name, sex, submission_date)<br><span class="hljs-keyword">VALUES</span><br>    (&quot;å¼ ä¸‰&quot;, &quot;ç”·&quot;, &quot;2010-10-10&quot;),<br>    (&quot;æå››&quot;, &quot;ç”·&quot;, &quot;2010-10-10&quot;),<br>    (&quot;ç‹äº”&quot;, &quot;ç”·&quot;, &quot;2010-10-10&quot;),<br>    (&quot;èµµå…­&quot;, &quot;ç”·&quot;, &quot;2010-10-10&quot;),<br>    (&quot;å­™ä¸ƒ&quot;, &quot;ç”·&quot;, &quot;2010-10-10&quot;);<br></code></pre></td></tr></table></figure><table><thead><tr><th align="center">id</th><th align="center">stuid</th><th align="center">class</th><th align="center">grade</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">1</td><td align="center">è®¡ç®—æœº</td><td align="center">100</td></tr><tr><td align="center">2</td><td align="center">1</td><td align="center">guitar</td><td align="center">90</td></tr><tr><td align="center">3</td><td align="center">1</td><td align="center">ç¾æœ¯</td><td align="center">80</td></tr><tr><td align="center">4</td><td align="center">2</td><td align="center">ç¾æœ¯</td><td align="center">80</td></tr><tr><td align="center">5</td><td align="center">2</td><td align="center">è®¡ç®—æœº</td><td align="center">70</td></tr><tr><td align="center">6</td><td align="center">2</td><td align="center">guitar</td><td align="center">60</td></tr><tr><td align="center">7</td><td align="center">3</td><td align="center">guitar</td><td align="center">50</td></tr></tbody></table><p><strong>æŸ¥è¯¢æ¯ä¸ªå­¦ç”Ÿçš„æ€»æˆç»©</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(grade),stuid <span class="hljs-keyword">from</span> grade <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> stuid;# æŸ¥è¯¢æ€»æˆç»©<br><br><span class="hljs-keyword">select</span> stuid,<span class="hljs-built_in">avg</span>(grade) <span class="hljs-keyword">from</span> grade <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> stuid;# æŸ¥è¯¢å¹³å‡æˆç»©<br></code></pre></td></tr></table></figure><p><strong>å¤šè¡¨æŸ¥è¯¢</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> a.name,<span class="hljs-built_in">sum</span>(grade) <span class="hljs-keyword">from</span> student a,grade b <span class="hljs-keyword">where</span> a.id <span class="hljs-operator">=</span> b.stuid <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> b.stuid;<br></code></pre></td></tr></table></figure><p><strong>å†…è¿æ¥</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> a.name,<span class="hljs-built_in">sum</span>(grade) <span class="hljs-keyword">from</span> student a <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> grade b <span class="hljs-keyword">on</span> a.id <span class="hljs-operator">=</span> b.stuid <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> b.stuid;<br><br># å¯¹æ¯”ç›´æ¥å¤šè¡¨æŸ¥è¯¢ï¼ˆéšå¼è¿æ¥ï¼‰å¥½å¤„<br>## <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> æ˜ç¡®æŒ‡å‡ºäº†è¿æ¥æ¡ä»¶ï¼Œä½¿å¾—æŸ¥è¯¢æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚<br>## ä»¥è½»æ¾åœ°æ·»åŠ æ›´å¤šçš„ <span class="hljs-keyword">JOIN</span> å­å¥æ¥è¿æ¥æ›´å¤šè¡¨ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„ <span class="hljs-keyword">WHERE</span> å­å¥ã€‚<br>## ä½¿ç”¨ <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> å¯ä»¥å¸®åŠ©æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–å™¨æ›´å¥½åœ°ç†è§£æŸ¥è¯¢æ„å›¾ï¼Œä»è€Œé€‰æ‹©æ›´é«˜æ•ˆçš„æ‰§è¡Œè®¡åˆ’ã€‚æ˜¾å¼è¿æ¥æ¡ä»¶å¯ä»¥å¸®åŠ©ä¼˜åŒ–å™¨ç¡®å®šå“ªäº›ç´¢å¼•å¯ä»¥è¢«åˆ©ç”¨ã€‚<br></code></pre></td></tr></table></figure><p><strong>å·¦è”æ¥ï¼ˆLEFT JOINï¼‰</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student a <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> grade b <span class="hljs-keyword">on</span> a.id <span class="hljs-operator">=</span>b.stuid <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> b.stuid;<br><br># aè¡¨çš„idåœ¨bè¡¨çš„stuidå‡ºç°çš„è¯æ˜¾ç¤ºç›¸å…³bè¡¨æ•°æ®ï¼Œè‹¥ä¸å‡ºç°åœ¨bè¡¨ï¼Œåˆ™ç›¸å…³bè¡¨çš„æ•°æ®åˆ—æ˜¾ç¤ºnull.<br></code></pre></td></tr></table></figure><p><strong>å³è¿æ¥(RIGHT JOIN)</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student a  <span class="hljs-keyword">right</span> <span class="hljs-keyword">join</span> grade b <span class="hljs-keyword">on</span> a.id<span class="hljs-operator">=</span>b.stuid <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a.id; <br><br># bè¡¨çš„stuidåœ¨aè¡¨çš„idå‡ºç°çš„è¯æ˜¾ç¤ºç›¸å…³aè¡¨æ•°æ®ï¼Œè‹¥ä¸å‡ºç°åœ¨aè¡¨ï¼Œåˆ™ç›¸å…³aè¡¨çš„æ•°æ®åˆ—æ˜¾ç¤º<span class="hljs-keyword">null</span><br></code></pre></td></tr></table></figure><h3 id="union-allå’Œunionçš„åŒºåˆ«"><a href="#union-allå’Œunionçš„åŒºåˆ«" class="headerlink" title="union allå’Œunionçš„åŒºåˆ«"></a>union allå’Œunionçš„åŒºåˆ«</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>ï¼šç”¨äºåˆå¹¶å¤šä¸ªæŸ¥è¯¢ç»“æœï¼ŒåŒ…æ‹¬é‡å¤çš„è¡Œã€‚<br><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> student <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> stuid <span class="hljs-keyword">from</span> grade;<br><br><br><span class="hljs-keyword">UNION</span>ï¼šç”¨äºåˆå¹¶å¤šä¸ªæŸ¥è¯¢ç»“æœï¼Œå¹¶ä¸”è‡ªåŠ¨å»é™¤é‡å¤çš„è¡Œã€‚<br><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> student <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> stuid <span class="hljs-keyword">from</span> grade;<br></code></pre></td></tr></table></figure><h2 id="2ã€æ•°æ®ç±»å‹"><a href="#2ã€æ•°æ®ç±»å‹" class="headerlink" title="2ã€æ•°æ®ç±»å‹"></a>2ã€æ•°æ®ç±»å‹</h2><hr><p><strong>longtexç±»å‹</strong></p><p>â€œLONGTEXTâ€æ•°æ®ç±»å‹æ˜¯ä¸€ç§æ¯”è¾ƒå¤§çš„æ–‡æœ¬ç±»å‹ï¼Œå¯ä»¥å®¹çº³æœ€å¤§é•¿åº¦ä¸º4 GBçš„å­—ç¬¦æ•°æ®ã€‚</p><p><strong>jsonç±»å‹</strong></p><ol><li>MySQL 5.7åŠæ›´æ—©ç‰ˆæœ¬ï¼š<ul><li>æœ€å¤§å­˜å‚¨å®¹é‡ä¸º64KBã€‚</li></ul></li><li>MySQL 8.0ï¼š<ul><li>æœ€å¤§å­˜å‚¨å®¹é‡ä¸º4GB</li></ul></li></ol><p>ä½¿ç”¨longtextå­—æ®µå­˜å‚¨JSONæˆ–å…¶ä»–ç»“æ„åŒ–æ•°æ®å­˜åœ¨ä¸€äº›æ½œåœ¨çš„é—®é¢˜:</p><ol><li>ä¸ä¾¿äºç´¢å¼•å’ŒæŸ¥è¯¢ã€‚longtextæ˜¯éç»“æ„åŒ–æ–‡æœ¬,ä¸èƒ½å»ºç«‹ç´¢å¼•,ä¸ä¾¿äºé€šè¿‡ç»“æ„åŒ–å­—æ®µè¿›è¡Œç²¾ç¡®æˆ–èŒƒå›´æŸ¥è¯¢ã€‚</li><li>æ€§èƒ½å¯èƒ½å—å½±å“ã€‚å’Œç›´æ¥ä½¿ç”¨jsonæ•°æ®ç±»å‹ç›¸æ¯”,ä»longtextä¸­æå–JSONéœ€è¦é¢å¤–çš„è§£ææ­¥éª¤,å¯èƒ½å½±å“æŸ¥è¯¢æ€§èƒ½ã€‚</li><li>æ— æ³•æ ¡éªŒæ•°æ®æ ¼å¼ã€‚longtextä¸­å­˜å‚¨çš„å†…å®¹æ— æ³•æ ¡éªŒæ˜¯å¦ç¬¦åˆJSONè§„èŒƒ,å®¹æ˜“å‡ºç°æ ¼å¼é”™è¯¯æ— æ³•è§£æçš„æƒ…å†µã€‚</li><li>å¯è¯»æ€§å·®ã€‚ä¸ä¸“é—¨çš„JSONå­—æ®µç›¸æ¯”,ç›´æ¥æŸ¥çœ‹longtextå†…å®¹æ— æ³•æ¸…æ™°çœ‹å‡ºç»“æ„ã€‚</li><li>å­˜å‚¨åˆ©ç”¨ç‡ä½ã€‚JSONæ•°æ®æœ¬èº«å°±å¾ˆâ€œç´§å‡‘â€,ä½¿ç”¨longtextå¯èƒ½å­˜åœ¨ç©ºé—´æµªè´¹ã€‚</li><li>ä¸åˆ©äºæ•°æ®éš”ç¦»ã€‚å¤šä¸ªæ–‡æ¡£é€šå¸¸éœ€è¦ä½¿ç”¨åˆ†éš”ç¬¦éš”ç¦»,å¢åŠ è§£æå¤æ‚æ€§ã€‚</li><li>åç»­éš¾æ‰©å±•ã€‚å¦‚æœéœ€è¦ä½¿ç”¨æ›´å¤šJSONåŠŸèƒ½,å°±éœ€è¦è¿ç§»æ•°æ®æ ¼å¼ã€‚</li></ol><p><strong>å¦‚æœæ¡ä»¶å…è®¸, strongerçš„åšæ³•æ˜¯ç›´æ¥ä½¿ç”¨jsonæ•°æ®ç±»å‹æ¥å­˜å‚¨å’Œå¤„ç†JSONå†…å®¹ã€‚</strong></p><p><strong>æ•´æ•°ç±»å‹</strong></p><ul><li>TINYINT: tinyintç±»å‹ç”¨äºå­˜å‚¨èŒƒå›´åœ¨-128åˆ°127ä¹‹é—´çš„æ•´æ•°ã€‚å®ƒå 1ä¸ªå­—èŠ‚ã€‚</li><li>SMALLINT:smallintç±»å‹ç”¨äºå­˜å‚¨èŒƒå›´åœ¨-32768åˆ°32767ä¹‹é—´çš„æ•´æ•°ã€‚å®ƒå 2ä¸ªå­—èŠ‚ã€‚</li><li>MEDIUMINT:mediumintç±»å‹ç”¨äºå­˜å‚¨èŒƒå›´åœ¨-8388608åˆ°8388607ä¹‹é—´çš„æ•´æ•°ã€‚å®ƒå 3ä¸ªå­—èŠ‚ã€‚</li><li>INT:intç±»å‹ç”¨äºå­˜å‚¨èŒƒå›´åœ¨-2147483648åˆ°2147483647ä¹‹é—´çš„æ•´æ•°ã€‚å®ƒå 4ä¸ªå­—èŠ‚ã€‚</li><li>BIGINT:bigintç±»å‹ç”¨äºå­˜å‚¨èŒƒå›´åœ¨-9,223,372,036,854,775,808åˆ°9,223,372,036,854,775,807ä¹‹é—´çš„æ•´æ•°ã€‚å®ƒå 8ä¸ªå­—èŠ‚ã€‚</li></ul><h2 id="3ã€å‡½æ•°"><a href="#3ã€å‡½æ•°" class="headerlink" title="3ã€å‡½æ•°"></a>3ã€å‡½æ•°</h2><hr><p><strong>JSON_EXTRACT</strong></p><p>JSON_EXTRACTå‡½æ•°ç”¨äºä»JSONç±»å‹å­—æ®µæˆ–å˜é‡ä¸­æå–æ•°æ®,å®ƒçš„è¯­æ³•å½¢å¼ä¸º:</p><p>JSON_EXTRACT(json_doc, path)</p><p>å‚æ•°è¯´æ˜:</p><ul><li>json_doc: JSONç±»å‹å­—æ®µæˆ–å˜é‡,å¯ä»¥æ˜¯é•¿æ–‡æœ¬ã€VARCHARç­‰ç±»å‹ã€‚</li><li>path: JSONè·¯å¾„è¡¨è¾¾å¼,ä½¿ç”¨ç‚¹å·.æŒ‡å®šæ¯ä¸ªå±‚çº§,ç”¨é€šé…ç¬¦*åŒ¹é…å¤šå±‚ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"># å¦‚æœéœ€è¦æŸ¥å‡ºæ•´è¡Œæ•°æ®,å¯ä»¥åœ¨<span class="hljs-keyword">SELECT</span>å’Œ<span class="hljs-keyword">WHERE</span>ä¸­ä½¿ç”¨:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span><br><span class="hljs-keyword">WHERE</span> JSON_EXTRACT(metadata, <span class="hljs-string">&#x27;$.fields[0].fieldPath&#x27;</span>) <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;id&#x27;</span><br><br># å•ç‹¬æ‰§è¡ŒJSON_EXTRACTè¯­å¥,ç›´æ¥è·å–å­—æ®µå€¼:<br><span class="hljs-keyword">SELECT</span> JSON_EXTRACT(metadata, <span class="hljs-string">&#x27;$.fields[0].fieldPath&#x27;</span>) <br><span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span><br></code></pre></td></tr></table></figure><p><strong>å¸¸ç”¨å‡½æ•°</strong></p><table><thead><tr><th>ç±»åˆ«</th><th>å‡½æ•°å</th><th>æè¿°</th></tr></thead><tbody><tr><td>å­—ç¬¦ä¸²å‡½æ•°</td><td><code>CHAR_LENGTH(str)</code></td><td>è¿”å›å­—ç¬¦ä¸² <code>str</code> çš„é•¿åº¦ï¼ˆä»¥å­—ç¬¦ä¸ºå•ä½ï¼‰ã€‚</td></tr><tr><td></td><td><code>CONCAT(str1, str2, ...)</code></td><td>è¿æ¥ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²ã€‚</td></tr><tr><td></td><td><code>LOWER(str)</code></td><td>å°†å­—ç¬¦ä¸² <code>str</code> è½¬æ¢ä¸ºå°å†™ã€‚</td></tr><tr><td></td><td><code>UPPER(str)</code></td><td>å°†å­—ç¬¦ä¸² <code>str</code> è½¬æ¢ä¸ºå¤§å†™ã€‚</td></tr><tr><td></td><td><code>SUBSTRING(str, start, len)</code></td><td>è¿”å›ä»ä½ç½® <code>start</code> å¼€å§‹çš„ <code>len</code> ä¸ªå­—ç¬¦ã€‚</td></tr><tr><td></td><td><code>REPLACE(str, find_str, replace_str)</code></td><td>æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„å­ä¸²ã€‚</td></tr><tr><td>æ•°å­¦å‡½æ•°</td><td><code>ABS(X)</code></td><td>è¿”å› <code>X</code> çš„ç»å¯¹å€¼ã€‚</td></tr><tr><td></td><td><code>POW(X, Y)</code></td><td>è¿”å› <code>X</code> çš„ <code>Y</code> æ¬¡å¹‚ã€‚</td></tr><tr><td></td><td><code>RAND()</code></td><td>è¿”å›ä¸€ä¸ªéšæœºæ•°ã€‚</td></tr><tr><td></td><td><code>ROUND(X, D)</code></td><td>è¿”å› <code>X</code> å››èˆäº”å…¥åˆ° <code>D</code> ä½å°æ•°çš„ç»“æœã€‚</td></tr><tr><td>æ—¥æœŸæ—¶é—´å‡½æ•°</td><td><code>NOW()</code></td><td>è¿”å›å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ã€‚</td></tr><tr><td></td><td><code>CURDATE()</code></td><td>è¿”å›å½“å‰çš„æ—¥æœŸã€‚</td></tr><tr><td></td><td><code>CURTIME()</code></td><td>è¿”å›å½“å‰çš„æ—¶é—´ã€‚</td></tr><tr><td></td><td><code>DATE_ADD(date, INTERVAL expr unit)</code></td><td>æ·»åŠ æ—¶é—´é—´éš”ã€‚</td></tr><tr><td></td><td><code>TIMESTAMPDIFF(unit, datetime1, datetime2)</code></td><td>è®¡ç®—æ—¶é—´å·®ã€‚</td></tr><tr><td></td><td><code>FROM_UNIXTIME(unix_timestamp)</code></td><td>è¿”å›datetimeæ—¶é—´æˆ³</td></tr><tr><td></td><td><code>UNIX_TIMESTAMP(datetime)</code></td><td>è¿”å›unixæ—¶é—´æˆ³</td></tr><tr><td>æ§åˆ¶æµå‡½æ•°</td><td><code>IF(condition, then, else)</code></td><td>æ ¹æ®æ¡ä»¶è¿”å›ä¸åŒå€¼ã€‚</td></tr><tr><td></td><td><code>CASE</code></td><td>æ ¹æ®å¤šä¸ªæ¡ä»¶è¿”å›ä¸åŒå€¼ã€‚</td></tr><tr><td></td><td><code>COALESCE(expr1, expr2, ...)</code></td><td>è¿”å›ç¬¬ä¸€ä¸ªéç©ºè¡¨è¾¾å¼çš„å€¼ã€‚</td></tr><tr><td>åŠ å¯†è§£å¯†å‡½æ•°</td><td><code>ENCODE(str, key_str)</code></td><td>ä½¿ç”¨ <code>key_str</code> å¯¹ <code>str</code> è¿›è¡Œç¼–ç ã€‚</td></tr><tr><td></td><td><code>DECODE(str, key_str)</code></td><td>ä½¿ç”¨ <code>key_str</code> å¯¹ <code>str</code> è¿›è¡Œè§£ç ã€‚</td></tr><tr><td></td><td><code>MD5(str)</code></td><td>è¿”å› <code>str</code> çš„ MD5 æ•£åˆ—å€¼ã€‚</td></tr><tr><td></td><td><code>SHA1(str)</code></td><td>è¿”å› <code>str</code> çš„ SHA-1 æ•£åˆ—å€¼ã€‚</td></tr><tr><td></td><td><code>SHA2(str, bit_length)</code></td><td>è¿”å› <code>str</code> çš„ SHA-2 æ•£åˆ—å€¼ã€‚</td></tr><tr><td>èšåˆå‡½æ•°</td><td><code>COUNT(expr)</code></td><td>è¿”å› <code>expr</code> çš„è¡Œæ•°ã€‚</td></tr><tr><td></td><td><code>SUM(expr)</code></td><td>è¿”å› <code>expr</code> çš„æ€»å’Œã€‚</td></tr><tr><td></td><td><code>AVG(expr)</code></td><td>è¿”å› <code>expr</code> çš„å¹³å‡å€¼ã€‚</td></tr><tr><td></td><td><code>MIN(expr)</code></td><td>è¿”å› <code>expr</code> çš„æœ€å°å€¼ã€‚</td></tr><tr><td></td><td><code>MAX(expr)</code></td><td>è¿”å› <code>expr</code> çš„æœ€å¤§å€¼ã€‚</td></tr></tbody></table><h2 id="4ã€Mysql5-7å’ŒMysql8-0ä¼˜ç¼ºç‚¹"><a href="#4ã€Mysql5-7å’ŒMysql8-0ä¼˜ç¼ºç‚¹" class="headerlink" title="4ã€Mysql5.7å’ŒMysql8.0ä¼˜ç¼ºç‚¹"></a>4ã€Mysql5.7å’ŒMysql8.0ä¼˜ç¼ºç‚¹</h2><hr><p>MySQL 5.7ä¼˜ç‚¹:</p><ul><li>ç¨³å®šæ€§å¥½,ç”Ÿæ€æˆç†Ÿã€‚5.7ç‰ˆæœ¬å·²ç»ç”¨äº†å¾ˆå¤šå¹´,Bugè¾ƒå°‘ã€‚</li><li>å…¼å®¹æ€§å¼º,ä¸5.6ä¸‹çš„åº”ç”¨å…¼å®¹æ€§å¥½ã€‚</li><li>åŠŸèƒ½å®Œå–„,æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ã€‚</li><li>æ€§èƒ½ä¼˜åŒ–æˆç†Ÿ,æŸ¥è¯¢æ•ˆç‡é«˜ã€‚</li></ul><p>MySQL 5.7ç¼ºç‚¹:</p><ul><li>ä¸æ”¯æŒæ–°çš„JSONåŠŸèƒ½å’Œå¯æ‹“å±•å­˜å‚¨å¼•æ“ã€‚</li><li>ä¸æ”¯æŒä»åº“è¯»å–å¤åˆ¶åŠŸèƒ½ã€‚</li><li>éƒ¨åˆ†æ–°ç‰¹æ€§æ”¯æŒä¸å¤Ÿå®Œå–„ã€‚</li></ul><p>MySQL 8.0ä¼˜ç‚¹:</p><ul><li>æ”¯æŒæ–°å­˜å‚¨å¼•æ“å¦‚InnoDBå®¹å™¨å­˜å‚¨å¼•æ“ã€‚</li><li>å…¨æ–°çš„JSONæ•°æ®ç±»å‹æ”¯æŒ,æŸ¥è¯¢å’Œç´¢å¼•åŠŸèƒ½å¼ºå¤§ã€‚</li><li>æ”¯æŒä»åº“è¯»å–åŠŸèƒ½ç­‰æ–°å¤åˆ¶ç‰¹æ€§ã€‚</li><li>æ€§èƒ½æœ‰ä¸€å®šæå‡,æ”¯æŒåŒºå—å­˜å‚¨å¼•æ“å¯¹åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–ã€‚</li></ul><p>MySQL 8.0ç¼ºç‚¹:</p><ul><li>æ–°ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜,ä¸5.7ä¸‹åº”ç”¨è¿ç§»æˆæœ¬é«˜ã€‚</li><li>æ–°åŠŸèƒ½æµ‹è¯•ç¯å¢ƒå»ºè®¾éš¾åº¦å¤§ã€‚</li><li>BUGç‡å¯èƒ½é«˜äº5.7ç¨³å®šç‰ˆæœ¬ã€‚</li></ul><h2 id="5-ã€Insert"><a href="#5-ã€Insert" class="headerlink" title="5 ã€Insert"></a>5 ã€Insert</h2><p>åœ¨æ•°æ®åº“æ“ä½œä¸­ï¼Œå¤„ç†é‡å¤æ’å…¥æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œå°¤å…¶æ˜¯åœ¨å°è¯•æ’å…¥æ•°æ®åˆ°å…·æœ‰å”¯ä¸€çº¦æŸï¼ˆå¦‚å”¯ä¸€é”®ã€ä¸»é”®ï¼‰çš„è¡¨æ—¶ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¤„ç†é‡å¤æ’å…¥çš„æ–¹æ³•ï¼š</p><ol><li><p><strong>å¿½ç•¥é‡å¤è®°å½•</strong>ï¼š ä½¿ç”¨ <code>INSERT IGNORE</code> è¯­å¥ï¼Œå½“æ’å…¥çš„è®°å½•è¿åå”¯ä¸€æ€§çº¦æŸæ—¶ï¼ŒMySQLä¼šå¿½ç•¥è¿™æ¡æ’å…¥è¯­å¥ï¼Œè€Œä¸æ˜¯æŠ›å‡ºé”™è¯¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> IGNORE <span class="hljs-keyword">INTO</span> table_name (column1, column2, ...)<br><span class="hljs-keyword">VALUES</span> (value1, value2, ...);<br></code></pre></td></tr></table></figure></li><li><p>**ä½¿ç”¨ <code>ON DUPLICATE KEY UPDATE</code>**ï¼š å½“æ’å…¥çš„è®°å½•å¯¼è‡´å”¯ä¸€é”®å†²çªæ—¶ï¼Œæ­¤è¯­å¥å¯ä»¥æ›´æ–°å·²æœ‰è®°å½•çš„æŸäº›å­—æ®µè€Œä¸æ˜¯æ’å…¥æ–°è®°å½•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> table_name (column1, column2, ...)<br><span class="hljs-keyword">VALUES</span> (value1, value2, ...)<br><span class="hljs-keyword">ON</span> DUPLICATE KEY <span class="hljs-keyword">UPDATE</span><br>column1 <span class="hljs-operator">=</span> <span class="hljs-keyword">VALUES</span>(column1), column2 <span class="hljs-operator">=</span> <span class="hljs-keyword">VALUES</span>(column2);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>VALUES(column_name)</code> å‡½æ•°ç”¨äºå¼•ç”¨æ–°æ’å…¥çš„å€¼ã€‚</p></li><li><p><strong>å…ˆæŸ¥è¯¢åæ’å…¥ï¼ˆSELECT + INSERTï¼‰</strong>ï¼šåœ¨æ’å…¥ä¹‹å‰ï¼Œå…ˆæŸ¥è¯¢è®°å½•æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ã€‚è¿™ç§æ–¹æ³•é€‚ç”¨äºä¸æ”¯æŒä¸Šè¿°ç‰¹æ€§çš„æ•°æ®åº“ç³»ç»Ÿã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> cat(id, name, age)<br><span class="hljs-keyword">SELECT</span> s.SNO, s.SEX, s.CSZ<br><span class="hljs-keyword">FROM</span> test.student44 s<br><span class="hljs-keyword">WHERE</span> s.SNAME <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é™ˆå¼º&#x27;</span><br><span class="hljs-keyword">AND</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> cat c<br>    <span class="hljs-keyword">WHERE</span> c.id <span class="hljs-operator">=</span> s.SNO<br>);<br></code></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ <code>MERGE</code> è¯­å¥ï¼ˆé€‚ç”¨äºSQL Serverå’ŒOracleç­‰ï¼‰</strong>ï¼š</p><p><code>MERGE</code> æ˜¯ä¸€ç§æ›´é«˜çº§çš„è¯­å¥ï¼Œå¯ä»¥åŒæ—¶å®ŒæˆæŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œã€‚å¯¹äºé¿å…é‡å¤æ’å…¥ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ ¹æ®æ¡ä»¶å†³å®šæ˜¯æ’å…¥æ–°è®°å½•è¿˜æ˜¯æ›´æ–°ç°æœ‰è®°å½•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">MERGE</span> <span class="hljs-keyword">INTO</span> Customers <span class="hljs-keyword">AS</span> Target<br><span class="hljs-keyword">USING</span> NewCustomerData <span class="hljs-keyword">AS</span> Source<br><span class="hljs-keyword">ON</span> Target.CustomerID <span class="hljs-operator">=</span> Source.CustomerID<br><span class="hljs-keyword">WHEN</span> MATCHED <span class="hljs-keyword">THEN</span><br>    <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">SET</span> Target.Email <span class="hljs-operator">=</span> Source.Email<br><span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">NOT</span> MATCHED <span class="hljs-keyword">THEN</span><br>    <span class="hljs-keyword">INSERT</span> (CustomerID, Name, Email)<br>    <span class="hljs-keyword">VALUES</span> (Source.CustomerID, Source.Name, Source.Email);<br></code></pre></td></tr></table></figure></li></ol><h2 id="6ã€mysqlé—®é¢˜"><a href="#6ã€mysqlé—®é¢˜" class="headerlink" title="6ã€mysqlé—®é¢˜"></a>6ã€mysqlé—®é¢˜</h2><h3 id="1ã€æ’å…¥ä¸­æ–‡è®°å½•é—®é¢˜"><a href="#1ã€æ’å…¥ä¸­æ–‡è®°å½•é—®é¢˜" class="headerlink" title="1ã€æ’å…¥ä¸­æ–‡è®°å½•é—®é¢˜"></a>1ã€æ’å…¥ä¸­æ–‡è®°å½•é—®é¢˜</h3><blockquote><p>åœ¨è¡¨çš„å­—ç¬¦é›†æ˜¯utf8mb4æƒ…å†µä¸‹ï¼Œæ’å…¥ä¸­æ–‡æ•°æ®æç¤ºæŠ¥é”™</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span> é”™è¯¯ [<span class="hljs-number">1366</span>] [HY000]: Incorrect string <span class="hljs-keyword">value</span>: <span class="hljs-string">&#x27;\xE5\xB8\x82\xE4\xB8\xAD...&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">column</span> <span class="hljs-string">&#x27;ACCOUNT&#x27;</span> <span class="hljs-keyword">at</span> <span class="hljs-type">row</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><strong>æ’æŸ¥ï¼š</strong></p><ul><li><p>æ£€æŸ¥å®¢æˆ·ç«¯&#x2F;é©±åŠ¨ç¨‹åºçš„å­—ç¬¦é›†è®¾ç½®</p></li><li><p>æ£€æŸ¥è¡¨å’Œåˆ—çš„å­—ç¬¦é›†è®¾ç½®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> SAYTH_MONITOR_RISK_ALARM_DATA;<span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŸ¥çœ‹è¡¨åº“çš„å­—ç¬¦é›†ç¼–ç <br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> SAYTH_MONITOR_RISK_ALARM_DATA <span class="hljs-keyword">CONVERT</span> <span class="hljs-keyword">TO</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci; <span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ›´æ”¹è¡¨çš„å­—ç¬¦é›†ç¼–ç <br></code></pre></td></tr></table></figure></li></ul><h3 id="2ã€mysqlæ•°æ®åº“æ¸…é™¤è‡ªå¢idå¹¶ä»1å¼€å§‹"><a href="#2ã€mysqlæ•°æ®åº“æ¸…é™¤è‡ªå¢idå¹¶ä»1å¼€å§‹" class="headerlink" title="2ã€mysqlæ•°æ®åº“æ¸…é™¤è‡ªå¢idå¹¶ä»1å¼€å§‹"></a>2ã€mysqlæ•°æ®åº“æ¸…é™¤è‡ªå¢idå¹¶ä»1å¼€å§‹</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> tablename;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tablename AUTO_INCREMENT <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;# ä½¿ç”¨ <span class="hljs-keyword">DELETE</span> è¯­å¥ç»“åˆ <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> é‡ç½®è‡ªå¢è®¡æ•°å™¨<br><br>## æˆ–è€…<br><span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">TABLE</span> tablename;# <span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">TABLE</span> è¯­å¥å¯ä»¥å¿«é€Ÿæ¸…ç©ºè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œå¹¶é‡ç½®è‡ªå¢è®¡æ•°å™¨<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç‰ˆæœ¬æ›´æ–°ç‰¹æ€§</title>
    <link href="/2024/12/10/go/%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0%E7%89%B9%E6%80%A7/"/>
    <url>/2024/12/10/go/%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0%E7%89%B9%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="ç‰ˆæœ¬æ›´æ–°ç‰¹æ€§"><a href="#ç‰ˆæœ¬æ›´æ–°ç‰¹æ€§" class="headerlink" title="ç‰ˆæœ¬æ›´æ–°ç‰¹æ€§"></a>ç‰ˆæœ¬æ›´æ–°ç‰¹æ€§</h1><h2 id="Golang-1-22-å¯¹-for-å¾ªç¯ä½œäº†ä¸¤å¤„æ›´æ–°"><a href="#Golang-1-22-å¯¹-for-å¾ªç¯ä½œäº†ä¸¤å¤„æ›´æ–°" class="headerlink" title="Golang 1.22 å¯¹ for å¾ªç¯ä½œäº†ä¸¤å¤„æ›´æ–°"></a>Golang 1.22 å¯¹ for å¾ªç¯ä½œäº†ä¸¤å¤„æ›´æ–°</h2><ul><li><p>ä¸å†å…±äº«å¾ªç¯å˜é‡</p><p>Go 1.22 ä¹‹å‰ï¼Œ<code>for</code> å¾ªç¯å£°æ˜çš„å˜é‡ä»…ä¼šåˆ›å»ºä¸€æ¬¡ï¼Œè€Œåœ¨æ¯æ¬¡è¿­ä»£æ—¶å¯¹å˜é‡å€¼è¿›è¡Œæ›´æ–°ã€‚Go 1.22 æ”¹ä¸ºæ¯æ¬¡è¿­ä»£æ—¶éƒ½åˆ›å»ºæ–°çš„å˜é‡ã€‚</p></li><li><p>æ”¯æŒå¯¹æ•´æ•°è¿›è¡Œ <code>range</code> éå†</p><p>Go 1.22 æ”¯æŒåœ¨ <code>for</code> å¾ªç¯ä¸­å¯¹æ•´æ•°è¿›è¡Œ <code>range</code> éå†äº†ã€‚</p></li></ul><h3 id="1-ä¸å†å…±äº«å¾ªç¯å˜é‡"><a href="#1-ä¸å†å…±äº«å¾ªç¯å˜é‡" class="headerlink" title="1 ä¸å†å…±äº«å¾ªç¯å˜é‡"></a>1 ä¸å†å…±äº«å¾ªç¯å˜é‡</h3><p><strong>Go 1.22 ä¹‹å‰çš„æƒ…å†µ</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// for_1_21.go</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ &#123;<br><span class="hljs-comment">// for each iteration, start a goroutine to print i</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(i)<br>&#125;()<br>&#125;<br><br><span class="hljs-comment">// waiting for 3 seconds</span><br>time.Sleep(time.Second * <span class="hljs-number">3</span>)<br>&#125;<br><br><span class="hljs-comment">// è¾“å‡ºç»“æœ 2 2 2</span><br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯å› ä¸º <code>for</code> å¾ªç¯çš„ <code>i</code> å˜é‡åªåœ¨åˆå§‹åŒ–å—å†…å£°æ˜äº†ä¸€æ¬¡ï¼Œè€Œåœ¨æ¯æ¬¡è¿­ä»£æ—¶å¯¹å…¶é‡æ–°èµ‹å€¼ã€‚è¿™æ ·ï¼Œå¯åŠ¨è™½æœ‰é¡ºåºä½†æ‰§è¡Œå´æ˜¯å¼‚æ­¥çš„ <code>3</code> ä¸ªå­ <code>goroutine</code> è®¿é—®çš„å…¶å®æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæ‰€ä»¥æ‰“å°çš„å€¼æœ‰å¯èƒ½ä¼šç›¸åŒã€‚</p><p>è€ç‰ˆæœ¬è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥é€šè¿‡ç»™é—­åŒ…å‡½æ•°å¢åŠ ä¸€ä¸ªå‚æ•°æˆ–è€…æ–°å£°æ˜ä¸€ä¸ªå˜é‡æ¥è§£å†³ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// for_modified_1_21.go</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ &#123;<br>  <span class="hljs-comment">// for each iteration, start a goroutine to print i</span><br>  <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-type">int</span>)</span></span> &#123;<br>    fmt.Println(i)<br>  &#125;(i)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-æ”¯æŒå¯¹æ•´æ•°è¿›è¡Œrangeéå†"><a href="#2-æ”¯æŒå¯¹æ•´æ•°è¿›è¡Œrangeéå†" class="headerlink" title="2 æ”¯æŒå¯¹æ•´æ•°è¿›è¡Œrangeéå†"></a>2 æ”¯æŒå¯¹æ•´æ•°è¿›è¡Œrangeéå†</h3><p>åœ¨ Go 1.22 ç‰ˆæœ¬ä¹‹å‰ï¼Œ <code>for</code> ä»…æ”¯æŒå¯¹ <code>array</code>ï¼ˆæˆ– <code>slice</code>ï¼‰ã€<code>string</code>ã€<code>map</code> å’Œ <code>channel</code> ç±»å‹è¿›è¡Œ <code>range</code> éå†ï¼Œè€Œ Go 1.22 æ”¯æŒäº†å¯¹æ•´æ•°çš„ <code>range</code> éå†ï¼Œè¿™æ ·å¯¹äºæ‰“å°ä¸€ä¸ªè¿ç»­æ•°å€¼åºåˆ—çš„å†™æ³•å°±å˜å¾—ç®€å•å¤šäº†ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// for_range_int_1_22.go</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> <span class="hljs-number">3</span> &#123;<br>fmt.Println(i)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¯­æ³•ç¬”è®°</title>
    <link href="/2024/12/10/go/%E8%AF%AD%E6%B3%95%E7%AC%94%E8%AE%B0/"/>
    <url>/2024/12/10/go/%E8%AF%AD%E6%B3%95%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="è®°ä¸ä½ç³»åˆ—"><a href="#è®°ä¸ä½ç³»åˆ—" class="headerlink" title="è®°ä¸ä½ç³»åˆ—"></a>è®°ä¸ä½ç³»åˆ—</h1><h2 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h2><p><strong><code>&amp;</code>ï¼ˆå–åœ°å€ï¼‰å’Œ<code>*</code>ï¼ˆæ ¹æ®åœ°å€å–å€¼ï¼‰</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> MyInt <span class="hljs-type">int</span><br><span class="hljs-keyword">type</span> User1 <span class="hljs-keyword">struct</span> &#123;<br>    IdOrName any   <span class="hljs-string">`json:&quot;idOrName&quot;`</span><br>    M        MyInt <span class="hljs-string">`json:&quot;m&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    str := <span class="hljs-string">&quot;nihao&quot;</span><br>    u := User1&#123;IdOrName: str, M: <span class="hljs-number">20</span>&#125; <span class="hljs-comment">// u æ˜¯ User1 ç±»å‹çš„å˜é‡</span><br><br>    <span class="hljs-comment">// è‹¥è¦å£°æ˜ä¸€ä¸ª User1 ç±»å‹çš„æŒ‡é’ˆï¼Œåº”å¦‚ä¸‹æ‰€ç¤ºï¼š</span><br>    uPtr := &amp;User1&#123;IdOrName: str, M: <span class="hljs-number">20</span>&#125; <span class="hljs-comment">// uPtr æ˜¯ *User1 ç±»å‹çš„æŒ‡é’ˆå˜é‡</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>u</code> æ˜¯ <code>User1</code> ç»“æ„ä½“çš„ä¸€ä¸ªå®ä¾‹ï¼Œç›´æ¥å­˜å‚¨ç»“æ„ä½“çš„å€¼ï¼›è€Œå¦‚æœå£°æ˜ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œåº”è¯¥ä½¿ç”¨å–å€è¿ç®—ç¬¦ <code>&amp;</code>ï¼Œå¦‚ <code>uPtr</code> ç¤ºä¾‹æ‰€ç¤ºã€‚æŒ‡é’ˆå˜é‡å­˜å‚¨çš„æ˜¯ç»“æ„ä½“å®ä¾‹çš„å†…å­˜åœ°å€ï¼Œè€Œä¸æ˜¯ç»“æ„ä½“çš„å€¼æœ¬èº«ã€‚</p><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œå½“ä½ ä¿®æ”¹ä¸€ä¸ªæŒ‡é’ˆç±»å‹åœ°å€æŒ‡å‘çš„å€¼æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨ä¿®æ”¹æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸä¸­çš„å€¼ï¼›è€Œå½“ä½ ç›´æ¥ä¿®æ”¹ä¸€ä¸ªå˜é‡çš„å€¼æ—¶ï¼Œæ˜¯åœ¨ä¿®æ”¹è¯¥å˜é‡æ‰€åœ¨å†…å­˜åŒºåŸŸçš„å€¼ã€‚ä¸‹é¢æ˜¯ä¸¤è€…çš„åŒºåˆ«ï¼š</p><ol><li><p><strong>ä¿®æ”¹æŒ‡é’ˆç±»å‹åœ°å€æŒ‡å‘çš„å€¼ï¼š</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> MyInt <span class="hljs-type">int</span><br><span class="hljs-keyword">var</span> m MyInt = <span class="hljs-number">10</span><br><span class="hljs-keyword">var</span> ptrToM *MyInt = &amp;m <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæŒ‡å‘ m çš„æŒ‡é’ˆ</span><br><br><span class="hljs-comment">// ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å€¼</span><br>*ptrToM = <span class="hljs-number">20</span> <span class="hljs-comment">// æ­¤æ—¶ï¼Œm çš„å€¼å˜ä¸º 20ï¼Œå› ä¸º ptrToM æŒ‡å‘ m çš„å†…å­˜åœ°å€</span><br>fmt.Println(m) <span class="hljs-comment">// è¾“å‡ºï¼š20</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œ<code>ptrToM</code> æ˜¯ä¸€ä¸ªæŒ‡å‘ <code>MyInt</code> ç±»å‹å˜é‡ <code>m</code> çš„æŒ‡é’ˆã€‚é€šè¿‡ <code>*ptrToM = 20</code>ï¼Œæˆ‘ä»¬æ”¹å˜äº† <code>ptrToM</code> æ‰€æŒ‡å‘å†…å­˜åŒºåŸŸçš„å€¼ï¼Œä¹Ÿå°±æ˜¯å˜é‡ <code>m</code> çš„å€¼ã€‚</p></li><li><p><strong>ç›´æ¥ä¿®æ”¹å˜é‡çš„å€¼</strong>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> MyInt <span class="hljs-type">int</span><br><span class="hljs-keyword">var</span> m MyInt = <span class="hljs-number">10</span><br><br><span class="hljs-comment">// ç›´æ¥ä¿®æ”¹å˜é‡çš„å€¼</span><br>m = <span class="hljs-number">20</span> <span class="hljs-comment">// ç›´æ¥å°† m çš„å€¼æ”¹ä¸º 20</span><br>fmt.Println(m) <span class="hljs-comment">// è¾“å‡ºï¼š20</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç›´æ¥æ“ä½œå˜é‡ <code>m</code>ï¼Œå°†å…¶å€¼è®¾ä¸º 20ï¼Œè¿™æ˜¯å¯¹å˜é‡è‡ªèº«å†…å­˜åŒºåŸŸçš„ä¿®æ”¹ã€‚</p></li></ol><p>ç®€è€Œè¨€ä¹‹ï¼ŒæŒ‡é’ˆä¿®æ”¹çš„æ˜¯å®ƒæŒ‡å‘çš„å†…å­˜ä½ç½®çš„å€¼ï¼Œè€Œç›´æ¥ä¿®æ”¹å˜é‡åˆ™æ˜¯ä¿®æ”¹å˜é‡è‡ªèº«çš„å†…å­˜ä½ç½®çš„å€¼ã€‚ä½¿ç”¨æŒ‡é’ˆå¯ä»¥åœ¨ä¸å¤åˆ¶å¤§é‡æ•°æ®çš„æƒ…å†µä¸‹ä¿®æ”¹å¤§å‹æ•°æ®ç»“æ„ï¼Œè¿˜å¯ä»¥å®ç°å¯¹å‡½æ•°å†…éƒ¨å±€éƒ¨å˜é‡çš„ä¿®æ”¹ï¼ˆé€šè¿‡ä¼ é€’æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼‰ï¼Œä»è€Œè¾¾åˆ°å¼•ç”¨ä¼ é€’çš„æ•ˆæœã€‚</p><ol><li><strong>å†…å­˜åœ°å€</strong>ï¼šå†…å­˜åœ°å€æ˜¯è®¡ç®—æœºå†…å­˜ä¸­æ¯ä¸ªå­˜å‚¨ä½ç½®çš„ç¼–å·ï¼Œç”¨æ¥å”¯ä¸€æ ‡è¯†å†…å­˜ä¸­çš„ä¸€ä¸ªå­˜å‚¨å•å…ƒã€‚ç¨‹åºè¿è¡Œæ—¶ï¼Œå˜é‡ã€æ•°æ®ç»“æ„ã€æŒ‡ä»¤ç­‰éƒ½ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶ä¸”æ¯ä¸ªéƒ½æœ‰å¯¹åº”çš„å†…å­˜åœ°å€ã€‚</li><li><strong>æŒ‡é’ˆï¼ˆPointerï¼‰</strong>ï¼šåœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒæŒ‡é’ˆæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå®ƒå­˜å‚¨çš„å°±æ˜¯è¿™æ ·ä¸€ä¸ªå†…å­˜åœ°å€ã€‚é€šè¿‡æŒ‡é’ˆï¼Œç¨‹åºèƒ½å¤Ÿç›´æ¥è®¿é—®å’Œä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œåœ¨goä¸­ï¼Œå£°æ˜ä¸€ä¸ªæ•´å‹æŒ‡é’ˆå˜é‡ <code>int *p;</code>ï¼Œé€šè¿‡èµ‹å€¼ <code>p = &amp;x;</code>ï¼ˆå…¶ä¸­xä¸ºä¸€ä¸ªæ•´å‹å˜é‡ï¼‰ï¼ŒæŒ‡é’ˆpå°±å­˜å‚¨äº†xå˜é‡çš„å†…å­˜åœ°å€ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨ <code>*</code>p &#x3D; 10;&#96; æ¥æ”¹å˜xçš„å€¼ã€‚</li></ol><h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>åœ¨Goè¯­è¨€ä¸­ï¼Œ<code>map</code> ç±»å‹ç›¸å½“äºPythonä¸­çš„ <code>dict</code>ï¼ˆå­—å…¸ï¼‰ç±»å‹ã€‚ä¸¤è€…éƒ½æ˜¯å…³è”æ•°ç»„æˆ–å“ˆå¸Œè¡¨çš„å®ç°ï¼Œæä¾›äº†é€šè¿‡é”®ï¼ˆkeyï¼‰æ¥è®¿é—®å’Œå­˜å‚¨å€¼ï¼ˆvalueï¼‰çš„èƒ½åŠ›</p><ul><li><p>åœ¨ Go è¯­è¨€ä¸­å£°æ˜ä¸€ä¸ª mapï¼š</p><p>Go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">myMap := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>)<span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªé”®ä¸ºstringç±»å‹ï¼Œå€¼ä¸ºintç±»å‹çš„map</span><br><span class="hljs-comment">// æ’å…¥æˆ–æ›´æ–°å…ƒç´ </span><br>myMap[<span class="hljs-string">&quot;apple&quot;</span>] = <span class="hljs-number">5</span> <span class="hljs-comment">// å¦‚æœ&quot;apple&quot;è¿™ä¸ªé”®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼›å¦‚æœå­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶å€¼ä¸º5</span><br><span class="hljs-comment">// åˆ é™¤é”®ä¸º&quot;apple&quot;çš„å…ƒç´ </span><br><span class="hljs-built_in">delete</span>(myMap, <span class="hljs-string">&quot;apple&quot;</span>)<br></code></pre></td></tr></table></figure></li><li><p>åœ¨ Python ä¸­å£°æ˜ä¸€ä¸ª dictï¼š</p><p>Python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">my_dict = &#123;&#125;<br></code></pre></td></tr></table></figure></li></ul><p>ä¸¤è€…éƒ½å¯ä»¥é€šè¿‡é”®æ¥æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤å’ŒæŸ¥æ‰¾å…ƒç´ ï¼Œå¹¶ä¸”å®ƒä»¬éƒ½ä¸ä¿è¯å…ƒç´ çš„è¿­ä»£é¡ºåºæ˜¯å›ºå®šçš„ï¼ˆåœ¨Go 1.18ç‰ˆæœ¬ä¹‹å‰ï¼‰ã€‚æ­¤å¤–ï¼ŒGo çš„ map å’Œ Python çš„ dict éƒ½è¦æ±‚é”®å¿…é¡»æ˜¯å¯æ¯”è¾ƒçš„ç±»å‹ã€‚åœ¨Goä¸­ï¼Œé”®é€šå¸¸æ˜¯æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²æˆ–æŒ‡é’ˆç­‰ï¼›åœ¨Pythonä¸­ï¼Œé”®å¯ä»¥æ˜¯ä¸å¯å˜ç±»å‹ï¼Œå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ã€å…ƒç»„ç­‰ã€‚</p><h2 id="åˆ‡ç‰‡ï¼ˆSlicesï¼‰"><a href="#åˆ‡ç‰‡ï¼ˆSlicesï¼‰" class="headerlink" title="åˆ‡ç‰‡ï¼ˆSlicesï¼‰"></a>åˆ‡ç‰‡ï¼ˆSlicesï¼‰</h2><p><strong>Goè¯­è¨€ä¸­çš„åˆ‡ç‰‡ï¼ˆSlicesï¼‰</strong>ï¼š å¯¹åº”äºPythonä¸­çš„<strong>åˆ—è¡¨ï¼ˆListï¼‰</strong>ã€‚ä¸¤è€…éƒ½æ˜¯å¯å˜é•¿åº¦çš„åºåˆ—ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹å…ƒç´ ã€‚Goè¯­è¨€ä¸­çš„åˆ‡ç‰‡è™½ç„¶åŸºäºæ•°ç»„å®ç°ï¼Œä½†æä¾›äº†æ›´çµæ´»çš„æ¥å£ï¼Œæ— éœ€é¢„å…ˆæŒ‡å®šå›ºå®šé•¿åº¦ï¼Œå¯ä»¥è‡ªç”±æ‰©å±•ã€‚åœ¨Pythonä¸­ï¼Œåˆ—è¡¨æ”¯æŒç´¢å¼•è®¿é—®ã€åˆ‡ç‰‡æ“ä½œä»¥åŠå…¶ä»–ä¸°å¯Œçš„å†…ç½®æ–¹æ³•ï¼Œå¦‚appendã€extendã€popç­‰ï¼Œè¿™äº›åŠŸèƒ½ä¸Goè¯­è¨€åˆ‡ç‰‡ç›¸ä¼¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// æŒ‡å®šé•¿åº¦ä¸º0 </span><br>slice := <span class="hljs-built_in">make</span>([]<span class="hljs-type">string</span>, <span class="hljs-number">0</span>)<br><br><span class="hljs-comment">//æˆ–è€…ç»™å®šé¢„æœŸé•¿åº¦</span><br>slice := <span class="hljs-built_in">make</span>([]<span class="hljs-type">string</span>, <span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><p>åˆ‡ç‰‡ä¼šè‡ªåŠ¨æ‰©å®¹</p><p>æ‰©å®¹ç­–ç•¥ä¸€èˆ¬ä¸º:</p><ul><li>è‹¥åŸå®¹é‡å°äº1024,æ–°å®¹é‡ä¸ºåŸå®¹é‡çš„2å€</li><li>è‹¥åŸå®¹é‡å¤§äºæˆ–ç­‰äº1024,æ–°å®¹é‡å¢é•¿1.25å€</li></ul><p>å½±å“æ€§èƒ½ä¸æŠ¥é”™</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">slice := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>) <span class="hljs-comment">// len=5, cap=10</span><br>slice = <span class="hljs-built_in">append</span>(slice, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) <span class="hljs-comment">// len=8, capè¿˜æ˜¯10</span><br>slice = <span class="hljs-built_in">append</span>(slice, <span class="hljs-number">4</span>) <span class="hljs-comment">// è¶…è¿‡cap,capå¢åŠ åˆ°20,é‡æ–°åˆ†é…å†…å­˜</span><br></code></pre></td></tr></table></figure><h2 id="æ•°ç»„ï¼ˆArraysï¼‰"><a href="#æ•°ç»„ï¼ˆArraysï¼‰" class="headerlink" title="æ•°ç»„ï¼ˆArraysï¼‰"></a>æ•°ç»„ï¼ˆArraysï¼‰</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// å£°æ˜ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ï¼Œå…ƒç´ ç±»å‹ä¸º T</span><br><span class="hljs-keyword">var</span> arr [n]T<br><br><span class="hljs-comment">// ç¤ºä¾‹ï¼šå£°æ˜ä¸€ä¸ªé•¿åº¦ä¸º 5 çš„æ•´æ•°æ•°ç»„</span><br><span class="hljs-keyword">var</span> numbers [<span class="hljs-number">5</span>]<span class="hljs-type">int</span><br><br><span class="hljs-comment">// æˆ–è€…åŒæ—¶åˆå§‹åŒ–</span><br>numbers := [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æŸäº›æ–¹é¢ç±»ä¼¼äºPythonä¸­çš„<strong>å…ƒç»„ï¼ˆTuplesï¼‰</strong>ï¼Œç‰¹åˆ«æ˜¯å½“å®ƒä»¬ç”¨æ¥è¡¨ç¤ºå›ºå®šé•¿åº¦ä¸”ä¸å¯å˜çš„æ•°æ®åºåˆ—æ—¶ã€‚ç„¶è€Œï¼ŒGoè¯­è¨€ä¸­çš„æ•°ç»„ä¸Pythonä¸­çš„å…ƒç»„æœ‰å‡ ä¸ªå…³é”®åŒºåˆ«ï¼š</p><ul><li><p>Goè¯­è¨€çš„æ•°ç»„æ˜¯å›ºå®šé•¿åº¦çš„ï¼Œä¸€æ—¦åˆ›å»ºåä¸èƒ½æ”¹å˜é•¿åº¦ï¼›</p></li><li><p>Pythonçš„å…ƒç»„è™½ç„¶æ˜¯ä¸å¯å˜åºåˆ—ï¼Œä½†ä¸€èˆ¬ä¸å¼ºè°ƒå…¶å†…éƒ¨å…ƒç´ å¿…é¡»æ˜¯åŒä¸€ç±»å‹ï¼Œè€ŒGoè¯­è¨€çš„æ•°ç»„è¦æ±‚æ‰€æœ‰å…ƒç´ å¿…é¡»æ˜¯åŒä¸€ç±»å‹ï¼›</p></li><li><p>Pythonä¸­æ²¡æœ‰ä¸Goè¯­è¨€æ•°ç»„å®Œå…¨ä¸€ä¸€å¯¹åº”çš„ç»“æ„ï¼Œå› ä¸ºPythonçš„åˆ—è¡¨å’Œå…ƒç»„éƒ½å¯ä»¥åŒ…å«å¤šç§ç±»å‹çš„å…ƒç´ ï¼Œè€Œä¸”å…ƒç»„è™½ç„¶ä¸å¯å˜ï¼Œä½†é•¿åº¦å¯ä»¥å˜åŒ–ï¼ˆé€šè¿‡ç»„åˆå¤šä¸ªå…ƒç»„å½¢æˆæ–°å…ƒç»„ï¼‰ã€‚</p></li><li><p>æ•°ç»„é•¿åº¦å›ºå®šï¼Œåˆ›å»ºåä¸å¯å˜ï¼›åˆ‡ç‰‡é•¿åº¦å¯å˜ã€‚</p></li><li><p>æ•°ç»„æ˜¯å€¼ç±»å‹ï¼›åˆ‡ç‰‡æ˜¯å¼•ç”¨ç±»å‹ï¼ˆç±»ä¼¼äºæŒ‡é’ˆï¼‰ã€‚</p></li><li><p>æ•°ç»„é€šè¿‡ç´¢å¼•è®¿é—®ï¼›åˆ‡ç‰‡é™¤äº†ç´¢å¼•è®¿é—®å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡åˆ‡ç‰‡è¡¨è¾¾å¼åˆ›å»ºæ–°çš„åˆ‡ç‰‡è§†å›¾ã€‚</p></li><li><p>åˆ‡ç‰‡æ˜¯å¯¹æ•°ç»„çš„éƒ¨åˆ†å¼•ç”¨ï¼Œæ›´çµæ´»ï¼Œé€‚ç”¨äºåŠ¨æ€å˜åŒ–çš„åºåˆ—æ•°æ®å¤„ç†åœºæ™¯ã€‚</p></li></ul><h2 id="ç»“æ„ä½“ï¼ˆstructï¼‰"><a href="#ç»“æ„ä½“ï¼ˆstructï¼‰" class="headerlink" title="ç»“æ„ä½“ï¼ˆstructï¼‰"></a>ç»“æ„ä½“ï¼ˆstructï¼‰</h2><p>åœ¨Goè¯­è¨€ä¸­ï¼Œç»“æ„ä½“ï¼ˆstructï¼‰ç›¸å½“äºPythonä¸­çš„ç±»å®ä¾‹æˆ–å‘½åå…ƒç»„ï¼ˆnamedtupleï¼‰ã€‚ç»“æ„ä½“æ˜¯ç”¨æ¥å°è£…å¤šä¸ªå­—æ®µçš„å¤åˆæ•°æ®ç±»å‹ï¼Œæ¯ä¸ªå­—æ®µéƒ½æœ‰ä¸€ä¸ªåç§°å’Œå¯¹åº”çš„ç±»å‹</p><p>åœ¨Goè¯­è¨€ä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>    Name <span class="hljs-type">string</span><br>    Age  <span class="hljs-type">int</span><br>&#125;<br><br>p := Person&#123;Name: <span class="hljs-string">&quot;Alice&quot;</span>, Age: <span class="hljs-number">30</span>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨Pythonä¸­ï¼Œä½¿ç”¨ç±»å®šä¹‰ç±»ä¼¼çš„æ•°æ®ç»“æ„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self.name = name<br>        self.age = age<br><br>p = Person(name=<span class="hljs-string">&quot;Alice&quot;</span>, age=<span class="hljs-number">30</span>)<br></code></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨å‘½åå…ƒç»„ï¼ˆcollections.namedtupleï¼‰å®ç°æ›´è½»é‡çº§çš„ã€ä¸å¯å˜çš„ç‰ˆæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> namedtuple<br><br>Person = namedtuple(<span class="hljs-string">&#x27;Person&#x27;</span>, [<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>])<br>p = Person(name=<span class="hljs-string">&quot;Alice&quot;</span>, age=<span class="hljs-number">30</span>)<br></code></pre></td></tr></table></figure><p>ä¸¤è€…éƒ½å¯ä»¥ç”¨æ¥è¡¨ç¤ºå…·æœ‰å›ºå®šå±æ€§çš„æ•°æ®å¯¹è±¡ã€‚ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒGoè¯­è¨€ä¸­çš„ç»“æ„ä½“é»˜è®¤ä¸åŒ…å«æ–¹æ³•ï¼Œå¦‚æœéœ€è¦æ·»åŠ è¡Œä¸ºï¼ˆå¦‚å‡½æ•°ï¼‰ï¼Œå¯ä»¥ä¸ºç»“æ„ä½“å®šä¹‰æ–¹æ³•ï¼›è€ŒPythonç±»åˆ™é€šå¸¸åŒ…å«äº†æ•°æ®å±æ€§å’Œæ–¹æ³•ï¼Œæ›´åŠ é¢å‘å¯¹è±¡ã€‚</p><p>åœ¨Goè¯­è¨€ä¸­ï¼Œä¸ºç»“æ„ä½“å®šä¹‰æ–¹æ³•çš„æ¡ˆä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªç»“æ„ä½“Person</span><br><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>    Name <span class="hljs-type">string</span><br>    Age  <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-comment">// ä¸ºPersonç»“æ„ä½“å®šä¹‰ä¸€ä¸ªSayHelloæ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> SayHello() &#123;<br>    fmt.Printf(<span class="hljs-string">&quot;Hello, my name is %s and I am %d years old.\n&quot;</span>, p.Name, p.Age)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªPersonå®ä¾‹</span><br>    alice := Person&#123;Name: <span class="hljs-string">&quot;Alice&quot;</span>, Age: <span class="hljs-number">25</span>&#125;<br><br>    <span class="hljs-comment">// è°ƒç”¨Personå®ä¾‹çš„æ–¹æ³•</span><br>    alice.SayHello() <span class="hljs-comment">// è¾“å‡ºï¼šHello, my name is Alice and I am 25 years old.</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="makeå’Œnewæœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#makeå’Œnewæœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="makeå’Œnewæœ‰ä»€ä¹ˆåŒºåˆ«"></a>makeå’Œnewæœ‰ä»€ä¹ˆåŒºåˆ«</h2><p><strong>new åˆ›å»ºä¸€ä¸ªè¯¥ç±»å‹çš„å®ä¾‹ï¼Œå¹¶ä¸”è¿”å›æŒ‡å‘è¯¥å®ä¾‹çš„æŒ‡é’ˆã€‚new å‡½æ•°æ˜¯å†…å»ºå‡½æ•°ï¼Œå‡½æ•°å®šä¹‰ï¼š</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">new</span><span class="hljs-params">(Type)</span></span> *Type<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ new å‡½æ•°æ¥åˆ†é…ç©ºé—´</li><li>ä¼ é€’ç»™ new å‡½æ•°çš„æ˜¯ä¸€ä¸ªç±»å‹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå€¼</li><li>è¿”å›å€¼æ˜¯æŒ‡å‘è¿™ä¸ªæ–°åˆ†é…çš„åœ°å€çš„æŒ‡é’ˆ</li></ul><p><strong>ç¤ºä¾‹</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">pInt := <span class="hljs-built_in">new</span>(<span class="hljs-type">int</span>)         <span class="hljs-comment">// åˆ†é…ä¸€ä¸ª int ç±»å‹çš„é›¶å€¼ï¼Œå¹¶è¿”å›æŒ‡å‘å®ƒçš„æŒ‡é’ˆ</span><br>*pInt = <span class="hljs-number">42</span>               <span class="hljs-comment">// è§£å¼•ç”¨æŒ‡é’ˆï¼Œç»™ int ç±»å‹çš„å€¼èµ‹å€¼</span><br>pSlice := <span class="hljs-built_in">new</span>([]<span class="hljs-type">int</span>)     <span class="hljs-comment">// åˆ†é…ä¸€ä¸ªåˆ‡ç‰‡çš„é›¶å€¼ï¼Œä¹Ÿå°±æ˜¯ nilï¼Œä½†é€šå¸¸ä¸è¿™ä¹ˆç”¨</span><br></code></pre></td></tr></table></figure><p><strong>make çš„ä½œç”¨æ˜¯ä¸º slice, map or chan çš„åˆå§‹åŒ– ç„¶åè¿”å›å¼•ç”¨make å‡½æ•°æ˜¯å†…å»ºå‡½æ•°ï¼Œå‡½æ•°å®šä¹‰ï¼š</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">make</span><span class="hljs-params">(Type, size IntegerType)</span></span> Type<br></code></pre></td></tr></table></figure><ul><li>make(T, args)å‡½æ•°çš„ç›®çš„å’Œ new(T)ä¸åŒ ä»…ä»…ç”¨äºåˆ›å»º slice, map,channel è€Œä¸”è¿”å›ç±»å‹æ˜¯å®ä¾‹</li></ul><p><strong>ç¤ºä¾‹</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">s := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">5</span>)     <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º5çš„åˆ‡ç‰‡ï¼Œåˆå§‹åŒ–ä¸ºé›¶å€¼</span><br>m := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>) <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªç©ºçš„æ˜ å°„</span><br>c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">10</span>)   <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªå¸¦ç¼“å†²çš„é€šé“</span><br></code></pre></td></tr></table></figure><h2 id="æ¥å£ç±»å‹ï¼ˆinterfaceï¼‰"><a href="#æ¥å£ç±»å‹ï¼ˆinterfaceï¼‰" class="headerlink" title="æ¥å£ç±»å‹ï¼ˆinterfaceï¼‰"></a>æ¥å£ç±»å‹ï¼ˆinterfaceï¼‰</h2><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œ<code>interface&#123;&#125;</code> ç±»å‹è¢«ç§°ä¸ºâ€œç©ºæ¥å£â€ï¼Œå®ƒä¸åŒ…å«ä»»ä½•æ–¹æ³•ç­¾åã€‚ç”±äºä»»ä½•ç±»å‹éƒ½è‡³å°‘å®ç°äº†é›¶ä¸ªæ–¹æ³•ï¼ˆå³ä¸å®ç°ä»»ä½•æ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥ä»»ä½• Go è¯­è¨€ä¸­çš„ç±»å‹éƒ½èƒ½èµ‹å€¼ç»™ <code>interface&#123;&#125;</code> ç±»å‹çš„å˜é‡ã€‚è¿™ä½¿å¾— <code>interface&#123;&#125;</code> æˆä¸ºäº†ä¸€ä¸ªé€šç”¨çš„ç±»å‹å®¹å™¨ï¼Œèƒ½å¤Ÿåœ¨ä¸çŸ¥é“å…·ä½“ç±»å‹çš„æƒ…å†µä¸‹å­˜å‚¨ä»»æ„ç±»å‹çš„å€¼ï¼Œä»è€Œèµ·åˆ°è§£è€¦ç±»å‹çš„ä½œç”¨ï¼Œå¢å¼ºäº†ä»£ç çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> any <span class="hljs-keyword">interface</span>&#123;&#125;<br>any = <span class="hljs-string">&quot;Hello, World!&quot;</span>  <span class="hljs-comment">// å­—ç¬¦ä¸²ç±»å‹</span><br>any = <span class="hljs-number">42</span>               <span class="hljs-comment">// æ•´æ•°ç±»å‹</span><br>any = <span class="hljs-keyword">struct</span>&#123;&#125;&#123;&#125;       <span class="hljs-comment">// ç©ºç»“æ„ä½“ç±»å‹</span><br>any = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;&#125;        <span class="hljs-comment">// å‡½æ•°ç±»å‹</span><br><br><span class="hljs-comment">// åœ¨è¿è¡Œæ—¶ï¼Œå¯é€šè¿‡ç±»å‹æ–­è¨€æˆ–ç±»å‹ switches æ¥ç¡®å®šå¹¶æ“ä½œ any ä¸­çš„å®é™…ç±»å‹</span><br>value, ok := any.(<span class="hljs-type">string</span>)<br><span class="hljs-keyword">if</span> ok &#123;<br>    fmt.Println(value)<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ <code>interface&#123;&#125;</code> å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å€¼ï¼Œä½†åœ¨å–å‡ºå€¼åï¼Œå¦‚æœä¸åšç±»å‹æ–­è¨€è¿˜åŸæˆå…·ä½“çš„ç±»å‹ï¼Œå°±æ— æ³•è®¿é—®è¯¥ç±»å‹çš„ä»»ä½•æ–¹æ³•æˆ–å­—æ®µã€‚æ­¤å¤–ï¼ŒGo è¯­è¨€ç›´åˆ° Go 1.18 ç‰ˆæœ¬æ‰å¼•å…¥äº†çœŸæ­£çš„æ³›å‹æ”¯æŒï¼Œè€Œåœ¨æ­¤ä¹‹å‰ï¼Œ<code>interface&#123;&#125;</code> ä¸€ç›´æ˜¯ Go è¯­è¨€å®ç°æ³›å‹ç¼–ç¨‹èƒ½åŠ›çš„ä¸€ç§æœ‰é™æ–¹å¼ã€‚</p><h2 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h2><ol><li><p><strong>å®šä¹‰</strong>:</p><ul><li>æ³›å‹å…è®¸ä½ åœ¨å‡½æ•°ã€æ–¹æ³•æˆ–ç±»å‹å®šä¹‰ä¸­ä½¿ç”¨ç±»å‹å‚æ•°ï¼Œè¿™æ ·å°±å¯ä»¥ç¼–å†™å¯ä»¥å·¥ä½œåœ¨å¤šç§ç±»å‹ä¸Šçš„ä»£ç ï¼Œè€Œæ— éœ€ä¸ºæ¯ç§ç±»å‹é‡å¤å®šä¹‰ä»£ç ã€‚</li><li>ç±»å‹å‚æ•° (Type Parameters)<ul><li><strong><code>T</code></strong>: ä¸€èˆ¬ç”¨äºæ³›å‹å‡½æ•°æˆ–ç±»å‹ä¸­ï¼Œè¡¨ç¤ºä¸€ä¸ªé€šç”¨çš„ç±»å‹å‚æ•°ï¼Œå¯ä»¥ä»£è¡¨ä»»ä½•ç±»å‹ï¼Œåªè¦è¯¥ç±»å‹æ»¡è¶³æ³›å‹å®šä¹‰ä¸­çš„çº¦æŸæ¡ä»¶ã€‚</li><li><strong><code>V</code></strong>: å¸¸ç”¨äºè¡¨ç¤ºæ³›å‹ç»“æ„ä½“æˆ–æ¥å£ä¸­çš„ç¬¬äºŒä¸ªç±»å‹å‚æ•°ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶‰åŠé”®å€¼å¯¹æˆ–è€…å¤šä¸ªç±»å‹çš„ç»„åˆæ—¶ã€‚</li><li><strong><code>K</code></strong>: é€šå¸¸ç”¨äºè¡¨ç¤ºæ˜ å°„(Map)ä¸­çš„é”®ç±»å‹ï¼Œä¸ <code>V</code> ä¸€èµ·ä½¿ç”¨ï¼Œå…¶ä¸­ <code>V</code> è¡¨ç¤ºæ˜ å°„çš„å€¼ç±»å‹ã€‚</li></ul></li></ul></li><li><p><strong>çº¦æŸ (Constraints)</strong>:</p><ul><li><p>æ³›å‹ä¸­çš„ç±»å‹å‚æ•°å¯ä»¥å¸¦æœ‰çº¦æŸï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥æŒ‡å®šç±»å‹å‚æ•°å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼Œä¾‹å¦‚å®ç°ç‰¹å®šçš„æ¥å£ã€‚è¿™å¢å¼ºäº†ç±»å‹å®‰å…¨æ€§ã€‚</p></li><li><p>é¢„å®šä¹‰çº¦æŸ</p><p>Go æ ‡å‡†åº“æä¾›äº†å‡ ä¸ªé¢„å®šä¹‰çš„çº¦æŸæ¥å£ï¼Œç”¨äºæ–¹ä¾¿åœ°æŒ‡å®šç±»å‹å‚æ•°çš„é€šç”¨å±æ€§ï¼š</p><ul><li><strong><code>constraints.Ordered</code></strong>: è¡¨ç¤ºç±»å‹å‚æ•°å¿…é¡»æ˜¯å¯ä»¥æ’åºçš„ï¼Œä¾‹å¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ç­‰ã€‚</li><li><strong><code>constraints.Integer</code></strong>: è¡¨ç¤ºç±»å‹å‚æ•°å¿…é¡»æ˜¯æ•´æ•°ç±»å‹ã€‚</li><li><strong><code>constraints.Float</code></strong>: è¡¨ç¤ºç±»å‹å‚æ•°å¿…é¡»æ˜¯æµ®ç‚¹æ•°ç±»å‹ã€‚</li><li><strong><code>constraints.Complex</code></strong>: è¡¨ç¤ºç±»å‹å‚æ•°å¿…é¡»æ˜¯å¤æ•°ç±»å‹ã€‚</li><li><strong><code>constraints.Signer</code></strong>: è¡¨ç¤ºç±»å‹å‚æ•°å¿…é¡»æ˜¯æœ‰ç¬¦å·æ•°ç±»å‹ã€‚</li></ul></li><li><p>è‡ªå®šä¹‰çº¦æŸ</p><p>å®šä¹‰è‡ªå·±çš„çº¦æŸæ¥å£ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Printable <span class="hljs-keyword">interface</span> &#123;<br>    String() <span class="hljs-type">string</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨æ³›å‹å£°æ˜ä¸­ä½¿ç”¨å®ƒï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Print</span>[<span class="hljs-title">T</span> <span class="hljs-title">Printable</span>]<span class="hljs-params">(t T)</span></span> &#123;<br>    fmt.Println(t.String())<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>å®ä¾‹åŒ–</strong>:</p><ul><li>å½“ä½ ä½¿ç”¨æ³›å‹å‡½æ•°æˆ–ç±»å‹æ—¶ï¼Œä½ å¿…é¡»ä¸ºç±»å‹å‚æ•°æä¾›å…·ä½“çš„ç±»å‹ã€‚ç¼–è¯‘å™¨ä¼šç”Ÿæˆé’ˆå¯¹è¿™äº›å…·ä½“ç±»å‹çš„ä»£ç ï¼Œè¿™ç§°ä¸ºå®ä¾‹åŒ–ã€‚</li></ul></li><li><p><strong>ç¤ºä¾‹</strong>:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä» Go 1.18 å¼€å§‹æ”¯æŒæ³›å‹</span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;golang.org/x/exp/constraints&quot;</span><br>)<br><br><span class="hljs-comment">// PrintValue æ˜¯ä¸€ä¸ªæ³›å‹å‡½æ•°ï¼Œå¯ä»¥æ‰“å°ä»»ä½•å®ç°äº† fmt.Stringer æ¥å£æˆ–åŸºæœ¬ç±»å‹ï¼ˆå¦‚ int, string ç­‰ï¼‰çš„å€¼ã€‚</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintValue</span>[<span class="hljs-title">T</span> <span class="hljs-title">constraints</span>.<span class="hljs-title">Ordered</span> | <span class="hljs-title">any</span>]<span class="hljs-params">(value T)</span></span> &#123;<br>fmt.Println(value)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> anyVar <span class="hljs-keyword">interface</span>&#123;&#125; = <span class="hljs-string">&quot;Hello, World!&quot;</span> <span class="hljs-comment">// å­—ç¬¦ä¸²ç±»å‹</span><br>PrintValue(anyVar)                       <span class="hljs-comment">// è¾“å‡º: Hello, World!</span><br><br>anyVar = <span class="hljs-number">42</span>                              <span class="hljs-comment">// æ•´æ•°ç±»å‹</span><br>PrintValue(anyVar)                       <span class="hljs-comment">// è¾“å‡º: 42</span><br><br>anyVar = <span class="hljs-keyword">struct</span>&#123;&#125;&#123;&#125;                      <span class="hljs-comment">// ç©ºç»“æ„ä½“ç±»å‹</span><br>PrintValue(anyVar)                       <span class="hljs-comment">// è¾“å‡º: &#123;&#125;</span><br><br>anyFunc := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;&#125;                     <span class="hljs-comment">// å‡½æ•°ç±»å‹</span><br><span class="hljs-comment">// æ³¨æ„ï¼šä¸èƒ½ç›´æ¥æ‰“å°å‡½æ•°ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºæ³›å‹å‡½æ•°å¯ä»¥æ¥æ”¶å‡½æ•°ç±»å‹</span><br><span class="hljs-comment">// PrintValue(anyFunc)  // è¿™ä¸€è¡Œä¼šç¼–è¯‘å¤±è´¥ï¼Œå› ä¸ºå‡½æ•°ç±»å‹ä¸èƒ½è½¬æ¢ä¸º fmt.Stringer</span><br><br><span class="hljs-comment">// ä½¿ç”¨æ³›å‹ç›´æ¥å¤„ç†å„ç§ç±»å‹ï¼Œæ— éœ€é€šè¿‡ interface&#123;&#125; ä¸­è½¬</span><br>PrintValue[<span class="hljs-type">string</span>](<span class="hljs-string">&quot;Hello, World!&quot;</span>) <span class="hljs-comment">// è¾“å‡º: Hello, World!</span><br>PrintValue[<span class="hljs-type">int</span>](<span class="hljs-number">42</span>)                <span class="hljs-comment">// è¾“å‡º: 42</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>æ³›å‹å‡½æ•° <code>PrintValue</code></strong>:</p><ul><li><code>PrintValue</code> å‡½æ•°å®šä¹‰äº†ä¸€ä¸ªç±»å‹å‚æ•° <code>T</code>ï¼Œå¹¶ä¸”ä½¿ç”¨äº†è”åˆçº¦æŸ <code>constraints.Ordered | any</code>ã€‚è¿™æ„å‘³ç€ <code>T</code> å¯ä»¥æ˜¯ä»»ä½•æœ‰åºç±»å‹ï¼ˆå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰æˆ–ä»»ä½•ç±»å‹ï¼ˆ<code>any</code>ï¼‰ï¼Œè¿™ä½¿å¾— <code>PrintValue</code> å‡½æ•°å¯ä»¥å¤„ç†éå¸¸å¹¿æ³›çš„ç±»å‹ã€‚</li><li>å‡½æ•°ä½“ä¸­ï¼Œ<code>PrintValue</code> ç›´æ¥ä½¿ç”¨ <code>fmt.Println(value)</code> æ¥æ‰“å°ä¼ å…¥çš„å€¼ã€‚ç”±äº <code>value</code> çš„ç±»å‹æ˜¯ <code>T</code>ï¼Œè¿™æ„å‘³ç€å®ƒèƒ½å¤Ÿæ‰“å°ä»»ä½•ç±»å‹å‚æ•° <code>T</code> å¯ä»¥è¡¨ç¤ºçš„å€¼ã€‚</li></ul></li><li><p><strong>ä½¿ç”¨ <code>interface&#123;&#125;</code></strong>:</p><ul><li>åœ¨ä¸»å‡½æ•°ä¸­ï¼Œ<code>anyVar</code> æ˜¯ä¸€ä¸ª <code>interface&#123;&#125;</code> ç±»å‹çš„å˜é‡ï¼Œå®ƒå¯ä»¥æ¥æ”¶ä»»ä½•ç±»å‹çš„å€¼ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>anyVar</code> ä¼ é€’ç»™ <code>PrintValue</code> å‡½æ•°ï¼Œè¿™æ˜¯å› ä¸º <code>PrintValue</code> çš„ç±»å‹å‚æ•° <code>T</code> å¯ä»¥æ˜¯ <code>any</code>ï¼ŒåŒ…å«äº† <code>interface&#123;&#125;</code> çš„æ‰€æœ‰å¯èƒ½æ€§ã€‚</li></ul></li><li><p><strong>ç›´æ¥ä½¿ç”¨æ³›å‹</strong>:</p><ul><li>åœ¨ç¤ºä¾‹çš„æœ€åéƒ¨åˆ†ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨äº†æ³›å‹å‡½æ•° <code>PrintValue</code> å¤„ç†å…·ä½“ç±»å‹çš„å€¼ï¼Œå¦‚å­—ç¬¦ä¸² <code>&quot;Hello, World!&quot;</code> å’Œæ•´æ•° <code>42</code>ã€‚è¿™å±•ç¤ºäº†æ³›å‹å‡½æ•°çš„çµæ´»æ€§å’Œç±»å‹å®‰å…¨æ€§ï¼Œå› ä¸ºä½ å¿…é¡»åœ¨è°ƒç”¨æ—¶æ˜ç¡®æŒ‡å®šç±»å‹å‚æ•° <code>T</code> çš„å…·ä½“ç±»å‹ã€‚</li></ul></li></ol><ul><li><strong>æ¥å£</strong> æä¾›äº†ç±»å‹é—´çš„å¤šæ€æ€§ï¼Œå…è®¸ä½ ç¼–å†™å¯ä»¥æ¥å—å¤šç§ç±»å‹å‚æ•°çš„å‡½æ•°ï¼Œåªè¦è¿™äº›ç±»å‹å®ç°äº†æŒ‡å®šçš„æ¥å£ã€‚</li><li><strong>æ³›å‹</strong> å…è®¸ä½ ç¼–å†™å¯ä»¥å·¥ä½œåœ¨å¤šç§ç±»å‹ä¸Šçš„ä»£ç ï¼Œé€šè¿‡ç±»å‹å‚æ•°å’Œçº¦æŸæ¥æŒ‡å®šæ³›å‹å‡½æ•°æˆ–ç±»å‹çš„é€‚ç”¨èŒƒå›´ã€‚</li></ul><h2 id="Goè¯­è¨€ä¸­çš„initä½œç”¨"><a href="#Goè¯­è¨€ä¸­çš„initä½œç”¨" class="headerlink" title="Goè¯­è¨€ä¸­çš„initä½œç”¨"></a>Goè¯­è¨€ä¸­çš„initä½œç”¨</h2><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œ<code>init</code> å‡½æ•°æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ï¼Œå®ƒä¸»è¦ç”¨äºåœ¨åŒ…è¢«åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ–åŠ¨ä½œã€‚<code>init</code> å‡½æ•°æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ol><li><strong>è‡ªåŠ¨è°ƒç”¨</strong>ï¼š<code>init</code> å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œä¹Ÿä¸éœ€è¦æ˜¾å¼è°ƒç”¨ã€‚å½“ä¸€ä¸ª Go åŒ…è¢«å¯¼å…¥æ—¶ï¼Œè¯¥åŒ…ä¸­çš„æ‰€æœ‰é¡¶çº§ï¼ˆéå†…åµŒï¼‰<code>init</code> å‡½æ•°ï¼ˆè‹¥æœ‰å¤šä¸ªçš„è¯ï¼‰ä¼šæŒ‰ç…§å®ƒä»¬åœ¨æºä»£ç ä¸­å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</li><li><strong>éšå¼æ‰§è¡Œ</strong>ï¼š<code>init</code> å‡½æ•°ä¸èƒ½è¢«å…¶ä»–å‡½æ•°è°ƒç”¨ï¼Œä¹Ÿæ— æ³•è¢«å¤–éƒ¨å¼•ç”¨ã€‚</li><li><strong>ç”¨äºåˆå§‹åŒ–</strong>ï¼šé€šå¸¸åœ¨ <code>init</code> å‡½æ•°ä¸­æ‰§è¡Œé‚£äº›éœ€è¦åœ¨ç¨‹åºè¿è¡ŒåˆæœŸå®Œæˆçš„å‡†å¤‡å·¥ä½œï¼Œä¾‹å¦‚åˆå§‹åŒ–å…¨å±€å˜é‡ã€è¿æ¥æ•°æ®åº“ã€è®¾ç½®æ—¥å¿—ç³»ç»Ÿã€æ³¨å†Œç³»ç»Ÿç»„ä»¶ç­‰ã€‚</li><li><strong>ä¼˜å…ˆçº§</strong>ï¼š<code>init</code> å‡½æ•°åœ¨ main å‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œå¦‚æœä¸€ä¸ªåŒ…è¢«å¯¼å…¥ï¼Œé‚£ä¹ˆè¯¥åŒ…çš„ <code>init</code> å‡½æ•°å°†åœ¨ main åŒ…çš„ <code>init</code> å‡½æ•°ä¹‹å‰è¿è¡Œã€‚</li></ol><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> example<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">var</span> globalVar = <span class="hljs-string">&quot;Initialized by init&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>    fmt.Println(<span class="hljs-string">&quot;Executing init function in example package&quot;</span>)<br>    <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œåˆå§‹åŒ–æ“ä½œ</span><br>    <span class="hljs-comment">// ä¾‹å¦‚ï¼Œè®¾ç½®å…¨å±€å˜é‡ã€åˆå§‹åŒ–è¿æ¥ã€æ³¨å†Œå‡½æ•°ç­‰</span><br>    globalVar = <span class="hljs-string">&quot;Updated during init&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“å¯¼å…¥ <code>example</code> åŒ…æ—¶ï¼Œ<code>init</code> å‡½æ•°ä¼šè¢«è‡ªåŠ¨æ‰§è¡Œï¼Œå¹¶è¾“å‡ºä¸€æ¡æ¶ˆæ¯ï¼ŒåŒæ—¶æ›´æ–°å…¨å±€å˜é‡ <code>globalVar</code> çš„å€¼ã€‚</p><p><code>setup</code> å‡½æ•°å’Œ <code>init</code> å‡½æ•°åœ¨ Go è¯­è¨€ä¸­éƒ½ç”¨äºåˆå§‹åŒ–ï¼Œä½†å®ƒä»¬ä¹‹é—´æœ‰æ˜æ˜¾çš„åŒºåˆ«ï¼š</p><ol><li><strong>init å‡½æ•°</strong>ï¼š<ul><li>æ˜¯ Go è¯­è¨€å†…ç½®çš„ç‰¹æ®Šå‡½æ•°ï¼Œæ¯ä¸ªåŒ…éƒ½å¯ä»¥æœ‰å¤šä¸ª <code>init</code> å‡½æ•°ï¼Œå®ƒä»¬æ²¡æœ‰è¿”å›å€¼ï¼Œä¹Ÿæ²¡æœ‰æ¥æ”¶è€…ã€‚</li><li><code>init</code> å‡½æ•°åœ¨åŒ…è¢«å¯¼å…¥æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œå¹¶æŒ‰ç…§å®ƒä»¬åœ¨æºç ä¸­çš„å®šä¹‰é¡ºåºæ‰§è¡Œã€‚</li><li><code>init</code> å‡½æ•°ä¸»è¦ç”¨äºåŒ…å†…éƒ¨çš„ä¸€äº›å¿…è¦åˆå§‹åŒ–å·¥ä½œï¼Œä¾‹å¦‚åˆå§‹åŒ–å…¨å±€å˜é‡ã€è®¾ç½®æ—¥å¿—ç³»ç»Ÿã€åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ç­‰ã€‚</li><li>ç”¨æˆ·ä¸èƒ½ç›´æ¥è°ƒç”¨ <code>init</code> å‡½æ•°ï¼Œç”± Go è¯­è¨€è¿è¡Œæ—¶è‡ªåŠ¨æ‰§è¡Œã€‚</li></ul></li><li><strong>setup å‡½æ•°</strong>ï¼š<ul><li>æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„æ™®é€šå‡½æ•°ï¼Œé€šå¸¸ç”¨äºæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–æ¨¡å—çš„ä¸€æ¬¡æ€§åˆå§‹åŒ–å·¥ä½œã€‚</li><li><code>setup</code> å‡½æ•°å¯ä»¥æœ‰è¿”å›å€¼å’Œæ¥æ”¶è€…ï¼Œå…·ä½“å–å†³äºå…¶å®ç°ã€‚</li><li>ç”¨æˆ·éœ€è¦åœ¨åˆé€‚çš„åœ°æ–¹ä¸»åŠ¨è°ƒç”¨ <code>setup</code> å‡½æ•°æ¥å®Œæˆåˆå§‹åŒ–ã€‚</li><li>ç”±äº <code>setup</code> æ˜¯è‡ªå®šä¹‰å‡½æ•°ï¼Œå®ƒçš„åŠŸèƒ½å’Œç”¨é€”æ›´ä¸ºçµæ´»å¤šæ ·ï¼Œå¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯è‡ªè¡Œè®¾è®¡ã€‚</li></ul></li></ol><p>æ€»ç»“ï¼š</p><ul><li><code>init</code> å‡½æ•°æ˜¯ Go è¯­è¨€è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºåœ¨åŒ…åŠ è½½æ—¶è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰§è¡Œæ—¶æœºä¸ç”±ç”¨æˆ·æ§åˆ¶ã€‚</li><li><code>setup</code> å‡½æ•°æ˜¯ç¨‹åºå‘˜è‡ªå®šä¹‰çš„åˆå§‹åŒ–é€»è¾‘ï¼Œæ‰§è¡Œæ—¶æœºå’Œå†…å®¹å®Œå…¨ç”±å¼€å‘è€…å†³å®šï¼Œé€šå¸¸ç”¨äºè¾ƒä¸ºå¤æ‚çš„åˆå§‹åŒ–æµç¨‹æˆ–è·¨åŒ…çš„å…¨å±€åˆå§‹åŒ–æ“ä½œã€‚</li></ul><h2 id="å•åŒå¼•å·"><a href="#å•åŒå¼•å·" class="headerlink" title="å•åŒå¼•å·"></a>å•åŒå¼•å·</h2><ul><li><strong>å•å¼•å· <code>&#39;</code></strong> ç”¨äºè¡¨ç¤ºå•ä¸ª <code>rune</code> ç±»å‹çš„å­—ç¬¦ï¼Œå¸¸ç”¨äºå¤„ç†å•ä¸ªUnicodeç ç‚¹ï¼Œä¸æ”¯æŒè½¬ä¹‰å­—ç¬¦ã€‚</li><li><strong>åŒå¼•å· <code>&quot;</code></strong> ç”¨äºè¡¨ç¤º <code>string</code> ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªå­—ç¬¦åŠè½¬ä¹‰åºåˆ—ï¼Œé€‚åˆå¤„ç†å¤šå­—ç¬¦æ–‡æœ¬å’Œéœ€è¦è½¬ä¹‰çš„åœºæ™¯ã€‚</li></ul><h2 id="åå¼•å·"><a href="#åå¼•å·" class="headerlink" title="åå¼•å·"></a>åå¼•å·</h2><p>åœ¨Goè¯­è¨€ä¸­ï¼Œ&#96;&#96; ç¬¦å·ï¼ˆé€šå¸¸è¢«ç§°ä¸ºåå¼•å·æˆ–èƒŒå¼•å·ï¼‰ç”¨äºåˆ›å»ºä¸€ä¸ª<strong>åŸç”Ÿå­—ç¬¦ä¸²å­—é¢é‡ï¼ˆraw string literalï¼‰</strong>ã€‚åŸç”Ÿå­—ç¬¦ä¸²å­—é¢é‡å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li><strong>åŒ…å›´å­—ç¬¦ä¸²</strong>ï¼šä½¿ç”¨ä¸€å¯¹åå¼•å·ï¼ˆ&#96;&#96;ï¼‰æ¥åŒ…å›´å­—ç¬¦ä¸²å†…å®¹ï¼Œä¸åŒå¼•å·ï¼ˆâ€â€ï¼‰æˆ–å•å¼•å·ï¼ˆâ€™â€™ï¼‰åŒ…å›´çš„å­—ç¬¦ä¸²ä¸åŒã€‚</li><li><strong>ä¸æ”¯æŒè½¬ä¹‰å­—ç¬¦</strong>ï¼šåŸç”Ÿå­—ç¬¦ä¸²å†…éƒ¨çš„ä»»ä½•å­—ç¬¦éƒ½ä¸ä¼šè¢«è§£æä¸ºè½¬ä¹‰åºåˆ—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä½ å†™äº†ç±»ä¼¼ <code>\n</code>ã€<code>\t</code> æˆ– <code>\&quot;</code> è¿™æ ·çš„åºåˆ—ï¼Œå®ƒä»¬ä¹Ÿä¼šè¢«å½“ä½œæ™®é€šå­—ç¬¦å¯¹å¾…ï¼Œä¸ä¼šè½¬æ¢æˆæ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦æˆ–åŒå¼•å·ã€‚</li><li><strong>ä¿ç•™æ¢è¡Œå’Œç©ºæ ¼</strong>ï¼šåŸç”Ÿå­—ç¬¦ä¸²ä¸­åŒ…å«çš„æ‰€æœ‰æ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦å’Œç©ºæ ¼éƒ½å°†åŸæ ·ä¿ç•™ã€‚å½“ä½ éœ€è¦ç¼–å†™å¤šè¡Œæ–‡æœ¬æˆ–è€…åŒ…å«å¤§é‡ç‰¹æ®Šç©ºç™½å­—ç¬¦çš„å­—ç¬¦ä¸²æ—¶ï¼ŒåŸç”Ÿå­—ç¬¦ä¸²ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºæ— éœ€ä½¿ç”¨è½¬ä¹‰åºåˆ—æ¥æ’å…¥è¿™äº›å­—ç¬¦ã€‚</li><li><strong>åŒ…å«ç‰¹æ®Šå­—ç¬¦æ— éšœç¢</strong>ï¼šç”±äºä¸è§£æè½¬ä¹‰å­—ç¬¦ï¼ŒåŸç”Ÿå­—ç¬¦ä¸²å°¤å…¶é€‚åˆåŒ…å«éœ€è¦åŸæ ·è¾“å‡ºçš„ç‰¹æ®Šå­—ç¬¦ã€æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ã€HTMLä»£ç ã€JSONæˆ–XMLç‰‡æ®µç­‰ï¼Œé¿å…äº†å› è½¬ä¹‰å¯¼è‡´çš„æ··æ·†æˆ–é”™è¯¯ã€‚</li></ol><p>ç¤ºä¾‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// åŸç”Ÿå­—ç¬¦ä¸²å­—é¢é‡</span><br>sqlQuery := <span class="hljs-string">`</span><br><span class="hljs-string">    SELECT id, name, email</span><br><span class="hljs-string">    FROM users</span><br><span class="hljs-string">    WHERE active = true</span><br><span class="hljs-string">`</span><br><br>regexPattern := <span class="hljs-string">`^https?://[a-zA-Z0-9._-]+(\.[a-zA-Z]&#123;2,&#125;)+/`</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼š</p><ul><li><code>sqlQuery</code> æ˜¯ä¸€ä¸ªå¤šè¡ŒSQLæŸ¥è¯¢è¯­å¥ï¼ŒåŸç”Ÿå­—ç¬¦ä¸²ç¡®ä¿äº†æ¢è¡Œç¬¦è¢«æ­£ç¡®åœ°åŒ…å«åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œä½¿å¾—æŸ¥è¯¢è¯­å¥æ ¼å¼æ¸…æ™°ä¸”æ— éœ€æ‰‹åŠ¨æ·»åŠ  <code>\n</code> è½¬ä¹‰åºåˆ—ã€‚</li><li><code>regexPattern</code> æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå…¶ä¸­çš„æ–œçº¿ï¼ˆ<code>/</code>ï¼‰å’Œç‰¹æ®Šå­—ç¬¦æ— éœ€è½¬ä¹‰ï¼Œç›´æ¥å†™å…¥åŸç”Ÿå­—ç¬¦ä¸²å³å¯ã€‚</li></ul><p>æ€»ä¹‹ï¼Œåœ¨Goè¯­è¨€ä¸­ï¼Œ&#96;&#96; ç¬¦å·ç”¨äºåˆ›å»ºåŸç”Ÿå­—ç¬¦ä¸²å­—é¢é‡ï¼Œæä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥ç¼–å†™åŒ…å«å¤æ‚æˆ–ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œä¸”æ— éœ€è€ƒè™‘è½¬ä¹‰é—®é¢˜ã€‚è¿™å¯¹äºéœ€è¦ä¿ç•™åŸå§‹æ–‡æœ¬æ ¼å¼æˆ–åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„åœºæ™¯å°¤ä¸ºæœ‰ç”¨ã€‚</p><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><h3 id="1-åŒ¿åå‡½æ•°"><a href="#1-åŒ¿åå‡½æ•°" class="headerlink" title="1.åŒ¿åå‡½æ•° "></a>1.åŒ¿åå‡½æ•°<code> </code></h3><ul><li><p>æœ‰æ—¶å€™æˆ‘ä»¬æƒ³è¦å®ŒæˆæŸä¸€ç‰¹å®šåŠŸèƒ½ï¼Œä½†è¯¥åŠŸèƒ½åªåœ¨ä¸€ä¸ªåŒ…ä¸­ç”¨åˆ°å‡ æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨å°†å…¶å°è£…ä¸ºåŒ…çº§åˆ«çš„å‡½æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨åŒ¿åå‡½æ•°</p></li><li><p>åŒ¿åå‡½æ•°ï¼Œå°±æ˜¯å¯ä»¥çœç•¥å‡½æ•°åçš„å‡½æ•°</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">r := <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(i <span class="hljs-type">int</span>)</span></span><span class="hljs-type">int</span>&#123; <span class="hljs-comment">// åŒ¿åå‡½æ•°ä¸éœ€è¦å‡½æ•°å</span><br><span class="hljs-keyword">return</span> i<br>&#125;(<span class="hljs-number">5</span>) <span class="hljs-comment">// åŒ¿åå‡½æ•°é€šè¿‡åé¢çš„()å‘å‡½æ•°ä¼ å‚</span><br>fmt.Println(r) <span class="hljs-comment">// è¾“å‡º5</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="2-å›è°ƒå‡½æ•°"><a href="#2-å›è°ƒå‡½æ•°" class="headerlink" title="2.å›è°ƒå‡½æ•°"></a>2.å›è°ƒå‡½æ•°</h3><p>goè¯­è¨€æ˜¯ä¸€ç§å¼ºç±»å‹è¯­è¨€ï¼Œæˆ‘ä»¬çŸ¥é“äº†å‡½æ•°çš„ç±»å‹ï¼Œå°±å¯ä»¥å°†å…¶ä½œä¸ºå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°,æˆ‘ä»¬ç§°è¿™ç§å‡½æ•°ä¸ºå›è°ƒå‡½æ•°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br> <br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br> <br><span class="hljs-keyword">type</span> FuncType <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> <span class="hljs-comment">//å…ˆç”¨FuncTypeä»£è¡¨æœ‰ä¸¤ä¸ªintå‹å‚æ•°å’Œæœ‰ä¸€ä¸ªintå‹è¿”å›å€¼çš„å‡½æ•°ï¼Œä¸ç”¨ç®¡è¯¥å‡½æ•°æ˜¯å¦å­˜åœ¨</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> &#123; <span class="hljs-comment">//åŠ æ³•</span><br><span class="hljs-keyword">return</span> a + b<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">minus</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> &#123; <span class="hljs-comment">//å‡æ³•</span><br><span class="hljs-keyword">return</span> a - b<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">multiple</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> &#123; <span class="hljs-comment">//ä¹˜æ³•</span><br><span class="hljs-keyword">return</span> a * b<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">divide</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> &#123; <span class="hljs-comment">//é™¤æ³•</span><br><span class="hljs-keyword">return</span> a / b<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Calculate</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>, fType FuncType)</span></span> (result <span class="hljs-type">int</span>) &#123; <span class="hljs-comment">//fTypeè¡¨ç¤ºä¸€ä¸ªå‡½æ•°ç±»å‹å˜é‡</span><br>result = fType(a, b)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> x, y <span class="hljs-type">int</span><br>fmt.Print(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸¤ä¸ªæ•°ï¼š&quot;</span>)<br>fmt.Scan(&amp;x, &amp;y)<br>fmt.Println(<span class="hljs-string">&quot;è¿™ä¸¤ä¸ªæ•°ä¹‹å’Œä¸ºï¼š&quot;</span>, Calculate(x, y, add))<br>fmt.Println(<span class="hljs-string">&quot;è¿™ä¸¤ä¸ªæ•°ä¹‹å·®ä¸ºï¼š&quot;</span>, Calculate(x, y, minus))<br>fmt.Println(<span class="hljs-string">&quot;è¿™ä¸¤ä¸ªæ•°ä¹‹ç§¯ä¸ºï¼š&quot;</span>, Calculate(x, y, multiple))<br>fmt.Println(<span class="hljs-string">&quot;è¿™ä¸¤ä¸ªæ•°ä¹‹å•†ä¸ºï¼š&quot;</span>, Calculate(x, y, divide))<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-é—­åŒ…"><a href="#3-é—­åŒ…" class="headerlink" title="3.é—­åŒ…"></a>3.é—­åŒ…</h3><p>åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è¿”å›å€¼æ˜¯å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºé—­åŒ…ã€‚</p><ul><li><p>é—­åŒ…çš„ç†è§£ï¼šå†…éƒ¨å‡½æ•°è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡</p></li><li><p>é—­åŒ…çš„ä½œç”¨ï¼šæ”¹å˜ä¸´æ—¶å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ</p></li><li><p>é—­åŒ…ç¤ºä¾‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// è€ƒè™‘è¿™æ ·ä¸€ç§åº”ç”¨åœºæ™¯ï¼Œå…¬å¸å…¶ä»–éƒ¨é—¨çš„åŒäº‹æä¾›ç»™ä½ API,è¯¥APIè¦æ±‚è¾“å…¥å‚æ•°ä¸ºä¸€ä¸ªfunc()ç±»å‹(æ— å‚æ•°æ— è¿”å›å€¼)</span><br><span class="hljs-comment">// ç°åœ¨ä½ æœ‰ä¸€ä¸ªfunc(i int)ç±»å‹çš„å‡½æ•°ï¼Œå¦‚ä½•æ‰èƒ½è°ƒç”¨ä¸Šè¿°çš„APIå‘¢ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°é—­åŒ…</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f6</span><span class="hljs-params">(f <span class="hljs-keyword">func</span>()</span></span>)&#123;<br>fmt.Println(<span class="hljs-string">&quot;I am f6()&quot;</span>)<br>f()<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f7</span><span class="hljs-params">(i <span class="hljs-type">int</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-comment">// å¯ä»¥çœ‹åˆ°ï¼Œè¯¥åŒ¿åå‡½æ•°ä¸­å¹¶æ²¡æœ‰å…³äºå˜é‡içš„å£°æ˜ä¸å®šä¹‰ï¼Œå®ƒå¼•ç”¨äº†å¤–éƒ¨f7()çš„å˜é‡ï¼Œå»¶é•¿äº†å˜é‡içš„ç”Ÿå‘½å‘¨æœŸ</span><br>fmt.Printf(<span class="hljs-string">&quot;I am f7(),i have a parameter:%v\n&quot;</span>,i)<br>&#125;<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    f6(f7(<span class="hljs-number">9</span>)) <span class="hljs-comment">// è¾“å‡º:I am f6() \n I am f7(),i have a parameter:9</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="4-é€’å½’"><a href="#4-é€’å½’" class="headerlink" title="4.é€’å½’"></a>4.é€’å½’</h3><ul><li><p>å‡½æ•°åœ¨å¤„ç†è¿‡ç¨‹ä¸­è°ƒç”¨è‡ªèº«ï¼Œç§°ä¹‹ä¸ºé€’å½’ã€‚</p></li><li><p>é€’å½’å¿…é¡»æœ‰ç»“æŸæ¡ä»¶ï¼Œå¦åˆ™ä¼šé™·å…¥æ­»å¾ªç¯ã€‚</p></li><li><p>ä½¿ç”¨é€’å½’å‰ï¼Œæœ€å¥½æŠŠé—®é¢˜è¿›è¡Œæ•°å­¦æŠ½è±¡</p></li><li><p>é€’å½’ç¤ºä¾‹ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// é¦–å…ˆè¿›è¡Œæ•°å­¦æŠ½è±¡ï¼Œæ˜ç¡®è¯¥å‡½æ•°è¿”å›å€¼çš„æ„ä¹‰</span><br><span class="hljs-comment">// è¯¥å‡½æ•°è¿”å›å€¼æ˜¯æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸­ç¬¬iä¸ªä½ç½®çš„å€¼</span><br><span class="hljs-comment">// æ ¹æ®æ–æ³¢é‚£å¥‘æ•°åˆ—çš„æ•°å­¦è§„å¾‹ï¼Œæˆ‘ä»¬çŸ¥é“ç¬¬iä¸ªä½ç½®çš„å€¼ç­‰äºå…¶å‰ä¸¤ä¸ªä½ç½®å€¼ä¹‹å’Œï¼Œå³fibonacci(i-1)+fibonacci(i-2)</span><br><span class="hljs-comment">// å½“å¤„äºç¬¬ä¸€æˆ–ç¬¬äºŒä¸ªä½ç½®æ—¶ï¼Œç”±äºå…¶å‰é¢ä¸è¶³ä¸¤ä¸ªå…ƒç´ ï¼Œå› æ­¤è¦å•ç‹¬è€ƒè™‘</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fibonacci</span><span class="hljs-params">(i <span class="hljs-type">int</span>)</span></span><span class="hljs-type">int</span>&#123;<br><span class="hljs-keyword">if</span> i &lt;= <span class="hljs-number">2</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>&#125;<br><span class="hljs-keyword">return</span> fibonacci(i<span class="hljs-number">-1</span>)+fibonacci(i<span class="hljs-number">-2</span>)<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">for</span> i:=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">10</span>;i++&#123;<br>fmt.Printf(<span class="hljs-string">&quot;%v &quot;</span>,fibonacci(i)) <span class="hljs-comment">// è¾“å‡ºï¼š1 1 2 3 5 8 13 21 34 55</span><br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å‡½æ•°ï¼ˆFunctionï¼‰ï¼šåœ¨åŒ…çº§åˆ«å®šä¹‰ï¼Œä¸ä¾èµ–äºç‰¹å®šçš„æ¥æ”¶è€…ï¼ˆreceiverï¼‰ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ã€‚</p></li><li><p>æ–¹æ³•ï¼ˆMethodï¼‰ï¼šä¸ä¸€ä¸ªå…·ä½“ç±»å‹ç›¸å…³è”ï¼Œå®šä¹‰åœ¨ç±»å‹å†…éƒ¨ï¼Œå¹¶æœ‰ä¸€ä¸ªæ¥æ”¶è€…ï¼ˆreceiverï¼‰å‚æ•°ï¼Œé€šå¸¸ç”¨æ¥æ‰©å±•ç±»å‹çš„è¡Œä¸ºã€‚</p></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-string">``</span><span class="hljs-string">`</span><br><span class="hljs-string"></span><br><span class="hljs-string">## èµ‹å€¼</span><br><span class="hljs-string"></span><br><span class="hljs-string">`</span><span class="hljs-string">``</span><span class="hljs-keyword">go</span><br><span class="hljs-keyword">type</span> DevUser <span class="hljs-keyword">struct</span> &#123;<br>ID    <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;id&quot;`</span><br>Name  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name&quot;`</span><br>Email <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;email&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><ol><li>var createUser DevUserå£°æ˜äº†ä¸€ä¸ªæœªåˆå§‹åŒ–çš„<code>DevUser</code>å˜é‡<code>createUser</code>ï¼Œå…¶å†…éƒ¨æ‰€æœ‰å­—æ®µçš„å€¼å‡ä¸ºå„è‡ªç±»å‹çš„é›¶å€¼ã€‚</li><li>createUser :&#x3D; DevUser{}    ä½¿ç”¨äº†ç®€çŸ­å˜é‡å£°æ˜ï¼ˆshort variable declarationï¼‰<code>:=</code>ï¼ŒåŒæ—¶å®Œæˆäº†å˜é‡å£°æ˜å’Œåˆå§‹åŒ–ã€‚è¿™é‡Œ<code>createUser</code>å˜é‡è¢«èµ‹äºˆäº†ä¸€ä¸ª<code>DevUser</code>ç±»å‹çš„é›¶å€¼å®ä¾‹ï¼Œå³ä¸€ä¸ªæ‰€æœ‰å­—æ®µå‡ä¸ºé›¶å€¼çš„æ–°<code>DevUser</code>å¯¹è±¡ã€‚<code>DevUser&#123;&#125;</code>æ˜¯åˆ›å»ºä¸€ä¸ªç©ºç»“æ„ä½“å®ä¾‹çš„å†™æ³•ï¼Œç›¸å½“äºè°ƒç”¨äº†<code>DevUser</code>ç±»å‹çš„é›¶å€¼æ„é€ å‡½æ•°ã€‚</li></ol><p><strong>æ€»ç»“</strong></p><ul><li><strong>æƒ…å†µä¸€</strong>ä¸­ï¼Œ<code>createUser</code>å˜é‡æœªè¢«åˆå§‹åŒ–ï¼Œå…¶å†…éƒ¨å­—æ®µå€¼ä¸ºå„è‡ªçš„é›¶å€¼ã€‚</li><li><strong>æƒ…å†µäºŒ</strong>ä¸­ï¼Œ<code>createUser</code>å˜é‡è¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªæ‰€æœ‰å­—æ®µå‡ä¸ºé›¶å€¼çš„<code>DevUser</code>å®ä¾‹ã€‚</li></ul><h2 id="å¼•ç”¨ä¼ é€’å’Œå€¼ä¼ é€’"><a href="#å¼•ç”¨ä¼ é€’å’Œå€¼ä¼ é€’" class="headerlink" title="å¼•ç”¨ä¼ é€’å’Œå€¼ä¼ é€’"></a>å¼•ç”¨ä¼ é€’å’Œå€¼ä¼ é€’</h2><p><strong>å€¼ä¼ é€’</strong></p><p>åœ¨ Go ä¸­ï¼Œå½“å‡½æ•°è°ƒç”¨å‘ç”Ÿæ—¶ï¼Œæ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚è¿™æ„å‘³ç€å‡½æ•°æ¥æ”¶åˆ°çš„æ˜¯å‚æ•°çš„å€¼çš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯åŸå§‹å€¼æœ¬èº«ã€‚å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚ <code>int</code>, <code>float</code>, <code>bool</code>, <code>string</code> ç­‰ï¼‰ï¼Œè¿™é€šå¸¸æ„å‘³ç€åˆ›å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å‰¯æœ¬ï¼Œå¯¹å‡½æ•°å†…çš„å‚æ•°æ‰€åšçš„ä»»ä½•ä¿®æ”¹éƒ½ä¸ä¼šå½±å“åˆ°å¤–éƒ¨çš„åŸå§‹å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-comment">// å½¢å‚ä¸º intç±»å‹çš„ x</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addOne</span><span class="hljs-params">(x <span class="hljs-type">int</span>)</span></span> &#123;<br>    x++<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    n := <span class="hljs-number">10</span><br>    <span class="hljs-comment">// å®å‚ä¸º n</span><br>    addOne(n)<br>    fmt.Println(n) <span class="hljs-comment">// è¾“å‡º 10</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¼•ç”¨ä¼ é€’ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ç§å…±äº«å¼•ç”¨ï¼‰</strong></p><p>å°½ç®¡ Go æ²¡æœ‰çœŸæ­£çš„â€œå¼•ç”¨ä¼ é€’â€ï¼Œä½†åœ¨å¤„ç†å¤åˆç±»å‹ï¼ˆå¦‚åˆ‡ç‰‡ã€mapã€channel å’Œæ¥å£ï¼‰æ—¶ï¼Œæƒ…å†µæœ‰æ‰€ä¸åŒã€‚å½“ä¼ é€’è¿™äº›ç±»å‹æ—¶ï¼Œå®é™…ä¸Šæ˜¯ä¼ é€’äº†æŒ‡å‘è¿™äº›å¤åˆç±»å‹æ•°æ®çš„å¼•ç”¨ã€‚è¿™æ„å‘³ç€ï¼Œè™½ç„¶å‡½æ•°å†…éƒ¨çš„æ“ä½œæ˜¯åœ¨å±€éƒ¨å˜é‡ä¸Šè¿›è¡Œçš„ï¼Œä½†ç”±äºè¿™äº›å±€éƒ¨å˜é‡æŒæœ‰åŸå§‹æ•°æ®çš„å¼•ç”¨ï¼Œæ‰€ä»¥å¯¹å®ƒä»¬çš„ä¿®æ”¹ä¼šå½±å“åˆ°å¤–éƒ¨çš„åŸå§‹æ•°æ®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">appendItem</span><span class="hljs-params">(slice []<span class="hljs-type">int</span>)</span></span> &#123;<br>    slice = <span class="hljs-built_in">append</span>(slice, <span class="hljs-number">42</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    numbers := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>    appendItem(numbers)<br>    fmt.Println(numbers) <span class="hljs-comment">// è¾“å‡º [1 2 3 42]</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æŒ‡é’ˆçš„ä½¿ç”¨</strong></p><p>ä¸ºäº†åœ¨å‡½æ•°é—´ä¼ é€’å¼•ç”¨å¹¶å…è®¸ç›´æ¥ä¿®æ”¹åŸå§‹æ•°æ®ï¼ŒGo æ”¯æŒæŒ‡é’ˆç±»å‹ã€‚å½“ä½ å°†ä¸€ä¸ªæŒ‡é’ˆä¼ é€’ç»™å‡½æ•°æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯ä¼ é€’äº†æŒ‡å‘æŸä¸ªå€¼çš„åœ°å€ï¼Œè¿™å…è®¸å‡½æ•°ç›´æ¥ä¿®æ”¹é‚£ä¸ªå€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> Point <span class="hljs-keyword">struct</span> &#123;<br>    X, Y <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">movePoint</span><span class="hljs-params">(p *Point)</span></span> &#123;<br>    p.X++<br>    p.Y++<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    pt := Point&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;<br>    movePoint(&amp;pt)<br>    fmt.Println(pt) <span class="hljs-comment">// è¾“å‡º &#123;2 3&#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>åˆå§‹åŒ–å’Œæ²¡æœ‰åˆå§‹åŒ–çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨å˜é‡æˆ–å¯¹è±¡çš„çŠ¶æ€ä»¥åŠå…¶åœ¨ç¨‹åºä¸­çš„å¯ç”¨æ€§æ–¹é¢ã€‚ä¸‹é¢æ˜¯è¯¦ç»†çš„å¯¹æ¯”ï¼š</p><p><strong>æœªåˆå§‹åŒ–ï¼š</strong></p><ol><li><strong>çŠ¶æ€æœªçŸ¥</strong>ï¼šå½“ä¸€ä¸ªå˜é‡æ²¡æœ‰ç»è¿‡åˆå§‹åŒ–æ—¶ï¼Œå®ƒçš„å€¼æ˜¯ä¸ç¡®å®šçš„ã€‚åœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­ï¼ˆå¦‚Cã€C++ã€Javaã€Goç­‰ï¼‰ï¼Œæœªåˆå§‹åŒ–çš„å˜é‡ä¼šæŒæœ‰å…¶ç±»å‹çš„é»˜è®¤å€¼ï¼ˆé€šå¸¸ç§°ä¸ºé›¶å€¼ï¼‰ï¼Œå¦‚æ•´å‹ä¸º0ã€æµ®ç‚¹å‹ä¸º0.0ã€å¸ƒå°”å‹ä¸ºfalseã€å­—ç¬¦ä¸²ä¸ºâ€â€ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ã€æŒ‡é’ˆä¸ºnilç­‰ã€‚å°½ç®¡è¿™äº›é»˜è®¤å€¼æœ‰ä¸€å®šçš„è§„å¾‹ï¼Œä½†å¯¹äºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼ˆå¦‚ç»“æ„ä½“ã€ç±»ç­‰ï¼‰æˆ–ç‰¹å®šæƒ…å†µä¸‹çš„å†…ç½®ç±»å‹ï¼Œæœªåˆå§‹åŒ–çš„å€¼å¯èƒ½å¹¶ä¸ç¬¦åˆé¢„æœŸï¼Œç”šè‡³å¯èƒ½å¯¼è‡´ç¨‹åºé€»è¾‘é”™è¯¯æˆ–è¿è¡Œæ—¶å¼‚å¸¸ã€‚</li><li><strong>ä¸å¯é ä½¿ç”¨</strong>ï¼šæœªåˆå§‹åŒ–çš„å˜é‡å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œç›´æ¥ä½¿ç”¨è¿™æ ·çš„å˜é‡ä¼šå¯¼è‡´ç¨‹åºè¡Œä¸ºä¸å¯é¢„æµ‹ã€‚ä¾‹å¦‚ï¼Œå¯¹æœªåˆå§‹åŒ–çš„å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ã€å¯¹æœªåˆå§‹åŒ–çš„æ•°å€¼è¿›è¡Œè®¡ç®—ï¼Œæˆ–è€…å¯¹æœªåˆå§‹åŒ–çš„æŒ‡é’ˆè¿›è¡Œè§£å¼•ç”¨ç­‰ï¼Œéƒ½å¯èƒ½å¯¼è‡´é”™è¯¯çš„ç»“æœæˆ–ç¨‹åºå´©æºƒã€‚</li><li><strong>èµ„æºç®¡ç†é—®é¢˜</strong>ï¼šå¯¹äºä¸€äº›éœ€è¦åˆ†é…å’Œç®¡ç†èµ„æºï¼ˆå¦‚å†…å­˜ã€æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ç­‰ï¼‰çš„å˜é‡ï¼ˆå¦‚åŠ¨æ€åˆ†é…çš„æ•°ç»„ã€æ‰“å¼€çš„æ–‡ä»¶ã€åˆ›å»ºçš„æ•°æ®åº“è¿æ¥ç­‰ï¼‰ï¼Œæœªåˆå§‹åŒ–å¯èƒ½å¯¼è‡´èµ„æºæ³„éœ²ï¼Œå› ä¸ºæ²¡æœ‰æ˜ç¡®çš„åˆå§‹åŒ–è¿‡ç¨‹æ¥ç¡®ä¿èµ„æºçš„åˆç†åˆ†é…å’Œé‡Šæ”¾ã€‚</li><li><strong>ç¼–ç¨‹è§„èŒƒä¸è°ƒè¯•éš¾åº¦</strong>ï¼šæœªåˆå§‹åŒ–çš„å˜é‡è¿åäº†è‰¯å¥½çš„ç¼–ç¨‹å®è·µï¼Œä½¿å¾—ä»£ç éš¾ä»¥é˜…è¯»ã€ç†è§£å’Œç»´æŠ¤ã€‚æœªåˆå§‹åŒ–çš„å˜é‡åœ¨è°ƒè¯•æ—¶ä¹Ÿæ›´éš¾è¿½è¸ªå…¶çŠ¶æ€å˜åŒ–ï¼Œå¢åŠ äº†å®šä½é—®é¢˜çš„å¤æ‚åº¦ã€‚</li></ol><p><strong>åˆå§‹åŒ–ï¼š</strong></p><ol><li><strong>ç¡®å®šçŠ¶æ€</strong>ï¼šåˆå§‹åŒ–åçš„å˜é‡å…·æœ‰æ˜ç¡®çš„åˆå§‹å€¼ï¼Œè¿™ä¸ªå€¼ç”±ç¨‹åºå‘˜åœ¨å£°æ˜å˜é‡æ—¶æ˜¾å¼æŒ‡å®šæˆ–é€šè¿‡æ„é€ å‡½æ•°ã€åˆå§‹åŒ–å™¨ç­‰æœºåˆ¶èµ‹äºˆã€‚åˆå§‹åŒ–ç¡®ä¿äº†å˜é‡åœ¨ä½¿ç”¨å‰å·²ç»æœ‰äº†ä¸€ä¸ªé¢„æœŸçš„ã€æœ‰æ„ä¹‰çš„å€¼ã€‚</li><li><strong>å¯é ä½¿ç”¨</strong>ï¼šåˆå§‹åŒ–åçš„å˜é‡å¯ä»¥ç›´æ¥åœ¨ç¨‹åºä¸­å®‰å…¨ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼æ˜¯å·²çŸ¥ä¸”ç¬¦åˆé¢„æœŸçš„ã€‚è¿™æœ‰åŠ©äºä¿è¯ç¨‹åºé€»è¾‘çš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚</li><li><strong>èµ„æºæœ‰æ•ˆç®¡ç†</strong>ï¼šå¯¹äºéœ€è¦ç®¡ç†èµ„æºçš„å˜é‡ï¼Œåˆå§‹åŒ–è¿‡ç¨‹é€šå¸¸ä¼šä¼´éšç€èµ„æºçš„æ­£ç¡®åˆ†é…å’Œè®¾ç½®åˆå§‹çŠ¶æ€ã€‚è¿™æ ·å¯ä»¥é¿å…èµ„æºæ³„éœ²ï¼Œç¡®ä¿ç¨‹åºèµ„æºçš„æœ‰æ•ˆåˆ©ç”¨å’Œæ­£ç¡®æ¸…ç†ã€‚</li><li><strong>éµå¾ªç¼–ç¨‹è§„èŒƒä¸æ˜“äºè°ƒè¯•</strong>ï¼šåˆå§‹åŒ–å˜é‡éµå¾ªäº†è‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œä½¿å¾—ä»£ç æ›´å…·å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ã€‚åˆå§‹åŒ–çš„å˜é‡åœ¨è°ƒè¯•æ—¶ï¼Œå…¶çŠ¶æ€å˜åŒ–æ›´ä¸ºæ¸…æ™°ï¼Œæœ‰åŠ©äºå¿«é€Ÿè¯†åˆ«å’Œè§£å†³é—®é¢˜ã€‚</li></ol><p>æ€»ä¹‹ï¼Œåˆå§‹åŒ–ä¸æœªåˆå§‹åŒ–çš„ä¸»è¦åŒºåˆ«åœ¨äºå˜é‡æ˜¯å¦å…·æœ‰æ˜ç¡®ã€é¢„æœŸçš„åˆå§‹å€¼ï¼Œä»¥åŠç”±æ­¤å¸¦æ¥çš„å¯¹ç¨‹åºè¡Œä¸ºçš„å¯é¢„æµ‹æ€§ã€èµ„æºç®¡ç†çš„æ­£ç¡®æ€§ã€ä»£ç è´¨é‡çš„æå‡ä»¥åŠè°ƒè¯•éš¾åº¦çš„é™ä½ã€‚åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œåº”å§‹ç»ˆç¡®ä¿å˜é‡åœ¨ä½¿ç”¨å‰å¾—åˆ°é€‚å½“çš„åˆå§‹åŒ–ã€‚</p><h2 id="rangeå¾ªç¯"><a href="#rangeå¾ªç¯" class="headerlink" title="rangeå¾ªç¯"></a>rangeå¾ªç¯</h2><ul><li>rangeå¾ªç¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šæ‹·è´ä¸€ä»½åˆ°å˜é‡ä¸­</li><li>ä¿®æ”¹å˜é‡å†…éƒ¨å€¼ä¸å½±å“åŸç»“æ„ä½“</li><li>åº”ä½¿ç”¨ç´¢å¼•ç›´æ¥æ“ä½œåŸå§‹ç»“æ„ä½“å¯¹åº”å…ƒç´ </li><li>è¿™æ ·æ‰èƒ½å®ç°æ›´æ–°åŸå§‹æ•°æ®</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">for</span> i, field := <span class="hljs-keyword">range</span> schemaMeta.Fields &#123;<br><span class="hljs-keyword">if</span> field.FieldPath == <span class="hljs-string">&quot;CSZ10&quot;</span> &#123;<br><span class="hljs-keyword">var</span> newTerms []<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;<br><span class="hljs-keyword">for</span> _, term := <span class="hljs-keyword">range</span> field.GlossaryTerms.Terms &#123;<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;urn:li:glossaryTerm:ç½‘ç»œèº«ä»½æ ‡è¯†&quot;</span> != term[<span class="hljs-string">&quot;urn&quot;</span>] &#123;<br>newTerms = <span class="hljs-built_in">append</span>(newTerms, term)<br>&#125;<br>&#125;<br>fmt.Println(newTerms)<br>schemaMeta.Fields[i].GlossaryTerms.Terms = newTerms<br><span class="hljs-comment">//field.GlossaryTerms.Terms = newTerms</span><br>fmt.Println(schemaMeta.Fields[i].GlossaryTerms.Terms)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="strconvåŒ…è½¬æ¢ç±»å‹"><a href="#strconvåŒ…è½¬æ¢ç±»å‹" class="headerlink" title="strconvåŒ…è½¬æ¢ç±»å‹"></a>strconvåŒ…è½¬æ¢ç±»å‹</h2><p><strong>å­—ç¬¦ä¸²è½¬æ•´æ•°ï¼š</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// å­—ç¬¦ä¸²è½¬æ•´æ•°</span><br>str := <span class="hljs-string">&quot;123&quot;</span><br>i, err := strconv.Atoi(str)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;è½¬æ¢å¤±è´¥ï¼š&quot;</span>, err)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ï¼š&quot;</span>, i)<br>&#125;<br><br><span class="hljs-comment">// å¤§æ•´æ•°è½¬æ¢</span><br>bigStr := <span class="hljs-string">&quot;12345678901234567890&quot;</span><br>bigInt, err := strconv.ParseInt(bigStr, <span class="hljs-number">10</span>, <span class="hljs-number">64</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;å¤§æ•´æ•°è½¬æ¢å¤±è´¥ï¼š&quot;</span>, err)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;å¤§å­—ç¬¦ä¸²è½¬æ¢ä¸º int64 æ•´æ•°ï¼š&quot;</span>, bigInt)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ•´æ•°è½¬å­—ç¬¦ä¸²</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// æ•´æ•°è½¬å­—ç¬¦ä¸²</span><br>num := <span class="hljs-number">456</span><br>str := strconv.Itoa(num)<br>fmt.Println(<span class="hljs-string">&quot;æ•´æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼š&quot;</span>, str)<br><br><span class="hljs-comment">// int64 è½¬å­—ç¬¦ä¸²</span><br>bigNum := <span class="hljs-type">int64</span>(<span class="hljs-number">12345678901234567890</span>)<br>bigStr := strconv.FormatInt(bigNum, <span class="hljs-number">10</span>)<br>fmt.Println(<span class="hljs-string">&quot;int64 æ•´æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼š&quot;</span>, bigStr)<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å­—ç¬¦ä¸²è½¬æµ®ç‚¹æ•°</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// å­—ç¬¦ä¸²è½¬æµ®ç‚¹æ•°</span><br>floatStr := <span class="hljs-string">&quot;3.14&quot;</span><br>f, err := strconv.ParseFloat(floatStr, <span class="hljs-number">64</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;è½¬æ¢å¤±è´¥ï¼š&quot;</span>, err)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;å­—ç¬¦ä¸²è½¬æ¢ä¸ºæµ®ç‚¹æ•°ï¼š&quot;</span>, f)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æµ®ç‚¹æ•°è½¬å­—ç¬¦ä¸²</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// æµ®ç‚¹æ•°è½¬å­—ç¬¦ä¸²</span><br>pi := <span class="hljs-number">3.141592653589793238</span><br>formatStr := strconv.FormatFloat(pi, <span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">64</span>) <span class="hljs-comment">// &#x27;f&#x27; è¡¨ç¤ºå›ºå®šç²¾åº¦æ¨¡å¼ï¼Œ-1 è¡¨ç¤ºä½¿ç”¨é»˜è®¤ç²¾åº¦</span><br>fmt.Println(<span class="hljs-string">&quot;æµ®ç‚¹æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼š&quot;</span>, formatStr)<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å­—ç¬¦ä¸²è½¬å¸ƒå°”å€¼</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// å­—ç¬¦ä¸²è½¬å¸ƒå°”å€¼</span><br>boolStr := <span class="hljs-string">&quot;true&quot;</span><br>b, err := strconv.ParseBool(boolStr)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;è½¬æ¢å¤±è´¥ï¼š&quot;</span>, err)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼š&quot;</span>, b)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¸ƒå°”å€¼è½¬å­—ç¬¦ä¸²</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// å¸ƒå°”å€¼è½¬å­—ç¬¦ä¸²</span><br>flag := <span class="hljs-literal">true</span><br>str := strconv.FormatBool(flag)<br>fmt.Println(<span class="hljs-string">&quot;å¸ƒå°”å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼š&quot;</span>, str)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="reflectæ‰“å°å˜é‡ç±»å‹"><a href="#reflectæ‰“å°å˜é‡ç±»å‹" class="headerlink" title="reflectæ‰“å°å˜é‡ç±»å‹"></a>reflectæ‰“å°å˜é‡ç±»å‹</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> a <span class="hljs-type">int</span> = <span class="hljs-number">10</span><br><span class="hljs-keyword">var</span> b <span class="hljs-type">string</span> = <span class="hljs-string">&quot;hello&quot;</span><br><span class="hljs-keyword">var</span> c <span class="hljs-type">bool</span> = <span class="hljs-literal">true</span><br><br><span class="hljs-comment">// æ‰“å°å˜é‡ aã€b å’Œ c çš„ç±»å‹</span><br>fmt.Printf(<span class="hljs-string">&quot;a çš„ç±»å‹æ˜¯: %s\n&quot;</span>, reflect.TypeOf(a).Name())<br>fmt.Printf(<span class="hljs-string">&quot;b çš„ç±»å‹æ˜¯: %s\n&quot;</span>, reflect.TypeOf(b).Name())<br>fmt.Printf(<span class="hljs-string">&quot;c çš„ç±»å‹æ˜¯: %s\n&quot;</span>, reflect.TypeOf(c).Name())<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ–­è¨€"><a href="#æ–­è¨€" class="headerlink" title="æ–­è¨€"></a>æ–­è¨€</h2><p>åœ¨Goè¯­è¨€ä¸­ï¼Œæ–­è¨€ï¼ˆAssertionï¼‰ä¸»è¦ç”¨äºç±»å‹è½¬æ¢å’Œæ¥å£å€¼ç±»å‹çš„åˆ¤æ–­ã€‚ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§å½¢å¼çš„æ–­è¨€ï¼š</p><ol><li><p><strong>ç±»å‹æ–­è¨€</strong>ï¼š ç±»å‹æ–­è¨€åº”ç”¨äºæ¥å£ç±»å‹å˜é‡ï¼Œç”¨äºæ£€æµ‹æ¥å£å€¼æ˜¯å¦å…·æœ‰ç‰¹å®šç±»å‹ï¼Œå¹¶å¯é€‰æ‹©åœ°å°†å…¶è½¬æ¢ä¸ºè¯¥ç±»å‹ã€‚åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><p>Go</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs golang">value, ok := interfaceVariable.(typeName)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>interfaceVariable</code> æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹çš„å˜é‡ï¼Œ<code>typeName</code> æ˜¯ä½ å¸Œæœ›å®ƒå®é™…å…·æœ‰çš„ç±»å‹ã€‚å¦‚æœæ¥å£å˜é‡çš„åŠ¨æ€ç±»å‹ç¡®å®ä¸<code>typeName</code>ä¸€è‡´ï¼Œé‚£ä¹ˆ<code>value</code>å°†å¾—åˆ°æ¥å£å€¼å¯¹åº”çš„åº•å±‚å€¼ï¼Œ<code>ok</code>å°†è¢«è®¾ä¸º<code>true</code>ï¼›å¦‚æœä¸åŒ¹é…ï¼Œ<code>ok</code>å°†ä¸º<code>false</code>ï¼Œä¸”<code>value</code>çš„å€¼å°†æ˜¯ç›¸åº”ç±»å‹çš„é›¶å€¼ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>Go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> i <span class="hljs-keyword">interface</span>&#123;&#125; = <span class="hljs-string">&quot;Hello, world!&quot;</span><br>s, ok := i.(<span class="hljs-type">string</span>)<br><span class="hljs-comment">// s == &quot;Hello, world!&quot;, ok == true</span><br></code></pre></td></tr></table></figure></li><li><p><strong>ç±»å‹æ–­è¨€åœ¨æ¥å£é—´è½¬æ¢</strong>ï¼š ç±»å‹æ–­è¨€ä¹Ÿå¯ç”¨äºå°†ä¸€ä¸ªæ¥å£ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œåªè¦å®ƒä»¬çš„åº•å±‚ç±»å‹èƒ½å¤Ÿæ»¡è¶³è½¬æ¢è¦æ±‚ã€‚</p></li></ol><h2 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h2><p>ç®€å•è®²ï¼šåå°„å°±æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå¯ä»¥è®¿é—®è‡ªèº«ç»“æ„å¹¶ä¸”åšå‡ºä¿®æ”¹çš„ä¸€ç§èƒ½åŠ›ï¼ˆå®¡è§†è‡ªèº«ï¼‰ã€‚</p><p>åœ¨golangä¸­ï¼Œåå°„æ˜¯é€šè¿‡<code>reflect</code>åŒ…æ¥å®ç°</p><h3 id="æ‰“å°å˜é‡ç±»å‹"><a href="#æ‰“å°å˜é‡ç±»å‹" class="headerlink" title="æ‰“å°å˜é‡ç±»å‹"></a>æ‰“å°å˜é‡ç±»å‹</h3><p>è¦æ‰“å°å˜é‡çš„ç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>reflect.TypeOf()</code>å‡½æ•°ç»“åˆ<code>fmt.Println()</code>ã€‚<code>reflect.TypeOf()</code>ä¼šè¿”å›ä¸€ä¸ªä»£è¡¨ç±»å‹ä¿¡æ¯çš„<code>reflect.Type</code>å¯¹è±¡ï¼Œç„¶åé€šè¿‡å®ƒçš„<code>String()</code>æ–¹æ³•å¾—åˆ°ç±»å‹åå­—ç¬¦ä¸²ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;reflect&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> myInt <span class="hljs-type">int</span> = <span class="hljs-number">42</span><br><span class="hljs-keyword">var</span> myString <span class="hljs-type">string</span> = <span class="hljs-string">&quot;Hello&quot;</span><br><br>fmt.Println(<span class="hljs-string">&quot;myIntçš„ç±»å‹æ˜¯:&quot;</span>, reflect.TypeOf(myInt).String())<br>fmt.Println(<span class="hljs-string">&quot;myStringçš„ç±»å‹æ˜¯:&quot;</span>, reflect.TypeOf(myString).String())<br>    <span class="hljs-comment">//æˆ–è€…</span><br>    fmt.Printf(<span class="hljs-string">&quot;myIntçš„ç±»å‹æ˜¯:%T\n&quot;</span>, myInt)<span class="hljs-comment">// myIntçš„ç±»å‹æ˜¯ï¼šint</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ‹¼æ¥"><a href="#æ‹¼æ¥" class="headerlink" title="æ‹¼æ¥"></a>æ‹¼æ¥</h2><ol><li><p><strong>ä½¿ç”¨<code>+</code>æ“ä½œç¬¦</strong>: è¿™æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ï¼Œä½†å½“æ‹¼æ¥å¤§é‡å­—ç¬¦ä¸²æ—¶å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºå®ƒä¼šäº§ç”Ÿè®¸å¤šä¸´æ—¶å­—ç¬¦ä¸²ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">name := <span class="hljs-string">&quot;Alice&quot;</span><br>age := <span class="hljs-number">30</span><br>result := <span class="hljs-string">&quot;My name is &quot;</span> + name + <span class="hljs-string">&quot;, and I am &quot;</span> + strconv.Itoa(age) + <span class="hljs-string">&quot; years old.&quot;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨<code>fmt.Sprintf</code></strong>: æ›´çµæ´»ï¼Œé€‚åˆæ ¼å¼åŒ–è¾“å‡ºï¼Œæ€§èƒ½ä¼˜äºè¿ç»­çš„<code>+</code>æ“ä½œç¬¦ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">result := fmt.Sprintf(<span class="hljs-string">&quot;My name is %s, and I am %d years old.&quot;</span>, name, age)<br></code></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨<code>strings.Builder</code></strong>: å¯¹äºå¤§é‡å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œï¼Œ<code>strings.Builder</code>æä¾›äº†æ›´å¥½çš„æ€§èƒ½ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> builder strings.Builder<br>builder.WriteString(<span class="hljs-string">&quot;My name is &quot;</span>)<br>builder.WriteString(name)<br>builder.WriteString(<span class="hljs-string">&quot;, and I am &quot;</span>)<br>builder.WriteString(strconv.Itoa(age))<br>builder.WriteString(<span class="hljs-string">&quot; years old.&quot;</span>)<br>result := builder.String()<br></code></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨<code>bytes.Buffer</code></strong>: ç±»ä¼¼äº<code>strings.Builder</code>ï¼Œä½†åœ¨å¤„ç†å­—èŠ‚å±‚é¢ï¼Œé€‚ç”¨äºäºŒè¿›åˆ¶æ•°æ®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> buffer bytes.Buffer<br>buffer.WriteString(<span class="hljs-string">&quot;My name is &quot;</span>)<br>buffer.WriteString(name)<br>buffer.WriteString(<span class="hljs-string">&quot;, and I am &quot;</span>)<br>buffer.WriteString(strconv.Itoa(age))<br>buffer.WriteString(<span class="hljs-string">&quot; years old.&quot;</span>)<br>result := buffer.String()<br></code></pre></td></tr></table></figure></li></ol><h2 id="å ä½ç¬¦"><a href="#å ä½ç¬¦" class="headerlink" title="å ä½ç¬¦"></a>å ä½ç¬¦</h2><ul><li><code>%s</code>: å­—ç¬¦ä¸²ï¼ˆstringï¼‰</li><li><code>%d</code>: åè¿›åˆ¶æ•´æ•°ï¼ˆintï¼‰</li><li><code>%f</code>: æµ®ç‚¹æ•°ï¼Œé»˜è®¤ä¿ç•™å°æ•°ç‚¹å6ä½</li><li><code>%e</code> æˆ– <code>%E</code>: ç§‘å­¦è®°æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°</li><li><code>%T</code>: ä»»ä½•å€¼çš„ç±»å‹ä¿¡æ¯</li><li><code>%g</code> æˆ– <code>%G</code>: ç®€åŒ–çš„ç§‘å­¦è®°æ•°æ³•æˆ–æµ®ç‚¹æ•°ï¼Œè‡ªåŠ¨æ ¹æ®å€¼çš„å¤§å°é€‰æ‹©</li><li><code>%x</code>: åå…­è¿›åˆ¶è¡¨ç¤ºçš„æ•´æ•°ï¼Œå°å†™å­—æ¯</li><li><code>%X</code>: åå…­è¿›åˆ¶è¡¨ç¤ºçš„æ•´æ•°ï¼Œå¤§å†™å­—æ¯</li><li><code>%o</code>: å…«è¿›åˆ¶è¡¨ç¤ºçš„æ•´æ•°</li><li><code>%p</code>: æŒ‡é’ˆåœ°å€ï¼Œä»¥åå…­è¿›åˆ¶è¡¨ç¤ºå¹¶å‰ç¼€<code>0x</code></li><li><code>%q</code>: å¼•å·åŒ…å›´çš„å­—ç¬¦ä¸²ï¼Œä»»ä½•ç‰¹æ®Šå­—ç¬¦éƒ½ä¼šè¢«è½¬ä¹‰</li><li><code>%v</code>: é»˜è®¤æ ¼å¼ï¼Œæ ¹æ®å€¼çš„å…·ä½“ç±»å‹é€‰æ‹©åˆé€‚çš„æ ¼å¼åŒ–æ–¹å¼</li><li><code>%%</code>: è¾“å‡ºç™¾åˆ†å·è‡ªèº«ï¼ˆè€Œéä½œä¸ºå ä½ç¬¦ï¼‰</li><li><code>%[width]</code>: æŒ‡å®šè¾“å‡ºçš„æœ€å°å®½åº¦ï¼Œä¸è¶³åˆ™å·¦è¡¥ç©ºæ ¼</li><li><code>%-[width]</code>: å·¦å¯¹é½ï¼ˆé»˜è®¤æ˜¯å³å¯¹é½ï¼‰</li><li><code>%.[precision]f</code>: å¯¹æµ®ç‚¹æ•°æŒ‡å®šå°æ•°ç‚¹åçš„ä½æ•°</li><li><code>%[flags][width][.precision]specifier</code>: ç»„åˆä½¿ç”¨ï¼Œå¦‚<code>%05d</code>è¡¨ç¤ºè‡³å°‘5ä½å®½ï¼Œä¸è¶³å‰å¯¼é›¶å¡«å……çš„åè¿›åˆ¶æ•´æ•°ã€‚</li></ul><h2 id="è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹çš„ç‰¹ç‚¹åŠåŒºåˆ«"><a href="#è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹çš„ç‰¹ç‚¹åŠåŒºåˆ«" class="headerlink" title="è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹çš„ç‰¹ç‚¹åŠåŒºåˆ«"></a>è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹çš„ç‰¹ç‚¹åŠåŒºåˆ«</h2><p><strong>è¿›ç¨‹ï¼ˆprocessï¼‰</strong></p><ul><li>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½</li><li>è¿›ç¨‹é—´ä¸å…±äº«å†…å­˜ï¼Œæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜</li><li>è¿›ç¨‹é—´å¯ä»¥é€šè¿‡ä¿¡å·ã€ä¿¡å·é‡ã€å…±äº«å†…å­˜ã€ç®¡é“ã€é˜Ÿåˆ—ç­‰æ¥é€šä¿¡</li><li>æ–°å¼€è¿›ç¨‹å¼€é”€å¤§ï¼Œå¹¶ä¸” CPU åˆ‡æ¢è¿›ç¨‹æˆæœ¬ä¹Ÿå¤§</li><li>è¿›ç¨‹ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦</li><li>å¤šè¿›ç¨‹æ–¹å¼æ¯”å¤šçº¿ç¨‹æ›´åŠ ç¨³å®š</li></ul><p><strong>çº¿ç¨‹ï¼ˆthreadï¼‰</strong></p><ul><li>çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•ä½</li><li>çº¿ç¨‹æ˜¯æ¥è‡ªäºè¿›ç¨‹çš„ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸‹é¢å¯ä»¥å¼€å¤šä¸ªçº¿ç¨‹</li><li>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ä¸€ä¸ªæ ˆï¼Œä¸å…±äº«æ ˆï¼Œä½†å¤šä¸ªçº¿ç¨‹èƒ½å…±äº«åŒä¸€ä¸ªå±äºè¿›ç¨‹çš„å †</li><li>çº¿ç¨‹å› ä¸ºæ˜¯åœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…çš„ï¼Œå¯ä»¥å…±äº«å†…å­˜</li><li>çº¿ç¨‹ä¹Ÿæ˜¯ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼Œçº¿ç¨‹æ˜¯ CPU è°ƒåº¦çš„æœ€å°å•ä½</li><li>æ–°å¼€çº¿ç¨‹å¼€é”€å°äºè¿›ç¨‹ï¼ŒCPU åœ¨åˆ‡æ¢çº¿ç¨‹æˆæœ¬ä¹Ÿå°äºè¿›ç¨‹</li><li>æŸä¸ªçº¿ç¨‹å‘ç”Ÿè‡´å‘½é”™è¯¯ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹å´©æºƒ</li><li>çº¿ç¨‹é—´è¯»å†™å˜é‡å­˜åœ¨é”çš„é—®é¢˜å¤„ç†èµ·æ¥ç›¸å¯¹éº»çƒ¦</li></ul><p><strong>åç¨‹ï¼ˆcoroutineï¼‰</strong></p><ul><li>å¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´åªæœ‰è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œåç¨‹çš„æ§åˆ¶ç”±åº”ç”¨ç¨‹åºæ˜¾å¼è°ƒåº¦ï¼ŒéæŠ¢å å¼çš„</li><li>åç¨‹çš„æ‰§è¡Œæœ€ç»ˆé çš„è¿˜æ˜¯çº¿ç¨‹ï¼Œåº”ç”¨ç¨‹åºæ¥è°ƒåº¦åç¨‹é€‰æ‹©åˆé€‚çš„çº¿ç¨‹æ¥è·å–æ‰§è¡Œæƒ</li><li>åˆ‡æ¢éå¸¸å¿«ï¼Œæˆæœ¬ä½ã€‚ä¸€èˆ¬å ç”¨æ ˆå¤§å°è¿œå°äºçº¿ç¨‹ï¼ˆåç¨‹ KB çº§åˆ«ï¼Œçº¿ç¨‹ MB çº§åˆ«ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥å¼€æ›´å¤šçš„åç¨‹</li><li>åç¨‹æ¯”çº¿ç¨‹æ›´è½»é‡çº§</li></ul><h2 id="é€šé“ï¼ˆchannelï¼‰"><a href="#é€šé“ï¼ˆchannelï¼‰" class="headerlink" title="é€šé“ï¼ˆchannelï¼‰"></a>é€šé“ï¼ˆchannelï¼‰</h2><p>é€šé“ï¼ˆchannelï¼‰æ˜¯ä¸€ç§ç”¨äºåœ¨goroutineä¹‹é—´ä¼ é€’æ•°æ®çš„å®‰å…¨æ–¹å¼ï¼Œæ”¯æŒåŒæ­¥é€šä¿¡ã€‚é€šé“å¯ä»¥è¢«å£°æ˜ä¸ºæœ‰ç¼“å†²æˆ–æ— ç¼“å†²çš„ï¼Œå…·ä½“å†™æ³•å’Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><h3 id="é€šé“çš„å£°æ˜ä¸åˆå§‹åŒ–"><a href="#é€šé“çš„å£°æ˜ä¸åˆå§‹åŒ–" class="headerlink" title="é€šé“çš„å£°æ˜ä¸åˆå§‹åŒ–"></a>é€šé“çš„å£°æ˜ä¸åˆå§‹åŒ–</h3><p><strong>1. æ— ç¼“å†²é€šé“</strong>ï¼šæ•°æ®çš„å‘é€å’Œæ¥æ”¶æ“ä½œå¿…é¡»åŒæ—¶å‘ç”Ÿï¼Œå³å‘é€è€…ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æ¥æ”¶è€…å‡†å¤‡å¥½æ¥æ”¶æ•°æ®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>) <span class="hljs-comment">// æ— ç¼“å†²é€šé“ï¼Œç±»å‹ä¸ºint</span><br></code></pre></td></tr></table></figure><p><strong>2. æœ‰ç¼“å†²é€šé“</strong>ï¼šå¯ä»¥åœ¨æ²¡æœ‰æ¥æ”¶è€…ç«‹å³æ¥æ”¶çš„æƒ…å†µä¸‹å‘é€ä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œç¼“å†²åŒºæ»¡åï¼Œå†å‘é€æ•°æ®å°†ä¼šé˜»å¡ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">5</span>) <span class="hljs-comment">// æœ‰ç¼“å†²é€šé“ï¼Œç±»å‹ä¸ºintï¼Œç¼“å†²åŒºå¤§å°ä¸º5</span><br></code></pre></td></tr></table></figure><h3 id="å‘é€æ•°æ®åˆ°é€šé“"><a href="#å‘é€æ•°æ®åˆ°é€šé“" class="headerlink" title="å‘é€æ•°æ®åˆ°é€šé“"></a>å‘é€æ•°æ®åˆ°é€šé“</h3><ul><li><p><strong>åŸºç¡€å‘é€</strong>ï¼šä½¿ç”¨<code>&lt;-&quot;channel&quot;</code>è¯­æ³•å‘é€æ•°æ®åˆ°é€šé“ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">ch &lt;- value <span class="hljs-comment">// å°†valueå‘é€åˆ°é€šé“ch</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="ä»é€šé“æ¥æ”¶æ•°æ®"><a href="#ä»é€šé“æ¥æ”¶æ•°æ®" class="headerlink" title="ä»é€šé“æ¥æ”¶æ•°æ®"></a>ä»é€šé“æ¥æ”¶æ•°æ®</h3><ul><li><p><strong>åŸºç¡€æ¥æ”¶</strong>ï¼šä½¿ç”¨<code>value := &lt;-channel</code>è¯­æ³•ä»é€šé“æ¥æ”¶æ•°æ®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">receivedValue := &lt;-ch <span class="hljs-comment">// ä»é€šé“chæ¥æ”¶æ•°æ®å¹¶å­˜å‚¨åœ¨receivedValueä¸­</span><br></code></pre></td></tr></table></figure></li></ul><p>â€‹ å¤šgoroutinesè¯»å–é€šé“æ•°æ®ï¼Œå–å†³äºGo çš„è°ƒåº¦å™¨åˆ†é…ï¼Œå¯èƒ½ä¼šå‡ºç°ç¬¬ä¸€ä¸ªå†™å…¥çš„æ•°æ®å¯èƒ½è¢«ç¬¬ä¸€ä¸ªè¯»å–çš„ goroutineè¯»å–ï¼Œç¬¬äºŒä¸ªæ•°æ®å¯èƒ½è¢«ç¬¬äºŒä¸ªè¯»å–çš„ goroutineè¯»å–</p><p>â€‹      å½“ä»ä¸€ä¸ªé€šé“è¿›è¡Œæ¥æ”¶æ“ä½œæ—¶å¦‚æœé€šé“ä¸­æ²¡æœ‰æ•°æ®å¯æ¥æ”¶ä¸”é€šé“æœªè¢«å…³é—­ï¼Œè¯¥æ¥æ”¶æ“ä½œå°†ä¼šé˜»å¡ã€‚è¿™ç§é˜»å¡æœ¬èº«å¹¶ä¸ä¼šæŠ›å‡ºå¼‚å¸¸æˆ–é”™è¯¯ï¼Œè€Œæ˜¯ä¼šä½¿å½“å‰çš„ goroutine æš‚åœæ‰§è¡Œï¼Œç›´åˆ°é€šé“ä¸­æœ‰æ•°æ®å¯ç”¨æˆ–é€šé“è¢«å…³é—­ã€‚</p><p><strong>é˜»å¡é—®é¢˜ï¼š</strong></p><ol><li><p><strong>æ­»é”</strong>ï¼š</p><p>å¦‚æœç¨‹åºçš„é€»è¾‘è®¾è®¡ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´å¤šä¸ª goroutine äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºæˆ–å‘é€&#x2F;æ¥æ”¶æ•°æ®ï¼Œä»è€Œå½¢æˆæ­»é”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¨‹åºå°†åœæ­¢å“åº”ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½• goroutine èƒ½å¤Ÿç»§ç»­æ‰§è¡Œã€‚</p></li><li><p><strong>æ€§èƒ½é—®é¢˜:</strong></p><p>è¿‡åº¦çš„é˜»å¡å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘çš„ç³»ç»Ÿä¸­ã€‚å¦‚æœå¤§é‡ goroutines å› ä¸ºç­‰å¾…é€šé“æ•°æ®è€Œé˜»å¡ï¼Œå¯èƒ½ä¼šå½±å“ç³»ç»Ÿçš„å“åº”æ—¶é—´å’Œååé‡ã€‚</p></li><li><p><strong>èµ„æºæµªè´¹</strong>ï¼š</p><p>é•¿æ—¶é—´çš„é˜»å¡ä¹Ÿå¯èƒ½å¯¼è‡´ CPU æ—¶é—´ç‰‡å’Œå…¶ä»–ç³»ç»Ÿèµ„æºçš„æµªè´¹ï¼Œå› ä¸ºè¢«é˜»å¡çš„ goroutine å ç”¨äº†è°ƒåº¦å™¨çš„æ³¨æ„åŠ›ï¼Œè€Œå®é™…ä¸Šå®ƒæ— æ³•æ‰§è¡Œä»»ä½•å·¥ä½œã€‚</p></li><li><p><strong>é€»è¾‘é”™è¯¯</strong>ï¼š</p><p><strong>é€»è¾‘é”™è¯¯</strong>ï¼š å¦‚æœé¢„æœŸä¸€ä¸ªé€šé“åº”è¯¥æœ‰æ•°æ®å¯æ¥æ”¶ï¼Œä½†å®é™…ä¸Šæ²¡æœ‰ï¼Œè¿™å¯èƒ½æ˜¯ç¨‹åºé€»è¾‘ä¸Šçš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½æœ‰ goroutine åº”è¯¥å‘é€šé“å‘é€æ•°æ®ï¼Œä½†ç”±äºæŸç§åŸå› æœªèƒ½æ‰§è¡Œã€‚</p></li></ol><p>ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œé€šå¸¸å¯ä»¥é‡‡ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š</p><ul><li><strong>ä½¿ç”¨ select è¯­å¥</strong>ï¼šç»“åˆ default case ä½¿ç”¨ select è¯­å¥å¯ä»¥é˜²æ­¢æ— é™æœŸçš„é˜»å¡ï¼Œä½¿ goroutine åœ¨æ²¡æœ‰æ•°æ®å¯æ¥æ”¶æ—¶èƒ½å¤Ÿç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œã€‚</li><li><strong>å…³é—­é€šé“</strong>ï¼šå½“ä¸å†éœ€è¦å‘é€šé“å‘é€æ•°æ®æ—¶ï¼Œåº”è¯¥å…³é—­é€šé“ã€‚è¿™å¯ä»¥é€šçŸ¥æ‰€æœ‰ç­‰å¾…æ¥æ”¶æ•°æ®çš„ goroutinesï¼Œè®©å®ƒä»¬çŸ¥é“æ²¡æœ‰æ›´å¤šæ•°æ®å¯æ¥æ”¶ï¼Œä»è€Œé¿å…æ— é™æœŸçš„é˜»å¡ã€‚</li><li><strong>è¶…æ—¶æœºåˆ¶</strong>ï¼šé€šè¿‡ä½¿ç”¨å®šæ—¶å™¨æˆ–ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰æ¥é™åˆ¶ç­‰å¾…æ—¶é—´ï¼Œå¯ä»¥é˜²æ­¢é•¿æ—¶é—´çš„é˜»å¡ã€‚</li></ul><h3 id="å¤šè·¯å¤ç”¨ä¸é»˜è®¤é€‰æ‹©"><a href="#å¤šè·¯å¤ç”¨ä¸é»˜è®¤é€‰æ‹©" class="headerlink" title="å¤šè·¯å¤ç”¨ä¸é»˜è®¤é€‰æ‹©"></a>å¤šè·¯å¤ç”¨ä¸é»˜è®¤é€‰æ‹©</h3><ul><li><p><strong>å¤šè·¯å¤ç”¨</strong>ï¼šåœ¨<code>select</code>è¯­å¥ä¸­ï¼Œå¯ä»¥ç›‘å¬å¤šä¸ªé€šé“ä¸Šçš„å‘é€æˆ–æ¥æ”¶æ“ä½œã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> ch1 &lt;- value:<br>    <span class="hljs-comment">// å‘é€åˆ°ch1æˆåŠŸ</span><br><span class="hljs-keyword">case</span> ch2 &lt;- value:<br>    <span class="hljs-comment">// å‘é€åˆ°ch2æˆåŠŸ</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>å¸¦defaultçš„select</strong>ï¼šç”¨äºéé˜»å¡æ¥æ”¶æˆ–å‘é€ï¼Œæˆ–è€…æ‰§è¡Œé»˜è®¤æ“ä½œã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> value := &lt;-ch:<br>    <span class="hljs-comment">// ä»chæ¥æ”¶æ•°æ®</span><br><span class="hljs-keyword">default</span>:<br>    <span class="hljs-comment">// æ²¡æœ‰æ•°æ®å¯æ¥æ”¶æ—¶æ‰§è¡Œ</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="å…³é—­é€šé“"><a href="#å…³é—­é€šé“" class="headerlink" title="å…³é—­é€šé“"></a>å…³é—­é€šé“</h3><ul><li><p><strong>å…³é—­é€šé“</strong>ï¼šä½¿ç”¨<code>close(channel)</code>å¯ä»¥å…³é—­ä¸€ä¸ªé€šé“ï¼Œè¡¨æ˜ä¸å†ä¼šæœ‰æ•°æ®å‘é€åˆ°è¯¥é€šé“ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-built_in">close</span>(ch) <span class="hljs-comment">// å…³é—­é€šé“ch</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li>å”¯ä¸€å…³é—­åŸåˆ™ï¼šåº”è¯¥åªæœ‰ä¸€ä¸ªgoroutineè´Ÿè´£å…³é—­ç®¡é“ã€‚é‡å¤å…³é—­ç®¡é“ä¼šå¯¼è‡´è¿è¡Œæ—¶panicï¼ˆ<code>panic: close of closed channel</code>ï¼‰ã€‚</li><li>æ¥æ”¶è€…å¯ä»¥é€šè¿‡<code>v, ok := &lt;-ch</code>æ¥æ£€æŸ¥é€šé“æ˜¯å¦å·²ç»å…³é—­ï¼ˆ<code>ok</code>ä¸º<code>false</code>è¡¨ç¤ºé€šé“å·²å…³é—­ä¸”æ²¡æœ‰æ›´å¤šæ•°æ®å¯æ¥æ”¶ï¼‰ã€‚</li><li>å‘ä¸€ä¸ªå·²å…³é—­çš„é€šé“å‘é€æ•°æ®ä¼šå¯¼è‡´è¿è¡Œæ—¶panicï¼Œå°è¯•ä»ä¸€ä¸ªå·²å…³é—­çš„æ— ç¼“å†²é€šé“æ¥æ”¶æ•°æ®ï¼ˆå¦‚æœæ²¡æœ‰å…¶ä»–å‘é€è€…ç­‰å¾…ï¼‰ä¹Ÿä¼šå¯¼è‡´æ¥æ”¶æ“ä½œç«‹å³è¿”å›é›¶å€¼å’Œ<code>false</code>çš„<code>ok</code>ã€‚</li></ul><h2 id="Switch-Select-åŒºåˆ«"><a href="#Switch-Select-åŒºåˆ«" class="headerlink" title="Switch\Select åŒºåˆ«"></a>Switch\Select åŒºåˆ«</h2><h3 id="Switch-è¯­å¥"><a href="#Switch-è¯­å¥" class="headerlink" title="Switch è¯­å¥"></a>Switch è¯­å¥</h3><ul><li><strong>ç”¨é€”</strong>ï¼šä¸»è¦ç”¨äºåŸºäºä¸åŒæ¡ä»¶ï¼ˆé€šå¸¸æ˜¯å˜é‡çš„å€¼ï¼‰æ‰§è¡Œä¸åŒçš„ä»£ç è·¯å¾„ã€‚å®ƒå¯ä»¥å¤„ç†å¤šç§æƒ…å†µï¼Œå¹¶ä¸”å¯ä»¥æœ‰ä¸€ä¸ªå¯é€‰çš„é»˜è®¤åˆ†æ”¯ï¼ˆ<code>default</code> caseï¼‰ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå½“ä½ éœ€è¦æ ¹æ®æŸä¸ªè¡¨è¾¾å¼çš„å€¼æ¥åšå†³ç­–æ—¶ï¼Œæ¯”å¦‚å¤„ç†æšä¸¾ç±»å‹ã€é”™è¯¯ç ç­‰ã€‚</li><li><strong>æ§åˆ¶æµ</strong>ï¼šé¡ºåºæ‰§è¡Œï¼Œä»ä¸Šåˆ°ä¸‹åŒ¹é…<code>case</code>ï¼Œä¸€æ—¦åŒ¹é…æˆåŠŸæ‰§è¡Œç›¸åº”ä»£ç å—åï¼ˆé™¤éæœ‰<code>break</code>ï¼‰ï¼Œä¼šç»§ç»­æ£€æŸ¥ä¸‹ä¸€ä¸ª<code>case</code>ï¼Œç›´åˆ°é‡åˆ°<code>break</code>æˆ–è€…æ‰§è¡Œå®Œæ‰€æœ‰åŒ¹é…çš„<code>case</code>ï¼ˆå¦‚æœæ²¡æœ‰<code>break</code>ï¼‰ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šä¸æ¶‰åŠå¹¶å‘ï¼Œçº¯ç²¹ç”¨äºé€»è¾‘æ§åˆ¶ã€‚</li></ul><h3 id="Select-è¯­å¥"><a href="#Select-è¯­å¥" class="headerlink" title="Select è¯­å¥"></a>Select è¯­å¥</h3><ul><li><p><strong>ç”¨é€”</strong>ï¼šä¸“é—¨ç”¨äºå¤„ç†channelçš„æ“ä½œï¼Œå¦‚æ¥æ”¶æˆ–å‘é€æ•°æ®ã€‚å®ƒæ˜¯Goè¯­è¨€å¹¶å‘æ¨¡å‹ä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œç”¨äºå®ç°éé˜»å¡çš„IOå¤šè·¯å¤ç”¨ã€‚</p></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå½“ä½ éœ€è¦åŒæ—¶ç›‘å¬å¤šä¸ªchannelä¸Šçš„äº‹ä»¶å¹¶ä½œå‡ºå“åº”æ—¶ï¼Œæ¯”å¦‚åœ¨å¤„ç†ç½‘ç»œè¿æ¥ã€ä¿¡å·é‡æˆ–æ˜¯å…¶ä»–å¹¶å‘ä»»åŠ¡çš„åè°ƒæ—¶ã€‚</p></li><li><p><strong>æ§åˆ¶æµ</strong>ï¼šéç¡®å®šæ€§é€‰æ‹©ï¼Œå½“æœ‰å¤šä¸ªchannelæ“ä½œå‡†å¤‡å°±ç»ªæ—¶ï¼Œä¼šé€‰æ‹©ä¸€ä¸ªéšæœºçš„ï¼ˆå®é™…ä¸Šæ˜¯ç”±è¿è¡Œæ—¶å†³å®šçš„ï¼‰channelæ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰channelå‡†å¤‡å¥½ï¼Œselectä¼šé˜»å¡ï¼Œç›´åˆ°è‡³å°‘æœ‰ä¸€ä¸ªchannelå¯æ“ä½œã€‚</p></li><li><p>ç‰¹ç‚¹</p><p>ï¼š</p><ul><li>å¯ä»¥æœ‰defaultå­å¥ï¼Œç”¨äºåœ¨æ²¡æœ‰ä»»ä½•channelæ“ä½œå‡†å¤‡å°±ç»ªæ—¶æ‰§è¡Œã€‚</li><li>å¦‚æœæœ‰å¤šä¸ªchannelåŒæ—¶å°±ç»ªï¼Œselectä¼šéšæœºé€‰æ‹©ä¸€ä¸ªæ‰§è¡Œï¼Œè¿™å¯¹äºéœ€è¦å…¬å¹³æ€§çš„æƒ…å†µéœ€è¦æ³¨æ„ã€‚</li><li>å¯ä»¥ç”¨æ¥å®ç°è¶…æ—¶æœºåˆ¶ï¼Œé€šè¿‡é…åˆtime.Afterå‡½æ•°çš„channelã€‚</li></ul></li></ul><p>æ€»ç»“æ¥è¯´ï¼Œ<code>switch</code>æ˜¯ç”¨äºæ§åˆ¶æµç¨‹çš„å†³ç­–ï¼ŒåŸºäºè¡¨è¾¾å¼çš„å€¼ï¼›è€Œ<code>select</code>åˆ™ä¸“æ³¨äºå¹¶å‘ç¼–ç¨‹ä¸­çš„é€šä¿¡ï¼Œç‰¹åˆ«æ˜¯ä¸channelç›¸å…³çš„æ“ä½œï¼Œæä¾›äº†åœ¨å¤šä¸ªå¹¶å‘æ´»åŠ¨ä¹‹é—´è¿›è¡Œé€‰æ‹©çš„èƒ½åŠ›ã€‚</p><h2 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h2><h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><p>Goè¯­è¨€ä¸­çš„<code>strings</code>åŒ…æä¾›äº†è®¸å¤šç”¨äºæ“ä½œå­—ç¬¦ä¸²çš„å®ç”¨å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs go">**<span class="hljs-string">`Contains(s, substr string) bool`</span>**<br>- æ£€æŸ¥å­—ç¬¦ä¸²<span class="hljs-string">`s`</span>æ˜¯å¦åŒ…å«å­å­—ç¬¦ä¸²<span class="hljs-string">`substr`</span>ã€‚å¦‚æœåŒ…å«ï¼Œè¿”å›<span class="hljs-string">`true`</span>ï¼›å¦åˆ™è¿”å›<span class="hljs-string">`false`</span>ã€‚<br><br>**<span class="hljs-string">`Count(s, sep string) int`</span>**<br>- è®¡ç®—å­—ç¬¦ä¸²<span class="hljs-string">`s`</span>ä¸­éé‡å çš„<span class="hljs-string">`sep`</span>å‡ºç°æ¬¡æ•°ã€‚å¦‚æœ<span class="hljs-string">`sep`</span>ä¸ºç©ºï¼Œåˆ™è¿”å›<span class="hljs-string">`s`</span>ä¸­å­—ç¬¦ï¼ˆéå­—èŠ‚ï¼‰çš„æ•°é‡åŠ ä¸€ã€‚<br><br>**<span class="hljs-string">`EqualFold(s, t string) bool`</span>**<br>- æ¯”è¾ƒ<span class="hljs-string">`s`</span>å’Œ<span class="hljs-string">`t`</span>æ˜¯å¦ç›¸ç­‰ï¼Œå¿½ç•¥å¤§å°å†™ã€‚<br><br>**<span class="hljs-string">`Fields(s string) []string`</span>**<br>- æ ¹æ®ç©ºç™½å­—ç¬¦åˆ†å‰²å­—ç¬¦ä¸²<span class="hljs-string">`s`</span>ï¼Œè¿”å›ä¸€ä¸ªç”±å­—æ®µç»„æˆçš„åˆ‡ç‰‡ã€‚<br><br>**<span class="hljs-string">`FieldsFunc(s string, f func(rune) bool) []string`</span>**<br>- ä½¿ç”¨å‡½æ•°<span class="hljs-string">`f`</span>ä½œä¸ºåˆ†éš”ç¬¦æ¥åˆ†å‰²<span class="hljs-string">`s`</span>ï¼Œå…¶ä¸­<span class="hljs-string">`f`</span>åº”è¯¥è¿”å›<span class="hljs-string">`true`</span>ä»¥æŒ‡ç¤ºåˆ†éš”ç¬¦ã€‚<br><br>**<span class="hljs-string">`Index(s, sep string) int`</span>**<br>- è¿”å›<span class="hljs-string">`s`</span>ä¸­<span class="hljs-string">`sep`</span>ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å›<span class="hljs-string">`-1`</span>ã€‚<br><br>**<span class="hljs-string">`Join(a []string, sep string) string`</span>**<br>- ä½¿ç”¨<span class="hljs-string">`sep`</span>è¿æ¥åˆ‡ç‰‡<span class="hljs-string">`a`</span>ä¸­çš„å­—ç¬¦ä¸²å…ƒç´ ã€‚<br><br>**<span class="hljs-string">`LastIndex(s, sep string) int`</span>**<br>- è¿”å›<span class="hljs-string">`s`</span>ä¸­æœ€åä¸€æ¬¡<span class="hljs-string">`sep`</span>å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å›<span class="hljs-string">`-1`</span>ã€‚<br><br>**<span class="hljs-string">`Map(f func(rune) rune, s string) string`</span>**<br>- å°†å‡½æ•°<span class="hljs-string">`f`</span>åº”ç”¨äº<span class="hljs-string">`s`</span>ä¸­çš„æ¯ä¸ªå­—ç¬¦ï¼Œç„¶åè¿”å›ç»“æœå­—ç¬¦ä¸²ã€‚<br><br>**<span class="hljs-string">`Repeat(s string, count int) string`</span>**<br>- è¿”å›<span class="hljs-string">`s`</span>é‡å¤<span class="hljs-string">`count`</span>æ¬¡çš„ç»“æœã€‚<br><br>**<span class="hljs-string">`Replace(s, old, new string, n int) string`</span>**<br>- å°†<span class="hljs-string">`s`</span>ä¸­çš„å‰<span class="hljs-string">`n`</span>ä¸ª<span class="hljs-string">`old`</span>æ›¿æ¢ä¸º<span class="hljs-string">`new`</span>ã€‚å¦‚æœ<span class="hljs-string">`n`</span>å°äº<span class="hljs-number">0</span>ï¼Œåˆ™æ›¿æ¢æ‰€æœ‰å‡ºç°ã€‚<br><br>**<span class="hljs-string">`Split(s, sep string) []string`</span>**<br>- æ ¹æ®<span class="hljs-string">`sep`</span>åˆ†å‰²<span class="hljs-string">`s`</span>ï¼Œè¿”å›ä¸€ä¸ªç”±å­å­—ç¬¦ä¸²ç»„æˆçš„åˆ‡ç‰‡ã€‚<br><br>**<span class="hljs-string">`SplitAfter(s, sep string) []string`</span>**<br>- ç±»ä¼¼äº<span class="hljs-string">`Split`</span>ï¼Œä½†åœ¨æ¯ä¸ªåˆ†å‰²ç‚¹ä¹‹åä¿ç•™<span class="hljs-string">`sep`</span>ã€‚<br><br>**<span class="hljs-string">`SplitN(s, sep string, n int) []string`</span>**<br>- ç±»ä¼¼äº<span class="hljs-string">`Split`</span>ï¼Œä½†æœ€å¤šåˆ†å‰²<span class="hljs-string">`n-1`</span>æ¬¡ï¼Œä»è€Œå¾—åˆ°<span class="hljs-string">`n`</span>ä¸ªå…ƒç´ ã€‚<br><br>**<span class="hljs-string">`Title(s string) string`</span>**<br>- å°†<span class="hljs-string">`s`</span>è½¬æ¢ä¸ºæ ‡é¢˜å¤§å°å†™ï¼Œå³æ¯ä¸ªå•è¯çš„ç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™ï¼Œå…¶ä½™å°å†™ã€‚<br><br>**<span class="hljs-string">`ToLower(s string) string`</span>**<br>- å°†<span class="hljs-string">`s`</span>è½¬æ¢ä¸ºå°å†™ã€‚<br><br>**<span class="hljs-string">`ToUpper(s string) string`</span>**<br>- å°†<span class="hljs-string">`s`</span>è½¬æ¢ä¸ºå¤§å†™ã€‚<br><br>**<span class="hljs-string">`Trim(s string, cutset string) string`</span>**<br>- ç§»é™¤<span class="hljs-string">`s`</span>å‰åä¸¤ç«¯çš„<span class="hljs-string">`cutset`</span>å­—ç¬¦ã€‚<br><br>**<span class="hljs-string">`TrimSpace(s string) string`</span>**<br>- ç§»é™¤<span class="hljs-string">`s`</span>å‰åä¸¤ç«¯çš„ç©ºç™½å­—ç¬¦ã€‚<br><br>**<span class="hljs-string">`HasPrefix(s, prefix string) bool`</span>**<br>- æ£€æŸ¥<span class="hljs-string">`s`</span>æ˜¯å¦ä»¥<span class="hljs-string">`prefix`</span>å¼€å§‹ã€‚<br><br>**<span class="hljs-string">`HasSuffix(s, suffix string) bool`</span>**<br>   - æ£€æŸ¥<span class="hljs-string">`s`</span>æ˜¯å¦ä»¥<span class="hljs-string">`suffix`</span>ç»“æŸã€‚<br></code></pre></td></tr></table></figure><p>è¿™äº›å‡½æ•°æä¾›äº†å¼ºå¤§çš„å­—ç¬¦ä¸²å¤„ç†èƒ½åŠ›ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°å­—ç¬¦ä¸²æ“ä½œçš„éœ€æ±‚</p>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>reflectåå°„ç¬”è®°</title>
    <link href="/2024/12/10/go/reflect%E5%8C%85%E5%8F%8D%E5%B0%84/"/>
    <url>/2024/12/10/go/reflect%E5%8C%85%E5%8F%8D%E5%B0%84/</url>
    
    <content type="html"><![CDATA[<h1 id="reflectåå°„æœºåˆ¶"><a href="#reflectåå°„æœºåˆ¶" class="headerlink" title="reflectåå°„æœºåˆ¶"></a>reflectåå°„æœºåˆ¶</h1><h2 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h2><p>åå°„æ˜¯ä¸€ç§è®©ç¨‹åºåœ¨è¿è¡Œæ—¶è‡ªçœï¼ˆintrospectï¼‰å’Œä¿®æ”¹è‡ªèº«ç»“æ„å’Œè¡Œä¸ºçš„æœºåˆ¶ã€‚è™½ç„¶è¿™å¬èµ·æ¥æœ‰ç‚¹åƒâ€œè‡ªæˆ‘è§‚å¯Ÿâ€ï¼Œä½†å®é™…ä¸Šï¼Œåå°„åœ¨è®¸å¤šç°ä»£ç¼–ç¨‹è¯­è¨€ä¸­éƒ½æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§å’Œé‡è¦çš„å·¥å…·ã€‚Goè¯­è¨€ä¹Ÿä¸ä¾‹å¤–ã€‚åœ¨Goè¯­è¨€ä¸­ï¼Œåå°„ä¸ä»…èƒ½å¸®åŠ©ä½ æ›´æ·±å…¥åœ°ç†è§£è¯­è¨€æœ¬èº«ï¼Œè€Œä¸”è¿˜èƒ½æå¤§åœ°å¢åŠ ä»£ç çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h2 id="2ã€ä»€ä¹ˆæ˜¯åå°„"><a href="#2ã€ä»€ä¹ˆæ˜¯åå°„" class="headerlink" title="2ã€ä»€ä¹ˆæ˜¯åå°„"></a>2ã€ä»€ä¹ˆæ˜¯åå°„</h2><p>åå°„ï¼ˆReflectionï¼‰åœ¨ç¼–ç¨‹ä¸­é€šå¸¸è¢«å®šä¹‰ä¸ºåœ¨è¿è¡Œæ—¶æ£€æŸ¥ç¨‹åºçš„èƒ½åŠ›ã€‚è¿™ç§èƒ½åŠ›ä½¿å¾—ä¸€ä¸ªç¨‹åºèƒ½å¤Ÿæ“çºµåƒå˜é‡ã€æ•°æ®ç»“æ„ã€æ–¹æ³•å’Œç±»å‹è¿™æ ·çš„å¯¹è±¡çš„å„ç§å±æ€§å’Œè¡Œä¸ºã€‚è¿™ä¸€æœºåˆ¶åœ¨Goä¸­ä¸»è¦é€šè¿‡**<code>reflect</code>**æ ‡å‡†åº“å®ç°ã€‚</p><h3 id="åå°„ä¸ç±»å‹ç³»ç»Ÿ"><a href="#åå°„ä¸ç±»å‹ç³»ç»Ÿ" class="headerlink" title="åå°„ä¸ç±»å‹ç³»ç»Ÿ"></a><strong>åå°„ä¸ç±»å‹ç³»ç»Ÿ</strong></h3><p>åå°„ç´§å¯†åœ°ä¸ç±»å‹ç³»ç»Ÿè”ç³»åœ¨ä¸€èµ·ã€‚åœ¨é™æ€ç±»å‹è¯­è¨€ï¼ˆä¾‹å¦‚Goï¼‰ä¸­ï¼Œæ¯ä¸€ä¸ªå˜é‡éƒ½æœ‰é¢„å…ˆå®šä¹‰çš„ç±»å‹ï¼Œè¿™äº›ç±»å‹åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šã€‚ä½†åå°„å…è®¸ä½ åœ¨è¿è¡Œæ—¶å»æŸ¥è¯¢å’Œæ”¹å˜è¿™äº›ç±»å‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šæŸ¥è¯¢å˜é‡çš„ç±»å‹å’Œå€¼</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;reflect&quot;</span><br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> x <span class="hljs-type">int</span> = <span class="hljs-number">42</span><br>    t := reflect.TypeOf(x)<br>    v := reflect.ValueOf(x)<br>    fmt.Println(<span class="hljs-string">&quot;Type:&quot;</span>, t)<br>    fmt.Println(<span class="hljs-string">&quot;Value:&quot;</span>, v)<br>&#125;<br><span class="hljs-comment">// è¾“å‡º: Type: int</span><br><span class="hljs-comment">// è¾“å‡º: Value: 42</span><br></code></pre></td></tr></table></figure><h3 id="åå°„å’Œæ¥å£"><a href="#åå°„å’Œæ¥å£" class="headerlink" title="åå°„å’Œæ¥å£"></a><strong>åå°„å’Œæ¥å£</strong></h3><p>åœ¨Goä¸­ï¼Œæ¥å£ï¼ˆinterfaceï¼‰å’Œåå°„æ˜¯ç´§å¯†ç›¸å…³çš„ã€‚äº‹å®ä¸Šï¼Œä½ å¯ä»¥è®¤ä¸ºæ¥å£æ˜¯å®ç°åå°„çš„â€œå…¥å£â€ã€‚å½“ä½ å°†ä¸€ä¸ªå…·ä½“ç±»å‹çš„å˜é‡èµ‹ç»™ä¸€ä¸ªæ¥å£å˜é‡æ—¶ï¼Œè¿™ä¸ªæ¥å£å˜é‡å†…éƒ¨å­˜å‚¨äº†è¿™ä¸ªå…·ä½“å˜é‡çš„ç±»å‹ä¿¡æ¯å’Œæ•°æ®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šæ¥å£ä¸åå°„</span><br><span class="hljs-keyword">type</span> Any <span class="hljs-keyword">interface</span>&#123;&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">inspect</span><span class="hljs-params">(a Any)</span></span> &#123;<br>    t := reflect.TypeOf(a)<br>    v := reflect.ValueOf(a)<br>    fmt.Println(<span class="hljs-string">&quot;Type:&quot;</span>, t, <span class="hljs-string">&quot;Value:&quot;</span>, v)<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> x <span class="hljs-type">int</span> = <span class="hljs-number">10</span><br>    <span class="hljs-keyword">var</span> y <span class="hljs-type">float64</span> = <span class="hljs-number">20.0</span><br>    inspect(x) <span class="hljs-comment">// Type: int Value: 10</span><br>    inspect(y) <span class="hljs-comment">// Type: float64 Value: 20</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åå°„çš„åˆ†ç±»"><a href="#åå°„çš„åˆ†ç±»" class="headerlink" title="åå°„çš„åˆ†ç±»"></a>åå°„çš„åˆ†ç±»</h3><p>å°„åœ¨Goä¸­ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹å‘ï¼š</p><ol><li><strong>ç±»å‹åå°„ï¼ˆType Reflectionï¼‰</strong>: ä¸»è¦å…³æ³¨äºç¨‹åºè¿è¡Œæ—¶è·å–å˜é‡çš„ç±»å‹ä¿¡æ¯ã€‚</li><li><strong>å€¼åå°„ï¼ˆValue Reflectionï¼‰</strong>: ä¸»è¦å…³æ³¨äºç¨‹åºè¿è¡Œæ—¶è·å–æˆ–è®¾ç½®å˜é‡çš„å€¼ã€‚</li></ol><h4 id="ç±»å‹åå°„"><a href="#ç±»å‹åå°„" class="headerlink" title="ç±»å‹åå°„"></a>ç±»å‹åå°„</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šç±»å‹åå°„</span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;reflect&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> MyStruct <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</span><br><span class="hljs-keyword">var</span> x MyStruct<br>t := reflect.TypeOf(x)<br>fmt.Println(<span class="hljs-string">&quot;Type Name:&quot;</span>, t.Name()) <span class="hljs-comment">// è¾“å‡º: Type Name: MyStruct</span><br>fmt.Println(<span class="hljs-string">&quot;Type Kind:&quot;</span>, t.Kind()) <span class="hljs-comment">// è¾“å‡º: Type Kind: Struct</span><br><br><span class="hljs-comment">// ä½¿ç”¨é¢„å®šä¹‰ç±»å‹</span><br><span class="hljs-keyword">var</span> y <span class="hljs-type">int</span><br>t = reflect.TypeOf(y)<br>fmt.Println(<span class="hljs-string">&quot;Type Name:&quot;</span>, t.Name()) <span class="hljs-comment">// è¾“å‡º: Type Name: </span><br>fmt.Println(<span class="hljs-string">&quot;Type Kind:&quot;</span>, t.Kind()) <span class="hljs-comment">// è¾“å‡º: Type Kind: Int</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å€¼åå°„"><a href="#å€¼åå°„" class="headerlink" title="å€¼åå°„"></a>å€¼åå°„</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šå€¼åå°„</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">inspectValue</span><span class="hljs-params">(x <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;<br>    v := reflect.ValueOf(x)<br>    fmt.Println(<span class="hljs-string">&quot;Value:&quot;</span>, v)<br>    fmt.Println(<span class="hljs-string">&quot;Is Zero:&quot;</span>, v.IsZero())<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    inspectValue(<span class="hljs-number">42</span>)       <span class="hljs-comment">// Value: 42, Is Zero: false</span><br>    inspectValue(<span class="hljs-string">&quot;&quot;</span>)       <span class="hljs-comment">// Value: , Is Zero: true</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åå°„çš„é™åˆ¶ä¸è­¦å‘Š"><a href="#åå°„çš„é™åˆ¶ä¸è­¦å‘Š" class="headerlink" title="åå°„çš„é™åˆ¶ä¸è­¦å‘Š"></a>åå°„çš„é™åˆ¶ä¸è­¦å‘Š</h3><p>å°½ç®¡åå°„éå¸¸å¼ºå¤§ï¼Œä½†ä¹Ÿæœ‰å…¶å±€é™æ€§å’Œé£é™©ï¼Œæ¯”å¦‚æ€§èƒ½å¼€é”€ã€ä»£ç å¯è¯»æ€§ä¸‹é™ç­‰ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨åå°„æ—¶ï¼Œéœ€è¦è°¨æ…è¯„ä¼°æ˜¯å¦çœŸçš„éœ€è¦ä½¿ç”¨åå°„ï¼Œä»¥åŠå¦‚ä½•æœ€æœ‰æ•ˆåœ°ä½¿ç”¨å®ƒã€‚</p><h2 id="3ã€ä¸ºä»€ä¹ˆéœ€è¦åå°„"><a href="#3ã€ä¸ºä»€ä¹ˆéœ€è¦åå°„" class="headerlink" title="3ã€ä¸ºä»€ä¹ˆéœ€è¦åå°„"></a>3ã€ä¸ºä»€ä¹ˆéœ€è¦åå°„</h2><p>è™½ç„¶åå°„æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œä½†å®ƒä¹Ÿå¸¸å¸¸è¢«æ‰¹è¯„ä¸ºå½±å“ä»£ç å¯è¯»æ€§å’Œæ€§èƒ½ã€‚é‚£ä¹ˆï¼Œä½•æ—¶ä»¥åŠä¸ºä½•éœ€è¦ä½¿ç”¨åå°„å‘¢ï¼Ÿ</p><h4 id="æå‡ä»£ç çµæ´»æ€§"><a href="#æå‡ä»£ç çµæ´»æ€§" class="headerlink" title="æå‡ä»£ç çµæ´»æ€§"></a>æå‡ä»£ç çµæ´»æ€§</h4><p>ä½¿ç”¨åå°„ï¼Œä½ å¯ä»¥ç¼–å†™å‡ºæ›´åŠ é€šç”¨å’Œå¯é…ç½®çš„ä»£ç ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹ï¼Œå¯¹ç¨‹åºè¡Œä¸ºè¿›è¡Œè°ƒæ•´ã€‚</p><h4 id="é…ç½®åŒ–"><a href="#é…ç½®åŒ–" class="headerlink" title="é…ç½®åŒ–"></a>é…ç½®åŒ–</h4><p>åå°„ä½¿å¾—ä»é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½ä»£ç è®¾ç½®æˆä¸ºå¯èƒ½ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šä»JSONé…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½è®¾ç½®</span><br><span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> &#123;<br>    Field1 <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;field1&quot;`</span><br>    Field2 <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;field2&quot;`</span><br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadConfig</span><span class="hljs-params">(jsonStr <span class="hljs-type">string</span>, config *Config)</span></span> &#123;<br>    v := reflect.ValueOf(config).Elem()<br>    t := v.Type()<br>    <span class="hljs-comment">// çœç•¥JSONè§£ææ­¥éª¤</span><br>    <span class="hljs-comment">// åŠ¨æ€è®¾ç½®å­—æ®µå€¼</span><br>    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; t.NumField(); i++ &#123;<br>        field := t.Field(i)<br>        jsonTag := field.Tag.Get(<span class="hljs-string">&quot;json&quot;</span>)<br>        <span class="hljs-comment">// ä½¿ç”¨jsonTagä»JSONæ•°æ®ä¸­è·å–ç›¸åº”çš„å€¼ï¼Œå¹¶è®¾ç½®åˆ°ç»“æ„ä½“å­—æ®µ</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ’ä»¶åŒ–"><a href="#æ’ä»¶åŒ–" class="headerlink" title="æ’ä»¶åŒ–"></a>æ’ä»¶åŒ–</h4><p>åå°„èƒ½å¤Ÿä½¿å¾—ç¨‹åºæ›´å®¹æ˜“æ”¯æŒæ’ä»¶ï¼Œæä¾›äº†ä¸€ç§åŠ¨æ€åŠ è½½å’Œæ‰§è¡Œä»£ç çš„æœºåˆ¶ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šåŠ¨æ€åŠ è½½æ’ä»¶</span><br><span class="hljs-keyword">type</span> Plugin <span class="hljs-keyword">interface</span> &#123;<br>    PerformAction()<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadPlugin</span><span class="hljs-params">(pluginName <span class="hljs-type">string</span>)</span></span> Plugin &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨åå°„æ¥åŠ¨æ€åˆ›å»ºæ’ä»¶å®ä¾‹</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä»£ç è§£è€¦"><a href="#ä»£ç è§£è€¦" class="headerlink" title="ä»£ç è§£è€¦"></a>ä»£ç è§£è€¦</h4><p>åå°„ä¹Ÿè¢«å¹¿æ³›ç”¨äºè§£è€¦ä»£ç ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¡†æ¶å’Œåº“çš„è®¾è®¡ä¸­ã€‚</p><h4 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h4><p>è®¸å¤šç°ä»£æ¡†æ¶ä½¿ç”¨åå°„æ¥å®ç°ä¾èµ–æ³¨å…¥ï¼Œä»è€Œå‡å°‘ä»£ç é—´çš„ç¡¬ç¼–ç å…³ç³»ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šä¾èµ–æ³¨å…¥</span><br><span class="hljs-keyword">type</span> Database <span class="hljs-keyword">interface</span> &#123;<br>    Query()<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Inject</span><span class="hljs-params">(db Database)</span></span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> db Database<br>    <span class="hljs-comment">// ä½¿ç”¨åå°„æ¥åŠ¨æ€åˆ›å»ºDatabaseçš„å®ä¾‹</span><br>    Inject(db)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åŠ¨æ€æ–¹æ³•è°ƒç”¨"><a href="#åŠ¨æ€æ–¹æ³•è°ƒç”¨" class="headerlink" title="åŠ¨æ€æ–¹æ³•è°ƒç”¨"></a>åŠ¨æ€æ–¹æ³•è°ƒç”¨</h4><p>åå°„å¯ä»¥ç”¨äºåŠ¨æ€åœ°è°ƒç”¨æ–¹æ³•ï¼Œè¿™åœ¨æ„å»ºçµæ´»çš„APIæˆ–RPCç³»ç»Ÿä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šåŠ¨æ€æ–¹æ³•è°ƒç”¨</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CallMethod</span><span class="hljs-params">(instance <span class="hljs-keyword">interface</span>&#123;&#125;, methodName <span class="hljs-type">string</span>, args ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;<br>    v := reflect.ValueOf(instance)<br>    method := v.MethodByName(methodName)<br>    <span class="hljs-comment">// è½¬æ¢argså¹¶è°ƒç”¨æ–¹æ³•</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ€§èƒ½ä¸å®‰å…¨æ€§çš„æƒè¡¡"><a href="#æ€§èƒ½ä¸å®‰å…¨æ€§çš„æƒè¡¡" class="headerlink" title="æ€§èƒ½ä¸å®‰å…¨æ€§çš„æƒè¡¡"></a>æ€§èƒ½ä¸å®‰å…¨æ€§çš„æƒè¡¡</h4><p>ä½¿ç”¨åå°„çš„ç¡®ä¼šæœ‰ä¸€äº›æ€§èƒ½å¼€é”€ï¼Œä½†è¿™é€šå¸¸å¯ä»¥é€šè¿‡åˆç†çš„æ¶æ„è®¾è®¡å’Œä¼˜åŒ–æ¥ç¼“è§£ã€‚åŒæ—¶ï¼Œç”±äºåå°„å¯ä»¥è®©ä½ è®¿é—®æˆ–ä¿®æ”¹ç§æœ‰å­—æ®µå’Œæ–¹æ³•ï¼Œå› æ­¤éœ€è¦æ³¨æ„å®‰å…¨æ€§é—®é¢˜ã€‚</p><h2 id="4ã€Goä¸­åå°„çš„å®ç°"><a href="#4ã€Goä¸­åå°„çš„å®ç°" class="headerlink" title="4ã€Goä¸­åå°„çš„å®ç°"></a>4ã€Goä¸­åå°„çš„å®ç°</h2><p>å˜é‡æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šå˜é‡çš„ç±»å‹å’Œå˜é‡çš„å€¼ã€‚</p><p><code>reflect.Type</code> å’Œ <code>reflect.Value</code> æ˜¯åå°„çš„ä¸¤å¤§åŸºæœ¬è¦ç´ ï¼Œä»–ä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š</p><ul><li><p>ä»»æ„ç±»å‹éƒ½å¯ä»¥è½¬æ¢æˆ <code>Type</code> å’Œ <code>Value</code></p></li><li><p><code>Value</code> å¯ä»¥è½¬æ¢æˆ <code>Type</code></p><ul><li><p><code>reflect.Value</code>å¯ä»¥å¾ˆå®¹æ˜“åœ°è½¬æ¢ä¸º<code>reflect.Type</code>ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†è·å–<code>Value</code>æ‰€è¡¨ç¤ºçš„å€¼çš„ç±»å‹ä¿¡æ¯ã€‚ä½ å¯ä»¥é€šè¿‡è°ƒç”¨<code>reflect.Value</code>çš„<code>Type()</code>æ–¹æ³•æ¥è·å–å…¶ä»£è¡¨çš„ç±»å‹çš„<code>reflect.Type</code>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">v := reflect.ValueOf(<span class="hljs-number">123</span>)<br>t := v.Type()<br>fmt.Printf(<span class="hljs-string">&quot;Type: %s\n&quot;</span>, t) <span class="hljs-comment">// è¾“å‡º: Type: int</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><code>Value</code> å¯ä»¥è½¬æ¢æˆ <code>Interface</code></p><ul><li><p><code>reflect.Value</code>å¯ä»¥è½¬æ¢ä¸º<code>interface&#123;&#125;</code>ï¼Œè¿™ä½¿å¾—ä½ èƒ½å¤Ÿä»åå°„ä¸–ç•Œè¿”å›åˆ°å¸¸è§„çš„Goç¼–ç¨‹ä¸–ç•Œã€‚<code>reflect.Value</code>çš„<code>Interface()</code>æ–¹æ³•ç”¨äºè¿™ç§è½¬æ¢ã€‚è¿™åœ¨ä½ éœ€è¦å°†åå°„å¾—åˆ°çš„å€¼ä½œä¸ºæ™®é€šå€¼ä½¿ç”¨æ—¶éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚å½“ä½ éœ€è¦å°†å€¼ä¼ é€’ç»™ä¸€ä¸ªæœŸæœ›å…·ä½“ç±»å‹çš„å‡½æ•°æ—¶ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">v := reflect.ValueOf(<span class="hljs-number">123</span>)<br>i := v.Interface()<br>fmt.Printf(<span class="hljs-string">&quot;Value: %T, %v\n&quot;</span>, i, i) <span class="hljs-comment">// è¾“å‡º: Value: int, 123</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><p><img src="https://github.com/gondmhd/blogImage/blob/main/img//image-20240722141955691.png?raw=true" alt="ç±»å‹å’Œå€¼"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">v := reflect.ValueOf(<span class="hljs-number">123</span>)<br>t := v.Type()<br>fmt.Printf(<span class="hljs-string">&quot;Type: %s\n&quot;</span>, t) <span class="hljs-comment">// è¾“å‡º: Type: int</span><br></code></pre></td></tr></table></figure><h3 id="reflect-Value-è½¬æ¢ä¸º-interface"><a href="#reflect-Value-è½¬æ¢ä¸º-interface" class="headerlink" title="reflect.Value è½¬æ¢ä¸º interface{}"></a><code>reflect.Value</code> è½¬æ¢ä¸º <code>interface&#123;&#125;</code></h3><h3 id="reflectåŒ…çš„æ ¸å¿ƒç»„ä»¶"><a href="#reflectåŒ…çš„æ ¸å¿ƒç»„ä»¶" class="headerlink" title="reflectåŒ…çš„æ ¸å¿ƒç»„ä»¶"></a>reflectåŒ…çš„æ ¸å¿ƒç»„ä»¶</h3><h4 id="Typeæ¥å£"><a href="#Typeæ¥å£" class="headerlink" title="Typeæ¥å£"></a>Typeæ¥å£</h4><p><code>reflect.Type</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæä¾›å¾ˆå¤š <code>api</code>(æ–¹æ³•) è®©ä½ è·å–å˜é‡çš„å„ç§ä¿¡æ¯ã€‚<code>reflect.TypeOf</code> è¿”å›ä¸€ä¸ª <code>reflect.Type</code> ç±»å‹çš„å€¼ï¼Œè¿™ä¸ªå€¼åªåŒ…å«äº†ä¼ å…¥å‚æ•°çš„ç±»å‹ä¿¡æ¯ã€‚<code>reflect.Type</code> æè¿°äº†ç±»å‹çš„å„ç§ç‰¹æ€§ï¼Œå¦‚ç±»å‹åç§°ã€å­—æ®µåˆ—è¡¨ã€æ–¹æ³•é›†ç­‰ï¼Œä½†å®ƒä¸åŒ…å«ä»»ä½•å…·ä½“çš„å€¼ä¿¡æ¯ã€‚<code>reflect.Type</code> ä¸»è¦ç”¨äºç±»å‹æ£€æŸ¥å’Œç±»å‹è½¬æ¢ï¼Œä¾‹å¦‚ï¼š</p><ul><li>æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯ç‰¹å®šç±»å‹</li><li>åœ¨è¿è¡Œæ—¶åˆ›å»ºæ–°çš„å€¼ï¼ˆä¾‹å¦‚ä½¿ç”¨ <code>reflect.New</code> æˆ– <code>reflect.MakeSlice</code>ï¼‰</li><li>è·å–ç±»å‹ä¿¡æ¯ï¼Œå¦‚å­—æ®µæ•°é‡ã€å­—æ®µåã€å­—æ®µç±»å‹ç­‰</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šä½¿ç”¨Typeæ¥å£</span><br>t := reflect.TypeOf(<span class="hljs-number">42</span>)<br>fmt.Println(t.Name()) <span class="hljs-comment">// è¾“å‡º &quot;int&quot;</span><br>fmt.Println(t.Kind()) <span class="hljs-comment">// è¾“å‡º &quot;int&quot;</span><br></code></pre></td></tr></table></figure><p>ä¸åŒç±»å‹å¯ä»¥ä½¿ç”¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240722142418874.png?raw=true" alt="typeæ–¹æ³•"></p><p>æ¯ç§ç±»å‹å¯ä»¥ä½¿ç”¨çš„æ–¹æ³•éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œé”™è¯¯çš„ä½¿ç”¨ä¼šå¼•å‘ <code>panic</code></p><p>1.21ç‰ˆæœ¬å·²ç»æ”¯æŒsliceçš„lenæ–¹æ³•</p><h4 id="Valueç»“æ„"><a href="#Valueç»“æ„" class="headerlink" title="Valueç»“æ„"></a>Valueç»“æ„</h4><p><code>reflect.ValueOf</code> è¿”å›ä¸€ä¸ª <code>reflect.Value</code> ç±»å‹çš„å€¼ï¼Œè¿™ä¸ªå€¼åŒ…å«äº†ä¼ å…¥å‚æ•°çš„è¿è¡Œæ—¶ä¿¡æ¯ï¼Œä¸ä»…åŒ…æ‹¬ç±»å‹ä¿¡æ¯ï¼Œè¿˜åŒ…æ‹¬å…·ä½“çš„å€¼ã€‚<code>reflect.Value</code> æä¾›äº†ä¸€ç»„ä¸°å¯Œçš„æ–¹æ³•ï¼Œå…è®¸ä½ æ£€æŸ¥å’Œä¿®æ”¹å€¼çš„å„ä¸ªæ–¹é¢ï¼Œä¾‹å¦‚ï¼š</p><ul><li>è°ƒç”¨æ–¹æ³•</li><li>è®¿é—®ç»“æ„ä½“å­—æ®µ</li><li>ä¿®æ”¹å˜é‡çš„å€¼</li><li>æ£€æŸ¥å˜é‡æ˜¯å¦å¯å¯»å€</li><li>æ“ä½œåˆ‡ç‰‡ã€æ•°ç»„ã€æ˜ å°„ç­‰å¤åˆç±»å‹</li></ul><p><code>reflect.ValueOf</code> ä¸»è¦ç”¨äºåŠ¨æ€åœ°æ“ä½œå’Œæ£€æŸ¥å€¼ï¼Œä¾‹å¦‚åœ¨è¿è¡Œæ—¶è§£æå¤æ‚çš„ç»“æ„æˆ–æ‰§è¡Œç±»å‹æ— å…³çš„æ“ä½œã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šä½¿ç”¨Valueç»“æ„</span><br>v := reflect.ValueOf(<span class="hljs-number">42</span>)<br>fmt.Println(v.Type())  <span class="hljs-comment">// è¾“å‡º &quot;int&quot;</span><br>fmt.Println(v.Int())   <span class="hljs-comment">// è¾“å‡º 42</span><br></code></pre></td></tr></table></figure><h3 id="åå°„çš„æ“ä½œæ­¥éª¤"><a href="#åå°„çš„æ“ä½œæ­¥éª¤" class="headerlink" title="åå°„çš„æ“ä½œæ­¥éª¤"></a>åå°„çš„æ“ä½œæ­¥éª¤</h3><p>åœ¨Goä¸­è¿›è¡Œåå°„æ“ä½œé€šå¸¸æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>è·å–<code>Type</code>å’Œ<code>Value</code></strong>: ä½¿ç”¨**<code>reflect.TypeOf()</code><strong>å’Œ</strong><code>reflect.ValueOf()</code>**ã€‚</li><li><strong>ç±»å‹å’Œå€¼çš„æŸ¥è¯¢</strong>: é€šè¿‡**<code>Type</code><strong>å’Œ</strong><code>Value</code>**æ¥å£æ–¹æ³•ã€‚</li><li><strong>ä¿®æ”¹å€¼</strong>: ä½¿ç”¨**<code>Value</code><strong>çš„</strong><code>Set()</code>**æ–¹æ³•ï¼ˆæ³¨æ„å¯å¯¼å‡ºæ€§ï¼‰ã€‚</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šåå°„çš„æ“ä½œæ­¥éª¤</span><br><span class="hljs-keyword">var</span> x <span class="hljs-type">float64</span> = <span class="hljs-number">3.4</span><br> <br>v := reflect.ValueOf(x)<br>fmt.Println(<span class="hljs-string">&quot;Setting a value:&quot;</span>)<br>v.SetFloat(<span class="hljs-number">7.1</span>)  <span class="hljs-comment">// è¿è¡Œæ—¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºvä¸æ˜¯å¯è®¾ç½®çš„ï¼ˆsettableï¼‰</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨åå°„ï¼ˆreflectionï¼‰æ¥æ“ä½œå˜é‡æ—¶ï¼Œéœ€è¦ç¡®ä¿ä½ æ­£åœ¨æ“ä½œçš„å€¼æ˜¯å¯è®¾ç½®çš„ï¼ˆsettableï¼‰ã€‚å½“ä½ è·å–ä¸€ä¸ªå˜é‡çš„åå°„å€¼æ—¶ï¼Œè¿™ä¸ªå€¼é»˜è®¤æ˜¯ä¸å¯è®¾ç½®çš„ï¼Œè¿™æ„å‘³ç€ä½ ä¸èƒ½ç›´æ¥ä¿®æ”¹å®ƒçš„å€¼ã€‚ä¸ºäº†èƒ½å¤Ÿä¿®æ”¹ä¸€ä¸ªå€¼ï¼Œä½ éœ€è¦é€šè¿‡<code>reflect.ValueOf</code>è·å–ä¸€ä¸ªæŒ‡å‘è¯¥å€¼çš„æŒ‡é’ˆçš„åå°„å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> x <span class="hljs-type">float64</span> = <span class="hljs-number">3.4</span><br><br><span class="hljs-comment">// è·å–æŒ‡å‘xçš„æŒ‡é’ˆçš„åå°„å€¼</span><br>p := reflect.ValueOf(&amp;x).Elem()<br><br>fmt.Println(<span class="hljs-string">&quot;Setting a value:&quot;</span>)<br>p.SetFloat(<span class="hljs-number">7.1</span>) <span class="hljs-comment">// è¿™é‡Œå¯ä»¥æˆåŠŸè®¾ç½®æ–°å€¼ï¼Œå› ä¸ºpç°åœ¨æ˜¯å¯è®¾ç½®çš„</span><br><br>fmt.Println(<span class="hljs-string">&quot;New value of x:&quot;</span>, x) <span class="hljs-comment">// è¾“å‡ºæ–°çš„xå€¼</span><br></code></pre></td></tr></table></figure><h3 id="åŠ¨æ€æ–¹æ³•è°ƒç”¨å’Œå­—æ®µè®¿é—®"><a href="#åŠ¨æ€æ–¹æ³•è°ƒç”¨å’Œå­—æ®µè®¿é—®" class="headerlink" title="åŠ¨æ€æ–¹æ³•è°ƒç”¨å’Œå­—æ®µè®¿é—®"></a>åŠ¨æ€æ–¹æ³•è°ƒç”¨å’Œå­—æ®µè®¿é—®</h3><p>åå°„ä¸ä»…å¯ä»¥ç”¨äºåŸºç¡€ç±»å‹å’Œç»“æ„ä½“ï¼Œè¿˜å¯ä»¥ç”¨äºåŠ¨æ€åœ°è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å­—æ®µã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šåŠ¨æ€æ–¹æ³•è°ƒç”¨</span><br><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>    Name <span class="hljs-type">string</span><br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *Person)</span></span> SayHello() &#123;<br>    fmt.Println(<span class="hljs-string">&quot;Hello, my name is&quot;</span>, p.Name)<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    p := &amp;Person&#123;Name: <span class="hljs-string">&quot;John&quot;</span>&#125;<br>    value := reflect.ValueOf(p)<br>    method := value.MethodByName(<span class="hljs-string">&quot;SayHello&quot;</span>)<br>    method.Call(<span class="hljs-literal">nil</span>)  <span class="hljs-comment">// è¾“å‡º &quot;Hello, my name is John&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åå°„çš„åº•å±‚æœºåˆ¶"><a href="#åå°„çš„åº•å±‚æœºåˆ¶" class="headerlink" title="åå°„çš„åº•å±‚æœºåˆ¶"></a>åå°„çš„åº•å±‚æœºåˆ¶</h3><p>Goçš„åå°„å®ç°ä¾èµ–äºåº•å±‚çš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¿™äº›é€šå¸¸æ˜¯ä¸æš´éœ²ç»™æœ€ç»ˆç”¨æˆ·çš„ã€‚ç„¶è€Œï¼Œäº†è§£è¿™äº›å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´åŠ ç²¾ç¡®åœ°æŒæ¡åå°„çš„å·¥ä½œåŸç†ã€‚</p><h4 id="æ¥å£çš„å†…éƒ¨ç»“æ„"><a href="#æ¥å£çš„å†…éƒ¨ç»“æ„" class="headerlink" title="æ¥å£çš„å†…éƒ¨ç»“æ„"></a>æ¥å£çš„å†…éƒ¨ç»“æ„</h4><p>Goä¸­çš„æ¥å£å®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæŒ‡é’ˆå­—æ®µçš„ç»“æ„ä½“ï¼šä¸€ä¸ªæŒ‡å‘å€¼çš„ç±»å‹ä¿¡æ¯ï¼Œå¦ä¸€ä¸ªæŒ‡å‘å€¼æœ¬èº«ã€‚</p><h4 id="åå°„APIä¸åº•å±‚çš„æ˜ å°„"><a href="#åå°„APIä¸åº•å±‚çš„æ˜ å°„" class="headerlink" title="åå°„APIä¸åº•å±‚çš„æ˜ å°„"></a>åå°„APIä¸åº•å±‚çš„æ˜ å°„</h4><p>**<code>reflect</code>**åŒ…çš„APIå…¶å®æ˜¯åº•å±‚å®ç°çš„ä¸€å±‚å°è£…ï¼Œè¿™æ ·ç”¨æˆ·å°±ä¸éœ€è¦ç›´æ¥ä¸åº•å±‚æ•°æ®ç»“æ„å’Œç®—æ³•äº¤äº’ã€‚</p><h2 id="5ã€åŸºç¡€æ“ä½œ"><a href="#5ã€åŸºç¡€æ“ä½œ" class="headerlink" title="5ã€åŸºç¡€æ“ä½œ"></a>5ã€åŸºç¡€æ“ä½œ</h2><h3 id="ç±»å‹æŸ¥è¯¢ä¸æ–­è¨€"><a href="#ç±»å‹æŸ¥è¯¢ä¸æ–­è¨€" class="headerlink" title="ç±»å‹æŸ¥è¯¢ä¸æ–­è¨€"></a>ç±»å‹æŸ¥è¯¢ä¸æ–­è¨€</h3><p>åœ¨åå°„ä¸­ï¼Œè·å–å¯¹è±¡çš„ç±»å‹æ˜¯æœ€åŸºç¡€çš„æ“ä½œä¹‹ä¸€ã€‚</p><h4 id="è·å–ç±»å‹"><a href="#è·å–ç±»å‹" class="headerlink" title="è·å–ç±»å‹"></a>è·å–ç±»å‹</h4><p>ä½¿ç”¨**<code>reflect.TypeOf()</code>**å‡½æ•°ï¼Œä½ å¯ä»¥è·å¾—ä»»ä½•å¯¹è±¡çš„ç±»å‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šè·å–ç±»å‹</span><br><span class="hljs-keyword">var</span> str <span class="hljs-type">string</span> = <span class="hljs-string">&quot;hello&quot;</span><br>t := reflect.TypeOf(str)<br>fmt.Println(t)  <span class="hljs-comment">// è¾“å‡º &quot;string&quot;</span><br></code></pre></td></tr></table></figure><h4 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h4><p>åå°„æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œç”¨äºæ–­è¨€ç±»å‹ï¼Œå¹¶åœ¨è¿è¡Œæ—¶åšå‡ºç›¸åº”çš„æ“ä½œã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šç±»å‹æ–­è¨€</span><br>v := reflect.ValueOf(str)<br><span class="hljs-keyword">if</span> v.Kind() == reflect.String &#123;<br>    fmt.Println(<span class="hljs-string">&quot;The variable is a string!&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å­—æ®µä¸æ–¹æ³•æ“ä½œ"><a href="#å­—æ®µä¸æ–¹æ³•æ“ä½œ" class="headerlink" title="å­—æ®µä¸æ–¹æ³•æ“ä½œ"></a>å­—æ®µä¸æ–¹æ³•æ“ä½œ</h3><p>åå°„å¯ä»¥ç”¨äºåŠ¨æ€åœ°è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„å­—æ®µå’Œæ–¹æ³•ã€‚</p><h4 id="å­—æ®µè®¿é—®"><a href="#å­—æ®µè®¿é—®" class="headerlink" title="å­—æ®µè®¿é—®"></a>å­—æ®µè®¿é—®</h4><p><strong>é€šè¿‡å€¼ç±»å‹è®¿é—®å­—æ®µ</strong></p><p>å¦‚æœç»“æ„ä½“å®ä¾‹æ˜¯ä¸€ä¸ªå€¼ç±»å‹ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨<code>reflect.Value</code>çš„<code>Field</code>æˆ–<code>FieldByName</code>æ–¹æ³•æ¥è®¿é—®å…¶å­—æ®µã€‚ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ æ‰“ç®—ä¿®æ”¹è¿™äº›å­—æ®µçš„å€¼ï¼Œé‚£ä¹ˆç»“æ„ä½“å®ä¾‹å¿…é¡»æ˜¯å¯å¯»å€çš„ï¼ˆå³ï¼Œä½ å¿…é¡»æœ‰æŒ‡å‘è¿™ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆï¼Œæˆ–è€…è¿™ä¸ªç»“æ„ä½“æ˜¯åœ¨å¯ä¿®æ”¹çš„ä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„ï¼Œå¦‚å±€éƒ¨å˜é‡ï¼‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;reflect&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> MyStruct <span class="hljs-keyword">struct</span> &#123;<br>Field1 <span class="hljs-type">string</span><br>Field2 <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ms := MyStruct&#123;<span class="hljs-string">&quot;Hello&quot;</span>, <span class="hljs-number">42</span>&#125;<br>v := reflect.ValueOf(ms)<br>field := v.FieldByName(<span class="hljs-string">&quot;Field1&quot;</span>)<br>fmt.Println(field.String()) <span class="hljs-comment">// è¾“å‡º: Hello</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>é€šè¿‡æŒ‡é’ˆç±»å‹è®¿é—®å­—æ®µ</strong></p><p>å¦‚æœç»“æ„ä½“å®ä¾‹æ˜¯é€šè¿‡æŒ‡é’ˆè®¿é—®çš„ï¼Œæˆ–è€…ä½ éœ€è¦ä¿®æ”¹å­—æ®µçš„å€¼ï¼Œé‚£ä¹ˆä½ åº”å½“ä½¿ç”¨æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆçš„<code>reflect.Value</code>ï¼Œç„¶åä½¿ç”¨<code>Elem</code>æ–¹æ³•è·å–æŒ‡å‘ç»“æ„ä½“çš„å€¼ï¼Œå†ä½¿ç”¨<code>Field</code>æˆ–<code>FieldByName</code>æ–¹æ³•æ¥è®¿é—®å­—æ®µã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;reflect&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> MyStruct <span class="hljs-keyword">struct</span> &#123;<br>Field1 <span class="hljs-type">string</span><br>Field2 <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ms := MyStruct&#123;<span class="hljs-string">&quot;Hello&quot;</span>, <span class="hljs-number">42</span>&#125;<br>v := reflect.ValueOf(&amp;ms) <span class="hljs-comment">// æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ</span><br>elem := v.Elem()          <span class="hljs-comment">// è·å–æŒ‡å‘çš„ç»“æ„ä½“å€¼</span><br>field := elem.FieldByName(<span class="hljs-string">&quot;Field1&quot;</span>)<br>fmt.Println(field.String()) <span class="hljs-comment">// è¾“å‡º: Hello</span><br><br><span class="hljs-comment">// ä¿®æ”¹å­—æ®µçš„å€¼</span><br>field.SetString(<span class="hljs-string">&quot;Goodbye&quot;</span>)<br>fmt.Println(ms.Field1) <span class="hljs-comment">// è¾“å‡º: Goodbye</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•è°ƒç”¨"><a href="#æ–¹æ³•è°ƒç”¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨"></a>æ–¹æ³•è°ƒç”¨</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šæ–¹æ³•è°ƒç”¨</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Student)</span></span> SayHello() &#123;<br>    fmt.Println(<span class="hljs-string">&quot;Hello, my name is&quot;</span>, s.Name)<br>&#125;<br>value.MethodByName(<span class="hljs-string">&quot;SayHello&quot;</span>).Call(<span class="hljs-literal">nil</span>)<br></code></pre></td></tr></table></figure><h3 id="åŠ¨æ€åˆ›å»ºå¯¹è±¡"><a href="#åŠ¨æ€åˆ›å»ºå¯¹è±¡" class="headerlink" title="åŠ¨æ€åˆ›å»ºå¯¹è±¡"></a>åŠ¨æ€åˆ›å»ºå¯¹è±¡</h3><p>åå°„è¿˜å¯ä»¥ç”¨äºåŠ¨æ€åœ°åˆ›å»ºæ–°çš„å¯¹è±¡å®ä¾‹ã€‚</p><h4 id="åˆ›å»ºåŸºç¡€ç±»å‹"><a href="#åˆ›å»ºåŸºç¡€ç±»å‹" class="headerlink" title="åˆ›å»ºåŸºç¡€ç±»å‹"></a>åˆ›å»ºåŸºç¡€ç±»å‹</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šåˆ›å»ºåŸºç¡€ç±»å‹</span><br>v := reflect.New(reflect.TypeOf(<span class="hljs-number">0</span>)).Elem()<br>v.SetInt(<span class="hljs-number">42</span>)<br>fmt.Println(v.Int())  <span class="hljs-comment">// è¾“å‡º 42</span><br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºå¤æ‚ç±»å‹"><a href="#åˆ›å»ºå¤æ‚ç±»å‹" class="headerlink" title="åˆ›å»ºå¤æ‚ç±»å‹"></a>åˆ›å»ºå¤æ‚ç±»å‹</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼šåˆ›å»ºå¤æ‚ç±»å‹</span><br>t := reflect.TypeOf(Student&#123;&#125;)<br>v := reflect.New(t).Elem()<br>v.FieldByName(<span class="hljs-string">&quot;Name&quot;</span>).SetString(<span class="hljs-string">&quot;Bob&quot;</span>)<br>v.FieldByName(<span class="hljs-string">&quot;Age&quot;</span>).SetInt(<span class="hljs-number">25</span>)<br>fmt.Println(v.Interface())  <span class="hljs-comment">// è¾“å‡º &#123;Bob 25&#125;</span><br></code></pre></td></tr></table></figure><h2 id="6ã€reflect-DeepEqualå‡½æ•°"><a href="#6ã€reflect-DeepEqualå‡½æ•°" class="headerlink" title="6ã€reflect.DeepEqualå‡½æ•°"></a>6ã€reflect.DeepEqualå‡½æ•°</h2><p><strong>1ã€ä»‹ç»</strong></p><p>åœ¨Goè¯­è¨€ä¸­ï¼Œ<code>reflect</code>åŒ…æä¾›äº†ä¸€å¥—åŠŸèƒ½å¼ºå¤§çš„å·¥å…·æ¥æ£€æŸ¥ã€æ“ä½œå’Œä¿®æ”¹ç¨‹åºçš„è¿è¡Œæ—¶è¡¨ç¤ºã€‚<code>reflect.DeepEqual</code>æ˜¯<code>reflect</code>åŒ…ä¸­çš„ä¸€ä¸ªé‡è¦å‡½æ•°ï¼Œå®ƒç”¨äºåˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦æ·±åº¦ç›¸ç­‰ã€‚</p><p><strong>2ã€<code>reflect.DeepEqual</code>çš„åŸºæœ¬ä½¿ç”¨</strong></p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240807100325879.png?raw=true" alt="å¯ä½¿ç”¨ç±»å‹"></p><p><strong>2.1 ä»€ä¹ˆæ˜¯æ·±åº¦ç›¸ç­‰ï¼Ÿ</strong></p><p>æ·±åº¦ç›¸ç­‰æ˜¯ä¸€ç§<a href="https://so.csdn.net/so/search?q=%E6%AF%94%E8%BE%83%E6%96%B9%E6%B3%95&spm=1001.2101.3001.7020">æ¯”è¾ƒæ–¹æ³•</a>ï¼Œæ—¨åœ¨æ£€æŸ¥ä¸¤ä¸ªå€¼çš„æ‰€æœ‰å±‚çº§æ˜¯å¦å®Œå…¨ä¸€è‡´ã€‚è¿™ä¸ä»…ä»…åŒ…æ‹¬è¡¨é¢å€¼çš„æ¯”è¾ƒï¼Œè¿˜æ¶‰åŠåˆ°å†…éƒ¨æ‰€æœ‰å…ƒç´ çš„é€’å½’æ¯”è¾ƒã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœä¸¤ä¸ªå˜é‡åœ¨ç»“æ„å’Œå†…å®¹ä¸Šå®Œå…¨ä¸€è‡´ï¼Œé‚£ä¹ˆå®ƒä»¬å°±æ˜¯æ·±åº¦ç›¸ç­‰çš„ã€‚</p><p>æµ…å±‚ç›¸ç­‰ä¸»è¦ç”¨äºæ¯”è¾ƒå˜é‡çš„ç›´æ¥å€¼æˆ–å¼•ç”¨ï¼Œè€Œä¸å…³æ³¨å…¶å†…éƒ¨çš„å…ƒç´ æˆ–ç»“æ„æ˜¯å¦ç›¸åŒã€‚è¿™ç§æ¯”è¾ƒæ–¹å¼é€šå¸¸é€‚ç”¨äº<a href="https://so.csdn.net/so/search?q=%E7%AE%80%E5%8D%95%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B&spm=1001.2101.3001.7020">ç®€å•æ•°æ®ç±»å‹</a>æˆ–éœ€è¦å¿«é€Ÿåˆ¤æ–­å¼•ç”¨æ˜¯å¦ç›¸åŒçš„æƒ…å†µã€‚</p><p><code>reflect.DeepEqual</code>å‡½æ•°å¯ä»¥æ¯”è¾ƒä»»ä½•ç±»å‹çš„ä¸¤ä¸ªå€¼ï¼Œå¹¶ç¡®å®šå®ƒä»¬æ˜¯å¦åœ¨æ·±åº¦ä¸Šç›¸ç­‰ã€‚è¿™æ„å‘³ç€ä¸ä»…æ¯”è¾ƒåŸºæœ¬ç±»å‹çš„å€¼ï¼Œè¿˜ä¼šé€’å½’åœ°æ¯”è¾ƒå¤åˆç±»å‹çš„æ‰€æœ‰å…ƒç´ ï¼Œå¦‚<a href="https://so.csdn.net/so/search?q=%E7%BB%93%E6%9E%84%E4%BD%93&spm=1001.2101.3001.7020">ç»“æ„ä½“</a>ã€åˆ‡ç‰‡ã€æ˜ å°„ç­‰ã€‚</p><p>å®ä¾‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;reflect&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    a := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-string">&quot;one&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;two&quot;</span>: <span class="hljs-number">2</span>&#125;<br>    b := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-string">&quot;one&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;two&quot;</span>: <span class="hljs-number">2</span>&#125;<br><br>    fmt.Println(reflect.DeepEqual(a, b)) <span class="hljs-comment">// è¾“å‡º: true</span><br><br>    c := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>    d := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>&#125;<br><br>    fmt.Println(reflect.DeepEqual(c, d)) <span class="hljs-comment">// è¾“å‡º: false</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>3. æ·±å…¥ç†è§£<code>reflect.DeepEqual</code></strong></p><p><code>reflect.DeepEqual</code>å‡½æ•°çš„æ¯”è¾ƒé€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li><strong>åŸºæœ¬ç±»å‹</strong>ï¼šç›´æ¥æ¯”è¾ƒå€¼æ˜¯å¦ç›¸ç­‰ã€‚</li><li><strong>æ•°ç»„</strong>ï¼šæ¯”è¾ƒæ¯ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ã€‚</li><li><strong>åˆ‡ç‰‡</strong>ï¼šæ¯”è¾ƒåˆ‡ç‰‡é•¿åº¦å’Œæ¯ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ã€‚</li><li><strong>æ˜ å°„</strong>ï¼šæ¯”è¾ƒé”®å€¼å¯¹çš„æ•°é‡å’Œæ¯ä¸ªé”®å¯¹åº”çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚</li><li><strong>ç»“æ„ä½“</strong>ï¼šæ¯”è¾ƒæ¯ä¸ªå­—æ®µæ˜¯å¦ç›¸ç­‰ã€‚</li><li><strong>æŒ‡é’ˆ</strong>ï¼šæ¯”è¾ƒæŒ‡é’ˆæŒ‡å‘çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚</li><li><strong>æ¥å£</strong>ï¼šæ¯”è¾ƒæ¥å£çš„åŠ¨æ€ç±»å‹å’Œå€¼æ˜¯å¦ç›¸ç­‰ã€‚</li></ol><p><strong>4. <code>reflect.DeepEqual</code>çš„å±€é™æ€§</strong></p><p>å°½ç®¡<code>reflect.DeepEqual</code>éå¸¸å¼ºå¤§ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„ç»“æœï¼š</p><ul><li><strong>æœªå¯¼å‡ºå­—æ®µ</strong>ï¼šå¯¹äºç»“æ„ä½“çš„æœªå¯¼å‡ºå­—æ®µï¼Œ<code>reflect.DeepEqual</code>æ— æ³•è®¿é—®ï¼Œå› æ­¤æ— æ³•æ¯”è¾ƒã€‚</li><li><strong>å‡½æ•°æ¯”è¾ƒ</strong>ï¼šå¦‚æœç»“æ„ä½“æˆ–å®¹å™¨ä¸­åŒ…å«å‡½æ•°ï¼Œ<code>reflect.DeepEqual</code>ä¸ä¼šæ¯”è¾ƒå‡½æ•°é€»è¾‘æ˜¯å¦ç›¸åŒï¼Œåªä¼šæ¯”è¾ƒå‡½æ•°æŒ‡é’ˆæ˜¯å¦ç›¸ç­‰ã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;reflect&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> T <span class="hljs-keyword">struct</span> &#123;<br>    f <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    t1 := T&#123;f: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">int</span> &#123; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> &#125;&#125;<br>    t2 := T&#123;f: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">int</span> &#123; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> &#125;&#125;<br><br>    fmt.Println(reflect.DeepEqual(t1, t2)) <span class="hljs-comment">// è¾“å‡º: false</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå°½ç®¡<code>t1</code>å’Œ<code>t2</code>çš„å‡½æ•°é€»è¾‘ç›¸åŒï¼Œä½†<code>reflect.DeepEqual</code>æ¯”è¾ƒçš„æ˜¯å‡½æ•°çš„æŒ‡é’ˆï¼Œå› æ­¤è¿”å›<code>false</code>ã€‚</p><h2 id="7ã€æ€»ç»“"><a href="#7ã€æ€»ç»“" class="headerlink" title="7ã€æ€»ç»“"></a>7ã€æ€»ç»“</h2><p>è™½ç„¶åå°„å¾ˆçµæ´»ï¼ˆå‡ ä¹å¯ä»¥å¹²ä»»ä½•äº‹æƒ…ï¼‰ï¼Œä¸‹é¢æœ‰ä¸‰ç‚¹å»ºè®®ï¼š</p><ul><li>å¯ä»¥åªä½¿ç”¨ reflect.TypeOf çš„è¯ï¼Œå°±ä¸è¦ä½¿ç”¨ reflect.ValueOf</li><li>å¯ä»¥ä½¿ç”¨æ–­è¨€ä»£æ›¿çš„è¯ï¼Œå°±ä¸è¦ä½¿ç”¨åå°„</li><li>å¦‚æœæœ‰å¯èƒ½åº”å½“é¿å…ä½¿ç”¨åå°„</li></ul>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¸¸ç”¨ä¸‰æ–¹åº“</title>
    <link href="/2024/12/10/go/%E5%B8%B8%E7%94%A8%E4%B8%89%E6%96%B9%E5%BA%93/"/>
    <url>/2024/12/10/go/%E5%B8%B8%E7%94%A8%E4%B8%89%E6%96%B9%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h1 id="å¸¸ç”¨ä¸‰æ–¹åº“"><a href="#å¸¸ç”¨ä¸‰æ–¹åº“" class="headerlink" title="å¸¸ç”¨ä¸‰æ–¹åº“"></a>å¸¸ç”¨ä¸‰æ–¹åº“</h1><h2 id="gjson"><a href="#gjson" class="headerlink" title="gjson"></a>gjson</h2><h3 id="å¿«é€Ÿä½¿ç”¨"><a href="#å¿«é€Ÿä½¿ç”¨" class="headerlink" title="å¿«é€Ÿä½¿ç”¨"></a>å¿«é€Ÿä½¿ç”¨</h3><p>å…ˆå®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">go get github.com/tidwall/gjson<br></code></pre></td></tr></table></figure><p>åä½¿ç”¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>  <span class="hljs-string">&quot;fmt&quot;</span><br><br>  <span class="hljs-string">&quot;github.com/tidwall/gjson&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  json := <span class="hljs-string">`&#123;&quot;name&quot;:&#123;&quot;first&quot;:&quot;li&quot;,&quot;last&quot;:&quot;dj&quot;&#125;,&quot;age&quot;:18&#125;`</span><br>  lastName := gjson.Get(json, <span class="hljs-string">&quot;name.last&quot;</span>)<br>  fmt.Println(<span class="hljs-string">&quot;last name:&quot;</span>, lastName.String())<br><br>  age := gjson.Get(json, <span class="hljs-string">&quot;age&quot;</span>)<br>  fmt.Println(<span class="hljs-string">&quot;age:&quot;</span>, age.Int())<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å¾ˆç®€å•ï¼Œåªéœ€è¦ä¼ å…¥ JSON ä¸²å’Œè¦è¯»å–çš„é”®è·¯å¾„å³å¯ã€‚æ³¨æ„ä¸€ç‚¹ç»†èŠ‚ï¼Œå› ä¸º<code>gjson.Get()</code>å‡½æ•°å®é™…ä¸Šè¿”å›çš„æ˜¯<code>gjson.Result</code>ç±»å‹ï¼Œæˆ‘ä»¬è¦è°ƒç”¨å…¶ç›¸åº”çš„æ–¹æ³•è¿›è¡Œè½¬æ¢å¯¹åº”çš„ç±»å‹ã€‚å¦‚ä¸Šé¢çš„<code>String()</code>å’Œ<code>Int()</code>æ–¹æ³•ã€‚</p><p>å¦‚æœæ˜¯ç›´æ¥æ‰“å°è¾“å‡ºï¼Œå…¶å®å¯ä»¥çœç•¥<code>String()</code>ï¼Œ<code>fmt</code>åŒ…çš„å¤§éƒ¨åˆ†å‡½æ•°éƒ½å¯ä»¥å¯¹å®ç°<code>fmt.Stringer</code>æ¥å£çš„ç±»å‹è°ƒç”¨<code>String()</code>æ–¹æ³•ã€‚</p><h3 id="é”®è·¯å¾„"><a href="#é”®è·¯å¾„" class="headerlink" title="é”®è·¯å¾„"></a>é”®è·¯å¾„</h3><p>é”®è·¯å¾„å®é™…ä¸Šæ˜¯ä»¥<code>.</code>åˆ†éš”çš„ä¸€ç³»åˆ—é”®ã€‚<code>gjson</code>æ”¯æŒåœ¨é”®ä¸­åŒ…å«é€šé…ç¬¦<code>*</code>å’Œ<code>?</code>ï¼Œ<code>*</code>åŒ¹é…ä»»æ„å¤šä¸ªå­—ç¬¦ï¼Œ<code>?</code>åŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œä¾‹å¦‚<code>ca*</code>å¯ä»¥åŒ¹é…<code>cat/cate/cake</code>ç­‰ä»¥<code>ca</code>å¼€å¤´çš„é”®ï¼Œ<code>ca?</code>åªèƒ½åŒ¹é…<code>cat/cap</code>ç­‰ä»¥<code>ca</code>å¼€å¤´ä¸”åé¢åªæœ‰ä¸€ä¸ªå­—ç¬¦çš„é”®ã€‚</p><p>æ•°ç»„ä½¿ç”¨<strong>é”®å + <code>.</code> + ç´¢å¼•</strong>ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰çš„æ–¹å¼è¯»å–å…ƒç´ ï¼Œå¦‚æœé”®<code>pets</code>å¯¹åº”çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆ<code>pets.0</code>è¯»å–æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ<code>pets.1</code>è¯»å–ç¬¬äºŒä¸ªå…ƒç´ ã€‚</p><p>æ•°ç»„é•¿åº¦ä½¿ç”¨<strong>é”®å + <code>.</code> + <code>#</code></strong> è·å–ï¼Œä¾‹å¦‚<code>pets.#</code>è¿”å›æ•°ç»„<code>pets</code>çš„é•¿åº¦ã€‚</p><p>å¦‚æœé”®åä¸­å‡ºç°<code>.</code>ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨<code>\</code>è¿›è¡Œè½¬ä¹‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">const</span> json = <span class="hljs-string">`</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;name&quot;:&#123;&quot;first&quot;:&quot;Tom&quot;, &quot;last&quot;: &quot;Anderson&quot;&#125;,</span><br><span class="hljs-string">  &quot;age&quot;: 37,</span><br><span class="hljs-string">  &quot;children&quot;: [&quot;Sara&quot;, &quot;Alex&quot;, &quot;Jack&quot;],</span><br><span class="hljs-string">  &quot;fav.movie&quot;: &quot;Dear Hunter&quot;,</span><br><span class="hljs-string">  &quot;friends&quot;: [</span><br><span class="hljs-string">    &#123;&quot;first&quot;: &quot;Dale&quot;, &quot;last&quot;:&quot;Murphy&quot;, &quot;age&quot;: 44, &quot;nets&quot;: [&quot;ig&quot;, &quot;fb&quot;, &quot;tw&quot;]&#125;,</span><br><span class="hljs-string">    &#123;&quot;first&quot;: &quot;Roger&quot;, &quot;last&quot;: &quot;Craig&quot;, &quot;age&quot;: 68, &quot;nets&quot;: [&quot;fb&quot;, &quot;tw&quot;]&#125;,</span><br><span class="hljs-string">    &#123;&quot;first&quot;: &quot;Jane&quot;, &quot;last&quot;: &quot;Murphy&quot;, &quot;age&quot;: 47, &quot;nets&quot;: [&quot;ig&quot;, &quot;tw&quot;]&#125;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">`</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  fmt.Println(<span class="hljs-string">&quot;last name:&quot;</span>, gjson.Get(json, <span class="hljs-string">&quot;name.last&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;age:&quot;</span>, gjson.Get(json, <span class="hljs-string">&quot;age&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;children:&quot;</span>, gjson.Get(json, <span class="hljs-string">&quot;children&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;children count:&quot;</span>, gjson.Get(json, <span class="hljs-string">&quot;children.#&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;second child:&quot;</span>, gjson.Get(json, <span class="hljs-string">&quot;children.1&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;third child*:&quot;</span>, gjson.Get(json, <span class="hljs-string">&quot;child*.2&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;first c?ild:&quot;</span>, gjson.Get(json, <span class="hljs-string">&quot;c?ildren.0&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;fav.moive&quot;</span>, gjson.Get(json, <span class="hljs-string">`fav.\moive`</span>))<br>  fmt.Println(<span class="hljs-string">&quot;first name of friends:&quot;</span>, gjson.Get(json, <span class="hljs-string">&quot;friends.#.first&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;last name of second friend:&quot;</span>, gjson.Get(json, <span class="hljs-string">&quot;friends.1.last&quot;</span>))<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å‰ 3 ä¸ªæ¯”è¾ƒç®€å•ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚çœ‹åé¢å‡ ä¸ªï¼š</p><ul><li><code>children.#</code>ï¼šè¿”å›æ•°ç»„<code>children</code>çš„é•¿åº¦ï¼›</li><li><code>children.1</code>ï¼šè¯»å–æ•°ç»„<code>children</code>çš„ç¬¬ 2 ä¸ªå…ƒç´ ï¼ˆæ³¨æ„ç´¢å¼•ä» 0 å¼€å§‹ï¼‰ï¼›</li><li><code>child*.2</code>ï¼šé¦–å…ˆ<code>child*</code>åŒ¹é…<code>children</code>ï¼Œ<code>.2</code>è¯»å–ç¬¬ 3 ä¸ªå…ƒç´ ï¼›</li><li><code>c?ildren.0</code>ï¼š<code>c?ildren</code>åŒ¹é…åˆ°<code>children</code>ï¼Œ<code>.0</code>è¯»å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›</li><li><code>fav.\moive</code>ï¼šå› ä¸ºé”®åä¸­å«æœ‰<code>.</code>ï¼Œæ•…éœ€è¦<code>\</code>è½¬ä¹‰ï¼›</li><li><code>friends.#.first</code>ï¼šå¦‚æœæ•°ç»„å<code>#</code>åè¿˜æœ‰å†…å®¹ï¼Œåˆ™ä»¥åé¢çš„è·¯å¾„è¯»å–æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚æ‰€ä»¥è¯¥æŸ¥è¯¢è¿”å›çš„æ•°ç»„æ‰€æœ‰<code>friends</code>çš„<code>first</code>å­—æ®µç»„æˆï¼›</li><li><code>friends.1.last</code>ï¼šè¯»å–<code>friends</code>ç¬¬ 2 ä¸ªå…ƒç´ çš„<code>last</code>å­—æ®µã€‚</li></ul><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">last name: Anderson<br>age: <span class="hljs-number">37</span><br>children: [<span class="hljs-string">&quot;Sara&quot;</span>, <span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-string">&quot;Jack&quot;</span>]<br>children count: <span class="hljs-number">3</span><br>second child: Alex<br>third child*: Jack<br>first c?ild: Sara<br>fave.moive <br>first name of friends: [<span class="hljs-string">&quot;Dale&quot;</span>,<span class="hljs-string">&quot;Roger&quot;</span>,<span class="hljs-string">&quot;Jane&quot;</span>]<br>last name of second friend: Craig<br></code></pre></td></tr></table></figure><p>å¯¹äºæ•°ç»„ï¼Œ<code>gjson</code>è¿˜æ”¯æŒæŒ‰æ¡ä»¶æŸ¥è¯¢å…ƒç´ ï¼Œ<code>#(æ¡ä»¶)</code>è¿”å›ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œ<code>#(æ¡ä»¶)#</code>è¿”å›æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ã€‚æ‹¬å·å†…çš„æ¡ä»¶å¯ä»¥æœ‰<code>==</code>ã€<code>!=</code>ã€<code>&lt;</code>ã€<code>&lt;=</code>ã€<code>&gt;</code>ã€<code>&gt;=</code>ï¼Œè¿˜æœ‰ç®€å•çš„æ¨¡å¼åŒ¹é…<code>%</code>ï¼ˆç¬¦åˆæŸä¸ªæ¨¡å¼ï¼‰ï¼Œ<code>!%</code>ï¼ˆä¸ç¬¦åˆæŸä¸ªæ¨¡å¼ï¼‰ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go">fmt.Println(gjson.Get(json, <span class="hljs-string">`friends.#(last=&quot;Murphy&quot;).first`</span>))<br>fmt.Println(gjson.Get(json, <span class="hljs-string">`friends.#(last=&quot;Murphy&quot;)#.first`</span>))<br>fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;friends.#(age&gt;45)#.last&quot;</span>))<br>fmt.Println(gjson.Get(json, <span class="hljs-string">`friends.#(first%&quot;D*&quot;).last`</span>))<br>fmt.Println(gjson.Get(json, <span class="hljs-string">`friends.#(first!%&quot;D*&quot;).last`</span>))<br>fmt.Println(gjson.Get(json, <span class="hljs-string">`friends.#(nets.#(==&quot;fb&quot;))#.first`</span>))<br><br></code></pre></td></tr></table></figure><p>è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„ JSON ä¸²ã€‚</p><ul><li><code>friends.#(last=&quot;Murphy&quot;).first</code>ï¼š<code>friends.#(last=&quot;Murphy&quot;)</code>è¿”å›æ•°ç»„<code>friends</code>ä¸­ç¬¬ä¸€ä¸ª<code>last</code>ä¸º<code>Murphy</code>çš„å…ƒç´ ï¼Œ<code>.first</code>è¡¨ç¤ºå–å‡ºè¯¥å…ƒç´ çš„<code>first</code>å­—æ®µè¿”å›ï¼›</li><li><code>friends.#(last=&quot;Murphy&quot;)#.first</code>ï¼š<code>friends.#(last=&quot;Murphy&quot;)#</code>è¿”å›æ•°ç»„<code>friends</code>ä¸­æ‰€æœ‰çš„<code>last</code>ä¸º<code>Murphy</code>çš„å…ƒç´ ï¼Œç„¶åè¯»å–å®ƒä»¬çš„<code>first</code>å­—æ®µæ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­è¿”å›ã€‚æ³¨æ„ä¸ä¸Šé¢ä¸€ä¸ªçš„åŒºåˆ«ï¼›</li><li><code>friends.#(age&gt;45)#.last</code>ï¼š<code>friends.#(age&gt;45)#</code>è¿”å›æ•°ç»„<code>friends</code>ä¸­æ‰€æœ‰å¹´é¾„å¤§äº 45 çš„å…ƒç´ ï¼Œç„¶åè¯»å–å®ƒä»¬çš„<code>last</code>å­—æ®µè¿”å›ï¼›</li><li><code>friends.#(first%&quot;D*&quot;).last</code>ï¼š<code>friends.#(first%&quot;D*&quot;)</code>è¿”å›æ•°ç»„<code>friends</code>ä¸­ç¬¬ä¸€ä¸ª<code>first</code>å­—æ®µæ»¡è¶³æ¨¡å¼<code>D*</code>çš„å…ƒç´ ï¼Œå–å‡ºå…¶<code>last</code>å­—æ®µè¿”å›ï¼›</li><li><code>friends.#(first!%&quot;D*&quot;).last</code>ï¼š&#96;&#96;friends.#(first!%â€D_â€)<code>è¿”å›æ•°ç»„</code>friends<code>ä¸­ç¬¬ä¸€ä¸ª</code>first<code>å­—æ®µ**ä¸**æ»¡è¶³æ¨¡å¼</code>D_<code>çš„å…ƒç´ ï¼Œè¯»å–å…¶</code>last&#96;å­—æ®µè¿”å›ï¼›</li><li><code>friends.#(nets.#(==&quot;fb&quot;))#.first</code>ï¼šè¿™æ˜¯ä¸ªåµŒå¥—æ¡ä»¶ï¼Œ<code>friends.#(nets.#(==&quot;fb&quot;))#</code>è¿”å›æ•°ç»„<code>friends</code>çš„å…ƒç´ çš„<code>nets</code>å­—æ®µä¸­æœ‰<code>fb</code>çš„æ‰€æœ‰å…ƒç´ ï¼Œç„¶åå–å‡º<code>first</code>å­—æ®µè¿”å›ã€‚</li></ul><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">Dale<br>[<span class="hljs-string">&quot;Dale&quot;</span>,<span class="hljs-string">&quot;Jane&quot;</span>]<br>[<span class="hljs-string">&quot;Craig&quot;</span>,<span class="hljs-string">&quot;Murphy&quot;</span>]<br>Murphy<br>Craig<br>[<span class="hljs-string">&quot;Dale&quot;</span>,<span class="hljs-string">&quot;Roger&quot;</span>]<br></code></pre></td></tr></table></figure><h3 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h3><p><strong>ä¿®é¥°ç¬¦</strong>æ˜¯<code>gjson</code>æä¾›çš„éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå’Œé”®è·¯å¾„æ­é…ä½¿ç”¨ã€‚<code>gjson</code>æä¾›äº†ä¸€äº›å†…ç½®çš„ä¿®é¥°ç¬¦ï¼š</p><ul><li><code>@reverse</code>ï¼šç¿»è½¬ä¸€ä¸ªæ•°ç»„ï¼›</li><li><code>@ugly</code>ï¼šç§»é™¤ JSON ä¸­çš„æ‰€æœ‰ç©ºç™½ç¬¦ï¼›</li><li><code>@pretty</code>ï¼šä½¿ JSON æ›´æ˜“ç”¨é˜…è¯»ï¼›</li><li><code>@this</code>ï¼šè¿”å›å½“å‰çš„å…ƒç´ ï¼Œå¯ä»¥ç”¨æ¥è¿”å›æ ¹å…ƒç´ ï¼›</li><li><code>@valid</code>ï¼šæ ¡éªŒ JSON çš„åˆæ³•æ€§ï¼›</li><li><code>@flatten</code>ï¼šæ•°ç»„å¹³å¦åŒ–ï¼Œå³å°†<code>[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;]]</code>è½¬ä¸º<code>[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</code>ï¼›</li><li><code>@join</code>ï¼šå°†å¤šä¸ªå¯¹è±¡åˆå¹¶åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚</li></ul><p>ä¿®é¥°ç¬¦çš„è¯­æ³•å’Œç®¡é“ç±»ä¼¼ï¼Œä»¥<code>|</code>åˆ†éš”é”®è·¯å¾„å’Œåˆ†éš”ç¬¦ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> json = <span class="hljs-string">`&#123;</span><br><span class="hljs-string">  &quot;name&quot;:&#123;&quot;first&quot;:&quot;Tom&quot;, &quot;last&quot;: &quot;Anderson&quot;&#125;,</span><br><span class="hljs-string">  &quot;age&quot;: 37,</span><br><span class="hljs-string">  &quot;children&quot;: [&quot;Sara&quot;, &quot;Alex&quot;, &quot;Jack&quot;],</span><br><span class="hljs-string">  &quot;fav.movie&quot;: &quot;Dear Hunter&quot;,</span><br><span class="hljs-string">  &quot;friends&quot;: [</span><br><span class="hljs-string">    &#123;&quot;first&quot;: &quot;Dale&quot;, &quot;last&quot;:&quot;Murphy&quot;, &quot;age&quot;: 44, &quot;nets&quot;: [&quot;ig&quot;, &quot;fb&quot;, &quot;tw&quot;]&#125;,</span><br><span class="hljs-string">    &#123;&quot;first&quot;: &quot;Roger&quot;, &quot;last&quot;: &quot;Craig&quot;, &quot;age&quot;: 68, &quot;nets&quot;: [&quot;fb&quot;, &quot;tw&quot;]&#125;,</span><br><span class="hljs-string">    &#123;&quot;first&quot;: &quot;Jane&quot;, &quot;last&quot;: &quot;Murphy&quot;, &quot;age&quot;: 47, &quot;nets&quot;: [&quot;ig&quot;, &quot;tw&quot;]&#125;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;`</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;children|@reverse&quot;</span>))<br>  fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;children|@reverse|0&quot;</span>))<br>  fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;friends|@ugly&quot;</span>))<br>  fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;friends|@pretty&quot;</span>))<br>  fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;@this&quot;</span>))<br><br>  nestedJSON := <span class="hljs-string">`&#123;&quot;nested&quot;: [&quot;one&quot;, &quot;two&quot;, [&quot;three&quot;, &quot;four&quot;]]&#125;`</span><br>  fmt.Println(gjson.Get(nestedJSON, <span class="hljs-string">&quot;nested|@flatten&quot;</span>))<br><br>  userJSON := <span class="hljs-string">`&#123;&quot;info&quot;:[&#123;&quot;name&quot;:&quot;dj&quot;, &quot;age&quot;:18&#125;,&#123;&quot;phone&quot;:&quot;123456789&quot;,&quot;email&quot;:&quot;dj@example.com&quot;&#125;]&#125;`</span><br>  fmt.Println(gjson.Get(userJSON, <span class="hljs-string">&quot;info|@join&quot;</span>))<br>&#125;<br></code></pre></td></tr></table></figure><p><code>children|@reverse</code>å…ˆè¯»å–æ•°ç»„<code>children</code>ï¼Œç„¶åä½¿ç”¨ä¿®é¥°ç¬¦<code>@reverse</code>ç¿»è½¬ä¹‹åè¿”å›ï¼Œè¾“å‡ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">[<span class="hljs-string">&quot;Jack&quot;</span>,<span class="hljs-string">&quot;Alex&quot;</span>,<span class="hljs-string">&quot;Sara&quot;</span>]<br></code></pre></td></tr></table></figure><p><code>children|@reverse|0</code>åœ¨ä¸Šé¢ç¿»è½¬çš„åŸºç¡€ä¸Šè¯»å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå³åŸæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè¾“å‡ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">Jack<br></code></pre></td></tr></table></figure><p><code>friends|@ugly</code>ç§»é™¤<code>friends</code>æ•°ç»„ä¸­çš„æ‰€æœ‰ç©ºç™½å­—ç¬¦ï¼Œè¿”å›ä¸€è¡Œé•¿é•¿çš„å­—ç¬¦ä¸²ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">[&#123;<span class="hljs-string">&quot;first&quot;</span>:<span class="hljs-string">&quot;Dale&quot;</span>,<span class="hljs-string">&quot;last&quot;</span>:<span class="hljs-string">&quot;Murphy&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">44</span>,<span class="hljs-string">&quot;nets&quot;</span>:[<span class="hljs-string">&quot;ig&quot;</span>,<span class="hljs-string">&quot;fb&quot;</span>,<span class="hljs-string">&quot;tw&quot;</span>]&#125;,&#123;<span class="hljs-string">&quot;first&quot;</span>:<span class="hljs-string">&quot;Roger&quot;</span>,<span class="hljs-string">&quot;last&quot;</span>:<span class="hljs-string">&quot;Craig&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">68</span>,<span class="hljs-string">&quot;nets&quot;</span>:[<span class="hljs-string">&quot;fb&quot;</span>,<span class="hljs-string">&quot;tw&quot;</span>]&#125;,&#123;<span class="hljs-string">&quot;first&quot;</span>:<span class="hljs-string">&quot;Jane&quot;</span>,<span class="hljs-string">&quot;last&quot;</span>:<span class="hljs-string">&quot;Murphy&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">47</span>,<span class="hljs-string">&quot;nets&quot;</span>:[<span class="hljs-string">&quot;ig&quot;</span>,<span class="hljs-string">&quot;tw&quot;</span>]&#125;]<br></code></pre></td></tr></table></figure><p><code>friends|@pretty</code>æ ¼å¼åŒ–<code>friends</code>æ•°ç»„ï¼Œä½¿ä¹‹æ›´æ˜“è¯»ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;first&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Dale&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;last&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Murphy&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">44</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;nets&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;ig&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;fb&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;tw&quot;</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;first&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Roger&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;last&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Craig&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">68</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;nets&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;fb&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;tw&quot;</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;first&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Jane&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;last&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Murphy&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">47</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;nets&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;ig&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;tw&quot;</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br><br></code></pre></td></tr></table></figure><p><code>@this</code>è¿”å›åŸå§‹çš„ JSON ä¸²ã€‚</p><p><code>@flatten</code>å°†æ•°ç»„<code>nested</code>çš„å†…å±‚æ•°ç»„å¹³å¦åˆ°å¤–å±‚åè¿”å›ï¼Œå³å°†æ‰€æœ‰å†…å±‚æ•°ç»„çš„å…ƒç´ ä¾æ¬¡æ·»åŠ åˆ°å¤–å±‚æ•°ç»„åé¢å¹¶ç§»é™¤å†…å±‚æ•°ç»„ï¼Œè¾“å‡ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">[<span class="hljs-string">&quot;one&quot;</span>,<span class="hljs-string">&quot;two&quot;</span>,<span class="hljs-string">&quot;three&quot;</span>, <span class="hljs-string">&quot;four&quot;</span>]<br></code></pre></td></tr></table></figure><p><code>@join</code>å°†ä¸€ä¸ªæ•°ç»„ä¸­çš„å„ä¸ªå¯¹è±¡åˆå¹¶åˆ°ä¸€ä¸ªä¸­ï¼Œä¾‹å­ä¸­å°†æ•°ç»„ä¸­å­˜æ”¾çš„éƒ¨åˆ†ä¸ªäººä¿¡æ¯åˆå¹¶æˆä¸€ä¸ªå¯¹è±¡è¿”å›ï¼š</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;dj&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">18</span>,<span class="hljs-string">&quot;phone&quot;</span>:<span class="hljs-string">&quot;123456789&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;dj@example.com&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¿®é¥°ç¬¦å‚æ•°"><a href="#ä¿®é¥°ç¬¦å‚æ•°" class="headerlink" title="ä¿®é¥°ç¬¦å‚æ•°"></a>ä¿®é¥°ç¬¦å‚æ•°</h3><p>ä¿®é¥°ç¬¦è¿˜å¯ä»¥æœ‰å‚æ•°ï¼Œé€šè¿‡åœ¨ä¿®é¥°ç¬¦ååŠ <code>:</code>åè·Ÿå‚æ•°ã€‚å¦‚æœæˆ‘ä»¬åœ¨æ ¼å¼åŒ– JSON ä¸²æ—¶ï¼Œæƒ³è¦å¯¹é”®è¿›è¡Œæ’åºï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>@pretty</code>ä¿®é¥°ç¬¦çš„<code>sortKeys</code>å‚æ•°ã€‚æˆ‘ä»¬è¿˜æ˜¯æ‹¿ä¸Šé¢çš„ JSON æ•°æ®ä¸¾ä¾‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span><br>fmt.Println(gjson.Get(json, <span class="hljs-string">`friends|@pretty:&#123;&quot;sortKeys&quot;:true&#125;`</span>))<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆæŒ‰é”®åé¡ºåºè¾“å‡º JSON ä¸²ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go">[<br>  &#123;<br>    <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">44</span>,<br>    <span class="hljs-string">&quot;first&quot;</span>: <span class="hljs-string">&quot;Dale&quot;</span>,<br>    <span class="hljs-string">&quot;last&quot;</span>: <span class="hljs-string">&quot;Murphy&quot;</span>,<br>    <span class="hljs-string">&quot;nets&quot;</span>: [<span class="hljs-string">&quot;ig&quot;</span>, <span class="hljs-string">&quot;fb&quot;</span>, <span class="hljs-string">&quot;tw&quot;</span>]<br>  &#125;, <br>  &#123;<br>    <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">68</span>,<br>    <span class="hljs-string">&quot;first&quot;</span>: <span class="hljs-string">&quot;Roger&quot;</span>,<br>    <span class="hljs-string">&quot;last&quot;</span>: <span class="hljs-string">&quot;Craig&quot;</span>,<br>    <span class="hljs-string">&quot;nets&quot;</span>: [<span class="hljs-string">&quot;fb&quot;</span>, <span class="hljs-string">&quot;tw&quot;</span>]<br>  &#125;, <br>  &#123;<br>    <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">47</span>,<br>    <span class="hljs-string">&quot;first&quot;</span>: <span class="hljs-string">&quot;Jane&quot;</span>,<br>    <span class="hljs-string">&quot;last&quot;</span>: <span class="hljs-string">&quot;Murphy&quot;</span>,<br>    <span class="hljs-string">&quot;nets&quot;</span>: [<span class="hljs-string">&quot;ig&quot;</span>, <span class="hljs-string">&quot;tw&quot;</span>]<br>  &#125;<br>]<br></code></pre></td></tr></table></figure><p>å½“ç„¶è¿˜å¯ä»¥æŒ‡å®šæ¯è¡Œç¼©è¿›<code>indent</code>ï¼ˆé»˜è®¤ä¸¤ä¸ªç©ºæ ¼ï¼‰ï¼Œæ¯è¡Œå¼€å¤´å­—ç¬¦ä¸²<code>prefix</code>ï¼ˆé»˜è®¤ä¸ºç©ºä¸²ï¼‰å’Œä¸€è¡Œæœ€å¤šæ˜¾ç¤ºå­—ç¬¦æ•°<code>width</code>ï¼ˆé»˜è®¤ 80 å­—ç¬¦ï¼‰ã€‚ä¸‹é¢åœ¨æ¯è¡Œå‰å¢åŠ ä¸¤ä¸ªç©ºæ ¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span><br><br>fmt.Println(gjson.Get(json, <span class="hljs-string">`friends|@pretty:&#123;&quot;sortKeys&quot;:true,&quot;prefix&quot;:&quot;  &quot;&#125;`</span>))<br></code></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰ä¿®é¥°ç¬¦"><a href="#è‡ªå®šä¹‰ä¿®é¥°ç¬¦" class="headerlink" title="è‡ªå®šä¹‰ä¿®é¥°ç¬¦"></a>è‡ªå®šä¹‰ä¿®é¥°ç¬¦</h3><p>å¦‚æ­¤å¼ºå¤§çš„åŠŸå½“ç„¶è¦æ”¯æŒè‡ªå®šä¹‰ï¼<code>gjson</code>ä½¿ç”¨<code>AddModifier()</code>æ·»åŠ ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œä¼ å…¥ä¸€ä¸ªåå­—å’Œç±»å‹ä¸º<code>func(json arg string) string</code>çš„å¤„ç†å‡½æ•°ã€‚å¤„ç†å‡½æ•°æ¥å—å¾…å¤„ç†çš„ JSON å€¼å’Œä¿®é¥°ç¬¦å‚æ•°ï¼Œè¿”å›å¤„ç†åçš„ç»“æœã€‚ä¸‹é¢ç¼–å†™ä¸€ä¸ªè½¬æ¢å¤§å°å†™çš„ä¿®é¥°ç¬¦ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  gjson.AddModifier(<span class="hljs-string">&quot;case&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(json, arg <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">string</span> &#123;<br>    <span class="hljs-keyword">if</span> arg == <span class="hljs-string">&quot;upper&quot;</span> &#123;<br>      <span class="hljs-keyword">return</span> strings.ToUpper(json)<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> arg == <span class="hljs-string">&quot;lower&quot;</span> &#123;<br>      <span class="hljs-keyword">return</span> strings.ToLower(json)<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> json<br>  &#125;)<br><br>  <span class="hljs-keyword">const</span> json = <span class="hljs-string">`&#123;&quot;children&quot;: [&quot;Sara&quot;, &quot;Alex&quot;, &quot;Jack&quot;]&#125;`</span><br>  fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;children|@case:upper&quot;</span>))<br>  fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;children|@case:lower&quot;</span>))<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">[<span class="hljs-string">&quot;SARA&quot;</span>, <span class="hljs-string">&quot;ALEX&quot;</span>, <span class="hljs-string">&quot;JACK&quot;</span>]<br>[<span class="hljs-string">&quot;sara&quot;</span>, <span class="hljs-string">&quot;alex&quot;</span>, <span class="hljs-string">&quot;jack&quot;</span>]<br></code></pre></td></tr></table></figure><h3 id="JSON-è¡Œ"><a href="#JSON-è¡Œ" class="headerlink" title="JSON è¡Œ"></a>JSON è¡Œ</h3><p><code>gjson</code>æä¾›<code>..</code>è¯­æ³•å¯ä»¥å°†å¤šè¡Œæ•°æ®çœ‹æˆä¸€ä¸ªæ•°ç»„ï¼Œæ¯è¡Œæ•°æ®æ˜¯ä¸€ä¸ªå…ƒç´ ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> json = <span class="hljs-string">`</span><br><span class="hljs-string">&#123;&quot;name&quot;: &quot;Gilbert&quot;, &quot;age&quot;: 61&#125;</span><br><span class="hljs-string">&#123;&quot;name&quot;: &quot;Alexa&quot;, &quot;age&quot;: 34&#125;</span><br><span class="hljs-string">&#123;&quot;name&quot;: &quot;May&quot;, &quot;age&quot;: 57&#125;</span><br><span class="hljs-string">&#123;&quot;name&quot;: &quot;Deloise&quot;, &quot;age&quot;: 44&#125;`</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;..#&quot;</span>))<br>  fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;..1&quot;</span>))<br>  fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;..#.name&quot;</span>))<br>  fmt.Println(gjson.Get(json, <span class="hljs-string">`..#(name=&quot;May&quot;).age`</span>))<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>..#</code>ï¼šè¿”å›æœ‰å¤šå°‘è¡Œ JSON æ•°æ®ï¼›</li><li><code>..1</code>ï¼šè¿”å›ç¬¬ä¸€è¡Œï¼Œå³<code>&#123;&quot;name&quot;: &quot;Gilbert&quot;, &quot;age&quot;: 61&#125;</code>ï¼›</li><li><code>..#.name</code>ï¼š<code>#</code>åå†æ¥è·¯å¾„ï¼Œè¡¨ç¤ºå¯¹æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ è¯»å–åé¢çš„è·¯å¾„ï¼Œå°†è¯»å–åˆ°çš„å€¼ç»„æˆä¸€ä¸ªæ–°æ•°ç»„è¿”å›ï¼›<code>..#.name</code>è¡¨ç¤ºè¯»å–æ¯ä¸€è¡Œä¸­çš„<code>name</code>å­—æ®µï¼Œæœ€ç»ˆè¿”å›<code>[&quot;Gilbert&quot;,&quot;Alexa&quot;,&quot;May&quot;,&quot;Deloise&quot;]</code>ï¼›</li><li><code>..#(name=&quot;May&quot;).age</code>ï¼šæ‹¬å·ä¸­çš„å†…å®¹<code>(name=&quot;May&quot;)</code>è¡¨ç¤ºæ¡ä»¶ï¼Œæ‰€ä»¥è¯¥æ¡å«ä¹‰ä¸ºå–<code>name</code>ä¸º<code>&quot;May&quot;</code>çš„è¡Œä¸­çš„<code>age</code>å­—æ®µã€‚</li></ul><p><code>gjson</code>è¿˜æä¾›äº†éå† JSON è¡Œçš„æ–¹æ³•ï¼š<code>gjson.ForEachLine()</code>ï¼Œå‚æ•°ä¸º JSON ä¸²å’Œç±»å‹ä¸º<code>func(line gjson.Result) bool</code>çš„å›è°ƒå‡½æ•°ã€‚å›è°ƒè¿”å›<code>false</code>æ—¶éå†åœæ­¢ã€‚ä¸‹é¢ä»£ç è¯»å–è¾“å‡ºæ¯ä¸€è¡Œçš„<code>name</code>å­—æ®µï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">gjson.ForEachLine(json, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(line gjson.Result)</span></span> <span class="hljs-type">bool</span> &#123;<br>  fmt.Println(<span class="hljs-string">&quot;name:&quot;</span>, gjson.Get(line.String(), <span class="hljs-string">&quot;name&quot;</span>))<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h3><p>ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†éå† JSON è¡Œçš„æ–¹å¼ï¼Œå®é™…ä¸Š<code>gjson</code>è¿˜æä¾›äº†é€šç”¨çš„éå†æ•°ç»„å’Œå¯¹è±¡çš„æ–¹å¼ã€‚<code>gjson.Get()</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>gjson.Result</code>ç±»å‹çš„å¯¹è±¡ï¼Œ<code>json.Result</code>æä¾›äº†<code>ForEach()</code>æ–¹æ³•ç”¨äºéå†ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªç±»å‹ä¸º<code>func (key, value gjson.Result) bool</code>çš„å›è°ƒå‡½æ•°ã€‚éå†å¯¹è±¡æ—¶<code>key</code>å’Œ<code>value</code>åˆ†åˆ«ä¸ºå¯¹è±¡çš„é”®å’Œå€¼ï¼›éå†æ•°ç»„æ—¶ï¼Œ<code>value</code>ä¸ºæ•°ç»„å…ƒç´ ï¼Œ<code>key</code>ä¸ºç©ºï¼ˆ<strong>ä¸æ˜¯ç´¢å¼•</strong>ï¼‰ã€‚å›è°ƒè¿”å›<code>false</code>æ—¶ï¼Œéå†åœæ­¢ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> json = <span class="hljs-string">`</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;name&quot;:&quot;dj&quot;,</span><br><span class="hljs-string">  &quot;age&quot;:18,</span><br><span class="hljs-string">  &quot;pets&quot;: [&quot;cat&quot;, &quot;dog&quot;],</span><br><span class="hljs-string">  &quot;contact&quot;: &#123;</span><br><span class="hljs-string">    &quot;phone&quot;: &quot;123456789&quot;,</span><br><span class="hljs-string">    &quot;email&quot;: &quot;dj@example.com&quot;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">&#125;`</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  pets := gjson.Get(json, <span class="hljs-string">&quot;pets&quot;</span>)<br>  pets.ForEach(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(_, pet gjson.Result)</span></span> <span class="hljs-type">bool</span> &#123;<br>    fmt.Println(pet)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125;)<br><br>  contact := gjson.Get(json, <span class="hljs-string">&quot;contact&quot;</span>)<br>  contact.ForEach(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(key, value gjson.Result)</span></span> <span class="hljs-type">bool</span> &#123;<br>    fmt.Println(key, value)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ ¡éªŒ-JSON"><a href="#æ ¡éªŒ-JSON" class="headerlink" title="æ ¡éªŒ JSON"></a>æ ¡éªŒ JSON</h3><p>è°ƒç”¨<code>gjson.Get()</code>æ—¶ï¼Œ<code>gjson</code>å‡è®¾æˆ‘ä»¬ä¼ å…¥çš„ JSON ä¸²æ˜¯åˆæ³•çš„ã€‚å¦‚æœ JSON éæ³•ä¹Ÿä¸ä¼š<code>panic</code>ï¼Œè¿™æ—¶ä¼šè¿”å›ä¸ç¡®å®šçš„ç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">const</span> json = <span class="hljs-string">`&#123;&quot;name&quot;:dj,age:18&#125;`</span><br>  fmt.Println(gjson.Get(json, <span class="hljs-string">&quot;name&quot;</span>))<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ JSON ä¸²æ˜¯éæ³•çš„ï¼Œ<code>dj</code>å’Œ<code>age</code>éƒ½æ²¡æœ‰åŠ ä¸ŠåŒå¼•å·ï¼ˆå®é™…ä¸Šä¹ æƒ¯äº† Go è¯­è¨€<code>map</code>çš„å†™æ³•ï¼Œå¾ˆå®¹æ˜“æŠŠ JSON å†™æˆè¿™æ ·ğŸ˜­ï¼‰ã€‚ä¸Šé¢ä»£ç è¾“å‡º<strong>18</strong>ï¼Œæ˜¾ç„¶æ˜¯é”™è¯¯çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>gjson.Valid()</code>æ£€æµ‹ JSON ä¸²æ˜¯å¦åˆæ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">if</span> !gjson.Valid(json) &#123;<br>  fmt.Println(<span class="hljs-string">&quot;error&quot;</span>)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  fmt.Println(<span class="hljs-string">&quot;ok&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¸€æ¬¡è·å–å¤šä¸ªå€¼"><a href="#ä¸€æ¬¡è·å–å¤šä¸ªå€¼" class="headerlink" title="ä¸€æ¬¡è·å–å¤šä¸ªå€¼"></a>ä¸€æ¬¡è·å–å¤šä¸ªå€¼</h3><p>è°ƒç”¨<code>gjson.Get()</code>ä¸€æ¬¡åªèƒ½è¯»å–ä¸€ä¸ªå€¼ï¼Œå¤šæ¬¡è°ƒç”¨åˆæ¯”è¾ƒéº»çƒ¦ï¼Œ<code>gjson</code>æä¾›äº†<code>GetMany()</code>å¯ä»¥ä¸€æ¬¡è¯»å–å¤šä¸ªå€¼ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„<code>[]gjson.Result</code>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> json = <span class="hljs-string">`</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;name&quot;:&quot;dj&quot;,</span><br><span class="hljs-string">  &quot;age&quot;:18,</span><br><span class="hljs-string">  &quot;pets&quot;: [&quot;cat&quot;, &quot;dog&quot;],</span><br><span class="hljs-string">  &quot;contact&quot;: &#123;</span><br><span class="hljs-string">    &quot;phone&quot;: &quot;123456789&quot;,</span><br><span class="hljs-string">    &quot;email&quot;: &quot;dj@example.com&quot;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">&#125;`</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  results := gjson.GetMany(json, <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>, <span class="hljs-string">&quot;pets.#&quot;</span>, <span class="hljs-string">&quot;contact.phone&quot;</span>)<br>  <span class="hljs-keyword">for</span> _, result := <span class="hljs-keyword">range</span> results &#123;<br>    fmt.Println(result)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Go-å¦‚ä½•ä½¿ç”¨Resty"><a href="#Go-å¦‚ä½•ä½¿ç”¨Resty" class="headerlink" title="Go - å¦‚ä½•ä½¿ç”¨Resty"></a>Go - å¦‚ä½•ä½¿ç”¨Resty</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><code>RESTful API</code>å·²æˆä¸ºç°ä»£<code>Web</code>å¼€å‘çš„åŸºçŸ³ï¼Œå®ç°äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ— ç¼é€šä¿¡ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢ä½¿ç”¨<code>Resty</code>è¿™ä¸ªæµè¡Œçš„<code>HTTP</code>å®¢æˆ·ç«¯åº“åœ¨<code>Go</code>ä¸­æ‰§è¡Œå¸¸è§æ“ä½œï¼Œå¦‚<code>GET</code>ã€<code>POST</code>ã€<code>UPDATE</code>å’Œ<code>DELETE</code>è¯·æ±‚çš„å¼ºå¤§å’Œç®€å•æ€§ã€‚æˆ‘ä»¬è¿˜å°†å­¦ä¹ å¦‚ä½•åœ¨è¯·æ±‚ä¸­ä¼ é€’å¤´éƒ¨ï¼Œä»¥ä¾¿è‡ªå®šä¹‰å’Œå¢å¼ºæˆ‘ä»¬çš„<code>API</code>äº¤äº’ã€‚</p><h3 id="å®‰è£…Resty"><a href="#å®‰è£…Resty" class="headerlink" title="å®‰è£…Resty"></a>å®‰è£…Resty</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>Go</code>ç¯å¢ƒä¸­å®‰è£…<code>Resty</code>ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…<code>Resty</code>åŒ…ï¼š</p><p>Bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">go get -u github.com/go-resty/resty/v2<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h3 id="å‘èµ·GETè¯·æ±‚"><a href="#å‘èµ·GETè¯·æ±‚" class="headerlink" title="å‘èµ·GETè¯·æ±‚"></a>å‘èµ·GETè¯·æ±‚</h3><p>ä»¥ä¸‹ä»£ç ç‰‡æ®µæ¼”ç¤ºäº†ä¸€ä¸ªç®€å•çš„<code>GET</code>è¯·æ±‚ï¼Œå¹¶å°†å“åº”ç»‘å®šåˆ°ä¸€ä¸ªç»“æ„ä½“ä¸­ï¼š</p><p>Go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br><br>    <span class="hljs-string">&quot;github.com/go-resty/resty/v2&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> DevUser <span class="hljs-keyword">struct</span> &#123;<br>    ID    <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;id&quot;`</span><br>    Name  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name&quot;`</span><br>    Email <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;email&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> users []DevUser<br><br>    response, err := resty.New().R().SetResult(&amp;users).Get(<span class="hljs-string">&quot;https://api.example.com/users&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    fmt.Println(<span class="hljs-string">&quot;GETå“åº”:&quot;</span>, response.Status())<br>    fmt.Printf(<span class="hljs-string">&quot;æ£€ç´¢åˆ°%dä¸ªç”¨æˆ·:\n&quot;</span>, <span class="hljs-built_in">len</span>(users))<br>    <span class="hljs-keyword">for</span> _, user := <span class="hljs-keyword">range</span> users &#123;<br>        fmt.Printf(<span class="hljs-string">&quot;ç”¨æˆ·IDï¼š%dï¼Œå§“åï¼š%sï¼Œç”µå­é‚®ä»¶ï¼š%s\n&quot;</span>, user.ID, user.Name, user.Email)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å‘èµ·POSTè¯·æ±‚"><a href="#å‘èµ·POSTè¯·æ±‚" class="headerlink" title="å‘èµ·POSTè¯·æ±‚"></a>å‘èµ·POSTè¯·æ±‚</h3><p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•å‘é€å¸¦æœ‰<code>JSON</code>è´Ÿè½½çš„<code>POST</code>è¯·æ±‚ï¼Œå¹¶å°†å“åº”ç»‘å®šåˆ°ç»“æ„ä½“ä¸­ï¼š</p><p>Go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br><br>    <span class="hljs-string">&quot;github.com/go-resty/resty/v2&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> DevUser <span class="hljs-keyword">struct</span> &#123;<br>    ID    <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;id&quot;`</span><br>    Name  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name&quot;`</span><br>    Email <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;email&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> createdUser DevUser<br><br>    payload := DevUser&#123;<br>        Name:  <span class="hljs-string">&quot;John Doe&quot;</span>,<br>        Email: <span class="hljs-string">&quot;johndoe@example.com&quot;</span>,<br>    &#125;<br><br>    response, err := resty.New().R().<br>        SetHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>).<br>        SetBody(&amp;payload).<br>        SetResult(&amp;createdUser).<br>        Post(<span class="hljs-string">&quot;https://api.example.com/users&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    fmt.Println(<span class="hljs-string">&quot;POSTå“åº”ï¼š&quot;</span>, response.Status())<br>    fmt.Printf(<span class="hljs-string">&quot;åˆ›å»ºçš„ç”¨æˆ·ï¼šIDï¼š%dï¼Œå§“åï¼š%sï¼Œç”µå­é‚®ä»¶ï¼š%s\n&quot;</span>, createdUser.ID, createdUser.Name, createdUser.Email)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å‘èµ·UPDATEï¼ˆPUTï¼‰è¯·æ±‚"><a href="#å‘èµ·UPDATEï¼ˆPUTï¼‰è¯·æ±‚" class="headerlink" title="å‘èµ·UPDATEï¼ˆPUTï¼‰è¯·æ±‚"></a>å‘èµ·UPDATEï¼ˆPUTï¼‰è¯·æ±‚</h3><p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•å‘é€å¸¦æœ‰<code>JSON</code>è´Ÿè½½çš„<code>PUT</code>è¯·æ±‚ï¼Œå¹¶å°†å“åº”ç»‘å®šåˆ°ç»“æ„ä½“ä¸­ï¼š</p><p>Go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br><br>    <span class="hljs-string">&quot;github.com/go-resty/resty/v2&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> DevUser <span class="hljs-keyword">struct</span> &#123;<br>    ID    <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;id&quot;`</span><br>    Name  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name&quot;`</span><br>    Email <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;email&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> updatedUser DevUser<br><br>    payload := DevUser&#123;<br>        Name:  <span class="hljs-string">&quot;Updated Name&quot;</span>,<br>        Email: <span class="hljs-string">&quot;updated@example.com&quot;</span>,<br>    &#125;<br><br>    response, err := resty.New().R().<br>        SetHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>).<br>        SetBody(&amp;payload).<br>        SetResult(&amp;updatedUser).<br>        Put(<span class="hljs-string">&quot;https://api.example.com/users/123&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    fmt.Println(<span class="hljs-string">&quot;PUTå“åº”ï¼š&quot;</span>, response.Status())<br>    fmt.Printf(<span class="hljs-string">&quot;æ›´æ–°çš„ç”¨æˆ·ï¼šIDï¼š%dï¼Œå§“åï¼š%sï¼Œç”µå­é‚®ä»¶ï¼š%s\n&quot;</span>, updatedUser.ID, updatedUser.Name, updatedUser.Email)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å‘èµ·DELETEè¯·æ±‚"><a href="#å‘èµ·DELETEè¯·æ±‚" class="headerlink" title="å‘èµ·DELETEè¯·æ±‚"></a>å‘èµ·DELETEè¯·æ±‚</h3><p>Go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br><br>    <span class="hljs-string">&quot;github.com/go-resty/resty/v2&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> DevUser <span class="hljs-keyword">struct</span> &#123;<br>    ID    <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;id&quot;`</span><br>    Name  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name&quot;`</span><br>    Email <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;email&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    response, err := resty.New().R().Delete(<span class="hljs-string">&quot;https://api.example.com/users/123&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    fmt.Println(<span class="hljs-string">&quot;DELETEå“åº”ï¼š&quot;</span>, response.Status())<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¼ é€’å¤´éƒ¨"><a href="#ä¼ é€’å¤´éƒ¨" class="headerlink" title="ä¼ é€’å¤´éƒ¨"></a>ä¼ é€’å¤´éƒ¨</h3><p><code>Resty v2</code>å…è®¸æˆ‘ä»¬åœ¨è¯·æ±‚ä¸­åŒ…å«è‡ªå®šä¹‰å¤´éƒ¨ã€‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>Resty v2</code>ä¼ é€’å¤´éƒ¨ï¼š</p><p>Go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br><br>    <span class="hljs-string">&quot;github.com/go-resty/resty/v2&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> DevUser <span class="hljs-keyword">struct</span> &#123;<br>    ID    <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;id&quot;`</span><br>    Name  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name&quot;`</span><br>    Email <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;email&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    client := resty.New()<br>    client.SetHeader(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">&quot;Bearer YOUR_TOKEN&quot;</span>)<br><br>    response, err := client.R().Get(<span class="hljs-string">&quot;https://api.example.com/protected-resource&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    fmt.Println(<span class="hljs-string">&quot;å¸¦æœ‰å¤´éƒ¨çš„GETå“åº”ï¼š&quot;</span>, response.Status())<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åœ¨è¿™ä¸ªå…¨é¢çš„æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬æ¢ç´¢äº†å¦‚ä½•åˆ©ç”¨<code>Resty v2</code>è¿™ä¸ªæ˜“äºä½¿ç”¨çš„<code>HTTP</code>å®¢æˆ·ç«¯åº“ï¼Œåœ¨<code>Go</code>ä¸­æ‰§è¡Œ<code>GET</code>ã€<code>POST</code>ã€<code>UPDATE</code>å’Œ<code>DELETE</code>è¯·æ±‚ã€‚æˆ‘ä»¬è¿˜å­¦ä¹ äº†å¦‚ä½•ä¼ é€’å¤´éƒ¨ä»¥å¢å¼ºæˆ‘ä»¬çš„<code>API</code>äº¤äº’ï¼Œæä¾›æ›´é«˜çš„å®šåˆ¶æ€§å’Œå®‰å…¨æ€§ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜äº†è§£äº†å¦‚ä½•å°†<code>API</code>å“åº”ç»‘å®šåˆ°<code>Go</code>ç»“æ„ä½“ä¸­ï¼Œä»¥ä¾¿è½»æ¾å¤„ç†å’Œæ“ä½œæ•°æ®ã€‚<code>Resty v2</code>ç®€åŒ–äº†<code>RESTful API</code>çš„ä½¿ç”¨ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸“æ³¨äºæ„å»ºå¼ºå¤§å’Œé«˜æ•ˆçš„åº”ç”¨ç¨‹åºã€‚</p><h2 id="sjson"><a href="#sjson" class="headerlink" title="sjson"></a>sjson</h2><h3 id="å¿«é€Ÿä½¿ç”¨-1"><a href="#å¿«é€Ÿä½¿ç”¨-1" class="headerlink" title="å¿«é€Ÿä½¿ç”¨"></a>å¿«é€Ÿä½¿ç”¨</h3><p>å…ˆå®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">go get github.com/tidwall/sjson<br></code></pre></td></tr></table></figure><p>åä½¿ç”¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>  <span class="hljs-string">&quot;fmt&quot;</span><br><br>  <span class="hljs-string">&quot;github.com/tidwall/sjson&quot;</span><br>)<br><br><span class="hljs-keyword">const</span> json = <span class="hljs-string">`&#123;&quot;name&quot;:&#123;&quot;first&quot;:&quot;li&quot;,&quot;last&quot;:&quot;dj&quot;&#125;,&quot;age&quot;:18&#125;`</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  value, _ := sjson.Set(json, <span class="hljs-string">&quot;name.last&quot;</span>, <span class="hljs-string">&quot;dajun&quot;</span>)<br>  fmt.Println(value)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç é€šè¿‡<code>sjson.Set()</code>å°† JSON ä¸²ä¸­<code>name.last</code>å¯¹åº”çš„å€¼è®¾ç½®ä¸º<code>dajun</code>ã€‚ä¸<code>gjson</code>ä¸€æ ·ï¼Œ<code>sjson</code>ä¹Ÿé€šè¿‡<strong>é”®è·¯å¾„</strong>æŒ‡å®šå…·ä½“çš„ä½ç½®ï¼Œé”®è·¯å¾„å³ä¸ºä¸€ç³»åˆ—ä»¥<code>.</code>åˆ†éš”çš„é”®ã€‚<code>sjson</code>æ”¯æŒçš„é”®è·¯å¾„è¯­æ³•æ˜¯<code>gjson</code>çš„ä¸€ä¸ªå­é›†ï¼Œsjson.Set()&#96;è¿”å›è®¾ç½®ä¹‹åçš„ JSON ä¸²ã€‚æœ€ç»ˆç¨‹åºè¾“å‡ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">`<span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;first&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;li&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;last&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;dajun&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">18</span><span class="hljs-punctuation">&#125;</span> `<br></code></pre></td></tr></table></figure><h3 id="æ”¯æŒçš„ç±»å‹"><a href="#æ”¯æŒçš„ç±»å‹" class="headerlink" title="æ”¯æŒçš„ç±»å‹"></a>æ”¯æŒçš„ç±»å‹</h3><p><code>sjson</code>æ”¯æŒçš„ç±»å‹åŒ…æ‹¬<code>nil/bool/int/float/string</code>ç­‰ã€‚å¦‚æœä¼ å…¥<code>sjson</code>ä¸æ”¯æŒçš„ç±»å‹ï¼Œ<code>sjson</code>ä¼šè°ƒç”¨<code>json.Marshal</code>ï¼Œç„¶åå°†ç”Ÿæˆçš„å­—ç¬¦ä¸²è®¾ç½®åˆ°å¯¹åº”çš„é”®è·¯å¾„ä¸Šï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>  Name <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name&quot;`</span><br>  Age  <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;age&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  nilJSON, _ := sjson.Set(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-literal">nil</span>)<br>  fmt.Println(nilJSON)<br><br>  boolJSON, _ := sjson.Set(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-literal">false</span>)<br>  fmt.Println(boolJSON)<br><br>  intJSON, _ := sjson.Set(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-number">1</span>)<br>  fmt.Println(intJSON)<br><br>  floatJSON, _ := sjson.Set(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-number">10.5</span>)<br>  fmt.Println(floatJSON)<br><br>  strJSON, _ := sjson.Set(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;hello&quot;</span>)<br>  fmt.Println(strJSON)<br><br>  mapJSON, _ := sjson.Set(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;hello&quot;</span>: <span class="hljs-string">&quot;world&quot;</span>&#125;)<br>  fmt.Println(mapJSON)<br><br>  u := User&#123;Name: <span class="hljs-string">&quot;dj&quot;</span>, Age: <span class="hljs-number">18</span>&#125;<br>  structJSON, _ := sjson.Set(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;key&quot;</span>, u)<br>  fmt.Println(structJSON)<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œ<code>sjson.Set()</code>ä¼šç”Ÿæˆä¸€ä¸ªç©ºå¯¹è±¡ï¼Œç„¶åæŒ‰ç…§é”®è·¯å¾„ä¾æ¬¡è®¾ç½®å€¼ã€‚ä¸‹é¢åˆ†æä¸Šè¿°ç¨‹åºè¾“å‡ºï¼š</p><ul><li><code>nil</code>ï¼šåœ¨ JSON ä¸­ç”¨<code>null</code>è¡¨ç¤ºï¼Œè¾“å‡º<code>&#123;&quot;key&quot;:null&#125;</code>ï¼›</li><li><code>false</code>ï¼šåœ¨ JSON ä¸­å¸ƒå°”å€¼ç”¨<code>true/false</code>è¡¨ç¤ºï¼Œè¾“å‡º<code>&#123;&quot;key&quot;:false&#125;</code>ï¼›</li><li><code>1</code>å’Œ<code>10.5</code>ï¼šæ•´æ•°å’Œæµ®ç‚¹æ•°åœ¨ JSON ä¸­éƒ½ç”¨<code>number</code>è¡¨ç¤ºï¼Œåˆ†åˆ«è¾“å‡º<code>&#123;&quot;key&quot;:1&#125;</code>å’Œ<code>&#123;&quot;key&quot;:10.5&#125;</code>ï¼›</li><li><code>hello</code>ï¼šè¾“å‡º<code>&#123;&quot;key&quot;:&quot;hello&quot;&#125;</code>ï¼›</li><li><code>map[string]interface&#123;&#125;</code>ï¼š<code>sjson</code>å¹¶ä¸åŸç”Ÿæ”¯æŒ<code>map</code>ç±»å‹ï¼Œæ•…é€šè¿‡<code>json.Marshal</code>å°†å…¶åºåˆ—åŒ–ä¸º<code>&#123;&quot;hello&quot;:&quot;world&quot;&#125;</code>å†è®¾ç½®åˆ°é”®<code>key</code>ä¸Šï¼Œè¾“å‡º<code>&#123;&quot;key&quot;:&#123;&quot;hello&quot;:&quot;world&quot;&#125;&#125;</code>ï¼›</li><li><code>User</code>å¯¹è±¡ï¼šå…ˆé€šè¿‡<code>json.Marshal</code>åºåˆ—åŒ–ä¸º<code>&#123;&quot;name&quot;:&quot;dj&quot;,&quot;age&quot;:18&#125;</code>å†è®¾ç½®ï¼›</li></ul><h3 id="ä¿®æ”¹æ•°ç»„"><a href="#ä¿®æ”¹æ•°ç»„" class="headerlink" title="ä¿®æ”¹æ•°ç»„"></a>ä¿®æ”¹æ•°ç»„</h3><p>ä¿®æ”¹æ•°ç»„å¯ä»¥é€šè¿‡åœ¨é”®è·¯å¾„åæ·»åŠ ç´¢å¼•ï¼Œæœ‰ä¸¤ç§ç‰¹æ®Šæƒ…å†µï¼š</p><ul><li>ä½¿ç”¨<code>-1</code>æˆ–æ•°ç»„é•¿åº¦ä¸ºç´¢å¼•è¡¨ç¤ºåœ¨æ•°ç»„åæ·»åŠ ä¸€ä¸ªæ–°å…ƒç´ ï¼›</li><li>ä½¿ç”¨çš„ç´¢å¼•è¶…å‡ºæ•°ç»„çš„é•¿åº¦ï¼Œä¼šåœ¨æ•°ç»„ä¸­æ·»åŠ å¾ˆå¤š<code>null</code>å€¼ã€‚</li></ul><p>çœ‹ä¸‹é¢ç¤ºä¾‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  fruits := <span class="hljs-string">`&#123;&quot;fruits&quot;:[&quot;apple&quot;, &quot;orange&quot;, &quot;banana&quot;]&#125;`</span><br><br>  <span class="hljs-keyword">var</span> newValue <span class="hljs-type">string</span><br>  newValue, _ = sjson.Set(fruits, <span class="hljs-string">&quot;fruits.1&quot;</span>, <span class="hljs-string">&quot;grape&quot;</span>)<br>  fmt.Println(newValue)<br><br>  newValue, _ = sjson.Set(fruits, <span class="hljs-string">&quot;fruits.3&quot;</span>, <span class="hljs-string">&quot;pear&quot;</span>)<br>  fmt.Println(newValue)<br><br>  newValue, _ = sjson.Set(fruits, <span class="hljs-string">&quot;fruits.-1&quot;</span>, <span class="hljs-string">&quot;strawberry&quot;</span>)<br>  fmt.Println(newValue)<br><br>  newValue, _ = sjson.Set(fruits, <span class="hljs-string">&quot;fruits.5&quot;</span>, <span class="hljs-string">&quot;watermelon&quot;</span>)<br>  fmt.Println(newValue)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>fruits.1</code>ï¼šè®¾ç½®ç¬¬äºŒä¸ªæ°´æœä¸º<code>grape</code>ï¼ˆ<strong>ç´¢å¼•ä» 0 å¼€å§‹</strong>ï¼‰ï¼Œè¾“å‡º<code>&#123;&quot;fruits&quot;:[&quot;apple&quot;, &quot;grape&quot;, &quot;banana&quot;]&#125;</code>ï¼›</li><li><code>fruits.3</code>ï¼šç”±äºæ•°ç»„é•¿åº¦ä¸º 3ï¼Œä½¿ç”¨ 3 è¡¨ç¤ºåœ¨æ•°ç»„åæ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œè¾“å‡º<code>&#123;&quot;fruits&quot;:[&quot;apple&quot;,&quot;orange&quot;,&quot;banana&quot;,&quot;pear&quot;]&#125;</code>ï¼›</li><li><code>fruits.-1</code>ï¼šä½¿ç”¨<code>-1</code>åŒæ ·è¡¨ç¤ºåœ¨æ•°ç»„åæ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œè¾“å‡º<code>&#123;&quot;fruits&quot;:[&quot;apple&quot;, &quot;orange&quot;, &quot;banana&quot;,&quot;strawberry&quot;]&#125;</code>;</li><li><code>fruits.5</code>ï¼šç´¢å¼• 5 å·²ç»å¤§äºæ•°ç»„é•¿åº¦ 3 äº†ï¼Œæ‰€ä»¥ä¼šå¤šå‡ºä¸¤ä¸ª<code>null</code>ï¼Œè¾“å‡º<code>&#123;&quot;fruits&quot;:[&quot;apple&quot;,&quot;orange&quot;,&quot;banana&quot;,null,null,&quot;watermelon&quot;]&#125;</code>ã€‚</li></ul><h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><p>åˆ é™¤æ•°ç»„å…ƒç´ éœ€è¦è°ƒç”¨<code>sjson.Delete()</code>æ–¹æ³•ï¼Œé”®è·¯å¾„è¯­æ³•ç›¸åŒã€‚å¦‚æœé”®è·¯å¾„å¯¹åº”çš„å€¼ä¸å­˜åœ¨ï¼Œåˆ™<code>Delete()</code>æ— æ•ˆæœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">var</span> newValue <span class="hljs-type">string</span><br>  user := <span class="hljs-string">`&#123;&quot;name&quot;:&#123;&quot;first&quot;:&quot;li&quot;,&quot;last&quot;:&quot;dj&quot;&#125;,&quot;age&quot;:18&#125;`</span><br><br>  newValue, _ = sjson.Delete(user, <span class="hljs-string">&quot;name.first&quot;</span>)<br>  fmt.Println(newValue)<br><br>  newValue, _ = sjson.Delete(user, <span class="hljs-string">&quot;name.full&quot;</span>)<br>  fmt.Println(newValue)<br><br>  fruits := <span class="hljs-string">`&#123;&quot;fruits&quot;:[&quot;apple&quot;, &quot;orange&quot;, &quot;banana&quot;]&#125;`</span><br><br>  newValue, _ = sjson.Delete(fruits, <span class="hljs-string">&quot;fruits.1&quot;</span>)<br>  fmt.Println(newValue)<br><br>  newValue, _ = sjson.Delete(fruits, <span class="hljs-string">&quot;fruits.-1&quot;</span>)<br>  fmt.Println(newValue)<br><br>  newValue, _ = sjson.Delete(fruits, <span class="hljs-string">&quot;fruits.5&quot;</span>)<br>  fmt.Println(newValue)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>name.first</code>ï¼šåˆ é™¤å­—æ®µ<code>name.first</code>ï¼Œè¾“å‡º<code>&#123;&quot;name&quot;:&#123;&quot;last&quot;:&quot;dj&quot;&#125;,&quot;age&quot;:18&#125;</code>ï¼›</li><li><code>name.full</code>ï¼šç”±äºå­—æ®µ<code>name.full</code>ä¸å­˜åœ¨ï¼Œæ— æ•ˆæœï¼Œè¾“å‡º<code>&#123;&quot;name&quot;:&#123;&quot;first&quot;:&quot;li&quot;,&quot;last&quot;:&quot;dj&quot;&#125;,&quot;age&quot;:18&#125;</code>ï¼›</li><li><code>fruits.1</code>ï¼šåˆ é™¤æ•°ç»„<code>fruits</code>çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œè¾“å‡º<code>&#123;&quot;fruits&quot;:[&quot;apple&quot;, &quot;banana&quot;]&#125;</code>ï¼›</li><li><code>fruits.-1</code>ï¼šåˆ é™¤æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè¾“å‡º<code>&#123;&quot;fruits&quot;:[&quot;apple&quot;, &quot;orange&quot;]&#125;</code>ï¼›</li><li><code>fruits.5</code>ï¼šç´¢å¼• 5 è¶…å‡ºæ•°ç»„é•¿åº¦ 3ï¼Œæ— æ•ˆæœï¼Œè¾“å‡º<code>&#123;&quot;fruits&quot;:[&quot;apple&quot;, &quot;orange&quot;, &quot;banana&quot;]&#125;</code>ã€‚</li></ul><h3 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h3><p>ä½¿ç”¨<code>sjson</code>å‡ºç°çš„é”™è¯¯åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¼ å…¥çš„ JSON ä¸²ä¸æ˜¯åˆæ³•çš„ä¸²ï¼Œå¦ä¸€ç§æ˜¯é”®è·¯å¾„è¯­æ³•é”™è¯¯ã€‚<code>Set()</code>å’Œ<code>Delete()</code>æ–¹æ³•è¿”å›çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºé”™è¯¯ï¼Œåªæœ‰éæ³•çš„é”®è·¯å¾„ä¼šè¿”å›é”™è¯¯ï¼Œéæ³• JSON ä¸²ä¸ä¼šã€‚</p><h3 id="éæ³•-JSON-ä¸²"><a href="#éæ³•-JSON-ä¸²" class="headerlink" title="éæ³• JSON ä¸²"></a>éæ³• JSON ä¸²</h3><p>åŒ<code>gjson</code>ä¸€æ ·ï¼Œ<code>sjson</code>åŒæ ·ä¸ä¼šæ£€æŸ¥ä¼ å…¥çš„ JSON ä¸²çš„åˆæ³•æ€§ï¼Œå®ƒå‡è®¾ä¼ å…¥çš„æ˜¯åˆæ³•çš„ä¸²ã€‚å¦‚æœä¼ å…¥ä¸€ä¸ªéæ³•çš„ JSON ä¸²ï¼Œç¨‹åºè¾“å‡ºä¸ç¡®å®šçš„ç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  user := <span class="hljs-string">`&#123;&quot;name&quot;:dj,age:18&#125;`</span><br>  newValue, err := sjson.Set(user, <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;dajun&quot;</span>)<br>  fmt.Println(err, newValue)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç¨‹åºä¸­ï¼Œæˆ‘æ•…æ„ä¼ å…¥ä¸€ä¸ªéæ³•çš„ JSON ä¸²ï¼ˆ<code>dj</code>å’Œ<code>age</code>æ¼æ‰äº†åŒå¼•å·ï¼‰ã€‚æœ€ç»ˆç¨‹åºè¾“å‡ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">&lt;<span class="hljs-literal">nil</span>&gt; &#123;<span class="hljs-string">&quot;name&quot;</span>:dj,age:<span class="hljs-string">&quot;dajun&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>å°†<code>age</code>å˜ä¸ºäº†<code>dajun</code>ï¼Œæ˜¾ç„¶ä¸æ­£ç¡®ã€‚ç„¶è€Œæ­¤æ—¶è¿”å›çš„<code>err = nil</code>ã€‚</p><h3 id="éæ³•é”®è·¯å¾„"><a href="#éæ³•é”®è·¯å¾„" class="headerlink" title="éæ³•é”®è·¯å¾„"></a>éæ³•é”®è·¯å¾„</h3><p>ä¸<code>gjson</code>ç›¸æ¯”ï¼Œ<code>sjson</code>èƒ½ä½¿ç”¨çš„é”®è·¯å¾„è¯­æ³•æ¯”è¾ƒæœ‰é™ï¼Œä¸èƒ½ä½¿ç”¨é€šé…ç¬¦å’Œä¸€äº›æ¡ä»¶è¯­æ³•ã€‚å¦‚æœä¼ å…¥çš„é”®è·¯å¾„éæ³•ï¼Œå°†è¿”å›éç©ºçš„é”™è¯¯å€¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  user := <span class="hljs-string">`&#123;&quot;name&quot;:&quot;dj&quot;,&quot;age&quot;:18&#125;`</span><br>  newValue, err := sjson.Set(user, <span class="hljs-string">&quot;na?e&quot;</span>, <span class="hljs-string">&quot;dajun&quot;</span>)<br>  fmt.Println(err, newValue)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šæ¬¡ä½¿ç”¨é€šé…ç¬¦<code>?</code>ï¼Œè¾“å‡ºï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text"><br>wildcard characters not allowed in path <br><br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>sjson</code>æ¯”è¾ƒç®€å•æ˜“ç”¨ï¼Œæ€§èƒ½ä¸ä¿—ã€‚æˆ‘ä»¬åœ¨ç¡®å®š JSON ä¸²åˆæ³•çš„æƒ…å†µä¸‹ï¼Œå¯ä½¿ç”¨å®ƒå¿«é€Ÿè®¾ç½®å€¼ã€‚</p><h2 id="Pie"><a href="#Pie" class="headerlink" title="Pie"></a>Pie</h2><p>åœ¨Goè¯­è¨€ä¸­ï¼Œå¯¹sliceå’Œmapæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ã€‚æ¯”å¦‚ï¼Œè®¡ç®—ä¸¤ä¸ªåˆ‡ç‰‡çš„äº¤é›†ã€å·®é›†ï¼›åˆ¤æ–­åˆ‡ç‰‡ä¸­çš„å…ƒç´ æ˜¯å¦éƒ½æ»¡è¶³æŸä¸ªæ¡ä»¶çš„ç­‰ã€‚æˆ‘æ¨èå¤§å®¶ä½¿ç”¨è¿™ä¸ªåŒ…ï¼š<code>[elliotchance/pie](https://github.com/elliotchance/pie)</code>ã€‚</p><p>è¯¥åŒ…å°è£…äº†<strong>å¯¹åˆ‡ç‰‡å’Œmapçš„å¸¸ç”¨æ“ä½œ,èƒ½æ»¡è¶³å·¥ä½œä¸­çš„å¤§éƒ¨åˆ†éœ€æ±‚</strong>ã€‚æ¯”å¦‚è®¡ç®—åˆ‡ç‰‡çš„äº¤é›†ã€å·®é›†ï¼›å¯¹åˆ‡ç‰‡ä¸­å…ƒç´ æŒ‰æ¡ä»¶è¿‡æ»¤çš„Filterå‡½æ•°ï¼›å¯¹åˆ‡ç‰‡ä¸­å…ƒç´ è¿›è¡Œæ•°æ®è½¬æ¢çš„Eachã€Mapå‡½æ•°ç­‰ã€‚</p><p>åŒæ—¶å…·æœ‰<strong>é«˜æ€§èƒ½</strong>ã€<strong>ç±»å‹å®‰å…¨</strong>çš„ç‰¹ç‚¹ã€‚å®ç°ä¸­å¯¹å„å‡½æ•°çš„å‚æ•°éƒ½åšäº†ç±»å‹çš„é™åˆ¶ã€‚æ¯”å¦‚Averageå‡½æ•°å°±åªèƒ½å¯¹æ•´å‹å’Œæµ®ç‚¹å‹å‚æ•°æœ‰æ•ˆã€‚</p><h3 id="ä½¿ç”¨pieåŒ…çš„è¦æ±‚ï¼š"><a href="#ä½¿ç”¨pieåŒ…çš„è¦æ±‚ï¼š" class="headerlink" title="ä½¿ç”¨pieåŒ…çš„è¦æ±‚ï¼š"></a>ä½¿ç”¨pieåŒ…çš„è¦æ±‚ï¼š</h3><p>pie v2ç‰ˆæœ¬éœ€è¦Go 1.18+ã€‚Go1.17åŠä»¥ä¸‹ç‰ˆæœ¬éœ€è¦ä½¿ç”¨v1ç‰ˆæœ¬ã€‚</p><h3 id="pieåŒ…çš„ç›®æ ‡ï¼š"><a href="#pieåŒ…çš„ç›®æ ‡ï¼š" class="headerlink" title="pieåŒ…çš„ç›®æ ‡ï¼š"></a>pieåŒ…çš„ç›®æ ‡ï¼š</h3><ul><li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæ— è®ºæ˜¯åœ¨v1ç‰ˆæœ¬è¿˜æ˜¯v2ç‰ˆæœ¬çš„æ³›å‹ä¸­ï¼Œéƒ½å¯¹ç±»å‹åšäº†é™åˆ¶ï¼Œæ‰€ä»¥ä¸ä¼šé‡åˆ°è¿è¡Œæ—¶ç±»å‹é”™è¯¯ã€‚</li><li><strong>é«˜æ€§èƒ½</strong>ï¼šè¯¥åº“éœ€è¦è·ŸåŸç”Ÿçš„Goå®ç°ä¸€æ ·å¿«ï¼Œå¦åˆ™è¯¥åº“å°è£…å°±æ²¡æœ‰æ„ä¹‰ã€‚</li><li><strong>Nilå®‰å…¨</strong>ï¼šè¯¥åº“çš„æ‰€æœ‰å‡½æ•°éƒ½èƒ½æ¥æ”¶nilå‚æ•°ï¼Œå¹¶å°†å…¶è§†ä¸ºç©ºåˆ‡ç‰‡ï¼Œè€Œä¸ä¼šå¼•èµ·panicã€‚</li><li><strong>å¯¹åŸåˆ‡ç‰‡æ— å‰¯ä½œç”¨</strong>ï¼šæ‰€æœ‰çš„å‡½æ•°å¯¹ä¼ å…¥çš„åˆ‡ç‰‡å‚æ•°éƒ½ä¸ä¼šåšä¿®æ”¹ã€‚</li></ul><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><p>go ç‰ˆæœ¬åœ¨1.18åŠä»¥ä¸Šï¼Œä¼šä½¿ç”¨pie&#x2F;v2åŒ…ï¼Œè¯¥åŒ…ä½¿ç”¨çš„æ˜¯æ³›å‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span>å¤åˆ¶ä»£ç <span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;strings&quot;</span><br><br>    <span class="hljs-string">&quot;github.com/elliotchance/pie/v2&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><br>    name := pie.Of([]<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;Sally&quot;</span>, <span class="hljs-string">&quot;John&quot;</span>, <span class="hljs-string">&quot;Jane&quot;</span>&#125;).<br>    FilterNot(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(name <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br>        <span class="hljs-keyword">return</span> strings.HasPrefix(name, <span class="hljs-string">&quot;J&quot;</span>)<br>    &#125;).<br>    Map(strings.ToUpper).<br>    Last()<br><br>    fmt.Println(name) <span class="hljs-comment">// &quot;SALLY&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>go1.17åŠä»¥ä¸‹ç‰ˆæœ¬éœ€è¦ä½¿ç”¨pie&#x2F;v1åŒ…ã€‚å› ä¸ºåœ¨1.17ä¹‹å‰goè¿˜ä¸æ”¯æŒæ³›å‹ï¼Œæ‰€ä»¥å‡½æ•°åªèƒ½é’ˆå¯¹ç‰¹å®šç±»å‹çš„åˆ‡ç‰‡ã€‚åœ¨è¯¥v1åŒ…ä¸­ï¼Œpieå®é™…ä¸Šæ˜¯å®šä¹‰äº†ä¸€ç»„ç±»å‹åˆ‡ç‰‡ã€‚æ¯”å¦‚ï¼Œä»£è¡¨stringåˆ‡ç‰‡çš„pie.Stringsç±»å‹ã€‚ä»£è¡¨float64åˆ‡ç‰‡çš„pie.Float64sç±»å‹ã€‚é‚£ä¹ˆè¯¥ç‰ˆæœ¬åœ¨ä½¿ç”¨æ—¶éœ€è¦å…ˆå®šä¹‰åˆ‡ç‰‡çš„ç±»å‹ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span>å¤åˆ¶ä»£ç <span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;strings&quot;</span><br><br>    <span class="hljs-string">&quot;github.com/elliotchance/pie/pie&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> names pie.Strings <span class="hljs-comment">//çœ‹pieçš„æºç Stringsçš„åº•å±‚ç±»å‹æ˜¯[]string</span><br>    names = []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;Sally&quot;</span>, <span class="hljs-string">&quot;John&quot;</span>, <span class="hljs-string">&quot;Jane&quot;</span>&#125;<br><br>    name := names.FilterNot(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(name <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br>        <span class="hljs-keyword">return</span> strings.HasPrefix(name, <span class="hljs-string">&quot;J&quot;</span>)<br>    &#125;).<br>    Map(strings.ToUpper).<br>    Last()<br><br>    fmt.Println(name) <span class="hljs-comment">// &quot;SALLY&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="pieåŒ…æ”¯æŒçš„åŠŸèƒ½ï¼š"><a href="#pieåŒ…æ”¯æŒçš„åŠŸèƒ½ï¼š" class="headerlink" title="pieåŒ…æ”¯æŒçš„åŠŸèƒ½ï¼š"></a>pieåŒ…æ”¯æŒçš„åŠŸèƒ½ï¼š</h3><ul><li>åˆ‡ç‰‡ä¸­çš„å…ƒç´ æ˜¯å¦å…¨éƒ¨æˆ–ä»»æ„ä¸€ä¸ªæ»¡è¶³æŒ‡å®šçš„æ¡ä»¶ã€‚</li><li>Allå‡½æ•°ï¼šåˆ¤æ–­åˆ‡ç‰‡ä¸­çš„å…ƒç´ æ˜¯å¦éƒ½æ»¡è¶³æŒ‡å®šçš„æ¡ä»¶ã€‚</li><li>Anyå‡½æ•°ï¼šåˆ¤æ–­åˆ‡ç‰‡ä¸­çš„å…ƒç´ åªè¦æœ‰1ä¸ªæ»¡è¶³æŒ‡å®šæ¡ä»¶å³å¯ã€‚</li><li>å¯¹åˆ‡ç‰‡å…ƒç´ è¿›è¡Œæ’åºåŠŸèƒ½ã€‚</li><li>AreSortedå‡½æ•°ï¼šåˆ¤æ–­åˆ‡ç‰‡æ˜¯å¦æ˜¯æœ‰åºçš„</li><li>Sortå‡½æ•°ï¼šå¯¹åˆ‡ç‰‡å…ƒç´ è¿›è¡Œæ’åºã€‚</li><li>SortStableUsingå‡½æ•°ï¼šä½¿ç”¨æŒ‡å®šçš„æ¡ä»¶å¯¹åˆ‡ç‰‡è¿›è¡Œæ’åºï¼Œå¹¶ä¸”å…·æœ‰ç¨³å®šæ€§ã€‚</li><li>SortUsingå‡½æ•°</li><li>å¯¹åˆ‡ç‰‡ä¸­çš„å…ƒç´ å»é‡ã€‚</li><li>åˆ¤æ–­åˆ‡ç‰‡ä¸­çš„å…ƒç´ æ˜¯å¦ä¸é‡å¤çš„AreUniqueå‡½æ•°ã€å»é‡å‡½æ•°Unique</li><li>å¯¹åˆ‡ç‰‡è¿›è¡Œå‰ã€åæˆªå–ã€‚</li><li>Bottomå‡½æ•°ï¼šå–åˆ‡ç‰‡ånä¸ªå…ƒç´ </li><li>Topå‡½æ•°ï¼šå–åˆ‡ç‰‡å‰nä¸ªå…ƒç´ </li><li>DropTopå‡½æ•°ï¼šä¸¢æ‰åˆ‡ç‰‡çš„å‰nä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›å‰©ä½™çš„å…ƒç´ åˆ‡ç‰‡</li><li>ä¸¤ä¸ªæˆ–å¤šä¸ªåˆ‡ç‰‡ä¹‹é—´çš„é›†åˆè¿ç®—</li><li>Diffå‡½æ•°ï¼šè®¡ç®—ä¸¤ä¸ªåˆ‡ç‰‡ä¸­çš„å·®é›†</li><li>Intersectå‡½æ•°ï¼šè®¡ç®—ä¸¤ä¸ªæˆ–å¤šä¸ªåˆ‡ç‰‡çš„äº¤é›†</li><li>åˆ‡ç‰‡å…ƒç´ è¿›è¡Œç®—æ•°è¿ç®—åŠŸèƒ½ï¼ˆåªé’ˆå¯¹Integerå’Œfloatç±»å‹çš„åˆ‡ç‰‡æœ‰æ•ˆï¼‰ã€‚</li><li>Maxå‡½æ•°ï¼šè¿”å›åˆ‡ç‰‡ä¸­çš„æœ€å¤§å…ƒç´ </li><li>Minå‡½æ•°ï¼šè¿”å›åˆ‡ç‰‡ä¸­çš„æœ€å°å…ƒç´ </li><li>Productå‡½æ•°ï¼šå¯¹åˆ‡ç‰‡æ‰€æœ‰å…ƒç´ è¿›è¡Œä¹˜ç§¯è¿ç®—</li><li>Sumå‡½æ•°ï¼šå¯¹åˆ‡ç‰‡ä¸­æ‰€æœ‰å…ƒç´ è¿›è¡Œæ±‚å’Œè¿ç®—</li><li>Averageå‡½æ•°ï¼šæ±‚æ‰€æœ‰å…ƒç´ çš„å¹³å‡å€¼</li><li>å¯¹åˆ‡ç‰‡ä¸­çš„å…ƒç´ è¿›è¡Œæ•°æ®è½¬æ¢åŠŸèƒ½ï¼šEachã€Mapã€Filterã€Flatã€Reducer</li><li>é’ˆå¯¹mapçš„æ“ä½œï¼š</li><li>Keyså‡½æ•°ï¼šè·å–mapçš„æ‰€æœ‰é”®</li><li>Valueså‡½æ•°ï¼šè·å–mapçš„æ‰€æœ‰å€¼</li></ul><p>æ›´å¤šã€æ›´è¯¦ç»†çš„åŠŸèƒ½è¯·å‚è€ƒpieåŒ…çš„æºç ã€‚</p><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>pieåŒ…å‡ ä¹æŠŠsliceç»å¸¸ç”¨åˆ°çš„åŠŸèƒ½éƒ½åšäº†å°è£…ï¼Œå¯è°“æ˜¯ç»™å¼€å‘è€…èŠ‚çœäº†å¤§é‡æ—¶é—´ã€‚åŒæ—¶ï¼Œv2åŒ…åˆ©ç”¨äº†æ³›å‹ä¸­çš„ç±»å‹é™åˆ¶ï¼Œä¿è¯äº†ç±»å‹çš„å®‰å…¨ã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œè¯¥åŒ…é‡‡ç”¨äº†å¾ˆå¤šç­–ç•¥ï¼šåœ¨å·²çŸ¥åˆ‡ç‰‡é•¿åº¦çš„æƒ…å†µä¸‹å°½å¯èƒ½ç»™slice<strong>åˆ†é…å›ºå®šé•¿åº¦</strong>çš„å†…å­˜ï¼Œå‡å°‘åœ¨ä½¿ç”¨appendæ—¶å†…å­˜ç”³è¯·çš„æ¬¡æ•°ï¼›ä½¿ç”¨<strong>åˆ‡ç‰‡æˆªå–</strong>çš„å½¢å¼ï¼Œé¿å…å†…å­˜å†æ¬¡åˆ†é…ã€‚</p><h2 id="Viper"><a href="#Viper" class="headerlink" title="Viper"></a>Viper</h2><p>viperæ˜¯goä¸€ä¸ªå¼ºå¤§çš„æµè¡Œçš„é…ç½®è§£å†³æ–¹æ¡ˆçš„åº“ã€‚viperæ˜¯spf13çš„å¦å¤–ä¸€ä¸ªé‡é‡çº§åº“ã€‚æœ‰å¤§é‡é¡¹ç›®éƒ½ä½¿ç”¨è¯¥åº“ï¼Œæ¯”å¦‚hugo, dockerç­‰ã€‚ å®ƒåŸºæœ¬ä¸Šå¯ä»¥å¤„ç†æ‰€æœ‰ç±»å‹çš„é…ç½®éœ€æ±‚å’Œæ ¼å¼, viperæ”¯æŒåŠŸèƒ½</p><ul><li><p>æ”¯æŒ JSON&#x2F;TOML&#x2F;YAML&#x2F;HCL&#x2F;envfile&#x2F;Java properties ç­‰å¤šç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼›</p></li><li><p>å¯ä»¥è®¾ç½®ç›‘å¬é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ï¼Œä¿®æ”¹æ—¶è‡ªåŠ¨åŠ è½½æ–°çš„é…ç½®ï¼›</p></li><li><p>ä»ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œé€‰é¡¹å’Œ<code>io.Reader</code>ä¸­è¯»å–é…ç½®ï¼›</p></li><li><p>ä»è¿œç¨‹é…ç½®ç³»ç»Ÿä¸­è¯»å–å’Œç›‘å¬ä¿®æ”¹ï¼Œå¦‚ etcd&#x2F;Consulï¼›</p></li><li><p>ä»£ç é€»è¾‘ä¸­æ˜¾ç¤ºè®¾ç½®é”®å€¼ã€‚</p></li></ul><h3 id="å¿«é€Ÿä½¿ç”¨-2"><a href="#å¿«é€Ÿä½¿ç”¨-2" class="headerlink" title="å¿«é€Ÿä½¿ç”¨"></a>å¿«é€Ÿä½¿ç”¨</h3><p>å®‰è£…</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span> get github.com/spf13/viper<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>  <span class="hljs-string">&quot;fmt&quot;</span><br>  <span class="hljs-string">&quot;log&quot;</span><br><br>  <span class="hljs-string">&quot;github.com/spf13/viper&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  viper.SetConfigName(<span class="hljs-string">&quot;config&quot;</span>)<br>  viper.SetConfigType(<span class="hljs-string">&quot;toml&quot;</span>)<br>  viper.AddConfigPath(<span class="hljs-string">&quot;.&quot;</span>)<br>  viper.SetDefault(<span class="hljs-string">&quot;redis.port&quot;</span>, <span class="hljs-number">6381</span>)# é»˜è®¤å€¼å¯ä»¥è°ƒç”¨viper.SetDefaultè®¾ç½®<br>  err := viper.ReadInConfig()<br>  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    log.Fatal(<span class="hljs-string">&quot;read config failed: %v&quot;</span>, err)<br>  &#125;<br><br>  fmt.Println(viper.Get(<span class="hljs-string">&quot;app_name&quot;</span>))<br>  fmt.Println(viper.Get(<span class="hljs-string">&quot;log_level&quot;</span>))<br><br>  fmt.Println(<span class="hljs-string">&quot;mysql ip: &quot;</span>, viper.Get(<span class="hljs-string">&quot;mysql.ip&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;mysql port: &quot;</span>, viper.Get(<span class="hljs-string">&quot;mysql.port&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;mysql user: &quot;</span>, viper.Get(<span class="hljs-string">&quot;mysql.user&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;mysql password: &quot;</span>, viper.Get(<span class="hljs-string">&quot;mysql.password&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;mysql database: &quot;</span>, viper.Get(<span class="hljs-string">&quot;mysql.database&quot;</span>))<br><br>  fmt.Println(<span class="hljs-string">&quot;redis ip: &quot;</span>, viper.Get(<span class="hljs-string">&quot;redis.ip&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;redis port: &quot;</span>, viper.Get(<span class="hljs-string">&quot;redis.port&quot;</span>))<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="è¯»å–é”®"><a href="#è¯»å–é”®" class="headerlink" title="è¯»å–é”®"></a>è¯»å–é”®</h3><p>viper æä¾›äº†å¤šç§å½¢å¼çš„è¯»å–æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†<code>Get</code>æ–¹æ³•çš„ç”¨æ³•ã€‚<code>Get</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>interface&#123;&#125;</code>çš„å€¼ï¼Œä½¿ç”¨æœ‰æ‰€ä¸ä¾¿ã€‚</p><p><code>GetType</code>ç³»åˆ—æ–¹æ³•å¯ä»¥è¿”å›æŒ‡å®šç±»å‹çš„å€¼ã€‚ å…¶ä¸­ï¼ŒType å¯ä»¥ä¸º<code>Bool/Float64/Int/String/Time/Duration/IntSlice/StringSlice</code>ã€‚ ä½†æ˜¯è¯·æ³¨æ„ï¼Œ</p><p><strong>å¦‚æœæŒ‡å®šçš„é”®ä¸å­˜åœ¨æˆ–ç±»å‹ä¸æ­£ç¡®ï¼Œ<code>GetType</code>æ–¹æ³•è¿”å›å¯¹åº”ç±»å‹çš„é›¶å€¼</strong>ã€‚</p><p>å¦‚æœè¦åˆ¤æ–­æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨<code>IsSet</code>æ–¹æ³•ã€‚ å¦å¤–ï¼Œ<code>GetStringMap</code>å’Œ<code>GetStringMapString</code>ç›´æ¥ä»¥ map è¿”å›æŸä¸ªé”®ä¸‹é¢æ‰€æœ‰çš„é”®å€¼å¯¹ï¼Œå‰è€…è¿”å›<code>map[string]interface&#123;&#125;</code>ï¼Œåè€…è¿”å›<code>map[string]string</code>ã€‚ <code>AllSettings</code>ä»¥<code>map[string]interface&#123;&#125;</code>è¿”å›æ‰€æœ‰è®¾ç½®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// çœç•¥åŒ…åå’Œ import éƒ¨åˆ†</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  viper.SetConfigName(<span class="hljs-string">&quot;config&quot;</span>)<br>  viper.SetConfigType(<span class="hljs-string">&quot;toml&quot;</span>)<br>  viper.AddConfigPath(<span class="hljs-string">&quot;.&quot;</span>)<br>  err := viper.ReadInConfig()<br>  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    log.Fatal(<span class="hljs-string">&quot;read config failed: %v&quot;</span>, err)<br>  &#125;<br><br>  fmt.Println(<span class="hljs-string">&quot;protocols: &quot;</span>, viper.GetStringSlice(<span class="hljs-string">&quot;server.protocols&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;ports: &quot;</span>, viper.GetIntSlice(<span class="hljs-string">&quot;server.ports&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;timeout: &quot;</span>, viper.GetDuration(<span class="hljs-string">&quot;server.timeout&quot;</span>))<br><br>  fmt.Println(<span class="hljs-string">&quot;mysql ip: &quot;</span>, viper.GetString(<span class="hljs-string">&quot;mysql.ip&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;mysql port: &quot;</span>, viper.GetInt(<span class="hljs-string">&quot;mysql.port&quot;</span>))<br><br>  <span class="hljs-keyword">if</span> viper.IsSet(<span class="hljs-string">&quot;redis.port&quot;</span>) &#123;<br>    fmt.Println(<span class="hljs-string">&quot;redis.port is set&quot;</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    fmt.Println(<span class="hljs-string">&quot;redis.port is not set&quot;</span>)<br>  &#125;<br><br>  fmt.Println(<span class="hljs-string">&quot;mysql settings: &quot;</span>, viper.GetStringMap(<span class="hljs-string">&quot;mysql&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;redis settings: &quot;</span>, viper.GetStringMap(<span class="hljs-string">&quot;redis&quot;</span>))<br>  fmt.Println(<span class="hljs-string">&quot;all settings: &quot;</span>, viper.AllSettings())# è·å–æ‰€æœ‰é…ç½®å€¼<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è®¾ç½®é”®å€¼"><a href="#è®¾ç½®é”®å€¼" class="headerlink" title="è®¾ç½®é”®å€¼"></a>è®¾ç½®é”®å€¼</h3><p>viper æ”¯æŒåœ¨å¤šä¸ªåœ°æ–¹è®¾ç½®ï¼Œä½¿ç”¨ä¸‹é¢çš„é¡ºåºä¾æ¬¡è¯»å–ï¼š</p><ul><li>è°ƒç”¨<code>Set</code>æ˜¾ç¤ºè®¾ç½®çš„ï¼›</li><li>å‘½ä»¤è¡Œé€‰é¡¹ï¼›</li><li>ç¯å¢ƒå˜é‡ï¼›</li><li>é…ç½®æ–‡ä»¶ï¼›</li><li>é»˜è®¤å€¼ã€‚</li></ul><p><code>viper.Set</code></p><p>å¦‚æœæŸä¸ªé”®é€šè¿‡<code>viper.Set</code>è®¾ç½®äº†å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">viper.Set(<span class="hljs-string">&quot;redis.port&quot;</span>, <span class="hljs-number">5381</span>)<br></code></pre></td></tr></table></figure><p><code>å‘½ä»¤è¡Œé€‰é¡¹</code></p><p>å¦‚æœä¸€ä¸ªé”®æ²¡æœ‰é€šè¿‡<code>viper.Set</code>æ˜¾ç¤ºè®¾ç½®å€¼ï¼Œé‚£ä¹ˆè·å–æ—¶å°†å°è¯•ä»å‘½ä»¤è¡Œé€‰é¡¹ä¸­è¯»å–ã€‚ å¦‚æœæœ‰ï¼Œä¼˜å…ˆä½¿ç”¨ã€‚viper ä½¿ç”¨ pflag åº“æ¥è§£æé€‰é¡¹ã€‚ æˆ‘ä»¬é¦–å…ˆåœ¨<code>init</code>æ–¹æ³•ä¸­å®šä¹‰é€‰é¡¹ï¼Œå¹¶ä¸”è°ƒç”¨<code>viper.BindPFlags</code>ç»‘å®šé€‰é¡¹åˆ°é…ç½®ä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>  pflag.Int(<span class="hljs-string">&quot;redis.port&quot;</span>, <span class="hljs-number">8381</span>, <span class="hljs-string">&quot;Redis port to connect&quot;</span>)<br><br>  <span class="hljs-comment">// ç»‘å®šå‘½ä»¤è¡Œ</span><br>  viper.BindPFlags(pflag.CommandLine)<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œåœ¨<code>main</code>æ–¹æ³•å¼€å¤´å¤„è°ƒç”¨<code>pflag.Parse</code>è§£æé€‰é¡¹ã€‚</p><p>ç¼–è¯‘ã€è¿è¡Œç¨‹åºï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./main.exe --redis.port 9381<br>awesome web<br>DEBUG<br>mysql ip:  127.0.0.1<br>mysql port:  3306<br>mysql user:  dj<br>mysql password:  123456<br>mysql database:  awesome<br>redis ip:  127.0.0.1<br>redis port:  9381<br></code></pre></td></tr></table></figure><p><code>ç¯å¢ƒå˜é‡</code></p><p>å¦‚æœå‰é¢éƒ½æ²¡æœ‰è·å–åˆ°é”®å€¼ï¼Œå°†å°è¯•ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–ã€‚æˆ‘ä»¬æ—¢å¯ä»¥ä¸€ä¸ªä¸ªç»‘å®šï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨å…¨éƒ¨ç»‘å®šã€‚</p><p>åœ¨<code>init</code>æ–¹æ³•ä¸­è°ƒç”¨<code>AutomaticEnv</code>æ–¹æ³•ç»‘å®šå…¨éƒ¨ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-comment">// ç»‘å®šç¯å¢ƒå˜é‡</span><br>  viper.AutomaticEnv()<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†éªŒè¯æ˜¯å¦ç»‘å®šæˆåŠŸï¼Œæˆ‘ä»¬åœ¨<code>main</code>æ–¹æ³•ä¸­å°†ç¯å¢ƒå˜é‡ GOPATH æ‰“å°å‡ºæ¥ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-comment">// çœç•¥éƒ¨åˆ†ä»£ç </span><br><br>  fmt.Println(<span class="hljs-string">&quot;GOPATH: &quot;</span>, viper.Get(<span class="hljs-string">&quot;GOPATH&quot;</span>))<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥å•ç‹¬ç»‘å®šç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-comment">// ç»‘å®šç¯å¢ƒå˜é‡</span><br>  viper.BindEnv(<span class="hljs-string">&quot;redis.port&quot;</span>)<br>  viper.BindEnv(<span class="hljs-string">&quot;go.path&quot;</span>, <span class="hljs-string">&quot;GOPATH&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-comment">// çœç•¥éƒ¨åˆ†ä»£ç </span><br>  fmt.Println(<span class="hljs-string">&quot;go path: &quot;</span>, viper.Get(<span class="hljs-string">&quot;go.path&quot;</span>))<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨<code>BindEnv</code>æ–¹æ³•ï¼Œå¦‚æœåªä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œåˆ™è¿™ä¸ªå‚æ•°æ—¢è¡¨ç¤ºé”®åï¼Œåˆè¡¨ç¤ºç¯å¢ƒå˜é‡åã€‚ å¦‚æœä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œåˆ™ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºé”®åï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºç¯å¢ƒå˜é‡åã€‚</p><p>è¿˜å¯ä»¥é€šè¿‡<code>viper.SetEnvPrefix</code>æ–¹æ³•è®¾ç½®ç¯å¢ƒå˜é‡å‰ç¼€ï¼Œè¿™æ ·ä¸€æ¥ï¼Œé€šè¿‡<code>AutomaticEnv</code>å’Œä¸€ä¸ªå‚æ•°çš„<code>BindEnv</code>ç»‘å®šçš„ç¯å¢ƒå˜é‡ï¼Œ åœ¨ä½¿ç”¨<code>Get</code>çš„æ—¶å€™ï¼Œviper ä¼šè‡ªåŠ¨åŠ ä¸Šè¿™ä¸ªå‰ç¼€å†ä»ç¯å¢ƒå˜é‡ä¸­æŸ¥æ‰¾ã€‚</p><p>å¦‚æœå¯¹åº”çš„ç¯å¢ƒå˜é‡ä¸å­˜åœ¨ï¼Œviper ä¼šè‡ªåŠ¨å°†é”®åå…¨éƒ¨è½¬ä¸ºå¤§å†™å†æŸ¥æ‰¾ä¸€æ¬¡ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨é”®å<code>gopath</code>ä¹Ÿèƒ½è¯»å–ç¯å¢ƒå˜é‡<code>GOPATH</code>çš„å€¼ã€‚</p><h3 id="è¯»å–é…ç½®"><a href="#è¯»å–é…ç½®" class="headerlink" title="è¯»å–é…ç½®"></a>è¯»å–é…ç½®</h3><p>ä»<code>io.Reader</code>ä¸­è¯»å–</p><p>viper æ”¯æŒä»<code>io.Reader</code>ä¸­è¯»å–é…ç½®ã€‚è¿™ç§å½¢å¼å¾ˆçµæ´»ï¼Œæ¥æºå¯ä»¥æ˜¯æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¨‹åºä¸­ç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼Œç”šè‡³å¯ä»¥ä»ç½‘ç»œè¿æ¥ä¸­è¯»å–çš„å­—èŠ‚æµã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>  <span class="hljs-string">&quot;bytes&quot;</span><br>  <span class="hljs-string">&quot;fmt&quot;</span><br>  <span class="hljs-string">&quot;log&quot;</span><br><br>  <span class="hljs-string">&quot;github.com/spf13/viper&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  viper.SetConfigType(<span class="hljs-string">&quot;toml&quot;</span>)<br>  tomlConfig := []<span class="hljs-type">byte</span>(<span class="hljs-string">`</span><br><span class="hljs-string">app_name = &quot;awesome web&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string"># possible values: DEBUG, INFO, WARNING, ERROR, FATAL</span><br><span class="hljs-string">log_level = &quot;DEBUG&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[mysql]</span><br><span class="hljs-string">ip = &quot;127.0.0.1&quot;</span><br><span class="hljs-string">port = 3306</span><br><span class="hljs-string">user = &quot;dj&quot;</span><br><span class="hljs-string">password = 123456</span><br><span class="hljs-string">database = &quot;awesome&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[redis]</span><br><span class="hljs-string">ip = &quot;127.0.0.1&quot;</span><br><span class="hljs-string">port = 7381</span><br><span class="hljs-string">`</span>)<br>  err := viper.ReadConfig(bytes.NewBuffer(tomlConfig))<br>  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    log.Fatal(<span class="hljs-string">&quot;read config failed: %v&quot;</span>, err)<br>  &#125;<br><br>  fmt.Println(<span class="hljs-string">&quot;redis port: &quot;</span>, viper.GetInt(<span class="hljs-string">&quot;redis.port&quot;</span>))<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Unmarshal</code></p><p>viper æ”¯æŒå°†é…ç½®<code>Unmarshal</code>åˆ°ä¸€ä¸ªç»“æ„ä½“ä¸­ï¼Œä¸ºç»“æ„ä½“ä¸­çš„å¯¹åº”å­—æ®µèµ‹å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>  <span class="hljs-string">&quot;fmt&quot;</span><br>  <span class="hljs-string">&quot;log&quot;</span><br><br>  <span class="hljs-string">&quot;github.com/spf13/viper&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> &#123;<br>  AppName  <span class="hljs-type">string</span><br>  LogLevel <span class="hljs-type">string</span><br><br>  MySQL    MySQLConfig<br>  Redis    RedisConfig<br>&#125;<br><br><span class="hljs-keyword">type</span> MySQLConfig <span class="hljs-keyword">struct</span> &#123;<br>  IP       <span class="hljs-type">string</span><br>  Port     <span class="hljs-type">int</span><br>  User     <span class="hljs-type">string</span><br>  Password <span class="hljs-type">string</span><br>  Database <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-keyword">type</span> RedisConfig <span class="hljs-keyword">struct</span> &#123;<br>  IP   <span class="hljs-type">string</span><br>  Port <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  viper.SetConfigName(<span class="hljs-string">&quot;config&quot;</span>)<br>  viper.SetConfigType(<span class="hljs-string">&quot;toml&quot;</span>)<br>  viper.AddConfigPath(<span class="hljs-string">&quot;.&quot;</span>)<br>  err := viper.ReadInConfig()<br>  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    log.Fatal(<span class="hljs-string">&quot;read config failed: %v&quot;</span>, err)<br>  &#125;<br><br>  <span class="hljs-keyword">var</span> c Config<br>  viper.Unmarshal(&amp;c)<br><br>  fmt.Println(c.MySQL)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¿å­˜é…ç½®"><a href="#ä¿å­˜é…ç½®" class="headerlink" title="ä¿å­˜é…ç½®"></a>ä¿å­˜é…ç½®</h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦å°†ç¨‹åºä¸­ç”Ÿæˆçš„é…ç½®ï¼Œæˆ–è€…æ‰€åšçš„ä¿®æ”¹ä¿å­˜ä¸‹æ¥ã€‚viper æä¾›äº†æ¥å£ï¼</p><ul><li><code>WriteConfig</code>ï¼šå°†å½“å‰çš„ viper é…ç½®å†™åˆ°é¢„å®šä¹‰è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰é¢„å®šä¹‰è·¯å¾„ï¼Œè¿”å›é”™è¯¯ã€‚å°†ä¼šè¦†ç›–å½“å‰é…ç½®ï¼›</li><li><code>SafeWriteConfig</code>ï¼šä¸ä¸Šé¢åŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯å¦‚æœé…ç½®æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™ä¸è¦†ç›–ï¼›</li><li><code>WriteConfigAs</code>ï¼šä¿å­˜é…ç½®åˆ°æŒ‡å®šè·¯å¾„ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¦†ç›–ï¼›</li><li><code>SafeWriteConfigAs</code>ï¼šä¸ä¸Šé¢åŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯å…¥è‚¡é…ç½®æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™ä¸è¦†ç›–ã€‚</li></ul><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ç¨‹åºç”Ÿæˆä¸€ä¸ª<code>config.toml</code>é…ç½®ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>  <span class="hljs-string">&quot;log&quot;</span><br><br>  <span class="hljs-string">&quot;github.com/spf13/viper&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  viper.SetConfigName(<span class="hljs-string">&quot;config&quot;</span>)<br>  viper.SetConfigType(<span class="hljs-string">&quot;toml&quot;</span>)<br>  viper.AddConfigPath(<span class="hljs-string">&quot;.&quot;</span>)<br><br>  viper.Set(<span class="hljs-string">&quot;app_name&quot;</span>, <span class="hljs-string">&quot;awesome web&quot;</span>)<br>  viper.Set(<span class="hljs-string">&quot;log_level&quot;</span>, <span class="hljs-string">&quot;DEBUG&quot;</span>)<br>  viper.Set(<span class="hljs-string">&quot;mysql.ip&quot;</span>, <span class="hljs-string">&quot;127.0.0.1&quot;</span>)<br>  viper.Set(<span class="hljs-string">&quot;mysql.port&quot;</span>, <span class="hljs-number">3306</span>)<br>  viper.Set(<span class="hljs-string">&quot;mysql.user&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>)<br>  viper.Set(<span class="hljs-string">&quot;mysql.password&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>)<br>  viper.Set(<span class="hljs-string">&quot;mysql.database&quot;</span>, <span class="hljs-string">&quot;awesome&quot;</span>)<br><br>  viper.Set(<span class="hljs-string">&quot;redis.ip&quot;</span>, <span class="hljs-string">&quot;127.0.0.1&quot;</span>)<br>  viper.Set(<span class="hljs-string">&quot;redis.port&quot;</span>, <span class="hljs-number">6381</span>)<br><br>  err := viper.SafeWriteConfig()<br>  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    log.Fatal(<span class="hljs-string">&quot;write config failed: &quot;</span>, err)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç›‘å¬æ–‡ä»¶ä¿®æ”¹"><a href="#ç›‘å¬æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="ç›‘å¬æ–‡ä»¶ä¿®æ”¹"></a>ç›‘å¬æ–‡ä»¶ä¿®æ”¹</h3><p>viper å¯ä»¥ç›‘å¬æ–‡ä»¶ä¿®æ”¹ï¼Œçƒ­åŠ è½½é…ç½®ã€‚å› æ­¤ä¸éœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œå°±èƒ½è®©é…ç½®ç”Ÿæ•ˆã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>  <span class="hljs-string">&quot;fmt&quot;</span><br>  <span class="hljs-string">&quot;log&quot;</span><br>  <span class="hljs-string">&quot;time&quot;</span><br><br>  <span class="hljs-string">&quot;github.com/spf13/viper&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  viper.SetConfigName(<span class="hljs-string">&quot;config&quot;</span>)<br>  viper.SetConfigType(<span class="hljs-string">&quot;toml&quot;</span>)<br>  viper.AddConfigPath(<span class="hljs-string">&quot;.&quot;</span>)<br>  err := viper.ReadInConfig()<br>  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    log.Fatal(<span class="hljs-string">&quot;read config failed: %v&quot;</span>, err)<br>  &#125;<br><br>  viper.WatchConfig()<br><br>  fmt.Println(<span class="hljs-string">&quot;redis port before sleep: &quot;</span>, viper.Get(<span class="hljs-string">&quot;redis.port&quot;</span>))<br>  time.Sleep(time.Second * <span class="hljs-number">10</span>)<br>  fmt.Println(<span class="hljs-string">&quot;redis port after sleep: &quot;</span>, viper.Get(<span class="hljs-string">&quot;redis.port&quot;</span>))<br>&#125;<br></code></pre></td></tr></table></figure><p>åªéœ€è¦è°ƒç”¨<code>viper.WatchConfig</code>ï¼Œviper ä¼šè‡ªåŠ¨ç›‘å¬é…ç½®ä¿®æ”¹ã€‚å¦‚æœæœ‰ä¿®æ”¹ï¼Œé‡æ–°åŠ è½½çš„é…ç½®ã€‚</p><p>ä¸Šé¢ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å…ˆæ‰“å°<code>redis.port</code>çš„å€¼ï¼Œç„¶å<code>Sleep</code> 10sã€‚åœ¨è¿™æœŸé—´ä¿®æ”¹é…ç½®ä¸­<code>redis.port</code>çš„å€¼ï¼Œ<code>Sleep</code>ç»“æŸåå†æ¬¡æ‰“å°ã€‚ å‘ç°æ‰“å°å‡ºä¿®æ”¹åçš„å€¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">redis port before sleep:  <span class="hljs-number">7381</span><br>redis port after sleep:  <span class="hljs-number">73810</span><br></code></pre></td></tr></table></figure><p>å¦å¤–ï¼Œè¿˜å¯ä»¥ä¸ºé…ç½®ä¿®æ”¹å¢åŠ ä¸€ä¸ªå›è°ƒï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">viper.OnConfigChange(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(e fsnotify.Event)</span></span> &#123;<br>  fmt.Printf(<span class="hljs-string">&quot;Config file:%s Op:%s\n&quot;</span>, e.Name, e.Op)<br>&#125;)<br></code></pre></td></tr></table></figure><p>è¿™æ ·æ–‡ä»¶ä¿®æ”¹æ—¶ä¼šæ‰§è¡Œè¿™ä¸ªå›è°ƒã€‚</p><p>viper ä½¿ç”¨<a href="https://link.juejin.cn/?target=https://github.com/fsnotify/fsnotify">fsnotify</a>è¿™ä¸ªåº“æ¥å®ç°ç›‘å¬æ–‡ä»¶ä¿®æ”¹çš„åŠŸèƒ½ã€‚</p><h3 id="viperä¹‹å‘"><a href="#viperä¹‹å‘" class="headerlink" title="viperä¹‹å‘"></a>viperä¹‹å‘</h3><ul><li>yamlç©ºå€¼ï¼Œä¿®æ”¹å®Œæˆä¹‹åä¼šä¸¢å¤±</li><li>keyå…¨éƒ¨è‡ªåŠ¨è½¬æˆå°å†™ï¼Œdocker-composeé‡Œé¢å®¹å™¨å¤§å°å†™æ•æ„Ÿ</li></ul><h2 id="golang-setåŒ…"><a href="#golang-setåŒ…" class="headerlink" title="golang-setåŒ…"></a>golang-setåŒ…</h2><p>Setæ˜¯ä¸€ç§åŸºæœ¬çš„æ•°æ®ç»“æ„,å®ƒå…·å¤‡ç¡®å®šæ€§ã€äº’å¼‚æ€§ã€æ— åºæ€§ä¸‰ä¸ªç‰¹ç‚¹ã€‚å› æ­¤ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬é€šå¸¸ç”¨å®ƒæ¥åˆ¤æ–­ä¸€äº›æ•°æ®çš„é›†åˆä¸å¦ä¸€ä¸ªæ•°æ®é›†åˆæˆ–è€…å…ƒç´ çš„åŒ…å«å…³ç³»ã€‚åœ¨å¤§éƒ¨åˆ†å¼€å‘è¯­è¨€ä¸­setéƒ½æ˜¯ä¸€ç§åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯golangä¸æä¾›setç±»å‹ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šç”¨map[interface{}]struct{}{}æ¥ä»£æ›¿setå®ç°åŒ…å«å…³ç³»çš„åˆ¤æ–­ã€‚ä½†äº‹å®ä¸Šï¼Œæˆ‘ä»¬åœ¨githubä¸Šä¼šå‘ç°ä¸€äº›ç¬¬ä¸‰æ–¹çš„å¼€æºåŒ…ã€‚ä¾‹å¦‚<a href="https://links.jianshu.com/go?to=https://github.com/deckarep/golang-set">golang-set</a>å°±æ˜¯ä¸€ä¸ªç›¸å¯¹æˆç†Ÿçš„åŒ…ã€‚æˆªæ­¢åˆ°2021å¹´3æœˆä»½å·²ç»æœ‰1.8kçš„starå’Œ160+çš„forkã€‚åŒæ—¶è¿™ä¸ªåŒ…æœ¬èº«ä¹Ÿå·²ç»åº”ç”¨äºdockeré¡¹ç›®ä¸­ã€‚æ˜¯ä¸€ä¸ªå¯ç”¨æ€§å’Œå¯é æ€§éƒ½ç»è¿‡éªŒè¯çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨</p><p>golang-setåŒ…æœ¬èº«ä¹Ÿæ˜¯åŸºäºmap[interface{}]struct{}{}ç»“æ„å®ç°çš„ï¼ŒåŒæ—¶golang-setåŒ…æä¾›äº†çº¿ç¨‹å®‰å…¨å’Œä¸ä¿è¯å®‰å…¨çš„ä¸¤ç§setç±»å‹ï¼Œç›¸æ¯”äºçº¿ç¨‹å®‰å…¨çš„setå¯¹è±¡ï¼Œä¸ä¿è¯å®‰å…¨çš„setå¯¹è±¡æ‰§è¡Œæ•ˆç‡ä¼šæ›´é«˜ä¸€ç‚¹ã€‚</p><h3 id="å¿«é€Ÿä½¿ç”¨-3"><a href="#å¿«é€Ÿä½¿ç”¨-3" class="headerlink" title="å¿«é€Ÿä½¿ç”¨"></a>å¿«é€Ÿä½¿ç”¨</h3><p>golang-setçš„ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€å¯¼å…¥è¯¥åŒ…ç„¶ååˆ›å»ºsetå¯¹è±¡å³å¯å¼€å§‹ä½¿ç”¨ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> mapset <span class="hljs-string">&quot;github.com/deckarep/golang-set&quot;</span><br><br>set := mapset.NewSet(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br>set.Add(<span class="hljs-number">6</span>)<br><br>set.Contains(<span class="hljs-number">5</span>)<br>set.Remove(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h3 id="setç±»å‹"><a href="#setç±»å‹" class="headerlink" title="setç±»å‹"></a>setç±»å‹</h3><p>golang æä¾›äº†ä¸¤ç§setç±»å‹ï¼Œä¸€ç§æ˜¯æ™®é€šçš„é›†åˆå¯¹è±¡ï¼Œä¸€ç§æ˜¯çº¿ç¨‹å®‰å…¨çš„é›†åˆå¯¹è±¡ï¼Œé€šè¿‡ç»“æ„åµŒå¥—çš„æ–¹å¼ä¸ºæ™®é€šé›†åˆå¯¹è±¡æ–°å¢äº†ä¸€ä¸ªå…¨å±€é”ï¼Œå®ç°äº†çº¿ç¨‹å®‰å…¨ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> threadSafeSet <span class="hljs-keyword">struct</span> &#123;<br>    s threadUnsafeSet<br>    sync.RWMutex<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newThreadSafeSet</span><span class="hljs-params">()</span></span> threadSafeSet &#123;<br>    <span class="hljs-keyword">return</span> threadSafeSet&#123;s: newThreadUnsafeSet()&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ“ä½œæ–¹æ³•"><a href="#æ“ä½œæ–¹æ³•" class="headerlink" title="æ“ä½œæ–¹æ³•"></a>æ“ä½œæ–¹æ³•</h3><p>golang-setåŒ…æä¾›çš„é›†åˆæ“ä½œæ–¹æ³•åŒ…å«å¦‚ä¸‹23ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Set <span class="hljs-keyword">interface</span> &#123;<br>    Add(i <span class="hljs-keyword">interface</span>&#123;&#125;) <span class="hljs-type">bool</span><br>    Cardinality() <span class="hljs-type">int</span><br>    Clear()<br>    Clone() Set<br>    Contains(i ...<span class="hljs-keyword">interface</span>&#123;&#125;) <span class="hljs-type">bool</span><br>    Difference(other Set) Set<br>    Equal(other Set) <span class="hljs-type">bool</span><br>    Intersect(other Set) Set<br>    IsProperSubset(other Set) <span class="hljs-type">bool</span><br>    IsProperSuperset(other Set) <span class="hljs-type">bool</span><br>    IsSubset(other Set) <span class="hljs-type">bool</span><br>    IsSuperset(other Set) <span class="hljs-type">bool</span><br>    Each(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> <span class="hljs-type">bool</span>)<br>    Iter() &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">interface</span>&#123;&#125;<br>    Iterator() *Iterator<br>    Remove(i <span class="hljs-keyword">interface</span>&#123;&#125;)<br>    String() <span class="hljs-type">string</span><br>    SymmetricDifference(other Set) Set<br>    Union(other Set) Set<br>    Pop() <span class="hljs-keyword">interface</span>&#123;&#125;<br>    PowerSet() Set<br>    CartesianProduct(other Set) Set<br>    ToSlice() []<span class="hljs-keyword">interface</span>&#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li><p>Add(i interface{}) bool:ç”¨äºå‘é›†åˆä¸­æ·»åŠ æŸäº›å…ƒç´ </p></li><li><p>Cardinality() int ï¼šè¿”å›é›†åˆå…ƒç´ ä¸ªæ•°</p></li><li><p>Clear() ï¼šæ¸…ç©ºé›†åˆä¸­å…¨éƒ¨å…ƒç´ ï¼Œå‰©ä¸‹ä¸€ä¸ªç©ºçš„é›†åˆï¼Œä½¿ç”¨ä¸éœ€è¦é€šè¿‡NewSetè¿›è¡Œåˆå§‹åŒ–</p></li><li><p>Clone() Set ï¼šå¤åˆ¶ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„é›†åˆå¯¹è±¡</p></li><li><p>Contains(i â€¦interface{}) bool ï¼šè¿”å›æ˜¯å¦å‚æ•°å…ƒç´ å…¨éƒ¨åŒ…å«äºé›†åˆä¸­</p></li><li><p>Difference(other Set) Set ï¼šå°†è¿”å›å½“å‰é›†åˆä¸å‚æ•°é›†åˆçš„å…¨éƒ¨å·®å¼‚å…ƒç´ ï¼Œè¿™äº›å…ƒç´ åŒ…å«äºæœ¬é›†åˆä½†æ˜¯ä¸åŒ…å«äºå‚æ•°é›†åˆã€‚æ³¨æ„ï¼šå…¥å‚çš„setç±»å‹ä¸æ–¹æ³•æ¥å—è€…setçš„ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™å°†å¯¼è‡´panicã€‚</p></li><li><p>Equal(other Set) bool ï¼šå¦‚æœå‚æ•°é›†åˆä¸å½“å‰é›†åˆçš„å®¹é‡å’Œå…¨éƒ¨å…ƒç´ æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆä¼šè¢«ç„¶è®¤ä¸ºæ˜¯ç›¸åŒçš„ï¼Œæ— éœ€è€ƒè™‘å…ƒç´ çš„é¡ºåºã€‚æ³¨æ„ï¼šå…¥å‚çš„setç±»å‹ä¸æ–¹æ³•æ¥å—è€…setçš„ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™å°†å¯¼è‡´panicã€‚</p></li><li><p>Intersect(other Set) Setï¼šå°†è¿”å›ä¸¤ä¸ªé›†åˆçš„äº¤é›†ã€‚æ³¨æ„ï¼šå…¥å‚çš„setç±»å‹ä¸æ–¹æ³•æ¥å—è€…setçš„ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™å°†å¯¼è‡´panicã€‚</p></li><li><p>IsProperSubset(other Set) boolï¼šåˆ¤æ–­å½“å‰setæ˜¯å¦ä¸ºå‚æ•°setçš„çœŸå­é›†ï¼ˆåŒ…å«ä½†ä¸ç›¸ç­‰ï¼‰ã€‚æ³¨æ„ï¼šå…¥å‚çš„setç±»å‹ä¸æ–¹æ³•æ¥å—è€…setçš„ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™å°†å¯¼è‡´panicã€‚</p></li><li><p>IsProperSuperset(other Set) boolï¼šåˆ¤æ–­å‚æ•°setæ˜¯å¦ä¸ºå½“å‰setçš„çœŸå­é›†ï¼ˆåŒ…å«ä½†ä¸ç›¸ç­‰ï¼‰ã€‚æ³¨æ„ï¼šå…¥å‚çš„setç±»å‹ä¸æ–¹æ³•æ¥å—è€…setçš„ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™å°†å¯¼è‡´panicã€‚</p></li><li><p>IsSubset(other Set) boolï¼šåˆ¤æ–­å½“å‰setæ˜¯å¦ä¸ºå‚æ•°setçš„å­é›†ï¼ˆåŒ…å«ï¼Œå…è®¸ç›¸ç­‰ï¼‰ã€‚æ³¨æ„ï¼šå…¥å‚çš„setç±»å‹ä¸æ–¹æ³•æ¥å—è€…setçš„ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™å°†å¯¼è‡´panicã€‚</p></li><li><p>IsSuperset(other Set) boolï¼šåˆ¤æ–­å‚æ•°setæ˜¯å¦ä¸ºå½“å‰setçš„å­é›†ï¼ˆåŒ…å«ï¼Œå…è®¸ç›¸ç­‰ï¼‰ã€‚æ³¨æ„ï¼šå…¥å‚çš„setç±»å‹ä¸æ–¹æ³•æ¥å—è€…setçš„ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™å°†å¯¼è‡´panicã€‚</p></li><li><p>Each(func(interface{}) bool)ï¼šéå†å…ƒç´ ï¼Œå¹¶å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¼ é€’çš„funcã€‚å¦‚æœä¼ é€’çš„funcè¿”å›trueï¼Œåˆ™æ­¤æ—¶åœæ­¢è¿­ä»£ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//clone a</span><br>b := NewSet()<br>a.Each(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(elem <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> <span class="hljs-type">bool</span> &#123;<br>    b.Add(elem)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;)<br></code></pre></td></tr></table></figure></li><li><p>Iter() &lt;-chan interface{}ï¼šè¿”å›ä¸€ä¸ªå¯ä»¥éå†setçš„channel</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">b := NewSet()<br><span class="hljs-keyword">for</span> val := <span class="hljs-keyword">range</span> a.Iter() &#123;<br>    b.Add(val)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>Iterator() *Iteratorï¼šè¿”å›ä¸€ä¸ªIteratorå¯¹è±¡ï¼Œç”¨äºéå†setçš„å…¨éƒ¨å‚æ•°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">b := NewThreadUnsafeSet()<br><span class="hljs-keyword">for</span> val := <span class="hljs-keyword">range</span> a.Iterator().C &#123;<br>    b.Add(val)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>Remove(i interface{}) :ä»å½“å‰é›†åˆä¸­ç§»é™¤æŸä¸ªå…ƒç´ </p></li><li><p>String() stringï¼šè¿”å›é›†åˆçš„stringæ ¼å¼ï¼Œset:{}ç”¨äºæŸ¥çœ‹è¯¥é›†åˆ</p></li><li><p>SymmetricDifference(other Set) Setï¼šè¿”å›å½“å‰é›†åˆä¸å‚æ•°é›†åˆçš„å¯¹ç§°å·®é›†ï¼ˆå¯¹ç§°å·®é›†ä¸­çš„å…ƒç´ è¦ä¹ˆåŒ…å«äºæœ¬é›†åˆï¼Œè¦ä¹ˆåŒ…å«äºå‚æ•°é›†åˆï¼Œä½†æ˜¯ä¸èƒ½å±äºä¸¤è€…çš„äº¤é›†ï¼‰ã€‚æ³¨æ„ï¼šå…¥å‚çš„setç±»å‹ä¸æ–¹æ³•æ¥å—è€…setçš„ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™å°†å¯¼è‡´panicã€‚</p></li><li><p>Union(other Set) Setï¼šè¿”å›å½“å‰é›†åˆä¸å‚æ•°é›†åˆçš„å¹¶é›†ã€‚æ³¨æ„ï¼šå…¥å‚çš„setç±»å‹ä¸æ–¹æ³•æ¥å—è€…setçš„ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™å°†å¯¼è‡´panicã€‚</p></li><li><p>Pop() interface{}ï¼šç§»é™¤å¹¶è¿”å›ä¸€ä¸ªéšæœºçš„å…ƒç´ </p></li><li><p>PowerSet() Setï¼šè¿”å›å½“å‰é›†åˆçš„å…¨éƒ¨å­é›†</p></li><li><p>CartesianProduct(other Set) Setï¼šè¿”å›å½“å‰é›†åˆä¸å‚æ•°é›†åˆçš„ç¬›å¡å°”ç§¯ç»“æœé›†åˆ</p></li><li><p>ToSlice() []interface{}ï¼šè¿”å›å½“å‰é›†åˆçš„åˆ‡ç‰‡å¯¹è±¡ã€‚</p></li></ul><h3 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h3><p>ç”±ä¸Šæ–‡å¯çŸ¥ï¼Œgolang-setæä¾›äº†æ™®é€šå’Œçº¿ç¨‹å®‰å…¨ä¸¤ç§ç±»å‹çš„é›†åˆå¯¹è±¡ã€‚å…¶ä¸­çº¿ç¨‹å®‰å…¨çš„é›†åˆå¯¹è±¡ï¼Œé€šè¿‡ç»“æ„åµŒå¥—çš„æ–¹å¼ä¸ºæ™®é€šé›†åˆå¯¹è±¡æ–°å¢äº†ä¸€ä¸ªå…¨å±€é”ï¼Œå®ç°äº†çº¿ç¨‹å®‰å…¨ã€‚å› æ­¤é’ˆå¯¹æ–¹æ³•çš„å®ç°ä¸»è¦é€šè¿‡æ™®é€šé›†åˆå¯¹è±¡çš„å®ç°æ¥ä»‹ç»ã€‚</p><p>golang-setåŒ…çš„å…·ä½“å®ç°å…¶å®éå¸¸ç®€å•ï¼ŒåŸºäºgolang-setåŸç”Ÿçš„mapç»“æ„ä½œä¸ºåŸºæœ¬çš„å­˜å‚¨ç»“æ„ï¼Œvalueä»¥ä¸€ä¸ªä¸å ç”¨å†…å­˜ç©ºé—´çš„struct{}{}ä¸ºå€¼ã€‚å…¶ä¸­ä¸€ä¸ªæˆ‘è®¤ä¸ºå€¼å¾—æˆ‘ä»¬å€Ÿé‰´çš„å¼€å‘æŠ€å·§å°±æ˜¯golang-setçš„éå†æ–¹æ³•ï¼Œå…·ä½“æºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(set *threadUnsafeSet)</span></span> Iter() &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">interface</span>&#123;&#125; &#123;<br>    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">interface</span>&#123;&#125;)<br>    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>        <span class="hljs-keyword">for</span> elem := <span class="hljs-keyword">range</span> *set &#123;<br>            ch &lt;- elem<br>        &#125;<br>        <span class="hljs-built_in">close</span>(ch)<br>    &#125;()<br><br>    <span class="hljs-keyword">return</span> ch<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ƒé€šè¿‡åˆ›å»ºä¸€ä¸ªåç¨‹å»éå†setå¯¹è±¡ï¼ŒåŒæ—¶è¿”å›ä¸€ä¸ªchannel ç”±ç”¨æˆ·å»è¯»å–setçš„éå†ç»“æœï¼Œæ˜¯çš„è¯»å–è¾ƒå¤§setå¯¹è±¡æ—¶ï¼Œç”¨æˆ·æ— éœ€ç­‰å¾…ï¼Œè€Œç›´æ¥è¯»å–ï¼Œå…·æœ‰è¾ƒé«˜çš„æ•ˆç‡ï¼Œä½†æ˜¯ä»–çš„ç¼ºç‚¹ä¹Ÿååˆ†æ˜æ˜¾ï¼Œé‚£å°±æ˜¯è¿™ä¸ªæ–¹å¼æ— æ³•ä¸­é€”é€€å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä½¿ç”¨è¯¥æ–¹æ³•éå†æ—¶ï¼Œç”¨æˆ·å¿…é¡»ä¿è¯ä¼šæ‰§è¡Œå®Œå…¨éƒ¨çš„éå†ç»“æœã€‚å¦åˆ™ï¼Œç”±äºè¿”å›çš„channelæ˜¯æ— ç¼“å†²çš„channel,ç”¨æˆ·ä¸è¯»å–æ—¶ï¼ŒIterator()æ–¹æ³•ä¸­çš„éå†åç¨‹å°†é˜»å¡ï¼Œè€Œæ— æ³•é€€å‡ºï¼Œå°±ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œ</p><p>ä¸ºäº†æ–¹ä¾¿éå†æ–¹æ³•çš„ä¸­é€”é€€å‡ºï¼Œgolang-setåˆæä¾›äº†å¦å¤–ä¸€ä¸ªéå†æ–¹æ³•ï¼Œé€šè¿‡è¿”å›ä¸€ä¸ªç¾æšä¸¾å¯¹è±¡æ¥å®ç°setå¯¹è±¡çš„å¼‚æ­¥éå†ã€‚å…·ä½“æºç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> Iterator <span class="hljs-keyword">struct</span> &#123;<br>    C    &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">interface</span>&#123;&#125;<br>    stop <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newIterator</span><span class="hljs-params">()</span></span> (*Iterator, <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-keyword">interface</span>&#123;&#125;, &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;) &#123;<br>    itemChan := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">interface</span>&#123;&#125;)<br>    stopChan := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)<br>    <span class="hljs-keyword">return</span> &amp;Iterator&#123;<br>        C:    itemChan,<br>        stop: stopChan,<br>    &#125;, itemChan, stopChan<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(set *threadUnsafeSet)</span></span> Iterator() *Iterator &#123;<br>    iterator, ch, stopCh := newIterator()<br><br>    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>    L:<br>        <span class="hljs-keyword">for</span> elem := <span class="hljs-keyword">range</span> *set &#123;<br>            <span class="hljs-keyword">select</span> &#123;<br>            <span class="hljs-keyword">case</span> &lt;-stopCh:<br>                <span class="hljs-keyword">break</span> L<br>            <span class="hljs-keyword">case</span> ch &lt;- elem:<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">close</span>(ch)<br>    &#125;()<br><br>    <span class="hljs-keyword">return</span> iterator<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­æšä¸¾å¯¹è±¡Iteratorä¸­çš„C channelç”¨äºå¼‚æ­¥è¯»å–éå†ç»“æœï¼Œstop channelç”¨äºä¸»åŠ¨åœæ­¢éå†åç¨‹ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼ã€‚å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs golang">it := a.Iterator()<br><br><span class="hljs-keyword">for</span> v := <span class="hljs-keyword">range</span> it.C &#123;<br>    <span class="hljs-comment">//é€€å‡ºæ¡ä»¶</span><br>    <span class="hljs-keyword">if</span> (v == <span class="hljs-number">10</span>)&#123;<br>        it.stop()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="gopsutil"><a href="#gopsutil" class="headerlink" title="gopsutil"></a>gopsutil</h2><p>gopsutilæ˜¯psutilçš„goè¯­è¨€ç‰ˆæœ¬å®ç°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è·å–ç³»ç»Ÿä¸Šå„é¡¹ç›‘æ§ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸é™äºcpu,å†…å­˜ï¼Œç£ç›˜ï¼Œç½‘ç»œï¼Œè¿›ç¨‹ï¼Œdockerç­‰ç­‰</p><p>gopsutilæ”¯æŒè·¨å¹³å°å¤šæ¶æ„ï¼ŒåŒ…æ‹¬i386&#x2F;amd64&#x2F;armæ¶æ„ï¼Œä»¥åŠwindows,linuxç­‰å„ç§ç³»ç»Ÿï¼Œå…¶ä¸­å¯¹linuxçš„æ”¯æŒé¡¹æœ€å¤š</p><p>gopsutilæœ€æ–°ä¸ºv3ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯v2ç‰ˆæœ¬</p><h3 id="å¿«é€Ÿä½¿ç”¨-4"><a href="#å¿«é€Ÿä½¿ç”¨-4" class="headerlink" title="å¿«é€Ÿä½¿ç”¨"></a>å¿«é€Ÿä½¿ç”¨</h3><p>å®‰è£…</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">go</span> <span class="hljs-built_in">get</span> github.<span class="hljs-keyword">com</span>/shirou/gopsutil<br></code></pre></td></tr></table></figure><p>ç”±äº<code>gopsutil</code>åº“ç”¨åˆ°äº†<code>golang.org/x/sys</code>ï¼Œåè€…åœ¨å¢™å¤–ï¼Œå¦‚æœæœ‰ç±»ä¼¼ä¸‹é¢çš„æŠ¥é”™ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">cannot find <span class="hljs-keyword">package</span> <span class="hljs-string">&quot;golang.org/x/sys/windows&quot;</span><br></code></pre></td></tr></table></figure><p>å¯ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä¸‹è½½<code>golang.org/x/sys</code>åœ¨ GitHub ä¸Šçš„é•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> git@github.com:golang/sys.git <span class="hljs-variable">$GOPATH</span>/src/golang.org/x/sys<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>  <span class="hljs-string">&quot;fmt&quot;</span><br><br>  <span class="hljs-string">&quot;github.com/shirou/gopsutil/mem&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  v, _ := mem.VirtualMemory()<br><br>  fmt.Printf(<span class="hljs-string">&quot;Total: %v, Available: %v, UsedPercent:%f%%\n&quot;</span>, v.Total, v.Available, v.UsedPercent)<br><br>  fmt.Println(v)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>gopsutil</code>å°†ä¸åŒçš„åŠŸèƒ½åˆ’åˆ†åˆ°ä¸åŒçš„å­åŒ…ä¸­ï¼š</p><ul><li><code>cpu</code>ï¼šCPU ç›¸å…³ï¼›</li><li><code>disk</code>ï¼šç£ç›˜ç›¸å…³ï¼›</li><li><code>docker</code>ï¼šdocker ç›¸å…³ï¼›</li><li><code>host</code>ï¼šä¸»æœºç›¸å…³ï¼›</li><li><code>mem</code>ï¼šå†…å­˜ç›¸å…³ï¼›</li><li><code>net</code>ï¼šç½‘ç»œç›¸å…³ï¼›</li><li><code>process</code>ï¼šè¿›ç¨‹ç›¸å…³ï¼›</li><li><code>winservices</code>ï¼šWindows æœåŠ¡ç›¸å…³ã€‚</li></ul><p>æƒ³è¦ä½¿ç”¨å¯¹åº”çš„åŠŸèƒ½ï¼Œè¦å¯¼å…¥å¯¹åº”çš„å­åŒ…ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¦è·å–å†…å­˜ä¿¡æ¯ï¼Œå¯¼å…¥çš„æ˜¯<code>mem</code>å­åŒ…ã€‚<code>mem.VirtualMemory()</code>æ–¹æ³•è¿”å›å†…å­˜ä¿¡æ¯ç»“æ„<code>mem.VirtualMemoryStat</code>ï¼Œè¯¥ç»“æ„æœ‰ä¸°å¯Œçš„å­—æ®µï¼Œæˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„æ— å¤–ä¹<code>Total</code>ï¼ˆæ€»å†…å­˜ï¼‰ã€<code>Available</code>ï¼ˆå¯ç”¨å†…å­˜ï¼‰ã€<code>Used</code>ï¼ˆå·²ä½¿ç”¨å†…å­˜ï¼‰å’Œ<code>UsedPercent</code>ï¼ˆå†…å­˜ä½¿ç”¨ç™¾åˆ†æ¯”ï¼‰ã€‚<code>mem.VirtualMemoryStat</code>è¿˜å®ç°äº†<code>fmt.Stringer</code>æ¥å£ï¼Œä»¥ JSON æ ¼å¼è¿”å›å†…å­˜ä¿¡æ¯ã€‚è¯­å¥<code>fmt.Println(v)</code>ä¼šè‡ªåŠ¨è°ƒç”¨<code>v.String()</code>ï¼Œå°†è¿”å›ä¿¡æ¯è¾“å‡ºã€‚ç¨‹åºè¾“å‡ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">Total: <span class="hljs-number">31252709376</span>, Available: <span class="hljs-number">18457317376</span>, UsedPercent:<span class="hljs-number">36.622837</span>%<br>&#123;<span class="hljs-string">&quot;total&quot;</span>:<span class="hljs-number">31252709376</span>,<span class="hljs-string">&quot;available&quot;</span>:<span class="hljs-number">18457317376</span>,<span class="hljs-string">&quot;used&quot;</span>:<span class="hljs-number">11445628928</span>,<span class="hljs-string">&quot;usedPercent&quot;</span>:<span class="hljs-number">36.62283736842822</span>,<span class="hljs-string">&quot;free&quot;</span>:<span class="hljs-number">3926921216</span>,<span class="hljs-string">&quot;active&quot;</span>:<span class="hljs-number">16073904128</span>,<span class="hljs-string">&quot;inactive&quot;</span>:<span class="hljs-number">9631600640</span>,<span class="hljs-string">&quot;wired&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;laundry&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;buffers&quot;</span>:<span class="hljs-number">991232000</span>,<span class="hljs-string">&quot;cached&quot;</span>:<span class="hljs-number">14888927232</span>,<span class="hljs-string">&quot;writeback&quot;</span>:<span class="hljs-number">4096</span>,<span class="hljs-string">&quot;dirty&quot;</span>:<span class="hljs-number">66256896</span>,<span class="hljs-string">&quot;writebacktmp&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;shared&quot;</span>:<span class="hljs-number">891125760</span>,<span class="hljs-string">&quot;slab&quot;</span>:<span class="hljs-number">1062789120</span>,<span class="hljs-string">&quot;sreclaimable&quot;</span>:<span class="hljs-number">760090624</span>,<span class="hljs-string">&quot;sunreclaim&quot;</span>:<span class="hljs-number">302698496</span>,<span class="hljs-string">&quot;pagetables&quot;</span>:<span class="hljs-number">108027904</span>,<span class="hljs-string">&quot;swapcached&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;commitlimit&quot;</span>:<span class="hljs-number">47626792960</span>,<span class="hljs-string">&quot;committedas&quot;</span>:<span class="hljs-number">38288269312</span>,<span class="hljs-string">&quot;hightotal&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;highfree&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;lowtotal&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;lowfree&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;swaptotal&quot;</span>:<span class="hljs-number">32000438272</span>,<span class="hljs-string">&quot;swapfree&quot;</span>:<span class="hljs-number">32000438272</span>,<span class="hljs-string">&quot;mapped&quot;</span>:<span class="hljs-number">3175104512</span>,<span class="hljs-string">&quot;vmalloctotal&quot;</span>:<span class="hljs-number">35184372087808</span>,<span class="hljs-string">&quot;vmallocused&quot;</span>:<span class="hljs-number">100999168</span>,<span class="hljs-string">&quot;vmallocchunk&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;hugepagestotal&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;hugepagesfree&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;hugepagesize&quot;</span>:<span class="hljs-number">2097152</span>&#125;<br></code></pre></td></tr></table></figure><p>å•ä½ä¸ºå­—èŠ‚ï¼Œæˆ‘çš„ç”µè„‘å†…å­˜ 32GBï¼Œå½“å‰ä½¿ç”¨ç™¾åˆ†æ¯”ä¸º 36%ï¼Œå¯ç”¨å†…å­˜ 18457317376ï¼ˆå³ 18GBï¼‰ã€‚</p><h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><p>æˆ‘ä»¬çŸ¥é“ CPU çš„æ ¸æ•°æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç‰©ç†æ ¸æ•°ï¼Œä¸€ç§æ˜¯é€»è¾‘æ ¸æ•°ã€‚ç‰©ç†æ ¸æ•°å°±æ˜¯ä¸»æ¿ä¸Šå®é™…æœ‰å¤šå°‘ä¸ª CPUï¼Œä¸€ä¸ªç‰©ç† CPU ä¸Šå¯ä»¥æœ‰å¤šä¸ªæ ¸å¿ƒï¼Œè¿™äº›æ ¸å¿ƒè¢«ç§°ä¸ºé€»è¾‘æ ¸ã€‚<code>gopsutil</code>ä¸­ CPU ç›¸å…³åŠŸèƒ½åœ¨<code>cpu</code>å­åŒ…ä¸­ï¼Œ<code>cpu</code>å­åŒ…æä¾›äº†è·å–ç‰©ç†å’Œé€»è¾‘æ ¸æ•°ã€CPU ä½¿ç”¨ç‡çš„æ¥å£ï¼š</p><p><code>Counts(logical bool)</code>ï¼šä¼ å…¥<code>false</code>ï¼Œè¿”å›ç‰©ç†æ ¸æ•°ï¼Œä¼ å…¥<code>true</code>ï¼Œè¿”å›é€»è¾‘æ ¸æ•°ï¼›</p><p><code>Percent(interval time.Duration, percpu bool)</code>ï¼šè¡¨ç¤ºè·å–<code>interval</code>æ—¶é—´é—´éš”å†…çš„ CPU ä½¿ç”¨ç‡ï¼Œ<code>percpu</code>ä¸º<code>false</code>æ—¶ï¼Œè·å–æ€»çš„ CPU ä½¿ç”¨ç‡ï¼Œ<code>percpu</code>ä¸º<code>true</code>æ—¶ï¼Œåˆ†åˆ«è·å–æ¯ä¸ª CPU çš„ä½¿ç”¨ç‡ï¼Œè¿”å›ä¸€ä¸ª<code>[]float64</code>ç±»å‹çš„å€¼ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  physicalCnt, _ := cpu.Counts(<span class="hljs-literal">false</span>)<br>  logicalCnt, _ := cpu.Counts(<span class="hljs-literal">true</span>)<br>  fmt.Printf(<span class="hljs-string">&quot;physical count:%d logical count:%d\n&quot;</span>, physicalCnt, logicalCnt)<br><br>  totalPercent, _ := cpu.Percent(<span class="hljs-number">3</span>*time.Second, <span class="hljs-literal">false</span>)<br>  perPercents, _ := cpu.Percent(<span class="hljs-number">3</span>*time.Second, <span class="hljs-literal">true</span>)<br>  fmt.Printf(<span class="hljs-string">&quot;total percent:%v per percents:%v&quot;</span>, totalPercent, perPercents)<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç è·å–ç‰©ç†æ ¸æ•°å’Œé€»è¾‘æ ¸æ•°ï¼Œå¹¶è·å– 3s å†…çš„æ€» CPU ä½¿ç”¨ç‡å’Œæ¯ä¸ª CPU å„è‡ªçš„ä½¿ç”¨ç‡ï¼Œç¨‹åºè¾“å‡ºï¼ˆæ³¨æ„æ¯æ¬¡è¿è¡Œè¾“å‡ºå¯èƒ½éƒ½ä¸ç›¸åŒï¼‰ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">physical count:<span class="hljs-number">8</span> logical count:<span class="hljs-number">16</span><br>total percent:[<span class="hljs-number">8.362730856991261</span>] per percents:[<span class="hljs-number">12.012987012975508</span> <span class="hljs-number">8.524590163938532</span> <span class="hljs-number">11.038961038943015</span> <span class="hljs-number">6.249999999988781</span> <span class="hljs-number">8.47457627121518</span> <span class="hljs-number">5.050505050493915</span> <span class="hljs-number">8.813559322011011</span> <span class="hljs-number">4.745762711875798</span> <span class="hljs-number">5.479452054789401</span> <span class="hljs-number">9.427609427602931</span> <span class="hljs-number">6.802721088430114</span> <span class="hljs-number">6.020066889640449</span> <span class="hljs-number">9.897610921502555</span> <span class="hljs-number">3.7542662116080683</span> <span class="hljs-number">8.135593220332085</span> <span class="hljs-number">5.4054054054020835</span>]<br></code></pre></td></tr></table></figure><p><strong>è¯¦ç»†ä¿¡æ¯</strong></p><p>è°ƒç”¨<code>cpu.Info()</code>å¯è·å– CPU çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿”å›<code>[]cpu.InfoStat</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  infos, _ := cpu.Info()<br>  <span class="hljs-keyword">for</span> _, info := <span class="hljs-keyword">range</span> infos &#123;<br>    data, _ := json.MarshalIndent(info, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot; &quot;</span>)<br>    fmt.Print(<span class="hljs-type">string</span>(data))<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ‘ä½¿ç”¨ JSON è¾“å‡ºç»“æœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br> <span class="hljs-attr">&quot;cpu&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;vendorId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GenuineIntel&quot;</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;family&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;198&quot;</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;stepping&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;physicalId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;BFEBFBFF000906E9&quot;</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;coreId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;cores&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;modelName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Intel(R) Core(TM) i7-7700 CPU @ 3.60GHz&quot;</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;mhz&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3601</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;cacheSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;flags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;microcode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ç”±ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒCPU æ˜¯ Intel çš„ i7-7700 ç³»åˆ—ï¼Œé¢‘ç‡ 3.60GHzã€‚ä¸Šé¢æ˜¯æˆ‘åœ¨ Windows ä¸Šè¿è¡Œçš„è¿”å›ç»“æœï¼Œå†…éƒ¨ä½¿ç”¨äº†<code>github.com/StackExchange/wmi</code>åº“ã€‚åœ¨ Linux ä¸‹æ¯ä¸ªé€»è¾‘ CPU éƒ½ä¼šè¿”å›ä¸€ä¸ª<code>InfoStat</code>ç»“æ„ã€‚</p><p><strong>æ—¶é—´å ç”¨</strong></p><p>è°ƒç”¨<code>cpu.Times(percpu bool)</code>å¯ä»¥è·å–ä»å¼€æœºç®—èµ·ï¼Œæ€» CPU å’Œ æ¯ä¸ªå•ç‹¬çš„ CPU æ—¶é—´å ç”¨æƒ…å†µã€‚ä¼ å…¥<code>percpu=false</code>è¿”å›æ€»çš„ï¼Œä¼ å…¥<code>percpu=true</code>è¿”å›å•ä¸ªçš„ã€‚æ¯ä¸ª CPU æ—¶é—´å ç”¨æƒ…å†µæ˜¯ä¸€ä¸ª<code>TimeStat</code>ç»“æ„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// src/github.com/shirou/gopsutil/cpu/cpu.go</span><br><span class="hljs-keyword">type</span> TimesStat <span class="hljs-keyword">struct</span> &#123;<br>  CPU       <span class="hljs-type">string</span>  <span class="hljs-string">`json:&quot;cpu&quot;`</span><br>  User      <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;user&quot;`</span><br>  System    <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;system&quot;`</span><br>  Idle      <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;idle&quot;`</span><br>  Nice      <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;nice&quot;`</span><br>  Iowait    <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;iowait&quot;`</span><br>  Irq       <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;irq&quot;`</span><br>  Softirq   <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;softirq&quot;`</span><br>  Steal     <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;steal&quot;`</span><br>  Guest     <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;guest&quot;`</span><br>  GuestNice <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;guestNice&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>CPU</code>ï¼šCPU æ ‡è¯†ï¼Œå¦‚æœæ˜¯æ€»çš„ï¼Œè¯¥å­—æ®µä¸º<code>cpu-total</code>ï¼Œå¦åˆ™ä¸º<code>cpu0</code>ã€<code>cpu1</code>â€¦ï¼›</li><li><code>User</code>ï¼šç”¨æˆ·æ—¶é—´å ç”¨ï¼ˆç”¨æˆ·æ€ï¼‰ï¼›</li><li><code>System</code>ï¼šç³»ç»Ÿæ—¶é—´å ç”¨ï¼ˆå†…æ ¸æ€ï¼‰ï¼›</li><li><code>Idle</code>ï¼šç©ºé—²æ—¶é—´ï¼›</li><li>â€¦</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  infos, _ := cpu.Times(<span class="hljs-literal">true</span>)<br>  <span class="hljs-keyword">for</span> _, info := <span class="hljs-keyword">range</span> infos &#123;<br>    data, _ := json.MarshalIndent(info, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot; &quot;</span>)<br>    fmt.Print(<span class="hljs-type">string</span>(data))<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ‘ç”¨ JSON è¾“å‡ºç»“æœï¼Œä¸‹é¢æ˜¯å…¶ä¸­ä¸€ä¸ªè¾“å‡ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go">&#123;<br> <span class="hljs-string">&quot;cpu&quot;</span>: <span class="hljs-string">&quot;cpu0&quot;</span>,<br> <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-number">674.46875</span>,<br> <span class="hljs-string">&quot;system&quot;</span>: <span class="hljs-number">1184.984375</span>,<br> <span class="hljs-string">&quot;idle&quot;</span>: <span class="hljs-number">7497.1875</span>,<br> <span class="hljs-string">&quot;nice&quot;</span>: <span class="hljs-number">0</span>,<br> <span class="hljs-string">&quot;iowait&quot;</span>: <span class="hljs-number">0</span>,<br> <span class="hljs-string">&quot;irq&quot;</span>: <span class="hljs-number">75.578125</span>,<br> <span class="hljs-string">&quot;softirq&quot;</span>: <span class="hljs-number">0</span>,<br> <span class="hljs-string">&quot;steal&quot;</span>: <span class="hljs-number">0</span>,<br> <span class="hljs-string">&quot;guest&quot;</span>: <span class="hljs-number">0</span>,<br> <span class="hljs-string">&quot;guestNice&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç£ç›˜"><a href="#ç£ç›˜" class="headerlink" title="ç£ç›˜"></a>ç£ç›˜</h3><p>å­åŒ…<code>disk</code>ç”¨äºè·å–ç£ç›˜ä¿¡æ¯ã€‚<code>disk</code>å¯è·å– IO ç»Ÿè®¡ã€åˆ†åŒºå’Œä½¿ç”¨ç‡ä¿¡æ¯ã€‚ä¸‹é¢ä¾æ¬¡ä»‹ç»ã€‚</p><p><strong>IO ç»Ÿè®¡</strong></p><p>è°ƒç”¨<code>disk.IOCounters()</code>å‡½æ•°ï¼Œè¿”å›çš„ IO ç»Ÿè®¡ä¿¡æ¯ç”¨<code>map[string]IOCountersStat</code>ç±»å‹è¡¨ç¤ºã€‚æ¯ä¸ªåˆ†åŒºä¸€ä¸ªç»“æ„ï¼Œé”®ä¸ºåˆ†åŒºåï¼Œå€¼ä¸ºç»Ÿè®¡ä¿¡æ¯ã€‚è¿™é‡Œæ‘˜å–ç»Ÿè®¡ç»“æ„çš„éƒ¨åˆ†å­—æ®µï¼Œä¸»è¦æœ‰è¯»å†™çš„æ¬¡æ•°ã€å­—èŠ‚æ•°å’Œæ—¶é—´ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// src/github.com/shirou/gopsutil/disk/disk.go</span><br><span class="hljs-keyword">type</span> IOCountersStat <span class="hljs-keyword">struct</span> &#123;<br>  ReadCount        <span class="hljs-type">uint64</span> <span class="hljs-string">`json:&quot;readCount&quot;`</span><br>  MergedReadCount  <span class="hljs-type">uint64</span> <span class="hljs-string">`json:&quot;mergedReadCount&quot;`</span><br>  WriteCount       <span class="hljs-type">uint64</span> <span class="hljs-string">`json:&quot;writeCount&quot;`</span><br>  MergedWriteCount <span class="hljs-type">uint64</span> <span class="hljs-string">`json:&quot;mergedWriteCount&quot;`</span><br>  ReadBytes        <span class="hljs-type">uint64</span> <span class="hljs-string">`json:&quot;readBytes&quot;`</span><br>  WriteBytes       <span class="hljs-type">uint64</span> <span class="hljs-string">`json:&quot;writeBytes&quot;`</span><br>  ReadTime         <span class="hljs-type">uint64</span> <span class="hljs-string">`json:&quot;readTime&quot;`</span><br>  WriteTime        <span class="hljs-type">uint64</span> <span class="hljs-string">`json:&quot;writeTime&quot;`</span><br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  mapStat, _ := disk.IOCounters()<br>  <span class="hljs-keyword">for</span> name, stat := <span class="hljs-keyword">range</span> mapStat &#123;<br>    fmt.Println(name)<br>    data, _ := json.MarshalIndent(stat, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;  &quot;</span>)<br>    fmt.Println(<span class="hljs-type">string</span>(data))<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºåŒ…æ‹¬æ‰€æœ‰åˆ†åŒºï¼Œæˆ‘è¿™é‡Œåªå±•ç¤ºä¸€ä¸ªï¼š</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-symbol">nvme0</span><span class="hljs-symbol">n1</span>p<span class="hljs-number">3</span><br>&#123;<br>  <span class="hljs-string">&quot;readCount&quot;</span>: <span class="hljs-number">48</span>,<br>  <span class="hljs-string">&quot;mergedReadCount&quot;</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-string">&quot;writeCount&quot;</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-string">&quot;mergedWriteCount&quot;</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-string">&quot;readBytes&quot;</span>: <span class="hljs-number">598016</span>,<br>  <span class="hljs-string">&quot;writeBytes&quot;</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-string">&quot;readTime&quot;</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-string">&quot;writeTime&quot;</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-string">&quot;iopsInProgress&quot;</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-string">&quot;ioTime&quot;</span>: <span class="hljs-number">12</span>,<br>  <span class="hljs-string">&quot;weightedIO&quot;</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;nvme0n1p3&quot;</span>,<br>  <span class="hljs-string">&quot;serialNumber&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;label&quot;</span>: <span class="hljs-string">&quot;&quot;</span><br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>disk.IOCounters()</code>å¯ä¼ å…¥å¯å˜æ•°é‡çš„å­—ç¬¦ä¸²å‚æ•°ç”¨äºæ ‡è¯†åˆ†åŒºï¼Œ<strong>æ­¤å‚æ•°åœ¨ Windows ä¸Šæ— æ•ˆ</strong>ã€‚</p><p><strong>åˆ†åŒº</strong></p><p>è°ƒç”¨<code>disk.PartitionStat(all bool)</code>å‡½æ•°ï¼Œè¿”å›åˆ†åŒºä¿¡æ¯ã€‚å¦‚æœ<code>all = false</code>ï¼Œåªè¿”å›å®é™…çš„ç‰©ç†åˆ†åŒºï¼ˆåŒ…æ‹¬ç¡¬ç›˜ã€CD-ROMã€USBï¼‰ï¼Œå¿½ç•¥å…¶å®ƒçš„è™šæ‹Ÿåˆ†åŒºã€‚å¦‚æœ<code>all = true</code>åˆ™è¿”å›æ‰€æœ‰çš„åˆ†åŒºã€‚è¿”å›ç±»å‹ä¸º<code>[]PartitionStat</code>ï¼Œæ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ª<code>PartitionStat</code>ç»“æ„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// src/github.com/shirou/gopsutil/disk/</span><br><span class="hljs-keyword">type</span> PartitionStat <span class="hljs-keyword">struct</span> &#123;<br>  Device     <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;device&quot;`</span><br>  Mountpoint <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;mountpoint&quot;`</span><br>  Fstype     <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;fstype&quot;`</span><br>  Opts       <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;opts&quot;`</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p><code>Device</code>ï¼šåˆ†åŒºæ ‡è¯†ï¼Œåœ¨ Windows ä¸Šå³ä¸º<code>C:</code>è¿™ç±»æ ¼å¼ï¼›</p><p><code>Mountpoint</code>ï¼šæŒ‚è½½ç‚¹ï¼Œå³è¯¥åˆ†åŒºçš„æ–‡ä»¶è·¯å¾„èµ·å§‹ä½ç½®ï¼›</p><p><code>Fstype</code>ï¼šæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ŒWindows å¸¸ç”¨çš„æœ‰ FATã€NTFS ç­‰ï¼ŒLinux æœ‰ extã€ext2ã€ext3ç­‰ï¼›</p><p><code>Opts</code>ï¼šé€‰é¡¹ï¼Œä¸ç³»ç»Ÿç›¸å…³ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  infos, _ := disk.Partitions(<span class="hljs-literal">false</span>)<br>  <span class="hljs-keyword">for</span> _, info := <span class="hljs-keyword">range</span> infos &#123;<br>    data, _ := json.MarshalIndent(info, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;  &quot;</span>)<br>    fmt.Println(<span class="hljs-type">string</span>(data))<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºåŒ…æ‹¬æ‰€æœ‰åˆ†åŒºï¼Œæˆ‘è¿™é‡Œåªå±•ç¤ºä¸€ä¸ªï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">&#123;<br>  <span class="hljs-string">&quot;device&quot;</span>: <span class="hljs-string">&quot;/dev/nvme0n1p8&quot;</span>,<br>  <span class="hljs-string">&quot;mountpoint&quot;</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>  <span class="hljs-string">&quot;fstype&quot;</span>: <span class="hljs-string">&quot;ext4&quot;</span>,<br>  <span class="hljs-string">&quot;opts&quot;</span>: <span class="hljs-string">&quot;rw,relatime&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ç‡</strong></p><p>è°ƒç”¨<code>disk.Usage(path string)</code>å³å¯è·å¾—è·¯å¾„<code>path</code>æ‰€åœ¨ç£ç›˜çš„ä½¿ç”¨æƒ…å†µï¼Œè¿”å›ä¸€ä¸ª<code>UsageStat</code>ç»“æ„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// src/github.com/shirou/gopsutil/disk.go</span><br><span class="hljs-keyword">type</span> UsageStat <span class="hljs-keyword">struct</span> &#123;<br>  Path              <span class="hljs-type">string</span>  <span class="hljs-string">`json:&quot;path&quot;`</span><br>  Fstype            <span class="hljs-type">string</span>  <span class="hljs-string">`json:&quot;fstype&quot;`</span><br>  Total             <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;total&quot;`</span><br>  Free              <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;free&quot;`</span><br>  Used              <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;used&quot;`</span><br>  UsedPercent       <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;usedPercent&quot;`</span><br>  InodesTotal       <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;inodesTotal&quot;`</span><br>  InodesUsed        <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;inodesUsed&quot;`</span><br>  InodesFree        <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;inodesFree&quot;`</span><br>  InodesUsedPercent <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;inodesUsedPercent&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>Path</code>ï¼šè·¯å¾„ï¼Œä¼ å…¥çš„å‚æ•°ï¼›</li><li><code>Fstype</code>ï¼šæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼›</li><li><code>Total</code>ï¼šè¯¥åˆ†åŒºæ€»å®¹é‡ï¼›</li><li><code>Free</code>ï¼šç©ºé—²å®¹é‡ï¼›</li><li><code>Used</code>ï¼šå·²ä½¿ç”¨çš„å®¹é‡ï¼›</li><li><code>UsedPercent</code>ï¼šä½¿ç”¨ç™¾åˆ†æ¯”</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  info, _ := disk.Usage(<span class="hljs-string">&quot;/home&quot;</span>)<br>  data, _ := json.MarshalIndent(info, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;  &quot;</span>)<br>  fmt.Println(<span class="hljs-type">string</span>(data))<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±äºè¿”å›çš„æ˜¯ç£ç›˜çš„ä½¿ç”¨æƒ…å†µï¼Œæ‰€ä»¥è·¯å¾„<code>/homeå’Œ/:</code>è¿”å›åŒæ ·çš„ç»“æœï¼Œåªæ˜¯ç»“æ„ä¸­çš„<code>Path</code>å­—æ®µä¸åŒè€Œå·²ã€‚ç¨‹åºè¾“å‡ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go">&#123;<br>  <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>  <span class="hljs-string">&quot;fstype&quot;</span>: <span class="hljs-string">&quot;ext2/ext3&quot;</span>,<br>  <span class="hljs-string">&quot;total&quot;</span>: <span class="hljs-number">665553149952</span>,<br>  <span class="hljs-string">&quot;free&quot;</span>: <span class="hljs-number">535020593152</span>,<br>  <span class="hljs-string">&quot;used&quot;</span>: <span class="hljs-number">96649084928</span>,<br>  <span class="hljs-string">&quot;usedPercent&quot;</span>: <span class="hljs-number">15.300573746356008</span>,<br>  <span class="hljs-string">&quot;inodesTotal&quot;</span>: <span class="hljs-number">41345024</span>,<br>  <span class="hljs-string">&quot;inodesUsed&quot;</span>: <span class="hljs-number">1743985</span>,<br>  <span class="hljs-string">&quot;inodesFree&quot;</span>: <span class="hljs-number">39601039</span>,<br>  <span class="hljs-string">&quot;inodesUsedPercent&quot;</span>: <span class="hljs-number">4.218125499213642</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¸»æœº"><a href="#ä¸»æœº" class="headerlink" title="ä¸»æœº"></a>ä¸»æœº</h3><p>å­åŒ…<code>host</code>å¯ä»¥è·å–ä¸»æœºç›¸å…³ä¿¡æ¯ï¼Œå¦‚å¼€æœºæ—¶é—´ã€å†…æ ¸ç‰ˆæœ¬å·ã€å¹³å°ä¿¡æ¯ç­‰ç­‰</p><p><strong>å¼€æœºæ—¶é—´</strong></p><p><code>host.BootTime()</code>è¿”å›ä¸»æœºå¼€æœºæ—¶é—´çš„æ—¶é—´æˆ³ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  timestamp, _ := host.BootTime()<br>  t := time.Unix(<span class="hljs-type">int64</span>(timestamp), <span class="hljs-number">0</span>)<br>  fmt.Println(t.Local().Format(<span class="hljs-string">&quot;2006-01-02 15:04:05&quot;</span>))<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢å…ˆè·å–å¼€æœºæ—¶é—´ï¼Œç„¶åé€šè¿‡<code>time.Unix()</code>å°†å…¶è½¬ä¸º<code>time.Time</code>ç±»å‹ï¼Œæœ€åè¾“å‡º<code>2006-01-02 15:04:05</code>æ ¼å¼çš„æ—¶é—´ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">2024-08-12 08:54:18<br></code></pre></td></tr></table></figure><p><strong>å†…æ ¸ç‰ˆæœ¬å’Œå¹³å°ä¿¡æ¯</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>version, _ := host.KernelVersion()<br>fmt.Println(version)<br><br>platform, family, version, _ := host.PlatformInformation()<br>fmt.Println(<span class="hljs-string">&quot;platform:&quot;</span>, platform)<br>fmt.Println(<span class="hljs-string">&quot;family:&quot;</span>, family)<br>fmt.Println(<span class="hljs-string">&quot;version:&quot;</span>, version)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œè¾“å‡ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-number">6.5</span><span class="hljs-number">.0</span><span class="hljs-number">-28</span>-generic<br>platform: debian<br>family: debian<br>version: bookworm/sid<br></code></pre></td></tr></table></figure><p><strong>ç»ˆç«¯ç”¨æˆ·</strong></p><p><code>host.Users()</code>è¿”å›ç»ˆç«¯è¿æ¥ä¸Šæ¥çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯ä¸ªç”¨æˆ·ä¸€ä¸ª<code>UserStat</code>ç»“æ„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// src/github.com/shirou/gopsutil/host/host.go</span><br><span class="hljs-keyword">type</span> UserStat <span class="hljs-keyword">struct</span> &#123;<br>  User     <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;user&quot;`</span><br>  Terminal <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;terminal&quot;`</span><br>  Host     <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;host&quot;`</span><br>  Started  <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;started&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å®ä¾‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  users, _ := host.Users()<br>  <span class="hljs-keyword">for</span> _, user := <span class="hljs-keyword">range</span> users &#123;<br>    data, _ := json.MarshalIndent(user, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot; &quot;</span>)<br>    fmt.Println(<span class="hljs-type">string</span>(data))<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">&#123;<br> <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;gond&quot;</span>,<br> <span class="hljs-string">&quot;terminal&quot;</span>: <span class="hljs-string">&quot;tty2&quot;</span>,<br> <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;tty2&quot;</span>,<br> <span class="hljs-string">&quot;started&quot;</span>: <span class="hljs-number">1723424126</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h3><p>åœ¨<code>å¿«é€Ÿä½¿ç”¨</code>ä¸­ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>mem.VirtualMemory()</code>æ¥è·å–å†…å­˜ä¿¡æ¯ã€‚è¯¥å‡½æ•°è¿”å›çš„åªæ˜¯ç‰©ç†å†…å­˜ä¿¡æ¯ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>mem.SwapMemory()</code>è·å–äº¤æ¢å†…å­˜çš„ä¿¡æ¯ï¼Œä¿¡æ¯å­˜å‚¨åœ¨ç»“æ„<code>SwapMemoryStat</code>ä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// src/github.com/shirou/gopsutil/mem/</span><br><span class="hljs-keyword">type</span> SwapMemoryStat <span class="hljs-keyword">struct</span> &#123;<br>  Total       <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;total&quot;`</span><br>  Used        <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;used&quot;`</span><br>  Free        <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;free&quot;`</span><br>  UsedPercent <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;usedPercent&quot;`</span><br>  Sin         <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;sin&quot;`</span><br>  Sout        <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;sout&quot;`</span><br>  PgIn        <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;pgin&quot;`</span><br>  PgOut       <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;pgout&quot;`</span><br>  PgFault     <span class="hljs-type">uint64</span>  <span class="hljs-string">`json:&quot;pgfault&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å­—æ®µå«ä¹‰å¾ˆå®¹æ˜“ç†è§£ï¼Œ<code>PgIn/PgOut/PgFault</code>è¿™ä¸‰ä¸ªå­—æ®µæˆ‘ä»¬é‡ç‚¹ä»‹ç»ä¸€ä¸‹ã€‚äº¤æ¢å†…å­˜æ˜¯ä»¥<strong>é¡µ</strong>ä¸ºå•ä½çš„ï¼Œå¦‚æœå‡ºç°ç¼ºé¡µé”™è¯¯(<code>page fault</code>)ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†ç£ç›˜ä¸­çš„æŸäº›é¡µè½½å…¥å†…å­˜ï¼ŒåŒæ—¶ä¼šæ ¹æ®ç‰¹å®šçš„æœºåˆ¶æ·˜æ±°ä¸€äº›å†…å­˜ä¸­çš„é¡µã€‚<code>PgIn</code>è¡¨å¾è½½å…¥é¡µæ•°ï¼Œ<code>PgOut</code>æ·˜æ±°é¡µæ•°ï¼Œ<code>PgFault</code>ç¼ºé¡µé”™è¯¯æ•°ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  swapMemory, _ := mem.SwapMemory()<br>  data, _ := json.MarshalIndent(swapMemory, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot; &quot;</span>)<br>  fmt.Println(<span class="hljs-type">string</span>(data))<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><p><code>process</code>å¯ç”¨äºè·å–ç³»ç»Ÿå½“å‰è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯ï¼Œåˆ›å»ºæ–°è¿›ç¨‹ï¼Œå¯¹è¿›ç¨‹è¿›è¡Œä¸€äº›æ“ä½œç­‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">var</span> rootProcess *process.Process<br>  processes, _ := process.Processes()<br>  <span class="hljs-keyword">for</span> _, p := <span class="hljs-keyword">range</span> processes &#123;<br>    <span class="hljs-keyword">if</span> p.Pid == <span class="hljs-number">0</span> &#123;<br>      rootProcess = p<br>      <span class="hljs-keyword">break</span><br>    &#125;<br>  &#125;<br><br>  fmt.Println(rootProcess)<br><br>  fmt.Println(<span class="hljs-string">&quot;children:&quot;</span>)<br>  children, _ := rootProcess.Children()<br>  <span class="hljs-keyword">for</span> _, p := <span class="hljs-keyword">range</span> children &#123;<br>    fmt.Println(p)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆè°ƒç”¨<code>process.Processes()</code>è·å–å½“å‰ç³»ç»Ÿä¸­è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ï¼Œç„¶åæ‰¾åˆ°<code>Pid</code>ä¸º 0 çš„è¿›ç¨‹ï¼Œå³æ“ä½œç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œæœ€åè°ƒç”¨<code>Children()</code>è¿”å›å…¶å­è¿›ç¨‹ã€‚è¿˜æœ‰å¾ˆå¤šæ–¹æ³•å¯è·å–è¿›ç¨‹ä¿¡æ¯ï¼Œæ„Ÿå…´è¶£å¯æŸ¥çœ‹æ–‡æ¡£äº†è§£</p><h2 id="ants-åç¨‹æ± "><a href="#ants-åç¨‹æ± " class="headerlink" title="ants(åç¨‹æ± )"></a>ants(åç¨‹æ± )</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>å¤„ç†å¤§é‡å¹¶å‘æ˜¯ Go è¯­è¨€çš„ä¸€å¤§ä¼˜åŠ¿ã€‚è¯­è¨€å†…ç½®äº†æ–¹ä¾¿çš„å¹¶å‘è¯­æ³•ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„åˆ›å»ºå¾ˆå¤šä¸ªè½»é‡çº§çš„ goroutine å¹¶å‘å¤„ç†ä»»åŠ¡ã€‚ç›¸æ¯”äºåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œgoroutine æ›´è½»é‡ã€èµ„æºå ç”¨æ›´å°‘ã€åˆ‡æ¢é€Ÿåº¦æ›´å¿«ã€æ— çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€æ›´å°‘ã€‚ä½†æ˜¯å—é™äºèµ„æºæ€»é‡ï¼Œç³»ç»Ÿä¸­èƒ½å¤Ÿåˆ›å»ºçš„ goroutine æ•°é‡ä¹Ÿæ˜¯å—é™çš„ã€‚é»˜è®¤æ¯ä¸ª goroutine å ç”¨ 8KB å†…å­˜ï¼Œä¸€å° 8GB å†…å­˜çš„æœºå™¨æ»¡æ‰“æ»¡ç®—ä¹Ÿåªèƒ½åˆ›å»º 8GB&#x2F;8KB &#x3D; 1000000 ä¸ª goroutineï¼Œæ›´ä½•å†µç³»ç»Ÿè¿˜éœ€è¦ä¿ç•™ä¸€éƒ¨åˆ†å†…å­˜è¿è¡Œæ—¥å¸¸ç®¡ç†ä»»åŠ¡ï¼Œgo è¿è¡Œæ—¶éœ€è¦å†…å­˜è¿è¡Œ gcã€å¤„ç† goroutine åˆ‡æ¢ç­‰ã€‚ä½¿ç”¨çš„å†…å­˜è¶…è¿‡æœºå™¨å†…å­˜å®¹é‡ï¼Œç³»ç»Ÿä¼šä½¿ç”¨äº¤æ¢åŒºï¼ˆswapï¼‰ï¼Œå¯¼è‡´æ€§èƒ½æ€¥é€Ÿä¸‹é™</p><h3 id="å¿«é€Ÿä½¿ç”¨-5"><a href="#å¿«é€Ÿä½¿ç”¨-5" class="headerlink" title="å¿«é€Ÿä½¿ç”¨"></a>å¿«é€Ÿä½¿ç”¨</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span> get -u github.com/panjf2000/ants/v2<br></code></pre></td></tr></table></figure><p>antsçš„ä½¿ç”¨æœ‰å››ç§æ–¹å¼ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240904161834137.png?raw=true" alt="image-20240904161834137"></p><p>è¿™å››ç§ä½¿ç”¨æ–¹å¼ï¼Œå‰ä¸¤ç§æœ€å¸¸ç”¨ï¼ŒåŸºæœ¬èƒ½æ»¡è¶³æ—¥å¸¸ç³»ç»Ÿçš„å¼€å‘éœ€è¦ï¼Œç¬¬å››ç§é»˜è®¤æ± ï¼Œç®€å•çš„åœºæ™¯ä¹Ÿå¯ä»¥ç”¨ï¼Œä½†ä¸æ¨èï¼Œå¤šæ± çš„æƒ…å†µè¿˜æ²¡æƒ³åˆ°ç‰¹åˆ«åˆé€‚çš„åº”ç”¨åœºæ™¯ã€‚</p><h3 id="ä½¿ç”¨æ–¹å¼è¯¦è§£"><a href="#ä½¿ç”¨æ–¹å¼è¯¦è§£" class="headerlink" title="ä½¿ç”¨æ–¹å¼è¯¦è§£"></a>ä½¿ç”¨æ–¹å¼è¯¦è§£</h3><h4 id="é»˜è®¤æ± "><a href="#é»˜è®¤æ± " class="headerlink" title="é»˜è®¤æ± "></a>é»˜è®¤æ± </h4><p>antsåœ¨å¯åŠ¨æ—¶ï¼Œä¼šé»˜è®¤åˆå§‹åŒ–ä¸€ä¸ªåç¨‹æ± ï¼Œè¿™éƒ¨åˆ†ä»£ç ä½äºants.goæ–‡ä»¶ä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> (<br><span class="hljs-comment">// ErrLackPoolFunc will be returned when invokers don&#x27;t provide function for pool.</span><br>ErrLackPoolFunc = errors.New(<span class="hljs-string">&quot;must provide function for pool&quot;</span>)<br> <br><span class="hljs-comment">// ErrInvalidPoolExpiry will be returned when setting a negative number as the periodic duration to purge goroutines.</span><br>ErrInvalidPoolExpiry = errors.New(<span class="hljs-string">&quot;invalid expiry for pool&quot;</span>)<br> <br><span class="hljs-comment">// ErrPoolClosed will be returned when submitting task to a closed pool.</span><br>ErrPoolClosed = errors.New(<span class="hljs-string">&quot;this pool has been closed&quot;</span>)<br> <br><span class="hljs-comment">// ErrPoolOverload will be returned when the pool is full and no workers available.</span><br>ErrPoolOverload = errors.New(<span class="hljs-string">&quot;too many goroutines blocked on submit or Nonblocking is set&quot;</span>)<br> <br><span class="hljs-comment">// ErrInvalidPreAllocSize will be returned when trying to set up a negative capacity under PreAlloc mode.</span><br>ErrInvalidPreAllocSize = errors.New(<span class="hljs-string">&quot;can not set up a negative capacity under PreAlloc mode&quot;</span>)<br> <br><span class="hljs-comment">// ErrTimeout will be returned after the operations timed out.</span><br>ErrTimeout = errors.New(<span class="hljs-string">&quot;operation timed out&quot;</span>)<br> <br><span class="hljs-comment">// ErrInvalidPoolIndex will be returned when trying to retrieve a pool with an invalid index.</span><br>ErrInvalidPoolIndex = errors.New(<span class="hljs-string">&quot;invalid pool index&quot;</span>)<br> <br><span class="hljs-comment">// ErrInvalidLoadBalancingStrategy will be returned when trying to create a MultiPool with an invalid load-balancing strategy.</span><br>ErrInvalidLoadBalancingStrategy = errors.New(<span class="hljs-string">&quot;invalid load-balancing strategy&quot;</span>)<br> <br><span class="hljs-comment">// workerChanCap determines whether the channel of a worker should be a buffered channel</span><br><span class="hljs-comment">// to get the best performance. Inspired by fasthttp at</span><br><span class="hljs-comment">// https://github.com/valyala/fasthttp/blob/master/workerpool.go#L139</span><br>workerChanCap = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">int</span> &#123;<br><span class="hljs-comment">// Use blocking channel if GOMAXPROCS=1.</span><br><span class="hljs-comment">// This switches context from sender to receiver immediately,</span><br><span class="hljs-comment">// which results in higher performance (under go1.5 at least).</span><br><span class="hljs-keyword">if</span> runtime.GOMAXPROCS(<span class="hljs-number">0</span>) == <span class="hljs-number">1</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>&#125;<br> <br><span class="hljs-comment">// Use non-blocking workerChan if GOMAXPROCS&gt;1,</span><br><span class="hljs-comment">// since otherwise the sender might be dragged down if the receiver is CPU-bound.</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>&#125;()<br> <br><span class="hljs-comment">// log.Lmsgprefix is not available in go1.13, just make an identical value for it.</span><br>logLmsgprefix = <span class="hljs-number">64</span><br>defaultLogger = Logger(log.New(os.Stderr, <span class="hljs-string">&quot;[ants]: &quot;</span>, log.LstdFlags|logLmsgprefix|log.Lmicroseconds))<br> <br><span class="hljs-comment">// Init an instance pool when importing ants.</span><br>defaultAntsPool, _ = NewPool(DefaultAntsPoolSize)<br>)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨èµ·æ¥å°±æ¯”è¾ƒç®€å•ï¼Œç›´æ¥å¾€æ± å­é‡Œæäº¤ä»»åŠ¡å³å¯ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/panjf2000/ants/v2&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-comment">// é»˜è®¤æ± </span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addsum</span><span class="hljs-params">(d <span class="hljs-type">int</span>)</span></span> &#123;<br>sum := <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; d; i++ &#123;<br>sum += i<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;sum is ï¼š&quot;</span>, sum)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br>now := time.Now()<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;<br>wg.Add(<span class="hljs-number">1</span>)<br>ants.Submit(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>addsum(<span class="hljs-number">1000000000</span>)<br>wg.Done()<br>&#125;)<br>&#125;<br><br>wg.Wait()<br>fmt.Println(<span class="hljs-string">&quot;åç¨‹æ± è¿è¡Œæ—¶é—´:&quot;</span>, time.Since(now))<br>now = time.Now()<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;<br>addsum(<span class="hljs-number">1000000000</span>)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;ä¸»çº¿ç¨‹è¿è¡Œæ—¶é—´:&quot;</span>, time.Since(now))<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go">sum is ï¼š <span class="hljs-number">499999999500000000</span><br>sum is ï¼š <span class="hljs-number">499999999500000000</span><br>sum is ï¼š <span class="hljs-number">499999999500000000</span><br>sum is ï¼š <span class="hljs-number">499999999500000000</span><br>sum is ï¼š <span class="hljs-number">499999999500000000</span><br>åç¨‹æ± è¿è¡Œæ—¶é—´: <span class="hljs-number">460.392277</span>ms<br>sum is ï¼š <span class="hljs-number">499999999500000000</span><br>sum is ï¼š <span class="hljs-number">499999999500000000</span><br>sum is ï¼š <span class="hljs-number">499999999500000000</span><br>sum is ï¼š <span class="hljs-number">499999999500000000</span><br>sum is ï¼š <span class="hljs-number">499999999500000000</span><br>ä¸»çº¿ç¨‹è¿è¡Œæ—¶é—´: <span class="hljs-number">2.176051363</span>s<br></code></pre></td></tr></table></figure><h4 id="æ™®é€šæ¨¡å¼"><a href="#æ™®é€šæ¨¡å¼" class="headerlink" title="æ™®é€šæ¨¡å¼"></a>æ™®é€šæ¨¡å¼</h4><p>æ™®é€šæ¨¡å¼å’Œä½¿ç”¨é»˜è®¤æ± éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯éœ€è¦è‡ªå·±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">p, _ := ants.NewPool(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p>å‡½æ•°å‚æ•°ä¸ºåç¨‹æ± åç¨‹ä¸ªæ•°ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br> <br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br> <br><span class="hljs-string">&quot;github.com/panjf2000/ants/v2&quot;</span><br>)<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(d <span class="hljs-type">int</span>)</span></span> &#123;<br>sum := <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; d; i++ &#123;<br>sum += i<br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br>now := time.Now()<br>p, _ := ants.NewPool(<span class="hljs-number">5</span>)<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;<br>wg.Add(<span class="hljs-number">1</span>)<br>p.Submit(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>add(<span class="hljs-number">10000000000</span>)<br>wg.Done()<br>&#125;)<br>&#125;<br>wg.Wait()<br>fmt.Println(<span class="hljs-string">&quot;åç¨‹æ± è¿è¡Œï¼š&quot;</span>, time.Since(now))<br>now = time.Now()<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;<br>add(<span class="hljs-number">10000000000</span>)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;å¾ªç¯è¿è¡Œï¼š&quot;</span>, time.Since(now))<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">åç¨‹æ± è¿è¡Œï¼š <span class="hljs-number">221.90558</span>ms<br>å¾ªç¯è¿è¡Œï¼š <span class="hljs-number">1.059491865</span>s<br></code></pre></td></tr></table></figure><h4 id="å¸¦å‚å‡½æ•°"><a href="#å¸¦å‚å‡½æ•°" class="headerlink" title="å¸¦å‚å‡½æ•°"></a>å¸¦å‚å‡½æ•°</h4><p>å¸¦å‚å‡½æ•°ï¼Œé‡ç‚¹æ˜¯å¾€workerä¸­ä¼ é€’å‡½æ•°æ‰§è¡Œçš„å‚æ•°ï¼Œæ¯ä¸ªworkderä¸­éƒ½æ˜¯åŒä¸€ä¸ªæ‰§è¡Œå‡½æ•°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br> <br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br> <br><span class="hljs-string">&quot;github.com/panjf2000/ants/v2&quot;</span><br>)<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(d <span class="hljs-type">int</span>)</span></span> &#123;<br>sum := <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; d; i++ &#123;<br>sum += i<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;the sum is: &quot;</span>, sum)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br>now := time.Now()<br>p, _ := ants.NewPoolWithFunc(<span class="hljs-number">5</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;<br>add(i.(<span class="hljs-type">int</span>))<br>wg.Done()<br>&#125;)<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;<br>wg.Add(<span class="hljs-number">1</span>)<br>p.Invoke(<span class="hljs-number">1000000000</span>)<br>&#125;<br>wg.Wait()<br>fmt.Println(<span class="hljs-string">&quot;å¾ªç¯è¿è¡Œï¼š&quot;</span>, time.Since(now))<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go">the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>åç¨‹æ± è¿è¡Œï¼š <span class="hljs-number">448.830883</span>ms<br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>å¾ªç¯è¿è¡Œï¼š <span class="hljs-number">2.142860462</span>s<br></code></pre></td></tr></table></figure><h4 id="å¤šæ± å¤šåç¨‹"><a href="#å¤šæ± å¤šåç¨‹" class="headerlink" title="å¤šæ± å¤šåç¨‹"></a>å¤šæ± å¤šåç¨‹</h4><p>è¿™ç§æ¨¡å¼ï¼Œå°±æ˜¯å£°æ˜äº†å¤šä¸ªåç¨‹æ± ï¼Œæ¯ä¸ªæ± å­é‡Œæœ‰å¤šä¸ªåç¨‹åœ¨è·‘ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br><span class="hljs-string">&quot;github.com/panjf2000/ants/v2&quot;</span><br>)<br><br><span class="hljs-comment">// å¤šæ± å¤šåç¨‹</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addsum3</span><span class="hljs-params">(d <span class="hljs-type">int</span>)</span></span> &#123;<br>sum := <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; d; i++ &#123;<br>sum += i<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;the sum is: &quot;</span>, sum)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br>runTimes := <span class="hljs-number">10</span><br>now := time.Now()<br>mpf, _ := ants.NewMultiPoolWithFunc(<span class="hljs-number">10</span>, runTimes/<span class="hljs-number">5</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;<br><span class="hljs-comment">// size ä»£è¡¨è¦åˆ›å»ºçš„å­åç¨‹æ± çš„æ€»æ•° sizePerPoolï¼ˆrunTimes/5ï¼‰æ¯ä¸ªå­åç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æ•°é‡</span><br>addsum3(i.(<span class="hljs-type">int</span>))<br>wg.Done()<br>&#125;, ants.LeastTasks)<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; runTimes; i++ &#123;<br>wg.Add(<span class="hljs-number">1</span>)<br>mpf.Invoke(<span class="hljs-number">1000000000</span>)<br>&#125;<br>wg.Wait()<br>fmt.Println(<span class="hljs-string">&quot;åç¨‹æ± è¿è¡Œæ—¶é—´:&quot;</span>, time.Since(now))<br>now = time.Now()<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; runTimes; i++ &#123;<br>addsum3(<span class="hljs-number">1000000000</span>)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;ä¸»çº¿ç¨‹è¿è¡Œæ—¶é—´:&quot;</span>, time.Since(now))<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go">the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>åç¨‹æ± è¿è¡Œæ—¶é—´: <span class="hljs-number">739.516116</span>ms<br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>the sum is:  <span class="hljs-number">499999999500000000</span><br>ä¸»çº¿ç¨‹è¿è¡Œæ—¶é—´: <span class="hljs-number">4.2396312</span>s<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ™®é€šæ¨¡å¼ã€å¸¦å‚æ•°å‡½æ•°æ˜¯æ¨èçš„ä½¿ç”¨æ–¹å¼ï¼Œä½¿ç”¨åç¨‹æ± ï¼Œå¯ä»¥æœ‰æ•ˆçš„æ§åˆ¶ç³»ç»Ÿç¡¬ä»¶èµ„æºçš„ä½¿ç”¨ï¼Œé˜²æ­¢æœºå™¨è¢«æ‰“æ»¡ï¼Œå¯¹äºé«˜å¹¶å‘æœåŠ¡éå¸¸æ¨èä½¿ç”¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goæ€§èƒ½åˆ†æå·¥å…·pprof</title>
    <link href="/2024/12/10/go/Go%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7pprof/"/>
    <url>/2024/12/10/go/Go%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7pprof/</url>
    
    <content type="html"><![CDATA[<h1 id="Goæ€§èƒ½åˆ†æå·¥å…·pprof"><a href="#Goæ€§èƒ½åˆ†æå·¥å…·pprof" class="headerlink" title="Goæ€§èƒ½åˆ†æå·¥å…·pprof"></a>Goæ€§èƒ½åˆ†æå·¥å…·pprof</h1><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯pprof"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯pprof" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯pprof"></a>ä¸€ã€ä»€ä¹ˆæ˜¯pprof</h2><p>pprofæ˜¯Goå®˜æ–¹æä¾›çš„æ€§èƒ½åˆ†æå·¥å…·ï¼Œå¯ä»¥åˆ†æç¨‹åºçš„è¿è¡Œæƒ…å†µï¼Œå¹¶ä¸”æä¾›å¯è§†åŒ–çš„åŠŸèƒ½ã€‚profæ˜¯profileï¼ˆç”»åƒï¼‰çš„ç¼©å†™ï¼Œä½¿ç”¨pprofå¯ä»¥åˆ†æä»¥ä¸‹å‡ ç§æŒ‡æ ‡æ•°æ®ï¼š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/f8aa6b1a10b845b1d0cc81ec241ca451.png?raw=true" alt="f8aa6b1a10b845b1d0cc81ec241ca451"></p><ul><li><code>allocs</code>ï¼šç¨‹åºå¯åŠ¨ä¹‹åå†…å­˜åˆ†é…çš„æƒ…å†µ</li><li><code>block</code>ï¼šå¯¼è‡´é˜»å¡æ“ä½œçš„ä¸€äº›å †æ ˆè·Ÿè¸ªä¿¡æ¯</li><li><code>cmdline</code>ï¼šå½“å‰ç¨‹åºå¯åŠ¨çš„å‘½ä»¤è¡Œ</li><li><code>goroutine</code>ï¼šæ‰€æœ‰å½“å‰ <code>goroutine</code> çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯</li><li><code>heap</code>ï¼šç¨‹åºåœ¨å½“å‰å †ä¸Šå†…å­˜åˆ†é…çš„æƒ…å†µ</li><li><code>mutex</code>ï¼šé”èµ„æºçš„ç«äº‰çš„å †æ ˆä¿¡æ¯</li><li><code>profile</code>ï¼š<code>CPU profile</code>æ–‡ä»¶ã€‚å¯ä»¥åœ¨ <code>debug/pprof?seconds=xç§’</code> <code>GET</code> å‚æ•°ä¸­æŒ‡å®šæŒç»­æ—¶é—´ã€‚è·å–<code>pprof</code>æ–‡ä»¶åï¼Œä½¿ç”¨ <code>go tool pprof x.prof</code>å‘½ä»¤åˆ†æ<code>pprof</code>æ–‡ä»¶ã€‚</li><li><code>threadcreate</code>ï¼šç³»ç»Ÿçº¿ç¨‹çš„ä½¿ç”¨æƒ…å†µ</li><li><code>trace</code>ï¼šå½“å‰ç³»ç»Ÿçš„ä»£ç æ‰§è¡Œçš„é“¾è·¯æƒ…å†µ</li></ul><p>ä½¿ç”¨<code>pprof</code>å·¥å…·ä¸»è¦åˆ†æä»¥ä¸‹å‡ ç§æŒ‡æ ‡ï¼š</p><ul><li><code>CPU Profiling</code>ï¼š<code>CPU</code> åˆ†æï¼ŒæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡é‡‡é›†æ‰€ç›‘å¬çš„åº”ç”¨ç¨‹åº <code>CPU</code>ï¼ˆå«å¯„å­˜å™¨ï¼‰çš„ä½¿ç”¨æƒ…å†µï¼Œå¯ç¡®å®šåº”ç”¨ç¨‹åºåœ¨ä¸»åŠ¨æ¶ˆè€— <code>CPU</code> å‘¨æœŸæ—¶èŠ±è´¹æ—¶é—´çš„ä½ç½®</li><li><code>Memory Profiling</code>ï¼šå†…å­˜åˆ†æï¼Œåœ¨åº”ç”¨ç¨‹åºè¿›è¡Œå †åˆ†é…æ—¶è®°å½•å †æ ˆè·Ÿè¸ªï¼Œç”¨äºç›‘è§†å½“å‰å’Œå†å²å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠæ£€æŸ¥å†…å­˜æ³„æ¼</li><li><code>Block Profiling</code>ï¼šé˜»å¡åˆ†æï¼Œè®°å½• <code>goroutine</code> é˜»å¡ç­‰å¾…åŒæ­¥ï¼ˆåŒ…æ‹¬å®šæ—¶å™¨é€šé“ï¼‰çš„ä½ç½®</li><li><code>Mutex Profiling</code>ï¼šäº’æ–¥é”åˆ†æï¼ŒæŠ¥å‘Šäº’æ–¥é”çš„ç«äº‰æƒ…å†µã€‚</li></ul><p>å½“ç¨‹åºå­˜åœ¨å†…å­˜æˆ–è€…<code>CPU</code>é£™å‡çš„æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>pprof</code>å·¥å…·æ¥æŸ¥è¯¢é—®é¢˜å‡ºç°çš„æ ¹æºã€‚</p><h2 id="äºŒã€æ€ä¹ˆä½¿ç”¨pprof"><a href="#äºŒã€æ€ä¹ˆä½¿ç”¨pprof" class="headerlink" title="äºŒã€æ€ä¹ˆä½¿ç”¨pprof"></a>äºŒã€æ€ä¹ˆä½¿ç”¨pprof</h2><p>pprofåŒ…å«ä¸¤ä¸ªç›¸å…³çš„åº“ï¼š</p><ol><li><code>runtime/pprof</code><br>ä¸»è¦åº”ç”¨äºå·¥å…·å‹åº”ç”¨ã€‚åŒ…å«è„šæœ¬ã€å®šæ—¶ä»»åŠ¡ç­‰ã€‚<br>å¦‚ï¼šå¯¹äºåªè·‘ä¸€æ¬¡çš„ç¨‹åºï¼Œä¾‹å¦‚æ¯å¤©åªè·‘ä¸€æ¬¡çš„ç¦»çº¿é¢„å¤„ç†ç¨‹åºï¼Œè°ƒç”¨ pprof åŒ…æä¾›çš„å‡½æ•°ï¼Œæ‰‹åŠ¨å¼€å¯æ€§èƒ½æ•°æ®é‡‡é›†</li><li><code>net/http/pprof</code><br>ä¸»è¦åº”ç”¨äºæœåŠ¡å‹åº”ç”¨ã€‚åŒ…å«HTTPæœåŠ¡ï¼ŒGRPCæœåŠ¡ç­‰ã€‚<br>å¦‚ï¼šå¯¹äºåœ¨çº¿æœåŠ¡ï¼Œå¯¹äºä¸€ä¸ª HTTP Serverï¼Œè®¿é—® pprof æä¾›çš„ HTTP æ¥å£ï¼Œè·å¾—æ€§èƒ½æ•°æ®ã€‚å½“ç„¶ï¼Œå®é™…ä¸Šè¿™é‡Œåº•å±‚ä¹Ÿæ˜¯è°ƒç”¨çš„ <code>runtime/pprof</code>æä¾›çš„å‡½æ•°ï¼Œå°è£…æˆæ¥å£å¯¹å¤–æä¾›ç½‘ç»œè®¿é—®ã€‚</li></ol><h3 id="1-å·¥å…·å‹åº”ç”¨"><a href="#1-å·¥å…·å‹åº”ç”¨" class="headerlink" title="1. å·¥å…·å‹åº”ç”¨"></a>1. å·¥å…·å‹åº”ç”¨</h3><p>å·¥å…·å‹åº”ç”¨ä¸»è¦ä½¿ç”¨<code>runtime/pprof</code>åŒ…å®ç°æ€§èƒ½åˆ†æ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// --- cpu åˆ†æç¤ºä¾‹ start---</span><br><span class="hljs-comment">// åˆ›å»ºcpuåˆ†ææ–‡ä»¶</span><br>fc, err := os.Create(<span class="hljs-string">&quot;./cpu.prof&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;create cpu.prof err:&quot;</span>, err.Error())<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> fc.Close()<br><br><span class="hljs-comment">// å¼€å§‹åˆ†æcpu</span><br>err = pprof.StartCPUProfile(fc)<br><span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">defer</span> pprof.StopCPUProfile()<br>&#125;<br><span class="hljs-comment">// --- cpu åˆ†æç¤ºä¾‹ end---</span><br><br><span class="hljs-keyword">var</span> count <span class="hljs-type">int</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++ &#123;<br>count++<br>&#125;<br><br><span class="hljs-comment">// --- å†…å­˜ åˆ†æç¤ºä¾‹ start---</span><br>fm, err := os.Create(<span class="hljs-string">&quot;./memory.prof&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;create memory.prof err:&quot;</span>, err.Error())<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> fm.Close()<br><br><span class="hljs-comment">// å¼€å§‹åˆ†æå†…å­˜</span><br>err = pprof.WriteHeapProfile(fm)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;write heap prof err:&quot;</span>, err.Error())<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-comment">// --- å†…å­˜ åˆ†æç¤ºä¾‹ end---</span><br><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++ &#123;<br>count++<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;do finish......count:&quot;</span>, count)<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>go run main.go</code> åï¼Œåœ¨ä»£ç ç›®å½•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ç”Ÿæˆäº† cpu.prof å’Œmenory.profæ–‡ä»¶</p><p>é€šè¿‡æ‰§è¡Œ <code>go tool pprof ./memory.prof</code> æˆ–è€… <code>go tool pprof -http=8888 ./memory.prof </code> è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼æˆ–è€…webé¡µé¢è¿›è¡Œæ€§èƒ½åˆ†æ</p><p>æ‰§è¡Œ <code>go tool pprof ./memory.prof</code> è¿›å…¥å‘½ä»¤è¡Œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go">gond@gond-UM690:~/work/go_work/study/pprof$ <span class="hljs-keyword">go</span> tool pprof ./memory.prof <br>File: ___go_build_pprofDemo1_go<span class="hljs-comment">// File: è¡¨ç¤ºå½“å‰åˆ†æçš„æ–‡ä»¶æ˜¯ ___go_build_pprofDemo1_goã€‚</span><br>Type: inuse_space<span class="hljs-comment">// Type: è¡¨ç¤ºå½“å‰å±•ç¤ºçš„æ˜¯å†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆinuse_spaceï¼‰ï¼Œå³å½“å‰ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚</span><br>Time: Sep <span class="hljs-number">5</span>, <span class="hljs-number">2024</span> at <span class="hljs-number">3</span>:<span class="hljs-number">51</span>pm (CST)<span class="hljs-comment">// Time: è¡¨ç¤ºè¯¥åˆ†ææ–‡ä»¶çš„ç”Ÿæˆæ—¶é—´ã€‚</span><br>Entering interactive mode (<span class="hljs-keyword">type</span> <span class="hljs-string">&quot;help&quot;</span> <span class="hljs-keyword">for</span> commands, <span class="hljs-string">&quot;o&quot;</span> <span class="hljs-keyword">for</span> options)<span class="hljs-comment">// è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œå¯ä»¥è¾“å…¥å„ç§å‘½ä»¤æ¥è¿›ä¸€æ­¥åˆ†ææ•°æ®ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥ help å¯ä»¥æŸ¥çœ‹å¯ç”¨å‘½ä»¤åˆ—è¡¨ï¼Œè¾“å…¥ o å¯ä»¥æŸ¥çœ‹å’Œè®¾ç½®é€‰é¡¹ã€‚</span><br>(pprof) <br>(pprof) top<span class="hljs-comment">// top å‘½ä»¤å±•ç¤ºäº†å†…å­˜ä½¿ç”¨æƒ…å†µçš„å‰å‡ æ¡è®°å½•ã€‚</span><br>Showing nodes accounting <span class="hljs-keyword">for</span> <span class="hljs-number">1.16</span>MB, <span class="hljs-number">100</span>% of <span class="hljs-number">1.16</span>MB total<br>      flat  flat%   sum%        cum   cum%<span class="hljs-comment">// flat: è¡¨ç¤ºè¯¥å‡½æ•°è‡ªå·±ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚</span><br>    <span class="hljs-number">1.16</span>MB   <span class="hljs-number">100</span>%   <span class="hljs-number">100</span>%     <span class="hljs-number">1.16</span>MB   <span class="hljs-number">100</span>%  runtime/pprof.StartCPUProfile  <span class="hljs-comment">//flat%: è¡¨ç¤ºè¯¥å‡½æ•°è‡ªå·±ä½¿ç”¨çš„å†…å­˜å æ€»å†…å­˜çš„æ¯”ä¾‹ã€‚</span><br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%     <span class="hljs-number">1.16</span>MB   <span class="hljs-number">100</span>%  main.main<span class="hljs-comment">// sum%: è¡¨ç¤ºç´¯è®¡åˆ°è¯¥å‡½æ•°ä¸ºæ­¢çš„å†…å­˜ä½¿ç”¨æ¯”ä¾‹ã€‚</span><br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%     <span class="hljs-number">1.16</span>MB   <span class="hljs-number">100</span>%  runtime.main<span class="hljs-comment">// cum: è¡¨ç¤ºç´¯ç§¯åˆ°è¯¥å‡½æ•°ä¸ºæ­¢çš„æ€»å†…å­˜ä½¿ç”¨é‡</span><br><span class="hljs-comment">// cum%: è¡¨ç¤ºç´¯ç§¯åˆ°è¯¥å‡½æ•°ä¸ºæ­¢çš„å†…å­˜ä½¿ç”¨é‡å æ€»å†…å­˜çš„æ¯”ä¾‹ã€‚</span><br><span class="hljs-comment">// å‡½æ•°åï¼šè¡¨ç¤ºè°ƒç”¨æ ˆä¸­çš„å‡½æ•°ã€‚</span><br></code></pre></td></tr></table></figure><p>å®‰è£…ç»„ä»¶ï¼Œç³»ç»Ÿubuntu, <code>sudo apt install graphviz</code>ï¼Œæ‰§è¡Œ<code>go tool pprof -http=:8888 ./memory.prof</code>å¯è¿›å…¥<code>web</code>é¡µé¢ï¼Œæ›´æ–¹ä¾¿æŸ¥çœ‹ï¼š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240905163023564.png?raw=true" alt="image-20240905163023564"></p><p>SAMPLEå„ä¸ªæ ‡ç­¾çš„å«ä¹‰è§£é‡Šï¼š</p><table><thead><tr><th>ç±»å‹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>inuse_space</td><td>è¡¨ç¤ºå½“å‰æ­£åœ¨ä½¿ç”¨çš„å†…å­˜ç©ºé—´æ€»é‡ã€‚è¿™é€šå¸¸æ˜¯å·²ç»åˆ†é…ç»™åº”ç”¨ç¨‹åºçš„å¯¹è±¡å ç”¨çš„ç©ºé—´ï¼Œä¸åŒ…æ‹¬å·²ç»è¢«é‡Šæ”¾çš„ç©ºé—´</td></tr><tr><td>inuse_objects</td><td>è¡¨ç¤ºå½“å‰æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡æ•°é‡ã€‚è¿™æŒ‡çš„æ˜¯å·²ç»è¢«åˆ†é…ä¸”å°šæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡æ•°</td></tr><tr><td>alloc_space</td><td>è¡¨ç¤ºè‡ªç¨‹åºå¯åŠ¨ä»¥æ¥ï¼Œæ€»çš„åˆ†é…å†…å­˜ç©ºé—´ã€‚è¿™åŒ…æ‹¬äº†æ‰€æœ‰å·²ç»åˆ†é…è¿‡çš„å†…å­˜ï¼Œæ— è®ºè¿™äº›å†…å­˜æ˜¯å¦å·²ç»è¢«é‡Šæ”¾ã€‚</td></tr><tr><td>alloc_objects</td><td>è¡¨ç¤ºè‡ªç¨‹åºå¯åŠ¨ä»¥æ¥ï¼Œæ€»å…±åˆ†é…çš„å¯¹è±¡æ•°é‡ã€‚è¿™åŒ…æ‹¬äº†æ‰€æœ‰å·²ç»åˆ›å»ºçš„å¯¹è±¡ï¼Œå³ä½¿æŸäº›å¯¹è±¡å¯èƒ½å·²ç»è¢«åƒåœ¾å›æ”¶ã€‚</td></tr></tbody></table><h3 id="2-æœåŠ¡å‹åº”ç”¨"><a href="#2-æœåŠ¡å‹åº”ç”¨" class="headerlink" title="2. æœåŠ¡å‹åº”ç”¨"></a>2. æœåŠ¡å‹åº”ç”¨</h3><p>å¯¹äºæœåŠ¡ç±»å‹çš„åº”ç”¨ï¼Œä¸»è¦åœ¨æœåŠ¡å†…éƒ¨åŒ¿åå¼•å…¥<code>net/http/pprof</code>åŒ…ï¼Œç„¶åé€šè¿‡<code>HTTP</code>è®¿é—®<code>pprof</code>é¡µé¢ã€‚<br>åŒ¿åå¼•å…¥æ–¹å¼ä¸ºï¼š<code>import _ &quot;net/http/pprof&quot;</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br>_ <span class="hljs-string">&quot;net/http/pprof&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, hello)<br>err := http.ListenAndServe(<span class="hljs-string">&quot;:8080&quot;</span>, <span class="hljs-literal">nil</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;ListenAndServe Err:&quot;</span>, err.Error())<br><span class="hljs-keyword">return</span><br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">hello</span><span class="hljs-params">(resp http.ResponseWriter, req *http.Request)</span></span> &#123;<br>fmt.Fprintln(resp, <span class="hljs-string">&quot;Hello World, Are You OK?&quot;</span>)<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>http://localhost:8080/debug/pprof/</code>å¯ä»¥çœ‹åˆ°ç”»åƒä¿¡æ¯ï¼š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240905163831774.png?raw=true" alt="image-20240905163831774"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go">allocs: æ‰€æœ‰è¿‡å»å†…å­˜åˆ†é…çš„é‡‡æ ·ã€‚<br>block: å¯¼è‡´åœ¨åŒæ­¥åŸè¯­ä¸Šé˜»å¡çš„æ ˆè·Ÿè¸ªã€‚<br>cmdline: å½“å‰ç¨‹åºçš„å‘½ä»¤è¡Œè°ƒç”¨ã€‚<br>goroutine: æ‰€æœ‰å½“å‰ goroutine çš„æ ˆè·Ÿè¸ªã€‚ä½¿ç”¨ debug=<span class="hljs-number">2</span> ä½œä¸ºæŸ¥è¯¢å‚æ•°å¯¼å‡ºä¸ºæœªæ¢å¤ææ…Œæ—¶ç›¸åŒçš„æ ¼å¼ã€‚<br>heap: æ´»åŠ¨å¯¹è±¡çš„å†…å­˜åˆ†é…é‡‡æ ·ã€‚å¯ä»¥é€šè¿‡æŒ‡å®š gc GET å‚æ•°æ¥åœ¨è·å–å †æ ·æœ¬ä¹‹å‰è¿è¡Œåƒåœ¾æ”¶é›†ã€‚<br>mutex: äº‰ç”¨äº’æ–¥é”çš„æŒæœ‰è€…çš„æ ˆè·Ÿè¸ªã€‚<br>profile: CPU å‰–ææ–‡ä»¶ã€‚å¯ä»¥åœ¨ GET å‚æ•°ä¸­æŒ‡å®šæŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ã€‚è·å–å‰–ææ–‡ä»¶åï¼Œä½¿ç”¨ <span class="hljs-keyword">go</span> tool pprof å‘½ä»¤æ¥åˆ†æè¯¥å‰–ææ–‡ä»¶ã€‚<br>threadcreate: å¯¼è‡´åˆ›å»ºæ–°çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„æ ˆè·Ÿè¸ªã€‚<br>trace: å½“å‰ç¨‹åºæ‰§è¡Œçš„è¿½è¸ªã€‚å¯ä»¥åœ¨ GET å‚æ•°ä¸­æŒ‡å®šæŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ã€‚è·å–è¿½è¸ªæ–‡ä»¶åï¼Œä½¿ç”¨ <span class="hljs-keyword">go</span> tool trace å‘½ä»¤æ¥åˆ†æè¯¥è¿½è¸ªæ–‡ä»¶ã€‚<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œå¦‚æœHTTPæœåŠ¡ä¸æ˜¯é€šè¿‡<br><code>http.ListenAndServe(&quot;:8080&quot;, nil)</code>å¯åŠ¨çš„ï¼Œè€Œæ˜¯æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°å¯åŠ¨çš„è¯ï¼Œéœ€è¦è‡ªå·±æ³¨å†Œ<code>pprof</code>è·¯ç”±ã€‚</p><p>åœ¨<code>net/http/pprof/pprof.go</code>çš„å®˜æ–¹æºç æ³¨é‡Šä¸­ä¹Ÿæåˆ°æ­¤ç§æƒ…å†µï¼š</p><blockquote><p>If you are not using DefaultServeMux, you will have to register handlers with the mux you are using.<br>å¦‚æœæ‚¨ä¸ä½¿ç”¨DefaultServeMuxï¼Œåˆ™å¿…é¡»å‘æ‰€ä½¿ç”¨çš„å¤šè·¯å¤ç”¨å™¨æ³¨å†Œpprofå¤„ç†ç¨‹åº<br>http.ListenAndServeå‡½æ•°å¯ä»¥ä¼ é€’handlerï¼Œå¦‚æœhandlerä¸ä¸ºnilï¼Œåˆ™è¯´æ˜ç ”å‘è‡ªå®šä¹‰äº† ServeMuxï¼Œå¦åˆ™ç”¨çš„æ˜¯é»˜è®¤DefaultServeMux</p></blockquote><p><code>net/http/pprof</code>åŒ…ä¸­ï¼Œæœ‰<code>init</code>å‡½æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>   http.HandleFunc(<span class="hljs-string">&quot;/debug/pprof/&quot;</span>, Index)<br>   http.HandleFunc(<span class="hljs-string">&quot;/debug/pprof/cmdline&quot;</span>, Cmdline)<br>   http.HandleFunc(<span class="hljs-string">&quot;/debug/pprof/profile&quot;</span>, Profile)<br>   http.HandleFunc(<span class="hljs-string">&quot;/debug/pprof/symbol&quot;</span>, Symbol)<br>   http.HandleFunc(<span class="hljs-string">&quot;/debug/pprof/trace&quot;</span>, Trace)<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å¦‚æœä½¿ç”¨é»˜è®¤<code>ServeMux</code>ï¼Œåˆ™ä¸éœ€è¦æ³¨å†Œï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨è‡ªå®šä¹‰çš„<code>ServeMux</code>ï¼Œåˆ™éœ€è¦å¢åŠ æ³¨å†Œåï¼Œæ‰èƒ½è·å–åˆ°<code>pprof</code>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// è‡ªå·±æ³¨å†Œè¿™å‡ ä¸ªå‡½æ•°</span><br>r.HandleFunc(<span class="hljs-string">&quot;/debug/pprof/&quot;</span>, pprof.Index)<br>r.HandleFunc(<span class="hljs-string">&quot;/debug/pprof/cmdline&quot;</span>, pprof.Cmdline)<br>r.HandleFunc(<span class="hljs-string">&quot;/debug/pprof/profile&quot;</span>, pprof.Profile)<br>r.HandleFunc(<span class="hljs-string">&quot;/debug/pprof/symbol&quot;</span>, pprof.Symbol)<br>r.HandleFunc(<span class="hljs-string">&quot;/debug/pprof/trace&quot;</span>, pprof.Trace)<br></code></pre></td></tr></table></figure><p>å¦å¤–ä¸€ç§å¯åŠ¨<code>pprof</code>çš„æ–¹å¼åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ›´åŠ å¸¸ç”¨ï¼šé€šè¿‡åç¨‹å¦èµ·ä¸€ä¸ª<code>HTTP</code>æœåŠ¡ï¼Œå•ç‹¬ç”¨ä½œ<code>pprof</code>åˆ†æï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">RegisterProf</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">if</span> err := http.ListenAndServe(<span class="hljs-string">&quot;:6060&quot;</span>, <span class="hljs-literal">nil</span>); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;pprof server start error: &quot;</span> + err.Error())<br>&#125;<br>&#125;()<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€pprofæ•°æ®åˆ†æ"><a href="#ä¸‰ã€pprofæ•°æ®åˆ†æ" class="headerlink" title="ä¸‰ã€pprofæ•°æ®åˆ†æ"></a>ä¸‰ã€<code>pprof</code>æ•°æ®åˆ†æ</h2><p><code>GO</code>å®˜æ–¹æä¾›äº†<code>go tool pprof</code>å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬åˆ†æ<code>pprof</code>ç”Ÿæˆçš„æ•°æ®æ–‡ä»¶ã€‚<br>ä½¿ç”¨<code>go tool pprof</code>åˆ†ææ•°æ®ï¼Œä¸»è¦æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><ol><li>å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼<br><code>go tool pprof [file_pprof|url_pprof]</code></li><li>webé¡µé¢æ¨¡å¼<br><code>go tool pprof -http=:6666 [file_pprof|url_pprof]</code><br>å…¶ä¸­ï¼Œ<code>file_pprof</code>è¡¨ç¤ºç”Ÿæˆçš„<code>prof</code>åˆ†ææ–‡ä»¶ï¼Œå¦‚<code>cpu.prof</code>ï¼›<code>url_pprof</code>è¡¨ç¤ºè¿œç«¯æœåŠ¡å¼€å¯çš„<code>pprof</code>è®¿é—®ï¼Œå¦‚<code>http://localhost:8080/debug/pprof/profile</code></li></ol><p>è¿›å…¥å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼åï¼Œå¯ä»¥ä½¿ç”¨<code>help</code>æŸ¥çœ‹æ‰€æœ‰å­å‘½ä»¤ï¼Œä½¿ç”¨<code>help &lt;cmd|option&gt;</code>æŸ¥çœ‹å­å‘½ä»¤ä½¿ç”¨æ–¹æ³•ã€‚å¦‚ <code>helpã€help top</code>ç­‰</p><h3 id="CPU-Profiling"><a href="#CPU-Profiling" class="headerlink" title="CPU Profiling"></a>CPU Profiling</h3><p>æµè§ˆå™¨è®¿é—®<code>/debug/pprof/profile</code>ä¼šè‡ªåŠ¨è¿›è¡Œ <code>CPU profiling</code>ï¼Œé»˜è®¤æŒç»­ 30sï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ä¾›ä¸‹è½½ï¼Œå¯ä»¥é€šè¿‡å¸¦å‚æ•°<code>?seconds=60</code>è¿›è¡Œ<code>60</code>ç§’çš„æ•°æ®é‡‡é›†ã€‚</p><p>ä¸ºäº†æ¨¡æ‹Ÿè¯·æ±‚ï¼Œä½¿ç”¨abè¿›è¡Œå‹æµ‹ï¼Œ<br><code>ab -k -c 1 -t 180 -n 100000000 http://localhost:8080/hello</code></p><p>æ‰§è¡Œ<code>go tool pprof http://localhost:8080/debug/pprof/profile</code>åï¼Œé»˜è®¤éœ€è¦ç­‰30sæ‰ä¼šæ˜¾ç¤ºäº¤äº’</p><h4 id="listæŒ‡ä»¤åˆ†æå‡½æ•°"><a href="#listæŒ‡ä»¤åˆ†æå‡½æ•°" class="headerlink" title="listæŒ‡ä»¤åˆ†æå‡½æ•°"></a>listæŒ‡ä»¤åˆ†æå‡½æ•°</h4><p>ç¡®å®šå‡ºå“ªä¸ªå‡½æ•°è€—æ—¶ä¹‹åï¼Œå¯ä»¥ç”¨<code>pprof</code>åˆ†æå‡½æ•°ä¸­çš„å“ªä¸€è¡Œå¯¼è‡´çš„è€—æ—¶ï¼Œä½¿ç”¨å­å‘½ä»¤ï¼šlist å‡½æ•°åã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240905165839736.png?raw=true" alt="image-20240905165839736"></p><h4 id="å †å†…å­˜åˆ†æç¤ºä¾‹"><a href="#å †å†…å­˜åˆ†æç¤ºä¾‹" class="headerlink" title="å †å†…å­˜åˆ†æç¤ºä¾‹"></a>å †å†…å­˜åˆ†æç¤ºä¾‹</h4><p>å†…å­˜åˆ†é…æ—¢å¯ä»¥å‘ç”Ÿåœ¨å †ä¸Šä¹Ÿå¯ä»¥åœ¨æ ˆä¸Šã€‚å †ä¸Šåˆ†é…çš„å†…å­˜éœ€è¦åƒåœ¾å›æ”¶æˆ–è€…æ‰‹åŠ¨å›æ”¶ï¼ˆå¯¹äºæ²¡æœ‰åƒåœ¾å›æ”¶çš„è¯­è¨€ï¼Œä¾‹å¦‚ C++ï¼‰ï¼Œæ ˆä¸Šçš„å†…å­˜åˆ™é€šå¸¸åœ¨å‡½æ•°é€€å‡ºåè‡ªåŠ¨é‡Šæ”¾ã€‚</p><p>Go è¯­è¨€é€šè¿‡é€ƒé€¸åˆ†æä¼šå°†å°½å¯èƒ½å¤šçš„å¯¹è±¡åˆ†é…åˆ°æ ˆä¸Šï¼Œä»¥ä½¿ç¨‹åºå¯ä»¥è¿è¡Œåœ°æ›´å¿«ã€‚</p><p>è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œæœ‰ä¸¤ç§å†…å­˜åˆ†æç­–ç•¥ï¼šä¸€ç§æ˜¯å½“å‰çš„ï¼ˆè¿™ä¸€æ¬¡é‡‡é›†ï¼‰å†…å­˜æˆ–å¯¹è±¡çš„åˆ†é…ï¼Œç§°ä¸º <code>inuse</code>ï¼›å¦ä¸€ç§æ˜¯ä»ç¨‹åºè¿è¡Œåˆ°ç°åœ¨æ‰€æœ‰çš„å†…å­˜åˆ†é…ï¼Œä¸ç®¡æ˜¯å¦å·²ç»è¢« <code>gc</code>è¿‡äº†ï¼Œç§°ä¸º <code>alloc</code>ã€‚</p><p>åŠ ä¸Š -sample_index å‚æ•°åï¼Œå¯ä»¥åˆ‡æ¢å†…å­˜åˆ†æçš„ç±»å‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span> tool pprof -sample_index=alloc_space http:<span class="hljs-comment">//localhost:8080/debug/pprof/heap</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span> tool pprof -alloc_space http:<span class="hljs-comment">//localhost:8080/debug/pprof/heap</span><br></code></pre></td></tr></table></figure><h2 id="å››ã€pprofæ•°æ®åˆ†æç±»å‹æ±‡æ€»"><a href="#å››ã€pprofæ•°æ®åˆ†æç±»å‹æ±‡æ€»" class="headerlink" title="å››ã€pprofæ•°æ®åˆ†æç±»å‹æ±‡æ€»"></a>å››ã€pprofæ•°æ®åˆ†æç±»å‹æ±‡æ€»</h2><p>å…¶ä»–æ•°æ®çš„åˆ†æå’Œ<code>CPU</code>çš„åŸºæœ¬ä¸€è‡´ã€‚ä¸‹é¢åˆ—ä¸¾æ‰€æœ‰çš„åˆ†ç±»ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">http:<span class="hljs-comment">//localhost:8080/debug/pprof/ ï¼šè·å–æ¦‚å†µä¿¡æ¯ï¼Œå³æœ¬æ–‡ç¬¬ä¸€å¼ å›¾çš„ä¿¡æ¯</span><br><span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:8080/debug/pprof/allocs : åˆ†æå†…å­˜åˆ†é…</span><br><span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:8080/debug/pprof/block : åˆ†æå †æ ˆè·Ÿè¸ªå¯¼è‡´é˜»å¡çš„åŒæ­¥åŸè¯­</span><br><span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:8080/debug/pprof/cmdline : åˆ†æå‘½ä»¤è¡Œè°ƒç”¨çš„ç¨‹åºï¼Œwebä¸‹è°ƒç”¨æŠ¥é”™</span><br><span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:8080/debug/pprof/goroutine : åˆ†æå½“å‰ goroutine çš„å †æ ˆä¿¡æ¯</span><br><span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:8080/debug/pprof/heap : åˆ†æå½“å‰æ´»åŠ¨å¯¹è±¡å†…å­˜åˆ†é…</span><br><span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:8080/debug/pprof/mutex : åˆ†æå †æ ˆè·Ÿè¸ªç«äº‰çŠ¶æ€äº’æ–¥é”çš„æŒæœ‰è€…</span><br><span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:8080/debug/pprof/profile : åˆ†æä¸€å®šæŒç»­æ—¶é—´å†…CPUçš„ä½¿ç”¨æƒ…å†µ</span><br><span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:8080/debug/pprof/threadcreate : åˆ†æå †æ ˆè·Ÿè¸ªç³»ç»Ÿæ–°çº¿ç¨‹çš„åˆ›å»º</span><br><span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:8080/debug/pprof/trace : åˆ†æè¿½è¸ªå½“å‰ç¨‹åºçš„æ‰§è¡ŒçŠ¶å†µ</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goç–‘éš¾æ‚ç—‡</title>
    <link href="/2024/12/10/go/go%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87%E7%89%87/"/>
    <url>/2024/12/10/go/go%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87%E7%89%87/</url>
    
    <content type="html"><![CDATA[<h1 id="goç–‘éš¾æ‚ç—‡"><a href="#goç–‘éš¾æ‚ç—‡" class="headerlink" title="goç–‘éš¾æ‚ç—‡"></a>goç–‘éš¾æ‚ç—‡</h1><h2 id="1ã€è§£å†³IDE-golang-ä»£ç é£˜çº¢æŠ¥é”™"><a href="#1ã€è§£å†³IDE-golang-ä»£ç é£˜çº¢æŠ¥é”™" class="headerlink" title="1ã€è§£å†³IDE golang ä»£ç é£˜çº¢æŠ¥é”™"></a>1ã€è§£å†³IDE golang ä»£ç é£˜çº¢æŠ¥é”™</h2><blockquote><p>é—®é¢˜ï¼šå¼•ç”¨æ–¹æ³•æˆ–è€…ç¬¬ä¸‰æ–¹åº“ï¼Œä»£ç å¯æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯é£˜çº¢ï¼Œæ— æ³•æŸ¥çœ‹æ–¹æ³•å†…éƒ¨å®ç°</p></blockquote><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>1.1 goland ç¼–è¾‘å™¨ç‚¹å‡»å·¥å…·æ Fileï¼Œæ‰¾åˆ°Invalidate Cachesï¼Œç‚¹å‡»Invalidate and Restart æŒ‰é’®ï¼Œæ¸…ç†ç¼“å­˜å¹¶ä¸”é‡å¯golandç¼–è¾‘å™¨</p><p>1,2 æ£€æŸ¥goland ç¼–è¾‘å™¨ go moduleé…ç½®ï¼ŒFile-Setttings-GO Module,æŸ¥çœ‹é…ç½®å¥½GOPROXYç¯å¢ƒå˜é‡ï¼Œæœªé…ç½®éœ€è¦é…ç½®</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">GOPROXY=https:<span class="hljs-comment">//goproxy.cn,https://goproxy.io,direct</span><br></code></pre></td></tr></table></figure><p>è®¾ç½® GOPROXY ä»£ç†ï¼Œè¿™é‡Œä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªå€¼ï¼Œç¬¬ä¸€ä¸ªæ˜¯ <code>https://goproxy.cn</code>ï¼Œå®ƒæ˜¯ç”±ä¸ƒç‰›äº‘èƒŒä¹¦çš„ä¸€ä¸ªå¼ºå¤§ç¨³å®šçš„ Go æ¨¡å—ä»£ç†ï¼Œå¯ä»¥æœ‰æ•ˆåœ°è§£å†³ä½ çš„å¤–ç½‘é—®é¢˜ï¼›ç¬¬äºŒä¸ªæ˜¯ <code>direct</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ fallback é€‰é¡¹ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”¨äºæŒ‡ç¤º Go åœ¨æ‹‰å–æ¨¡å—æ—¶é‡åˆ°é”™è¯¯ä¼šå›æºåˆ°æ¨¡å—ç‰ˆæœ¬çš„æºåœ°å€å»æŠ“å–ï¼ˆæ¯”å¦‚ GitHub ç­‰ï¼‰ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240812095307223.png?raw=true" alt="é…ç½®æˆªå›¾"></p><h2 id="2-Go-Sliceæ‰©å®¹ä¹‹å‘"><a href="#2-Go-Sliceæ‰©å®¹ä¹‹å‘" class="headerlink" title="2 Go Sliceæ‰©å®¹ä¹‹å‘"></a>2 Go Sliceæ‰©å®¹ä¹‹å‘</h2><h3 id="çŸ¥è¯†é‡æ¸©"><a href="#çŸ¥è¯†é‡æ¸©" class="headerlink" title="çŸ¥è¯†é‡æ¸©"></a>çŸ¥è¯†é‡æ¸©</h3><p><strong>åˆ‡ç‰‡åº•å±‚ç»“æ„å®šä¹‰</strong>ï¼šåŒ…å«<code>æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆ</code>ã€<code>é•¿åº¦</code>å’Œ<code>å®¹é‡</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> slice <span class="hljs-keyword">struct</span> &#123;<br>  array unsafe.Pointer<br>  <span class="hljs-built_in">len</span>   <span class="hljs-type">int</span><br>  <span class="hljs-built_in">cap</span>   <span class="hljs-type">int</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>appendæ“ä½œ</strong>ï¼šå¯ä»¥æ˜¯1ä¸ªã€å¤šä¸ªã€ç”šè‡³æ•´ä¸ªåˆ‡ç‰‡ï¼ˆè®°å¾—åé¢åŠ â€¦ï¼‰ï¼›æ·»åŠ å…ƒç´ æ—¶å½“å®¹é‡ä¸è¶³ï¼Œåˆ™ä¼šè‡ªåŠ¨è§¦å‘åˆ‡ç‰‡æ‰©å®¹æœºåˆ¶ï¼Œäº§ç”Ÿåˆ‡ç‰‡å‰¯æœ¬ï¼ŒåŒæ—¶æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆå‘ç”Ÿå˜åŒ–</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> nums []<span class="hljs-type">int</span><br>nums = <span class="hljs-built_in">append</span>(nums, <span class="hljs-number">1</span>)<br>nums = <span class="hljs-built_in">append</span>(nums, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br>nums2 := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>&#125;<br>nums = <span class="hljs-built_in">append</span>(nums, nums2...)<br>fmt.Println(nums) <span class="hljs-comment">//[1 2 3 4 5 6 7]</span><br></code></pre></td></tr></table></figure><h3 id="æ¡ˆä¾‹1ï¼šä¼ å€¼-æœªæ‰©å®¹"><a href="#æ¡ˆä¾‹1ï¼šä¼ å€¼-æœªæ‰©å®¹" class="headerlink" title="æ¡ˆä¾‹1ï¼šä¼ å€¼+æœªæ‰©å®¹"></a>æ¡ˆä¾‹1ï¼šä¼ å€¼+æœªæ‰©å®¹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  s1 := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>)<br>  fmt.Println(<span class="hljs-string">&quot;s1åˆ‡ç‰‡: &quot;</span>, s1)<br>  appendFunc(s1)<br>  fmt.Println(<span class="hljs-string">&quot;s1åˆ‡ç‰‡: &quot;</span>, s1)<br>  fmt.Println(<span class="hljs-string">&quot;s1åˆ‡ç‰‡è¡¨è¾¾å¼: &quot;</span>, s1[:<span class="hljs-number">5</span>])<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">appendFunc</span><span class="hljs-params">(s2 []<span class="hljs-type">int</span>)</span></span> &#123;<br>  s2 = <span class="hljs-built_in">append</span>(s2, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>  fmt.Println(<span class="hljs-string">&quot;s2åˆ‡ç‰‡: &quot;</span>, s2)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">s1åˆ‡ç‰‡:  []<br>s2åˆ‡ç‰‡:  [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span>]<br>s1åˆ‡ç‰‡:  []<br>s1åˆ‡ç‰‡è¡¨è¾¾å¼:  [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™ä¸ªç»“æœï¼Œå¤§å®¶å°±ä¼šæœ‰ç–‘é—®äº†ï¼Œ<strong>æ˜æ˜åˆ‡ç‰‡æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸ºä»€ä¹ˆs2 appendäº†æ–°å…ƒç´ åï¼Œs2æ˜¯æœ‰å€¼äº†ä½†s1å´è¿˜æ˜¯ç©ºçš„ï¼Œå¹¶ä¸”å¯¹s1ç”¨åˆ‡ç‰‡è¡¨è¾¾å¼å´èƒ½è·å–åˆ°å€¼å‘¢ï¼Ÿ</strong></p><p>åŸå› åˆ†æå‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹s1å’Œs2åˆ°åº•æ˜¯ä¸æ˜¯åŒä¸€ä¸ªåˆ‡ç‰‡ï¼Œæ‰“å°åœ°å€éªŒè¯ä¸‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  s1 := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>)<br>  fmt.Printf(<span class="hljs-string">&quot;s1åˆ‡ç‰‡åœ°å€: %p\n&quot;</span>, s1)<br>  appendFunc(s1)<br>  <span class="hljs-comment">//...</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">appendFunc</span><span class="hljs-params">(s2 []<span class="hljs-type">int</span>)</span></span> &#123;<br>  s2 = <span class="hljs-built_in">append</span>(s2, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>  fmt.Printf(<span class="hljs-string">&quot;s2åˆ‡ç‰‡åœ°å€: %p\n&quot;</span>, s2)<br>  <span class="hljs-comment">//...</span><br>&#125;<br><br>è¾“å‡ºç»“æœï¼š<br>s1åˆ‡ç‰‡åœ°å€: <span class="hljs-number">0xc000018150</span><br>s2åˆ‡ç‰‡åœ°å€: <span class="hljs-number">0xc000018150</span><br></code></pre></td></tr></table></figure><p><strong>ä¸¤ä¸ªåˆ‡ç‰‡çš„åœ°å€éƒ½æ˜¯åŒä¸€ä¸ªï¼Œs2ä¿®æ”¹ås1ä¹Ÿåº”è¯¥åŒæ­¥ä¿®æ”¹ï¼Œåº”è¯¥éƒ½æœ‰å€¼æ‰å¯¹å•Š</strong></p><p>ç»§ç»­å†æ·±ç©¶ä¸€ä¸‹ï¼Œ<code>fmtåŒ…%p</code>æ‰“å°çš„è¿™ä¸ªåœ°å€ï¼Œåˆ°åº•æ˜¯è°çš„åœ°å€</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><span class="hljs-comment">//fmt/print.go</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *pp)</span></span> fmtPointer(value reflect.Value, verb <span class="hljs-type">rune</span>) &#123;<br>  <span class="hljs-keyword">var</span> u <span class="hljs-type">uintptr</span><br>  <span class="hljs-keyword">switch</span> value.Kind() &#123;<br>  <span class="hljs-keyword">case</span> reflect.Chan, reflect.Func, reflect.Map, reflect.Ptr, reflect.Slice, reflect.UnsafePointer:<br>    u = value.Pointer()<br>  <span class="hljs-keyword">default</span>:<br>    p.badVerb(verb)<br>    <span class="hljs-keyword">return</span><br>  &#125;<br>  <span class="hljs-comment">//...</span><br>&#125;<br><br><span class="hljs-comment">//reflect/value.go</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(v Value)</span></span> Pointer() <span class="hljs-type">uintptr</span> &#123;<br>  k := v.kind()<br>  <span class="hljs-keyword">switch</span> k &#123;<br>  <span class="hljs-comment">//...</span><br>  <br>  <span class="hljs-keyword">case</span> Slice:<br>    <span class="hljs-keyword">return</span> (*SliceHeader)(v.ptr).Data<br>  &#125;<br>  <span class="hljs-built_in">panic</span>(&amp;ValueError&#123;<span class="hljs-string">&quot;reflect.Value.Pointer&quot;</span>, v.kind()&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡åˆ†æfmtåŒ…çš„æºç ï¼Œä¸éš¾å‘ç°ï¼Œ<strong>æ‰“å°çš„åœ°å€ï¼Œå…¶å®æ˜¯åˆ‡ç‰‡é‡ŒæŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆå­˜å‚¨çš„åœ°å€ï¼Œå¹¶ä¸æ˜¯ä¸¤ä¸ªåˆ‡ç‰‡æœ¬èº«çš„åœ°å€</strong>ã€‚åŒæ—¶ä¹Ÿè¯´æ˜è¿™ä¸¤åˆ‡ç‰‡æ˜¯æŒ‡å‘åŒä¸€ä¸ªåº•å±‚æ•°ç»„ã€‚</p><p><strong>åŸå› æ­£å¼åˆ†æ</strong>ï¼š</p><ol><li><strong>ä¼ å€¼æ“ä½œ</strong>ï¼Œs1å’Œs2æ˜¯ä¸¤ä¸ªä¸åŒçš„åˆ‡ç‰‡å˜é‡ï¼Œä½†æ˜¯æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆæ˜¯åŒä¸€ä¸ªï¼›</li><li><strong>é•¿åº¦å’Œå®¹é‡çš„å˜åŒ–</strong>ï¼šs1 Len&#x3D;0å’ŒCap&#x3D;5ï¼Œåæ¥æœªå‘ç”Ÿè¿‡å˜åŒ–ï¼›s2ä¸€å¼€å§‹è¢«èµ‹å€¼æ—¶ Len&#x3D;0å’ŒCap&#x3D;5ï¼Œåœ¨appendæ“ä½œåï¼ŒLen&#x3D;3å’ŒCap&#x3D;5ï¼ŒåŒæ—¶åº•å±‚æ•°ç»„å€¼ä»<code>[0,0,0,0,0]</code>è¢«ä¿®æ”¹æˆäº†<code>[1,2,3,0,0]</code>;</li><li><strong>è¾“å‡ºç»“æœ</strong>ï¼Œs1ç”±äºLen&#x3D;0æ‰€ä»¥è¾“å‡ºç©º[]ï¼Œè€Œs1ç”¨åˆ‡ç‰‡è¡¨è¾¾å¼ï¼Œæ˜¯åŸºäºåº•å±‚æ•°ç»„<code>[1,2,3,0,0]</code>è¿›è¡Œåˆ‡ç‰‡ï¼Œæ‰€ä»¥è¾“å‡ºç»“æœä¸º<code>[1,2,3,0,0]</code>ï¼›</li></ol><h3 id="æ¡ˆä¾‹2ï¼šä¼ å€¼-æ‰©å®¹"><a href="#æ¡ˆä¾‹2ï¼šä¼ å€¼-æ‰©å®¹" class="headerlink" title="æ¡ˆä¾‹2ï¼šä¼ å€¼+æ‰©å®¹"></a>æ¡ˆä¾‹2ï¼šä¼ å€¼+æ‰©å®¹</h3><p>å°†æ¡ˆä¾‹1ï¼Œappendçš„å…ƒç´ ä¸ªæ•°è¶…è¿‡åˆ‡ç‰‡å®¹é‡ï¼Œè§¦å‘è‡ªåŠ¨æ‰©å®¹ï¼Œè¾“å‡ºçš„ç»“æœåˆä¼šæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  s1 := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>)<br>  fmt.Println(<span class="hljs-string">&quot;s1åˆ‡ç‰‡: &quot;</span>, s1)<br>  appendFunc(s1)<br>  fmt.Println(<span class="hljs-string">&quot;s1åˆ‡ç‰‡: &quot;</span>, s1)<br>  fmt.Println(<span class="hljs-string">&quot;s1åˆ‡ç‰‡è¡¨è¾¾å¼: &quot;</span>, s1[:<span class="hljs-number">5</span>])<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">appendFunc</span><span class="hljs-params">(s2 []<span class="hljs-type">int</span>)</span></span> &#123;<br>  s2 = <span class="hljs-built_in">append</span>(s2, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)<br>  fmt.Println(<span class="hljs-string">&quot;s2åˆ‡ç‰‡: &quot;</span>, s2)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><br>s1åˆ‡ç‰‡:  []<br>s2åˆ‡ç‰‡:  [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span>]<br>s1åˆ‡ç‰‡:  []<br>s1åˆ‡ç‰‡è¡¨è¾¾å¼:  [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><p><strong>åŸå› åˆ†æ</strong>ï¼š</p><ol><li><strong>å‘ç”Ÿæ‰©å®¹å</strong>ï¼Œs2æŒ‡å‘çš„åº•å±‚æ•°ç»„ä¼šäº§ç”Ÿå‰¯æœ¬ï¼Œå¯¼è‡´s1å’Œs2ä¸å†æŒ‡å‘åŒä¸€ä¸ªåº•å±‚æ•°ç»„ï¼›</li><li><strong>é•¿åº¦å’Œå®¹é‡çš„å˜åŒ–</strong>ï¼šs2 appendåLen&#x3D;6ã€Cap&#x3D;10å’Œåº•å±‚æ•°ç»„å€¼ä¸º<code>[1,2,3,4,5,6,0,0,0,0]</code>ï¼›s2çš„æ“ä½œå®Œå…¨ä¸å½±å“s1çš„æ•°æ®ï¼Œs1ä»ç„¶æ˜¯Len&#x3D;0ã€Cap&#x3D;5å’Œåº•å±‚æ•°ç»„å€¼ä¸º<code>[0,0,0,0,0]</code>ï¼›</li><li><strong>è¾“å‡ºç»“æœ</strong>ï¼Œs2ç”±äºLen&#x3D;6æ‰€ä»¥è¾“å‡º<code>[1,2,3,4,5,6]</code>ï¼Œs1ç”±äºLen&#x3D;0æ‰€ä»¥è¾“å‡ºç©º[]ï¼Œè€Œs1ç”¨åˆ‡ç‰‡è¡¨è¾¾å¼ï¼Œæ˜¯åŸºäºåº•å±‚æ•°ç»„<code>[0,0,0,0,0]</code>è¿›è¡Œåˆ‡ç‰‡ï¼Œæ‰€ä»¥è¾“å‡ºç»“æœä¸º<code>[0,0,0,0,0]</code>ï¼›</li></ol><h3 id="æ¡ˆä¾‹3ï¼šä¼ å€-ä¸å…³å¿ƒæ‰©å®¹"><a href="#æ¡ˆä¾‹3ï¼šä¼ å€-ä¸å…³å¿ƒæ‰©å®¹" class="headerlink" title="æ¡ˆä¾‹3ï¼šä¼ å€+ä¸å…³å¿ƒæ‰©å®¹"></a>æ¡ˆä¾‹3ï¼šä¼ å€+ä¸å…³å¿ƒæ‰©å®¹</h3><p>ä¸Šé¢ä¸¤ä¸ªä¼ å€¼æ“ä½œçš„ä¾‹å­ï¼Œä¸ç®¡æ‰©å®¹ä¸å¦ï¼Œéƒ½ä¸ä¼šå½±å“åŸåˆ‡ç‰‡s1çš„é•¿åº¦å’Œå®¹é‡ã€‚å¦‚æœæˆ‘ä»¬<strong>æœŸæœ›ä¿®æ”¹s2çš„åŒæ—¶ä¹Ÿä¿®æ”¹åŸåˆ‡ç‰‡s1ï¼Œåˆ™éœ€è¦ç”¨åˆ°åˆ‡ç‰‡æŒ‡é’ˆï¼ŒåŸºäºåœ°å€ä¼ é€’è¿›è¡Œæ“ä½œ</strong>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  s1 := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>)<br>  fmt.Println(<span class="hljs-string">&quot;s1åˆ‡ç‰‡: &quot;</span>, s1)<br>  fmt.Printf(<span class="hljs-string">&quot;s1åˆ‡ç‰‡åœ°å€: %p len:%d cap:%d\n&quot;</span>, &amp;s1, <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">cap</span>(s1))<br>  appendFunc(&amp;s1)<br>  fmt.Println(<span class="hljs-string">&quot;s1åˆ‡ç‰‡: &quot;</span>, s1)<br>  fmt.Println(<span class="hljs-string">&quot;s1åˆ‡ç‰‡è¡¨è¾¾å¼: &quot;</span>, s1[:<span class="hljs-number">5</span>])<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">appendFunc</span><span class="hljs-params">(s2 *[]<span class="hljs-type">int</span>)</span></span> &#123;<br>  fmt.Printf(<span class="hljs-string">&quot;s2åˆ‡ç‰‡åœ°å€: %p len:%d cap:%d\n&quot;</span>, s2, <span class="hljs-built_in">len</span>(*s2), <span class="hljs-built_in">cap</span>(*s2))<br>  <span class="hljs-comment">//*s2 = append(*s2, 1, 2, 3)</span><br>  *s2 = <span class="hljs-built_in">append</span>(*s2, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>)<br>  fmt.Printf(<span class="hljs-string">&quot;appendås2åˆ‡ç‰‡åœ°å€: %p len:%d cap:%d\n&quot;</span>, s2, <span class="hljs-built_in">len</span>(*s2), <span class="hljs-built_in">cap</span>(*s2))<br>  fmt.Println(<span class="hljs-string">&quot;s2åˆ‡ç‰‡: &quot;</span>, *s2)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go">s1åˆ‡ç‰‡:  []<br>s1åˆ‡ç‰‡åœ°å€: <span class="hljs-number">0xc00000c030</span> <span class="hljs-built_in">len</span>:<span class="hljs-number">0</span> <span class="hljs-built_in">cap</span>:<span class="hljs-number">5</span><br>s2åˆ‡ç‰‡åœ°å€: <span class="hljs-number">0xc00000c030</span> <span class="hljs-built_in">len</span>:<span class="hljs-number">0</span> <span class="hljs-built_in">cap</span>:<span class="hljs-number">5</span><br><span class="hljs-built_in">append</span>ås2åˆ‡ç‰‡åœ°å€: <span class="hljs-number">0xc00000c030</span> <span class="hljs-built_in">len</span>:<span class="hljs-number">10</span> <span class="hljs-built_in">cap</span>:<span class="hljs-number">10</span><br>s2åˆ‡ç‰‡:  [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">10</span>]<br>s1åˆ‡ç‰‡:  [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">10</span>]<br>s1åˆ‡ç‰‡è¡¨è¾¾å¼:  [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>]<br></code></pre></td></tr></table></figure><p>ä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œ<strong>ä¼ å€æ“ä½œï¼Œå§‹ç»ˆæ“ä½œçš„æ˜¯åŒä¸€ä¸ªåˆ‡ç‰‡å˜é‡</strong>ï¼Œappendæ“ä½œåï¼Œé•¿åº¦å’Œå®¹é‡éƒ½ä¼šåŒæ—¶å‘ç”Ÿå˜åŒ–ï¼Œä»¥åŠå¦‚æœè§¦å‘æ‰©å®¹ï¼Œé‚£ä¹ˆæŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆï¼Œä¹Ÿéƒ½ä¼šåŒæ—¶å‘ç”Ÿå˜åŒ–ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>åˆ‡ç‰‡ä¼ å€¼æ“ä½œ</strong>ï¼Œappendæœªè§¦å‘æ‰©å®¹ï¼Œä¼šåŒæ—¶ä¿®æ”¹åº•å±‚æ•°ç»„çš„å€¼ï¼Œä½†ä¸ä¼šå½±å“åŸåˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ï¼›å½“è§¦å‘æ‰©å®¹ï¼Œé‚£ä¹ˆä¼šäº§ç”Ÿå‰¯æœ¬ï¼Œåé¢çš„ä¿®æ”¹åˆ™ä¼šå’ŒåŸåº•å±‚æ•°ç»„å‰¥ç¦»å¼€ï¼Œäº’ä¸å½±å“ã€‚</p><p>å¦‚æœæœŸæœ›åœ¨ä¿®æ”¹åˆ‡ç‰‡åï¼Œå¯¹åŸåˆ‡ç‰‡ä¹Ÿå‘ç”Ÿä¿®æ”¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<strong>ä¼ å€æ“ä½œ</strong>ï¼Œå§‹ç»ˆåŸºäºåŒä¸€ä¸ªåˆ‡ç‰‡å˜é‡è¿›è¡Œæ“ä½œ</p>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gormç¬”è®°</title>
    <link href="/2024/12/10/go/gorm%E7%AC%94%E8%AE%B0/"/>
    <url>/2024/12/10/go/gorm%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="gormç¬”è®°"><a href="#gormç¬”è®°" class="headerlink" title="gormç¬”è®°"></a>gormç¬”è®°</h1><h2 id="ä»€ä¹ˆæ˜¯ORM"><a href="#ä»€ä¹ˆæ˜¯ORM" class="headerlink" title="ä»€ä¹ˆæ˜¯ORM"></a>ä»€ä¹ˆæ˜¯ORM</h2><p>Object Relational Mappingï¼šå¯¹è±¡å…³ç³»æ˜ å°„</p><p>ç»“æ„ä½“ å’Œ SQLæ•°æ®åº“å­˜åœ¨æ˜ å°„ï¼Œè¿™ä¸ªæ—¶å€™å°±æœ‰äº†ORMè¯­å¥</p><p>ä¸€å¥è¯è¯´ï¼šå°±æ˜¯å°†æ•°æ®åº“ä¸­çš„è¡¨æ•°æ®å’Œç»“æ„ä½“è¿›è¡Œå¯¹åº”çš„å…³ç³»</p><h2 id="ORMçš„ä¼˜ç¼ºç‚¹"><a href="#ORMçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="ORMçš„ä¼˜ç¼ºç‚¹"></a>ORMçš„ä¼˜ç¼ºç‚¹</h2><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>æé«˜å¼€å‘æ•ˆç‡</li></ul><p><strong>ç¼ºç‚¹:</strong></p><ul><li>ç‰ºç‰²æ‰§è¡Œæ€§èƒ½ã€ä¸­é—´å¤šäº†ä¸€ä¸ªç¯èŠ‚ã€‘</li><li>ç‰ºç‰²çµæ´»æ€§</li><li>å¼±åŒ–SQLèƒ½åŠ›</li></ul><h2 id="GORMåŸºæœ¬ç¤ºä¾‹"><a href="#GORMåŸºæœ¬ç¤ºä¾‹" class="headerlink" title="GORMåŸºæœ¬ç¤ºä¾‹"></a>GORMåŸºæœ¬ç¤ºä¾‹</h2><h3 id="è¿æ¥MySQL"><a href="#è¿æ¥MySQL" class="headerlink" title="è¿æ¥MySQL"></a>è¿æ¥MySQL</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;gorm.io/driver/mysql&quot;</span><br><span class="hljs-string">&quot;gorm.io/gorm&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>dsn := <span class="hljs-string">&quot;user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><br>db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;failed to connect database&quot;</span>)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>GORM ä¼šåœ¨å†…éƒ¨ç®¡ç†è¿æ¥æ± ï¼Œè€Œä¸æ˜¯å•ä¸ªè¿æ¥ã€‚å½“æ‚¨ä½¿ç”¨ <code>gorm.Open</code> æ–¹æ³•æ‰“å¼€æ•°æ®åº“è¿æ¥æ—¶ï¼ŒGORM ä¼šè‡ªåŠ¨åˆ›å»ºå¹¶ç®¡ç†ä¸€ä¸ªè¿æ¥æ± ï¼Œè€Œä¸æ˜¯ä»…ä»…åˆ›å»ºä¸€ä¸ªè¿æ¥ã€‚å› æ­¤ï¼Œæ‚¨æ— éœ€æ˜¾å¼åœ°å…³é—­è¿æ¥æˆ–ç®¡ç†è¿æ¥ç”Ÿå‘½å‘¨æœŸï¼Œé™¤éæ‚¨æƒ³è¦æ˜¾å¼åœ°å…³é—­æ•´ä¸ªè¿æ¥æ± ã€‚</p><p><strong>æ’å…¥æ•°æ®å’Œå…³é—­è¿æ¥</strong></p><ol><li><p><strong>æ’å…¥æ•°æ®</strong>:</p><ul><li>å½“æ‚¨ä½¿ç”¨ GORM çš„ <code>db.Create</code> æˆ–å…¶ä»–ç›¸å…³æ–¹æ³•ï¼ˆå¦‚ <code>Save</code>, <code>Model</code> ç­‰ï¼‰æ’å…¥æ•°æ®æ—¶ï¼ŒGORM ä¼šè‡ªåŠ¨ç®¡ç†äº‹åŠ¡å’Œè¿æ¥æ± ã€‚</li><li>ä¸éœ€è¦æ˜¾å¼å…³é—­è¿æ¥ã€‚</li></ul></li><li><p><strong>å…³é—­è¿æ¥æ± </strong>:</p><ul><li><p>å¦‚æœæ‚¨æƒ³è¦æ˜¾å¼åœ°å…³é—­æ•´ä¸ªè¿æ¥æ± ï¼Œå¯ä»¥ä½¿ç”¨ <code>db.Close</code> æ–¹æ³•ã€‚è¿™é€šå¸¸åœ¨åº”ç”¨å…³é—­æ—¶æ‰§è¡Œã€‚</p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">defer <span class="hljs-keyword">db</span>.<span class="hljs-keyword">Close</span>()<br></code></pre></td></tr></table></figure></li></ul></li></ol><h3 id="GORMæ“ä½œMySQL"><a href="#GORMæ“ä½œMySQL" class="headerlink" title="GORMæ“ä½œMySQL"></a>GORMæ“ä½œMySQL</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;gorm.io/driver/mysql&quot;</span><br><span class="hljs-string">&quot;gorm.io/gorm&quot;</span><br>)<br><br><span class="hljs-comment">// UserInfo ç”¨æˆ·ä¿¡æ¯</span><br><span class="hljs-keyword">type</span> UserInfo <span class="hljs-keyword">struct</span> &#123;<br>ID     <span class="hljs-type">uint</span><br>Name   <span class="hljs-type">string</span><br>Gender <span class="hljs-type">string</span><br>Hobby  <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>dsn := <span class="hljs-string">&quot;root:@tcp(127.0.0.1:3306)/gorm?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><br>db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;failed to connect database&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// è‡ªåŠ¨è¿ç§»</span><br>err = db.AutoMigrate(&amp;UserInfo&#123;&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;failed to migrate&quot;</span>)<br>&#125;<br><br>u1 := UserInfo&#123;<span class="hljs-number">1</span>, <span class="hljs-string">&quot;æ¨æ´‹&quot;</span>, <span class="hljs-string">&quot;ç”·&quot;</span>, <span class="hljs-string">&quot;ç¯®çƒ&quot;</span>&#125;<br><br><span class="hljs-comment">// åˆ›å»ºè®°å½• Createåˆ›å»º</span><br>db.Create(&amp;u1)<br>db.Create(&amp;UserInfo&#123;<span class="hljs-number">2</span>, <span class="hljs-string">&quot;ç‹æ¥šç„¶&quot;</span>, <span class="hljs-string">&quot;å¥³&quot;</span>, <span class="hljs-string">&quot;è¶³çƒ&quot;</span>&#125;)<br>    <br>    <span class="hljs-comment">// åˆ›å»ºè®°å½• Saveåˆ›å»º</span><br>    db.Save(&amp;u1)<br><span class="hljs-comment">// æŸ¥è¯¢</span><br><span class="hljs-keyword">var</span> u = <span class="hljs-built_in">new</span>(UserInfo)<br>db.First(&amp;u, <span class="hljs-number">1</span>) <span class="hljs-comment">// æ ¹æ®æ•´å‹ä¸»é”®æŸ¥æ‰¾</span><br>fmt.Printf(<span class="hljs-string">&quot;%#v\n&quot;</span>, u)<br><br><span class="hljs-keyword">var</span> uu UserInfo<br>db.First(&amp;uu, <span class="hljs-string">&quot;hobby=?&quot;</span>, <span class="hljs-string">&quot;è¶³çƒ&quot;</span>) <span class="hljs-comment">//æŸ¥æ‰¾ hobby å­—æ®µå€¼ä¸º è¶³çƒ çš„è®°å½•</span><br>fmt.Printf(<span class="hljs-string">&quot;%#v\n&quot;</span>, uu)<br><br>    <span class="hljs-keyword">var</span> us []UserInfo<br>    db.Find(&amp;us)<br>fmt.Printf(<span class="hljs-string">&quot;us: %+v\n&quot;</span>, users)<br>    <br><span class="hljs-comment">// æ›´æ–° é€‚åˆä¿®æ”¹æ¨¡å‹ä¸­çš„ç‰¹å®šå­—æ®µæƒ…å†µ</span><br>db.Model(&amp;u).Update(<span class="hljs-string">&quot;hobby&quot;</span>, <span class="hljs-string">&quot;æ’çƒ&quot;</span>)<br>    db.Model(&amp;u).Where(<span class="hljs-string">&quot;id=?&quot;</span>, <span class="hljs-number">3</span>).Update(<span class="hljs-string">&quot;hobby&quot;</span>, <span class="hljs-string">&quot;æ’çƒ&quot;</span>)<br><span class="hljs-comment">//Update - æ›´æ–°å¤šä¸ªå­—æ®µ é€‚åˆä¿®æ”¹æ¨¡å‹ä¸­çš„ç‰¹å®šå­—æ®µæƒ…å†µ</span><br>db.Model(&amp;u).Updates(UserInfo&#123;Name: <span class="hljs-string">&quot;è‚–æˆ˜&quot;</span>, Hobby: <span class="hljs-string">&quot;è·³èˆ&quot;</span>&#125;) <span class="hljs-comment">// ä»…æ›´æ–°éé›¶å€¼å­—æ®µ</span><br>db.Model(&amp;uu).Updates(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;Hobby&quot;</span>: <span class="hljs-string">&quot;æ¼”æˆ&quot;</span>, <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;èµµä¸½é¢–&quot;</span>&#125;)<br><br><span class="hljs-comment">// åˆ é™¤</span><br>db.Delete(&amp;u, <span class="hljs-number">1</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Saveæ–¹æ³•</strong></p><ul><li>ç”¨æ³•ï¼š<code>db.Save(&amp;data)</code></li><li>åŠŸèƒ½ï¼šæ ¹æ®æä¾›çš„æ•°æ®å¯¹è±¡ï¼ˆç»“æ„ä½“ï¼‰æ‰§è¡Œæ’å…¥æˆ–æ›´æ–°æ“ä½œã€‚å¦‚æœæä¾›çš„å¯¹è±¡å·²ç»å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼ˆåŸºäºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼‰ï¼Œåˆ™ä¼šæ‰§è¡Œæ›´æ–°æ“ä½œï¼›å¦åˆ™ï¼Œä¼šæ‰§è¡Œæ’å…¥æ“ä½œã€‚</li><li>å¦‚æœæ•°æ®å¯¹è±¡åŒ…å«äº†ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•å­—æ®µï¼Œåˆ™ GORM å°†ä½¿ç”¨è¿™äº›å­—æ®µæ¥å†³å®šæ˜¯æ‰§è¡Œæ’å…¥è¿˜æ˜¯æ›´æ–°æ“ä½œã€‚</li><li>åœ¨æ‰§è¡Œä¿å­˜æ“ä½œåï¼Œ<code>Save</code> æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª <code>*gorm.DB</code> å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è¯¥å¯¹è±¡çš„ <code>Error</code> å±æ€§æ¥æ£€æŸ¥æ˜¯å¦å‘ç”Ÿé”™è¯¯ã€‚</li></ul><p><strong>Createæ–¹æ³•</strong></p><ul><li>ç”¨æ³•ï¼š<code>db.Create(&amp;data)</code></li><li>åŠŸèƒ½ï¼šå°†æä¾›çš„æ•°æ®å¯¹è±¡æ’å…¥åˆ°æ•°æ®åº“ä¸­ã€‚å®ƒä¸ <code>Save</code> æ–¹æ³•çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåªæ‰§è¡Œæ’å…¥æ“ä½œï¼Œä¸ä¼šå°è¯•è¿›è¡Œæ›´æ–°æ“ä½œã€‚</li><li><code>Create</code> æ–¹æ³•ä¼šå¿½ç•¥æ•°æ®å¯¹è±¡ä¸­çš„ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•å­—æ®µï¼Œè€Œæ˜¯ä½¿ç”¨æ•°æ®åº“ç”Ÿæˆçš„é»˜è®¤å€¼ï¼ˆå¦‚è‡ªå¢ IDï¼‰æˆ–éšæœºå€¼æ¥å¡«å……è¿™äº›å­—æ®µã€‚</li><li>ç±»ä¼¼äº <code>Save</code> æ–¹æ³•ï¼Œ<code>Create</code> æ–¹æ³•ä¹Ÿè¿”å›ä¸€ä¸ª <code>*gorm.DB</code> å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è¯¥å¯¹è±¡çš„ <code>Error</code> å±æ€§æ¥æ£€æŸ¥æ˜¯å¦å‘ç”Ÿé”™è¯¯ã€‚</li></ul><h3 id="åŸç”ŸSQL"><a href="#åŸç”ŸSQL" class="headerlink" title="åŸç”ŸSQL"></a>åŸç”ŸSQL</h3><p>åœ¨ GORM æ¡†æ¶ä¸­ï¼Œ<code>Row</code>, <code>Exec</code>, ä»¥åŠç›¸å…³çš„å‡½æ•°è¢«ç”¨æ¥æ‰§è¡ŒåŸå§‹ SQL æŸ¥è¯¢æˆ–å‘½ä»¤ã€‚è¿™äº›æ–¹æ³•å…è®¸ä½ åœ¨ GORM çš„ ORM æŠ½è±¡ä¹‹ä¸Šç›´æ¥ä½¿ç”¨ SQLï¼Œè¿™å¯¹äºéœ€è¦æ›´ç»†ç²’åº¦æ§åˆ¶æˆ–æ‰§è¡Œæ— æ³•é€šè¿‡ GORM ORM æ–¹æ³•è½»æ˜“è¡¨è¾¾çš„å¤æ‚æŸ¥è¯¢æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><ol><li><p><strong>Row</strong></p><ul><li><p><code>Row</code> æ–¹æ³•ç”¨äºæ‰§è¡Œ SELECT æŸ¥è¯¢ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>*sql.Row</code> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥ç”¨æ¥æ‰«æå•è¡Œç»“æœã€‚å¦‚æœæŸ¥è¯¢è¿”å›å¤šè¡Œï¼Œ<code>Row</code> å°†åªè¿”å›ç¬¬ä¸€è¡Œã€‚ã€</p></li><li><p>ä½¿ç”¨ <code>Row</code> åï¼Œéœ€è¦è°ƒç”¨ <code>Scan</code> æ–¹æ³•æ¥å°†æ•°æ®åº“æŸ¥è¯¢çš„ç»“æœæ˜ å°„åˆ° Go ç»“æ„ä½“ä¸­ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> name <span class="hljs-type">string</span><br>db.Raw(<span class="hljs-string">&quot;SELECT name FROM users WHERE id = ?&quot;</span>, <span class="hljs-number">1</span>).Row().Scan(&amp;name)<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>Rows</strong>:</p><ul><li><p><code>Rows</code> æ–¹æ³•ä¹Ÿç”¨äºæ‰§è¡Œ SELECT æŸ¥è¯¢ï¼Œä½†å®ƒè¿”å›ä¸€ä¸ª <code>*sql.Rows</code> å¯¹è±¡ï¼Œå¯ä»¥è¿­ä»£å¤šè¡Œç»“æœã€‚</p></li><li><p>ä½¿ç”¨ <code>Rows</code> åï¼Œå¯ä»¥å¾ªç¯éå†ç»“æœé›†ï¼Œç›´åˆ°æ‰€æœ‰è¡Œéƒ½è¢«è¯»å–å®Œæ¯•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go">rows := db.Raw(<span class="hljs-string">&quot;SELECT name FROM users&quot;</span>).Rows()<br><span class="hljs-keyword">defer</span> rows.Close()<span class="hljs-comment">//å…³é—­ä¸€ä¸ªç”±sql.Rowsç±»å‹è¡¨ç¤ºçš„ç»“æœé›†</span><br><span class="hljs-keyword">for</span> rows.Next() &#123;<br>    <span class="hljs-keyword">var</span> name <span class="hljs-type">string</span><br>    err := rows.Scan(&amp;name)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†é”™è¯¯</span><br>    &#125;<br>    fmt.Println(name)<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">*sql.Rowså¯¹è±¡ç»´æŠ¤äº†ä¸€ä¸ªåˆ°æ•°æ®åº“çš„æ´»åŠ¨è¿æ¥ï¼Œä½¿å¾—ä½ å¯ä»¥é€è¡Œåœ°æ‰«æç»“æœé›†ã€‚ç„¶è€Œï¼Œè¿™ä¹Ÿä¼šå ç”¨æ•°æ®åº“è¿æ¥æ± ä¸­çš„ä¸€ä¸ªè¿æ¥ã€‚ä¸€æ—¦ä½ å®Œæˆäº†å¯¹ç»“æœé›†çš„æ“ä½œï¼Œå°±åº”è¯¥è°ƒç”¨rows.Close()æ–¹æ³•æ¥é‡Šæ”¾è¿™ä¸ªè¿æ¥ï¼Œè®©å®ƒå¯ä»¥è¢«è¿æ¥æ± é‡ç”¨ï¼Œæˆ–è€…è¿”å›ç»™æ•°æ®åº“ï¼Œä»¥ä¾¿å…¶ä»–æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ã€‚</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>Execï¼š</strong></p><ul><li><p><code>Exec</code> æ–¹æ³•ç”¨äºæ‰§è¡Œä¸è¿”å›ç»“æœé›†çš„ SQL å‘½ä»¤ï¼Œå¦‚ INSERT, UPDATE, DELETE æˆ–å…¶ä»– DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰è¯­å¥ã€‚</p></li><li><p>å®ƒè¿”å›ä¸€ä¸ª <code>sql.Result</code> å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥è·å–å—å½±å“çš„è¡Œæ•°æˆ–æœ€åæ’å…¥çš„ IDã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">result := db.Exec(<span class="hljs-string">&quot;UPDATE users SET name = ? WHERE id = ?&quot;</span>, <span class="hljs-string">&quot;New Name&quot;</span>, <span class="hljs-number">1</span>)<br>affected, _ := result.RowsAffected()<br></code></pre></td></tr></table></figure></li></ul></li></ol><h3 id="è¿æ¥æ± ï¼ˆConnection-Poolingï¼‰"><a href="#è¿æ¥æ± ï¼ˆConnection-Poolingï¼‰" class="headerlink" title="è¿æ¥æ± ï¼ˆConnection Poolingï¼‰"></a>è¿æ¥æ± ï¼ˆConnection Poolingï¼‰</h3><p>Gormé»˜è®¤ä½¿ç”¨äº†æ•°æ®åº“è¿æ¥æ± ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®è¿æ¥æ± çš„å¤§å°å’Œå…¶ä»–å‚æ•°ã€‚åœ¨åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ—¶ï¼Œå¯ä»¥æŒ‡å®š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-string">&quot;maxidleconns&quot;</span>:    <span class="hljs-number">10</span>,               <span class="hljs-comment">//æœ€å¤§ç©ºé—²è¿æ¥æ•°</span><br><span class="hljs-string">&quot;maxopenconns&quot;</span>:    <span class="hljs-number">100</span>,              <span class="hljs-comment">//è¿æ¥æ± ä¸­å…è®¸çš„æœ€å¤§è¿æ¥æ•°</span><br><span class="hljs-string">&quot;connmaxlifetime&quot;</span>: <span class="hljs-number">10</span> * time.Minute, <span class="hljs-comment">//å•ä¸ªè¿æ¥çš„æœ€å¤§å­˜æ´»æ—¶é—´</span><br></code></pre></td></tr></table></figure><p>è¿æ¥æ± çš„å®ç°åŸç†ä¸»è¦åŒ…æ‹¬è¿æ¥çš„è·å–ã€å½’è¿˜å’Œå›æ”¶ä¸‰ä¸ªç¯èŠ‚ã€‚å½“åº”ç”¨ç¨‹åºéœ€è¦æ•°æ®åº“è¿æ¥æ—¶ï¼Œè¿æ¥æ± ä¼šä¼˜å…ˆè¿”å›ä¸€ä¸ªç©ºé—²è¿æ¥ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨çš„è¿æ¥åˆ™åˆ›å»ºä¸€ä¸ªæ–°è¿æ¥ï¼›å½“è¿æ¥ä½¿ç”¨å®Œæ¯•åï¼Œåº”ç”¨ç¨‹åºä¼šå°†è¿æ¥å½’è¿˜ç»™è¿æ¥æ± ï¼Œè€Œä¸æ˜¯é”€æ¯è¿æ¥ï¼›è¿æ¥æ± è¿˜ä¼šå®šæ—¶æ£€æµ‹è¿æ¥çš„å¥åº·çŠ¶æ€ï¼Œå¯¹ä¸å¯ç”¨çš„è¿æ¥è¿›è¡Œå›æ”¶å’Œé‡å»ºã€‚</p><p>åœ¨Gormä¸­ï¼Œè¿æ¥æ± çš„ç®¡ç†ç”±åº•å±‚æ•°æ®åº“é©±åŠ¨å®ç°ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡Gormæä¾›çš„æ¥å£è¿›è¡Œè¿æ¥æ± çš„é…ç½®å’Œä½¿ç”¨ï¼Œè€Œæ— éœ€å…³å¿ƒå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// Demo for gorm</span><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;gorm.io/driver/mysql&quot;</span><br><span class="hljs-string">&quot;gorm.io/gorm&quot;</span><br><span class="hljs-string">&quot;gorm.io/gorm/logger&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-comment">// DbConfig ä½¿ç”¨å­—é¢é‡è¯­æ³•åˆå§‹åŒ–é…ç½®</span><br><span class="hljs-keyword">var</span> DbConfig = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<br><span class="hljs-string">&quot;ip&quot;</span>:              <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br><span class="hljs-string">&quot;port&quot;</span>:            <span class="hljs-string">&quot;13306&quot;</span>,<br><span class="hljs-string">&quot;user&quot;</span>:            <span class="hljs-string">&quot;root&quot;</span>,<br><span class="hljs-string">&quot;password&quot;</span>:        <span class="hljs-string">&quot;Super000&quot;</span>,<br><span class="hljs-string">&quot;dbname&quot;</span>:          <span class="hljs-string">&quot;test&quot;</span>,<br><span class="hljs-string">&quot;maxidleconns&quot;</span>:    <span class="hljs-number">10</span>,               <span class="hljs-comment">//æœ€å¤§ç©ºé—²è¿æ¥æ•°</span><br><span class="hljs-string">&quot;maxopenconns&quot;</span>:    <span class="hljs-number">100</span>,              <span class="hljs-comment">//è¿æ¥æ± ä¸­å…è®¸çš„æœ€å¤§è¿æ¥æ•°</span><br><span class="hljs-string">&quot;connmaxlifetime&quot;</span>: <span class="hljs-number">10</span> * time.Minute, <span class="hljs-comment">//å•ä¸ªè¿æ¥çš„æœ€å¤§å­˜æ´»æ—¶é—´</span><br>&#125;<br><br><span class="hljs-comment">// è·å–mysql</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getMysql</span><span class="hljs-params">()</span></span> (*gorm.DB, <span class="hljs-type">error</span>) &#123;<br><span class="hljs-comment">// æ„å»º DSN</span><br>dsn := fmt.Sprintf(<span class="hljs-string">&quot;%s:%s@tcp(%s:%s)/%s?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>,<br>DbConfig[<span class="hljs-string">&quot;user&quot;</span>].(<span class="hljs-type">string</span>),<br>DbConfig[<span class="hljs-string">&quot;password&quot;</span>].(<span class="hljs-type">string</span>),<br>DbConfig[<span class="hljs-string">&quot;ip&quot;</span>].(<span class="hljs-type">string</span>),<br>DbConfig[<span class="hljs-string">&quot;port&quot;</span>].(<span class="hljs-type">string</span>),<br>DbConfig[<span class="hljs-string">&quot;dbname&quot;</span>].(<span class="hljs-type">string</span>),<br>)<br><span class="hljs-comment">// æ‰“å¼€æ•°æ®åº“è¿æ¥</span><br>db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;<br>Logger: logger.Default.LogMode(logger.Info),<br>&#125;)<br><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;è¿æ¥æ•°æ®åº“å¤±è´¥ï¼š%w&quot;</span>, err)<br>&#125;<br><span class="hljs-comment">// è®¾ç½®è¿æ¥æ± å‚æ•°</span><br>sqlDB, err := db.DB()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;è·å–åº•å±‚ SQL DB å¤±è´¥ï¼š%w&quot;</span>, err)<br>&#125;<br><span class="hljs-comment">// è®¾ç½®è¿æ¥æ± å‚æ•°</span><br>sqlDB.SetMaxIdleConns(DbConfig[<span class="hljs-string">&quot;maxidleconns&quot;</span>].(<span class="hljs-type">int</span>))<br>sqlDB.SetMaxOpenConns(DbConfig[<span class="hljs-string">&quot;maxopenconns&quot;</span>].(<span class="hljs-type">int</span>))<br>sqlDB.SetConnMaxLifetime(DbConfig[<span class="hljs-string">&quot;connmaxlifetime&quot;</span>].(time.Duration))<br><br><span class="hljs-keyword">return</span> db, <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>gorm.Model<br>Name <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;primary_key;column:user_name;type:varchar(100);&quot;`</span><br><span class="hljs-comment">//Age  int    `gorm:&quot;column:age;type:int&quot;`</span><br>Class <span class="hljs-type">int</span> <span class="hljs-string">`gorm:&quot;column:class;type:int&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u User)</span></span> TableName() <span class="hljs-type">string</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;users&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>db, err := getMysql()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;è¿æ¥æ•°æ®åº“å¤±è´¥: %v\n&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-comment">// è‡ªåŠ¨è¿ç§»(è¡¨ä¸­ç¼ºå°‘è¿ç§»æ˜ å°„çš„ç»“æ„ä½“å­—æ®µ ä¼šå¢åŠ åˆ°tableä¸­ï¼Œtableä¸­å¤šäºçš„å­—æ®µä¸ä¼šåˆ é™¤ï¼Œæ•°æ®æ— å½±å“)</span><br>err = db.AutoMigrate(&amp;User&#123;&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;è‡ªåŠ¨è¿ç§»å¤±è´¥: %v\n&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>sqlDB, err := db.DB()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;è·å–æ•°æ®åº“è¿æ¥å¤±è´¥: %v\n&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> sqlDB.Close()<br>fmt.Println(<span class="hljs-string">&quot;æ­£å¼é€€å‡º&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¼šè¯ï¼ˆSessionsï¼‰"><a href="#ä¼šè¯ï¼ˆSessionsï¼‰" class="headerlink" title="ä¼šè¯ï¼ˆSessionsï¼‰"></a>ä¼šè¯ï¼ˆSessionsï¼‰</h3><p>ä¼šè¯åœ¨GORMä¸­æŒ‡çš„æ˜¯å¯¹æ•°æ®åº“è¿æ¥çš„ä¸€æ¬¡ä½¿ç”¨è¿‡ç¨‹ï¼Œå®ƒå…è®¸ä½ è®¾ç½®ç‰¹å®šäºæœ¬æ¬¡ä¼šè¯çš„è¡Œä¸ºï¼Œä¾‹å¦‚ç¦ç”¨é»˜è®¤äº‹åŠ¡ã€è®¾ç½®åªè¯»æ¨¡å¼ç­‰ã€‚ä½¿ç”¨ä¼šè¯å¯ä»¥è®©ä½ åœ¨ä¸æ”¹å˜å…¨å±€é…ç½®çš„æƒ…å†µä¸‹ï¼Œé’ˆå¯¹ç‰¹å®šçš„æ“ä½œå®šåˆ¶è¡Œä¸ºã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ å¸Œæœ›åœ¨æŸæ¬¡æ“ä½œä¸­ç¦ç”¨é»˜è®¤äº‹åŠ¡ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ç‰¹å®šé…ç½®çš„ä¼šè¯ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs golang">session := db.Session(&amp;gorm.Session&#123;SkipDefaultTransaction: <span class="hljs-literal">true</span>&#125;)<br></code></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨è¿™ä¸ª<code>session</code>å˜é‡æ‰§è¡Œæ•°æ®åº“æ“ä½œã€‚</p><h3 id="äº‹åŠ¡ï¼ˆTransactionsï¼‰"><a href="#äº‹åŠ¡ï¼ˆTransactionsï¼‰" class="headerlink" title="äº‹åŠ¡ï¼ˆTransactionsï¼‰"></a>äº‹åŠ¡ï¼ˆTransactionsï¼‰</h3><p>GORMæ”¯æŒæ•°æ®åº“äº‹åŠ¡ï¼Œäº‹åŠ¡æ˜¯æ•°æ®åº“æ“ä½œçš„ä¸€ä¸ªå•å…ƒï¼Œå®ƒèƒ½ç¡®ä¿ä¸€ç³»åˆ—æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚è¿™å¯¹äºéœ€è¦ä¿æŒæ•°æ®ä¸€è‡´æ€§çš„æ“ä½œè‡³å…³é‡è¦ï¼Œä¾‹å¦‚åœ¨è½¬è´¦åœºæ™¯ä¸­ï¼Œä»ä¸€ä¸ªè´¦æˆ·æ‰£æ¬¾åŒæ—¶éœ€è¦å‘å¦ä¸€ä¸ªè´¦æˆ·åŠ æ¬¾ï¼Œè¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»ä¸€èµ·æˆåŠŸæˆ–å¤±è´¥ã€‚</p><p>åœ¨GORMä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>Transaction</code>å‡½æ•°æ¥å¯åŠ¨ä¸€ä¸ªæ–°çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ‰€æœ‰åœ¨è¯¥å›è°ƒä¸­æ‰§è¡Œçš„æ•°æ®åº“æ“ä½œéƒ½å°†çº³å…¥åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚å¦‚æœå›è°ƒå‡½æ•°æ‰§è¡ŒæˆåŠŸï¼Œåˆ™äº‹åŠ¡ä¼šè¢«æäº¤ï¼›å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™äº‹åŠ¡ä¼šè¢«å›æ»šï¼ˆé»˜è®¤è‡ªåŠ¨ï¼‰ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/jinzhu/gorm&quot;</span><br>_ <span class="hljs-string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span><br>)<br><br><span class="hljs-comment">// Account ç”¨æˆ·è´¦æˆ·æ¨¡å‹</span><br><span class="hljs-keyword">type</span> Account <span class="hljs-keyword">struct</span> &#123;<br>gorm.Model<br>UserID    <span class="hljs-type">uint</span>   <span class="hljs-comment">// ç”¨æˆ·ID</span><br>Balance   <span class="hljs-type">float64</span> <span class="hljs-comment">// è´¦æˆ·ä½™é¢</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ï¼ˆè¯·æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢DSNï¼‰</span><br>db, err := gorm.Open(<span class="hljs-string">&quot;mysql&quot;</span>, <span class="hljs-string">&quot;user:password@/dbname?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;failed to connect database&quot;</span>)<br>&#125;<br><span class="hljs-keyword">defer</span> db.Close()<br><br><span class="hljs-comment">// è‡ªåŠ¨è¿ç§»æ¨¡å‹</span><br>db.AutoMigrate(&amp;Account&#123;&#125;)<br><br><span class="hljs-comment">// å‡†å¤‡æ•°æ®ï¼šå‡è®¾å·²ç»å­˜åœ¨ä¸¤ä¸ªç”¨æˆ·è´¦æˆ·</span><br>accountFrom := Account&#123;UserID: <span class="hljs-number">1</span>, Balance: <span class="hljs-number">1000</span>&#125;<br>accountTo := Account&#123;UserID: <span class="hljs-number">2</span>, Balance: <span class="hljs-number">500</span>&#125;<br>db.Create(&amp;accountFrom)<br>db.Create(&amp;accountTo)<br><br><span class="hljs-comment">// å®šä¹‰è½¬è´¦é‡‘é¢</span><br>transferAmount := <span class="hljs-number">300</span><br><br><span class="hljs-comment">// å¼€å§‹äº‹åŠ¡å¤„ç†è½¬è´¦</span><br>err = db.Transaction(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *gorm.DB)</span></span> <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">// æ£€æŸ¥è½¬å‡ºè´¦æˆ·ä½™é¢æ˜¯å¦è¶³å¤Ÿ</span><br><span class="hljs-keyword">var</span> fromAccount Account<br><span class="hljs-keyword">if</span> err := tx.Where(<span class="hljs-string">&quot;user_id = ?&quot;</span>, accountFrom.UserID).First(&amp;fromAccount).Error; err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// å¦‚æœæŸ¥è¯¢å‡ºé”™ï¼Œç›´æ¥è¿”å›é”™è¯¯ï¼ŒGORMå°†ä¼šè‡ªåŠ¨å›æ»šäº‹åŠ¡</span><br><span class="hljs-keyword">return</span> err<br>&#125;<br><span class="hljs-keyword">if</span> fromAccount.Balance &lt; transferAmount &#123;<br><span class="hljs-comment">// å¦‚æœä½™é¢ä¸è¶³ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œè¿™ä¹Ÿå°†å¯¼è‡´äº‹åŠ¡å›æ»š</span><br><span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;insufficient balance in the sender&#x27;s account&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// æ›´æ–°è´¦æˆ·ä½™é¢</span><br><span class="hljs-keyword">if</span> err := tx.Model(&amp;Account&#123;&#125;).Where(<span class="hljs-string">&quot;id = ?&quot;</span>, fromAccount.ID).Update(<span class="hljs-string">&quot;balance&quot;</span>, gorm.Expr(<span class="hljs-string">&quot;balance - ?&quot;</span>, transferAmount)).Error; err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// æ›´æ–°æ“ä½œå¤±è´¥ï¼Œé”™è¯¯è¢«è¿”å›åï¼ŒGORMå°†è‡ªåŠ¨æ‰§è¡Œäº‹åŠ¡å›æ»š</span><br><span class="hljs-keyword">return</span> err<br>&#125;<br><br><span class="hljs-keyword">if</span> err := tx.Model(&amp;Account&#123;&#125;).Where(<span class="hljs-string">&quot;id = ?&quot;</span>, accountTo.ID).Update(<span class="hljs-string">&quot;balance&quot;</span>, gorm.Expr(<span class="hljs-string">&quot;balance + ?&quot;</span>, transferAmount)).Error; err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// åŒæ ·ï¼Œè¿™é‡Œçš„é”™è¯¯ä¹Ÿä¼šè§¦å‘äº‹åŠ¡å›æ»š</span><br><span class="hljs-keyword">return</span> err<br>&#125;<br><br><span class="hljs-comment">// å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä¸è¿”å›ä»»ä½•é”™è¯¯ï¼ˆå³è¿”å›nilï¼‰ï¼ŒGORMå°†ä¼šè‡ªåŠ¨æäº¤äº‹åŠ¡</span><br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;)<br><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;Transaction failed and was rolled back: %v\n&quot;</span>, err)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Transaction completed successfully and was committed.&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// äº‹åŠ¡åçš„å…¶ä»–æ“ä½œ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨GORMä¸­ï¼Œè™½ç„¶äº‹åŠ¡å¤„ç†é€šå¸¸æ˜¯é€šè¿‡æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ç»™<code>Transaction</code>æ–¹æ³•æ¥è‡ªåŠ¨ç®¡ç†æäº¤å’Œå›æ»šçš„ï¼Œä½†å¦‚æœä½ éœ€è¦æ›´ç»†ç²’åº¦çš„æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡æµç¨‹ï¼ˆå°½ç®¡è¿™åœ¨GORMä¸­ä¸å¸¸è§ï¼‰ï¼Œå¯ä»¥é€šè¿‡ç›´æ¥æ“ä½œåº•å±‚çš„<code>*sql.Tx</code>å¯¹è±¡æ¥å®ç°ã€‚ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ‰‹åŠ¨å¼€å§‹ã€æäº¤æˆ–å›æ»šäº‹åŠ¡ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;database/sql&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><br><span class="hljs-string">&quot;gorm.io/driver/mysql&quot;</span><br><span class="hljs-string">&quot;gorm.io/gorm&quot;</span><br>)<br><br><span class="hljs-comment">// Account ç”¨æˆ·è´¦æˆ·æ¨¡å‹</span><br><span class="hljs-keyword">type</span> Account <span class="hljs-keyword">struct</span> &#123;<br>gorm.Model<br>UserID    <span class="hljs-type">uint</span>   <span class="hljs-comment">// ç”¨æˆ·ID</span><br>Balance   <span class="hljs-type">float64</span> <span class="hljs-comment">// è´¦æˆ·ä½™é¢</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>dsn := <span class="hljs-string">&quot;user:password@tcp(localhost:3306)/dbname?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><br>db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to connect database: %v&quot;</span>, err)<br>&#125;<br>sqlDB, err := db.DB()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to get *sql.DB instance: %v&quot;</span>, err)<br>&#125;<br><span class="hljs-keyword">defer</span> sqlDB.Close()<br><br><span class="hljs-comment">// è‡ªåŠ¨è¿ç§»æ¨¡å‹</span><br>db.AutoMigrate(&amp;Account&#123;&#125;)<br><br><span class="hljs-comment">// å‡†å¤‡æ•°æ®ï¼šå‡è®¾å·²ç»å­˜åœ¨ä¸¤ä¸ªç”¨æˆ·è´¦æˆ·</span><br>accountFrom := Account&#123;UserID: <span class="hljs-number">1</span>, Balance: <span class="hljs-number">1000</span>&#125;<br>accountTo := Account&#123;UserID: <span class="hljs-number">2</span>, Balance: <span class="hljs-number">500</span>&#125;<br>db.Create(&amp;accountFrom)<br>db.Create(&amp;accountTo)<br><br><span class="hljs-comment">// å®šä¹‰è½¬è´¦é‡‘é¢</span><br>transferAmount := <span class="hljs-number">300</span><br><br><span class="hljs-comment">// æ‰‹åŠ¨å¼€å§‹äº‹åŠ¡</span><br>tx, err := sqlDB.Begin()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to begin transaction: %v&quot;</span>, err)<br>&#125;<br><br><span class="hljs-comment">// åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œæ“ä½œ</span><br><span class="hljs-keyword">var</span> fromAccount Account<br><span class="hljs-keyword">if</span> err := db.WithContext(tx.Context()).Where(<span class="hljs-string">&quot;user_id = ?&quot;</span>, accountFrom.UserID).First(&amp;fromAccount).Error; err != <span class="hljs-literal">nil</span> &#123;<br>log.Printf(<span class="hljs-string">&quot;Error querying account: %v&quot;</span>, err)<br>tx.Rollback() <span class="hljs-comment">// æŸ¥è¯¢å‡ºé”™ï¼Œæ‰‹åŠ¨å›æ»šäº‹åŠ¡</span><br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> fromAccount.Balance &lt; transferAmount &#123;<br>log.Println(<span class="hljs-string">&quot;Insufficient balance&quot;</span>)<br>tx.Rollback() <span class="hljs-comment">// ä½™é¢ä¸è¶³ï¼Œæ‰‹åŠ¨å›æ»šäº‹åŠ¡</span><br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">if</span> err := db.WithContext(tx.Context()).Model(&amp;Account&#123;&#125;).Where(<span class="hljs-string">&quot;id = ?&quot;</span>, fromAccount.ID).Update(<span class="hljs-string">&quot;balance&quot;</span>, gorm.Expr(<span class="hljs-string">&quot;balance - ?&quot;</span>, transferAmount)).Error; err != <span class="hljs-literal">nil</span> &#123;<br>log.Printf(<span class="hljs-string">&quot;Error deducting from account: %v&quot;</span>, err)<br>tx.Rollback() <span class="hljs-comment">// æ›´æ–°å¤±è´¥ï¼Œæ‰‹åŠ¨å›æ»šäº‹åŠ¡</span><br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">if</span> err := db.WithContext(tx.Context()).Model(&amp;Account&#123;&#125;).Where(<span class="hljs-string">&quot;id = ?&quot;</span>, accountTo.ID).Update(<span class="hljs-string">&quot;balance&quot;</span>, gorm.Expr(<span class="hljs-string">&quot;balance + ?&quot;</span>, transferAmount)).Error; err != <span class="hljs-literal">nil</span> &#123;<br>log.Printf(<span class="hljs-string">&quot;Error adding to account: %v&quot;</span>, err)<br>tx.Rollback() <span class="hljs-comment">// æ›´æ–°å¤±è´¥ï¼Œæ‰‹åŠ¨å›æ»šäº‹åŠ¡</span><br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-comment">// æ‰€æœ‰æ“ä½œæˆåŠŸï¼Œæ‰‹åŠ¨æäº¤äº‹åŠ¡</span><br><span class="hljs-keyword">if</span> err := tx.Commit(); err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to commit transaction: %v&quot;</span>, err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;Transaction completed successfully.&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><h3 id="1ã€-æ•°æ®åº“è¿æ¥æ± çš„é…ç½®"><a href="#1ã€-æ•°æ®åº“è¿æ¥æ± çš„é…ç½®" class="headerlink" title="1ã€ æ•°æ®åº“è¿æ¥æ± çš„é…ç½®"></a>1ã€ æ•°æ®åº“è¿æ¥æ± çš„é…ç½®</h3><p>Go çš„ <code>database/sql</code> åŒ…æä¾›äº†è¿æ¥æ± çš„åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¾ç½®æœ€å¤§ç©ºé—²è¿æ¥ã€æœ€å¤§æ‰“å¼€è¿æ¥æ•°å’Œè¿æ¥çš„æœ€å¤§ç”Ÿå‘½å‘¨æœŸæ¥ä¼˜åŒ–è¿æ¥æ± ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go">db, err := sql.Open(<span class="hljs-string">&quot;mysql&quot;</span>, <span class="hljs-string">&quot;user:password@tcp(127.0.0.1:3306)/dbname&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    log.Fatal(err)<br>&#125;<br><br><span class="hljs-comment">// è®¾ç½®æœ€å¤§ç©ºé—²è¿æ¥æ•°</span><br>db.SetMaxIdleConns(<span class="hljs-number">10</span>)<br><br><span class="hljs-comment">// è®¾ç½®æœ€å¤§æ‰“å¼€è¿æ¥æ•°</span><br>db.SetMaxOpenConns(<span class="hljs-number">100</span>)<br><br><span class="hljs-comment">// è®¾ç½®è¿æ¥çš„æœ€å¤§ç”Ÿå‘½å‘¨æœŸ</span><br>db.SetConnMaxLifetime(time.Hour)<br></code></pre></td></tr></table></figure><h3 id="2ã€ä½¿ç”¨è¿æ¥æ± "><a href="#2ã€ä½¿ç”¨è¿æ¥æ± " class="headerlink" title="2ã€ä½¿ç”¨è¿æ¥æ± "></a>2ã€ä½¿ç”¨è¿æ¥æ± </h3><p>åˆç†çš„è¿æ¥æ± é…ç½®å¯ä»¥å‡å°‘æ¯æ¬¡è¯·æ±‚æ•°æ®åº“çš„å»¶è¿Ÿï¼Œå¹¶ä¸”å‡å°‘æ•°æ®åº“æœåŠ¡å™¨çš„è´Ÿè½½ã€‚</p><ul><li><strong>SetMaxIdleConns</strong>: è®¾ç½®è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥æ•°ã€‚ä¿æŒä¸€äº›ç©ºé—²è¿æ¥å¯ä»¥ä½¿åº”ç”¨ç¨‹åºæ›´å¿«åœ°å“åº”æ–°çš„è¿æ¥è¯·æ±‚ã€‚</li><li><strong>SetMaxOpenConns</strong>: è®¾ç½®æ•°æ®åº“çš„æœ€å¤§è¿æ¥æ•°ã€‚é™åˆ¶æœ€å¤§è¿æ¥æ•°å¯ä»¥é˜²æ­¢æ•°æ®åº“æœåŠ¡å™¨å› è¿‡å¤šçš„è¿æ¥è€Œè¿‡è½½ã€‚</li><li><strong>SetConnMaxLifetime</strong>: è®¾ç½®è¿æ¥å¯ä»¥é‡ç”¨çš„æœ€é•¿æ—¶é—´ã€‚å®šæœŸåˆ·æ–°è¿æ¥å¯ä»¥é¿å…ä½¿ç”¨é•¿æœŸè¿æ¥å¸¦æ¥çš„é—®é¢˜ã€‚</li></ul><h3 id="3ã€é«˜æ•ˆçš„æŸ¥è¯¢å’Œç´¢å¼•"><a href="#3ã€é«˜æ•ˆçš„æŸ¥è¯¢å’Œç´¢å¼•" class="headerlink" title="3ã€é«˜æ•ˆçš„æŸ¥è¯¢å’Œç´¢å¼•"></a>3ã€é«˜æ•ˆçš„æŸ¥è¯¢å’Œç´¢å¼•</h3><p>ç¡®ä¿æ‚¨çš„ SQL æŸ¥è¯¢æ˜¯é«˜æ•ˆçš„ï¼Œå¹¶ä¸”æ•°æ®åº“è¡¨ä¸Šæœ‰é€‚å½“çš„ç´¢å¼•ã€‚</p><ul><li><strong>ç´¢å¼•</strong>: ä¸ºé¢‘ç¹æŸ¥è¯¢çš„åˆ—åˆ›å»ºç´¢å¼•å¯ä»¥æ˜¾è‘—æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</li><li><strong>æŸ¥è¯¢ä¼˜åŒ–</strong>: ä½¿ç”¨ <code>EXPLAIN</code> åˆ†ææŸ¥è¯¢ï¼Œç¡®ä¿æŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¹¶å°½é‡å‡å°‘å…¨è¡¨æ‰«æã€‚</li></ul><h3 id="4ã€-é¿å…è¿‡å¤šçš„äº‹åŠ¡"><a href="#4ã€-é¿å…è¿‡å¤šçš„äº‹åŠ¡" class="headerlink" title="4ã€ é¿å…è¿‡å¤šçš„äº‹åŠ¡"></a>4ã€ é¿å…è¿‡å¤šçš„äº‹åŠ¡</h3><p>å°½é‡å‡å°‘äº‹åŠ¡çš„ä½¿ç”¨æ¬¡æ•°ï¼Œå¹¶ç¡®ä¿äº‹åŠ¡å°½å¯èƒ½çŸ­ï¼Œä»¥å‡å°‘æ•°æ®åº“é”çš„æ—¶é—´ã€‚</p><h3 id="5ã€ä½¿ç”¨å‡†å¤‡å¥½çš„è¯­å¥"><a href="#5ã€ä½¿ç”¨å‡†å¤‡å¥½çš„è¯­å¥" class="headerlink" title="5ã€ä½¿ç”¨å‡†å¤‡å¥½çš„è¯­å¥"></a>5ã€<strong>ä½¿ç”¨å‡†å¤‡å¥½çš„è¯­å¥</strong></h3><p>å‡†å¤‡å¥½çš„è¯­å¥ï¼ˆprepared statementsï¼‰å¯ä»¥æé«˜æ€§èƒ½å¹¶å¢åŠ å®‰å…¨æ€§ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go">stmt, err := db.Prepare(<span class="hljs-string">&quot;SELECT name FROM users WHERE age = ?&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    log.Fatal(err)<br>&#125;<br><span class="hljs-keyword">defer</span> stmt.Close()<br><br>rows, err := stmt.Query(<span class="hljs-number">25</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    log.Fatal(err)<br>&#125;<br><span class="hljs-keyword">defer</span> rows.Close()<br><br><span class="hljs-keyword">for</span> rows.Next() &#123;<br>    <span class="hljs-comment">// å¤„ç†ç»“æœ</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6ã€åˆ†æ‰¹å¤„ç†æ•°æ®"><a href="#6ã€åˆ†æ‰¹å¤„ç†æ•°æ®" class="headerlink" title="6ã€åˆ†æ‰¹å¤„ç†æ•°æ®"></a>6ã€åˆ†æ‰¹å¤„ç†æ•°æ®</h3><p>å¯¹äºéœ€è¦å¤„ç†å¤§é‡æ•°æ®çš„æƒ…å†µï¼Œåˆ†æ‰¹å¤„ç†å¯ä»¥å‡å°‘å†…å­˜ä½¿ç”¨å¹¶æé«˜æ€§èƒ½ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go">rows, err := db.Query(<span class="hljs-string">&quot;SELECT * FROM large_table LIMIT ? OFFSET ?&quot;</span>, batchSize, offset)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    log.Fatal(err)<br>&#125;<br><span class="hljs-keyword">defer</span> rows.Close()<br><br><span class="hljs-keyword">for</span> rows.Next() &#123;<br>    <span class="hljs-comment">// å¤„ç†æ¯ä¸€è¡Œ</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="7-ç›‘æ§å’Œè°ƒè¯•"><a href="#7-ç›‘æ§å’Œè°ƒè¯•" class="headerlink" title="7. ç›‘æ§å’Œè°ƒè¯•"></a>7. ç›‘æ§å’Œè°ƒè¯•</h3><p>ä½¿ç”¨ç›‘æ§å·¥å…·å’Œæ—¥å¿—è®°å½•æ¥ç›‘æ§æ•°æ®åº“æ€§èƒ½ï¼Œå¹¶åŠæ—¶å‘ç°å’Œè§£å†³ç“¶é¢ˆã€‚</p><ul><li><strong>Prometheus</strong> å’Œ <strong>Grafana</strong>: å¯ä»¥ç”¨äºç›‘æ§æ•°æ®åº“å’Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½æŒ‡æ ‡ã€‚</li><li><strong>æ—¥å¿—è®°å½•</strong>: è®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—ï¼Œä»¥ä¾¿æ’æŸ¥é—®é¢˜ã€‚</li></ul><p>é€šè¿‡åˆç†é…ç½® <code>sql.DB</code> å’Œä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ Go åº”ç”¨ç¨‹åºçš„æ•°æ®åº“æ€§èƒ½ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker-composeç½‘ç»œå…³è”é…ç½®</title>
    <link href="/2024/12/10/docker/docker-compose%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/"/>
    <url>/2024/12/10/docker/docker-compose%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="docker-composeç½‘ç»œé…ç½®"><a href="#docker-composeç½‘ç»œé…ç½®" class="headerlink" title="docker-composeç½‘ç»œé…ç½®"></a>docker-composeç½‘ç»œé…ç½®</h1><hr><blockquote><p>åœ¨å·¥ä½œä¸­æˆ‘ä»¬å¯èƒ½éœ€è¦æ•°æ®åº“å’Œapiæ¥å£åˆ†å¼€éƒ¨ç½²çš„æƒ…å†µï¼Œå¦‚æœéƒ½ç”¨docker-composeéƒ¨ç½²çš„è¯ï¼Œ åœ¨æœ‰çš„æ“ä½œç³»ç»Ÿä¸­å¯èƒ½æ— æ³•ä½¿ç”¨ï¼ˆip+ç«¯å£ï¼‰è¿æ¥æ•°æ®åº“ï¼Œå¿…é¡»ä½¿ç”¨æœåŠ¡åç§°å»è¿æ¥ã€‚ è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦è®©è¿™ä¸¤ä¸ªdocker-composeå¯åŠ¨çš„æœåŠ¡å…±äº«ç½‘ç»œï¼Œè¿™æ ·å°±å¯ä»¥ç›¸äº’è°ƒç”¨æœåŠ¡äº†</p></blockquote><h2 id="1-ä½¿ç”¨docker-compose-yml-æ–‡ä»¶å¼•ç”¨"><a href="#1-ä½¿ç”¨docker-compose-yml-æ–‡ä»¶å¼•ç”¨" class="headerlink" title="1 ä½¿ç”¨docker-compose.yml æ–‡ä»¶å¼•ç”¨"></a>1 ä½¿ç”¨docker-compose.yml æ–‡ä»¶å¼•ç”¨</h2><hr><h3 id="æ•°æ®åº“çš„docker-composeæ–‡ä»¶"><a href="#æ•°æ®åº“çš„docker-composeæ–‡ä»¶" class="headerlink" title="æ•°æ®åº“çš„docker-composeæ–‡ä»¶"></a>æ•°æ®åº“çš„docker-composeæ–‡ä»¶</h3><ul><li>å…ˆå¯åŠ¨æ•°æ®åº“æœåŠ¡ï¼Œæœ€åapiæœåŠ¡çš„docker-compose.ymlå¼•ç”¨æ•°æ®åº“çš„ç½‘ç»œå³å¯</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">db-mysql:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">--default-authentication-plugin=mysql_native_password</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3306:3306&quot;</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql-container</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">my_net</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=root</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">my_net:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span><br></code></pre></td></tr></table></figure><ul><li><p>è¿™é‡Œéœ€è¦æŒ‡å®šç½‘ç»œ my_netï¼ŒæŒ‡å®šåç½‘ç»œåç§°ä¸ºå½“å‰æ–‡ä»¶å¤¹åŠ ä¸Š_my_netï¼Œå¦‚æœä¸æŒ‡å®šä¼šä½¿ç”¨å½“å‰æ–‡ä»¶å¤¹çš„åç§°åŠ ä¸Š_default</p></li><li><p>å¯åŠ¨å‘½ä»¤ docker-compose -p supercom up -d (åŠ ä¸Š-pæŒ‡å®šç½‘ç»œåç§°)</p></li><li><p>æŸ¥çœ‹ç½‘ç»œ docker network ls</p></li><li><p>è¿™é‡Œæˆ‘æŸ¥çœ‹çš„æ˜¯ supercom_my_net</p><p><img src="https://raw.githubusercontent.com/gondmhd/blogImage/main/img/202310251507487.png" alt="202308241527417"></p></li></ul><h3 id="apiçš„docker-composeæ–‡ä»¶"><a href="#apiçš„docker-composeæ–‡ä»¶" class="headerlink" title="apiçš„docker-composeæ–‡ä»¶"></a>apiçš„docker-composeæ–‡ä»¶</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">api:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">registry.cn-hangzhou.aliyuncs.com/superhorizon/superhorizon-backend-java</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">api</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8089:8089&quot;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">supercom_my_net</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">super_horizon_123456</span><br>      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">horizon_dev</span><br>      <span class="hljs-attr">MYSQL_NAME:</span> <span class="hljs-string">mysql</span><br>      <span class="hljs-attr">MYSQL_PORT:</span> <span class="hljs-number">3306</span><br>      <span class="hljs-attr">opensearch_ip:</span> <span class="hljs-string">opensearch</span><br>      <span class="hljs-attr">opensearch_dashboard_url:</span> <span class="hljs-string">http://192.168.0.190:8889</span><br>      <span class="hljs-attr">situation_picture_url:</span> <span class="hljs-string">/situation_picture_url/</span><br>      <span class="hljs-attr">situation_ipAddress:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.190</span><br>      <span class="hljs-attr">situation_port:</span> <span class="hljs-number">8889</span><br>      <span class="hljs-attr">keycloak-enable:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">keycloak-auth-server-url:</span> <span class="hljs-string">http://keycloak:8080/auth</span><br>      <span class="hljs-attr">keycloak-realm:</span> <span class="hljs-string">myrealm</span><br>      <span class="hljs-attr">JDBC_URL:</span> <span class="hljs-string">jdbc:mysql://mysql:3306/horizon_dev?allowPublicKeyRetrieval=true&amp;serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;useSSL=false&amp;characterEncoding=UTF8&amp;zeroDateTimeBehavior=round&amp;allowMultiQueries=true</span><br><span class="hljs-string">ex</span><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">supercom_my_net:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># æ¥è‡ªå¤–éƒ¨</span><br></code></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨å…±äº«ç½‘ç»œåï¼Œæˆ‘ä»¬åœ¨è¿æ¥ mysqlçš„ä½¿ç”¨å°±å¯ä»¥ä½¿ç”¨æœåŠ¡åç§°ï¼Œdb-mysqlï¼Œå¯è¿›å…¥å®¹å™¨è¿›è¡Œpingæµ‹è¯•</p><hr><h2 id="2-æå‰åˆ›å»ºdocker-ç½‘ç»œ"><a href="#2-æå‰åˆ›å»ºdocker-ç½‘ç»œ" class="headerlink" title="2 æå‰åˆ›å»ºdocker ç½‘ç»œ"></a>2 æå‰åˆ›å»ºdocker ç½‘ç»œ</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>docker network create my_net</strong> åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼Œä¹‹åæ¯ä¸ªdocker-compose.ymlå¼•ç”¨å³å¯</p><h3 id="æ•°æ®åº“çš„docker-composeæ–‡ä»¶-1"><a href="#æ•°æ®åº“çš„docker-composeæ–‡ä»¶-1" class="headerlink" title="æ•°æ®åº“çš„docker-composeæ–‡ä»¶"></a>æ•°æ®åº“çš„docker-composeæ–‡ä»¶</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">db-mysql:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">--default-authentication-plugin=mysql_native_password</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3306:3306&quot;</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql-container</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">test_super</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=root</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">test_super:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h3 id="apiçš„docker-composeæ–‡ä»¶-1"><a href="#apiçš„docker-composeæ–‡ä»¶-1" class="headerlink" title="apiçš„docker-composeæ–‡ä»¶"></a>apiçš„docker-composeæ–‡ä»¶</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">api:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">registry.cn-hangzhou.aliyuncs.com/superhorizon/superhorizon-backend-java</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">api</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8089:8089&quot;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">test_super</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">super_horizon_123456</span><br>      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">horizon_dev</span><br>      <span class="hljs-attr">MYSQL_NAME:</span> <span class="hljs-string">mysql</span><br>      <span class="hljs-attr">MYSQL_PORT:</span> <span class="hljs-number">3306</span><br>      <span class="hljs-attr">opensearch_ip:</span> <span class="hljs-string">opensearch</span><br>      <span class="hljs-attr">opensearch_dashboard_url:</span> <span class="hljs-string">http://192.168.0.190:8889</span><br>      <span class="hljs-attr">situation_picture_url:</span> <span class="hljs-string">/situation_picture_url/</span><br>      <span class="hljs-attr">situation_ipAddress:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.190</span><br>      <span class="hljs-attr">situation_port:</span> <span class="hljs-number">8889</span><br>      <span class="hljs-attr">keycloak-enable:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">keycloak-auth-server-url:</span> <span class="hljs-string">http://keycloak:8080/auth</span><br>      <span class="hljs-attr">keycloak-realm:</span> <span class="hljs-string">myrealm</span><br>      <span class="hljs-attr">JDBC_URL:</span> <span class="hljs-string">jdbc:mysql://mysql:3306/horizon_dev?allowPublicKeyRetrieval=true&amp;serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;useSSL=false&amp;characterEncoding=UTF8&amp;zeroDateTimeBehavior=round&amp;allowMultiQueries=true</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">test_super:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># æ¥è‡ªå¤–éƒ¨</span><br></code></pre></td></tr></table></figure><p>è¿›å…¥å®¹å™¨æµ‹è¯•å³å¯</p><h2 id="3ã€-Docker-Compose-ç¯å¢ƒå˜é‡"><a href="#3ã€-Docker-Compose-ç¯å¢ƒå˜é‡" class="headerlink" title="3ã€ Docker Compose ç¯å¢ƒå˜é‡"></a>3ã€ Docker Compose ç¯å¢ƒå˜é‡</h2><p> Docker Compose é…ç½®ä¸­ï¼Œç›´æ¥åœ¨ <code>environment</code> ä¸‹è®¾ç½®ç¯å¢ƒå˜é‡ä¸ä½¿ç”¨ <code>env_file</code> å¼•ç”¨æ–‡ä»¶æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹åŒºåˆ«ï¼š</p><ol><li><p><strong>å£°æ˜æ–¹å¼</strong>:</p><ul><li><strong>ç¯å¢ƒå˜é‡å— (<code>environment</code>)</strong>: ç›´æ¥åœ¨ <code>environment</code> ä¸‹åˆ—å‡ºçš„ç¯å¢ƒå˜é‡æ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼ç›´æ¥å†™åœ¨ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­çš„ã€‚è¿™ç§æ–¹å¼é€‚åˆäºå°‘é‡çš„ã€ä¸æ•æ„Ÿæˆ–è€…ç‰¹å®šäºæœåŠ¡çš„ç¯å¢ƒå˜é‡è®¾ç½®ã€‚</li></ul><p>Yaml</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-number">1</span>services:<br><span class="hljs-symbol">2 </span> nginx-proxy:<br><span class="hljs-symbol">3 </span>   environment:<br><span class="hljs-symbol">4 </span>     VIRTUAL_HOST: <span class="hljs-comment">&#x27;api.malcolm.local&#x27;</span><br></code></pre></td></tr></table></figure><ul><li><strong>ç¯å¢ƒå˜é‡æ–‡ä»¶ (<code>env_file</code>)</strong>: ä½¿ç”¨ <code>env_file</code> æŒ‡ä»¤å¼•ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå¤–éƒ¨æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶ä¸­åŒ…å«å¤šè¡Œ <code>KEY=VALUE</code> æ ¼å¼çš„ç¯å¢ƒå˜é‡ã€‚è¿™ç§æ–¹å¼é€‚åˆäºç®¡ç†å¤§é‡çš„ç¯å¢ƒå˜é‡ï¼Œå°¤å…¶æ˜¯é‚£äº›å¯èƒ½åœ¨ä¸åŒç¯å¢ƒï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰é—´å˜åŒ–çš„é…ç½®ï¼Œæˆ–è€…åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆå°½ç®¡å¯¹äºæ•æ„Ÿä¿¡æ¯æœ€å¥½ä½¿ç”¨ Docker çš„ç§˜å¯†ç®¡ç†åŠŸèƒ½ï¼‰ã€‚</li></ul></li><li><p><strong>å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§</strong>:</p><ul><li><code>env_file</code> æä¾›äº†æ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼Œå› ä¸ºç¯å¢ƒç›¸å…³çš„é…ç½®å¯ä»¥ç‹¬ç«‹äºæœåŠ¡å®šä¹‰å­˜æ”¾ï¼Œæ˜“äºä¿®æ”¹å’Œç‰ˆæœ¬æ§åˆ¶ã€‚ç‰¹åˆ«æ˜¯å½“ç¯å¢ƒå˜é‡è¾ƒå¤šæ—¶ï¼Œç›´æ¥åœ¨ <code>docker-compose.yml</code> ä¸­ç®¡ç†ä¼šå˜å¾—æ··ä¹±ã€‚</li></ul></li><li><p><strong>ä¼˜å…ˆçº§</strong>:</p><ul><li>å¦‚æœåŒä¸€ä¸ªç¯å¢ƒå˜é‡æ—¢åœ¨ <code>env_file</code> ä¸­å®šä¹‰ï¼Œä¹Ÿåœ¨ <code>environment</code> å—ä¸­ç›´æ¥å®šä¹‰ï¼Œé‚£ä¹ˆç›´æ¥åœ¨ <code>environment</code> å—ä¸­å®šä¹‰çš„å€¼ä¼šè¦†ç›– <code>env_file</code> ä¸­çš„å€¼ã€‚è¿™æ˜¯å› ä¸ºç›´æ¥åœ¨æœåŠ¡å®šä¹‰ä¸­è®¾ç½®çš„ç¯å¢ƒå˜é‡å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚</li></ul></li><li><p><strong>å®‰å…¨æ€§</strong>:</p><ul><li>å°½ç®¡ä¸¤è€…éƒ½å¯ä»¥ç”¨æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä½†ä½¿ç”¨ <code>env_file</code> æ–¹å¼æ›´é€‚åˆå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºå®ƒå…è®¸ä½ å°†è¿™äº›ä¿¡æ¯æ”¾åœ¨ <code>.env</code> æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶é€šå¸¸ä¼šè¢«åŠ å…¥ <code>.gitignore</code> é¿å…è¯¯æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ã€‚ç„¶è€Œï¼Œæœ€ä½³å®è·µä»ç„¶æ˜¯ä½¿ç”¨Dockerçš„å¯†é’¥ç®¡ç†ç³»ç»Ÿæ¥å¤„ç†æ•æ„Ÿä¿¡æ¯ã€‚</li></ul></li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œé€‰æ‹©ç›´æ¥åœ¨ <code>environment</code> å—å†…å®šä¹‰è¿˜æ˜¯ä½¿ç”¨ <code>env_file</code> å¼•å…¥ç¯å¢ƒå˜é‡ï¼Œå–å†³äºä½ çš„å…·ä½“éœ€æ±‚ã€ç¯å¢ƒå˜é‡çš„æ•°é‡ã€å®‰å…¨è€ƒé‡ä»¥åŠæ˜¯å¦éœ€è¦è·¨æœåŠ¡æˆ–è·¨ç¯å¢ƒå…±äº«é…ç½®ã€‚</p><h2 id="4ã€docker-composeæ—¶åŒºé—®é¢˜"><a href="#4ã€docker-composeæ—¶åŒºé—®é¢˜" class="headerlink" title="4ã€docker-composeæ—¶åŒºé—®é¢˜"></a>4ã€docker-composeæ—¶åŒºé—®é¢˜</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">æ–¹å¼ä¸€ï¼š</span><br><span class="hljs-attr">environment:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">SET_CONTAINER_TIMEZONE=true</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">CONTAINER_TIMEZONE=Asia/Shanghai</span><br>  <br><span class="hljs-string">æ–¹å¼äºŒï¼š</span><br><span class="hljs-attr">environment:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">TZ=Asia/Shanghai</span><br></code></pre></td></tr></table></figure><ul><li><strong>æ–¹å¼ä¸€</strong> æ›´é€‚ç”¨äºé‚£äº›å…·æœ‰ç‰¹å®šè„šæœ¬æ¥å¤„ç†æ—¶åŒºè®¾ç½®çš„é•œåƒï¼Œæˆ–è€…æ‚¨æƒ³è¦æ›´çµæ´»åœ°æ§åˆ¶æ—¶åŒºè®¾ç½®çš„æƒ…å†µã€‚</li><li><strong>æ–¹å¼äºŒ</strong> æ˜¯ä¸€ç§æ›´ç®€å•ç›´æ¥çš„æ–¹æ³•ï¼Œé€‚ç”¨äºå¤§å¤šæ•°åŸºäºDebian&#x2F;Ubuntuçš„é•œåƒ</li></ul>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8såŸºç¡€</title>
    <link href="/2024/12/10/docker/k8s%E5%9F%BA%E7%A1%80/"/>
    <url>/2024/12/10/docker/k8s%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="k8såŸºç¡€"><a href="#k8såŸºç¡€" class="headerlink" title="k8såŸºç¡€"></a>k8såŸºç¡€</h1><hr><h2 id="1ã€å…³äº-k8s-çš„åŸºæœ¬æ¶æ„"><a href="#1ã€å…³äº-k8s-çš„åŸºæœ¬æ¶æ„" class="headerlink" title="1ã€å…³äº k8s çš„åŸºæœ¬æ¶æ„"></a>1ã€å…³äº k8s çš„åŸºæœ¬æ¶æ„</h2><p>K8s å…¨ç§° kubernetsï¼Œå¸Œè…Šè¯­æ„ä¸ºï¼šèˆµæ‰‹ï¼Œæ˜¯ä¸€ç§å¯è‡ªåŠ¨å®æ–½ Linuxå®¹å™¨æ“ä½œçš„å¼€æºå¹³å°ã€‚å‰æœŸç”± Google çš„å·¥ç¨‹å¸ˆå¼€å‘å’Œè®¾è®¡ï¼Œä¸­æœŸç”±çº¢å¸½ç­‰ä¸€ç³»åˆ—å…¬å¸å‚ä¸åˆä½œå¼€å‘ï¼ŒåæœŸç”±äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šè¿›è¡Œæ›´æ–°ã€è¿­ä»£ã€‚å…¶æä¾›äº†åº”ç”¨éƒ¨ç½²ã€è§„åˆ’ã€æ›´æ–°ã€ç»´æŠ¤çš„ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥çœå»åº”ç”¨å®¹å™¨åŒ–è¿‡ç¨‹çš„è®¸å¤šæ‰‹åŠ¨éƒ¨ç½²å’Œæ‰©å±•æ“ä½œï¼Œå°†è¿è¡Œ Linux å®¹å™¨çš„å¤šç»„ä¸»æœºèšé›†åœ¨ä¸€èµ·ï¼Œè½»æ¾é«˜æ•ˆåœ°ç®¡ç†é›†ç¾¤ã€‚</p><p>è¦å­¦ä¹ ä½¿ç”¨K8sï¼Œé¦–å…ˆè¦äº†è§£K8sçš„æ¶æ„ã€ç»„ä»¶ä»¥åŠç‰¹ç‚¹ï¼Œè¯´åˆ°é›†ç¾¤ï¼Œæˆ‘ä»¬ä¸å…ä¼šæƒ³åˆ°masterã€slaver æˆ–è€… nodeï¼Œk8sé›†ç¾¤ä¹Ÿæ˜¯è¿™æ ·ï¼Œç”±å¤šå° master å’Œ node ç»„æˆï¼Œç”± master æ§åˆ¶ nodeï¼Œç”±nodeï¼ˆä¹Ÿå¯ä»¥æ˜¯masterï¼‰æä¾›æœåŠ¡ï¼Œå¦‚å›¾ä¸€æ‰€ç¤ºï¼š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240520111740567.png?raw=true" alt="image-20240520111740567"></p><p><strong>ä»€ä¹ˆæ˜¯ master(æ§åˆ¶èŠ‚ç‚¹)ï¼š</strong> master çš„ç»„ä»¶åŒ…æ‹¬ apiserverã€controller-managerã€scheduler å’Œ etcdï¼Œé‚£ä¹ˆè¿™å‡ ä¸ªç»„ä»¶æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢ï¼Ÿæˆ‘åšäº†ä¸ªç®€å•çš„æ¯”å–»ï¼š å›¾</p><ul><li><strong>Apiserverï¼ˆæˆ¿å­å…¥å£ï¼‰:</strong> K8S å¯¹å¤–çš„å”¯ä¸€æ¥å£ï¼Œæä¾› HTTP&#x2F;HTTPS RESTful APIï¼Œå³æ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦ç»è¿‡è¿™ä¸ªæ¥å£è¿›è¡Œé€šä¿¡</li><li><strong>Etcd ï¼ˆåå‹¤äººå‘˜ï¼‰ï¼š</strong> è´Ÿè´£ä¿å­˜ k8s é›†ç¾¤çš„é…ç½®ä¿¡æ¯å’Œå„ç§èµ„æºçš„çŠ¶æ€ä¿¡æ¯ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œetcdä¼šå¿«é€Ÿåœ°é€šçŸ¥k8sç›¸å…³ç»„ä»¶</li><li><strong>Controller Managerï¼ˆç®¡ç†è€…ï¼‰ï¼š</strong> è´Ÿè´£ç®¡ç†é›†ç¾¤å„ç§èµ„æºï¼Œä¿è¯èµ„æºå¤„äºé¢„æœŸçš„çŠ¶æ€</li><li><strong>Schedule ï¼ˆè´Ÿè´£è°ƒåº¦ï¼‰ï¼š</strong> èµ„æºè°ƒåº¦ï¼Œè´Ÿè´£å†³å®šå°† Pod æ”¾åˆ°å“ªä¸ª Node ä¸Šè¿è¡Œ</li></ul><p><strong>ä»€ä¹ˆæ˜¯ node:</strong> é‚£ä¹ˆ Node åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¯´é€äº† Node å°±æ˜¯å¹²æ´»çš„ã€‚Nodeçš„ç»„ä»¶åŒ…æ‹¬ Kubeletã€Container Runtimeã€Kube-proxyã€‚</p><ul><li><strong>Kubeletï¼ˆæ¥æ–™åŠ å·¥ç”Ÿäº§ï¼‰ï¼š</strong> kubelet æ˜¯ node çš„ agentï¼Œkubelet ä¼šæ ¹æ® pod ä¿¡æ¯åˆ›å»ºå’Œè¿è¡Œå®¹å™¨ï¼Œå¹¶å‘masteræŠ¥å‘Šè¿è¡ŒçŠ¶æ€</li><li><strong>Container Runtime ï¼ˆä¸‹è½½è¿è¡Œï¼‰ï¼š</strong> æ¯ä¸ªNodeéƒ½éœ€è¦æä¾›ä¸€ä¸ªå®¹å™¨è¿è¡Œï¼ˆContainer Runtimeï¼‰ç¯å¢ƒï¼Œå®ƒè´Ÿè´£ä¸‹è½½é•œåƒå¹¶è¿è¡Œå®¹å™¨ã€‚</li><li><strong>Kube-proxyï¼ˆä¼ è¾“çº½å¸¦ï¼‰ï¼š</strong> ç”¨æˆ·é€šè¿‡ serviceï¼ˆå³å°†ä»‹ç»ï¼‰è®¿é—®Podï¼Œæ¯ä¸ªNodeéƒ½ä¼šè¿è¡Œkube-proxyæœåŠ¡ï¼Œå°†è®¿é—®çš„serviceçš„TCP&#x2F;UDPæ•°æ®æµè½¬å‘åˆ°åç«¯çš„å®¹å™¨</li></ul><p>å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå½¢è±¡åœ°äº†è§£äº† node å’Œ node ç»„ä»¶çš„ä½œç”¨ï¼Œä¸æ­¤åŒæ—¶ï¼Œæ–‡ä¸­æåˆ°äº† pod å’Œ serviceï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªè‹±æ–‡å•è¯åœ¨K8Sä¸­è¡¨ç¤ºä»€ä¹ˆå‘¢ï¼Ÿ <strong>Pod èµ„æºå¯¹è±¡</strong>æ˜¯ä¸€ç§é›†åˆäº†ä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨å®¹å™¨ã€å­˜å‚¨èµ„æºã€ä¸“ç”¨ipã€ä»¥åŠæ”¯æ’‘è¿è¡Œçš„å…¶ä»–é€‰é¡¹çš„é€»è¾‘ç»„ä»¶ï¼Œç”¨å¤§ç™½è¯è®²ï¼Œpodå¥½æ¯”ä¸€åœºèˆå°å‰§ï¼Œæ˜¯å¯¼æ¼”ã€ç¼–å‰§ç¼–æ’å¥½ä»¥åç”±æ¼”å‘˜ã€ç¯å…‰ã€é“å…·ã€åœºåŠ¡ç­‰åä½œå®Œæˆçš„ä¸€åœºæˆã€‚ <strong>Serviceèµ„æº</strong>å°±æ˜¯åœ¨è¢«è®¿é—®çš„Podå¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªæœ‰ç€å›ºå®šIPåœ°å€çš„ä¸­é—´å±‚ï¼ŒServiceèµ„æºå°†å®¢æˆ·è®¿é—®è¿›è¡Œè°ƒåº¦å¹¶ä»£ç†åˆ°åç«¯çš„Podå¯¹è±¡ï¼ŒService èµ·åˆ°äº†é€šé“çš„ä½œç”¨ã€‚Serviceå°±å¥½æ¯”æ˜¯ä¸ªå‘å¯¼ï¼Œè´Ÿè´£å°†å®¢æˆ·å¸¦åˆ°podè¿™åœºèˆå°å‰§æ¥è§‚çœ‹ã€‚</p><h2 id="2ã€k8s-å’Œkubesphereä»‹ç»"><a href="#2ã€k8s-å’Œkubesphereä»‹ç»" class="headerlink" title="2ã€k8s å’Œkubesphereä»‹ç»"></a>2ã€k8s å’Œkubesphereä»‹ç»</h2><p>åç»­æ“ä½œåŸºäºkubesphere å¯¹k8sè¿›è¡Œä½¿ç”¨</p><p><a href="https://www.kubesphere.io/zh/docs/v3.3/introduction/what-is-kubesphere/">k8så®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://kubernetes.io/zh-cn/docs/home/">kubesphereå®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://helm.sh/zh/docs/">helmå®˜æ–¹æ–‡æ¡£</a></p><p>ç®€å•çš„æ›´å¥½ç†è§£çš„ç±»æ¯”:</p><p>â€‹dockerï¼Œä¸€ä¸ªå®¹å™¨å¯¹åº”ä¸€ä¸ªæœåŠ¡</p><p>â€‹docker-composeï¼Œå¤šä¸ªå®¹å™¨æœåŠ¡çš„é›†åˆï¼Œæ¯ä¸ªæœåŠ¡éƒ½æ˜¯standaloneæ¨¡å¼ï¼Œè´Ÿè½½æ€§èƒ½æœ‰ä¸Šé™</p><p>â€‹k8s&#x2F;docker swarmï¼Œå°†è¿™é‡Œé¢çš„æ¯ä¸ªæœåŠ¡é›†ç¾¤åŒ–ï¼Œé›†ç¾¤è§„æ¨¡åŠ¨æ€å¯æ§</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240520113012594.png?raw=true" alt="image-20240520113012594"></p><p><strong>kubernetes(k8s):</strong> </p><p>â€‹     å¼€æºå®¹å™¨ç¼–æ’å¹³å°</p><p>â€‹     è‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åº</p><p><strong>kubesphere:</strong> </p><p>â€‹     åŸºäºk8sæ„å»ºçš„å¼€æºå¤šäº‘å®¹å™¨ç®¡ç†å¹³å°</p><p>â€‹     å¯è§†åŒ–ç®¡ç†ç•Œé¢ã€åº”ç”¨å•†åº—ã€åº”ç”¨ç¨‹åºç›‘æ§å’Œæ—¥å¿—ç®¡ç†ç­‰åŠŸèƒ½</p><p><strong>Helm Chart:</strong>   </p><p>â€‹     k8sçš„åŒ…ç®¡ç†å·¥å…·ï¼Œ é…ç½®ï¼Œæ‰“åŒ…k8såº”ç”¨ç¨‹åº</p><h2 id="3ã€å®‰è£…kubesphere"><a href="#3ã€å®‰è£…kubesphere" class="headerlink" title="3ã€å®‰è£…kubesphere"></a>3ã€å®‰è£…kubesphere</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> KKZONE=cn<br>curl -sfL https://get-kk.kubesphere.io | VERSION=v3.0.7 sh -<br></code></pre></td></tr></table></figure><p>å¤‡æ³¨</p><p>åœ¨æ‚¨ä¸‹è½½ KubeKey åï¼Œå¦‚æœæ‚¨å°†å…¶ä¼ è‡³æ–°çš„æœºå™¨ï¼Œä¸”è®¿é—® Googleapis åŒæ ·å—é™ï¼Œåœ¨æ‚¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ä¹‹å‰è¯·åŠ¡å¿…å†æ¬¡æ‰§è¡Œ <code>export KKZONE=cn</code> å‘½ä»¤ã€‚</p><p>æ‰§è¡Œä»¥ä¸Šå‘½ä»¤ä¼šä¸‹è½½æœ€æ–°ç‰ˆ KubeKeyï¼Œæ‚¨å¯ä»¥ä¿®æ”¹å‘½ä»¤ä¸­çš„ç‰ˆæœ¬å·ä¸‹è½½æŒ‡å®šç‰ˆæœ¬ã€‚</p><p>ä¸º <code>kk</code> æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x kk<br></code></pre></td></tr></table></figure><p>åœ¨æœ¬å¿«é€Ÿå…¥é—¨æ•™ç¨‹ä¸­ï¼Œæ‚¨åªéœ€æ‰§è¡Œä¸€ä¸ªå‘½ä»¤å³å¯è¿›è¡Œå®‰è£…ï¼Œå…¶æ¨¡æ¿å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">./kk create cluster [--with-kubernetes version] [--with-kubesphere version]<br><br>è‹¥è¦åŒæ—¶å®‰è£… Kubernetes å’Œ KubeSphereï¼Œå¯å‚è€ƒä»¥ä¸‹ç¤ºä¾‹å‘½ä»¤ï¼š<br>./kk create cluster --with-kubernetes v1.22.12 --with-kubesphere v3.3.2<br></code></pre></td></tr></table></figure><ul><li>å®‰è£… KubeSphere 3.3 çš„å»ºè®® Kubernetes ç‰ˆæœ¬ï¼šv1.20.xã€v1.21.xã€* v1.22.xã€* v1.23.x å’Œ * v1.24.xã€‚å¸¦æ˜Ÿå·çš„ç‰ˆæœ¬å¯èƒ½å‡ºç°è¾¹ç¼˜èŠ‚ç‚¹éƒ¨åˆ†åŠŸèƒ½ä¸å¯ç”¨çš„æƒ…å†µã€‚å› æ­¤ï¼Œå¦‚éœ€ä½¿ç”¨è¾¹ç¼˜èŠ‚ç‚¹ï¼Œæ¨èå®‰è£… v1.21.xã€‚å¦‚æœä¸æŒ‡å®š Kubernetes ç‰ˆæœ¬ï¼ŒKubeKey å°†é»˜è®¤å®‰è£… Kubernetes v1.23.10ã€‚æœ‰å…³å—æ”¯æŒçš„ Kubernetes ç‰ˆæœ¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://kubesphere.io/zh/docs/v3.3/installing-on-linux/introduction/kubekey/#%E6%94%AF%E6%8C%81%E7%9F%A9%E9%98%B5">æ”¯æŒçŸ©é˜µ</a>ã€‚</li><li>ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äº All-in-One å®‰è£…ï¼Œæ‚¨æ— éœ€æ›´æ”¹ä»»ä½•é…ç½®ã€‚</li><li>å¦‚æœæ‚¨åœ¨è¿™ä¸€æ­¥çš„å‘½ä»¤ä¸­ä¸æ·»åŠ æ ‡å¿— <code>--with-kubesphere</code>ï¼Œåˆ™ä¸ä¼šéƒ¨ç½² KubeSphereï¼ŒKubeKey å°†åªå®‰è£… Kubernetesã€‚å¦‚æœæ‚¨æ·»åŠ æ ‡å¿— <code>--with-kubesphere</code> æ—¶ä¸æŒ‡å®š KubeSphere ç‰ˆæœ¬ï¼Œåˆ™ä¼šå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ KubeSphereã€‚</li><li>KubeKey ä¼šé»˜è®¤å®‰è£… <a href="https://openebs.io/">OpenEBS</a> ä¸ºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒæä¾› LocalPV ä»¥æ–¹ä¾¿æ–°ç”¨æˆ·ã€‚å¯¹äºå…¶ä»–å­˜å‚¨ç±»å‹ï¼Œè¯·å‚è§<a href="https://kubesphere.io/zh/docs/v3.3/installing-on-linux/persistent-storage-configurations/understand-persistent-storage/">æŒä¹…åŒ–å­˜å‚¨é…ç½®</a>ã€‚</li></ul><p>æ‰§è¡Œè¯¥å‘½ä»¤åï¼ŒKubeKey å°†æ£€æŸ¥æ‚¨çš„å®‰è£…ç¯å¢ƒï¼Œç»“æœæ˜¾ç¤ºåœ¨ä¸€å¼ è¡¨æ ¼ä¸­ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://kubesphere.io/zh/docs/v3.3/quick-start/all-in-one-on-linux/#%E8%8A%82%E7%82%B9%E8%A6%81%E6%B1%82">èŠ‚ç‚¹è¦æ±‚</a>å’Œ<a href="https://kubesphere.io/zh/docs/v3.3/quick-start/all-in-one-on-linux/#%E4%BE%9D%E8%B5%96%E9%A1%B9%E8%A6%81%E6%B1%82">ä¾èµ–é¡¹è¦æ±‚</a>ã€‚è¾“å…¥ <code>yes</code> ç»§ç»­å®‰è£…æµç¨‹ã€‚</p><blockquote><p>KubeKey æ˜¯ç”¨ Go è¯­è¨€å¼€å‘çš„ä¸€æ¬¾å…¨æ–°çš„å®‰è£…å·¥å…·ï¼Œä»£æ›¿äº†ä»¥å‰åŸºäº ansible çš„å®‰è£…ç¨‹åºã€‚KubeKey ä¸ºç”¨æˆ·æä¾›äº†çµæ´»çš„å®‰è£…é€‰æ‹©ï¼Œå¯ä»¥åˆ†åˆ«å®‰è£… KubeSphere å’Œ Kubernetes æˆ–äºŒè€…åŒæ—¶å®‰è£…ï¼Œæ—¢æ–¹ä¾¿åˆé«˜æ•ˆã€‚</p></blockquote><p>å®‰è£…å®Œæˆæç¤º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#####################################################</span><br><span class="hljs-comment">###              Welcome to KubeSphere!           ###</span><br><span class="hljs-comment">#####################################################</span><br><br>Console: http://192.168.0.164:30880<br>Account: admin<br>Password: P@88w0rd<br>NOTESï¼š<br>  1. After you <span class="hljs-built_in">log</span> into the console, please check the<br>     monitoring status of service components <span class="hljs-keyword">in</span><br>     <span class="hljs-string">&quot;Cluster Management&quot;</span>. If any service is not<br>     ready, please <span class="hljs-built_in">wait</span> patiently <span class="hljs-keyword">until</span> all components <br>     are up and running.<br>  2. Please change the default password after login.<br><br><span class="hljs-comment">#####################################################</span><br>https://kubesphere.io             2024-05-20 15:53:41<br><span class="hljs-comment">#####################################################</span><br>15:53:44 CST success: [super]<br>15:53:44 CST Pipeline[CreateClusterPipeline] execute successfully<br>Installation is complete.<br><br>Please check the result using the <span class="hljs-built_in">command</span>:<br><br>kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l <span class="hljs-string">&#x27;app in (ks-install, ks-installer)&#x27;</span> -o jsonpath=<span class="hljs-string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>) -f<br><br></code></pre></td></tr></table></figure><p><strong>éªŒè¯å®‰è£…ç»“æœ</strong></p><p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥æ£€æŸ¥å®‰è£…ç»“æœã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l <span class="hljs-string">&#x27;app in (ks-install, ks-installer)&#x27;</span> -o jsonpath=<span class="hljs-string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>) -f<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºä¿¡æ¯ä¼šæ˜¾ç¤º Web æ§åˆ¶å°çš„ IP åœ°å€å’Œç«¯å£å·ï¼Œé»˜è®¤çš„ NodePort æ˜¯ <code>30880</code>ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨é»˜è®¤çš„å¸æˆ·å’Œå¯†ç  (<code>admin/P@88w0rd</code>) é€šè¿‡ <code>&lt;NodeIP&gt;:30880</code> è®¿é—®æ§åˆ¶å°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#####################################################</span><br><br><span class="hljs-comment">###              Welcome to KubeSphere!           ###</span><br><br><span class="hljs-comment">#####################################################</span><br><br><br><br>Console: http://192.168.0.164:30880<br><br>Account: admin<br><br>Password: P@88w0rd<br><br><br><br>NOTESï¼š<br><br>  1. After you <span class="hljs-built_in">log</span> into the console, please check the<br><br>     monitoring status of service components <span class="hljs-keyword">in</span><br><br>     <span class="hljs-string">&quot;Cluster Management&quot;</span>. If any service is not<br><br>     ready, please <span class="hljs-built_in">wait</span> patiently <span class="hljs-keyword">until</span> all components <br><br>     are up and running.<br><br>  2. Please change the default password after login.<br><br><br><br><span class="hljs-comment">#####################################################</span><br><br>https://kubesphere.io             20xx-xx-xx xx:xx:xx<br><br><span class="hljs-comment">#####################################################</span><br><br></code></pre></td></tr></table></figure><p>å½•è‡³æ§åˆ¶å°åï¼Œæ‚¨å¯ä»¥åœ¨<strong>ç³»ç»Ÿç»„ä»¶</strong>ä¸­æŸ¥çœ‹å„ä¸ªç»„ä»¶çš„çŠ¶æ€ã€‚å¦‚æœè¦ä½¿ç”¨ç›¸å…³æœåŠ¡ï¼Œæ‚¨å¯èƒ½éœ€è¦ç­‰å¾…éƒ¨åˆ†ç»„ä»¶å¯åŠ¨å¹¶è¿è¡Œã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>kubectl get pod --all-namespaces</code> æ¥æ£€æŸ¥ KubeSphere ç›¸å…³ç»„ä»¶çš„è¿è¡ŒçŠ¶å†µã€‚</p><h2 id="4ã€k8såŸºç¡€èµ„æºä»‹ç»"><a href="#4ã€k8såŸºç¡€èµ„æºä»‹ç»" class="headerlink" title="4ã€k8såŸºç¡€èµ„æºä»‹ç»"></a>4ã€k8såŸºç¡€èµ„æºä»‹ç»</h2><h3 id="4-1-å®¹å™¨ç»„ï¼ˆpodï¼‰"><a href="#4-1-å®¹å™¨ç»„ï¼ˆpodï¼‰" class="headerlink" title="4.1 å®¹å™¨ç»„ï¼ˆpodï¼‰"></a>4.1 å®¹å™¨ç»„ï¼ˆpodï¼‰</h3><ul><li>K8sä¸­æœ€å°çš„å¯éƒ¨ç½²å¯¹è±¡</li><li>ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„è¿è¡Œç¯å¢ƒ</li><li>å®¹å™¨é—´å…±äº«ç½‘ç»œå’Œå­˜å‚¨èµ„æº</li></ul><h3 id="4-2-å·¥ä½œè´Ÿè½½ï¼ˆdeploymentã€statefulsetã€daemonsetï¼‰"><a href="#4-2-å·¥ä½œè´Ÿè½½ï¼ˆdeploymentã€statefulsetã€daemonsetï¼‰" class="headerlink" title="4.2 å·¥ä½œè´Ÿè½½ï¼ˆdeploymentã€statefulsetã€daemonsetï¼‰"></a>4.2 å·¥ä½œè´Ÿè½½ï¼ˆdeploymentã€statefulsetã€daemonsetï¼‰</h3><ul><li>pod çš„æ§åˆ¶å™¨</li><li>ç®¡ç†podå‰¯æœ¬æ•°ï¼Œé…ç½®ï¼Œæ»šåŠ¨æ›´æ–°ï¼Œå›æ»špod</li><li>éƒ¨ç½²ï¼ˆdeploymentï¼‰ç®¡ç†æ§åˆ¶æ— çŠ¶æ€çš„å®¹å™¨ç»„ï¼Œå¦‚åç«¯ï¼Œå‰ç«¯ç­‰</li><li>æœ‰çŠ¶æ€å‰¯æœ¬é›†ï¼ˆstatefulsetï¼‰ç®¡ç†æ§åˆ¶æœ‰çŠ¶æ€çš„å®¹å™¨ç»„ï¼Œå¦‚mysqlï¼Œkafkaï¼Œesç­‰</li><li>å®ˆæŠ¤è¿›ç¨‹é›†ï¼ˆdaemonsetï¼‰,ç®¡ç†ä¸€ä¸ªèŠ‚ç‚¹åªè¿è¡Œä¸€ä¸ªçš„å®¹å™¨ç»„å‰¯æœ¬ï¼Œå¦‚fluentdï¼Œlogstash, Prometheus Node Exporter</li></ul><h3 id="4-3-æœåŠ¡ï¼ˆservice"><a href="#4-3-æœåŠ¡ï¼ˆservice" class="headerlink" title="4.3 æœåŠ¡ï¼ˆservice)"></a>4.3 æœåŠ¡ï¼ˆservice)</h3><ul><li>è®¿é—®å…¥å£ï¼ˆåˆ†å†…éƒ¨è®¿é—®å’Œå¤–éƒ¨è®¿é—®ï¼‰</li><li>è´Ÿè½½å‡è¡¡åˆ°å¤šä¸ªpodå‰¯æœ¬</li></ul><h3 id="4-4-ä»»åŠ¡ï¼ˆjob"><a href="#4-4-ä»»åŠ¡ï¼ˆjob" class="headerlink" title="4.4 ä»»åŠ¡ï¼ˆjob)"></a>4.4 ä»»åŠ¡ï¼ˆjob)</h3><ul><li>è®¿é—®å…¥å£ï¼ˆåˆ†å†…éƒ¨è®¿é—®å’Œå¤–éƒ¨è®¿é—®ï¼‰</li><li>è´Ÿè½½å‡è¡¡åˆ°å¤šä¸ªpodå‰¯æœ¬</li></ul><h3 id="4-5-æŒä¹…å·å’ŒæŒä¹…å·å£°æ˜ï¼ˆpv-pvc"><a href="#4-5-æŒä¹…å·å’ŒæŒä¹…å·å£°æ˜ï¼ˆpv-pvc" class="headerlink" title="4.5  æŒä¹…å·å’ŒæŒä¹…å·å£°æ˜ï¼ˆpv &amp; pvc)"></a>4.5  æŒä¹…å·å’ŒæŒä¹…å·å£°æ˜ï¼ˆpv &amp; pvc)</h3><ul><li>pv æ˜¯ä¸€å—å­˜å‚¨èµ„æº </li><li>pvc æ˜¯å¯¹PVçš„å£°æ˜å¼è¯·æ±‚ï¼Œæè¿°äº†Podéœ€è¦çš„å­˜å‚¨èµ„æºçš„éœ€æ±‚ï¼ŒåŒ…æ‹¬å­˜å‚¨å®¹é‡ã€è¯»å†™æ¨¡å¼ã€è®¿é—®æ¨¡å¼ç­‰</li><li>pv å’Œpvc ä¸€ä¸€å¯¹åº”</li></ul><h3 id="4-6-é…ç½®-secret-configmap-serviceaccount"><a href="#4-6-é…ç½®-secret-configmap-serviceaccount" class="headerlink" title="4.6 é…ç½®(secret,configmap,serviceaccount)"></a>4.6 é…ç½®(secret,configmap,serviceaccount)</h3><ul><li>ä¿å¯†å­—å…¸ï¼ˆsecretï¼‰: ç”¨äºå­˜å‚¨å’Œç®¡ç†å¯†ç ã€OAuth ä»¤ç‰Œå’Œ SSH ä¿å¯†å­—å…¸ç­‰æ•æ„Ÿä¿¡æ¯</li><li>é…ç½®å­—å…¸ï¼ˆconfigmapï¼‰: ç”¨äºå‘å®¹å™¨ç»„ä¸­æ³¨å…¥é…ç½®æ•°æ®</li><li>æœåŠ¡è´¦å·ï¼ˆserviceaccountï¼‰: ä¸º Pod ä¸­è¿è¡Œçš„è¿›ç¨‹æä¾›äº†æ ‡è¯†ã€‚å½“ç”¨æˆ·è®¿é—®é›†ç¾¤æ—¶ï¼ŒAPI æœåŠ¡å™¨å°†ç”¨æˆ·è®¤è¯ä¸ºç‰¹å®šçš„ç”¨æˆ·å¸æˆ·</li></ul><h2 id="5ã€èµ„æºä¹‹é—´çš„å…³ç³»"><a href="#5ã€èµ„æºä¹‹é—´çš„å…³ç³»" class="headerlink" title="5ã€èµ„æºä¹‹é—´çš„å…³ç³»"></a>5ã€èµ„æºä¹‹é—´çš„å…³ç³»</h2><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240520152157424.png?raw=true" alt="image-20240520152157424"></p><h2 id="6ã€æ–°å»ºè‡ªå®šä¹‰æœåŠ¡æš´éœ²mysqlæœåŠ¡"><a href="#6ã€æ–°å»ºè‡ªå®šä¹‰æœåŠ¡æš´éœ²mysqlæœåŠ¡" class="headerlink" title="6ã€æ–°å»ºè‡ªå®šä¹‰æœåŠ¡æš´éœ²mysqlæœåŠ¡"></a>6ã€æ–°å»ºè‡ªå®šä¹‰æœåŠ¡æš´éœ²mysqlæœåŠ¡</h2><blockquote><p>ä»“åº“åœ°å€:</p><p> bitnami å®˜ç½‘ï¼š <a href="https://charts.bitnami.com/bitnami">https://charts.bitnami.com/bitnami</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ helm repo add bitnami https://charts.bitnami.com/bitnami<br>$ helm search repo bitnami<br>$ helm install my-release bitnami/&lt;chart&gt;<br></code></pre></td></tr></table></figure><blockquote><p>ç¬¬ä¸€æ­¥ åˆ›å»ºä¼ä¸šç©ºé—´</p><p>ç¬¬äºŒæ­¥ æ·»åŠ åº”ç”¨ä»“åº“</p></blockquote><h3 id="1-æ–°å»ºmysqlæ•°æ®åº“æœåŠ¡"><a href="#1-æ–°å»ºmysqlæ•°æ®åº“æœåŠ¡" class="headerlink" title="1 æ–°å»ºmysqlæ•°æ®åº“æœåŠ¡"></a><strong>1 æ–°å»ºmysqlæ•°æ®åº“æœåŠ¡</strong></h3><p>åº”ç”¨è´Ÿè½½ -&gt; æœåŠ¡ -&gt; åˆ›å»º -&gt; é€‰æ‹©æœ‰çŠ¶æ€æœåŠ¡</p><h4 id="ç¬¬ä¸€æ­¥-åŸºæœ¬ä¿¡æ¯"><a href="#ç¬¬ä¸€æ­¥-åŸºæœ¬ä¿¡æ¯" class="headerlink" title="ç¬¬ä¸€æ­¥ åŸºæœ¬ä¿¡æ¯"></a><strong>ç¬¬ä¸€æ­¥ åŸºæœ¬ä¿¡æ¯</strong></h4><p>å¡«å†™æœåŠ¡åç§° -&gt; ä¸‹ä¸€æ­¥</p><h4 id="ç¬¬äºŒæ­¥-å®¹å™¨ç»„è®¾ç½®"><a href="#ç¬¬äºŒæ­¥-å®¹å™¨ç»„è®¾ç½®" class="headerlink" title="ç¬¬äºŒæ­¥ å®¹å™¨ç»„è®¾ç½®"></a><strong>ç¬¬äºŒæ­¥ å®¹å™¨ç»„è®¾ç½®</strong></h4><p>1 æ·»åŠ å®¹å™¨ -&gt;2 é€‰æ‹©é•œåƒä»“åº“ -&gt;3 å¡«å†™é•œåƒåç§°å’Œç‰ˆæœ¬ -&gt;4 å¡«å†™å®¹å™¨åç§° -&gt;5 ä½¿ç”¨é»˜è®¤ç«¯å£</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/5f58e604-f78d-49d3-924a-c0df0952e5b3.png?raw=true" alt="img"></p><p>æ»šè½®ä¸‹åˆ’ï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ï¼Œè®¾ç½®åˆå§‹rootå¯†ç </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/4e06eee2-d151-4e48-9ba5-9df0d609b15f.png?raw=true" alt="img"></p><h4 id="ç¬¬ä¸‰æ­¥-å­˜å‚¨è®¾ç½®"><a href="#ç¬¬ä¸‰æ­¥-å­˜å‚¨è®¾ç½®" class="headerlink" title="ç¬¬ä¸‰æ­¥ å­˜å‚¨è®¾ç½®"></a><strong>ç¬¬ä¸‰æ­¥ å­˜å‚¨è®¾ç½®</strong></h4><p>å­˜å‚¨è®¾ç½®ï¼Œæ·»åŠ æŒä¹…å·ç”³æ˜æ¨¡æ¿</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/4dd6494e-97d2-45d1-b674-d06468a94deb.png?raw=true" alt="img"></p><p>1 å¡«å†™æŒä¹…å·ç”³æ˜åç§°å‰ç¼€ -&gt; 2 é€‰æ‹©å­˜å‚¨ç±»ï¼ˆé»˜è®¤localï¼‰ -&gt; 3 é€‰æ‹©è®¿é—®æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰-&gt; 4 è®¾ç½®å­˜å‚¨ç©ºé—´å¤§å° -&gt;</p><p>5 é€‰æ‹©è¯»å†™æ¨¡å¼ -&gt; 6 å¡«å†™å®¹å™¨å†…æ•°æ®æ‰€åœ¨ç›®å½• -&gt; ç¡®å®š -&gt; ä¸‹ä¸€æ­¥</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/6694c3e2-2492-4968-9066-284977513e97.png?raw=true" alt="img"></p><h4 id="ç¬¬å››æ­¥-é«˜çº§è®¾ç½®"><a href="#ç¬¬å››æ­¥-é«˜çº§è®¾ç½®" class="headerlink" title="ç¬¬å››æ­¥ é«˜çº§è®¾ç½®"></a><strong>ç¬¬å››æ­¥ é«˜çº§è®¾ç½®</strong></h4><p>ä¼šè¯ä¿æŒï¼šä¸€èˆ¬åœ¨åç«¯æœåŠ¡ä¸­å¯ä»¥è®¾ç½®ï¼ŒåŒä¸€ä¸ªç”¨æˆ·è¿ç»­è®¿é—®ï¼Œä¼šåœ¨ä¸€æ®µæ—¶é—´å†…è´Ÿè½½åˆ°åŒä¸€ä¸ªå®¹å™¨ç»„å‰¯æœ¬</p><p>é€‰æ‹©èŠ‚ç‚¹ï¼šå¯ä»¥é€‰æ‹©å°†å®¹å™¨éƒ¨ç½²è‡³k8sé›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/06a335af-81fa-49df-8203-813a57beda34.png?raw=true" alt="img"></p><p>æœ‰çŠ¶æ€æœåŠ¡æ–°å»ºå®Œåªèƒ½å†…éƒ¨ä½¿ç”¨</p><h4 id="ç¬¬äº”æ­¥-æ–°å»ºè‡ªå®šä¹‰æœåŠ¡æš´éœ²mysqlæœåŠ¡"><a href="#ç¬¬äº”æ­¥-æ–°å»ºè‡ªå®šä¹‰æœåŠ¡æš´éœ²mysqlæœåŠ¡" class="headerlink" title="ç¬¬äº”æ­¥ æ–°å»ºè‡ªå®šä¹‰æœåŠ¡æš´éœ²mysqlæœåŠ¡"></a><strong>ç¬¬äº”æ­¥ æ–°å»ºè‡ªå®šä¹‰æœåŠ¡æš´éœ²mysqlæœåŠ¡</strong></h4><p>1 åº”ç”¨è´Ÿè½½ -&gt; 2 æœåŠ¡ -&gt;3 åˆ›å»º -&gt; 4 è‡ªå®šä¹‰æœåŠ¡ -&gt;5 æŒ‡å®šå·¥ä½œè´Ÿè½½ </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/84fc16e6-7888-4a67-ae10-0bcbb6be5e34.png?raw=true" alt="img"></p><p>6 å¡«å†™æœåŠ¡åç§° -&gt; 7 ä¸‹ä¸€æ­¥</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/0907b73e-5e1b-40e8-85e8-2656fd543acb.png?raw=true" alt="img"></p><p>8 æŒ‡å®šå·¥ä½œè´Ÿè½½ -&gt; 9 æœ‰çŠ¶æ€å‰¯æœ¬é›† -&gt; 10 é€‰æ‹©ä¹‹å‰åˆ›å»ºçš„mysql -&gt;11 ç¡®å®š </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/cf1c4ccc-dd26-4009-85ac-2b26f1430005.png?raw=true" alt="img"></p><p>12 é€‰æ‹©æœåŠ¡ç«¯å£åè®® -&gt;13 å¡«å†™åç§° -&gt;14 å¡«å†™å®¹å™¨ç«¯å£ -&gt;15 æœåŠ¡ç«¯å£ -&gt;16 ä¸‹ä¸€æ­¥</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/74be5fde-79ae-4e1a-a173-e39dec04c508.png?raw=true" alt="img"></p><p>17 å‹¾é€‰å¤–éƒ¨è®¿é—®ï¼ˆå¦‚æœä¸é…ç½®ï¼Œé‚£è¯¥æœåŠ¡åªèƒ½k8sé›†ç¾¤èŠ‚ç‚¹å†…éƒ¨è®¿é—®ï¼‰-&gt; 18 é€‰æ‹©è®¿é—®æ¨¡å¼ -&gt; 19 åˆ›å»º</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/93bec419-be27-4915-b98d-23811b5ac078.png?raw=true" alt="img"></p><h4 id="ç¬¬å…­æ­¥-mysql-æœåŠ¡ä½¿ç”¨æ–¹æ³•"><a href="#ç¬¬å…­æ­¥-mysql-æœåŠ¡ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ç¬¬å…­æ­¥ mysql æœåŠ¡ä½¿ç”¨æ–¹æ³•"></a><strong>ç¬¬å…­æ­¥ mysql æœåŠ¡ä½¿ç”¨æ–¹æ³•</strong></h4><p>1 å†…éƒ¨ipåŠ ç«¯å£: 10.233.4.60:3306</p><p>2 å†…éƒ¨åŸŸååŠ ç«¯å£ï¼š</p><p>  åŒä¸€ä¸ªé¡¹ç›®å†…ï¼Œmysql-ex:3306</p><p>  ä¸åŒé¡¹ç›®ä½¿ç”¨ï¼Œmysql-ex.superlab.svc.cluster.local:3306</p><p>3 å¤–éƒ¨ipåŠ ç«¯å£: 192.168.0.104:10419</p><p>ç”¨æˆ·åï¼šroot</p><p>å¯†ç ï¼šç¬¬äºŒæ­¥å¡«å†™çš„ç¯å¢ƒå˜é‡å€¼</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/5be003b4-4830-4c98-954c-995b5a3a5476.png?raw=true" alt="img"></p><h3 id="2-æ–°å»ºåç«¯æœåŠ¡"><a href="#2-æ–°å»ºåç«¯æœåŠ¡" class="headerlink" title="2 æ–°å»ºåç«¯æœåŠ¡"></a><strong>2 æ–°å»ºåç«¯æœåŠ¡</strong></h3><h4 id="ç¬¬é›¶æ­¥-é…ç½®é•œåƒä»“åº“ä¿¡æ¯"><a href="#ç¬¬é›¶æ­¥-é…ç½®é•œåƒä»“åº“ä¿¡æ¯" class="headerlink" title="ç¬¬é›¶æ­¥ é…ç½®é•œåƒä»“åº“ä¿¡æ¯"></a><strong>ç¬¬é›¶æ­¥ é…ç½®é•œåƒä»“åº“ä¿¡æ¯</strong></h4><p>é…ç½® -&gt; ä¿å¯†å­—å…¸ -&gt; åˆ›å»º</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/6c1fd5df-5a05-4b01-8952-adfa55d01302.png?raw=true" alt="img"></p><p>3 å¡«å†™åç§° -&gt; ä¸‹ä¸€æ­¥ -&gt; é€‰æ‹©ç±»å‹-&gt; é•œåƒæœåŠ¡ä¿¡æ¯</p><p>4 å¡«å†™é•œåƒæœåŠ¡åœ°å€-&gt; ç”¨æˆ·å -&gt; å¯†ç  -&gt; åˆ›å»º ï¼ˆé•œåƒä»“åº“ä¿¡æ¯æ‰¾å„è‡ªä»£ç ä»“åº“ç®¡ç†å‘˜è¦ï¼‰</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/77d02f21-7d72-4f4b-b081-07ffe2f4a638.png?raw=true" alt="img"></p><h4 id="ç¬¬ä¸€æ­¥-åŸºæœ¬ä¿¡æ¯-1"><a href="#ç¬¬ä¸€æ­¥-åŸºæœ¬ä¿¡æ¯-1" class="headerlink" title="ç¬¬ä¸€æ­¥ åŸºæœ¬ä¿¡æ¯"></a><strong>ç¬¬ä¸€æ­¥ åŸºæœ¬ä¿¡æ¯</strong></h4><p>åº”ç”¨è´Ÿè½½ -&gt; æœåŠ¡ -&gt; åˆ›å»º -&gt; é€‰æ‹©æ— çŠ¶æ€æœåŠ¡</p><p>1 å¡«å†™æœåŠ¡åç§° -&gt;2 ä¸‹ä¸€æ­¥</p><h4 id="ç¬¬äºŒæ­¥-å®¹å™¨ç»„è®¾ç½®-1"><a href="#ç¬¬äºŒæ­¥-å®¹å™¨ç»„è®¾ç½®-1" class="headerlink" title="ç¬¬äºŒæ­¥ å®¹å™¨ç»„è®¾ç½®"></a><strong>ç¬¬äºŒæ­¥</strong> <strong>å®¹å™¨ç»„è®¾ç½®</strong></h4><p>3 æ·»åŠ å®¹å™¨ -&gt;4 é€‰æ‹©é•œåƒä»“åº“ -&gt;5 å¡«å†™é•œåƒåç§°å’Œç‰ˆæœ¬ -&gt;6 å¡«å†™å®¹å™¨åç§° -&gt;7 ä½¿ç”¨é»˜è®¤ç«¯å£</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/1fe9ab97-15f7-4cbd-99c0-bcdbf753fe02.png?raw=true" alt="img"></p><p>8 æ»šè½®ä¸‹æ»‘ -&gt;9 å‹¾é€‰ç¯å¢ƒå˜é‡ -&gt;10 å¡«å†™mysqlåœ°å€ï¼Œç«¯å£ï¼Œè´¦å·ï¼Œå¯†ç ï¼ˆå»ºè®®å°†è¿™äº›é…ç½®é…æˆæ ¹æ®ç¯å¢ƒå˜é‡åŠ¨æ€è·å–ï¼‰-&gt; 11 ç¡®å®š -&gt; 12 ä¸‹ä¸€æ­¥</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/c7c860bb-6460-4920-87ef-67fc973d419f.png?raw=true" alt="img"></p><p><strong>ç¬¬ä¸‰æ­¥ å­˜å‚¨è®¾ç½®</strong></p><p>å¦‚éœ€æŒ‚è½½æ•°æ®æ–‡ä»¶ï¼Œé€‰æ‹©â€œæŒ‚è½½å·â€</p><p>å¦‚éœ€æŒ‚è½½é…ç½®æ–‡ä»¶ï¼Œé€‰æ‹©â€œæŒ‚è½½é…ç½®å­—å…¸æˆ–ä¿å¯†å­—å…¸â€</p><p>æ— éœ€æŒ‚è½½ï¼Œç›´æ¥â€ä¸‹ä¸€æ­¥â€</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/bcb65ce3-b69e-49ed-820c-40825623dcb8.png?raw=true" alt="img"></p><h4 id="ç¬¬å››æ­¥-é«˜çº§è®¾ç½®-1"><a href="#ç¬¬å››æ­¥-é«˜çº§è®¾ç½®-1" class="headerlink" title="ç¬¬å››æ­¥ é«˜çº§è®¾ç½®"></a><strong>ç¬¬å››æ­¥ é«˜çº§è®¾ç½®</strong></h4><p>æ ¹æ®éœ€è¦è®¾ç½®å¤–éƒ¨è®¿é—®ï¼Œä¼šè¯ä¿æŒï¼Œé€‰æ‹©èŠ‚ç‚¹</p><p>æ— éœ€è¦åˆ™â€œä¸‹ä¸€æ­¥â€</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/2a2ea879-6a0a-4131-a03d-89147528b8e3.png?raw=true" alt="img"></p><h4 id="ç¬¬äº”æ­¥-å¾€éƒ¨ç½²é…ç½®ä¸­åŠ å…¥é•œåƒä»“åº“ä¿¡æ¯"><a href="#ç¬¬äº”æ­¥-å¾€éƒ¨ç½²é…ç½®ä¸­åŠ å…¥é•œåƒä»“åº“ä¿¡æ¯" class="headerlink" title="ç¬¬äº”æ­¥ å¾€éƒ¨ç½²é…ç½®ä¸­åŠ å…¥é•œåƒä»“åº“ä¿¡æ¯"></a><strong>ç¬¬äº”æ­¥ å¾€éƒ¨ç½²é…ç½®ä¸­åŠ å…¥é•œåƒä»“åº“ä¿¡æ¯</strong></h4><p>1 è¿›å…¥éƒ¨ç½²ä¿¡æ¯é¡µé¢ï¼Œåº”ç”¨è´Ÿè½½ -&gt; å·¥ä½œè´Ÿè½½ -&gt; ç‚¹å‡»éƒ¨ç½²åç§°ï¼ˆä»¥<a href="http://192.168.0.104:30880/supertech/clusters/default/projects/superlab/deployments/classification-workers-v1"><strong>classification-workers-v1</strong></a><strong>ä¸ºä¾‹</strong>ï¼‰ </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/ad92fbaf-3064-4520-9c35-f0a8f8ff0f1a.png?raw=true" alt="img"></p><p>2 ç¼–è¾‘yaml ,æ·»åŠ ç¬¬é›¶æ­¥é…ç½®çš„é•œåƒæœåŠ¡ä¿å¯†å­—å…¸çš„åç§°</p><p>æ›´å¤šæ“ä½œ -&gt; ç¼–è¾‘yaml ï¼Œ åœ¨spec.template.specä¸‹æ·»åŠ é•œåƒæœåŠ¡ä¿å¯†å­—å…¸åç§°</p><p>imagePullSecrets:</p><p>â€‹    - name: hangzhou-aliyuncs-comï¼ˆè¿™é‡Œæ¢æˆè‡ªå·±åˆ›å»ºçš„é•œåƒæœåŠ¡ä¿å¯†å­—å…¸çš„åç§°ï¼‰</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/907a9a99-dae4-4a59-b12f-6704bc564624.png?raw=true" alt="img"></p><h4 id="ç¬¬å…­æ­¥-åç«¯æœåŠ¡å¦‚ä½•è°ƒç”¨"><a href="#ç¬¬å…­æ­¥-åç«¯æœåŠ¡å¦‚ä½•è°ƒç”¨" class="headerlink" title="ç¬¬å…­æ­¥ åç«¯æœåŠ¡å¦‚ä½•è°ƒç”¨"></a><strong>ç¬¬å…­æ­¥ åç«¯æœåŠ¡å¦‚ä½•è°ƒç”¨</strong></h4><p>æŒ‰ç›®å‰å…¬å¸å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ï¼ˆnginx+å‰ç«¯é™æ€æ–‡ä»¶+åç«¯æœåŠ¡ç«¯å£ï¼‰</p><p>åœ¨nginxä¸­é…ç½®å†…éƒ¨ip+ç«¯å£ï¼Œè´Ÿè½½åç«¯æœåŠ¡</p><p>1 å‰ç«¯è´Ÿè½½é…ç½®</p><p>2 åç«¯è´Ÿè½½é…ç½®</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/eeee85a1-5c7c-418d-aac7-a7dd6b17db90.png?raw=true" alt="img"></p><p>åº”ç”¨è´Ÿè½½ -&gt; æœåŠ¡ -&gt; è¿›å…¥åç«¯æœåŠ¡</p><p>æŸ¥çœ‹å¯¹åº”çš„å†…éƒ¨æœåŠ¡ip å’ŒæœåŠ¡ç«¯å£</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/4bb8696b-a8b3-405f-86b7-589c1c222b38.png?raw=true" alt="img"></p><h3 id="3-æ–°å»ºå‰ç«¯æœåŠ¡"><a href="#3-æ–°å»ºå‰ç«¯æœåŠ¡" class="headerlink" title="3  æ–°å»ºå‰ç«¯æœåŠ¡"></a>3  <strong>æ–°å»ºå‰ç«¯æœåŠ¡</strong></h3><p>æ­¥éª¤ä¸åç«¯æœåŠ¡åˆ›å»ºè¿‡ç¨‹ä¸€æ ·</p><p>åªæ˜¯å°†é•œåƒæ¢æˆäº†å‰ç«¯é•œåƒ</p><p>å‰ç«¯é•œåƒçš„dockerfileæœ¬è´¨æ˜¯åŸºäºnginxï¼Œ</p><p>ç„¶ååœ¨nginxçš„é…ç½®æ–‡ä»¶é‡Œé…ç½®äº†</p><p>å‰ç«¯é™æ€æ–‡ä»¶è´Ÿè½½å’Œ</p><p>åç«¯æ¥å£æœåŠ¡è´Ÿè½½</p><p>æ–°å»ºå®Œä»¥åéœ€è¦æš´éœ²å‰ç«¯æœåŠ¡</p><p>åº”ç”¨è´Ÿè½½ -&gt; æœåŠ¡ -&gt; æ›´å¤š -&gt; ç¼–è¾‘å¤–éƒ¨è®¿é—®</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/a11ddcd9-4f05-4ab3-bf2a-db221bc03f0f.png?raw=true" alt="img"></p><p>é€‰æ‹©è®¿é—®æ¨¡å¼ -&gt; ç¡®å®š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/38897e5b-fcf1-4dba-8874-79cb5c887140.png?raw=true" alt="img"></p><p>åœ¨æµè§ˆå™¨ä¸­ï¼Œç”¨ip+ç«¯å£å³å¯è®¿é—®å‰ç«¯é¡µé¢</p><p>192.168.0.104:42064</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/14d3c33b-fa55-45b1-8a49-72a0f2e4bf56.png?raw=true" alt="img"></p><h2 id="7ã€kubectlå¸¸ç”¨å‘½ä»¤"><a href="#7ã€kubectlå¸¸ç”¨å‘½ä»¤" class="headerlink" title="7ã€kubectlå¸¸ç”¨å‘½ä»¤"></a>7ã€kubectlå¸¸ç”¨å‘½ä»¤</h2><p><code>kubectl</code> æ˜¯ Kubernetes çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ Kubernetes é›†ç¾¤è¿›è¡Œäº¤äº’ï¼ŒåŒ…æ‹¬éƒ¨ç½²åº”ç”¨ã€æ£€æŸ¥å’Œç®¡ç†å„ç§èµ„æºã€‚ä¸€äº›åŸºæœ¬çš„ <code>kubectl</code> å‘½ä»¤åŒ…æ‹¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get ns<span class="hljs-comment"># æŸ¥çœ‹å‘½åç©ºé—´</span><br>kubectl get pods  -n &lt;namespace-name&gt;<span class="hljs-comment"># æŸ¥çœ‹å‘½åç©ºé—´æ‰€æœ‰Podåˆ—è¡¨</span><br>kubectl describe pods/&lt;pod-name&gt;<span class="hljs-comment"># æ˜¾ç¤ºPodçš„è¯¦ç»†ä¿¡æ¯</span><br>kubectl config set-context --current --namespace=production      <span class="hljs-comment"># åˆ‡æ¢åˆ°ä¸åŒçš„å‘½åç©ºé—´</span><br>kubectl config view --minify | grep namespace: <span class="hljs-comment"># æŸ¥çœ‹å½“å‰æ‰€å±å‘½åç©ºé—´</span><br>kubectl get service     <span class="hljs-comment"># æŸ¥çœ‹serviceåˆ—è¡¨</span><br>kubectl get deployments <span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸­çš„Deployments</span><br>kubectl create -f my-service.yaml   <span class="hljs-comment"># æ ¹æ®yamlé…ç½®æ–‡ä»¶ä¸€æ¬¡æ€§åˆ›å»ºservice</span><br>kubectl create -f &lt;directory&gt; <span class="hljs-comment"># æ ¹æ®ç›®å½•ä¸‹æ‰€æœ‰.yamlã€.ymlã€.jsonæ–‡ä»¶çš„å®šä¹‰è¿›è¡Œåˆ›å»ºæ“ä½œ</span><br>kubectl delete -f pod.yaml <span class="hljs-comment"># åˆ é™¤åŸºäºpod.yamlæ–‡ä»¶å®šä¹‰çš„Pod</span><br>kubectl delete pods --all <span class="hljs-comment"># åˆ é™¤æ‰€æœ‰Pod</span><br>kubectl <span class="hljs-built_in">exec</span> &lt;pod-name&gt; <span class="hljs-built_in">date</span> <span class="hljs-comment"># åœ¨Podçš„å®¹å™¨é‡Œæ‰§è¡Œdateå‘½ä»¤ï¼Œé»˜è®¤ä½¿ç”¨Podä¸­çš„ç¬¬1ä¸ªå®¹å™¨æ‰§è¡Œ</span><br>kubectl <span class="hljs-built_in">exec</span> &lt;pod-name&gt; -c &lt;container-name&gt; <span class="hljs-built_in">date</span> <span class="hljs-comment"># æŒ‡å®šPodä¸­æŸä¸ªå®¹å™¨æ‰§è¡Œdateå‘½ä»¤</span><br>kubectl <span class="hljs-built_in">exec</span> -it &lt;pod-name&gt; -c &lt;container-name&gt; /bin/bash        <span class="hljs-comment"># ä»¥bashæ–¹å¼ç™»é™†åˆ°Podä¸­çš„æŸä¸ªå®¹å™¨é‡Œ</span><br>kubectl logs -f &lt;pod-name&gt; -c &lt;container-name&gt; <span class="hljs-comment"># è·Ÿè¸ªæŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—ï¼Œç›¸å½“äºtail -få‘½ä»¤çš„ç»“æœ</span><br></code></pre></td></tr></table></figure><h2 id="8ã€kubeadmå¸¸ç”¨å‘½ä»¤"><a href="#8ã€kubeadmå¸¸ç”¨å‘½ä»¤" class="headerlink" title="8ã€kubeadmå¸¸ç”¨å‘½ä»¤"></a>8ã€kubeadmå¸¸ç”¨å‘½ä»¤</h2><p><code>kubeadm</code> æ˜¯ Kubernetes çš„ä¸€ä¸ªç®€åŒ–é›†ç¾¤åˆå§‹åŒ–å’Œç®¡ç†å·¥å…·ï¼Œå®ƒæ—¨åœ¨æä¾›ä¸€ç§å¿«é€Ÿã€å¯é çš„æ–¹å¼æ¥å¼•å¯¼æœ€å°åŒ–çš„ Kubernetes æ§åˆ¶å¹³é¢ä»¥åŠåŠ å…¥å·¥ä½œèŠ‚ç‚¹åˆ°é›†ç¾¤ä¸­ã€‚ä¸€äº›å¸¸ç”¨çš„ <code>kubeadm</code> å‘½ä»¤åŒ…æ‹¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubeadm init <span class="hljs-comment"># å¯åŠ¨å¼•å¯¼ä¸€ä¸ª Kubernetes ä¸»èŠ‚ç‚¹</span><br>kubeadm <span class="hljs-built_in">join</span> <span class="hljs-comment"># å¯åŠ¨å¼•å¯¼ä¸€ä¸ª Kubernetes å·¥ä½œèŠ‚ç‚¹å¹¶ä¸”å°†å…¶åŠ å…¥åˆ°é›†ç¾¤</span><br>kubeadm upgrade <span class="hljs-comment"># æ›´æ–° Kubernetes é›†ç¾¤åˆ°æ–°ç‰ˆæœ¬</span><br>kubeadm config <span class="hljs-comment"># å¦‚æœä½ ä½¿ç”¨ kubeadm v1.7.x æˆ–è€…æ›´ä½ç‰ˆæœ¬ï¼Œä½ éœ€è¦å¯¹ä½ çš„é›†ç¾¤åšä¸€äº›é…ç½®ä»¥ä¾¿ä½¿ç”¨ kubeadmupgrade å‘½ä»¤</span><br>kubeadm token <span class="hljs-comment"># ä½¿ç”¨ kubeadm join æ¥ç®¡ç†ä»¤ç‰Œ</span><br>kubeadm reset  <span class="hljs-comment"># è¿˜åŸä¹‹å‰ä½¿ç”¨ kubeadm init æˆ–è€… kubeadm join å¯¹èŠ‚ç‚¹æ‰€ä½œæ”¹å˜</span><br>kubeadm version <span class="hljs-comment"># æ‰“å°å‡º kubeadm ç‰ˆæœ¬</span><br>kubeadm alpha <span class="hljs-comment"># é¢„è§ˆä¸€ç»„å¯ç”¨çš„æ–°åŠŸèƒ½ä»¥ä¾¿ä»ç¤¾åŒºæœé›†åé¦ˆ</span><br></code></pre></td></tr></table></figure><h2 id="9-ã€kubelet"><a href="#9-ã€kubelet" class="headerlink" title="9 ã€kubelet"></a>9 ã€kubelet</h2><p><code>kubelet</code> æ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä¸»è¦å®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£ä¸Masteré€šä¿¡ã€ç®¡ç†Podsã€å®¹å™¨ä»¥åŠå…¶ä»–ç›¸å…³ä»»åŠ¡ã€‚é€šå¸¸ï¼Œkubeletä¸æ˜¯ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œä¸ä¹‹äº¤äº’ï¼Œè€Œæ˜¯é€šè¿‡é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>/var/lib/kubelet/kubelet-config.yaml</code>ï¼‰å’Œç¯å¢ƒå˜é‡æ¥è®¾å®šã€‚ä¸è¿‡ï¼Œäº†è§£å…¶åŠŸèƒ½å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒè´Ÿè´£ï¼š</p><ul><li><strong>Pod å’Œå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šæ ¹æ®ä»apiserveræ¥æ”¶åˆ°çš„æŒ‡ä»¤æ¥åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤Podå’Œå®¹å™¨ã€‚</li><li><strong>èµ„æºç›‘æ§å’ŒæŠ¥å‘Š</strong>ï¼šæ”¶é›†èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µï¼Œå‘MasteræŠ¥å‘Šã€‚</li><li><strong>æ—¥å¿—å’Œç›‘æ§</strong>ï¼šç®¡ç†å®¹å™¨æ—¥å¿—ï¼Œæ”¯æŒä¸æ—¥å¿—æ”¶é›†ç³»ç»Ÿçš„é›†æˆã€‚</li></ul><h2 id="10ã€æ‰“åŒ…helméƒ¨ç½²æµç¨‹"><a href="#10ã€æ‰“åŒ…helméƒ¨ç½²æµç¨‹" class="headerlink" title="10ã€æ‰“åŒ…helméƒ¨ç½²æµç¨‹"></a>10ã€æ‰“åŒ…helméƒ¨ç½²æµç¨‹</h2><h3 id="1ã€æ·»åŠ å…¬å¸helm-chart-ä»“åº“"><a href="#1ã€æ·»åŠ å…¬å¸helm-chart-ä»“åº“" class="headerlink" title="1ã€æ·»åŠ å…¬å¸helm chart ä»“åº“"></a>1ã€<strong>æ·»åŠ å…¬å¸helm chart ä»“åº“</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">helm repo add helm-repo-115 http://115.231.236.115:8081/nexus/repository/helm-repo-115/<br></code></pre></td></tr></table></figure><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/8057ec28-197d-4b46-ac2d-be3fadef95a7.png?raw=true" alt="img"></p><h3 id="2ã€åˆ›å»ºä¸€ä¸ªåº”ç”¨ç›®å½•"><a href="#2ã€åˆ›å»ºä¸€ä¸ªåº”ç”¨ç›®å½•" class="headerlink" title="2ã€åˆ›å»ºä¸€ä¸ªåº”ç”¨ç›®å½•"></a>2ã€åˆ›å»ºä¸€ä¸ªåº”ç”¨ç›®å½•</h3><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/19b5ab45-a0b2-49d0-a624-5437aaa2a102.png?raw=true" alt="img"></p><h3 id="3ã€åˆå§‹åŒ–"><a href="#3ã€åˆå§‹åŒ–" class="headerlink" title="3ã€åˆå§‹åŒ–"></a>3ã€åˆå§‹åŒ–</h3><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/c48b3afe-b905-4f20-8531-f6ce9c6eaeda.png?raw=true" alt="img"></p><h3 id="4ã€ç›®å½•ç»“æ„ä»‹ç»"><a href="#4ã€ç›®å½•ç»“æ„ä»‹ç»" class="headerlink" title="4ã€ç›®å½•ç»“æ„ä»‹ç»"></a>4ã€ç›®å½•ç»“æ„ä»‹ç»</h3><p>harts: ç›®å½•åŒ…å«äº†ä¾èµ–çš„å…¶ä»–Helm Chartsï¼Œå¯ä»¥è®©æ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­å¼•å…¥å…¶ä»–çš„Helm Charts</p><p>Chart.yaml: å…ƒæ•°æ®æ–‡ä»¶ï¼ŒåŒ…å«äº†åº”ç”¨ç¨‹åºçš„åç§°ã€ç‰ˆæœ¬ã€æè¿°ã€ç»´æŠ¤äººå‘˜ç­‰ä¿¡æ¯</p><p>templates: ç›®å½•åŒ…å«äº†åº”ç”¨ç¨‹åºçš„Kubernetesèµ„æºé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚Deploymentã€Serviceã€Configmapç­‰</p><p>values.yamlï¼šåº”ç”¨ç¨‹åºçš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œç”¨äºè®¾ç½®åº”ç”¨ç¨‹åºçš„é»˜è®¤å‚æ•°å€¼</p><h3 id="5-åˆæ­¥æ‰“åŒ…ä»‹ç»"><a href="#5-åˆæ­¥æ‰“åŒ…ä»‹ç»" class="headerlink" title="5 åˆæ­¥æ‰“åŒ…ä»‹ç»"></a>5 åˆæ­¥æ‰“åŒ…ä»‹ç»</h3><p><strong>ç¬¬ä¸€æ­¥ åˆ é™¤ templates ä¸‹æ‰€æœ‰æ–‡ä»¶</strong></p><p><strong>ç¬¬äºŒæ­¥ è·å–è¦æ‰“åŒ…çš„å®Œæ•´åº”ç”¨åœ¨k8s ä¸Šçš„æ‰€æœ‰èµ„æºé…ç½®æ–‡ä»¶ï¼ŒåŒ…å«æœåŠ¡ï¼Œå·¥ä½œè´Ÿè½½ï¼Œé…ç½®é¡¹ç­‰</strong></p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/bd4c8502-9c3b-4b49-92f5-2263119821e8.png?raw=true" alt="img"></p><p><strong>ç¬¬ä¸‰æ­¥ å°†é…ç½®æ–‡ä»¶æ”¾å…¥templates ç›®å½•</strong></p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/c9723cc5-7eb1-48cc-b332-03a313e25a90.png?raw=true" alt="img"></p><p><strong>ç¬¬å››æ­¥ æ ¹æ®ç‰ˆæœ¬å·æ‰“åŒ…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">helm package mychart --version 1.0.0<br></code></pre></td></tr></table></figure><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/eff431f6-c344-4425-9a79-217005de1f32.png?raw=true" alt="img"></p><p><strong>ç¬¬äº”æ­¥ æ¨é€åˆ°ä»“åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">helm nexus-push helm-repo-115 mychart-1.0.0.tgz -u admin -p  &#123;å¯†ç &#125;<br></code></pre></td></tr></table></figure><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/8dfcb80c-6d9f-4bad-9986-3c94e0708309.png?raw=true" alt="img"></p><h2 id="11ã€ä½¿ç”¨helmåŒ…éƒ¨ç½²å®Œæ•´åº”ç”¨æµç¨‹"><a href="#11ã€ä½¿ç”¨helmåŒ…éƒ¨ç½²å®Œæ•´åº”ç”¨æµç¨‹" class="headerlink" title="11ã€ä½¿ç”¨helmåŒ…éƒ¨ç½²å®Œæ•´åº”ç”¨æµç¨‹"></a>11ã€<strong>ä½¿ç”¨helmåŒ…éƒ¨ç½²å®Œæ•´åº”ç”¨æµç¨‹</strong></h2><h3 id="1-æ·»åŠ helmä»“åº“"><a href="#1-æ·»åŠ helmä»“åº“" class="headerlink" title="1 æ·»åŠ helmä»“åº“"></a><strong>1 æ·»åŠ helmä»“åº“</strong></h3><p>å¹³å°ç®¡ç† -&gt; è®¿é—®æ§åˆ¶ -&gt; è¿›å…¥ä¼ä¸šç©ºé—´</p><p>åº”ç”¨ç®¡ç† -&gt; åº”ç”¨ä»“åº“ -&gt; æ·»åŠ </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/5a3a662d-741b-4d77-bd15-8bc2f4c1617c.png?raw=true" alt="img"></p><p>å¡«å†™ä»“åº“ä¿¡æ¯</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/1dec1227-804c-492f-b74e-84d750147789.png?raw=true" alt="img"></p><h3 id="2-ä¸€é”®éƒ¨ç½²åº”ç”¨"><a href="#2-ä¸€é”®éƒ¨ç½²åº”ç”¨" class="headerlink" title="2 ä¸€é”®éƒ¨ç½²åº”ç”¨"></a><strong>2 ä¸€é”®éƒ¨ç½²åº”ç”¨</strong></h3><p>è¿›å…¥é¡¹ç›® -&gt; åº”ç”¨è´Ÿè½½ -&gt; åŸºäºæ¨¡æ¿çš„åº”ç”¨ -&gt; åˆ›å»º</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/a17c75e3-2223-4008-8c29-55515a8b453f.png?raw=true" alt="img"></p><p>é€‰æ‹©åº”ç”¨ä»“åº“helm-repo-115 -&gt; é€‰æ‹©åº”ç”¨æ¨¡æ¿mychart -&gt;å®‰è£…</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/dfb34fc6-d82c-4dd2-837d-afc3581dfb36.png?raw=true" alt="img"></p><h3 id="3-ç‚¹å‡»æŸ¥çœ‹åº”ç”¨å†…èµ„æºè¿è¡Œæƒ…å†µ"><a href="#3-ç‚¹å‡»æŸ¥çœ‹åº”ç”¨å†…èµ„æºè¿è¡Œæƒ…å†µ" class="headerlink" title="3 ç‚¹å‡»æŸ¥çœ‹åº”ç”¨å†…èµ„æºè¿è¡Œæƒ…å†µ"></a><strong>3 ç‚¹å‡»æŸ¥çœ‹åº”ç”¨å†…èµ„æºè¿è¡Œæƒ…å†µ</strong></h3><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/71a619b2-8ea5-4366-9801-6cfc9e2ccc89.png?raw=true" alt="img"></p><h2 id="12ã€æ—¥å¸¸è¿ç»´æµç¨‹"><a href="#12ã€æ—¥å¸¸è¿ç»´æµç¨‹" class="headerlink" title="12ã€æ—¥å¸¸è¿ç»´æµç¨‹"></a><strong>12ã€æ—¥å¸¸è¿ç»´æµç¨‹</strong></h2><h3 id="1-å‡çº§é•œåƒï¼Œä¿®æ”¹å®¹å™¨é…ç½®ç­‰"><a href="#1-å‡çº§é•œåƒï¼Œä¿®æ”¹å®¹å™¨é…ç½®ç­‰" class="headerlink" title="1 å‡çº§é•œåƒï¼Œä¿®æ”¹å®¹å™¨é…ç½®ç­‰"></a><strong>1 å‡çº§é•œåƒï¼Œä¿®æ”¹å®¹å™¨é…ç½®ç­‰</strong></h3><p>è¿›å…¥é¡¹ç›® -&gt; åº”ç”¨è´Ÿè½½ -&gt; å·¥ä½œè´Ÿè½½ -&gt; ç‚¹å‡»å¯¹åº”å·¥ä½œè´Ÿè½½</p><p>æ›´å¤šæ“ä½œ -&gt; ç¼–è¾‘è®¾ç½®</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/d27ed6e2-2e81-46dd-90fb-2d871e75581c.png?raw=true" alt="img"></p><h3 id="2-æŸ¥çœ‹å®¹å™¨æ—¥å¿—"><a href="#2-æŸ¥çœ‹å®¹å™¨æ—¥å¿—" class="headerlink" title="2 æŸ¥çœ‹å®¹å™¨æ—¥å¿—"></a><strong>2 æŸ¥çœ‹å®¹å™¨æ—¥å¿—</strong></h3><p>è¿›å…¥é¡¹ç›® -&gt; åº”ç”¨è´Ÿè½½ -&gt; å·¥ä½œè´Ÿè½½ -&gt; ç‚¹å‡»å¯¹åº”å·¥ä½œè´Ÿè½½ -&gt; ç‚¹å‡»å®¹å™¨ç»„</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/ed7cb4ef-681d-4e4f-b04b-f2be0649591c.png?raw=true" alt="img"></p><p>å®æ—¶æŸ¥çœ‹&#x2F;åœæ­¢ï¼Œåˆ·æ–°æ—¥å¿—ï¼Œä¸‹è½½æ—¥å¿—</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/42bb22e8-b48a-4d34-bd8c-a44c5680d352.png?raw=true" alt="img"></p><h3 id="3-è¿›å…¥å®¹å™¨-é»˜è®¤érootç”¨æˆ·"><a href="#3-è¿›å…¥å®¹å™¨-é»˜è®¤érootç”¨æˆ·" class="headerlink" title="3 è¿›å…¥å®¹å™¨(é»˜è®¤érootç”¨æˆ·)"></a><strong>3 è¿›å…¥å®¹å™¨(é»˜è®¤érootç”¨æˆ·)</strong></h3><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/c7aecdad-99dc-48e7-a2d3-f4f9af68c624.png?raw=true" alt="img"></p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/XJ9LnWvP9VvWlvDe/img/fda98b1f-5f56-49d3-85a1-f982a6c0a61e.png?raw=true" alt="img"></p>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goå †æ ˆåˆ†æ</title>
    <link href="/2024/12/10/go/Go%E5%A0%86%E6%A0%88%E5%88%86%E6%9E%90/"/>
    <url>/2024/12/10/go/Go%E5%A0%86%E6%A0%88%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="Goæ ˆå†…å­˜ã€å †å†…å­˜ã€é€ƒé€¸åˆ†æ"><a href="#Goæ ˆå†…å­˜ã€å †å†…å­˜ã€é€ƒé€¸åˆ†æ" class="headerlink" title="Goæ ˆå†…å­˜ã€å †å†…å­˜ã€é€ƒé€¸åˆ†æ"></a>Goæ ˆå†…å­˜ã€å †å†…å­˜ã€é€ƒé€¸åˆ†æ</h1><h2 id="å†…å­˜çš„ä½œç”¨"><a href="#å†…å­˜çš„ä½œç”¨" class="headerlink" title="å†…å­˜çš„ä½œç”¨"></a>å†…å­˜çš„ä½œç”¨</h2><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240516143225329.png?raw=true" alt="ä»£ç æ˜¯ä»€ä¹ˆ"></p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240516143333413.png?raw=true" alt="image-20240516143333413"></p><p>ä¸ºäº†è®©ç¨‹åºå‘˜æ›´å¥½åœ°ä¸“æ³¨äºä¸šåŠ¡ä»£ç çš„å®ç°ï¼Œ<code>Go</code>è¯­è¨€å¢åŠ äº†<a href="https://blog.51cto.com/u_15730090/5510574">åƒåœ¾å›æ”¶</a>æœºåˆ¶ï¼Œè‡ªåŠ¨åœ°å›æ”¶ä¸å†ä½¿ç”¨çš„å†…å­˜ã€‚</p><p><code>Go</code>è¯­è¨€æœ‰ä¸¤éƒ¨åˆ†<code>å†…å­˜</code>ç©ºé—´ï¼š<strong>æ ˆå†…å­˜</strong> å’Œ <strong>å †å†…å­˜</strong>ã€‚</p><h2 id="osçš„å †æ ˆ"><a href="#osçš„å †æ ˆ" class="headerlink" title="osçš„å †æ ˆ"></a>osçš„å †æ ˆ</h2><p>æ ˆæ˜¯ä¸€ç§åå…¥å…ˆå‡ºçš„ç»“æ„ï¼Œè®¡ç®—æœºä¸­ä¹Ÿæœ‰ä¸€å—æ»¡è¶³è¯¥ç‰¹æ€§çš„åŠ¨æ€å†…å­˜åŒºåŸŸï¼Œç¨‹åºå¯ä»¥å°†æ•°æ®å‹å…¥æ ˆä¸­æˆ–è€…å°†æ•°æ®ä»æ ˆä¸­å¼¹å‡ºï¼Œä»è€Œä½¿æ ˆåŠ¨æ€çš„å¢å¤§æˆ–å‡å°ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå †ä¹Ÿæ˜¯è®¡ç®—æœºä¸­çš„ä¸€ç§å†…å­˜åŒºåŸŸï¼Œ<strong>å †ä¸æ ˆçš„åŒºåˆ«</strong>å¦‚ä¸‹ï¼š</p><ol><li><strong>æ ˆ</strong>ä¸€èˆ¬ç”±æ“ä½œç³»ç»Ÿæ¥åˆ†é…å’Œé‡Šæ”¾ï¼Œ<strong>å †</strong>ç”±ç¨‹åºå‘˜é€šè¿‡ç¼–ç¨‹è¯­è¨€æ¥ç”³è¯·åˆ›å»ºä¸é‡Šæ”¾ã€‚</li><li><strong>æ ˆ</strong>ç”¨æ¥å­˜æ”¾å‡½æ•°çš„å‚æ•°ã€è¿”å›å€¼ã€å±€éƒ¨å˜é‡ã€å‡½æ•°è°ƒç”¨æ—¶çš„ä¸´æ—¶ä¸Šä¸‹æ–‡ç­‰ï¼Œ<strong>å †</strong>ç”¨æ¥å­˜æ”¾å…¨å±€å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£æ•°æ®å­˜æ”¾çš„è§„åˆ™ï¼šåªè¦æ˜¯å±€éƒ¨çš„ã€å ç”¨ç©ºé—´ç¡®å®šçš„æ•°æ®ï¼Œä¸€èˆ¬éƒ½å­˜æ”¾åœ¨stack é‡Œé¢ï¼Œå¦åˆ™å°±æ”¾åœ¨ heap é‡Œé¢ã€‚</li><li><strong>æ ˆ</strong>çš„è®¿é—®é€Ÿåº¦ç›¸å¯¹æ¯”<strong>å †</strong>å¿«ã€‚</li><li>ä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ª<strong>stack(æ ˆ)<strong>ï¼Œæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ª</strong>heap(å †)<strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ</strong>stack</strong> æ˜¯çº¿ç¨‹ç‹¬å çš„ï¼Œ<strong>heap</strong> æ˜¯çº¿ç¨‹å…±ç”¨çš„ã€‚</li><li><strong>stack</strong> åˆ›å»ºçš„æ—¶å€™ï¼Œå¤§å°æ˜¯ç¡®å®šçš„ï¼Œæ•°æ®è¶…è¿‡è¿™ä¸ªå¤§å°ï¼Œå°±å‘ç”Ÿstack overflow é”™è¯¯ï¼Œè€Œ<strong>heap</strong>çš„å¤§å°æ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€è¦çš„è¯å¯ä»¥ä¸æ–­å¢åŠ ã€‚</li><li><strong>æ ˆ</strong>æ˜¯ç”±é«˜åœ°å€å‘ä½åœ°å€å¢é•¿çš„ï¼Œè€Œ<strong>å †</strong>æ˜¯ç”±ä½åœ°å€å‘é«˜åœ°å€å¢é•¿çš„ã€‚</li></ol><p>åœ¨ C&#x2F;C++ ä¸­ï¼Œç¨‹åºå‘˜ç”³è¯·çš„å†…å­˜ç©ºé—´ä½¿ç”¨å®Œæ¯•åéœ€è¦è‡ªå·±é‡Šæ”¾ï¼Œåœ¨ Javaã€Go ç­‰è¯­è¨€ä¸­ï¼Œæä¾›äº†ä¸€ç§ä¸»åŠ¨é‡Šæ”¾ç”³è¯·çš„å†…å­˜ç©ºé—´çš„åŠŸèƒ½ï¼Œè¿™å°±æ˜¯åƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p><h2 id="Goçš„å †æ ˆ"><a href="#Goçš„å †æ ˆ" class="headerlink" title="Goçš„å †æ ˆ"></a>Goçš„å †æ ˆ</h2><p>é¦–å…ˆï¼Œ<strong>Go æ˜¯è‡ªå·±ç®¡ç†å†…å­˜çš„ï¼Œè€Œä¸æ˜¯äº¤ç»™æ“ä½œç³»ç»Ÿ</strong>ï¼Œå®ƒæ¯æ¬¡ä»æ“ä½œç³»ç»Ÿç”³è¯·ä¸€å¤§å—å†…å­˜ï¼Œç„¶åæŒ‰ç…§ Google çš„ <strong><code>TCMalloc</code></strong> ç®—æ³•è¿›è¡Œå†…å­˜åˆ†é…ï¼Œä¹Ÿåˆ’åˆ†ä¸ºå †ã€æ ˆç­‰å¾ˆå¤šåŒºåŸŸã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒå˜é‡ç©¶ç«Ÿæ”¾åœ¨å †è¿˜æ˜¯æ ˆé‡Œï¼Œå®˜æ–¹æœ‰è¿™ä¹ˆä¸€æ®µè§£é‡Šï¼š</p><p>åªè¦æœ‰å¯¹å˜é‡çš„å¼•ç”¨ï¼Œå˜é‡å°±ä¼šå­˜åœ¨ï¼Œè€Œå®ƒå­˜å‚¨çš„ä½ç½®ä¸è¯­è¨€çš„è¯­ä¹‰æ— å…³ã€‚å¦‚æœå¯èƒ½ï¼Œå˜é‡ä¼šè¢«åˆ†é…åˆ°å…¶å‡½æ•°çš„æ ˆï¼Œä½†å¦‚æœç¼–è¯‘å™¨æ— æ³•è¯æ˜å‡½æ•°è¿”å›ä¹‹åå˜é‡æ˜¯å¦ä»ç„¶è¢«å¼•ç”¨ï¼Œå°±å¿…é¡»åœ¨å †ä¸Šåˆ†é…è¯¥å˜é‡ï¼Œé‡‡ç”¨<strong>åƒåœ¾å›æ”¶</strong>æœºåˆ¶è¿›è¡Œç®¡ç†ï¼Œä»è€Œé¿å… <strong>æŒ‡é’ˆæ‚¬ç©º</strong>ã€‚æ­¤å¤–ï¼Œå±€éƒ¨å˜é‡å¦‚æœéå¸¸å¤§ï¼Œä¹Ÿä¼šå­˜åœ¨å †ä¸Šã€‚</p><p>åœ¨ç¼–è¯‘å™¨ä¸­ï¼Œå¦‚æœå˜é‡å…·æœ‰åœ°å€ï¼Œå°±ä½œä¸ºå †åˆ†é…çš„å€™é€‰ï¼Œä½†å¦‚æœé€ƒé€¸åˆ†æå¯ä»¥ç¡®å®šå…¶ç”Ÿå­˜å‘¨æœŸä¸ä¼šè¶…è¿‡å‡½æ•°è¿”å›ï¼Œå°±ä¼šåˆ†é…åœ¨æ ˆä¸Šã€‚</p><p>æ€»ä¹‹ï¼Œåˆ†é…åœ¨å †è¿˜æ˜¯æ ˆå®Œå…¨<strong>ç”±ç¼–è¯‘å™¨ç¡®å®š</strong>ã€‚è€ŒåŸæœ¬çœ‹èµ·æ¥åº”è¯¥åˆ†é…åœ¨æ ˆä¸Šçš„å˜é‡ï¼Œå¦‚æœå…¶ç”Ÿå‘½å‘¨æœŸè·å¾—äº†å»¶é•¿ï¼Œè¢«åˆ†é…åœ¨äº†å †ä¸Šï¼Œå°±è¯´å®ƒå‘ç”Ÿäº†<strong>é€ƒé€¸</strong>ã€‚ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ°å»åˆ¤æ–­å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å¦è·å¾—äº†å»¶é•¿ï¼Œæ•´ä¸ªåˆ¤æ–­çš„è¿‡ç¨‹å°±å«<strong>é€ƒé€¸åˆ†æ</strong>ã€‚</p><h2 id="æ ˆå†…å­˜"><a href="#æ ˆå†…å­˜" class="headerlink" title="æ ˆå†…å­˜"></a>æ ˆå†…å­˜</h2><p>æ ˆåªå…è®¸å¾€çº¿æ€§è¡¨çš„ä¸€ç«¯æ”¾å…¥æ•°æ®ï¼Œä¹‹ååœ¨è¿™ä¸€ç«¯å–å‡ºæ•°æ®,æŒ‰ç…§<strong>åè¿›å…ˆå‡º</strong>(LIFO, Last In First Out )çš„é¡ºåºï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240516154618013.png?raw=true" alt="image-20240516154618013"></p><p>å¾€æ ˆä¸­æ”¾å…¥å…ƒç´ çš„è¿‡ç¨‹å«åšå…¥æ ˆã€‚å…¥æ ˆä¼šå¢åŠ æ ˆçš„å…ƒç´ æ•°é‡ï¼Œæœ€åæ”¾å…¥çš„å…ƒç´ æ€»æ˜¯ä½äºæ ˆçš„é¡¶éƒ¨ï¼Œæœ€å…ˆæ”¾å…¥çš„å…ƒç´ æ€»æ˜¯ä½äºæ ˆçš„åº•éƒ¨ã€‚</p><p>ä»æ ˆä¸­å–å‡ºå…ƒç´ æ—¶ï¼Œåªèƒ½ä»æ ˆé¡¶éƒ¨å–å‡ºã€‚å–å‡ºå…ƒç´ å,æ ˆçš„æ•°é‡ä¼šå˜å°‘ã€‚æœ€å…ˆæ”¾å…¥çš„å…ƒç´ æ€»æ˜¯æœ€åè¢«å–å‡ºï¼Œæœ€åæ”¾å…¥çš„å…ƒç´ æ€»æ˜¯æœ€å…ˆè¢«å–å‡ºã€‚ä¸å…è®¸ä»æ ˆåº•è·å–æ•°æ®ï¼Œä¹Ÿä¸å…è®¸å¯¹æ ˆæˆå‘˜(é™¤æ ˆé¡¶å¤–çš„æˆå‘˜)è¿›è¡Œä»»ä½•æŸ¥çœ‹å’Œä¿®æ”¹æ“ä½œ ã€‚</p><p><strong>æ ˆå†…å­˜ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ï¼Œå¼€å‘è€…æ— æ³•æ§åˆ¶ã€‚æ ˆå†…å­˜ä¸€èˆ¬å­˜å‚¨å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰ï¼Œå‡½æ•°åˆ›å»ºçš„æ—¶å€™ï¼Œè¿™äº›å†…å­˜ä¼šè¢«è‡ªåŠ¨åˆ›å»ºï¼›å‡½æ•°è¿”å›çš„æ—¶å€™ï¼Œè¿™äº›å†…å­˜ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚</strong></p><p><strong>æ ˆå¯ç”¨äºå†…å­˜åˆ†é…ï¼Œæ ˆçš„åˆ†é…å’Œå›æ”¶é€Ÿåº¦éå¸¸å¿«ã€‚</strong>ä¸‹é¢ä»£ç å±•ç¤ºæåœ¨å†…å­˜åˆ†é…ä¸Šçš„ä½œç”¨ï¼Œä»£ç å¦‚ä¸‹:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">calc</span><span class="hljs-params">(a,b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> &#123;<br>    <span class="hljs-keyword">var</span> c <span class="hljs-type">int</span><br>    c = a * b<br>    <br>    <span class="hljs-keyword">var</span> x <span class="hljs-type">int</span><br>    x = c * <span class="hljs-number">10</span><br>    <br>    <span class="hljs-keyword">return</span> x<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç åœ¨æ²¡æœ‰ä»»ä½•ä¼˜åŒ–æƒ…å†µä¸‹ï¼Œä¼šè¿›è¡Œ<code>c</code>å’Œ<code>x</code>å˜é‡çš„åˆ†é…è¿‡ç¨‹ ã€‚<code>Go</code>è¯­è¨€é»˜è®¤æƒ…å†µä¸‹ä¼šå°†<code>c</code>å’Œ<code>x</code>åˆ†é…åœ¨æ ˆä¸Šï¼Œè¿™ä¸¤ä¸ªå˜é‡åœ¨<code>calc()</code>å‡½æ•°é€€å‡ºæ—¶å°±ä¸å†ä½¿ç”¨ï¼Œå‡½æ•°ç»“æŸæ—¶ï¼Œä¿å­˜<code>c</code>å’Œ<code>x</code>çš„æ ˆå†…å­˜å†å‡ºæ ˆé‡Šæ”¾å†…å­˜ï¼Œæ•´ä¸ªåˆ†é…å†…å­˜çš„è¿‡ç¨‹é€šè¿‡æ ˆçš„åˆ†é…å’Œå›æ”¶éƒ½ä¼šéå¸¸è¿…é€Ÿã€‚</p><h2 id="å †å†…å­˜"><a href="#å †å†…å­˜" class="headerlink" title="å †å†…å­˜"></a>å †å†…å­˜</h2><p>å †åœ¨å†…å­˜åˆ†é…ä¸­ç±»ä¼¼äºå¾€ä¸€ä¸ªæˆ¿é—´é‡Œæ‘†æ”¾å„ç§å®¶å…·ï¼Œå®¶å…·çš„å°ºå¯¸æœ‰å¤§æœ‰å°ã€‚</p><p>åˆ†é…å†…å­˜æ—¶ï¼Œéœ€è¦æ‰¾ä¸€å—è¶³å¤Ÿè£…ä¸‹å®¶å…·çš„ç©ºé—´å†æ‘†æ”¾å®¶å…·ã€‚ç»è¿‡åå¤æ‘†æ”¾å’Œè…¾ç©ºå®¶å…·åï¼Œæˆ¿é—´é‡Œçš„ç©ºé—´ä¼šå˜å¾—ä¹±ä¸ƒå…«ç³Ÿï¼Œæ­¤æ—¶å†å¾€ç©ºé—´é‡Œæ‘†æ”¾å®¶å…·ä¼šå­˜åœ¨è™½ç„¶æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œä½†å„ç©ºé—´åˆ†å¸ƒåœ¨ä¸åŒçš„åŒºåŸŸï¼Œæ— æ³•æœ‰ä¸€æ®µè¿ç»­çš„ç©ºé—´æ¥æ‘†æ”¾å®¶å…·çš„é—®é¢˜ã€‚æ­¤æ—¶å†…å­˜åˆ†é…å™¨å°±éœ€è¦å¯¹è¿™äº›ç©ºé—´è¿›è¡Œè°ƒæ•´ä¼˜åŒ–ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240516155637223.png?raw=true" alt="image-20240516155637223"></p><p>å †åˆ†é…å†…å­˜å’Œæ ˆåˆ†é…å†…å­˜ç›¸æ¯”ï¼Œ<strong>å †é€‚åˆä¸å¯é¢„çŸ¥å¤§å°çš„å†…å­˜åˆ†é…</strong>ã€‚ä½†æ˜¯ä¸ºæ­¤ä»˜å‡ºçš„ä»£ä»·æ˜¯åˆ†é…<strong>é€Ÿåº¦è¾ƒæ…¢</strong>ï¼Œè€Œä¸”ä¼šå½¢æˆ<strong>å†…å­˜ç¢ç‰‡</strong> ã€‚å †å†…å­˜çš„ç”Ÿå‘½å‘¨æœŸæ¯”æ ˆå†…å­˜è¦é•¿ï¼Œå¦‚æœå‡½æ•°è¿”å›çš„å€¼è¿˜ä¼šåœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°±ä¼šè¢«ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…åˆ°å †ä¸Šã€‚å †å†…å­˜ç›¸æ¯”æ ˆå†…å­˜æ¥è¯´ï¼Œä¸èƒ½è‡ªåŠ¨è¢«ç¼–è¯‘å™¨é‡Šæ”¾ï¼Œåªèƒ½é€šè¿‡åƒåœ¾å›æ”¶å™¨æ‰èƒ½é‡Šæ”¾ï¼Œæ‰€ä»¥æ ˆå†…å­˜æ•ˆç‡ä¼šå¾ˆé«˜ã€‚</p><p><strong>é€ƒé€¸æœºåˆ¶</strong></p><p>ç¼–è¯‘å™¨ä¼šæ ¹æ®å˜é‡<strong>æ˜¯å¦è¢«å¤–éƒ¨å¼•ç”¨</strong>æ¥å†³å®šæ˜¯å¦é€ƒé€¸ï¼š</p><ol><li>å¦‚æœå‡½æ•°å¤–éƒ¨æ²¡æœ‰å¼•ç”¨ï¼Œåˆ™ä¼˜å…ˆæ”¾åˆ°æ ˆä¸­</li><li>å¦‚æœå‡½æ•°å¤–éƒ¨å­˜åœ¨å¼•ç”¨ï¼Œåˆ™å¿…å®šæ”¾åˆ°å †ä¸­</li><li>å¦‚æœæ ˆä¸Šæ”¾ä¸ä¸‹ï¼Œåˆ™å¿…å®šæ”¾åˆ°å †ä¸­</li></ol><p><strong>golang ä¸­å“ªäº›å˜é‡æ˜¯åœ¨å †å’Œæ ˆä¸­</strong></p><p>æ ˆ (Stack)</p><ul><li>å±€éƒ¨å˜é‡ï¼šåœ¨å‡½æ•°å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡é€šå¸¸å­˜å‚¨åœ¨æ ˆä¸Šã€‚</li><li>å‡½æ•°å‚æ•°ï¼šä¼ é€’ç»™å‡½æ•°çš„å‚æ•°ä¹Ÿå­˜å‚¨åœ¨æ ˆä¸Šã€‚</li><li>å°å‹ç»“æ„ä½“ï¼šå¦‚æœç»“æ„ä½“è¶³å¤Ÿå°ï¼Œä¹Ÿå¯èƒ½è¢«æ”¾åœ¨æ ˆä¸Šã€‚</li></ul><p>å † (Heap)</p><ul><li>å¤§å‹ç»“æ„ä½“ï¼šå¦‚æœç»“æ„ä½“å¾ˆå¤§ï¼Œæˆ–è€…åŒ…å«æŒ‡é’ˆæˆå‘˜ï¼Œé‚£ä¹ˆé€šå¸¸ä¼šè¢«æ”¾åœ¨å †ä¸Šã€‚</li><li>åŠ¨æ€åˆ†é…çš„å¯¹è±¡ï¼šä½¿ç”¨ <code>new()</code> æˆ– <code>make()</code> æ˜¾å¼åˆ›å»ºçš„å¯¹è±¡æ€»æ˜¯ä½äºå †ä¸Šã€‚</li><li>å…¨å±€å˜é‡ï¼šå…¨å±€å˜é‡æˆ–åŒ…çº§å˜é‡é€šå¸¸å­˜å‚¨åœ¨é™æ€åŒºåŸŸï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ä¹Ÿå¯ä»¥è®¤ä¸ºå®ƒä»¬æ˜¯åœ¨å †ä¸Šã€‚</li><li>å¤§æ•°ç»„ï¼šå¦‚æœæ•°ç»„å¾ˆå¤§ï¼Œå¯èƒ½ä¼šè¢«åˆ†é…åœ¨å †ä¸Šã€‚</li><li>åˆ‡ç‰‡ï¼šè™½ç„¶åˆ‡ç‰‡æœ¬èº«ï¼ˆå³åˆ‡ç‰‡å¤´ï¼‰é€šå¸¸å¾ˆå°ä¸”å­˜å‚¨åœ¨æ ˆä¸Šï¼Œä½†å®ƒæŒ‡å‘çš„æ•°æ®ï¼ˆå…ƒç´ ï¼‰å¯èƒ½ä½äºå †ä¸Šã€‚</li><li>æŒ‡é’ˆï¼šæŒ‡é’ˆæœ¬èº«é€šå¸¸å­˜å‚¨åœ¨æ ˆä¸Šï¼Œä½†å®ƒæŒ‡å‘çš„æ•°æ®å¯èƒ½ä½äºå †ä¸Šã€‚</li></ul><p>æ€»ç»“</p><ul><li><strong>æ ˆ</strong>ï¼šç”¨äºå­˜å‚¨å‡½æ•°çš„å±€éƒ¨å˜é‡å’Œå‚æ•°ï¼Œé€šå¸¸æ˜¯å¿«é€Ÿè®¿é—®çš„å°å¯¹è±¡ã€‚</li><li><strong>å †</strong>ï¼šç”¨äºå­˜å‚¨åŠ¨æ€åˆ†é…çš„å¯¹è±¡å’Œå¤§å‹ç»“æ„ä½“ï¼Œè¿™äº›å¯¹è±¡é€šå¸¸å…·æœ‰è¾ƒé•¿çš„ç”Ÿå‘½å‘¨æœŸã€‚</li></ul><p><strong>é€ƒé€¸åˆ†æ</strong></p><p>æ—¢ç„¶æ ˆå†…å­˜çš„æ•ˆç‡æ›´é«˜ï¼Œè‚¯å®šæ˜¯ä¼˜å…ˆä½¿ç”¨æ ˆå†…å­˜ã€‚é‚£ä¹ˆ<code>Go</code>è¯­è¨€æ˜¯å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå˜é‡åº”è¯¥åˆ†é…åˆ°å †ä¸Šè¿˜æ˜¯æ ˆä¸Šçš„å‘¢ï¼Ÿè¿™å°±éœ€è¦é€ƒé€¸åˆ†æäº†ã€‚<strong>é€ƒé€¸åˆ†æ</strong>ä¹Ÿå°±æ˜¯ç¼–è¯‘å™¨å†³å®šå“ªäº›å˜é‡æ”¾åœ¨æ ˆï¼Œå“ªäº›æ”¾åœ¨å †ä¸­ã€‚ä¸‹é¢æˆ‘é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥è®²è§£é€ƒé€¸åˆ†æï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    newString()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newString</span><span class="hljs-params">()</span></span> *<span class="hljs-type">string</span>&#123;<br>    s:=<span class="hljs-built_in">new</span>(<span class="hljs-type">string</span>)<br>    *s= <span class="hljs-string">&quot;hello&quot;</span><br>    <span class="hljs-keyword">return</span> s<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨é€šè¿‡ç¼–è¯‘å‡½æ•° <strong>-gcflags&#x3D;â€-m -lâ€</strong> é€ƒé€¸åˆ†ææ¥çœ‹ä¸‹æ˜¯å¦å‘ç”Ÿäº†é€ƒé€¸ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240516160423235.png?raw=true" alt="image-20240516160423235"></p><ul><li><code>-m</code> è¡¨ç¤ºæ‰“å°å‡ºé€ƒé€¸åˆ†æä¿¡æ¯ï¼›</li><li><code>-l</code> è¡¨ç¤ºç¦æ­¢å†…è”ï¼Œå¯ä»¥æ›´å¥½åœ°è§‚å¯Ÿé€ƒé€¸ï¼›</li></ul><p>ä»ä»¥ä¸Šè¾“å‡ºç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå‘ç”Ÿäº†é€ƒé€¸ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>æŒ‡é’ˆä½œä¸ºå‡½æ•°è¿”å›å€¼çš„æ—¶å€™ï¼Œä¸€å®šä¼šå‘ç”Ÿé€ƒé€¸</strong>ã€‚é€ƒé€¸åˆ°å †å†…å­˜çš„å˜é‡ä¸èƒ½é©¬ä¸Šè¢«å›æ”¶ï¼Œåªèƒ½é€šè¿‡åƒåœ¾å›æ”¶æ ‡è®°æ¸…é™¤ï¼Œå¢åŠ äº†åƒåœ¾å›æ”¶çš„å‹åŠ›ï¼Œæ‰€ä»¥è¦å°½å¯èƒ½åœ°é¿å…é€ƒé€¸ï¼Œè®©å˜é‡åˆ†é…åœ¨æ ˆå†…å­˜ä¸Šï¼Œè¿™æ ·å‡½æ•°è¿”å›æ—¶å°±å¯ä»¥å›æ”¶èµ„æºï¼Œæå‡æ•ˆç‡ã€‚</p><p>ä¸‹é¢æˆ‘å¯¹<code>newString</code>å‡½æ•°è¿›è¡Œäº†é¿å…é€ƒé€¸çš„ä¼˜åŒ–ï¼Œä¼˜åŒ–åçš„å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newString</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span>&#123;<br>    s:=<span class="hljs-built_in">new</span>(<span class="hljs-type">string</span>)<br>    *s = <span class="hljs-string">&quot;hello&quot;</span><br>    <span class="hljs-keyword">return</span> *s<br>&#125;<br></code></pre></td></tr></table></figure><p>å†æ¬¡é€šè¿‡å‘½ä»¤æŸ¥çœ‹ä»¥ä¸Šä»£ç çš„é€ƒé€¸åˆ†æï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240516161150292.png?raw=true" alt="image-20240516161150292"></p><p>é€šè¿‡åˆ†æç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶è¿˜æ˜¯å£°æ˜äº†æŒ‡é’ˆå˜é‡ <code>s</code>ï¼Œä½†æ˜¯å‡½æ•°è¿”å›çš„å¹¶ä¸æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥æ²¡æœ‰å‘ç”Ÿé€ƒé€¸ã€‚é€ƒé€¸åˆ†ææ˜¯åˆ¤æ–­å˜é‡æ˜¯åˆ†é…åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šçš„ä¸€ç§æ–¹æ³•ï¼Œåœ¨å®é™…çš„é¡¹ç›®ä¸­è¦å°½å¯èƒ½é¿å…é€ƒé€¸ï¼Œè¿™æ ·å°±ä¸ä¼šè¢« <code>GC</code> æ‹–æ…¢é€Ÿåº¦ï¼Œä»è€Œæå‡æ•ˆç‡ã€‚</p><blockquote><p>Tipsï¼šä»é€ƒé€¸åˆ†ææ¥çœ‹ï¼Œ<strong>æŒ‡é’ˆè™½ç„¶å¯ä»¥å‡å°‘å†…å­˜çš„æ‹·è´ï¼Œä½†å®ƒåŒæ ·ä¼šå¼•èµ·é€ƒé€¸</strong>ï¼Œæ‰€ä»¥è¦æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æ˜¯å¦ä½¿ç”¨æŒ‡é’ˆã€‚</p></blockquote><p>å–åœ°å€å‘ç”Ÿé€ƒé€¸ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> Data <span class="hljs-keyword">struct</span> &#123;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">demo</span><span class="hljs-params">()</span></span> *Data &#123;<br><span class="hljs-keyword">var</span> d Data<br><span class="hljs-keyword">return</span> &amp;d<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(demo())<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240516161542225.png?raw=true" alt="image-20240516161542225"></p><p>moved to heap: dã€‚è¿™å¥è¯è¡¨ç¤ºï¼Œ Go ç¼–è¯‘å™¨å·²ç»ç¡®è®¤å¦‚æœå°† d å˜é‡åˆ†é…åœ¨æ ˆä¸Šæ˜¯æ— æ³•ä¿è¯ç¨‹åºæœ€ç»ˆç»“æœçš„ã€‚å¦‚æœåšæŒè¿™æ ·åšï¼Œdemo() çš„è¿”å›å€¼å°†æ˜¯ Data ç»“æ„çš„ä¸€ä¸ªä¸å¯é¢„çŸ¥çš„å†…å­˜åœ°å€ã€‚è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯ C&#x2F;C++ è¯­è¨€ä¸­å®¹æ˜“çŠ¯é”™çš„åœ°æ–¹ ï¼šå¼•ç”¨äº†ä¸€ä¸ªå‡½æ•°å±€éƒ¨å˜é‡çš„åœ°å€ã€‚</p><p>Go è¯­è¨€æœ€ç»ˆé€‰æ‹©å°† d çš„ Data ç»“æ„åˆ†é…åœ¨å †ä¸Šã€‚ç„¶åç”±åƒåœ¾å›æ”¶å™¨å»å›æ”¶ d çš„å†…å­˜ ã€‚</p><p><strong>å˜é‡å‘ç”Ÿé€ƒé€¸çš„æƒ…å†µå¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š</strong></p><ul><li><strong>æŒ‡é’ˆé€ƒé€¸</strong>ï¼šå‡½æ•°è¿”å›å€¼ä¸ºå±€éƒ¨å˜é‡çš„æŒ‡é’ˆï¼Œè™½ç„¶å‡½æ•°é€€å‡ºäº†ï¼Œä½†æ˜¯å› ä¸ºæŒ‡é’ˆçš„å­˜åœ¨ï¼ŒæŒ‡å‘çš„å†…å­˜ä¸èƒ½éšç€å‡½æ•°ç»“æŸè€Œå›æ”¶ï¼Œå› æ­¤åªèƒ½åˆ†é…åœ¨å †ä¸Šã€‚</li><li><strong>æ ˆç©ºé—´ä¸è¶³</strong>ï¼šä¸€ä¸ªæ ˆçš„é»˜è®¤å¤§å°æ˜¯ 2Kï¼Œå®ƒä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œæœ€å¤§å€¼å–å†³äºç³»ç»Ÿçš„é…ç½®ã€‚å½“æ ˆç©ºé—´è¶³å¤Ÿæ—¶ï¼Œä¸ä¼šå‘ç”Ÿé€ƒé€¸ï¼Œä½†æ˜¯å½“å˜é‡è¿‡å¤§æ—¶ï¼Œå·²ç»å®Œå…¨è¶…è¿‡æ ˆç©ºé—´çš„å¤§å°æ—¶ï¼Œå°†ä¼šå‘ç”Ÿé€ƒé€¸åˆ°å †ä¸Šåˆ†é…å†…å­˜ã€‚ä¾‹å¦‚ï¼šs :&#x3D; make([]int, 10000, 10000)ï¼Œæ­¤æ—¶ s å°±ä¼šå› ä¸ºå¤ªå¤§è¢«åˆ†é…åˆ°å †ä¸Šã€‚</li><li><strong>å˜é‡å¤§å°ä¸ç¡®å®š</strong>ï¼šä¾‹å¦‚ï¼šnumber &#x3D; 10; s :&#x3D; make([]int, number)ï¼Œæ­¤æ—¶ç”±äºç¼–è¯‘æœŸé—´æ— æ³•ç¡®å®šsliceå¤§é•¿åº¦ï¼Œæ‰€ä»¥ä¼šè¢«åˆ†é…åˆ°å †ä¸Šï¼Œå¦‚æœç›´æ¥å†™æˆ: s :&#x3D; make([]int, 10)ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿé€ƒé€¸ã€‚</li><li><strong>åŠ¨æ€ç±»å‹</strong>ï¼šå°±æ˜¯åœ¨ç¼–è¯‘æœŸé—´ä¸èƒ½ç¡®å®šå‚æ•°çš„ç±»å‹ï¼Œå‚æ•°çš„é•¿åº¦ï¼Œæ­¤æ—¶å°±æ˜¯å‘ç”Ÿé€ƒé€¸ã€‚æ¯”å¦‚ç©ºæ¥å£interface{}å¯ä»¥è¡¨ç¤ºä»»æ„ç±»å‹ï¼Œå¦‚æœå‡½æ•°å…¥å‚ä¸ºinterface{}ï¼Œç¼–è¯‘æœŸé—´æ— æ³•ç¡®å®šå…¶å‚æ•°çš„å…·ä½“ç±»å‹ï¼Œå°±ä¼šå‘ç”Ÿé€ƒé€¸ã€‚ä¾‹å¦‚ï¼š fmt.Println() çš„å‚æ•°ç±»å‹ä¸º interface{}ï¼Œå› æ­¤ä¼šå¯¼è‡´æ‰“å°çš„å¯¹è±¡é€ƒé€¸åˆ°å †ä¸Šã€‚</li><li><strong>é—­åŒ…å¼•ç”¨å¯¹è±¡</strong>ï¼šå½“é—­åŒ…å‡½æ•°è®¿é—®äº†å¤–éƒ¨å˜é‡ nï¼Œå˜é‡ n å ç”¨çš„å†…å­˜ä¸èƒ½éšç€é—­åŒ…å‡½æ•°çš„é€€å‡ºè€Œå›æ”¶ï¼Œå˜é‡ n å°†ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°è¢«GCå›æ”¶ã€‚</li><li><strong>å‘é€æŒ‡é’ˆæˆ–å¸¦æœ‰æŒ‡é’ˆçš„å€¼åˆ° channel ä¸­ã€‚</strong> åœ¨ç¼–è¯‘æ—¶ï¼Œæ˜¯æ²¡æœ‰åŠæ³•çŸ¥é“å“ªä¸ª goroutine ä¼šåœ¨ channel ä¸Šæ¥æ”¶æ•°æ®ã€‚æ‰€ä»¥ç¼–è¯‘å™¨æ²¡æ³•çŸ¥é“å˜é‡ä»€ä¹ˆæ—¶å€™æ‰ä¼šè¢«é‡Šæ”¾ã€‚</li><li><strong>åœ¨ä¸€ä¸ªåˆ‡ç‰‡ä¸Šå­˜å‚¨æŒ‡é’ˆæˆ–å¸¦æŒ‡é’ˆçš„å€¼ã€‚</strong> ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯ []*string ã€‚è¿™ä¼šå¯¼è‡´åˆ‡ç‰‡çš„å†…å®¹é€ƒé€¸ã€‚å°½ç®¡å…¶åé¢çš„æ•°ç»„å¯èƒ½æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ï¼Œä½†å…¶å¼•ç”¨çš„å€¼ä¸€å®šæ˜¯åœ¨å †ä¸Šã€‚</li><li><strong>slice çš„èƒŒåæ•°ç»„è¢«é‡æ–°åˆ†é…äº†ï¼Œå› ä¸º append æ—¶å¯èƒ½ä¼šè¶…å‡ºå…¶å®¹é‡( cap )ã€‚</strong> slice åˆå§‹åŒ–çš„åœ°æ–¹åœ¨ç¼–è¯‘æ—¶æ˜¯å¯ä»¥çŸ¥é“çš„ï¼Œå®ƒæœ€å¼€å§‹ä¼šåœ¨æ ˆä¸Šåˆ†é…ã€‚å¦‚æœåˆ‡ç‰‡èƒŒåçš„å­˜å‚¨è¦åŸºäºè¿è¡Œæ—¶çš„æ•°æ®è¿›è¡Œæ‰©å……ï¼Œå°±ä¼šåœ¨å †ä¸Šåˆ†é…ã€‚</li></ul><p><strong>ä¼˜åŒ–æŠ€å·§</strong></p><p>â€‹</p><ul><li>å°½å¯èƒ½é¿å…é€ƒé€¸ï¼Œå› ä¸ºæ ˆå†…å­˜æ•ˆç‡æ›´é«˜ï¼Œè¿˜ä¸ç”¨ GCã€‚æ¯”å¦‚å°å¯¹è±¡çš„ä¼ å‚å°½é‡ä¸ä½¿ç”¨æŒ‡é’ˆï¼Œèƒ½ç”¨æ•°ç»„å°±ä¸è¦ç”¨åˆ‡ç‰‡ã€‚</li><li>å¦‚æœé¿å…ä¸äº†é€ƒé€¸ï¼Œè¿˜æ˜¯åœ¨å †ä¸Šåˆ†é…äº†å†…å­˜ï¼Œé‚£ä¹ˆå¯¹äºé¢‘ç¹çš„å†…å­˜ç”³è¯·æ“ä½œï¼Œæˆ‘ä»¬è¦å­¦ä¼šé‡ç”¨å†…å­˜ï¼Œæ¯”å¦‚ä½¿ç”¨ sync.Poolã€‚</li><li>é€‰ç”¨åˆé€‚çš„ç®—æ³•ï¼Œè¾¾åˆ°é«˜æ€§èƒ½çš„ç›®çš„ï¼Œæ¯”å¦‚ç©ºé—´æ¢æ—¶é—´ã€‚</li></ul><blockquote><p><strong>Tipsï¼šæ€§èƒ½ä¼˜åŒ–çš„æ—¶å€™ï¼Œè¦ç»“åˆåŸºå‡†æµ‹è¯•ï¼Œæ¥éªŒè¯è‡ªå·±çš„ä¼˜åŒ–æ˜¯å¦æœ‰æå‡ã€‚</strong></p></blockquote><p>ä»¥ä¸Šæ˜¯åŸºäº Go è¯­è¨€çš„å†…å­˜ç®¡ç†æœºåˆ¶æ€»ç»“å‡ºçš„ 3 ä¸ªæ–¹å‘çš„æŠ€å·§ï¼ŒåŸºäºè¿™ 3 ä¸ªå¤§æ–¹å‘åŸºæœ¬ä¸Šå¯ä»¥ä¼˜åŒ–å‡ºä½ æƒ³è¦çš„æ•ˆæœã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å°æŠ€å·§ï¼Œæ¯”å¦‚<strong>è¦å°½å¯èƒ½é¿å…ä½¿ç”¨é”ã€å¹¶å‘åŠ é”çš„èŒƒå›´è¦å°½å¯èƒ½å°ã€ä½¿ç”¨ StringBuilder åš string å’Œ []byte ä¹‹é—´çš„è½¬æ¢ã€defer åµŒå¥—ä¸è¦å¤ªå¤š</strong>ç­‰ç­‰ã€‚</p><h2 id="GCâ€”â€”åƒåœ¾å›æ”¶"><a href="#GCâ€”â€”åƒåœ¾å›æ”¶" class="headerlink" title="GCâ€”â€”åƒåœ¾å›æ”¶"></a>GCâ€”â€”åƒåœ¾å›æ”¶</h2><p>Goè¯­è¨€çš„åƒåœ¾å›æ”¶ï¼ˆGarbage Collection, GCï¼‰æœºåˆ¶æ˜¯å…¶è¿è¡Œæ—¶ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œé‡Šæ”¾ä¸å†ä½¿ç”¨çš„å¯¹è±¡å ç”¨çš„ç©ºé—´ï¼Œä»è€Œæå¤§åœ°ç®€åŒ–äº†ç¨‹åºå‘˜çš„å·¥ä½œï¼Œé¿å…äº†å¸¸è§çš„å†…å­˜æ³„æ¼å’Œæ‚¬æŒ‚æŒ‡é’ˆç­‰é—®é¢˜ã€‚Goçš„GCè®¾è®¡æ—¨åœ¨æä¾›é«˜æ€§èƒ½å’Œä½å»¶è¿Ÿï¼Œç‰¹åˆ«å¼ºè°ƒäº†å¯¹å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨åœºæ™¯çš„æ”¯æŒ</p><p>å…·ä½“æ“ä½œï¼š</p><ol><li>GCå¼€å§‹å°†æ ˆä¸Šçš„å¯è¾¾å¯¹è±¡å…¨éƒ¨æ‰«æå¹¶æ ‡è®°ä¸ºé»‘è‰²</li><li>GCæœŸé—´ï¼Œä»»ä½•åœ¨æ ˆä¸Šåˆ›å»ºçš„æ–°å¯¹è±¡ï¼Œå‡ä¸ºé»‘è‰²</li><li>å †ä¸Šè¢«åˆ é™¤å¯¹è±¡æ ‡è®°ä¸ºç°è‰²</li><li>å †ä¸Šè¢«æ·»åŠ çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²</li></ol><p>é¢œè‰²åŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><strong>ç™½è‰²</strong>ï¼šè¡¨ç¤ºå¯¹è±¡å°šæœªè¢«è®¿é—®æˆ–æ ‡è®°ï¼Œå¯èƒ½æ˜¯åƒåœ¾æˆ–è€…ä»ç„¶æ´»åŠ¨çš„å¯¹è±¡ã€‚</li><li><strong>ç°è‰²</strong>ï¼šè¡¨ç¤ºå¯¹è±¡å·²è¢«è®¿é—®ï¼Œä½†å…¶å¼•ç”¨çš„å¯¹è±¡ï¼ˆå­å¯¹è±¡ï¼‰å°šæœªè¢«æ£€æŸ¥ã€‚æ¢å¥è¯è¯´ï¼Œç°è‰²å¯¹è±¡æ˜¯æŒ‡é‚£äº›å·²çŸ¥æœ‰è‡³å°‘ä¸€ä¸ªæŒ‡å‘å®ƒçš„å¼•ç”¨å­˜åœ¨ï¼Œä½†å…¶è‡ªèº«çš„å¼•ç”¨åˆ—è¡¨è¿˜æœªè¢«éå†çš„å¯¹è±¡ã€‚</li><li><strong>é»‘è‰²</strong>ï¼šè¡¨ç¤ºå¯¹è±¡åŠå…¶æ‰€æœ‰å¼•ç”¨çš„å¯¹è±¡éƒ½å·²ç»å®Œå…¨æ£€æŸ¥å¹¶æ ‡è®°ï¼Œç¡®è®¤ä¸ºæ´»åŠ¨å¯¹è±¡ã€‚</li></ol><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240712161448341.png?raw=true" alt="ä¸‰è‰²æ ‡è®°æ³•"></p><p>åœ¨GCå‘¨æœŸä¸­ï¼Œå¯¹è±¡ä»ç™½è‰²å˜ä¸ºç°è‰²çš„è¿‡ç¨‹å‘ç”Ÿåœ¨â€œæ ‡è®°â€é˜¶æ®µï¼Œå½“GCéå†å¯¹è±¡å›¾æ—¶ã€‚å…·ä½“è€Œè¨€ï¼Œå½“GCé‡åˆ°ä¸€ä¸ªå¯¹è±¡å¹¶ç¡®è®¤å®ƒæ˜¯æ´»åŠ¨çš„ï¼ˆå³æœ‰æ ¹é›†æˆ–å…¶ä»–å·²çŸ¥æ´»åŠ¨å¯¹è±¡æŒ‡å‘å®ƒï¼‰ï¼Œå®ƒä¼šå°†è¯¥å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼Œå¹¶å°†å…¶åŠ å…¥åˆ°å¾…å¤„ç†é˜Ÿåˆ—ä¸­ã€‚ç„¶åï¼ŒGCä¼šéå†è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨åˆ—è¡¨ï¼Œè®¿é—®å¹¶æ ‡è®°æ¯ä¸ªè¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€æ—¦å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«æ£€æŸ¥å®Œæ¯•ï¼Œè¯¥å¯¹è±¡å°±ä¼šè¢«æ ‡è®°ä¸ºé»‘è‰²ï¼Œè¡¨ç¤ºå®ƒå’Œå…¶å¼•ç”¨çš„å¯¹è±¡éƒ½æ˜¯æ´»åŠ¨çš„ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œå¯¹è±¡è¢«æ ‡è®°ä¸ºç°è‰²æ˜¯åœ¨GCè¿‡ç¨‹ä¸­ï¼Œå½“å®ƒé¦–æ¬¡è¢«è®¿é—®å¹¶ä¸”GCæ­£åœ¨æ£€æŸ¥å…¶å¼•ç”¨çš„å¯¹è±¡æ—¶ã€‚ä¸€æ—¦å®ƒçš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«æ£€æŸ¥å®Œæ¯•ï¼Œå®ƒå°±ä¼šå˜æˆé»‘è‰²ï¼Œè¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ã€‚ç™½è‰²å¯¹è±¡å¯èƒ½æœ€ç»ˆè¢«å›æ”¶ï¼Œå¦‚æœåœ¨æ•´ä¸ªGCå‘¨æœŸç»“æŸåå®ƒä»¬ä»ç„¶æ²¡æœ‰è¢«æ ‡è®°ä¸ºé»‘è‰²æˆ–ç°è‰²ã€‚</p><p><strong><code>GCåƒåœ¾æ”¶é›†çš„å¤šä¸ªé˜¶æ®µï¼š</code></strong></p><ol><li><p>æ ‡è®°å‡†å¤‡é˜¶æ®µ</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tex">å¯åŠ¨åå°æ ‡è®°ä»»åŠ¡<br>æš‚åœç¨‹åºï¼ˆSTWï¼‰ï¼Œæ‰€æœ‰çš„å¤„ç†å™¨åœ¨è¿™æ—¶ä¼šè¿›å…¥å®‰å…¨ç‚¹ï¼ˆSafe pointï¼‰ï¼›<br>å¦‚æœå½“å‰åƒåœ¾æ”¶é›†å¾ªç¯æ˜¯å¼ºåˆ¶è§¦å‘çš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¤„ç†è¿˜æœªè¢«æ¸…ç†çš„å†…å­˜ç®¡ç†å•å…ƒï¼›<br>å°†æ ¹å¯¹è±¡å…¥é˜Ÿ<br>å¼€å¯å†™å±éšœ<br></code></pre></td></tr></table></figure></li><li><p>æ ‡è®°é˜¶æ®µ</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">æ¢å¤ç”¨æˆ·åç¨‹<br>ä½¿ç”¨ä¸‰è‰²æ ‡è®°æ³•å¼€å§‹æ ‡è®°ï¼Œæ­¤æ—¶ç”¨æˆ·åç¨‹å’Œæ ‡è®°åç¨‹å¹¶å‘æ‰§è¡Œ<br></code></pre></td></tr></table></figure></li><li><p>æ ‡è®°ç»ˆæ­¢é˜¶æ®µ</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex">æš‚åœç”¨æˆ·åç¨‹<br>è®¡ç®—ä¸‹ä¸€æ¬¡è§¦å‘GCæ—¶éœ€è¦è¾¾åˆ°çš„å †ç›®æ ‡<br>å”¤é†’åå°æ¸…æ‰«åç¨‹<br></code></pre></td></tr></table></figure></li><li><p>æ¸…ç†é˜¶æ®µ</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex">å…³é—­å†™å±éšœ<br>æ¢å¤ç”¨æˆ·åç¨‹<br>å¼‚æ­¥æ¸…ç†å›æ”¶<br></code></pre></td></tr></table></figure></li></ol><p><code>å†™å±éšœ</code></p><p>å†™å±éšœï¼ˆWrite Barrierï¼‰æ˜¯GCä¸­ç”¨äºä¿æŠ¤æ ‡è®°è¿‡ç¨‹å®Œæ•´æ€§çš„ä¸€ç§æœºåˆ¶ï¼Œå°¤å…¶æ˜¯åœ¨å¹¶å‘æ‰§è¡ŒæœŸé—´ã€‚å½“ä¸€ä¸ªå¯¹è±¡å¼•ç”¨è¢«ä¿®æ”¹æ—¶ï¼ˆæ— è®ºæ˜¯åˆ›å»ºæ–°å¼•ç”¨è¿˜æ˜¯æ›´æ–°ç°æœ‰å¼•ç”¨ï¼‰ï¼Œå†™å±éšœä¼šä»‹å…¥å¹¶ç¡®ä¿GCçš„ç›¸å…³æ•°æ®ç»“æ„å¾—åˆ°æ›´æ–°ï¼Œä»¥åæ˜ æœ€æ–°çš„å¯¹è±¡å¼•ç”¨çŠ¶æ€ã€‚</p><p>åœ¨Goä¸­ï¼Œå†™å±éšœä¸»è¦åœ¨ä»¥ä¸‹ä¸¤ç§åœºæ™¯ä¸‹å‘æŒ¥ä½œç”¨ï¼š</p><ol><li><strong>å¯¹è±¡åˆ†é…</strong>ï¼šå½“ä¸€ä¸ªæ–°çš„å¯¹è±¡è¢«åˆ†é…æ—¶ï¼Œå†™å±éšœä¼šç¡®ä¿è¯¥å¯¹è±¡è¢«æ­£ç¡®åœ°æ ‡è®°ä¸ºç°è‰²ï¼Œå³ä½¿åœ¨GCå‘¨æœŸä¸­ã€‚</li><li><strong>å¯¹è±¡å¼•ç”¨æ›´æ–°</strong>ï¼šå½“ä¸€ä¸ªå¯¹è±¡å¼•ç”¨è¢«æ›´æ–°æ—¶ï¼Œå†™å±éšœä¼šæ£€æŸ¥å¹¶æ›´æ–°ç›¸å…³å¯¹è±¡çš„çŠ¶æ€ï¼Œç¡®ä¿æ ‡è®°è¿‡ç¨‹çš„å‡†ç¡®æ€§ä¸å—å¹¶å‘ä¿®æ”¹çš„å½±å“ã€‚</li></ol><p> å®é™…ä¸Šï¼Œ<strong>åƒåœ¾å›æ”¶æœºåˆ¶åªç”¨äºå›æ”¶å †ä¸Šçš„å†…å­˜</strong>ï¼Œæ ˆä¸­çš„å†…å­˜å¦‚å±€éƒ¨å˜é‡ã€å‡½æ•°è°ƒç”¨ç­‰ä¼šåœ¨è°ƒç”¨ç»“æŸåè‡ªåŠ¨é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå±éšœæœºåˆ¶åªèƒ½ä½œç”¨äºå †å¯¹è±¡ã€‚</p><p><code>ä»€ä¹ˆæ˜¯æ ¹å¯¹è±¡ï¼Ÿ</code></p><p>æ ¹å¯¹è±¡ï¼ˆroot objectï¼‰æ˜¯æŒ‡é‚£äº›èƒ½å¤Ÿä»å…¨å±€å¯è¾¾çš„åœ°æ–¹è®¿é—®åˆ°çš„å¯¹è±¡ã€‚åƒåœ¾å›æ”¶å™¨ä¼šä»æ ¹å¯¹è±¡å¼€å§‹ï¼Œé€šè¿‡éå†æ ¹å¯¹è±¡çš„å¼•ç”¨å…³ç³»ï¼Œé€æ­¥è¿½è¸ªå¹¶æ ‡è®°æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ã€‚ä»»ä½•æœªè¢«æ ‡è®°çš„å¯¹è±¡éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯åƒåœ¾ï¼Œæœ€ç»ˆè¢«å›æ”¶é‡Šæ”¾ã€‚</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex">å…¨å±€å˜é‡ï¼šå…¨å±€å˜é‡å¯ä»¥è¢«ç¨‹åºä¸­çš„ä»»ä½•ä½ç½®å¼•ç”¨åˆ°ï¼Œå› æ­¤æ˜¯æ ¹å¯¹è±¡ã€‚<br>å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼šå½“ä¸€ä¸ªå‡½æ•°æ­£åœ¨æ‰§è¡Œæ—¶ï¼Œå…¶å±€éƒ¨å˜é‡å¯ä»¥è¢«å½“å‰å‡½æ•°ä¸­çš„ä»£ç è®¿é—®åˆ°ï¼Œå› æ­¤ä¹Ÿæ˜¯æ ¹å¯¹è±¡ã€‚<br>å½“å‰æ­£åœ¨æ‰§è¡Œçš„ goroutine çš„æ ˆä¸­çš„å˜é‡ï¼šgoroutine æ˜¯ Goè¯­è¨€å¹¶å‘ç¼–ç¨‹ä¸­çš„è½»é‡çº§çº¿ç¨‹ï¼Œæ¯ä¸ª goroutine éƒ½æœ‰ä¸€å—ç‹¬ç«‹çš„æ ˆç©ºé—´ï¼Œå…¶ä¸­çš„å˜é‡å¯ä»¥è¢«å½“å‰ goroutine è®¿é—®åˆ°ï¼Œä¹Ÿæ˜¯æ ¹å¯¹è±¡ã€‚<br>å…¶ä»–å’Œè¿è¡Œæ—¶ç³»ç»Ÿç›¸å…³çš„æ•°æ®ç»“æ„å’Œå˜é‡ã€‚<br></code></pre></td></tr></table></figure><p><code>ä¸‰è‰²æ ‡è®°æ³•çš„ç¼ºç‚¹ï¼š</code></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex">æš‚åœæ—¶é—´ï¼šåœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¿…é¡»åœæ­¢ç¨‹åºæ‰§è¡Œï¼Œè¿™ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºæš‚åœã€‚å¼•å…¥å†™å±éšœä¿æŠ¤å¯ä»¥å‡å°‘æš‚åœæ—¶é—´ï¼Œä½†ä»ç„¶å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚<br>å†…å­˜å¼€é”€ï¼šä¸‰è‰²æ ‡è®°æ³•éœ€è¦ä¸ºæ¯ä¸ªå¯¹è±¡ç»´æŠ¤é¢å¤–çš„çŠ¶æ€ä¿¡æ¯ï¼Œä»¥è®°å½•å…¶æ ‡è®°çŠ¶æ€ã€‚è¿™ä¼šå¢åŠ å†…å­˜å¼€é”€ï¼Œå¹¶å¯èƒ½å¯¹å†…å­˜èµ„æºé€ æˆè´Ÿæ‹…ã€‚<br>é¢‘ç¹çš„åƒåœ¾å›æ”¶ï¼šä¸‰è‰²æ ‡è®°æ³•éœ€è¦é¢‘ç¹åœ°è¿­ä»£æ ‡è®°å’Œæ¸…é™¤å¯¹è±¡ï¼Œå¦‚æœè¦å›æ”¶çš„åƒåœ¾å¯¹è±¡å¾ˆå¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´å›æ”¶è¿‡ç¨‹å˜å¾—éå¸¸è€—æ—¶ã€‚<br>ç¢ç‰‡åŒ–ï¼šåƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé¢‘ç¹è¿›è¡Œå¯¹è±¡çš„ç§»åŠ¨å’Œé‡æ–°åˆ†é…å†…å­˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡åŒ–ï¼Œé™ä½å†…å­˜çš„åˆ©ç”¨ç‡ã€‚<br></code></pre></td></tr></table></figure><p><code>GCçš„è§¦å‘æ¡ä»¶</code></p><ol><li>ä¸»åŠ¨è§¦å‘(æ‰‹åŠ¨è§¦å‘)ï¼Œé€šè¿‡è°ƒç”¨ runtime.GC æ¥è§¦å‘GCï¼Œæ­¤è°ƒç”¨é˜»å¡å¼åœ°ç­‰å¾…å½“å‰GCè¿è¡Œå®Œæ¯•ã€‚</li><li>è¢«åŠ¨è§¦å‘ï¼Œåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š</li></ol><p>â€‹2.1 ä½¿ç”¨æ­¥è°ƒï¼ˆPacingï¼‰ç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯æ§åˆ¶å†…å­˜å¢é•¿çš„æ¯”ä¾‹,æ¯æ¬¡å†…å­˜åˆ†é…æ—¶æ£€æŸ¥å½“å‰å†…å­˜åˆ†é…é‡æ˜¯å¦å·²è¾¾åˆ°é˜ˆå€¼ï¼ˆç¯å¢ƒå˜é‡GOGCï¼‰ï¼šé»˜è®¤100%ï¼Œå³å½“å†…å­˜æ‰©å¤§ä¸€å€æ—¶å¯ç”¨GCã€‚</p><p>â€‹2.2 ä½¿ç”¨ç³»ç»Ÿç›‘æ§ï¼Œå½“è¶…è¿‡ä¸¤åˆ†é’Ÿæ²¡æœ‰äº§ç”Ÿä»»ä½•GCæ—¶ï¼Œå¼ºåˆ¶è§¦å‘ GCã€‚</p><p><code>GCè°ƒä¼˜</code></p><ol><li>æ§åˆ¶å†…å­˜åˆ†é…çš„é€Ÿåº¦ï¼Œé™åˆ¶Goroutine çš„æ•°é‡ï¼Œæé«˜èµ‹å€¼å™¨mutatorçš„CPUåˆ©ç”¨ç‡ï¼ˆé™ä½GCçš„CPUåˆ©ç”¨ç‡ï¼‰</li><li>å°‘é‡ä½¿ç”¨+è¿æ¥string</li><li>sliceæå‰åˆ†é…è¶³å¤Ÿçš„å†…å­˜æ¥é™ä½æ‰©å®¹å¸¦æ¥çš„æ‹·è´</li><li>é¿å…map keyå¯¹è±¡è¿‡å¤šï¼Œå¯¼è‡´æ‰«ææ—¶é—´å¢åŠ </li><li>å˜é‡å¤ç”¨ï¼Œå‡å°‘å¯¹è±¡åˆ†é…</li><li>å¢å¤§GOGCçš„å€¼ï¼Œé™ä½GCçš„è¿è¡Œé¢‘ç‡</li></ol><h2 id="GMPè°ƒåº¦"><a href="#GMPè°ƒåº¦" class="headerlink" title="GMPè°ƒåº¦"></a>GMPè°ƒåº¦</h2><p>Goroutineæ˜¯Goè¯­è¨€ä¸­å®ç°å¹¶å‘çš„å…³é”®ç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹ï¼Œç”±Goè¿è¡Œæ—¶ç³»ç»Ÿç®¡ç†è°ƒåº¦ã€‚Goroutineçš„è°ƒåº¦ç­–ç•¥æ˜¯Goå¹¶å‘æ¨¡å‹çš„æ ¸å¿ƒï¼Œå®ƒå†³å®šäº†Goroutineå¦‚ä½•åœ¨å¤šä¸ªå¤„ç†å™¨æ ¸å¿ƒä¸Šè¿è¡Œï¼Œä»¥åŠå¦‚ä½•åœ¨ç³»ç»Ÿèµ„æºæœ‰é™çš„æƒ…å†µä¸‹é«˜æ•ˆåœ°ç®¡ç†å¹¶å‘ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯Goroutineè°ƒåº¦ç­–ç•¥çš„ä¸€äº›å…³é”®ç‚¹ï¼š</p><p><strong>è°ƒåº¦å™¨è®¾è®¡</strong></p><p>Goçš„è°ƒåº¦å™¨è®¾è®¡ä¸ºä¸€ä¸ªä¸¤çº§è°ƒåº¦æ¨¡å‹ï¼Œå®ƒåŒ…æ‹¬ï¼š</p><ol><li><strong>G</strong>ï¼šä»£è¡¨Goroutineï¼Œæ˜¯ç”¨æˆ·çº§çš„è½»é‡çº§çº¿ç¨‹ï¼Œå®ƒä»¬åœ¨Pä¸Šè¿è¡Œã€‚</li><li><strong>M</strong>ï¼šä»£è¡¨Machineï¼Œå³Goè¿è¡Œæ—¶ç³»ç»Ÿä¸­çš„é€»è¾‘å¤„ç†å™¨ã€‚æ¯ä¸ªMå¯ä»¥ç»‘å®šåˆ°ä¸€ä¸ªç‰©ç†å¤„ç†å™¨æ ¸å¿ƒä¸Šï¼Œè´Ÿè´£æ‰§è¡ŒPä¸Šçš„ä»»åŠ¡ã€‚</li><li><strong>P</strong>ï¼šä»£è¡¨Processorï¼Œæ˜¯è°ƒåº¦å•ä½ï¼Œæ¯ä¸ªPç»´æŠ¤äº†ä¸€ä¸ªGoroutineçš„å°±ç»ªé˜Ÿåˆ—ã€‚Pçš„æ•°é‡é€šå¸¸ç”±<code>GOMAXPROCS</code>ç¯å¢ƒå˜é‡å†³å®šï¼Œå®ƒæ§åˆ¶ç€å¹¶å‘å¤„ç†å™¨çš„æ•°é‡ã€‚</li></ol><p><img src="https://github.com/gondmhd/blogImage/blob/main/img//GMP.jpg?raw=true" alt="GMPè°ƒåº¦"></p><p><strong>è°ƒåº¦ç­–ç•¥</strong></p><ol><li>**é˜Ÿåˆ—è½®è½¬: **Pä¼šå‘¨æœŸæ€§çš„å°†Gè°ƒåº¦åˆ°Mä¸­æ‰§è¡Œï¼Œæ‰§è¡Œä¸€æ®µæ—¶é—´åï¼Œä¿å­˜ä¸Šä¸‹æ–‡ï¼Œå°†Gæ”¾åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼Œç„¶åä»é˜Ÿåˆ—ä¸­å†å–å‡ºä¸€ä¸ªGè¿›è¡Œè°ƒåº¦ï¼ŒPè¿˜ä¼šå‘¨æœŸæ€§çš„æŸ¥çœ‹å…¨å±€é˜Ÿåˆ—æ˜¯å¦æœ‰Gç­‰å¾…è°ƒåº¦åˆ°Mä¸­æ‰§è¡Œ</li></ol><p>â€‹2.<strong>ç³»ç»Ÿè°ƒç”¨:</strong> å½“G0å³å°†è¿›å…¥ç³»ç»Ÿè°ƒç”¨æ—¶ï¼ŒM0å°†é‡Šæ”¾Pï¼Œè¿›è€ŒæŸä¸ªç©ºé—²çš„M1è·å–Pï¼Œç»§ç»­æ‰§è¡ŒPé˜Ÿåˆ—ä¸­å‰©ä¸‹çš„Gã€‚M1çš„æ¥æºæœ‰å¯èƒ½æ˜¯Mçš„ç¼“å­˜æ± ï¼Œä¹Ÿå¯èƒ½æ˜¯æ–°å»ºçš„ã€‚</p><p>â€‹3.<strong>G0ç³»ç»Ÿè°ƒç”¨ç»“æŸåçš„è°ƒåº¦</strong>ï¼š.å½“G0ç³»ç»Ÿè°ƒç”¨ç»“æŸåï¼Œå¦‚æœæœ‰ç©ºé—²çš„Pï¼Œåˆ™è·å–ä¸€ä¸ªPï¼Œç»§ç»­æ‰§è¡ŒG0ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™å°†G0æ”¾å…¥å…¨å±€é˜Ÿåˆ—ï¼Œç­‰å¾…è¢«å…¶ä»–çš„Pè°ƒåº¦ã€‚ç„¶åM0å°†è¿›å…¥ç¼“å­˜æ± ç¡çœ ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240715100953101.png?raw=true" alt="Goroutineè°ƒåº¦åŸç†å›¾"></p><p><strong>Groutineçš„åˆ‡æ¢æ—¶æœº</strong></p><p>â€‹1.selectæ“ä½œé˜»å¡æ—¶<br>â€‹2.ioé˜»å¡<br>â€‹3.é˜»å¡åœ¨channel<br>â€‹4.ç¨‹åºå‘˜æ˜¾ç¤ºç¼–ç æ“ä½œ<br>â€‹5.ç­‰å¾…é”<br>â€‹6.ç¨‹åºè°ƒç”¨</p><p><strong>Goroutineè°ƒåº¦åŸç†</strong></p><p>â€‹è°ƒåº¦å¾ªç¯ï¼šæ¯ä¸ªpéƒ½æœ‰ä¸€ä¸ªåç¨‹g0ï¼Œè°ƒåº¦æ—¶é¦–å…ˆåˆ‡æ¢åˆ°åç¨‹g0ï¼Œåˆ‡æ¢åˆ°æ¥ä¸‹æ¥å°†è¦è¿è¡Œçš„åç¨‹gï¼Œå†ä»åç¨‹gåˆ‡æ¢åˆ°åç¨‹g0ï¼Œå¼€å§‹æ–°ä¸€è½®è°ƒåº¦ã€‚</p><p>â€‹goroutineè°ƒåº¦çš„æœ¬è´¨å°±æ˜¯å°†**Goroutine(G)**æŒ‰ç…§ä¸€å®šç®—æ³•æ”¾åˆ°CPUä¸Šå»æ‰§è¡Œã€‚</p><p>â€‹CPUæ„ŸçŸ¥ä¸åˆ°Goroutineï¼ŒåªçŸ¥é“å†…æ ¸çº¿ç¨‹ï¼Œæ‰€ä»¥éœ€è¦Goè°ƒåº¦å™¨å°†åç¨‹è°ƒåº¦åˆ°å†…æ ¸çº¿ç¨‹ä¸Šé¢å»ï¼Œç„¶åæ“ä½œç³»ç»Ÿè°ƒåº¦å™¨å°†å†…æ ¸çº¿ç¨‹æ”¾åˆ°CPUä¸Šå»æ‰§è¡Œ</p><p>â€‹Mæ˜¯å¯¹å†…æ ¸çº§çº¿ç¨‹çš„å°è£…ï¼Œæ‰€ä»¥Goè°ƒåº¦å™¨çš„å·¥ä½œå°±æ˜¯å°†Gåˆ†é…åˆ°M</p><p>â€‹</p><p>è¢«è°ƒåº¦çš„å¯¹è±¡ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs tex">Gçš„æ¥æº<br>Pçš„runnext(åªæœ‰1ä¸ªGï¼Œå±€éƒ¨æ€§åŸç†ï¼Œæ°¸è¿œä¼šè¢«æœ€å…ˆè°ƒåº¦æ‰§è¡Œ)<br>Pçš„æœ¬åœ°é˜Ÿåˆ—ï¼ˆæ•°ç»„ï¼Œæœ€å¤š256ä¸ªG)<br>å…¨å±€Gé˜Ÿåˆ—(é“¾è¡¨ï¼Œæ— é™åˆ¶)<br>ç½‘ç»œè½®è¯¢å™¨network poller (å­˜æ”¾ç½‘ç»œè°ƒç”¨è¢«é˜»å¡çš„G)<br><br>Pçš„æ¥æº<br>å…¨å±€Pé˜Ÿåˆ—(æ•°ç»„ï¼ŒGOMAXPROCSä¸ªP)<br><br>Mçš„æ¥æº<br>ä¼‘çœ çº¿ç¨‹é˜Ÿåˆ—(æœªç»‘å®šPï¼Œé•¿æ—¶é—´ä¼‘çœ ä¼šç­‰å¾…GCå›æ”¶é”€æ¯)<br>è¿è¡Œçº¿ç¨‹ï¼ˆç»‘å®šPï¼ŒæŒ‡å‘Pä¸­çš„G)<br>è‡ªæ—‹çº¿ç¨‹ï¼ˆ(ç»‘å®šPï¼ŒæŒ‡å‘Mçš„GO)<br><br></code></pre></td></tr></table></figure><p>è¿è¡Œçº¿ç¨‹æ•°+è‡ªæ—‹çº¿ç¨‹æ•°&lt;&#x3D;Pçš„æ•°é‡ï¼ˆGOMAXPROCSï¼‰ï¼ŒMä¸ªæ•°&gt;&#x3D;Pçš„ä¸ªæ•°</p><p>Gçš„ç”Ÿå‘½å‘¨æœŸï¼šGä»åˆ›å»ºã€ä¿å­˜ã€è¢«è·å–ã€è°ƒåº¦å’Œæ‰§è¡Œã€é˜»å¡ã€é”€æ¯ï¼Œæ­¥éª¤å¦‚ä¸‹:</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs tex">æ­¥éª¤1:åˆ›å»ºGï¼Œå…³é”®å­—go func( )åˆ›å»ºG<br><br>æ­¥éª¤2âˆ¶ä¿å­˜Gï¼Œåˆ›å»ºçš„Gä¼˜å…ˆä¿å­˜åˆ°æœ¬åœ°é˜Ÿåˆ—Pï¼Œå¦‚æœPæ»¡äº†ï¼Œåˆ™ä¼šå¹³è¡¡éƒ¨åˆ†Påˆ°å…¨å±€é˜Ÿåˆ—ä¸­<br>ä¿å­˜Gçš„è¯¦ç»†æµç¨‹å¦‚ä¸‹:<br>æ‰§è¡Œgo funcçš„æ—¶å€™ï¼Œä¸»çº¿ç¨‹M0ä¼šè°ƒç”¨newproc()ç”Ÿæˆä¸€ä¸ªGç»“æ„ä½“ï¼Œè¿™é‡Œä¼šå…ˆé€‰å®šå½“å‰M0ä¸Šçš„Pç»“æ„<br>æ¯ä¸ªåç¨‹Géƒ½ä¼šè¢«å°è¯•å…ˆæ”¾åˆ°Pä¸­çš„runnextï¼Œè‹¥runnext ä¸ºç©ºåˆ™æ”¾åˆ°runnextä¸­ï¼Œç”Ÿäº§ç»“æŸ<br>è‹¥runnextæ»¡ï¼Œåˆ™å°†åŸæ¥runnextä¸­çš„Gè¸¢åˆ°æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼Œå°†å½“å‰Gæ”¾åˆ°runnextä¸­ï¼Œç”Ÿäº§ç»“æŸ<br>è‹¥æœ¬åœ°é˜Ÿåˆ—ä¹Ÿæ»¡äº†ï¼Œåˆ™å°†æœ¬åœ°é˜Ÿåˆ—ä¸­çš„Gæ‹¿å‡ºä¸€åŠï¼Œæ”¾åˆ°å…¨å±€é˜Ÿåˆ—ä¸­ï¼Œç”Ÿäº§ç»“æŸã€‚<br><br>æ­¥éª¤3âˆ¶å”¤é†’æˆ–è€…æ–°å»ºMæ‰§è¡Œä»»åŠ¡ï¼Œè¿›å…¥è°ƒåº¦å¾ªç¯ï¼ˆæ­¥éª¤4,5,6)<br><br>æ­¥éª¤4âˆ¶Mè·å–Gï¼ŒMé¦–å…ˆä»Pçš„æœ¬åœ°é˜Ÿåˆ—è·å–Gï¼Œå¦‚æœPä¸ºç©ºï¼Œåˆ™ä»å…¨å±€é˜Ÿåˆ—è·å–Gï¼Œå¦‚æœå…¨å±€é˜Ÿåˆ—ä¹Ÿä¸º<br>ç©ºï¼Œåˆ™ä»å¦ä¸€ä¸ªæœ¬åœ°é˜Ÿåˆ—å·å–ä¸€åŠæ•°é‡çš„G(è´Ÿè½½å‡è¡¡)ï¼Œè¿™ç§ä»å…¶å®ƒPå·çš„æ–¹å¼ç§°ä¹‹ä¸ºwork stealing<br><br>æ­¥éª¤5: Mè°ƒåº¦å’Œæ‰§è¡ŒGï¼ŒMè°ƒç”¨G.func()å‡½æ•°æ‰§è¡ŒG<br>å¦‚æœMåœ¨æ‰§è¡ŒGçš„è¿‡ç¨‹å‘ç”Ÿç³»ç»Ÿè°ƒç”¨é˜»å¡ï¼ˆåŒæ­¥)ï¼Œä¼šé˜»å¡Gå’ŒM(æ“ä½œç³»ç»Ÿé™åˆ¶)ï¼Œæ­¤æ—¶Pä¼šå’Œå½“å‰Mè§£ç»‘ï¼Œ<br>å¹¶å¯»æ‰¾æ–°çš„Mï¼Œå¦‚æœæ²¡æœ‰ç©ºé—²çš„Må°±ä¼šæ–°å»ºä¸€ä¸ªMï¼Œæ¥ç®¡æ­£åœ¨é˜»å¡Gæ‰€å±çš„Pï¼Œæ¥ç€ç»§ç»­æ‰§è¡ŒPä¸­å…¶ä½™çš„<br>Gï¼Œè¿™ç§é˜»å¡åé‡Šæ”¾Pçš„æ–¹å¼ç§°ä¹‹ä¸ºhand offã€‚å½“ç³»ç»Ÿè°ƒç”¨ç»“æŸåï¼Œè¿™ä¸ªGä¼šå°è¯•è·å–ä¸€ä¸ªç©ºé—²çš„Pæ‰§è¡Œï¼Œ<br>ä¼˜å…ˆè·å–ä¹‹å‰ç»‘å®šçš„Pï¼Œå¹¶æ”¾å…¥åˆ°è¿™ä¸ªPçš„æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦‚æœè·å–ä¸åˆ°Pï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹Må˜æˆä¼‘çœ çŠ¶æ€ï¼ŒåŠ <br>å…¥åˆ°ç©ºé—²çº¿ç¨‹ä¸­ï¼Œç„¶åè¿™ä¸ªGä¼šè¢«æ”¾å…¥åˆ°å…¨å±€é˜Ÿåˆ—ä¸­ã€‚<br>å¦‚æœMåœ¨æ‰§è¡ŒGçš„è¿‡ç¨‹å‘ç”Ÿç½‘ç»œIOç­‰æ“ä½œé˜»å¡æ—¶(å¼‚æ­¥)ï¼Œé˜»å¡Gï¼Œä¸ä¼šé˜»å¡Mã€‚Mä¼šå¯»æ‰¾Pä¸­å…¶å®ƒå¯æ‰§è¡Œçš„<br>Gç»§ç»­æ‰§è¡Œï¼ŒGä¼šè¢«ç½‘ç»œè½®è¯¢å™¨network polleræ¥æ‰‹ï¼Œå½“é˜»å¡çš„Gæ¢å¤åï¼ŒG1ä»network pollerè¢«ç§»å›åˆ°Pçš„<br>LRQä¸­ï¼Œé‡æ–°è¿›å…¥å¯æ‰§è¡ŒçŠ¶æ€ã€‚å¼‚æ­¥æƒ…å†µä¸‹ï¼Œé€šè¿‡è°ƒåº¦ï¼ŒGo scheduleræˆåŠŸåœ°å°†I/Oçš„ä»»åŠ¡è½¬å˜æˆäº†<br>CPUä»»åŠ¡ï¼Œæˆ–è€…è¯´å°†å†…æ ¸çº§åˆ«çš„çº¿ç¨‹åˆ‡æ¢è½¬å˜æˆäº†ç”¨æˆ·çº§åˆ«çš„goroutineåˆ‡æ¢ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚<br><br>æ­¥éª¤6âˆ¶Mæ‰§è¡Œå®ŒGåæ¸…ç†ç°åœºï¼Œé‡æ–°è¿›å…¥è°ƒåº¦å¾ªç¯ï¼ˆå°†Mä¸Šè¿è¡Œçš„goroutineåˆ‡æ¢ä¸ºG0ï¼ŒG0è´Ÿè´£è°ƒåº¦æ—¶<br>åç¨‹çš„åˆ‡æ¢)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä»€ä¹ˆç­–ç•¥æ¥æŒ‘é€‰ä¸‹ä¸€ä¸ªgoroutineæ‰§è¡Œ?</p><p>ç”±äºPä¸­çš„Gåˆ†å¸ƒåœ¨runnextã€æœ¬åœ°é˜Ÿåˆ—ã€å…¨å±€é˜Ÿåˆ—ã€ç½‘ç»œè½®è¯¢å™¨ä¸­ï¼Œåˆ™éœ€è¦æŒ¨ä¸ªåˆ¤æ–­æ˜¯å¦æœ‰å¯æ‰§è¡Œçš„Gï¼Œå¤§ä½“é€»è¾‘å¦‚ä¸‹:</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex">æ¯æ‰§è¡Œ61æ¬¡è°ƒåº¦å¾ªç¯ï¼Œä»å…¨å±€é˜Ÿåˆ—è·å–Gï¼Œè‹¥æœ‰åˆ™ç›´æ¥è¿”å›<br>ä»Pä¸Šçš„runnextçœ‹ä¸€ä¸‹æ˜¯å¦æœ‰Gï¼Œè‹¥æœ‰åˆ™ç›´æ¥è¿”å›<br>ä»Pä¸Šçš„æœ¬åœ°é˜Ÿåˆ—çœ‹ä¸€ä¸‹æ˜¯å¦æœ‰Gï¼Œè‹¥æœ‰åˆ™ç›´æ¥è¿”å›<br>ä¸Šé¢éƒ½æ²¡æŸ¥æ‰¾åˆ°æ—¶ï¼Œåˆ™å»å…¨å±€é˜Ÿåˆ—ã€ç½‘ç»œè½®è¯¢å™¨æŸ¥æ‰¾æˆ–è€…ä»å…¶ä»–Ğ ä¸­çªƒå–,tä¸€ç›´é˜»å¡ç›´åˆ°è·å–åˆ°ä¸€ä¸ªå¯ç”¨çš„Gä¸ºæ­¢<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockeråŸºç¡€</title>
    <link href="/2024/12/10/docker/Docker%E5%85%A5%E9%97%A8/"/>
    <url>/2024/12/10/docker/Docker%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://www.docker.com/get-started">https://www.docker.com/get-started</a></p><p>ä¸­æ–‡å‚è€ƒæ‰‹å†Œï¼š<a href="https://docker_practice.gitee.io/zh-cn">https://docker_practice.gitee.io/zh-cn</a></p></blockquote><h1 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h1><h2 id="1-1-ä»€ä¹ˆæ˜¯-docker"><a href="#1-1-ä»€ä¹ˆæ˜¯-docker" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯ docker"></a>1.1 ä»€ä¹ˆæ˜¯ docker</h2><p>Docker æ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ã€å‘å¸ƒå’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„å¼€æ”¾å¹³å°ã€‚Docker ä½¿æ‚¨èƒ½å¤Ÿå°†åº”ç”¨ç¨‹åºä¸åŸºç¡€æ¶æ„åˆ†å¼€ï¼Œä»¥ä¾¿å¿«é€Ÿäº¤ä»˜è½¯ä»¶ã€‚ä½¿ç”¨ Docker æ‚¨å¯ä»¥ä½¿ç”¨ä¸ç®¡ç†åº”ç”¨ç¨‹åºç›¸åŒçš„æ–¹å¼ç®¡ç†æ‚¨çš„åŸºç¡€è®¾æ–½ã€‚é€šè¿‡åˆ©ç”¨ Docker ç”¨äºå¿«é€Ÿäº¤ä»˜ã€æµ‹è¯•å’Œéƒ¨ç½²ä»£ç çš„æ–¹æ³•ï¼Œæ‚¨å¯ä»¥æ˜¾è‘—å‡å°‘ç¼–å†™ä»£ç å’Œåœ¨ç”Ÿäº§ä¸­è¿è¡Œä»£ç ä¹‹é—´çš„å»¶è¿Ÿã€‚<strong>Docker æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„å®¹å™¨è§£å†³æ–¹æ¡ˆ,ä¸ç®¡ä½ æ˜¯è°,ä¸ç®¡ä½ åœ¨å“ª,ä½ éƒ½å¯ä»¥å¼€å§‹å®¹å™¨çš„çš„æ—…ç¨‹</strong></p><blockquote><p>Docker æ˜¯ä¸€ä¸ªå®¹å™¨æŠ€æœ¯</p></blockquote><h2 id="1-2-docker-èµ·æº"><a href="#1-2-docker-èµ·æº" class="headerlink" title="1.2 docker èµ·æº"></a>1.2 docker èµ·æº</h2><p>Docker æœ€åˆæ˜¯ dotCloud å…¬å¸åˆ›å§‹äºº Solomon Hykes åœ¨æ³•å›½æœŸé—´å‘èµ·çš„ä¸€ä¸ªå…¬å¸å†…éƒ¨é¡¹ç›®ï¼Œå®ƒæ˜¯åŸºäº dotCloud å…¬å¸å¤šå¹´äº‘æœåŠ¡æŠ€æœ¯çš„ä¸€æ¬¡é©æ–°ï¼Œå¹¶äº 2013 å¹´ 3 æœˆä»¥ Apache 2.0 æˆæƒåè®®å¼€æºï¼Œä¸»è¦é¡¹ç›®ä»£ç åœ¨ GitHub ä¸Šè¿›è¡Œç»´æŠ¤ã€‚Docker é¡¹ç›®åæ¥è¿˜åŠ å…¥äº† Linux åŸºé‡‘ä¼šï¼Œå¹¶æˆç«‹æ¨åŠ¨ å¼€æ”¾å®¹å™¨è”ç›Ÿï¼ˆOCIï¼‰ã€‚</p><p>Docker ä½¿ç”¨ Google å…¬å¸æ¨å‡ºçš„ Go è¯­è¨€ è¿›è¡Œå¼€å‘å®ç°ï¼ŒåŸºäº Linux å†…æ ¸çš„ cgroupï¼Œnamespaceï¼Œä»¥åŠ OverlayFS ç±»çš„ Union FS ç­‰æŠ€æœ¯ï¼Œ<strong>å¯¹è¿›ç¨‹è¿›è¡Œå°è£…éš”ç¦»ï¼Œå±äºæ“ä½œç³»ç»Ÿå±‚é¢çš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ç”±äºéš”ç¦»çš„è¿›ç¨‹ç‹¬ç«‹äºå®¿ä¸»å’Œå…¶å®ƒçš„éš”ç¦»çš„è¿›ç¨‹ï¼Œå› æ­¤ä¹Ÿç§°å…¶ä¸ºå®¹å™¨</strong>ã€‚</p><h2 id="1-3-ä¸ºä»€ä¹ˆæ˜¯-docker"><a href="#1-3-ä¸ºä»€ä¹ˆæ˜¯-docker" class="headerlink" title="1.3 ä¸ºä»€ä¹ˆæ˜¯ docker"></a>1.3 ä¸ºä»€ä¹ˆæ˜¯ docker</h2><blockquote><p>å¼€å‘çš„æ—¶å€™ï¼Œæœ¬æœºæµ‹è¯•ç¯å¢ƒå¯ä»¥è·‘ï¼Œç”Ÿäº§ç¯å¢ƒè·‘æ­¥èµ·æ¥</p></blockquote><p>å‡å¦‚ä¸Šçº¿ä¸€ä¸ª java web é¡¹ç›®ï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºæ¶‰åŠå¾ˆå¤šä¸œè¥¿å¦‚ï¼šjdkã€tomcatã€redisã€mysqlç­‰ï¼Œå½“è¿™äº›å…¶ä¸­æŸä¸€é¡¹ç‰ˆæœ¬ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œå¯èƒ½å°±ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºè·‘ä¸èµ·æ¥è¿™ç§æƒ…å†µã€‚Docker åˆ™å°†ç¨‹åºä»¥åŠä½¿ç”¨è½¯ä»¶ç¯å¢ƒç›´æ¥æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œæ— è®ºåœ¨é‚£ä¸ªæœºå™¨ä¸Šä¿è¯äº†ç¯å¢ƒä¸€è‡´ã€‚</p><p><strong>ä¼˜åŠ¿ä¸€ï¼šä¸€è‡´çš„è¿è¡Œç¯å¢ƒï¼Œæ›´è½»æ¾çš„è¿ç§»</strong></p><blockquote><p>åˆ«äººç¨‹åºå‡ºäº†é—®é¢˜æŠŠæœåŠ¡å™¨èµ„æºåƒå…‰ï¼Œå¯¼è‡´è‡ªå·±çš„åº”ç”¨æŒ‚æ‰äº†</p></blockquote><p>å¦‚æœä½ çš„ç¨‹åºé‡è¦æ€§ä¸æ˜¯ç‰¹åˆ«é«˜çš„è¯ï¼Œå…¬å¸åŸºæœ¬ä¸Šä¸å¯èƒ½è®©ä½ çš„ç¨‹åºç‹¬äº«ä¸€å°æœåŠ¡å™¨çš„ï¼Œè¿™æ—¶å€™ä½ çš„æœåŠ¡å™¨å°±ä¼šè·Ÿå…¬å¸å…¶ä»–äººçš„ç¨‹åºå…±äº«ä¸€å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¸å¯é¿å…åœ°å°±ä¼šå—åˆ°å…¶ä»–ç¨‹åºçš„å¹²æ‰°ï¼Œå¯¼è‡´è‡ªå·±çš„ç¨‹åºå‡ºç°é—®é¢˜ã€‚Docker å°±å¾ˆå¥½è§£å†³äº†ç¯å¢ƒéš”ç¦»çš„é—®é¢˜ï¼Œåˆ«äººç¨‹åºä¸ä¼šå½±å“åˆ°è‡ªå·±çš„ç¨‹åºã€‚</p><p><strong>ä¼˜åŠ¿äºŒï¼šè¿›ç¨‹çº§çš„éš”ç¦»ï¼Œå®¹å™¨ä¸å®¹å™¨ä¹‹é—´äº’ä¸å½±å“ï¼Œæ›´é«˜æ•ˆåˆ©ç”¨èµ„æº</strong></p><blockquote><p>ä¿ƒé”€æ´»åŠ¨éœ€è¦ä¸´æ—¶æ‹“å±•å‡ åå°æœåŠ¡å™¨</p></blockquote><p>åœ¨æ²¡æœ‰ Docker çš„æƒ…å†µä¸‹ï¼Œè¦åœ¨å‡ å¤©å†…éƒ¨ç½²å‡ åå°æœåŠ¡å™¨ï¼Œè¿™å¯¹è¿ç»´æ¥è¯´æ˜¯ä¸€ä»¶éå¸¸æŠ˜ç£¨äººçš„äº‹ï¼Œè€Œä¸”æ¯å°æœåŠ¡å™¨çš„ç¯å¢ƒè¿˜ä¸ä¸€å®šä¸€æ ·ï¼Œå°±ä¼šå‡ºç°å„ç§é—®é¢˜ï¼Œæœ€åéƒ¨ç½²åœ°å¤´çš®å‘éº»ã€‚ç”¨ Docker çš„è¯ï¼Œåªéœ€è¦å°†ç¨‹åºæ‰“åŒ…æˆé•œåƒï¼Œä½ è¦å¤šå°‘å°æœåŠ¡ï¼Œæˆ‘å°±å¯åŠ¨å¤šå°‘å®¹å™¨ï¼Œæå¤§åœ°æé«˜äº†éƒ¨ç½²æ•ˆç‡ã€‚</p><p><strong>ä¼˜åŠ¿ä¸‰: é€šè¿‡é•œåƒå¤åˆ¶Nå¤šä¸ªç¯å¢ƒä¸€è‡´å®¹å™¨</strong></p><h2 id="1-4-docker-ä¸è™šæ‹Ÿæœº"><a href="#1-4-docker-ä¸è™šæ‹Ÿæœº" class="headerlink" title="1.4 docker ä¸è™šæ‹Ÿæœº"></a>1.4 docker ä¸è™šæ‹Ÿæœº</h2><ol><li>è™šæ‹Ÿæœºæ˜¯æºå¸¦æ“ä½œç³»ç»Ÿçš„ï¼Œdocker ä¸æºå¸¦æ“ä½œç³»ç»Ÿ</li><li>è™šæ‹Ÿæœºè°ƒåº¦èµ„æºæ­¥éª¤ä¸ºï¼šåˆ©ç”¨ Hypervisor è™šæ‹ŸåŒ–å†…å­˜ï¼Œè™šæ‹Ÿå†…å­˜ -&gt; è™šæ‹Ÿç‰©ç†å†…å­˜ -&gt; ç‰©ç†å†…å­˜</li><li>docker è°ƒåº¦èµ„æºæ­¥éª¤ä¸ºï¼šåˆ©ç”¨ Docker Engine è°ƒç”¨å®¿ä¸»æœºèµ„æºï¼Œè™šæ‹Ÿå†…å­˜ -&gt; ç‰©ç†å†…å­˜</li></ol><table><thead><tr><th></th><th>ä¼ ç»Ÿè™šæ‹Ÿæœº</th><th>Dockerå®¹å™¨</th></tr></thead><tbody><tr><td>ç£ç›˜å ç”¨</td><td>å‡ ä¸ªGBåˆ°å‡ åä¸ªGBå·¦å³</td><td>å‡ åMBåˆ°å‡ ç™¾MBå·¦å³</td></tr><tr><td>CPUå†…å­˜å ç”¨</td><td>è™šæ‹Ÿæ“ä½œç³»ç»Ÿéå¸¸å ç”¨CPUå’Œå†…å­˜</td><td>Dockerå¼•æ“å ç”¨æä½</td></tr><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>ï¼ˆä»å¼€æœºåˆ°è¿è¡Œé¡¹ç›®ï¼‰å‡ åˆ†é’Ÿ</td><td>ï¼ˆä»å¼€å¯å®¹å™¨åˆ°è¿è¡Œé¡¹ç›®ï¼‰å‡ ç§’</td></tr><tr><td>å®‰è£…ç®¡ç†</td><td>éœ€è¦ä¸“é—¨çš„è¿ç»´æŠ€æœ¯</td><td>å®‰è£…ã€ç®¡ç†æ–¹ä¾¿</td></tr><tr><td>åº”ç”¨éƒ¨ç½²</td><td>æ¯æ¬¡éƒ¨ç½²éƒ½è´¹æ—¶è´¹åŠ›</td><td>ä»ç¬¬äºŒæ¬¡éƒ¨ç½²å¼€å§‹è½»æ¾ç®€æ·</td></tr><tr><td>è€¦åˆæ€§</td><td>å¤šä¸ªåº”ç”¨æœåŠ¡å®‰è£…åˆ°ä¸€èµ·ï¼Œå®¹æ˜“äº’ç›¸å½±å“</td><td>æ¯ä¸ªåº”ç”¨æœåŠ¡ä¸€ä¸ªå®¹å™¨ï¼Œè¾¾æˆéš”ç¦»</td></tr><tr><td>ç³»ç»Ÿä¾èµ–</td><td>æ— </td><td>éœ€æ±‚ç›¸åŒæˆ–ç›¸ä¼¼çš„å†…æ ¸ï¼Œç›®å‰æ¨èæ˜¯Linux</td></tr></tbody></table><h2 id="1-5-docker-å®‰è£…"><a href="#1-5-docker-å®‰è£…" class="headerlink" title="1.5 docker å®‰è£…"></a>1.5 docker å®‰è£…</h2><p>åœ¨æµ‹è¯•æˆ–å¼€å‘ç¯å¢ƒä¸­ Docker å®˜æ–¹ä¸ºäº†ç®€åŒ–å®‰è£…æµç¨‹ï¼Œæä¾›äº†ä¸€å¥—ä¾¿æ·çš„å®‰è£…è„šæœ¬ï¼ŒCentOS ç³»ç»Ÿä¸Šå¯ä»¥ä½¿ç”¨è¿™å¥—è„šæœ¬å®‰è£…ï¼Œå¦å¤–å¯ä»¥é€šè¿‡ â€“mirror é€‰é¡¹ä½¿ç”¨å›½å†…æºè¿›è¡Œå®‰è£…ï¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œè„šæœ¬å°±ä¼šè‡ªåŠ¨çš„å°†ä¸€åˆ‡å‡†å¤‡å·¥ä½œåšå¥½ï¼Œå¹¶ä¸”æŠŠ Docker çš„ç¨³å®š(stable)ç‰ˆæœ¬å®‰è£…åœ¨ç³»ç»Ÿä¸­ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">curl -fsSL get.docker.com -o get-docker.sh</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo sh get-docker.sh --mirror Aliyun</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨ docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl <span class="hljs-built_in">enable</span> docker</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl start docker</span><br></code></pre></td></tr></table></figure><p>éªŒè¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker run hello-world</span><br></code></pre></td></tr></table></figure><p>ä¸ªäººä½¿ç”¨çš„æ˜¯ docker for mac</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">brew install -cask docker</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥å»å®˜ç½‘ä¸‹è½½ docker for desktop</p><h2 id="1-6-docker-æ¶æ„"><a href="#1-6-docker-æ¶æ„" class="headerlink" title="1.6 docker æ¶æ„"></a>1.6 docker æ¶æ„</h2><ul><li>é•œåƒï¼šé•œåƒä»£è¡¨ä¸€ä¸ªåº”ç”¨ç¯å¢ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªåªè¯»æ–‡ä»¶ï¼Œå¦‚ï¼šmysqlé•œåƒã€tomcaté•œåƒç­‰</li><li>å®¹å™¨ï¼šé•œåƒæ¯æ¬¡è¿è¡Œä¹‹åä¼šäº§ç”Ÿä¸€ä¸ªå®¹å™¨ï¼Œå³æ­£åœ¨è¿è¡Œçš„é•œåƒï¼Œå¯è¯»å¯å†™</li><li>ä»“åº“ï¼šå­˜æ¡£é•œåƒçš„ä½ç½®ï¼Œç”¨äºé•œåƒçš„ä¸Šä¼ å’Œä¸‹è½½</li><li>Dockerfileï¼šdockerç”Ÿæˆé•œåƒçš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºè‡ªå®šä¹‰é•œåƒçš„ä¸€äº›é…ç½®</li><li>tarï¼šå¯¹é•œåƒçš„æ‰“åŒ…æ–‡ä»¶ï¼Œå¯ä»¥åŸºäºè¿™ä¸ªæ–‡ä»¶è¿˜åŸæˆé•œåƒ</li></ul><h2 id="1-7-docker-è¿è¡Œæµç¨‹"><a href="#1-7-docker-è¿è¡Œæµç¨‹" class="headerlink" title="1.7 docker è¿è¡Œæµç¨‹"></a>1.7 docker è¿è¡Œæµç¨‹</h2><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240517140420277.png?raw=true" alt="image-20240517140420277"></p><h2 id="1-8-é…ç½®é•œåƒåŠ é€Ÿ"><a href="#1-8-é…ç½®é•œåƒåŠ é€Ÿ" class="headerlink" title="1.8 é…ç½®é•œåƒåŠ é€Ÿ"></a>1.8 é…ç½®é•œåƒåŠ é€Ÿ</h2><p>Linux é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &#x27;&#123;<br>    &quot;registry-mirrors&quot;:[<br>        &quot;https://hub.uuuadc.top&quot;,<br>        &quot;https://docker.anyhub.us.kg&quot;,<br>        &quot;https://dockerhub.jobcher.com&quot;,<br>        &quot;https://dockerhub.icu&quot;,<br>        &quot;https://docker.ckyl.me&quot;,<br>        &quot;https://docker.awsl9527.cn&quot;<br>    ],<br>    &quot;data-root&quot;:&quot;/home/dockerdate&quot;,<br>    &quot;log-driver&quot;:&quot;json-file&quot;,<br>    &quot;log-opts&quot;:&#123;<br>        &quot;max-size&quot;:&quot;512m&quot;,&quot;max-file&quot;:&quot;3&quot;<br>    &#125;<br>&#125;&#x27; | sudo tee /etc/docker/daemon.json<br>sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure><p>éªŒè¯é•œåƒåŠ é€Ÿæ˜¯å¦ç”Ÿæ•ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~]# docker info<br>..........<br>    127.0.0.0/8<br> Registry Mirrors:<br>  https://docker.m.daocloud.io/<br> https://dockerproxy.com/<br> https://docker.mirrors.ustc.edu.cn/<br> https://docker.nju.edu.cn/<br><br>   Live Restore Enabled: false<br>   Product License: Community Engine<br></code></pre></td></tr></table></figure><h1 id="äºŒã€Docker-å…¥é—¨"><a href="#äºŒã€Docker-å…¥é—¨" class="headerlink" title="äºŒã€Docker å…¥é—¨"></a>äºŒã€Docker å…¥é—¨</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker run hello-world                                       <br>Unable to find image &#x27;hello-world:latest&#x27; locally<br>latest: Pulling from library/hello-world<br>93288797bd35: Pull complete <br>Digest: sha256:393b81f0ea5a98a7335d7ad44be96fe76ca8eb2eaa76950eb8c989ebf2b78ec0<br>Status: Downloaded newer image for hello-world:latest<br><br>Hello from Docker!<br>This message shows that your installation appears to be working correctly.<br><br>To generate this message, Docker took the following steps:<br> 1. The Docker client contacted the Docker daemon.<br> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.<br>    (arm64v8)<br> 3. The Docker daemon created a new container from that image which runs the<br>    executable that produces the output you are currently reading.<br> 4. The Docker daemon streamed that output to the Docker client, which sent it<br>    to your terminal.<br><br>To try something more ambitious, you can run an Ubuntu container with:<br><span class="hljs-meta prompt_"> $ </span><span class="language-bash">docker run -it ubuntu bash</span><br><br>Share images, automate workflows, and more with a free Docker ID:<br> https://hub.docker.com/<br><br>For more examples and ideas, visit:<br> https://docs.docker.com/get-started/<br></code></pre></td></tr></table></figure><h2 id="2-1-è¾…åŠ©å‘½ä»¤"><a href="#2-1-è¾…åŠ©å‘½ä»¤" class="headerlink" title="2.1 è¾…åŠ©å‘½ä»¤"></a>2.1 è¾…åŠ©å‘½ä»¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹dockerä¿¡æ¯</span><br>docker version<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ¶ˆæ¯ä¿¡æ¯</span><br>docker info<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¸®åŠ©å‘½ä»¤</span><br>docker --help<br></code></pre></td></tr></table></figure><h2 id="2-2-é•œåƒå‘½ä»¤"><a href="#2-2-é•œåƒå‘½ä»¤" class="headerlink" title="2.2 é•œåƒå‘½ä»¤"></a>2.2 é•œåƒå‘½ä»¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æœ¬æœºæ‰€æœ‰é•œåƒ</span><br>docker images<br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ—å‡ºæ‰€æœ‰é•œåƒ(åŒ…å«ä¸­é—´é•œåƒå±‚)</span><br>  docker images -a<br><span class="hljs-meta prompt_">  # </span><span class="language-bash">åªæ˜¾ç¤ºé•œåƒ<span class="hljs-built_in">id</span>(ç”¨äºæ‰¹é‡åˆ é™¤)</span><br>  docker -q<br><span class="hljs-meta prompt_">  </span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æœç´¢é•œåƒ</span><br>docker search [options] é•œåƒå<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯</span><br>docker search --no-trunc tomcat<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä»ä»“åº“ä¸‹è½½é•œåƒ</span><br>docker pull é•œåƒå[:TAG|@DIGEST]<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä»…é•œåƒåé»˜è®¤ä¸‹è½½ latest</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ é™¤é•œåƒ</span><br>docker image rm é•œåƒå|é•œåƒID<br><span class="hljs-meta prompt_">  # </span><span class="language-bash">ç®€å†™</span><br>  docker rmi é•œåƒå|é•œåƒID<br><span class="hljs-meta prompt_">  # </span><span class="language-bash">å¼ºåˆ¶åˆ é™¤</span><br>  docker rmi -f é•œåƒå|é•œåƒID<br></code></pre></td></tr></table></figure><p>è¡¥å……ï¼š</p><p>docker images å±•ç¤ºçš„é•œåƒä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">REPOSITORY       TAG       IMAGE ID       CREATED       SIZE<br></code></pre></td></tr></table></figure><ul><li>REPOSITORYï¼šä»“åº“ï¼Œå³é•œåƒåç§°</li><li>TAGï¼šåˆ†æ”¯ï¼Œå¯ä»¥ç†è§£ä¸ºç‰ˆæœ¬å·</li><li>IMAGE IDï¼šé•œåƒIDï¼Œå…¨ç½‘å”¯ä¸€</li><li>CREATEDï¼šé•œåƒæ„å»ºæ—¶é—´</li><li>SIZEï¼šé•œåƒå¤§å°</li></ul><p>docker å‘½ä»¤æä¾›ç±»ä¼¼ Linux çš„ç®¡é“åŠŸèƒ½ï¼Œå¦‚åˆ é™¤æ‰€æœ‰é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker rmi -f $(docker images -q)<br></code></pre></td></tr></table></figure><h2 id="2-3-å®¹å™¨å‘½ä»¤"><a href="#2-3-å®¹å™¨å‘½ä»¤" class="headerlink" title="2.3 å®¹å™¨å‘½ä»¤"></a>2.3 å®¹å™¨å‘½ä»¤</h2><p>é€šå¸¸æˆ‘ä»¬å‡†å¤‡ä¸‹è½½ä¸€ä¸ªé•œåƒä¸ä¼šé€šè¿‡ docker searchï¼Œå› ä¸ºå±•ç¤ºå‡ºæ¥çš„ä¿¡æ¯ä¸åŒ…å«åˆ†æ”¯ä¿¡æ¯ï¼Œå³ç‰ˆæœ¬å·ï¼Œä¸€èˆ¬ä¼šåœ¨<a href="https://hub.docker.com/">dockerhub</a>ç½‘ç«™æœç´¢æˆ‘ä»¬éœ€è¦çš„é•œåƒçš„å…·ä½“åˆ†æ”¯ï¼Œæ¯”å¦‚ï¼šä¸‹è½½tomcat</p><p>é€‰æ‹©é€‚åˆçš„ç‰ˆæœ¬å¤åˆ¶å‘½ä»¤ä¸‹è½½é•œåƒ <code>docker pull tomcat:latest</code></p><p><strong>è¿è¡Œå®¹å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker run tomcat:latest<br></code></pre></td></tr></table></figure><p><strong>åå°è¿è¡Œå®¹å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker run -d tomcat:latest <br></code></pre></td></tr></table></figure><p>æ­¤æ—¶å®¹å™¨å·²ç»å¯åŠ¨ï¼Œå°è¯•è®¿é—®æœ¬æœº 8080 ç«¯å£ï¼Œå‘ç°æ‹’ç»è¿æ¥ï¼Œè¿™æ˜¯å› ä¸º docker çš„ç‰¹ç‚¹ï¼šçº¿ç¨‹çº§éš”ç¦»ï¼Œç›¸å½“äºæ­¤æ—¶ tomcat ç‹¬è‡ªè¿è¡Œåœ¨æœ¬æœºçš„ä¸€ä¸ªè™šæ‹Ÿæœºä¸­ï¼Œè‹¥è¦å®ç°å®¹å™¨å’Œå®¿ä¸»æœºçš„é€šä¿¡ï¼Œéœ€è¦æ˜ å°„å®¹å™¨ç«¯å£ã€‚</p><p><strong>æ˜ å°„å®¹å™¨ç«¯å£</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker run -d -p 8080:8080 tomcat:latest<br></code></pre></td></tr></table></figure><p>æ ¼å¼ï¼š-p å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker ps                <br>CONTAINER IDIMAGECOMMANDCREATEDSTATUSPORTSNAMES<br></code></pre></td></tr></table></figure><ul><li>CONTAINER IDï¼šå®¹å™¨IDï¼Œå”¯ä¸€</li><li>IMAGEï¼šå®¹å™¨åŸºäºçš„é•œåƒ</li><li>COMMANDï¼šå®¹å™¨å¯åŠ¨æ‰§è¡Œçš„å‘½ä»¤</li><li>CREATEDï¼šå®¹å™¨åˆ›å»ºçš„æ—¶é—´</li><li>STATUSï¼šå®¹å™¨æ­¤æ—¶çš„çŠ¶æ€</li><li>PORTSï¼šå®¹å™¨ç«¯å£ä¿¡æ¯</li><li>NAMESï¼šå®¹å™¨åç§°ï¼Œå”¯ä¸€</li></ul><p>åŸºäºå®¹å™¨çš„æ“ä½œä¸ä»…å¯ä»¥ä½¿ç”¨ CONTAINER ID ä¹Ÿå¯ä»¥ä½¿ç”¨ NAMES</p><p>æ‹“å±•å‚æ•°ï¼š</p><ul><li>-a:æŸ¥çœ‹æ‰€æœ‰å®¹å™¨(æ­£åœ¨è¿è¡Œå’Œå†å²è¿è¡Œè¿‡çš„å®¹å™¨)</li><li>-q:é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ID</li></ul><p><strong>è¿è¡Œå®¹å™¨æŒ‡å®šåç§°</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker run -d -p 8081:8080 --name tomcat01 tomcat:latest<br></code></pre></td></tr></table></figure><p><strong>åœæ­¢|å…³é—­|é‡å¯å®¹å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨å®¹å™¨</span><br>docker start å®¹å™¨åå­—æˆ–è€…å®¹å™¨ID<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å…³é—­å®¹å™¨</span><br>docker stop å®¹å™¨åå­—æˆ–è€…å®¹å™¨ID<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç«‹åˆ»åœæ­¢å®¹å™¨</span><br>docker kill å®¹å™¨åå­—æˆ–è€…å®¹å™¨ID<br><span class="hljs-meta prompt_"># </span><span class="language-bash">é‡å¯å®¹å™¨</span><br>docker restart å®¹å™¨åå­—æˆ–è€…å®¹å™¨ID<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°è¿™äº›å‘½ä»¤æ­é… <code>docker ps -q</code> å¯å®ç°æ‰¹é‡æ“ä½œ</p><blockquote><p>docker run å’Œ docker start åŒºåˆ«ï¼šrun è¿è¡Œé•œåƒï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼›start ä»…å¯åŠ¨ä¸€ä¸ªå†å²å®¹å™¨</p></blockquote><p><strong>åˆ é™¤å®¹å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker rm å®¹å™¨åå­—æˆ–è€…å®¹å™¨ID<br></code></pre></td></tr></table></figure><p>æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸å¯ä»¥è¢«åˆ é™¤ï¼Œä½¿ç”¨ -f å¯ä»¥å¼ºåˆ¶åˆ é™¤ï¼Œé¢å¤–ï¼š<code>docker rm -f $(docker ps -aq)</code> åˆ é™¤æ‰€æœ‰å®¹å™¨ï¼ï¼ï¼</p><p><strong>æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker top å®¹å™¨åå­—æˆ–è€…å®¹å™¨ID<br></code></pre></td></tr></table></figure><p>å’Œ top å‘½ä»¤æ•ˆæœä¸€æ ·</p><p><strong>æŸ¥çœ‹å®¹å™¨çš„è¿è¡Œæ—¥å¿—</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker logs [options] å®¹å™¨åå­—æˆ–è€…å®¹å™¨ID<br></code></pre></td></tr></table></figure><p>options:</p><ul><li>-t:åŠ å…¥æ—¶é—´æˆ³</li><li>-f:é˜»å¡å®æ—¶æ‰“å°æ—¥å¿—</li><li>â€“tail int:æ‰“å°æ—¥å¿—æœ€ånæ¡</li></ul><p><strong>è¿›å…¥å®¹å™¨å†…éƒ¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec [options] å®¹å™¨åå­—æˆ–è€…å®¹å™¨ID å®¹å™¨å†…å‘½ä»¤<br></code></pre></td></tr></table></figure><p>options:</p><ul><li>-i:ä»¥äº¤äº’å¼è¿è¡Œå®¹å™¨</li><li>-t:åˆ†é…ä¸€ä¸ª tty</li></ul><p>é€šå¸¸è¿™ä¸ªå‘½ä»¤æ˜¯å›ºå®šå†™æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec -it tomcat01 bash<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªé•œåƒæ­è½½ç€ä¸€ä¸ªè½»é‡çº§çš„ linux ç³»ç»Ÿï¼Œæ”¯æŒä¸€äº›å¸¸ç”¨çš„å‘½ä»¤(exité€€å‡º)</p><p><strong>å®¹å™¨ä¸å®¿ä¸»æœºä¼ è¾“æ–‡ä»¶</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å®¿ä¸»æœºæ–‡ä»¶(å¤¹) -&gt; å®¹å™¨</span><br>docker cp å®¿ä¸»æœºæ–‡ä»¶(å¤¹) å®¹å™¨id|åç§°:å®¹å™¨è·¯å¾„<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®¹å™¨ -&gt; å®¿ä¸»æœºæ–‡ä»¶(å¤¹)</span><br>docker cp å®¹å™¨id|åç§°:å®¹å™¨è·¯å¾„ å®¿ä¸»æœºæ–‡ä»¶(å¤¹)<br></code></pre></td></tr></table></figure><p>æ³¨ï¼šå®¿ä¸»æœºæ–‡ä»¶(å¤¹)ä¸€å®šè¦æ˜¯ç»å¯¹è·¯å¾„</p><p>å›åˆ°ä¸Šé¢è®¿é—®å®¿ä¸»æœº 8080 ç«¯å£ 404 é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºå®¹å™¨ä¸­ tomcat&#x2F;webapps ä¸‹æ²¡æœ‰æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©è¿™ä¸ªå‘½ä»¤å°†æœ¬æœºçš„ä¸€äº› war åŒ…ï¼Œæˆ–è€…å®˜ç½‘ tomcat ç›®å½•ä¸‹çš„ä¸œè¥¿æ”¾è¿›å»å³å¯</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs docker">âœ  ~ docker cp ~/<span class="hljs-keyword">env</span>/tomcat/webapps tomcat01:/usr/local/tomcat<br></code></pre></td></tr></table></figure><p>å†æ¬¡è®¿é—®å³å¯å‡ºç°ç»å…¸çš„åŠˆå‰çŒ«</p><p><strong>å®¹å™¨ä¸å®¿ä¸»æœºå…±äº«ç›®å½•</strong></p><p>å°è¯•åˆ é™¤è¿è¡Œçš„tomcatå®¹å™¨ï¼Œä»¥ç›¸åŒçš„æ–¹å¼å†æ¬¡è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå‘ç° webapps ä¸‹ä¾ç„¶æ˜¯ç©ºçš„ï¼Œè¿™è¯´æ˜å®¹å™¨è¢«åˆ é™¤åå®¹å™¨å†…æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«åˆ é™¤ï¼Œå½“ä¸€äº›é‡è¦çš„æ•°æ®æˆ‘ä»¬å°±ä¸èƒ½æ”¾åœ¨å®¹å™¨é‡Œé¢ï¼Œå› æ­¤ docker æä¾›<strong>æ•°æ®å·</strong>çš„åŠŸèƒ½å°†å®¹å™¨çš„ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœºçš„ç›®å½•ï¼Œå®ç°æ•°æ®çš„æŒä¹…åŒ–(æ›´å¤šæ•°æ®å·çš„å†…å®¹è§åé¢çš„é«˜çº§éƒ¨åˆ†)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -v å®¿ä¸»æœºçš„ç»å¯¹è·¯å¾„|ä»»æ„åˆ«å:/å®¹å™¨å†…çš„è·¯å¾„ é•œåƒå<br></code></pre></td></tr></table></figure><ol><li>å¦‚æœæ˜¯å®¿ä¸»æœºè·¯å¾„ï¼šå¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼Œå®¿ä¸»æœºç›®å½•ä¼šè¦†ç›–å®¹å™¨å†…ç›®å½•å†…å®¹</li><li>å¦‚æœæ˜¯åˆ«åï¼šè¿è¡Œå®¹å™¨æ—¶è‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸­åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶å°†å®¹å™¨ç›®å½•æ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœºä¸­ï¼›è‹¥åˆ«åå­˜åœ¨å®¿ä¸»æœºç›®å½•ä¼šè¦†ç›–å®¹å™¨å†…ç›®å½•å†…å®¹</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŒ‚è½½å®¿ä¸»æœºç›®å½•</span><br>âœ  ~ docker run -d -p 8081:8080 --name tomcat04 -v ~/env/tomcat/webapps:/usr/local/tomcat/webapps tomcat:latest<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‡ªåŠ¨åˆ›å»ºæ•°æ®å·(å¦‚æœä¸å­˜åœ¨çš„è¯)</span><br>âœ  ~ docker run -d -p 8083:8080 --name tomcat07 -v v_t:/usr/local/tomcat/webapps tomcat:latest<br></code></pre></td></tr></table></figure><p><strong>æ‰“åŒ…é•œåƒ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker save é•œåƒå -o è·¯å¾„/åç§°.tar<br></code></pre></td></tr></table></figure><p><strong>è½½å…¥é•œåƒ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker load -i åç§°.tar<br></code></pre></td></tr></table></figure><p><strong>å°†å®¹å™¨æ‰“åŒ…æˆé•œåƒ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker commit -m &quot;æè¿°ä¿¡æ¯&quot; -a &quot;ä½œè€…ä¿¡æ¯&quot;   ï¼ˆå®¹å™¨idæˆ–è€…åç§°ï¼‰æ‰“åŒ…çš„é•œåƒåç§°:æ ‡ç­¾<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æäº¤dockerhub(ä¸€èˆ¬ä¸æäº¤ï¼Œéœ€è¦ç™»å½•dockerhub)</span><br>docker push é•œåƒåç§°:æ ‡ç­¾<br></code></pre></td></tr></table></figure><h1 id="ä¸‰ã€docker-é«˜çº§"><a href="#ä¸‰ã€docker-é«˜çº§" class="headerlink" title="ä¸‰ã€docker é«˜çº§"></a>ä¸‰ã€docker é«˜çº§</h1><h2 id="3-1-é•œåƒåŸç†"><a href="#3-1-é•œåƒåŸç†" class="headerlink" title="3.1 é•œåƒåŸç†"></a>3.1 é•œåƒåŸç†</h2><h3 id="3-1-1-ä»€ä¹ˆæ˜¯é•œåƒ"><a href="#3-1-1-ä»€ä¹ˆæ˜¯é•œåƒ" class="headerlink" title="3.1.1 ä»€ä¹ˆæ˜¯é•œåƒ"></a>3.1.1 ä»€ä¹ˆæ˜¯é•œåƒ</h3><p>Docker é•œåƒæ˜¯ä¸€ç§è½»é‡çº§çš„ï¼Œå¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œç”¨æ¥æ‰“åŒ…è½¯ä»¶è¿è¡Œç¯å¢ƒå’ŒåŸºäºè¿è¡Œç¯å¢ƒå¼€å‘çš„è½¯ä»¶ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶æ‰€éœ€çš„åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ã€‚</p><h3 id="3-1-2-ä¸ºä»€ä¹ˆé•œåƒè¿™ä¹ˆå¤§"><a href="#3-1-2-ä¸ºä»€ä¹ˆé•œåƒè¿™ä¹ˆå¤§" class="headerlink" title="3.1.2 ä¸ºä»€ä¹ˆé•œåƒè¿™ä¹ˆå¤§"></a>3.1.2 ä¸ºä»€ä¹ˆé•œåƒè¿™ä¹ˆå¤§</h3><p>å¯ä»¥çœ‹åˆ° docker ä¸­ä¸€ä¸ª tomcat é•œåƒå±…ç„¶é«˜è¾¾ 670Mï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker images                             <br>REPOSITORY       TAG       IMAGE ID       CREATED        SIZE<br>tomcat           latest    eadaf4390f32   29 hours ago   670MB<br>kpretty/tomcat   v1.0      3c447801519f   2 days ago     674MB<br>debian           latest    a331823f8665   2 days ago     118MB<br>hello-world      latest    18e5af790473   6 days ago     9.14kB<br>centos           centos7   dfc30428e163   2 weeks ago    301MB<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ“ä½œç³»ç»Ÿåˆ†ä¸ºå†…æ ¸å’Œç”¨æˆ·ç©ºé—´ã€‚å¯¹äº Linux è€Œè¨€ï¼Œå†…æ ¸å¯åŠ¨åï¼Œä¼šæŒ‚è½½ root æ–‡ä»¶ç³»ç»Ÿä¸ºå…¶æä¾›ç”¨æˆ·ç©ºé—´æ”¯æŒã€‚è€Œ Docker é•œåƒï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ª root æ–‡ä»¶ç³»ç»Ÿã€‚é™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚å› æ­¤å¯¹äº tomcat é•œåƒæ¥è¯´ï¼Œä¸ä»…åŒ…å« tomcat ç¨‹åºåŒ…ï¼Œè¿˜åŒ…å« tomcat è¿è¡Œæ‰€ä¾èµ–çš„æ‰€æœ‰ç¯å¢ƒã€‚</p><h3 id="3-1-3-é•œåƒåŸç†"><a href="#3-1-3-é•œåƒåŸç†" class="headerlink" title="3.1.3 é•œåƒåŸç†"></a>3.1.3 é•œåƒåŸç†</h3><p><strong>UnionFs(è”åˆæ–‡ä»¶ç³»ç»Ÿ)</strong></p><p>UnionFs æ˜¯ä¸€ç§åˆ†å±‚ï¼Œè½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ã€‚UnionFs æ˜¯Docker é•œåƒçš„åŸºç¡€ã€‚è¿™ç§æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§:å°±æ˜¯ä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½• ã€‚</p><blockquote><p>Docker çš„é•œåƒå®é™…æ˜¯ç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆ</p></blockquote><p>bootfsï¼ˆboot file systemï¼‰ä¸»è¦åŒ…å«bootloaderå’Œkernelï¼Œbootloaderä¸»è¦æ˜¯å¼•å¯¼åŠ è½½kernelï¼ŒLinuxåˆšå¯åŠ¨æ—¶ä¼šåŠ è½½bootfsæ–‡ä»¶ç³»ç»Ÿã€‚åœ¨dockeré•œåƒçš„æœ€åº•å±‚å°±æ˜¯bootfsã€‚è¿™ä¸€å±‚ä¸Linux&#x2F;Unix ç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…å«bootåŠ è½½å™¨ï¼ˆbootloaderï¼‰å’Œå†…æ ¸ï¼ˆkernelï¼‰ã€‚å½“bootåŠ è½½å®Œ,åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç”±bootfsè½¬äº¤ç»™å†…æ ¸ï¼Œæ­¤æ—¶ä¼šå¸è½½bootfsã€‚</p><p>rootfsï¼ˆroot file systemï¼‰ï¼Œåœ¨bootfsä¹‹ä¸Šï¼ŒåŒ…å«çš„å°±æ˜¯å…¸å‹çš„linuxç³»ç»Ÿä¸­çš„&#x2F;devï¼Œ&#x2F;procï¼Œ&#x2F;binï¼Œ&#x2F;etcç­‰æ ‡å‡†çš„ç›®å½•å’Œæ–‡ä»¶ã€‚rootfså°±æ˜¯å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼Œæ¯”å¦‚Ubuntu&#x2F;CentOSç­‰ç­‰ã€‚</p><p>æˆ‘ä»¬å¹³æ—¶å®‰è£…è¿›è™šæ‹Ÿæœºçš„centoséƒ½æœ‰1åˆ°å‡ ä¸ªGBï¼Œä¸ºä»€ä¹ˆdockerè¿™é‡Œæ‰200MBï¼Ÿå¯¹äºä¸€ä¸ªç²¾ç®€çš„OSï¼Œrootfså¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…æ‹¬æœ€åŸºæœ¬çš„å‘½ä»¤ï¼Œå·¥å…·ï¼Œå’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ä½¿ç”¨Hostçš„Kernalï¼Œè‡ªå·±åªéœ€è¦æä¾›rootfså°±è¡Œäº†ã€‚ç”±æ­¤å¯è§ä¸åŒçš„linuxå‘è¡Œç‰ˆï¼Œä»–ä»¬çš„bootfsæ˜¯ä¸€è‡´çš„ï¼Œrootfsä¼šæœ‰å·®åˆ«ã€‚å› æ­¤ä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…±ç”¨bootfsã€‚</p><img src="https://s3.jpg.cm/2021/09/30/ImfzH5.png?raw=true" style="zoom:100%;" /><p>ä½†dockerçš„é•œåƒä¸åŒ…å«æ“ä½œç³»ç»Ÿï¼Œå› ä¸ºdockerä¸å®¿ä¸»æœºå…±äº«å†…æ ¸ã€‚</p><h3 id="3-1-4-åˆ†å±‚ç»“æ„"><a href="#3-1-4-åˆ†å±‚ç»“æ„" class="headerlink" title="3.1.4 åˆ†å±‚ç»“æ„"></a>3.1.4 åˆ†å±‚ç»“æ„</h3><p>è¿™ç§åˆ†å±‚ç»“æ„åœ¨ pull é•œåƒæ˜¯ä¼šä½“ç°å‡ºæ¥ï¼Œä¸€ä»½é•œåƒä¼šåˆ†å¥½å‡ å‡ ä¸ªåˆ†æ”¯ä¸‹è½½ï¼ŒåŒæ—¶æœ‰çš„åˆ†æ”¯è¿˜æç¤ºå·²å­˜åœ¨ã€‚</p><p>è¿™ç§åˆ†å±‚ç»“æ„æœ€å¤§çš„å¥½å¤„å°±æ˜¯èµ„æºå…±äº«ï¼Œå¤šä¸ªé•œåƒéƒ½æ˜¯ä»ç›¸åŒçš„ base é•œåƒæ„å»ºè€Œæ¥ï¼Œé‚£ä¹ˆå®¿ä¸»æœºåªéœ€è¦ä¿å­˜ä¸€ä»½ base é•œåƒï¼›åŒæ—¶å†…å­˜ä¹Ÿåªéœ€è¦åŠ è½½ä¸€ä»½ base é•œåƒå³å¯ã€‚</p><h2 id="3-2-ç½‘ç»œåŸç†"><a href="#3-2-ç½‘ç»œåŸç†" class="headerlink" title="3.2 ç½‘ç»œåŸç†"></a>3.2 ç½‘ç»œåŸç†</h2><p>å½“ docker å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ª bridge çš„è™šæ‹Ÿç½‘æ¡¥ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½¯ä»¶äº¤æ¢æœºï¼Œå®ƒä¼šåœ¨æŒ‚è½½åˆ°å®ƒçš„ç½‘å£ä¹‹é—´è¿›è¡Œè½¬å‘ã€‚åŒæ—¶ï¼Œdocker éšæœºåˆ†é…ä¸€ä¸ªæœ¬åœ°æœªå ç”¨çš„ç§æœ‰ç½‘æ®µä¸­çš„ä¸€ä¸ªåœ°å€ç»™ bridge æ¥å£ï¼Œæ­¤åå¯åŠ¨çš„å®¹å™¨å†…çš„ç½‘å£ä¹Ÿä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªåŒç½‘æ®µçš„åœ°å€ã€‚</p><p>å½“åˆ›å»ºä¸€ä¸ª docker å®¹å™¨çš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šåˆ›å»ºä¸€å¯¹ veth pair æ¥å£ï¼Œè¿™ä¸€å¯¹æ¥å£ä¸€æ®µåœ¨å®¹å™¨å†…ä¸º eth0ï¼›å¦ä¸€ç«¯åœ¨æœ¬åœ°è¢«æŒ‚è½½åˆ° bridge ç½‘æ¡¥ä»¥ veth å¼€å¤´ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸»æœºå¯ä»¥è·Ÿå®¹å™¨é€šä¿¡ï¼ŒæŒ‚è½½åœ¨åŒä¸€ç½‘æ¡¥çš„å®¹å™¨ä¹Ÿå¯ä»¥äº’ç›¸é€šä¿¡ï¼Œdockerå°±åˆ›å»ºäº†åœ¨ä¸»æœºå’Œæ‰€æœ‰å®¹å™¨ä¹‹é—´çš„ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œå…±äº«ï¼Œè¿™ç§æ–¹å¼ä¸º<strong>æ¡¥æ¥æ¨¡å¼</strong>ï¼Œæ˜¯dockeré»˜è®¤çš„ç½‘ç»œæ¨¡å¼ä¹Ÿæ˜¯æ¨èçš„ç½‘ç»œæ¨¡å¼ã€‚</p><h3 id="3-2-1-æŸ¥çœ‹ç½‘ç»œä¿¡æ¯"><a href="#3-2-1-æŸ¥çœ‹ç½‘ç»œä¿¡æ¯" class="headerlink" title="3.2.1 æŸ¥çœ‹ç½‘ç»œä¿¡æ¯"></a>3.2.1 æŸ¥çœ‹ç½‘ç»œä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker network ls            <br>NETWORK ID     NAME      DRIVER    SCOPE<br>63893e5e4e77   bridge    bridge    local<br>2c90c0c62179   host      host      local<br>8347580e4ecb   none      null      local<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ bridge å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„é»˜è®¤ç½‘æ¡¥ï¼Œè¿è¡Œå®¹å™¨é»˜è®¤æŒ‚è½½åœ¨è¿™ä¸ªç½‘æ¡¥ä¸Š</p><h3 id="3-2-2-åˆ›å»ºä¸€ä¸ªç½‘æ¡¥"><a href="#3-2-2-åˆ›å»ºä¸€ä¸ªç½‘æ¡¥" class="headerlink" title="3.2.2 åˆ›å»ºä¸€ä¸ªç½‘æ¡¥"></a>3.2.2 åˆ›å»ºä¸€ä¸ªç½‘æ¡¥</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker network create ç½‘æ¡¥åç§°<br></code></pre></td></tr></table></figure><h3 id="3-2-3-åˆ é™¤ä¸€ä¸ªç½‘æ¡¥"><a href="#3-2-3-åˆ é™¤ä¸€ä¸ªç½‘æ¡¥" class="headerlink" title="3.2.3 åˆ é™¤ä¸€ä¸ªç½‘æ¡¥"></a>3.2.3 åˆ é™¤ä¸€ä¸ªç½‘æ¡¥</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker network rm ç½‘æ¡¥åç§°|ID<br></code></pre></td></tr></table></figure><h3 id="3-2-4-æŸ¥çœ‹ç½‘æ¡¥ç»†èŠ‚"><a href="#3-2-4-æŸ¥çœ‹ç½‘æ¡¥ç»†èŠ‚" class="headerlink" title="3.2.4 æŸ¥çœ‹ç½‘æ¡¥ç»†èŠ‚"></a>3.2.4 æŸ¥çœ‹ç½‘æ¡¥ç»†èŠ‚</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker network inspect ç½‘æ¡¥åç§°|ID<br></code></pre></td></tr></table></figure><h3 id="3-2-5-å®¹å™¨ä¹‹é—´é€šä¿¡"><a href="#3-2-5-å®¹å™¨ä¹‹é—´é€šä¿¡" class="headerlink" title="3.2.5 å®¹å™¨ä¹‹é—´é€šä¿¡"></a>3.2.5 å®¹å™¨ä¹‹é—´é€šä¿¡</h3><p>æ ¹æ® docker çš„ç½‘ç»œåŸå› ï¼Œå®ç°å®¹å™¨é—´çš„é€šä¿¡ï¼Œåªéœ€è¦ä¿è¯å®¹å™¨æŒ‚è½½åœ¨ç›¸åŒç½‘æ¡¥ä¸Šå³å¯ï¼Œå…¶å®é»˜è®¤ç›´æ¥å¯åŠ¨å®¹å™¨ä¹‹é—´å°±å¯ä»¥ç›´æ¥é€šä¿¡ï¼Œä½†é€šå¸¸æˆ‘ä»¬ä¼šä¸€ä¸ªä¸šåŠ¡åˆ›å»ºä¸€ä¸ªç½‘æ¡¥ï¼Œå°†ç›¸åŒä¸šåŠ¡çš„å®¹å™¨æŒ‚è½½åˆ°ä¸€ä¸ªç½‘æ¡¥ï¼Œä¸šåŠ¡ä¸ä¸šåŠ¡ä¹‹é—´ç½‘ç»œæ˜¯éš”ç¦»çš„é˜²æ­¢å¹²æ‰°</p><p>åˆ›å»ºä¸€ä¸ªç½‘æ¡¥ docker0 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker network create docker0<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ç½‘æ¡¥ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker network inspect docker0<br>[<br>    &#123;<br>        &quot;Name&quot;: &quot;docker0&quot;,<br>        &quot;Id&quot;: &quot;e283a82de3852629506a0b1e2957560109ca22d49b1c1708d90af17385da7839&quot;,<br>        &quot;Created&quot;: &quot;2021-10-01T09:37:57.434314302Z&quot;,<br>        &quot;Scope&quot;: &quot;local&quot;,<br>        &quot;Driver&quot;: &quot;bridge&quot;,<br>        &quot;EnableIPv6&quot;: false,<br>        &quot;IPAM&quot;: &#123;<br>            &quot;Driver&quot;: &quot;default&quot;,<br>            &quot;Options&quot;: &#123;&#125;,<br>            &quot;Config&quot;: [<br>                &#123;<br>                    &quot;Subnet&quot;: &quot;172.22.0.0/16&quot;,<br>                    &quot;Gateway&quot;: &quot;172.22.0.1&quot;<br>                &#125;<br>            ]<br>        &#125;,<br>        &quot;Internal&quot;: false,<br>        &quot;Attachable&quot;: false,<br>        &quot;Ingress&quot;: false,<br>        &quot;ConfigFrom&quot;: &#123;<br>            &quot;Network&quot;: &quot;&quot;<br>        &#125;,<br>        &quot;ConfigOnly&quot;: false,<br>        &quot;Containers&quot;: &#123;&#125;,<br>        &quot;Options&quot;: &#123;&#125;,<br>        &quot;Labels&quot;: &#123;&#125;<br>    &#125;<br>]<br></code></pre></td></tr></table></figure><p>å‘ç°è¿™ä¸ªç½‘æ¡¥åˆ†é…äº†ä¸€ä¸ª 172.22 çš„å­ç½‘ç«¯ï¼Œä¹‹åæŒ‚è½½åœ¨è¿™ä¸ªç½‘æ¡¥ä¸Šçš„å®¹å™¨éƒ½ä¼šæ˜¯è¿™ä¸ªç½‘æ®µå†…</p><p>è¿è¡Œå®¹å™¨æŒ‡å®šæŒ‚è½½çš„ç½‘æ¡¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker run -d -p 8080:8080 --name tomcat01 --network docker0 tomcat:latest<br>c17deed4f99312568f8189217b78254f58f27fc992e019bce90f2e908d4a3f07<br>âœ  ~ docker run -d -p 8081:8080 --name tomcat02 --network docker0 tomcat:latest<br>ab4b13fd2b78f7610a1d71d3b1ea4a26bac82fde15fbd025bdcd07e69c6bc5c2<br></code></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥çœ‹ç½‘æ¡¥ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ docker network inspect docker0                                            <br>[<br>    &#123;<br>        &quot;Name&quot;: &quot;docker0&quot;,<br>        &quot;Id&quot;: &quot;e283a82de3852629506a0b1e2957560109ca22d49b1c1708d90af17385da7839&quot;,<br>        &quot;Created&quot;: &quot;2021-10-01T09:37:57.434314302Z&quot;,<br>        &quot;Scope&quot;: &quot;local&quot;,<br>        &quot;Driver&quot;: &quot;bridge&quot;,<br>        &quot;EnableIPv6&quot;: false,<br>        &quot;IPAM&quot;: &#123;<br>            &quot;Driver&quot;: &quot;default&quot;,<br>            &quot;Options&quot;: &#123;&#125;,<br>            &quot;Config&quot;: [<br>                &#123;<br>                    &quot;Subnet&quot;: &quot;172.22.0.0/16&quot;,<br>                    &quot;Gateway&quot;: &quot;172.22.0.1&quot;<br>                &#125;<br>            ]<br>        &#125;,<br>        &quot;Internal&quot;: false,<br>        &quot;Attachable&quot;: false,<br>        &quot;Ingress&quot;: false,<br>        &quot;ConfigFrom&quot;: &#123;<br>            &quot;Network&quot;: &quot;&quot;<br>        &#125;,<br>        &quot;ConfigOnly&quot;: false,<br>        &quot;Containers&quot;: &#123;<br>            &quot;ab4b13fd2b78f7610a1d71d3b1ea4a26bac82fde15fbd025bdcd07e69c6bc5c2&quot;: &#123;<br>                &quot;Name&quot;: &quot;tomcat02&quot;,<br>                &quot;EndpointID&quot;: &quot;61e0436bc9b437eb65989b2a1de22d44cae6dcea8cff862b97308167d9f7988a&quot;,<br>                &quot;MacAddress&quot;: &quot;02:42:ac:16:00:03&quot;,<br>                &quot;IPv4Address&quot;: &quot;172.22.0.3/16&quot;,<br>                &quot;IPv6Address&quot;: &quot;&quot;<br>            &#125;,<br>            &quot;c17deed4f99312568f8189217b78254f58f27fc992e019bce90f2e908d4a3f07&quot;: &#123;<br>                &quot;Name&quot;: &quot;tomcat01&quot;,<br>                &quot;EndpointID&quot;: &quot;beb19cd9621e9cd98a8654555a59b8753b3d014c788f229d76f320569dab264d&quot;,<br>                &quot;MacAddress&quot;: &quot;02:42:ac:16:00:02&quot;,<br>                &quot;IPv4Address&quot;: &quot;172.22.0.2/16&quot;,<br>                &quot;IPv6Address&quot;: &quot;&quot;<br>            &#125;<br>        &#125;,<br>        &quot;Options&quot;: &#123;&#125;,<br>        &quot;Labels&quot;: &#123;&#125;<br>    &#125;<br>]<br></code></pre></td></tr></table></figure><p>ä¸¤ä¸ªå®¹å™¨åˆ†åˆ«è¢«åˆ†é…äº† 172.22.0.3ã€172.22.0.2ï¼Œä¸‹é¢è¿›å…¥å…¶ä¸­ä¸€ä¸ªå®¹å™¨ curl å¦ä¸€ä¸ªå®¹å™¨çš„8080ç«¯å£(å› ä¸ºtomcatæ„å»ºçš„å®¹å™¨åªæ”¯æŒåŸºæœ¬çš„ä¸€äº›å‘½ä»¤ï¼Œæ²¡æœ‰ping)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@c17deed4f993:/usr/local/tomcat# curl http://172.22.0.3:8080<br></code></pre></td></tr></table></figure><p>åŒæ—¶ docker ä¼šè‡ªåŠ¨çš„å¯¹å®¹å™¨çš„åç§°å’Œipåšæ˜ å°„ï¼Œå³ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@c17deed4f993:/usr/local/tomcat# curl http://tomcat02:8080<br></code></pre></td></tr></table></figure><h2 id="3-3-æ•°æ®å·"><a href="#3-3-æ•°æ®å·" class="headerlink" title="3.3 æ•°æ®å·"></a>3.3 æ•°æ®å·</h2><p>æ•°æ®å·æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œå®ƒç»•è¿‡ UFSï¼Œå¯ä»¥æä¾›å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼š</p><ol><li>æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨</li><li>å¯¹æ•°æ®å·çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ</li><li>å¯¹æ•°æ®å·çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ</li><li>æ•°æ®å·é»˜è®¤è¿˜ä¸€ç›´å­˜åœ¨ï¼Œé›†å¸‚å®¹å™¨è¢«åˆ é™¤</li></ol><blockquote><p>æ•°æ®å·çš„ä½¿ç”¨ï¼Œç±»ä¼¼ Liunx ä¸‹å¯¹ç›®å½•æˆ–è€…æ–‡ä»¶è¿›è¡Œ mountï¼Œé•œåƒä¸­çš„è¢«æŒ‡å®šä¸ºæŒ‚è½½ç‚¹çš„ç›®å½•ä¸­çš„æ–‡ä»¶æ¢å¤è‡³åˆ°æ•°æ®å·ä¸­(ä»…æ•°æ®å·ä¸ºç©º)</p></blockquote><h3 id="3-3-1-åˆ›å»ºæ•°æ®å·"><a href="#3-3-1-åˆ›å»ºæ•°æ®å·" class="headerlink" title="3.3.1 åˆ›å»ºæ•°æ®å·"></a>3.3.1 åˆ›å»ºæ•°æ®å·</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker volume create æ•°æ®å·åç§°<br></code></pre></td></tr></table></figure><h3 id="3-3-2-æŸ¥çœ‹æ•°æ®å·"><a href="#3-3-2-æŸ¥çœ‹æ•°æ®å·" class="headerlink" title="3.3.2 æŸ¥çœ‹æ•°æ®å·"></a>3.3.2 æŸ¥çœ‹æ•°æ®å·</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker volume inspect æ•°æ®å·åç§°|ID<br>å¦‚ï¼š<br>âœ  ~ docker volume inspect volume1 <br>[<br>    &#123;<br>        &quot;CreatedAt&quot;: &quot;2021-10-01T11:43:33Z&quot;,<br>        &quot;Driver&quot;: &quot;local&quot;,<br>        &quot;Labels&quot;: &#123;&#125;,<br>        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/volume1/_data&quot;,<br>        &quot;Name&quot;: &quot;volume1&quot;,<br>        &quot;Options&quot;: &#123;&#125;,<br>        &quot;Scope&quot;: &quot;local&quot;<br>    &#125;<br>]<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼ŒMountpoint ä¸ºæŒ‚è½½åœ¨å®¿ä¸»æœºçš„ç›®å½•</p><h3 id="3-3-3-æŒ‚è½½æ•°æ®å·"><a href="#3-3-3-æŒ‚è½½æ•°æ®å·" class="headerlink" title="3.3.3 æŒ‚è½½æ•°æ®å·"></a>3.3.3 æŒ‚è½½æ•°æ®å·</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">~ docker run -d -p 8081:8080 --name tomcat03 -v volume01:/usr/local/tomcat/webapps/ tomcat:latest<br></code></pre></td></tr></table></figure><h3 id="3-3-4-åˆ é™¤æ•°æ®å·"><a href="#3-3-4-åˆ é™¤æ•°æ®å·" class="headerlink" title="3.3.4 åˆ é™¤æ•°æ®å·"></a>3.3.4 åˆ é™¤æ•°æ®å·</h3><p>æ­£åœ¨è¢«ä½¿ç”¨çš„æ•°æ®å·æ— æ³•è¢«åˆ é™¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker volume rm æ•°æ®å·åç§°|ID<br></code></pre></td></tr></table></figure><h3 id="3-3-5-Macä¸‹çš„æ•°æ®å·"><a href="#3-3-5-Macä¸‹çš„æ•°æ®å·" class="headerlink" title="3.3.5 Macä¸‹çš„æ•°æ®å·"></a>3.3.5 Macä¸‹çš„æ•°æ®å·</h3><p>Linuxä¸‹æ•°æ®å·çš„Mountpointè·¯å¾„çœŸå®å­˜åœ¨ï¼Œç›´æ¥ cd å³å¯çœ‹åˆ°å®¹å™¨å†…çš„æ–‡ä»¶ï¼Œä½†å¯¹äº mac æ¥è¯´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ cd /var/lib/docker/volumes/volume1/_data  <br>cd: no such file or directory: /var/lib/docker/volumes/volume1/_data<br></code></pre></td></tr></table></figure><p>ç½‘ä¸Šå¾ˆå¤šäººç»™çš„æ–¹æ³•æ˜¯é€šè¿‡ screenï¼Œå¦‚æ•°æ®å·ä¼šè¢«æ”¾åœ¨ä¸‹é¢çš„ tty ä¸­ï¼Œä½†å®é™…æ˜¯æ²¡æœ‰çš„ï¼Œå¾ˆå¤šäººä¹Ÿåé¦ˆæ²¡æœ‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  ~ cd Library/Containers/com.docker.docker/Data/vms/0/<br>âœ  0 pwd                  <br>/Users/wjun/Library/Containers/com.docker.docker/Data/vms/0<br>âœ  0 ll<br>total 0<br>srwxr-xr-x  1 wjun  staff   0  9 28 14:45 00000002.00001003<br>srwxr-xr-x  1 wjun  staff   0  9 28 14:45 console.sock<br>drwxr-xr-x@ 3 wjun  staff  96  9 30 11:12 data<br>drwxr-xr-x  2 wjun  staff  64  9 27 18:30 log<br></code></pre></td></tr></table></figure><p>ç»è¿‡ä¸æ‡ˆåŠªåŠ›ç»ˆäºåœ¨å¢™å¤–æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh<br></code></pre></td></tr></table></figure><p>è¿è¡Œè¿™ä¸ªé•œåƒï¼Œè¿›å…¥å®¹å™¨ä¸­ cd åˆ°æŒ‡å®šè·¯å¾„å°±èƒ½çœ‹åˆ° mac çš„æŒ‚è½½ç‚¹</p><h1 id="å››ã€Dockerfile"><a href="#å››ã€Dockerfile" class="headerlink" title="å››ã€Dockerfile"></a>å››ã€Dockerfile</h1><p>Dockerfile æ˜¯ Docker é•œåƒçš„æè¿°æ–‡ä»¶ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ï¼Œä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥æ„å»º docker é•œåƒçš„æ„å»ºæ–‡ä»¶ã€‚</p><h2 id="4-1-Dockerfileè§£æè¿‡ç¨‹"><a href="#4-1-Dockerfileè§£æè¿‡ç¨‹" class="headerlink" title="4.1 Dockerfileè§£æè¿‡ç¨‹"></a>4.1 Dockerfileè§£æè¿‡ç¨‹</h2><p>é€šå¸¸è¿™ä¸ªæè¿°æ–‡ä»¶å°±å« Dockerfileï¼Œè¯¥æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ç§°ä¹‹ä¸º docker çš„ä¸Šä¸‹æ–‡ç›®å½•ï¼Œå½“åŸºäº Dockerfile å¼€å§‹æ„å»ºé•œåƒæ—¶ï¼Œé¦–å…ˆå°†ä¸Šä¸‹æ–‡ç›®å½•é‡Œçš„æ‰€æœ‰æ–‡ä»¶å‘é€ç»™ docker serverï¼Œåœ¨æœåŠ¡ç«¯å®Œæˆæ„å»ºï¼›åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­ï¼ŒDockerfile ä¸­æ¯ä¸€ä¸ªå‘½ä»¤éƒ½ä¼šç”Ÿæˆä¸€ä¸ªé•œåƒå±‚ï¼Œä¸‹ä¸€ä¸ªçš„å‘½ä»¤åŸºäºä¸Šä¸€ä¸ªå‘½ä»¤ç”Ÿæˆçš„é•œåƒç»§ç»­æ„å»ºï¼Œå½¢æˆä¸€ä¸ªä¸ªçš„é•œåƒå±‚ï¼ŒåŒæ—¶æ¯ä¸ªé•œåƒå±‚éƒ½ä¼šè¢«ç¼“å­˜ï¼Œå½“é‡åˆ°ç›¸åŒçš„å‘½ä»¤ä¼šç›´æ¥ä½¿ç”¨ï¼Œæœ€ç»ˆæ„å»ºå®Œæˆåä½“ç°ç»™ç”¨æˆ·çš„åªæœ‰æœ€ç»ˆçš„é•œåƒã€‚</p><p>æ ¹æ®ä¸Šé¢çš„è§£é‡Šï¼Œä¸€èˆ¬åœ¨æ„å»ºé•œåƒæ—¶ä¼šæ–°å»ºä¸€ä¸ªç©ºç™½ç›®å½•ï¼Œè¯¥ç›®å½•ä»…æ”¾ç½® Dockerfile å’Œä¸æ„å»ºé•œåƒæ‰€å¿…é¡»çš„æ–‡ä»¶ï¼›æ— å…³ç´§è¦çš„æ–‡ä»¶ä¼šå½±å“æ„å»ºé€Ÿåº¦ï¼Œä½† docker ä¹Ÿæä¾›ç±»ä¼¼ gitignore çš„ä½œç”¨ï¼Œåœ¨ä¸Šä¸‹æ–‡ç›®å½•ä¸­æ–°å»º .dockerignore æ–‡ä»¶ï¼Œdocker ä¼šå¿½ç•¥è¯¥æ–‡ä»¶é‡Œé¢æŒ‡å®šçš„å†…å®¹ã€‚</p><img src="https://s3.jpg.cm/2021/10/01/ImyooX.png?raw=true" style="zoom:100%;" /><h2 id="4-2-Dockerfileä¿ç•™å‘½ä»¤"><a href="#4-2-Dockerfileä¿ç•™å‘½ä»¤" class="headerlink" title="4.2 Dockerfileä¿ç•™å‘½ä»¤"></a>4.2 Dockerfileä¿ç•™å‘½ä»¤</h2><p>å¸¸ç”¨å‘½ä»¤å¦‚ä¸‹(å®˜æ–¹è¯´æ˜ï¼š<a href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a>)</p><table><thead><tr><th>ä¿ç•™å­—</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>FROM</strong></td><td><strong>å½“å‰é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„</strong> <code>ç¬¬ä¸€ä¸ªæŒ‡ä»¤å¿…é¡»æ˜¯FROM</code></td></tr><tr><td>MAINTAINER</td><td>é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€</td></tr><tr><td><strong>RUN</strong></td><td><strong>æ„å»ºé•œåƒæ—¶éœ€è¦è¿è¡Œçš„æŒ‡ä»¤</strong></td></tr><tr><td><strong>EXPOSE</strong></td><td><strong>å½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£å·</strong></td></tr><tr><td><strong>WORKDIR</strong></td><td><strong>æŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»å½•è¿›æ¥çš„å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹</strong></td></tr><tr><td><strong>ENV</strong></td><td><strong>ç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡</strong></td></tr><tr><td><strong>ADD</strong></td><td><strong>å°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ADDå‘½ä»¤ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹taråŒ…</strong></td></tr><tr><td><strong>COPY</strong></td><td><strong>ç±»ä¼¼äºADDï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­<br/>å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­&lt;åŸè·¯å¾„&gt;çš„æ–‡ä»¶&#x2F;ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„&lt;ç›®æ ‡è·¯å¾„&gt;ä½ç½®</strong></td></tr><tr><td><strong>VOLUME</strong></td><td><strong>å®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œ</strong></td></tr><tr><td><strong>CMD</strong></td><td><strong>æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤<br/>Dockerfileä¸­å¯ä»¥æœ‰å¤šä¸ªCMDæŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMDä¼šè¢«docker runä¹‹åçš„å‚æ•°æ›¿æ¢</strong></td></tr><tr><td><strong>ENTRYPOINT</strong></td><td><strong>æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤<br/>ENTRYPOINTçš„ç›®çš„å’ŒCMDä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºåŠå…¶å‚æ•°</strong></td></tr></tbody></table><blockquote><p>ä¸Šè¿°å‘½ä»¤å¿…é¡»å¤§å†™</p></blockquote><h3 id="4-2-1-FROM"><a href="#4-2-1-FROM" class="headerlink" title="4.2.1 FROM"></a>4.2.1 FROM</h3><p>åŸºäºå“ªä¸ªé•œåƒè¿›è¡Œæ„å»ºæ–°çš„é•œåƒï¼Œåœ¨æ„å»ºä¸­åŸºäºçš„é•œåƒä¼šè‡ªåŠ¨ä»dockerhubè¿›è¡Œæ‹‰å–ï¼Œä¸”å¿…é¡»ä¿è¯è¯¥å‘½ä»¤ä½œä¸º Dockerfile ç¬¬ä¸€ä¸ªæŒ‡ä»¤å‡ºç°</p><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> &lt;image&gt;[:&lt;tag&gt;]<br></code></pre></td></tr></table></figure><p>TAG ä¸å†™é»˜è®¤ latest</p><h3 id="4-2-2-MAINTAINER"><a href="#4-2-2-MAINTAINER" class="headerlink" title="4.2.2 MAINTAINER"></a>4.2.2 MAINTAINER</h3><p>é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€[åºŸå¼ƒ]</p><p>è¯­æ³•ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">MAINTAINER</span> &lt;name&gt;<br></code></pre></td></tr></table></figure><h3 id="4-2-3-RUN"><a href="#4-2-3-RUN" class="headerlink" title="4.2.3 RUN"></a>4.2.3 RUN</h3><p>RUN æŒ‡å®šå°†åœ¨å½“å‰é•œåƒå±‚ä¸­æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤å¹¶æäº¤ç»“æœï¼Œå…¶æ ¼å¼æœ‰ä¸¤ç§ shell å’Œ exec</p><p>shellï¼šRUN &lt;å‘½ä»¤&gt;å¦‚ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello docker&quot;</span> &gt;&gt; /README</span><br></code></pre></td></tr></table></figure><p>exec: RUN [â€œå¯æ‰§è¡Œæ–‡ä»¶â€,â€å‚æ•°1â€,â€å‚æ•°2â€,â€¦]å¦‚ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">RUN</span><span class="language-bash"> [<span class="hljs-string">&quot;echo&quot;</span>,<span class="hljs-string">&quot;&#x27;hello docker&#x27;&quot;</span>,<span class="hljs-string">&quot;&gt;&gt;&quot;</span>,<span class="hljs-string">&quot;/README&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>æ³¨ï¼šä¸Šé¢è¯´è¿‡æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šæ„å»ºä¸€å±‚å› æ­¤ä¸å»ºè®®å†™å¤šä¸ª RUNï¼Œå¤šä¸ª RUN çš„ç»“æœä¼šæ˜¾å¾—è‡ƒè‚¿ã€å½¢æˆéå¸¸å¤šçš„é•œåƒå±‚ï¼Œä¸ä»…å¢åŠ äº†é•œåƒæ„å»ºçš„æ—¶é—´ï¼Œä¹Ÿå®¹æ˜“å‡ºé”™ï¼ŒåŒæ—¶ UnionFs æœ‰æœ€å¤§å±‚çš„æ˜¾ç¤ºï¼Œç°ç‰ˆæœ¬æ˜¯ 127 å±‚ï¼›è¦æ—¶åˆ»æé†’è‡ªå·± Dockerfile ä¸æ˜¯åœ¨å†™ shell è„šæœ¬ï¼Œè€Œæ˜¯å®šä¹‰æ¯ä¸€å±‚çš„æ„å»ºè§„åˆ™ï¼›å¯¹äºå¤šæ¡ shell å‚è€ƒå†™æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> debian:stretch<br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">set</span> -x; buildDeps=<span class="hljs-string">&#x27;gcc libc6-dev make wget&#x27;</span> \</span><br><span class="language-bash">    &amp;&amp; apt-get update \</span><br><span class="language-bash">    &amp;&amp; apt-get install -y <span class="hljs-variable">$buildDeps</span> \</span><br><span class="language-bash">    &amp;&amp; wget -O redis.tar.gz <span class="hljs-string">&quot;http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;</span> \</span><br><span class="language-bash">    &amp;&amp; <span class="hljs-built_in">mkdir</span> -p /usr/src/redis \</span><br><span class="language-bash">    &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \</span><br><span class="language-bash">    &amp;&amp; make -C /usr/src/redis \</span><br><span class="language-bash">    &amp;&amp; make -C /usr/src/redis install \</span><br><span class="language-bash">    &amp;&amp; <span class="hljs-built_in">rm</span> -rf /var/lib/apt/lists/* \</span><br><span class="language-bash">    &amp;&amp; <span class="hljs-built_in">rm</span> redis.tar.gz \</span><br><span class="language-bash">    &amp;&amp; <span class="hljs-built_in">rm</span> -r /usr/src/redis \</span><br><span class="language-bash">    &amp;&amp; apt-get purge -y --auto-remove <span class="hljs-variable">$buildDeps</span></span><br></code></pre></td></tr></table></figure><blockquote><p>stretch æ˜¯ä¸€ä¸ªç©ºç™½é•œåƒï¼ŒåŸºäºæ­¤é•œåƒæ„å»ºæ„å‘³ç€ä½ ä¸ä»¥ä»»ä½•é•œåƒä¸ºåŸºç¡€ï¼Œæ„å‘³ç€ä½ çš„é•œåƒå¹¶ä¸éœ€è¦æœ‰æ“ä½œç³»ç»Ÿæä¾›è¿è¡Œæ—¶æ”¯æŒï¼Œæ‰€éœ€çš„ä¸€åˆ‡åº“éƒ½å·²ç»åœ¨å¯æ‰§è¡Œæ–‡ä»¶é‡Œäº†ï¼Œå› æ­¤ç›´æ¥ <code>FROM scratch</code> ä¼šè®©é•œåƒä½“ç§¯æ›´åŠ å°å·§</p></blockquote><h3 id="4-2-4-EXPOSE"><a href="#4-2-4-EXPOSE" class="headerlink" title="4.2.4 EXPOSE"></a>4.2.4 EXPOSE</h3><p>ç”¨äºå£°æ˜æ„å»ºçš„é•œåƒåœ¨è¿è¡Œä¸ºå®¹å™¨æ—¶å¯¹å¤–æš´éœ²çš„ç«¯å£ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå£°æ˜ï¼Œåœ¨å®¹å™¨è¿è¡Œæ—¶ä¸ä¼šå› ä¸ºè¿™è€Œäº§ç”Ÿä»»ä½•å½±å“ï¼Œè¯¥å‘½ä»¤çš„å¥½å¤„æ˜¯ï¼šå¸®åŠ©é•œåƒä½¿ç”¨è€…ç†è§£è¿™ä¸ªé•œåƒæœåŠ¡å®ˆæŠ¤ç«¯å£ï¼Œä¸€æ–¹é¢é…ç½®æ˜ å°„ï¼ŒåŒæ—¶åœ¨è¿è¡Œæ˜¯éšæœºç«¯å£æ˜ å°„(-P)ï¼Œä¼šè‡ªåŠ¨éšæœºæ˜ å°„ EXPOSE çš„ç«¯å£</p><p>è¯­æ³•ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span> <span class="hljs-comment"># é»˜è®¤ TCP</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span>/tcp<br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span>/udp<br></code></pre></td></tr></table></figure><h3 id="4-2-5-ENV"><a href="#4-2-5-ENV" class="headerlink" title="4.2.5 ENV"></a>4.2.5 ENV</h3><p>ç”¨æ¥ä¸ºæ„å»ºé•œåƒè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè¯¥å€¼å¯ä»¥åœ¨å‡ºç°åœ¨åç»­æŒ‡ä»¤ç¯å¢ƒä¸­ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENV</span> key value<br><span class="hljs-keyword">ENV</span> key=value<br><span class="hljs-keyword">ENV</span> k1=Â· k2=v2 k3=v3<br></code></pre></td></tr></table></figure><p>å¦‚å®˜æ–¹ node é•œåƒå°±å‡ºç°ç±»ä¼¼ä»£ç </p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENV</span> NODE_VERSION <span class="hljs-number">7.2</span>.<span class="hljs-number">0</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> curl -SLO <span class="hljs-string">&quot;https://nodejs.org/dist/v<span class="hljs-variable">$NODE_VERSION</span>/node-v<span class="hljs-variable">$NODE_VERSION</span>-linux-x64.tar.xz&quot;</span> \</span><br><span class="language-bash">  &amp;&amp; curl -SLO <span class="hljs-string">&quot;https://nodejs.org/dist/v<span class="hljs-variable">$NODE_VERSION</span>/SHASUMS256.txt.asc&quot;</span> \</span><br><span class="language-bash">  &amp;&amp; gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \</span><br><span class="language-bash">  &amp;&amp; grep <span class="hljs-string">&quot; node-v<span class="hljs-variable">$NODE_VERSION</span>-linux-x64.tar.xz\$&quot;</span> SHASUMS256.txt | <span class="hljs-built_in">sha256sum</span> -c - \</span><br><span class="language-bash">  &amp;&amp; tar -xJf <span class="hljs-string">&quot;node-v<span class="hljs-variable">$NODE_VERSION</span>-linux-x64.tar.xz&quot;</span> -C /usr/local --strip-components=1 \</span><br><span class="language-bash">  &amp;&amp; <span class="hljs-built_in">rm</span> <span class="hljs-string">&quot;node-v<span class="hljs-variable">$NODE_VERSION</span>-linux-x64.tar.xz&quot;</span> SHASUMS256.txt.asc SHASUMS256.txt \</span><br><span class="language-bash">  &amp;&amp; <span class="hljs-built_in">ln</span> -s /usr/local/bin/node /usr/local/bin/nodejs</span><br></code></pre></td></tr></table></figure><h3 id="4-2-6-WORKDIR"><a href="#4-2-6-WORKDIR" class="headerlink" title="4.2.6 WORKDIR"></a>4.2.6 WORKDIR</h3><p>ç”¨äºä¸º Dockerfile ä¸­åç»­æŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ï¼Œå¦‚æœ WORKDIR æŒ‡å®šçš„ç›®å½•ä¸å­˜åœ¨ä¼šè¢«è‡ªåŠ¨åˆ›å»º</p><p>è¯­æ³•ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> PATH</span><br></code></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤çš„å¥½å¤„å¦‚ä¸‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">cd</span> /app</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello&quot;</span> &gt; world.txt</span><br></code></pre></td></tr></table></figure><p>åŸºäºä¸Šè¿°æ„å»ºå®Œçš„é•œåƒå‘ç°å¹¶æ²¡æœ‰ &#x2F;app&#x2F;world.txt æ–‡ä»¶ï¼Œå› ä¸ºæ¯ä¸ªå‘½ä»¤éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªé•œåƒå±‚ï¼Œç¬¬ä¸€ä¸ª RUN ä»…ä»…æ˜¯ä¸€ä¸ªå†…å­˜ä¸Šçš„å˜åŒ–ï¼Œä¸ä¼šå¯¹æ–‡ä»¶äº§ç”Ÿä»»ä½•å½±å“ï¼Œåˆ°ç¬¬äºŒå±‚åˆæ˜¯ä¸€ä¸ªæ–°çš„é•œåƒå±‚è‡ªç„¶ä¸ä¼šç»§æ‰¿ä¸Šä¸€å±‚çš„å†…å­˜å˜åŒ–ï¼Œè€Œ WORKDIR ä¼šæ”¹å˜ä»¥åå„å±‚çš„å·¥ä½œç›®å½•ä½ç½®ï¼Œå¤šä¸ª WORKDIR ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œåˆ™è¯¥è·¯å¾„ä¸ä¹‹å‰ WORKDIR çš„è·¯å¾„ç›¸å¯¹å³ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /a</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> b</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> c</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">pwd</span></span><br></code></pre></td></tr></table></figure><p>RUN pwd çš„å·¥ä½œè·¯å¾„æ˜¯ &#x2F;a&#x2F;b&#x2F;c</p><h3 id="4-2-7-COPY"><a href="#4-2-7-COPY" class="headerlink" title="4.2.7 COPY"></a>4.2.7 COPY</h3><p>ç”¨äºå°†ä¸Šä¸‹æ–‡æŒ‡å®šçš„æ–‡ä»¶(å¤¹)å¤åˆ¶åˆ°é•œåƒçš„æŒ‡å®šç›®å½•ä¸­</p><p>è¯­æ³•ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">COPY</span><span class="language-bash"> src dest</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> [<span class="hljs-string">&quot;src&quot;</span>,...,<span class="hljs-string">&quot;dest&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>å…¶ src æ”¯æŒç»Ÿé…ç¬¦ï¼Œå…¶é€šé…è§„åˆ™æ»¡è¶³ Go çš„ filepath.Mathï¼Œæ­¤å¤– COPY ä¼šä¿ç•™æºæ–‡ä»¶çš„å„ç§å…ƒæ•°æ®ä¿¡æ¯å¦‚ï¼šè¯»å†™æƒé™ï¼Œç”¨æˆ·ç”¨æˆ·ç»„ï¼Œä¿®æ”¹æ—¶é—´ç­‰ï¼›è‹¥è¦ä¿®æ”¹è¯¥æ·»åŠ  â€“chown å¦‚ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">COPY</span><span class="language-bash"> --<span class="hljs-built_in">chown</span>=55:mygroup files* /mydir/</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --<span class="hljs-built_in">chown</span>=bin files* /mydir/</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --<span class="hljs-built_in">chown</span>=1 files* /mydir/</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --<span class="hljs-built_in">chown</span>=10:11 files* /mydir/</span><br></code></pre></td></tr></table></figure><blockquote><p>å¦‚æœæºè·¯å¾„ä¸ºæ–‡ä»¶å¤¹ï¼Œå¤åˆ¶çš„æ—¶å€™ä¸æ˜¯ç›´æ¥å¤åˆ¶è¯¥æ–‡ä»¶å¤¹ï¼Œè€Œæ˜¯å°†æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„ã€‚</p></blockquote><h3 id="4-2-8-ADD"><a href="#4-2-8-ADD" class="headerlink" title="4.2.8 ADD"></a>4.2.8 ADD</h3><p>æ›´é«˜çº§çš„ COPYï¼Œç”¨äºä»ä¸Šä¸‹æ–‡ä¸­å¤åˆ¶æ–‡ä»¶ï¼Œæ”¯æŒé“¾æ¥ä¸‹è½½ï¼Œè‡ªåŠ¨è§£å‹å‹ç¼©åŒ…</p><p>è¯­æ³•ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ADD</span><span class="language-bash"> hom* /mydir/       é€šé…ç¬¦æ·»åŠ å¤šä¸ªæ–‡ä»¶</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> hom?.txt /mydir/   é€šé…ç¬¦æ·»åŠ </span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> test.txt relativeDir/  å¯ä»¥æŒ‡å®šç›¸å¯¹è·¯å¾„</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> test.txt /absoluteDir/ ä¹Ÿå¯ä»¥æŒ‡å®šç»å¯¹è·¯å¾„</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> url </span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¯¥è¯­æ³•è¯­ä¹‰ä¸æ˜ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼›è¯¥è¯­æ³•ä»…é™éœ€è¦è‡ªåŠ¨è§£å‹çš„åœºåˆä½¿ç”¨ï¼Œè¯¥è¯­æ³•å¯ä»¥è¢« COPY é…åˆ RUN æ›¿ä»£</p><h3 id="4-2-9-VOLUME"><a href="#4-2-9-VOLUME" class="headerlink" title="4.2.9 VOLUME"></a>4.2.9 VOLUME</h3><p>åœ¨æ•°æ®å·ç« èŠ‚è¯´è¿‡ï¼Œå®¹å™¨ä¸­é‡è¦çš„æ•°æ®éœ€è¦æŒ‚è½½åˆ°å®¿ä¸»æœºå®ç°æŒä¹…åŒ–ï¼Œè¯¥å‘½ä»¤å¯ä»¥åœ¨è¿è¡Œå®¹å™¨ä¸”æ²¡æœ‰æŒ‡å®šæ•°æ®å·æ—¶è‡ªåŠ¨å°† VOLUME æŒ‡å®šçš„æ–‡ä»¶ç›®å½•æŒ‚è½½åˆ°ä¸€ä¸ªè‡ªåŠ¨åˆ›å»ºçš„åŒ¿åæ•°æ®å·ä¸­ï¼Œå½“ç„¶åœ¨è¿è¡Œæ—¶æŒ‡å®š -v ä¼šè¦†ç›–è¿™ä¸ªå‘½ä»¤</p><p>æ ¼å¼</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">VOLUME</span><span class="language-bash"> path</span><br></code></pre></td></tr></table></figure><h3 id="4-2-10-CMD"><a href="#4-2-10-CMD" class="headerlink" title="4.2.10 CMD"></a>4.2.10 CMD</h3><p>ç”¨äºå¯åŠ¨å®¹å™¨æŒ‡å®šæ‰§è¡Œçš„å‘½ä»¤ï¼Œåœ¨ Dockerfile ä¸­åªèƒ½æœ‰ä¸€æ¡ CMDï¼Œå¤šæ¡å‘½ä»¤åªæœ‰æœ€åä¸€æ¡ç”Ÿæ•ˆ</p><p>è¯­æ³•æ ¼å¼ä¸ RUN ä¸€è‡´ï¼Œåœ¨æŒ‡ä»¤æ ¼å¼ä¸Šæ¨èä½¿ç”¨ exec æ ¼å¼ï¼Œå¦‚æœä½¿ç”¨ shell æ ¼å¼å®é™…å‘½ä»¤ä¼šè¢«åŒ…è£…æˆ sh -c çš„å‚æ•°è¿›è¡Œæ‰§è¡Œå¦‚ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span></span><br><span class="hljs-comment"># å®é™…ä¸Š</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [ <span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;echo <span class="hljs-variable">$PATH</span>&quot;</span> ]</span><br></code></pre></td></tr></table></figure><p>æåˆ° CMD å°±ä¸å¾—ä¸æå®¹å™¨ä¸­åº”ç”¨åœ¨å‰å°æ‰§è¡Œå’Œåå°æ‰§è¡Œçš„é—®é¢˜ã€‚è¿™æ˜¯åˆå­¦è€…å¸¸å‡ºç°çš„ä¸€ä¸ªæ··æ·†ã€‚Docker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨ä¸­çš„åº”ç”¨éƒ½åº”è¯¥ä»¥å‰å°æ‰§è¡Œï¼Œè€Œä¸æ˜¯åƒè™šæ‹Ÿæœºã€ç‰©ç†æœºé‡Œé¢é‚£æ ·ï¼Œç”¨ systemd å»å¯åŠ¨åå°æœåŠ¡ï¼Œå®¹å™¨å†…æ²¡æœ‰åå°æœåŠ¡çš„æ¦‚å¿µã€‚</p><p>ä¸€äº›åˆå­¦è€…å°† CMD å†™ä¸ºï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">CMD</span><span class="language-bash"> service nginx start</span><br></code></pre></td></tr></table></figure><p>ç„¶åå‘ç°å®¹å™¨æ‰§è¡Œåå°±ç«‹å³é€€å‡ºäº†ã€‚ç”šè‡³åœ¨å®¹å™¨å†…å»ä½¿ç”¨ systemctl å‘½ä»¤ç»“æœå´å‘ç°æ ¹æœ¬æ‰§è¡Œä¸äº†ã€‚è¿™å°±æ˜¯å› ä¸ºæ²¡æœ‰ææ˜ç™½å‰å°ã€åå°çš„æ¦‚å¿µï¼Œæ²¡æœ‰åŒºåˆ†å®¹å™¨å’Œè™šæ‹Ÿæœºçš„å·®å¼‚ï¼Œä¾æ—§åœ¨ä»¥ä¼ ç»Ÿè™šæ‹Ÿæœºçš„è§’åº¦å»ç†è§£å®¹å™¨ã€‚å¯¹äºå®¹å™¨è€Œè¨€ï¼Œå…¶å¯åŠ¨ç¨‹åºå°±æ˜¯å®¹å™¨åº”ç”¨è¿›ç¨‹ï¼Œå®¹å™¨å°±æ˜¯ä¸ºäº†ä¸»è¿›ç¨‹è€Œå­˜åœ¨çš„ï¼Œä¸»è¿›ç¨‹é€€å‡ºï¼Œå®¹å™¨å°±å¤±å»äº†å­˜åœ¨çš„æ„ä¹‰ï¼Œä»è€Œé€€å‡ºï¼Œå…¶å®ƒè¾…åŠ©è¿›ç¨‹ä¸æ˜¯å®ƒéœ€è¦å…³å¿ƒçš„ä¸œè¥¿ã€‚</p><p>è€Œä½¿ç”¨ service nginx start å‘½ä»¤ï¼Œåˆ™æ˜¯å¸Œæœ›ä»¥åå°å®ˆæŠ¤è¿›ç¨‹å½¢å¼å¯åŠ¨ nginx æœåŠ¡ã€‚è€Œåˆšæ‰è¯´äº† CMD service nginx start ä¼šè¢«ç†è§£ä¸º CMD [ â€œshâ€, â€œ-câ€, â€œservice nginx startâ€] ï¼Œå› æ­¤ä¸»è¿›ç¨‹å®é™…ä¸Šæ˜¯ shã€‚é‚£ä¹ˆå½“ service nginx start å‘½ä»¤ç»“æŸåï¼Œsh ä¹Ÿå°±ç»“æŸäº†ï¼Œsh ä½œä¸ºä¸»è¿›ç¨‹é€€å‡ºäº†ï¼Œè‡ªç„¶å°±ä¼šä»¤å®¹å™¨é€€å‡ºã€‚</p><p>æ­£ç¡®çš„åšæ³•æ˜¯ç›´æ¥æ‰§è¡Œ nginx å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”è¦æ±‚ä»¥å‰å°å½¢å¼è¿è¡Œã€‚æ¯”å¦‚ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;nginx&quot;</span>, <span class="hljs-string">&quot;-g&quot;</span>, <span class="hljs-string">&quot;daemon off;&quot;</span>]</span><br></code></pre></td></tr></table></figure><h3 id="4-2-11-ENTRYPOINT"><a href="#4-2-11-ENTRYPOINT" class="headerlink" title="4.2.11 ENTRYPOINT"></a>4.2.11 ENTRYPOINT</h3><p>ç”¨æ¥æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œå‘½ä»¤å’ŒCMDç±»ä¼¼</p><p>æ ¼å¼ä¸ CMD ä¸€è‡´ï¼ŒENTRYPOINTæŒ‡ä»¤ï¼Œå¾€å¾€ç”¨äºè®¾ç½®å®¹å™¨å¯åŠ¨åçš„<strong>ç¬¬ä¸€ä¸ªå‘½ä»¤</strong>ï¼Œè¿™å¯¹ä¸€ä¸ªå®¹å™¨æ¥è¯´å¾€å¾€æ˜¯å›ºå®šçš„ã€‚CMDæŒ‡ä»¤ï¼Œå¾€å¾€ç”¨äºè®¾ç½®å®¹å™¨å¯åŠ¨çš„ç¬¬ä¸€ä¸ªå‘½ä»¤çš„<strong>é»˜è®¤å‚æ•°</strong>ï¼Œè¿™å¯¹ä¸€ä¸ªå®¹å™¨æ¥è¯´å¯ä»¥æ˜¯å˜åŒ–çš„ã€‚</p><p>å¦‚ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;ls&quot;</span>]</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µæœ€ç»ˆçš„æ‰§è¡Œæ•ˆæœæ˜¯ ENTRYPOINT â€œ$CMDâ€ï¼Œä½† CMD åœ¨å¯åŠ¨å®¹å™¨æ—¶ä¼šè¢«è¦†ç›–ï¼Œå‡å¦‚æ„å»ºçš„é•œåƒåä¸º itest</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run itest<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå…¶å®æ˜¯ ls &#x2F;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run itest /bin<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ CMD å‘½ä»¤è¢«è¦†ç›–æœ€ç»ˆè¿è¡Œ ls &#x2F;bin</p><h1 id="äº”ã€Docker-Compose"><a href="#äº”ã€Docker-Compose" class="headerlink" title="äº”ã€Docker Compose"></a>äº”ã€Docker Compose</h1><p>Compose é¡¹ç›®æ˜¯ Docker å®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œå®ç°å¯¹ Docker å®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ï¼Œå…¶å®šä½æ˜¯ï¼šå®šä¹‰å’Œè¿è¡Œå¤šä¸ª Docker å®¹å™¨åº”ç”¨ã€‚</p><p>ä¸Šä¸€èŠ‚ï¼ŒDockerfile æœ«ç­æ–‡ä»¶ï¼Œå¯ä»¥è®©ç”¨æˆ·å¾ˆæ–¹ä¾¿çš„å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨å®¹å™¨ï¼Œç„¶ååœ¨æ—¥å¸¸å·¥ä½œä¸­ç»å¸¸éœ€è¦å¤šä¸ªå®¹å™¨ç›¸äº’é…åˆã€‚ä¾‹å¦‚å®ç°ä¸€ä¸ª web é¡¹ç›®ï¼Œé™¤äº† web æœåŠ¡å®¹å™¨æœ¬èº«ï¼Œå¾€å¾€è¿˜éœ€è¦åŠ ä¸Šåç«¯çš„æ•°æ®åº“æœåŠ¡å®¹å™¨ï¼Œç”šè‡³è¿˜åŒ…æ‹¬è´Ÿè½½å‡è¡¡å®¹å™¨ç­‰ã€‚</p><p>Compose æ°å¥½æ»¡è¶³è¿™æ ·çš„éœ€æ±‚ï¼Œå®ƒå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ docker-compose.yml æ¨¡æ¿æ–‡ä»¶æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ª<strong>é¡¹ç›®</strong>ã€‚</p><p>Compose ä¸­ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p><ul><li>æœåŠ¡ï¼šä¸€ä¸ªåº”ç”¨å®¹å™¨å°±æ˜¯ä¸€ä¸ªæœåŠ¡</li><li>é¡¹ç›®ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„åˆçš„å®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ docker-compose.yml ä¸­å®šä¹‰</li></ul><h2 id="5-1-å®‰è£…ä¸å¸è½½"><a href="#5-1-å®‰è£…ä¸å¸è½½" class="headerlink" title="5.1 å®‰è£…ä¸å¸è½½"></a>5.1 å®‰è£…ä¸å¸è½½</h2><h6 id="1-linux"><a href="#1-linux" class="headerlink" title="1.linux"></a>1.linux</h6><ul><li>åœ¨ Linux ä¸Šçš„ä¹Ÿå®‰è£…ååˆ†ç®€å•ï¼Œä» å®˜æ–¹ GitHub Release å¤„ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ Linux 64 ä½ç³»ç»Ÿä¸Šç›´æ¥ä¸‹è½½å¯¹åº”çš„äºŒè¿›åˆ¶åŒ…ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo curl -L https://github.com/docker/compose/releases/download/1.25.5/docker-compose-`<span class="hljs-built_in">uname</span> -s`-`<span class="hljs-built_in">uname</span> -m` &gt; /usr/local/bin/docker-compose<br>$ sudo <span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><h6 id="2-macosã€window"><a href="#2-macosã€window" class="headerlink" title="2.macosã€window"></a>2.macosã€window</h6><ul><li>Compose å¯ä»¥é€šè¿‡ Python çš„åŒ…ç®¡ç†å·¥å…· pip è¿›è¡Œå®‰è£…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ä½¿ç”¨ï¼Œç”šè‡³èƒ½å¤Ÿç›´æ¥åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œã€‚<code>Docker Desktop for Mac/Windows è‡ªå¸¦ docker-compose äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®‰è£… Docker ä¹‹åå¯ä»¥ç›´æ¥ä½¿ç”¨</code>ã€‚</li></ul><h6 id="3-bashå‘½ä»¤è¡¥å…¨"><a href="#3-bashå‘½ä»¤è¡¥å…¨" class="headerlink" title="3.bashå‘½ä»¤è¡¥å…¨"></a>3.bashå‘½ä»¤è¡¥å…¨</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo curl -L <span class="hljs-string">&quot;https://github.com/docker/compose/releases/latest/download/docker-compose-<span class="hljs-subst">$(uname -s)</span>-<span class="hljs-subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br></code></pre></td></tr></table></figure><h6 id="4-å¸è½½"><a href="#4-å¸è½½" class="headerlink" title="4.å¸è½½"></a>4.å¸è½½</h6><ul><li>å¦‚æœæ˜¯äºŒè¿›åˆ¶åŒ…æ–¹å¼å®‰è£…çš„ï¼Œåˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">rm</span> /usr/local/bin/docker-compose</span><br></code></pre></td></tr></table></figure><h6 id="5-æµ‹è¯•å®‰è£…æˆåŠŸ"><a href="#5-æµ‹è¯•å®‰è£…æˆåŠŸ" class="headerlink" title="5.æµ‹è¯•å®‰è£…æˆåŠŸ"></a>5.æµ‹è¯•å®‰è£…æˆåŠŸ</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker-compose --version</span><br> docker-compose version 1.25.5, build 4667896b<br></code></pre></td></tr></table></figure><h2 id="5-2-ä½¿ç”¨"><a href="#5-2-ä½¿ç”¨" class="headerlink" title="5.2 ä½¿ç”¨"></a>5.2 ä½¿ç”¨</h2><p>docker-compose æ¨¡æ¿ï¼š<a href="https://docker_practice.gitee.io/zh-cn/compose/compose_file.html">https://docker_practice.gitee.io/zh-cn/compose/compose_file.html</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.0&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">mysqldb:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7.19</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3306:3306&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/root/mysql/conf:/etc/mysql/conf.d</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/root/mysql/logs:/logs</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/root/mysql/data:/var/lib/mysql</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ems</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span><br><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:4.0.14</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;6379:6379&quot;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ems</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/root/redis/data:/data</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span><br>    <br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">ems:</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡ docker-compose.yml è¿è¡Œä¸€ç»„å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@centos ~]# docker-compose up    //å‰å°å¯åŠ¨ä¸€ç»„æœåŠ¡<br>[root@centos ~]# docker-compose up -d //åå°å¯åŠ¨ä¸€ç»„æœåŠ¡<br></code></pre></td></tr></table></figure><h2 id="5-3-æ¨¡æ¿æ–‡ä»¶"><a href="#5-3-æ¨¡æ¿æ–‡ä»¶" class="headerlink" title="5.3 æ¨¡æ¿æ–‡ä»¶"></a>5.3 æ¨¡æ¿æ–‡ä»¶</h2><p>æ¨¡æ¿æ–‡ä»¶æ˜¯ä½¿ç”¨ <code>Compose</code> çš„æ ¸å¿ƒï¼Œæ¶‰åŠåˆ°çš„æŒ‡ä»¤å…³é”®å­—ä¹Ÿæ¯”è¾ƒå¤šã€‚ä½†å¤§å®¶ä¸ç”¨æ‹…å¿ƒï¼Œè¿™é‡Œé¢å¤§éƒ¨åˆ†æŒ‡ä»¤è·Ÿ <code>docker run</code> ç›¸å…³å‚æ•°çš„å«ä¹‰éƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p><p>é»˜è®¤çš„æ¨¡æ¿æ–‡ä»¶åç§°ä¸º <code>docker-compose.yml</code>ï¼Œæ ¼å¼ä¸º YAML æ ¼å¼ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">webapp:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">examples/web</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;80:80&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;/data&quot;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„æ¯ä¸ªæœåŠ¡éƒ½å¿…é¡»é€šè¿‡ <code>image</code> æŒ‡ä»¤æŒ‡å®šé•œåƒæˆ– <code>build</code> æŒ‡ä»¤ï¼ˆéœ€è¦ Dockerfileï¼‰ç­‰æ¥è‡ªåŠ¨æ„å»ºç”Ÿæˆé•œåƒã€‚</p><p>å¦‚æœä½¿ç”¨ <code>build</code> æŒ‡ä»¤ï¼Œåœ¨ <code>Dockerfile</code> ä¸­è®¾ç½®çš„é€‰é¡¹(ä¾‹å¦‚ï¼š<code>CMD</code>, <code>EXPOSE</code>, <code>VOLUME</code>, <code>ENV</code> ç­‰) å°†ä¼šè‡ªåŠ¨è¢«è·å–ï¼Œæ— éœ€åœ¨ <code>docker-compose.yml</code> ä¸­é‡å¤è®¾ç½®ã€‚</p><p>ä¸‹é¢åˆ†åˆ«ä»‹ç»å„ä¸ªæŒ‡ä»¤çš„ç”¨æ³•ã€‚</p><h4 id="build"><a href="#build" class="headerlink" title="build"></a><code>build</code></h4><p>æŒ‡å®š <code>Dockerfile</code> æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼ˆå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œæˆ–è€…ç›¸å¯¹ docker-compose.yml æ–‡ä»¶çš„è·¯å¾„ï¼‰ã€‚ <code>Compose</code> å°†ä¼šåˆ©ç”¨å®ƒè‡ªåŠ¨æ„å»ºè¿™ä¸ªé•œåƒï¼Œç„¶åä½¿ç”¨è¿™ä¸ªé•œåƒã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br><br>  <span class="hljs-attr">webapp:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">./dir</span><br></code></pre></td></tr></table></figure><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>context</code> æŒ‡ä»¤æŒ‡å®š <code>Dockerfile</code> æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚</p><p>ä½¿ç”¨ <code>dockerfile</code> æŒ‡ä»¤æŒ‡å®š <code>Dockerfile</code> æ–‡ä»¶åã€‚</p><p>ä½¿ç”¨ <code>arg</code> æŒ‡ä»¤æŒ‡å®šæ„å»ºé•œåƒæ—¶çš„å˜é‡ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br><br>  <span class="hljs-attr">webapp:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">./dir</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile-alternate</span><br>      <span class="hljs-attr">args:</span><br>        <span class="hljs-attr">buildno:</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h4 id="command"><a href="#command" class="headerlink" title="command"></a><code>command</code></h4><p>è¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">command:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;hello world&quot;</span><br></code></pre></td></tr></table></figure><h4 id="container-name"><a href="#container-name" class="headerlink" title="container_name"></a><code>container_name</code></h4><p>æŒ‡å®šå®¹å™¨åç§°ã€‚é»˜è®¤å°†ä¼šä½¿ç”¨ <code>é¡¹ç›®åç§°_æœåŠ¡åç§°_åºå·</code> è¿™æ ·çš„æ ¼å¼ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">container_name:</span> <span class="hljs-string">docker-web-container</span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„: æŒ‡å®šå®¹å™¨åç§°åï¼Œè¯¥æœåŠ¡å°†æ— æ³•è¿›è¡Œæ‰©å±•ï¼ˆscaleï¼‰ï¼Œå› ä¸º Docker ä¸å…è®¸å¤šä¸ªå®¹å™¨å…·æœ‰ç›¸åŒçš„åç§°ã€‚</p></blockquote><h4 id="depends-on"><a href="#depends-on" class="headerlink" title="depends_on"></a><code>depends_on</code></h4><p>è§£å†³å®¹å™¨çš„ä¾èµ–ã€å¯åŠ¨å…ˆåçš„é—®é¢˜ã€‚ä»¥ä¸‹ä¾‹å­ä¸­ä¼šå…ˆå¯åŠ¨ <code>redis</code> <code>db</code> å†å¯åŠ¨ <code>web</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span><br><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres</span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<code>web</code> æœåŠ¡ä¸ä¼šç­‰å¾… <code>redis</code> <code>db</code> ã€Œå®Œå…¨å¯åŠ¨ã€ä¹‹åæ‰å¯åŠ¨ã€‚</p></blockquote><h4 id="env-file"><a href="#env-file" class="headerlink" title="env_file"></a><code>env_file</code></h4><p>ä»æ–‡ä»¶ä¸­è·å–ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¸ºå•ç‹¬çš„æ–‡ä»¶è·¯å¾„æˆ–åˆ—è¡¨ã€‚</p><p>å¦‚æœé€šè¿‡ <code>docker-compose -f FILE</code> æ–¹å¼æ¥æŒ‡å®š Compose æ¨¡æ¿æ–‡ä»¶ï¼Œåˆ™ <code>env_file</code> ä¸­å˜é‡çš„è·¯å¾„ä¼šåŸºäºæ¨¡æ¿æ–‡ä»¶è·¯å¾„ã€‚</p><p>å¦‚æœæœ‰å˜é‡åç§°ä¸ <code>environment</code> æŒ‡ä»¤å†²çªï¼Œåˆ™æŒ‰ç…§æƒ¯ä¾‹ï¼Œä»¥åè€…ä¸ºå‡†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">env_file: .<span class="hljs-built_in">env</span><br><br>env_file:<br>  - ./common.env<br>  - ./apps/web.env<br>  - /opt/secrets.env<br></code></pre></td></tr></table></figure><p>ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­æ¯ä¸€è¡Œå¿…é¡»ç¬¦åˆæ ¼å¼ï¼Œæ”¯æŒ <code>#</code> å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># common.env: Set development environment</span><br>PROG_ENV=development<br></code></pre></td></tr></table></figure><h4 id="environment"><a href="#environment" class="headerlink" title="environment"></a><code>environment</code></h4><p>è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ä½ å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ä¸¤ç§æ ¼å¼ã€‚</p><p>åªç»™å®šåç§°çš„å˜é‡ä¼šè‡ªåŠ¨è·å–è¿è¡Œ Compose ä¸»æœºä¸Šå¯¹åº”å˜é‡çš„å€¼ï¼Œå¯ä»¥ç”¨æ¥é˜²æ­¢æ³„éœ²ä¸å¿…è¦çš„æ•°æ®ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">environment:</span><br>  <span class="hljs-attr">RACK_ENV:</span> <span class="hljs-string">development</span><br>  <span class="hljs-attr">SESSION_SECRET:</span><br><br><span class="hljs-attr">environment:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">RACK_ENV=development</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">SESSION_SECRET</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå˜é‡åç§°æˆ–è€…å€¼ä¸­ç”¨åˆ° <code>true|falseï¼Œyes|no</code> ç­‰è¡¨è¾¾ <a href="https://yaml.org/type/bool.html">å¸ƒå°”</a> å«ä¹‰çš„è¯æ±‡ï¼Œæœ€å¥½æ”¾åˆ°å¼•å·é‡Œï¼Œé¿å… YAML è‡ªåŠ¨è§£ææŸäº›å†…å®¹ä¸ºå¯¹åº”çš„å¸ƒå°”è¯­ä¹‰ã€‚è¿™äº›ç‰¹å®šè¯æ±‡ï¼ŒåŒ…æ‹¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">y|Y|<span class="hljs-built_in">yes</span>|Yes|YES|n|N|no|No|NO|<span class="hljs-literal">true</span>|True|TRUE|<span class="hljs-literal">false</span>|False|FALSE|on|On|ON|off|Off|OFF<br></code></pre></td></tr></table></figure><h4 id="healthcheck"><a href="#healthcheck" class="headerlink" title="healthcheck"></a><code>healthcheck</code></h4><p>é€šè¿‡å‘½ä»¤æ£€æŸ¥å®¹å™¨æ˜¯å¦å¥åº·è¿è¡Œã€‚(ä½¿ç”¨curléœ€è¦æ„å»ºé•œåƒçš„æ—¶å€™å®‰è£…äº†curl)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">healthcheck:</span><br>  <span class="hljs-attr">test:</span> [<span class="hljs-string">&quot;CMD&quot;</span>, <span class="hljs-string">&quot;curl&quot;</span>, <span class="hljs-string">&quot;-f&quot;</span>, <span class="hljs-string">&quot;http://localhost&quot;</span>]<br>  <span class="hljs-attr">interval:</span> <span class="hljs-string">1m30s</span><br>  <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span><br>  <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h4 id="image"><a href="#image" class="headerlink" title="image"></a><code>image</code></h4><p>æŒ‡å®šä¸ºé•œåƒåç§°æˆ–é•œåƒ IDã€‚å¦‚æœé•œåƒåœ¨æœ¬åœ°ä¸å­˜åœ¨ï¼Œ<code>Compose</code> å°†ä¼šå°è¯•æ‹‰å–è¿™ä¸ªé•œåƒã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">image:</span> <span class="hljs-string">ubuntu</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">orchardup/postgresql</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">a4bc65fd</span><br></code></pre></td></tr></table></figure><h4 id="networks"><a href="#networks" class="headerlink" title="networks"></a><code>networks</code></h4><p>é…ç½®å®¹å™¨è¿æ¥çš„ç½‘ç»œã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br><br>  <span class="hljs-attr">some-service:</span><br>    <span class="hljs-attr">networks:</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-string">some-network</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-string">other-network</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">some-network:</span><br>  <span class="hljs-attr">other-network:</span><br></code></pre></td></tr></table></figure><h4 id="ports"><a href="#ports" class="headerlink" title="ports"></a><code>ports</code></h4><p>æš´éœ²ç«¯å£ä¿¡æ¯ã€‚</p><p>ä½¿ç”¨å®¿ä¸»ç«¯å£ï¼šå®¹å™¨ç«¯å£ <code>(HOST:CONTAINER)</code> æ ¼å¼ï¼Œæˆ–è€…ä»…ä»…æŒ‡å®šå®¹å™¨çš„ç«¯å£ï¼ˆå®¿ä¸»å°†ä¼šéšæœºé€‰æ‹©ç«¯å£ï¼‰éƒ½å¯ä»¥ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">ports:</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3000&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8000:8000&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;49100:22&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;127.0.0.1:8001:8001&quot;</span><br></code></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šå½“ä½¿ç”¨ <code>HOST:CONTAINER</code> æ ¼å¼æ¥æ˜ å°„ç«¯å£æ—¶ï¼Œå¦‚æœä½ ä½¿ç”¨çš„å®¹å™¨ç«¯å£å°äº 60 å¹¶ä¸”æ²¡æ”¾åˆ°å¼•å·é‡Œï¼Œå¯èƒ½ä¼šå¾—åˆ°é”™è¯¯ç»“æœï¼Œå› ä¸º <code>YAML</code> ä¼šè‡ªåŠ¨è§£æ <code>xx:yy</code> è¿™ç§æ•°å­—æ ¼å¼ä¸º 60 è¿›åˆ¶ã€‚ä¸ºé¿å…å‡ºç°è¿™ç§é—®é¢˜ï¼Œå»ºè®®æ•°å­—ä¸²éƒ½é‡‡ç”¨å¼•å·åŒ…æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚</em></p><h4 id="sysctls"><a href="#sysctls" class="headerlink" title="sysctls"></a><code>sysctls</code></h4><p>é…ç½®å®¹å™¨å†…æ ¸å‚æ•°ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sysctls:</span><br>  <span class="hljs-attr">net.core.somaxconn:</span> <span class="hljs-number">1024</span><br>  <span class="hljs-attr">net.ipv4.tcp_syncookies:</span> <span class="hljs-number">0</span><br><br><span class="hljs-attr">sysctls:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">net.core.somaxconn=1024</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">net.ipv4.tcp_syncookies=0</span><br></code></pre></td></tr></table></figure><h4 id="ulimits"><a href="#ulimits" class="headerlink" title="ulimits"></a><code>ulimits</code></h4><p>æŒ‡å®šå®¹å™¨çš„ ulimits é™åˆ¶å€¼ã€‚</p><p>ä¾‹å¦‚ï¼ŒæŒ‡å®šæœ€å¤§è¿›ç¨‹æ•°ä¸º 65535ï¼ŒæŒ‡å®šæ–‡ä»¶å¥æŸ„æ•°ä¸º 20000ï¼ˆè½¯é™åˆ¶ï¼Œåº”ç”¨å¯ä»¥éšæ—¶ä¿®æ”¹ï¼Œä¸èƒ½è¶…è¿‡ç¡¬é™åˆ¶ï¼‰ å’Œ 40000ï¼ˆç³»ç»Ÿç¡¬é™åˆ¶ï¼Œåªèƒ½ root ç”¨æˆ·æé«˜ï¼‰ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">ulimits:</span><br>  <span class="hljs-attr">nproc:</span> <span class="hljs-number">65535</span><br>  <span class="hljs-attr">nofile:</span><br>    <span class="hljs-attr">soft:</span> <span class="hljs-number">20000</span><br>    <span class="hljs-attr">hard:</span> <span class="hljs-number">40000</span><br></code></pre></td></tr></table></figure><h4 id="volumes"><a href="#volumes" class="headerlink" title="volumes"></a><code>volumes</code></h4><p>æ•°æ®å·æ‰€æŒ‚è½½è·¯å¾„è®¾ç½®ã€‚å¯ä»¥è®¾ç½®ä¸ºå®¿ä¸»æœºè·¯å¾„(<code>HOST:CONTAINER</code>)æˆ–è€…æ•°æ®å·åç§°(<code>VOLUME:CONTAINER</code>)ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®è®¿é—®æ¨¡å¼ ï¼ˆ<code>HOST:CONTAINER:ro</code>ï¼‰ã€‚</p><p>è¯¥æŒ‡ä»¤ä¸­è·¯å¾„æ”¯æŒç›¸å¯¹è·¯å¾„ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">volumes:</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">/var/lib/mysql</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">cache/:/tmp/cache</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">~/configs:/etc/configs/:ro</span><br></code></pre></td></tr></table></figure><p>å¦‚æœè·¯å¾„ä¸ºæ•°æ®å·åç§°ï¼Œå¿…é¡»åœ¨æ–‡ä»¶ä¸­é…ç½®æ•°æ®å·ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">my_src:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql_data:/var/lib/mysql</span><br><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">mysql_data:</span><br></code></pre></td></tr></table></figure><h4 id="restart"><a href="#restart" class="headerlink" title="restart"></a><code>restart</code></h4><p>åœ¨<code>docker-compose.yml</code>æ–‡ä»¶ä¸­ï¼Œ<code>restart</code>å‚æ•°ç”¨äºå®šä¹‰æœåŠ¡å®¹å™¨åœ¨é€€å‡ºåçš„é‡å¯ç­–ç•¥ã€‚è¿™ä¸ªå‚æ•°ç›´æ¥å¯¹åº”Dockerå®ˆæŠ¤è¿›ç¨‹é‡å¯å®¹å™¨çš„ç­–ç•¥ï¼Œå¯é€‰çš„ç±»åˆ«åŒ…æ‹¬ï¼š</p><ol><li>**<code>no</code>**ï¼šå®¹å™¨ä¸ä¼šè‡ªåŠ¨é‡å¯ï¼Œå³ä½¿å®ƒæ„å¤–é€€å‡ºï¼ˆè¿™æ˜¯é»˜è®¤å€¼ï¼‰ã€‚</li><li>**<code>on-failure</code>**ï¼šä»…å½“å®¹å™¨ä»¥éé›¶é€€å‡ºçŠ¶æ€é€€å‡ºæ—¶ï¼ŒDockeræ‰ä¼šè‡ªåŠ¨é‡å¯å®¹å™¨ã€‚ä½ å¯ä»¥é€‰æ‹©æ€§åœ°æŒ‡å®šä¸€ä¸ªé‡å¯æ¬¡æ•°é™åˆ¶ï¼Œä¾‹å¦‚<code>on-failure:3</code>è¡¨ç¤ºå¦‚æœå®¹å™¨å› ä¸ºå¤±è´¥è¿ç»­é‡å¯3æ¬¡åï¼ŒDockerå°†ä¸å†å°è¯•é‡å¯ã€‚å¦‚æœä¸æŒ‡å®šæ¬¡æ•°ï¼Œé»˜è®¤æ˜¯æ— é™é‡å¯ã€‚</li><li>**<code>always</code>**ï¼šæ— è®ºå®¹å™¨ä»¥ä½•ç§çŠ¶æ€é€€å‡ºï¼ˆåŒ…æ‹¬æ­£å¸¸é€€å‡ºã€è¢«æ€æ­»æˆ–å› é”™è¯¯é€€å‡ºï¼‰ï¼ŒDockeréƒ½ä¼šè‡ªåŠ¨é‡å¯å®¹å™¨ã€‚</li><li>**<code>unless-stopped</code>**ï¼šå®¹å™¨ä¼šå§‹ç»ˆè‡ªåŠ¨é‡å¯ï¼Œé™¤éå®ƒè¢«æ˜ç¡®åœ°åœæ­¢ï¼ˆé€šè¿‡<code>docker stop</code>æˆ–ç±»ä¼¼çš„å‘½ä»¤ï¼‰ã€‚å³ä½¿Dockerå®ˆæŠ¤è¿›ç¨‹é‡å¯ï¼Œæ­¤ç­–ç•¥ä¹Ÿä¼šç¡®ä¿å®¹å™¨è‡ªåŠ¨å¯åŠ¨ï¼Œå‰ææ˜¯å®ƒä¹‹å‰æ˜¯è¿è¡ŒçŠ¶æ€ã€‚</li></ol><p>â€‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">example/web</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>  <span class="hljs-attr">worker:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">example/worker</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">on-failure:5</span><br></code></pre></td></tr></table></figure><h2 id="5-4-å¸¸ç”¨å‘½ä»¤"><a href="#5-4-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="5.4 å¸¸ç”¨å‘½ä»¤"></a>5.4 å¸¸ç”¨å‘½ä»¤</h2><h5 id="1-å‘½ä»¤å¯¹è±¡ä¸æ ¼å¼"><a href="#1-å‘½ä»¤å¯¹è±¡ä¸æ ¼å¼" class="headerlink" title="1. å‘½ä»¤å¯¹è±¡ä¸æ ¼å¼"></a>1. å‘½ä»¤å¯¹è±¡ä¸æ ¼å¼</h5><p>å¯¹äº Compose æ¥è¯´ï¼Œå¤§éƒ¨åˆ†å‘½ä»¤çš„å¯¹è±¡æ—¢å¯ä»¥æ˜¯é¡¹ç›®æœ¬èº«ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºé¡¹ç›®ä¸­çš„æœåŠ¡æˆ–è€…å®¹å™¨ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„è¯´æ˜ï¼Œå‘½ä»¤å¯¹è±¡å°†æ˜¯é¡¹ç›®ï¼Œè¿™æ„å‘³ç€é¡¹ç›®ä¸­æ‰€æœ‰çš„æœåŠ¡éƒ½ä¼šå—åˆ°å‘½ä»¤å½±å“ã€‚</p><p>æ‰§è¡Œ <code>docker-compose [COMMAND] --help</code> æˆ–è€… <code>docker-compose help [COMMAND]</code> å¯ä»¥æŸ¥çœ‹å…·ä½“æŸä¸ªå‘½ä»¤çš„ä½¿ç”¨æ ¼å¼ã€‚</p><p><code>docker-compose</code> å‘½ä»¤çš„åŸºæœ¬çš„ä½¿ç”¨æ ¼å¼æ˜¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose [-f=&lt;arg&gt;...] [options] [COMMAND] [ARGS...]<br></code></pre></td></tr></table></figure><h5 id="2-å‘½ä»¤é€‰é¡¹"><a href="#2-å‘½ä»¤é€‰é¡¹" class="headerlink" title="2. å‘½ä»¤é€‰é¡¹"></a>2. å‘½ä»¤é€‰é¡¹</h5><ul><li><code>-f, --file FILE</code> æŒ‡å®šä½¿ç”¨çš„ Compose æ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤ä¸º <code>docker-compose.yml</code>ï¼Œå¯ä»¥å¤šæ¬¡æŒ‡å®šã€‚</li><li><code>-p, --project-name NAME</code> æŒ‡å®šé¡¹ç›®åç§°ï¼Œé»˜è®¤å°†ä½¿ç”¨æ‰€åœ¨ç›®å½•åç§°ä½œä¸ºé¡¹ç›®åã€‚</li><li><code>--x-networking</code> ä½¿ç”¨ Docker çš„å¯æ‹”æ’ç½‘ç»œåç«¯ç‰¹æ€§</li><li><code>--x-network-driver DRIVER</code> æŒ‡å®šç½‘ç»œåç«¯çš„é©±åŠ¨ï¼Œé»˜è®¤ä¸º <code>bridge</code></li><li><code>--verbose</code> è¾“å‡ºæ›´å¤šè°ƒè¯•ä¿¡æ¯ã€‚</li><li><code>-v, --version</code> æ‰“å°ç‰ˆæœ¬å¹¶é€€å‡ºã€‚</li></ul><h5 id="3-å‘½ä»¤ä½¿ç”¨è¯´æ˜"><a href="#3-å‘½ä»¤ä½¿ç”¨è¯´æ˜" class="headerlink" title="3.å‘½ä»¤ä½¿ç”¨è¯´æ˜"></a>3.å‘½ä»¤ä½¿ç”¨è¯´æ˜</h5><h5 id="up"><a href="#up" class="headerlink" title="up"></a><code>up</code></h5><p>æ ¼å¼ä¸º <code>docker-compose up [options] [SERVICE...]</code>ã€‚</p><ul><li><p>è¯¥å‘½ä»¤ååˆ†å¼ºå¤§ï¼Œå®ƒå°†å°è¯•è‡ªåŠ¨å®ŒæˆåŒ…æ‹¬æ„å»ºé•œåƒï¼Œï¼ˆé‡æ–°ï¼‰åˆ›å»ºæœåŠ¡ï¼Œå¯åŠ¨æœåŠ¡ï¼Œå¹¶å…³è”æœåŠ¡ç›¸å…³å®¹å™¨çš„ä¸€ç³»åˆ—æ“ä½œã€‚</p></li><li><p>é“¾æ¥çš„æœåŠ¡éƒ½å°†ä¼šè¢«è‡ªåŠ¨å¯åŠ¨ï¼Œé™¤éå·²ç»å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</p></li><li><p>å¯ä»¥è¯´ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½å¯ä»¥ç›´æ¥é€šè¿‡è¯¥å‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ªé¡¹ç›®ã€‚</p></li><li><p>é»˜è®¤æƒ…å†µï¼Œ<code>docker-compose up</code> å¯åŠ¨çš„å®¹å™¨éƒ½åœ¨å‰å°ï¼Œæ§åˆ¶å°å°†ä¼šåŒæ—¶æ‰“å°æ‰€æœ‰å®¹å™¨çš„è¾“å‡ºä¿¡æ¯ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿è¿›è¡Œè°ƒè¯•ã€‚</p></li><li><p>å½“é€šè¿‡ <code>Ctrl-C</code> åœæ­¢å‘½ä»¤æ—¶ï¼Œæ‰€æœ‰å®¹å™¨å°†ä¼šåœæ­¢ã€‚</p></li><li><p>å¦‚æœä½¿ç”¨ <code>docker-compose up -d</code>ï¼Œå°†ä¼šåœ¨åå°å¯åŠ¨å¹¶è¿è¡Œæ‰€æœ‰çš„å®¹å™¨ã€‚ä¸€èˆ¬æ¨èç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨è¯¥é€‰é¡¹ã€‚</p></li><li><p>é»˜è®¤æƒ…å†µï¼Œå¦‚æœæœåŠ¡å®¹å™¨å·²ç»å­˜åœ¨ï¼Œ<code>docker-compose up</code> å°†ä¼šå°è¯•åœæ­¢å®¹å™¨ï¼Œç„¶åé‡æ–°åˆ›å»ºï¼ˆä¿æŒä½¿ç”¨ <code>volumes-from</code> æŒ‚è½½çš„å·ï¼‰ï¼Œä»¥ä¿è¯æ–°å¯åŠ¨çš„æœåŠ¡åŒ¹é… <code>docker-compose.yml</code> æ–‡ä»¶çš„æœ€æ–°å†…å®¹ï¼Œæ–°å¢æŒ‚è½½å·åˆ™éœ€è¦åˆ é™¤<code>rm</code>å®¹å™¨ï¼Œé‡æ–°å¯åŠ¨ï¼Œç¯å¢ƒå˜é‡é•œåƒç­‰é…ç½®ä¼šæ›´æ–°</p></li></ul><hr><h5 id="down"><a href="#down" class="headerlink" title="down"></a><code>down</code></h5><ul><li>æ­¤å‘½ä»¤å°†ä¼šåœæ­¢ <code>up</code> å‘½ä»¤æ‰€å¯åŠ¨çš„å®¹å™¨å¹¶åˆ é™¤å®ƒä»¬ï¼ˆä½†ä¸ä¼šåˆ é™¤æ•°æ®å·ï¼Œé™¤éä½ ä½¿ç”¨äº† <code>--volumes</code> é€‰é¡¹ï¼‰ã€‚</li></ul><hr><h5 id="exec"><a href="#exec" class="headerlink" title="exec"></a><code>exec</code></h5><ul><li>è¿›å…¥æŒ‡å®šçš„å®¹å™¨ã€‚</li></ul><hr><h5 id="ps"><a href="#ps" class="headerlink" title="ps"></a><code>ps</code></h5><p>æ ¼å¼ä¸º <code>docker-compose ps [options] [SERVICE...]</code>ã€‚</p><p>åˆ—å‡ºé¡¹ç›®ä¸­ç›®å‰çš„æ‰€æœ‰å®¹å™¨ã€‚</p><p>é€‰é¡¹ï¼š</p><ul><li><code>-q</code> åªæ‰“å°å®¹å™¨çš„ ID ä¿¡æ¯ã€‚</li></ul><hr><h5 id="restart-1"><a href="#restart-1" class="headerlink" title="restart"></a><code>restart</code></h5><p>æ ¼å¼ä¸º <code>docker-compose restart [options] [SERVICE...]</code>ã€‚</p><p>é‡å¯é¡¹ç›®ä¸­çš„æœåŠ¡ã€‚</p><p>é€‰é¡¹ï¼š</p><ul><li><code>-t, --timeout TIMEOUT</code> æŒ‡å®šé‡å¯å‰åœæ­¢å®¹å™¨çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰ï¼Œä¿®æ”¹ çš„å®¿ä¸»æœºæ–‡ä»¶å†…å®¹å¯ä»¥é€šè¿‡restartè¿›è¡Œæ›´æ–°ï¼Œä¿®æ”¹çš„docker-compose.yamlé…ç½®æ–‡ä»¶ä¸ä¼šè¿›è¡Œæ›´æ–°è¿è¡Œï¼Œä½¿ç”¨upã€‚</li></ul><hr><h5 id="rm"><a href="#rm" class="headerlink" title="rm"></a><code>rm</code></h5><p>æ ¼å¼ä¸º <code>docker-compose rm [options] [SERVICE...]</code>ã€‚</p><p>åˆ é™¤æ‰€æœ‰ï¼ˆåœæ­¢çŠ¶æ€çš„ï¼‰æœåŠ¡å®¹å™¨ã€‚æ¨èå…ˆæ‰§è¡Œ <code>docker-compose stop</code> å‘½ä»¤æ¥åœæ­¢å®¹å™¨ã€‚</p><p>é€‰é¡¹ï¼š</p><ul><li><code>-f, --force</code> å¼ºåˆ¶ç›´æ¥åˆ é™¤ï¼ŒåŒ…æ‹¬éåœæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ä¸€èˆ¬å°½é‡ä¸è¦ä½¿ç”¨è¯¥é€‰é¡¹ã€‚</li><li><code>-v</code> åˆ é™¤å®¹å™¨æ‰€æŒ‚è½½çš„æ•°æ®å·ã€‚</li></ul><hr><h5 id="start"><a href="#start" class="headerlink" title="start"></a><code>start</code></h5><p>æ ¼å¼ä¸º <code>docker-compose start [SERVICE...]</code>ã€‚</p><p>å¯åŠ¨å·²ç»å­˜åœ¨çš„æœåŠ¡å®¹å™¨ã€‚</p><hr><h5 id="stop"><a href="#stop" class="headerlink" title="stop"></a><code>stop</code></h5><p>æ ¼å¼ä¸º <code>docker-compose stop [options] [SERVICE...]</code>ã€‚</p><p>åœæ­¢å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ï¼Œä½†ä¸åˆ é™¤å®ƒã€‚é€šè¿‡ <code>docker-compose start</code> å¯ä»¥å†æ¬¡å¯åŠ¨è¿™äº›å®¹å™¨ã€‚</p><p>é€‰é¡¹ï¼š</p><ul><li><code>-t, --timeout TIMEOUT</code> åœæ­¢å®¹å™¨æ—¶å€™çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰ã€‚</li></ul><hr><h5 id="top"><a href="#top" class="headerlink" title="top"></a><code>top</code></h5><p>æŸ¥çœ‹å„ä¸ªæœåŠ¡å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹ã€‚</p><hr><h5 id="unpause"><a href="#unpause" class="headerlink" title="unpause"></a><code>unpause</code></h5><p>æ ¼å¼ä¸º <code>docker-compose unpause [SERVICE...]</code>ã€‚</p><p>æ¢å¤å¤„äºæš‚åœçŠ¶æ€ä¸­çš„æœåŠ¡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åºåˆ—åŒ–ä¹‹å‘</title>
    <link href="/2024/06/07/go/%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E5%9D%91/"/>
    <url>/2024/06/07/go/%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<h2 id="encoding-json"><a href="#encoding-json" class="headerlink" title="encoding&#x2F;json"></a>encoding&#x2F;json</h2><h3 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1 ä»‹ç»"></a>1 ä»‹ç»</h3><p>JSON ä½œä¸ºä¸€ç§æ•°æ®æ ¼å¼ï¼Œå®ƒçš„æ ¸å¿ƒåŠ¨ä½œå°±æ˜¯ä¸¤ä¸ªï¼š<strong>åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–</strong>ã€‚</p><p><strong>åºåˆ—åŒ–å°±æ˜¯æŠŠä¸€ä¸ª Go å¯¹è±¡è½¬åŒ–ä¸º JSON æ ¼å¼çš„å­—ç¬¦ä¸²ï¼ˆæˆ–å­—èŠ‚åºåˆ—ï¼Œè¿™ç‚¹åŒºåˆ«ä¸é‡è¦ï¼‰ï¼Œååºåˆ—åŒ–åˆ™ç›¸åï¼ŒæŠŠ JSON æ ¼å¼çš„æ•°æ®è½¬åŒ–æˆ Go å¯¹è±¡</strong>ã€‚</p><p>è¿™é‡Œè¯´çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¹¿ä¹‰çš„æ¦‚å¿µï¼Œä¸å•æŒ‡ç»“æ„ä½“å¯¹è±¡ï¼ŒåŒ…æ‹¬ sliceã€map ç±»å‹æ•°æ®ä¹Ÿæ”¯æŒ JSON çš„åºåˆ—åŒ–ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;encoding/json&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>    ID   <span class="hljs-type">uint</span><br>    Name <span class="hljs-type">string</span><br>    Age  <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-comment">// åºåˆ—åŒ– </span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MarshalPerson</span><span class="hljs-params">()</span></span> &#123;<br>    p := Person&#123;<br>        ID:   <span class="hljs-number">1</span>,<br>        Name: <span class="hljs-string">&quot;Bruce&quot;</span>,<br>        Age:  <span class="hljs-number">18</span>,<br>    &#125;<br>    output, err := json.Marshal(p)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-built_in">panic</span>(err)<br>    &#125;<br>    <span class="hljs-built_in">println</span>(<span class="hljs-type">string</span>(output))<br>&#125;<br><br><span class="hljs-comment">// ååºåˆ—åŒ–</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">UnmarshalPerson</span><span class="hljs-params">()</span></span> &#123;<br>    str := <span class="hljs-string">`&#123;&quot;ID&quot;:1,&quot;Name&quot;:&quot;Bruce&quot;,&quot;Age&quot;:18&#125;`</span><br>    <span class="hljs-keyword">var</span> p Person<br>    err := json.Unmarshal([]<span class="hljs-type">byte</span>(str), &amp;p)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-built_in">panic</span>(err)<br>    &#125;<br>    fmt.Printf(<span class="hljs-string">&quot;%+v\n&quot;</span>, p)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-å‘"><a href="#2-å‘" class="headerlink" title="2 å‘"></a>2 å‘</h3><h4 id="2-1-å…¬å¼€ï¼ˆpublicï¼‰æˆå‘˜å­—æ®µ"><a href="#2-1-å…¬å¼€ï¼ˆpublicï¼‰æˆå‘˜å­—æ®µ" class="headerlink" title="2.1 å…¬å¼€ï¼ˆpublicï¼‰æˆå‘˜å­—æ®µ"></a>2.1 å…¬å¼€ï¼ˆpublicï¼‰æˆå‘˜å­—æ®µ</h4><p><strong>å¦‚æœæˆ‘ä»¬ç”¨ç»“æ„ä½“æ¥æ“ä½œ JSONï¼Œé‚£ä¹ˆç»“æ„ä½“çš„æˆå‘˜å­—æ®µå¿…é¡»ä¸ºå…¬å¼€æˆå‘˜ï¼Œä¹Ÿå°±æ˜¯é¦–å­—æ¯å¤§å†™ï¼Œç§æœ‰æˆå‘˜æ— æ³•è¢«è§£æ</strong>ã€‚</p><p>åˆ—å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>    ID   <span class="hljs-type">uint</span><br>    Name <span class="hljs-type">string</span><br>    age  <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MarshalPerson</span><span class="hljs-params">()</span></span> &#123;<br>    p := Person&#123;<br>        ID:   <span class="hljs-number">1</span>,<br>        Name: <span class="hljs-string">&quot;Bruce&quot;</span>,<br>        age:  <span class="hljs-number">18</span>,<br>    &#125;<br>    output, err := json.Marshal(p)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-built_in">panic</span>(err)<br>    &#125;<br>    <span class="hljs-built_in">println</span>(<span class="hljs-type">string</span>(output))<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">UnmarshalPerson</span><span class="hljs-params">()</span></span> &#123;<br>    str := <span class="hljs-string">`&#123;&quot;ID&quot;:1,&quot;Name&quot;:&quot;Bruce&quot;,&quot;age&quot;:18&#125;`</span><br>    <span class="hljs-keyword">var</span> p Person<br>    err := json.Unmarshal([]<span class="hljs-type">byte</span>(str), &amp;p)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-built_in">panic</span>(err)<br>    &#125;<br>    fmt.Printf(<span class="hljs-string">&quot;%+v\n&quot;</span>, p)<br>&#125;<br><br><span class="hljs-comment">// Output Marshal:</span><br>&#123;<span class="hljs-string">&quot;ID&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-string">&quot;Bruce&quot;</span>&#125;<br><br><span class="hljs-comment">// Output Unmarshal:</span><br>&#123;ID:<span class="hljs-number">1</span> Name:Bruce age:<span class="hljs-number">0</span>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œ <code>age</code> è¢«è®¾ä¸ºäº†ç§æœ‰å˜é‡ï¼Œäºæ˜¯åºåˆ—åŒ–åçš„ JSON ä¸²ä¸­æ²¡æœ‰ <code>age</code> è¿™ä¸ªå­—æ®µäº†ã€‚åŒç†ï¼Œä»ä¸€ä¸ª JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º <code>Person</code> åï¼Œä¹Ÿæ— æ³•æ­£ç¡®è¯»å–åˆ° <code>age</code> çš„å€¼ã€‚</p><h4 id="2-2-å°‘ç”¨-map"><a href="#2-2-å°‘ç”¨-map" class="headerlink" title="2.2 å°‘ç”¨ map"></a>2.2 å°‘ç”¨ map</h4><p>JSON ä¸ä»…èƒ½æ“ä½œç»“æ„ä½“ï¼Œè¿˜èƒ½æ“ä½œ sliceã€map ç­‰ç±»å‹çš„æ•°æ®ã€‚slice æ¯”è¾ƒç‰¹æ®Šï¼Œä½† map å’Œç»“æ„ä½“è¡¨ç°åœ¨ JSON æ ¼å¼ä¸‹å…¶å®æ˜¯ä¸€æ ·çš„ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;ID&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;Name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Bruce&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œé™¤éæœ‰ç‰¹æƒ…å†µæˆ–éœ€æ±‚ï¼Œå¦åˆ™ï¼Œå°‘ç”¨ mapã€‚å› ä¸º map ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ï¼Œé¢å¤–çš„ä»£ç é‡ï¼Œä»¥åŠé¢å¤–çš„ç»´æŠ¤æˆæœ¬ã€‚</p><p>é¦–å…ˆï¼Œåƒä¸Šé¢çš„ Person ä¾‹å­ï¼Œç”±äº ID å’Œ Name æ˜¯ä¸åŒç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬å¦‚æœè¦ç”¨ map ååºåˆ—åŒ–è¿™ä¸ª JSON æ•°æ®ï¼Œå°±åªèƒ½ç”³æ˜ä¸€ä¸ª <code>map[string]any</code> ç±»å‹çš„ mapã€‚<code>any</code>ï¼Œä¹Ÿå°±æ˜¯ <code>interface&#123;&#125;</code> ï¼Œå°±æ„å‘³ç€æˆ‘ä»¬å¦‚æœè¦å•ç‹¬ä½¿ç”¨ Name æˆ– ID æ—¶ï¼Œéœ€è¦ç”¨ç±»å‹æ–­è¨€æ¥è½¬æ¢ç±»å‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> m <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any<br><span class="hljs-comment">// ...ååºåˆ—åŒ– JSON æ•°æ®ï¼Œä»£ç å¿½ç•¥...</span><br><span class="hljs-comment">// è·å–æˆå‘˜</span><br>name, ok := m[<span class="hljs-string">&quot;Name&quot;</span>].(<span class="hljs-type">string</span>)<br></code></pre></td></tr></table></figure><p>ç±»å‹æ–­è¨€æœ¬èº«å°±æ˜¯ä¸€ä¸ªé¢å¤–çš„æ­¥éª¤ï¼Œä¸ºé˜²æ­¢ panicï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ¤æ–­ç¬¬äºŒä¸ªå‚æ•° okï¼Œè¿™æ— ç–‘å¢åŠ äº†å¼€å‘å·¥ä½œé‡ä»¥åŠä»£ç è´Ÿæ‹…ã€‚</p><p>å¦å¤–ï¼Œmap æœ¬èº«å¯¹æ•°æ®å°±æ˜¯æ— çº¦æŸçš„ã€‚ç»“æ„ä½“ä¸­æˆ‘ä»¬èƒ½å¤Ÿé¢„å…ˆå®šä¹‰å„æˆå‘˜å­—æ®µä»¥åŠç±»å‹ï¼Œä½† map ä¸è¡Œã€‚è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡æ–‡æ¡£æˆ–æ³¨é‡Šæˆ–ä»£ç æœ¬èº«æ¥ç†è§£è¿™ä¸ª map é‡Œåˆ°åº•è£…äº†äº›ä»€ä¹ˆä¸œè¥¿ã€‚å¹¶ä¸”ï¼Œç»“æ„ä½“å¯ä»¥é™åˆ¶ JSON æ•°æ®çš„ key å’Œ value ç±»å‹ä¸è¢«ä¹±æ”¹ï¼Œè€Œ map åŒæ ·æ— æ³•çº¦æŸ JSON çš„å˜æ›´ï¼Œåªèƒ½é€šè¿‡ä¸šåŠ¡é€»è¾‘ä»£ç æ¥æ£€æµ‹ã€‚è¿™å…¶ä¸­çš„å·¥ä½œé‡å’ŒåæœŸç»´æŠ¤æˆæœ¬ï¼Œæƒ³æƒ³å°±çŸ¥é“ä¼šæœ‰å¤šå°‘ã€‚</p><h4 id="2-3-å°å¿ƒç»“æ„ä½“ç»„åˆ"><a href="#2-3-å°å¿ƒç»“æ„ä½“ç»„åˆ" class="headerlink" title="2.3 å°å¿ƒç»“æ„ä½“ç»„åˆ"></a>2.3 å°å¿ƒç»“æ„ä½“ç»„åˆ</h4><p>Go è™½ç„¶é¢å‘å¯¹è±¡ï¼Œä½†æ²¡æœ‰ <code>class</code> ï¼Œåªæœ‰ç»“æ„ä½“ï¼Œå¹¶ä¸”ç»“æ„ä½“æ²¡æœ‰ç»§æ‰¿ã€‚å› æ­¤ Go é‡‡ç”¨äº†ä¸€ç§ç»„åˆçš„æ–¹å¼æ¥å¤ç”¨ä¸åŒçš„ç»“æ„ä½“ã€‚å¾ˆå¤šæ—¶å€™ï¼Œè¿™ç§ç»„åˆç»™æˆ‘ä»¬å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ï¼Œæˆ‘ä»¬å¯ä»¥åƒæ“ä½œç»“æ„ä½“è‡ªå·±çš„æˆå‘˜ä¸€æ ·å»æ“ä½œç»„åˆçš„å…¶ä»–ç»“æ„ä½“æˆå‘˜ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs css">type Person struct &#123;<br>    ID   uint<br>    Name string<br>    <span class="hljs-selector-tag">address</span><br>&#125;<br><br>type <span class="hljs-selector-tag">address</span> struct &#123;<br>    <span class="hljs-selector-tag">Code</span>   int<br>    Street string<br>&#125;<br><br>func (<span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">address</span>) PrintAddr() &#123;<br>    fmt<span class="hljs-selector-class">.Println</span>(<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.Code</span>, <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.Street</span>)<br>&#125;<br><br>func Group() &#123;<br>    <span class="hljs-selector-tag">p</span> := Person&#123;<br>        ID:   <span class="hljs-number">1</span>,<br>        Name: <span class="hljs-string">&quot;Bruce&quot;</span>,<br>        address: address&#123;<br>            <span class="hljs-selector-tag">Code</span>:   <span class="hljs-number">100</span>,<br>            Street: <span class="hljs-string">&quot;Main St&quot;</span>,<br>        &#125;,<br>    &#125;<br>    // ç”¨ <span class="hljs-selector-tag">p</span> ç›´æ¥è®¿é—® <span class="hljs-selector-tag">Address</span> çš„æˆå‘˜å’Œæ–¹æ³•<br>    fmt<span class="hljs-selector-class">.Println</span>(<span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.Code</span>, <span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.Street</span>)<br>    <span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.PrintAddr</span>()<br>&#125;<br><br>// Output<br><span class="hljs-number">100</span> <span class="hljs-selector-tag">Main</span> St<br><span class="hljs-number">100</span> <span class="hljs-selector-tag">Main</span> St<br></code></pre></td></tr></table></figure><p>ä½†å½“æˆ‘ä»¬å°†ç»„åˆèå…¥åˆ° JSON çš„ä½¿ç”¨å½“ä¸­æ—¶ï¼Œè¿™é‡Œä¼šæœ‰ä¸€ä¸ªå°å‘éœ€è¦æ³¨æ„ã€‚æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// è¿™é‡Œç”¨çš„è¿˜æ˜¯å‰é¢çš„ç»“æ„ä½“ï¼Œå°±ä¸é‡å¤å†™äº†ã€‚error ä¹Ÿä¸æ•è·äº†ï¼ŒèŠ‚çœç¯‡å¹…ã€‚</span><br><br>func <span class="hljs-built_in">MarshalPerson</span>() &#123;<br>    <span class="hljs-selector-tag">p</span> := Person&#123;<br>        ID:   <span class="hljs-number">1</span>,<br>        Name: <span class="hljs-string">&quot;Bruce&quot;</span>,<br>        <span class="hljs-selector-tag">address</span>: address&#123;<br>            Code:   <span class="hljs-number">100</span>,<br>            Street: <span class="hljs-string">&quot;Main St&quot;</span>,<br>        &#125;,<br>    &#125;<br>    <span class="hljs-comment">// ç”¨ MarshalIndent æ‰“å°æ›´å¥½çœ‹ç‚¹</span><br>    output, _ := json<span class="hljs-selector-class">.MarshalIndent</span>(<span class="hljs-selector-tag">p</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;  &quot;</span>)<br>    <span class="hljs-built_in">println</span>(<span class="hljs-built_in">string</span>(output))<br>&#125;<br><br>func <span class="hljs-built_in">UnmarshalPerson</span>() &#123;<br>    str := `&#123;<span class="hljs-string">&quot;ID&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-string">&quot;Bruce&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:&#123;<span class="hljs-string">&quot;Code&quot;</span>:<span class="hljs-number">100</span>,<span class="hljs-string">&quot;Street&quot;</span>:<span class="hljs-string">&quot;Main St&quot;</span>&#125;&#125;`<br>    <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">p</span> Person<br>    _ = json<span class="hljs-selector-class">.Unmarshal</span>(<span class="hljs-selector-attr">[]</span><span class="hljs-built_in">byte</span>(str), &amp;p)<br>    fmt<span class="hljs-selector-class">.Printf</span>(<span class="hljs-string">&quot;%+v\n&quot;</span>, p)<br>&#125;<br><br><span class="hljs-comment">// Output MarshalPerson:</span><br>&#123;<br>  <span class="hljs-string">&quot;ID&quot;</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;Bruce&quot;</span>,<br>  <span class="hljs-string">&quot;Code&quot;</span>: <span class="hljs-number">100</span>,<br>  <span class="hljs-string">&quot;Street&quot;</span>: <span class="hljs-string">&quot;Main St&quot;</span><br>&#125;<br><br><span class="hljs-comment">// Ouptput UnmarshalPerson:</span><br>&#123;ID:<span class="hljs-number">1</span> Name:Bruce <span class="hljs-selector-tag">address</span>:&#123;Code:<span class="hljs-number">0</span> Street:&#125;&#125;<br></code></pre></td></tr></table></figure><p>ä½†å½“æˆ‘ä»¬å°†ç»„åˆèå…¥åˆ° JSON çš„ä½¿ç”¨å½“ä¸­æ—¶ï¼Œè¿™é‡Œä¼šæœ‰ä¸€ä¸ªå°å‘éœ€è¦æ³¨æ„ã€‚æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// è¿™é‡Œç”¨çš„è¿˜æ˜¯å‰é¢çš„ç»“æ„ä½“ï¼Œå°±ä¸é‡å¤å†™äº†ã€‚error ä¹Ÿä¸æ•è·äº†ï¼ŒèŠ‚çœç¯‡å¹…ã€‚</span><br><br>func <span class="hljs-built_in">MarshalPerson</span>() &#123;<br>    <span class="hljs-selector-tag">p</span> := Person&#123;<br>        ID:   <span class="hljs-number">1</span>,<br>        Name: <span class="hljs-string">&quot;Bruce&quot;</span>,<br>        <span class="hljs-selector-tag">address</span>: address&#123;<br>            Code:   <span class="hljs-number">100</span>,<br>            Street: <span class="hljs-string">&quot;Main St&quot;</span>,<br>        &#125;,<br>    &#125;<br>    <span class="hljs-comment">// ç”¨ MarshalIndent æ‰“å°æ›´å¥½çœ‹ç‚¹</span><br>    output, _ := json<span class="hljs-selector-class">.MarshalIndent</span>(<span class="hljs-selector-tag">p</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;  &quot;</span>)<br>    <span class="hljs-built_in">println</span>(<span class="hljs-built_in">string</span>(output))<br>&#125;<br><br>func <span class="hljs-built_in">UnmarshalPerson</span>() &#123;<br>    str := `&#123;<span class="hljs-string">&quot;ID&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-string">&quot;Bruce&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:&#123;<span class="hljs-string">&quot;Code&quot;</span>:<span class="hljs-number">100</span>,<span class="hljs-string">&quot;Street&quot;</span>:<span class="hljs-string">&quot;Main St&quot;</span>&#125;&#125;`<br>    <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">p</span> Person<br>    _ = json<span class="hljs-selector-class">.Unmarshal</span>(<span class="hljs-selector-attr">[]</span><span class="hljs-built_in">byte</span>(str), &amp;p)<br>    fmt<span class="hljs-selector-class">.Printf</span>(<span class="hljs-string">&quot;%+v\n&quot;</span>, p)<br>&#125;<br><br><span class="hljs-comment">// Output MarshalPerson:</span><br>&#123;<br>  <span class="hljs-string">&quot;ID&quot;</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;Bruce&quot;</span>,<br>  <span class="hljs-string">&quot;Code&quot;</span>: <span class="hljs-number">100</span>,<br>  <span class="hljs-string">&quot;Street&quot;</span>: <span class="hljs-string">&quot;Main St&quot;</span><br>&#125;<br><br><span class="hljs-comment">// Ouptput UnmarshalPerson:</span><br>&#123;ID:<span class="hljs-number">1</span> Name:Bruce <span class="hljs-selector-tag">address</span>:&#123;Code:<span class="hljs-number">0</span> Street:&#125;&#125;<br></code></pre></td></tr></table></figure><p>å…ˆçœ‹ <code>MarshalPerson</code> å‡½æ•°ã€‚è¿™é‡Œå…ˆç”³æ˜äº†ä¸€ä¸ª Person å¯¹è±¡ï¼Œç„¶åç”¨ <code>MarshalIndent</code> ç¾åŒ–ä¸€ä¸‹åºåˆ—åŒ–ç»“æœï¼Œå¹¶æ‰“å°ã€‚ä»æ‰“å°çš„ç»“æœä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œæ•´ä¸ª Person å¯¹è±¡è¢«<strong>é“ºå¹³</strong>äº†ã€‚å¯¹äº Person ç»“æ„ä½“æ¥è¯´ï¼Œå°½ç®¡ç”¨äº†ç»„åˆï¼Œä½†å®ƒçœ‹ä¸Šå»è¿˜æ˜¯æœ‰ä¸€ä¸ª <code>address</code> æˆå‘˜å­—æ®µã€‚æ‰€ä»¥æœ‰æ—¶å€™æˆ‘ä»¬ä¼šæƒ³å½“ç„¶åœ°ä»¥ä¸º Person åºåˆ—åŒ–åçš„ JSON é•¿è¿™æ ·ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> æƒ³è±¡ä¸­çš„ JSON åºåˆ—åŒ–ç»“æœ<br>&#123;<br>  <span class="hljs-string">&quot;ID&quot;</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;Bruce&quot;</span>,<br>  <span class="hljs-string">&quot;address&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;Code&quot;</span>: <span class="hljs-number">100</span>,<br>    <span class="hljs-string">&quot;Street&quot;</span>: <span class="hljs-string">&quot;Main St&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ï¼Œå®ƒè¢«é“ºå¹³äº†ã€‚è¿™ä¸€ç‚¹å€’æ˜¯æ¯”è¾ƒç¬¦åˆå‰é¢æˆ‘ä»¬ç›´æ¥é€šè¿‡ Person è®¿é—® address æˆå‘˜æ—¶çš„æ„Ÿè§‰ï¼Œå³ï¼Œaddress çš„æˆå‘˜ä¼¼ä¹ç›´æ¥å˜æˆäº† Person çš„æˆå‘˜ã€‚è¿™æ˜¯ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œç»„åˆä¼šè®©åºåˆ—åŒ–åçš„ JSON ç»“æœé“ºå¹³ã€‚</p><p>å¦ä¸€ä¸ªç¨å¾®æœ‰äº›åç›´è§‰çš„ç‚¹æ˜¯ï¼Œaddress ç»“æ„ä½“æ˜¯ä¸€ä¸ªç§æœ‰ç»“æ„ä½“ï¼Œè€Œç§æœ‰æˆå‘˜ä¼¼ä¹ä¸åº”è¯¥è¢«åºåˆ—åŒ–ï¼Ÿæ²¡é”™ï¼Œè¿™å°±æ˜¯ç»„åˆè¿™ç§å½¢å¼æœ‰ä¸€ç‚¹ä¸å¤ªå¥½çš„åœ°æ–¹äº†ï¼š<strong>å®ƒä¼šæš´éœ²ç§æœ‰ç»„åˆå¯¹è±¡çš„å…¬å…±æˆå‘˜</strong>ã€‚æ‰€ä»¥è¿™é‡Œå°±è¦æ³¨æ„äº†ï¼Œ<strong>è¿™ç§æš´éœ²æœ‰æ—¶å€™æ˜¯æ— æ„çš„ï¼Œä½†å®ƒå¯èƒ½ä¼šé€ æˆä¸å¿…è¦çš„æ•°æ®æ³„æ¼</strong>ã€‚</p><p>ç„¶åæ˜¯ <code>UnmarshalPerson</code> å‡½æ•°ã€‚æœ‰äº†ä¸Šä¸€ä¸ªå‡½æ•°çš„è§£è¯»ï¼Œè¿™ä¸ªå°±å¥½ç†è§£äº†ï¼Œå…¶å®è¿˜æ˜¯ç»„åˆå JSON ç»“æœè¢«é“ºå¹³çš„é—®é¢˜ã€‚å› æ­¤æˆ‘ä»¬å¦‚æœéœ€è¦ååºåˆ—åŒ–å› Person æ—¶ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªé“ºå¹³åçš„ JSON æ•°æ®ã€‚</p><p>å¯¹ Go çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°è¿™ç±»éœ€è¦è½¬åŒ–æˆ JSON çš„ç»“æ„ä½“æ—¶ï¼Œé€šå¸¸ä¸å¤ªä¼šç”¨ç»„åˆï¼Œé™¤éæœ‰ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µã€‚æ¯•ç«Ÿå®ƒå¤ªå®¹æ˜“å¸¦æ¥ä¸Šé¢æåŠçš„é—®é¢˜äº†ã€‚å¹¶ä¸”ï¼Œç”±äº JSON æ˜¯å¹³é“ºçš„è€Œç»“æ„ä½“å®šä¹‰ä¸Šæ²¡æœ‰å¹³é“ºï¼Œä¸€æ—¦è¿™ä¸ªç»“æ„ä½“ç»„è¢«å®šä¹‰çš„è¶Šæ¥è¶Šå¤æ‚ï¼Œé‚£ä¹ˆå®ƒå’ŒåŸå§‹é“ºå¹³çš„ JSON æ•°æ®å°±è¶Šéš¾å»ç›´è§‚å¯¹æ¯”äº†ï¼Œè¿™æ ·ä¼šä½¿è¿™ä¸ªä»£ç çš„å¯è¯»æ€§å°†ç›´çº¿ä¸‹é™ã€‚</p><p>å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚çš„è¯ï¼ˆè­¬å¦‚åŸå§‹ JSON æ•°æ®å°±æ˜¯å¹³é“ºçš„ï¼Œå¹¶ä¸”å­˜åœ¨å¤šä¸ªç»“æ„ä½“æœ‰é‡å¤å­—æ®µéœ€è¦å¤ç”¨ï¼‰ï¼Œä»æˆ‘ä¸ªäººçš„è§’åº¦å»ºè®®ï¼Œå°½é‡è¿™ä¹ˆå†™ï¼š</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">type</span> <span class="hljs-type">Person</span> struct &#123;<br>    <span class="hljs-type">ID</span>      int<br>    <span class="hljs-type">Name</span>    string<br>    <span class="hljs-type">Address</span> address<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-4-éƒ¨åˆ†æˆå‘˜ååºåˆ—åŒ–æ—¶éœ€è¦å°å¿ƒ"><a href="#2-4-éƒ¨åˆ†æˆå‘˜ååºåˆ—åŒ–æ—¶éœ€è¦å°å¿ƒ" class="headerlink" title="2.4 éƒ¨åˆ†æˆå‘˜ååºåˆ—åŒ–æ—¶éœ€è¦å°å¿ƒ"></a>2.4 éƒ¨åˆ†æˆå‘˜ååºåˆ—åŒ–æ—¶éœ€è¦å°å¿ƒ</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs stylus">type Person struct &#123;<br>    ID   uint<br>    Name string<br>&#125;<br><br><span class="hljs-comment">// PartUpdateIssue æ¨¡æ‹Ÿäº†ç”¨åŒä¸€ä¸ªç»“æ„ä½“è§£æä¸¤ä¸ªä¸åŒçš„ JSON å­—ç¬¦ä¸²çš„åœºæ™¯</span><br>func <span class="hljs-built_in">PartUpdateIssue</span>() &#123;<br>    <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">p</span> Person<br>    <span class="hljs-comment">// ç¬¬ä¸€ä¸ªæ•°æ®æœ‰ ID å­—æ®µï¼Œä¸”ä¸ä¸º 0</span><br>    str := `&#123;<span class="hljs-string">&quot;ID&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-string">&quot;Bruce&quot;</span>&#125;`<br>    _ = json<span class="hljs-selector-class">.Unmarshal</span>(<span class="hljs-selector-attr">[]</span><span class="hljs-built_in">byte</span>(str), &amp;p)<br>    fmt<span class="hljs-selector-class">.Printf</span>(<span class="hljs-string">&quot;%+v\n&quot;</span>, p)<br>    <span class="hljs-comment">// ç¬¬äºŒä¸ªæ•°æ®æ²¡æœ‰ ID å­—æ®µï¼Œå†æ¬¡ç”¨ p ååºåˆ—åŒ–ï¼Œä¼šä¿ç•™ä¸Šæ¬¡çš„å€¼</span><br>    str = `&#123;<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-string">&quot;Jim&quot;</span>&#125;`<br>    _ = json<span class="hljs-selector-class">.Unmarshal</span>(<span class="hljs-selector-attr">[]</span><span class="hljs-built_in">byte</span>(str), &amp;p)<br>    <span class="hljs-comment">// æ³¨æ„è¾“å‡ºçš„ ID ä»ç„¶æ˜¯ 1</span><br>    fmt<span class="hljs-selector-class">.Printf</span>(<span class="hljs-string">&quot;%+v\n&quot;</span>, p)<br>&#125;<br><br><span class="hljs-comment">// Output</span><br>&#123;ID:<span class="hljs-number">1</span> Name:Bruce&#125;<br>&#123;ID:<span class="hljs-number">1</span> Name:Jim&#125;<br></code></pre></td></tr></table></figure><p><strong>å½“æˆ‘ä»¬ç”¨åŒä¸€ä¸ªç»“æ„ä½“å»åå¤ååºåˆ—åŒ–ä¸åŒçš„ JSON æ•°æ®æ—¶ï¼Œä¸€æ—¦æŸä¸ª JSON æ•°æ®çš„å€¼åªåŒ…å«éƒ¨åˆ†æˆå‘˜å­—æ®µçš„ï¼Œé‚£ä¹ˆæœªè¢«è¦†ç›–åˆ°çš„æˆå‘˜å°±ä¼šæ®‹ç•™ä¸Šä¸€æ¬¡ååºåˆ—åŒ–çš„å€¼</strong>ã€‚å…¶å®å°±æ˜¯ä¸ªè„æ•°æ®æ±¡æŸ“çš„é—®é¢˜ã€‚</p><p>è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼š<strong>æ¯æ¬¡ååºåˆ—åŒ– JSON æ—¶ï¼Œéƒ½ä½¿ç”¨å…¨æ–°çš„ç»“æ„ä½“å¯¹è±¡æ¥åŠ è½½æ•°æ®</strong>ã€‚</p><h4 id="2-5-å¤„ç†æŒ‡é’ˆæˆå‘˜"><a href="#2-5-å¤„ç†æŒ‡é’ˆæˆå‘˜" class="headerlink" title="2.5 å¤„ç†æŒ‡é’ˆæˆå‘˜"></a>2.5 å¤„ç†æŒ‡é’ˆæˆå‘˜</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>    ID      <span class="hljs-type">uint</span><br>    Name    <span class="hljs-type">string</span><br>    Address *Address<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">UnmarshalPtr</span><span class="hljs-params">()</span></span> &#123;<br>    str := <span class="hljs-string">`&#123;&quot;ID&quot;:1,&quot;Name&quot;:&quot;Bruce&quot;&#125;`</span><br>    <span class="hljs-keyword">var</span> p Person<br>    _ = json.Unmarshal([]<span class="hljs-type">byte</span>(str), &amp;p)<br>    fmt.Printf(<span class="hljs-string">&quot;%+v\n&quot;</span>, p)<br>    <span class="hljs-comment">// ä¸‹é¢è¿™è¡Œä¼š panic</span><br>    <span class="hljs-comment">// fmt.Printf(&quot;%+v\n&quot;, p.Address.Street)</span><br>&#125;<br><br><span class="hljs-comment">// Output</span><br>&#123;ID:<span class="hljs-number">1</span> Name:Bruce Address:&lt;<span class="hljs-literal">nil</span>&gt;&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å°† <code>Address</code> æˆå‘˜å®šä¹‰ä¸ºä¸€ä¸ªæŒ‡é’ˆï¼Œæ­¤æ—¶æˆ‘ä»¬å»ååºåˆ—åŒ–ä¸€æ®µä¸åŒ…å« <code>Address</code> çš„ JSON æ•°æ®æ—¶ï¼Œè¿™ä¸ªæŒ‡é’ˆæˆå‘˜ç”±äºæ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œä¼šè¢«ç½®ä¸º nilã€‚<code>encoding/json</code> ä¸ä¼šä¸ºè¯¥æˆå‘˜åˆ›å»ºä¸€ä¸ªç©ºçš„ <code>&amp;Address</code> ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬ç›´æ¥è°ƒç”¨ <code>p.Address.xxx</code> ï¼Œç¨‹åºå°±ä¼šå› ä¸º <code>p.Address</code> ä¸ºç©ºè€Œ panicã€‚</p><p><strong>å¦‚æœæˆ‘ä»¬çš„ç»“æ„ä½“æˆå‘˜å­˜åœ¨æŒ‡é’ˆæ—¶ï¼Œä½¿ç”¨å‰è¯·è®°å¾—åˆ¤æ–­æŒ‡é’ˆæ˜¯å¦ä¸ºç©º</strong>ã€‚</p><p>åœ¨åˆ›å»ºä¸€ä¸ªæœ‰æŒ‡é’ˆå­—æ®µçš„ç»“æ„ä½“æ—¶ï¼ŒæŒ‡é’ˆå­—æ®µçš„èµ‹å€¼ä¹Ÿä¼šç›¸å¯¹éº»çƒ¦ä¸€äº›ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>    ID   <span class="hljs-type">int</span>    <br>    Name <span class="hljs-type">string</span> <br>    Age  *<span class="hljs-type">int</span>   <br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Foo</span><span class="hljs-params">()</span></span> &#123;<br>    p := Person&#123;<br>        ID:   <span class="hljs-number">1</span>,<br>        Name: <span class="hljs-string">&quot;Bruce&quot;</span>,<br>        Age:  <span class="hljs-built_in">new</span>(<span class="hljs-type">int</span>),<br>    &#125;<br>    *p.Age = <span class="hljs-number">20</span><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-6-é›¶å€¼é€ æˆçš„æ··æ·†"><a href="#2-6-é›¶å€¼é€ æˆçš„æ··æ·†" class="headerlink" title="2.6 é›¶å€¼é€ æˆçš„æ··æ·†"></a>2.6 é›¶å€¼é€ æˆçš„æ··æ·†</h4><p>æ‰€è°“é›¶å€¼ï¼Œæ˜¯ Golang ä¸­å˜é‡çš„ä¸€ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•ç†è§£ä¸ºé»˜è®¤å€¼ã€‚å³å¦‚æœæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼åœ°ä¸ºæŸä¸ªå˜é‡èµ‹å€¼ï¼Œåˆ™ Golang ä¸ºä¸ºå…¶èµ‹ä¸€ä¸ªé»˜è®¤å€¼ã€‚è­¬å¦‚å‰æ–‡çš„ä¾‹å­ä¸­æˆ‘ä»¬å·²ç»çœ‹åˆ°çš„ï¼Œint é»˜è®¤å€¼ 0ï¼Œstring ç©ºå­—ç¬¦ä¸²ï¼ŒæŒ‡é’ˆé›¶å€¼ä¸º nil ç­‰ç­‰ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs stylus">type Person struct &#123;<br>    Name        string<br>    ChildrenCnt int<br>&#125;<br><br>func <span class="hljs-built_in">ZeroValueConfusion</span>() &#123;<br>    str := `&#123;<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-string">&quot;Bruce&quot;</span>&#125;`<br>    <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">p</span> Person<br>    _ = json<span class="hljs-selector-class">.Unmarshal</span>(<span class="hljs-selector-attr">[]</span><span class="hljs-built_in">byte</span>(str), &amp;p)<br>    fmt<span class="hljs-selector-class">.Printf</span>(<span class="hljs-string">&quot;%+v\n&quot;</span>, p)<br><br>    str2 := `&#123;<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-string">&quot;Jim&quot;</span>,<span class="hljs-string">&quot;ChildrenCnt&quot;</span>:<span class="hljs-number">0</span>&#125;`<br>    <span class="hljs-selector-tag">var</span> p2 Person<br>    _ = json<span class="hljs-selector-class">.Unmarshal</span>(<span class="hljs-selector-attr">[]</span><span class="hljs-built_in">byte</span>(str2), &amp;p2)<br>    fmt<span class="hljs-selector-class">.Printf</span>(<span class="hljs-string">&quot;%+v\n&quot;</span>, p2)<br>&#125;<br><br><span class="hljs-comment">// Output</span><br>&#123;Name:Bruce ChildrenCnt:<span class="hljs-number">0</span>&#125;<br>&#123;Name:Jim ChildrenCnt:<span class="hljs-number">0</span>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ <code>Person</code> ç»“æ„ä½“ä¸­æ·»åŠ äº†ä¸€ä¸ª <code>ChildrenCnt</code> å­—æ®µï¼Œç”¨äºç»Ÿè®¡è¯¥äººç‰©çš„å­å¥³æ•°é‡ã€‚ç”±äºé›¶å€¼çš„å­˜åœ¨ï¼Œå½“ <code>p</code> åŠ è½½çš„ JSON æ•°æ®é‡Œæ²¡æœ‰ <code>ChildrenCnt</code> æ•°æ®æ—¶ï¼Œè¯¥å­—æ®µè¢«èµ‹äºˆ 0ã€‚æ­¤æ—¶å°±äº§ç”Ÿäº†è¯¯è§£ï¼š<strong>æˆ‘ä»¬æ— æ³•å°†è¿™ç§æ•°æ®ç¼ºå¤±çš„å¯¹è±¡ï¼Œä¸å­å¥³æ•°ç¡®å®ä¸º 0 çš„å¯¹è±¡åŒºåˆ†å¼€</strong>ã€‚å¦‚ä¾‹å­é‡Œçš„ Bruce å’Œ Jimï¼Œä¸€ä¸ªæ˜¯æ•°æ®ç¼ºå¤±å¯¼è‡´çš„å­å¥³æ•°ä¸º 0ï¼Œå¦ä¸€ä¸ªæ˜¯æœ¬æ¥å°±ä¸º 0ã€‚è€Œå®é™…ä¸Š Bruce çš„å­å¥³æ•°é‡åº”è¯¥æ˜¯â€œæœªçŸ¥â€œï¼Œæˆ‘ä»¬å¦‚æœçœŸå½“ä½œ 0 å¤„ç†ï¼Œåœ¨ä¸šåŠ¡ä¸Šå¯èƒ½å°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚</p><p><strong>è§£å†³åŠæ³•</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>    Name        <span class="hljs-type">string</span><br>    ChildrenCnt *<span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-comment">// Output</span><br>&#123;Name:Bruce ChildrenCnt:&lt;<span class="hljs-literal">nil</span>&gt;&#125;<br>&#123;Name:Jim ChildrenCnt:<span class="hljs-number">0xc0000124c8</span>&#125;<br></code></pre></td></tr></table></figure><p>åŒºåˆ«äº§ç”Ÿäº†ã€‚Bruce æ²¡æœ‰æ•°æ®ï¼Œæ‰€ä»¥ <code>ChildrenCnt</code> æ˜¯ä¸ª nilï¼Œè€Œ Jim åˆ™æ˜¯ä¸€ä¸ªéç©ºæŒ‡é’ˆã€‚æ­¤æ—¶å°±èƒ½æ˜ç¡®åœ°çŸ¥æ™“ï¼ŒBruce çš„å­å¥³æ•°é‡æ˜¯æœªçŸ¥äº†ã€‚</p><p>æœ¬è´¨ä¸Šè¿™ç§æ–¹å¼è¿˜æ˜¯åˆ©ç”¨äº†é›¶å€¼ï¼ŒæŒ‡é’ˆçš„é›¶å€¼</p><h4 id="2-7-æ ‡ç­¾çš„å‘"><a href="#2-7-æ ‡ç­¾çš„å‘" class="headerlink" title="2.7 æ ‡ç­¾çš„å‘"></a>2.7 æ ‡ç­¾çš„å‘</h4><p>æ ‡ç­¾ä¹Ÿæ˜¯ Golang ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå¹¶ä¸”å¸¸ä¸ JSON ç›¸ä¼´ã€‚è€Œä¸”å…¶å®ç”¨è¿‡ Go æ ‡ç­¾çš„è¯»è€…ä»¬åº”è¯¥çŸ¥é“ï¼Œæ ‡ç­¾å…¶å®æ˜¯ä¸€ä¸ªéå¸¸çµæ´»ã€å¥½ç”¨çš„ä¸œè¥¿ã€‚é‚£è¿™æ ·çš„å¥½ç‰¹æ€§ï¼Œåœ¨ä½¿ç”¨ä¸Šä¼šæœ‰ä»€ä¹ˆå‘è¦æ³¨æ„å‘¢ï¼Ÿ</p><p>ä¸€ä¸ªæ˜¯åç§°é—®é¢˜ã€‚Tag å¯ä»¥æŒ‡å®š JSON æ•°æ®ä¸­å­—æ®µçš„åç§°æ˜¾ç¤ºï¼Œè¿™ç‚¹å¾ˆçµæ´»ä¸”å®ç”¨ï¼Œä½†å®ƒåŒæ—¶ä¹Ÿå®¹æ˜“å‡ºé”™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> PersonWrong <span class="hljs-keyword">struct</span> &#123;<br>    FirstName <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;last_name&quot;`</span><br>    LastName  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;first_name&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>omitempty</code> + <strong>é›¶å€¼çš„ç»„åˆæœ‰å…³</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>    Name        <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;person_name&quot;`</span><br>    ChildrenCnt <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;cnt,omitempty&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TagMarshal</span><span class="hljs-params">()</span></span> &#123;<br>    p := Person&#123;<br>        Name:        <span class="hljs-string">&quot;Bruce&quot;</span>,<br>        ChildrenCnt: <span class="hljs-number">0</span>,<br>    &#125;<br>    output, _ := json.MarshalIndent(p, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;  &quot;</span>)<br>    <span class="hljs-built_in">println</span>(<span class="hljs-type">string</span>(output))<br>&#125;<br><br><span class="hljs-comment">// Output</span><br>&#123;<br>  <span class="hljs-string">&quot;person_name&quot;</span>: <span class="hljs-string">&quot;Bruce&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨æ–°å»ºç»“æ„ä½“å¯¹è±¡ <code>p</code> æ—¶ï¼Œä¸º <code>ChildrenCnt</code> èµ‹å€¼ä¸º 0ã€‚è€Œå› ä¸º <code>omitempty</code> æ ‡ç­¾çš„å­˜åœ¨ï¼Œ<strong>å®ƒä½¿å¾— JSON è¢«åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–æ—¶ï¼Œå¿½ç•¥ç©ºï¼ˆemptyï¼‰å€¼ã€‚åœ¨åºåˆ—åŒ–æ—¶çš„è¡¨ç°å°±æ˜¯ï¼Œè¾“å‡ºçš„ JSON æ•°æ®é‡Œä¸åŒ…å« <code>ChildrenCnt</code>ï¼Œçœ‹ä¸Šå»å°±åƒæ˜¯æ²¡æœ‰è¿™ä¸ªæ•°æ®ã€‚ä»€ä¹ˆæ˜¯ç©ºå€¼ï¼Ÿå°±æ˜¯é›¶å€¼</strong>ã€‚</p><p>è¿™ç§ <code>omitempty</code> çš„é—®é¢˜åˆè¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿç”±äºæœ¬è´¨ä¸Šè¿˜æ˜¯é›¶å€¼æƒ¹å¾—ç¥¸ï¼Œæ‰€ä»¥ï¼Œç”¨æŒ‡é’ˆã€‚</p><h3 id="3-mapåºåˆ—åŒ–"><a href="#3-mapåºåˆ—åŒ–" class="headerlink" title="3 mapåºåˆ—åŒ–"></a>3 mapåºåˆ—åŒ–</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// åºåˆ—åŒ– åˆ›å»ºä¸€ä¸ªmap</span><br>myMap := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<br><span class="hljs-string">&quot;name&quot;</span>:  <span class="hljs-string">&quot;Alice&quot;</span>,<br><span class="hljs-string">&quot;age&quot;</span>:   <span class="hljs-number">30</span>,<br><span class="hljs-string">&quot;hobby&quot;</span>: []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;reading&quot;</span>, <span class="hljs-string">&quot;cycling&quot;</span>&#125;,<br>&#125;<br><span class="hljs-comment">// å°†mapè½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²</span><br>jsonBytes, err := json.Marshal(myMap)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Error marshaling map to JSON:&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-comment">// å°†JSONå­—èŠ‚åˆ‡ç‰‡è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ‰“å°</span><br>jsonString := <span class="hljs-type">string</span>(jsonBytes)<br>fmt.Println(jsonString)<br>    <span class="hljs-comment">//è¾“å‡º  &#123;&quot;name&quot;:&quot;Alice&quot;,&quot;age&quot;:30,&quot;hobby&quot;:[&quot;reading&quot;,&quot;cycling&quot;]&#125;</span><br><br>    <br>    <span class="hljs-comment">// ååºåˆ—åŒ–  å®šä¹‰ä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆ</span><br>jsonString := <span class="hljs-string">`&#123;&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30, &quot;is_student&quot;: false&#125;`</span><br><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªç©ºçš„mapï¼Œç”¨äºå­˜æ”¾è§£ç åçš„æ•°æ®ï¼Œé”®ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå€¼ä¸ºinterface&#123;&#125;</span><br><span class="hljs-keyword">var</span> person <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;<br><span class="hljs-comment">// ä½¿ç”¨json.Unmarshalå°†JSONå­—ç¬¦ä¸²è§£ç åˆ°mapä¸­</span><br>err := json.Unmarshal([]<span class="hljs-type">byte</span>(jsonString), &amp;person)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Error unmarshaling JSON:&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-comment">// æ‰“å°è§£ç åçš„mapå†…å®¹</span><br>fmt.Println(person)<br>    <span class="hljs-comment">//è¾“å‡º  map[age:30 is_student:false name:Alice]</span><br>    <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-åˆ‡ç‰‡åºåˆ—åŒ–"><a href="#4-åˆ‡ç‰‡åºåˆ—åŒ–" class="headerlink" title="4 åˆ‡ç‰‡åºåˆ—åŒ–"></a>4 åˆ‡ç‰‡åºåˆ—åŒ–</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;encoding/json&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// åºåˆ—åŒ– åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡</span><br>fruits := []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;apple&quot;</span>, <span class="hljs-string">&quot;banana&quot;</span>, <span class="hljs-string">&quot;cherry&quot;</span>&#125;<br><span class="hljs-comment">// å°†åˆ‡ç‰‡è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²</span><br>jsonBytes, err := json.Marshal(fruits)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Error marshaling slice to JSON:&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-comment">// å°†JSONå­—èŠ‚åˆ‡ç‰‡è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ‰“å°</span><br>jsonString := <span class="hljs-type">string</span>(jsonBytes)<br>fmt.Println(jsonString)<br>    <span class="hljs-comment">// è¾“å‡º [&quot;apple&quot;,&quot;banana&quot;,&quot;cherry&quot;]</span><br>    <br>    <span class="hljs-comment">// ååºåˆ—åŒ–</span><br>    <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„</span><br>jsonString := <span class="hljs-string">`[&quot;apple&quot;, &quot;banana&quot;, &quot;cherry&quot;]`</span><br><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œç”¨äºå­˜æ”¾è§£ç åçš„æ•°æ®</span><br><span class="hljs-keyword">var</span> fruits []<span class="hljs-type">string</span><br><span class="hljs-comment">// ä½¿ç”¨json.Unmarshalå°†JSONå­—ç¬¦ä¸²è§£ç åˆ°åˆ‡ç‰‡ä¸­</span><br>err := json.Unmarshal([]<span class="hljs-type">byte</span>(jsonString), &amp;fruits)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Error unmarshaling JSON: %v&quot;</span>, err)<br>&#125;<br><span class="hljs-comment">// æ‰“å°è§£ç åçš„åˆ‡ç‰‡</span><br>fmt.Println(fruits)<br>    <span class="hljs-comment">// è¾“å‡º    [apple banana cherry]</span><br>     <br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gvmç‰ˆæœ¬ç®¡ç†</title>
    <link href="/2024/05/27/go/GO%E8%A7%A3%E9%87%8A%E5%99%A8%E5%A4%9A%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85/"/>
    <url>/2024/05/27/go/GO%E8%A7%A3%E9%87%8A%E5%99%A8%E5%A4%9A%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h1 id="GOè§£é‡Šå™¨å¤šç‰ˆæœ¬å®‰è£…"><a href="#GOè§£é‡Šå™¨å¤šç‰ˆæœ¬å®‰è£…" class="headerlink" title="GOè§£é‡Šå™¨å¤šç‰ˆæœ¬å®‰è£…"></a>GOè§£é‡Šå™¨å¤šç‰ˆæœ¬å®‰è£…</h1><h2 id="1ã€å®‰è£…gç‰ˆæœ¬ç®¡ç†å·¥å…·"><a href="#1ã€å®‰è£…gç‰ˆæœ¬ç®¡ç†å·¥å…·" class="headerlink" title="1ã€å®‰è£…gç‰ˆæœ¬ç®¡ç†å·¥å…·"></a>1ã€å®‰è£…<a href="https://github.com/voidint/g/blob/master/README_CN.md">gç‰ˆæœ¬ç®¡ç†å·¥å…·</a></h2><h3 id="Linux-macOSï¼ˆé€‚ç”¨äº-bashã€zshï¼‰"><a href="#Linux-macOSï¼ˆé€‚ç”¨äº-bashã€zshï¼‰" class="headerlink" title="Linux&#x2F;macOSï¼ˆé€‚ç”¨äº bashã€zshï¼‰"></a>Linux&#x2F;macOSï¼ˆé€‚ç”¨äº bashã€zshï¼‰</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å»ºè®®å®‰è£…å‰æ¸…ç©º`GOROOT`ã€`GOBIN`ç­‰ç¯å¢ƒå˜é‡</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">curl -sSL https://raw.githubusercontent.com/voidint/g/master/install.sh | bash</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;unalias g&quot;</span> &gt;&gt; ~/.bashrc <span class="hljs-comment"># å¯é€‰ã€‚è‹¥å…¶ä»–ç¨‹åºï¼ˆå¦‚&#x27;git&#x27;ï¼‰ä½¿ç”¨äº†&#x27;g&#x27;ä½œä¸ºåˆ«åã€‚</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">source</span> <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.g/env&quot;</span></span><br></code></pre></td></tr></table></figure><h2 id="2ã€ä½¿ç”¨å‘½ä»¤"><a href="#2ã€ä½¿ç”¨å‘½ä»¤" class="headerlink" title="2ã€ä½¿ç”¨å‘½ä»¤"></a>2ã€ä½¿ç”¨å‘½ä»¤</h2><h3 id="æŸ¥è¯¢å½“å‰å¯ä¾›å®‰è£…çš„stableçŠ¶æ€çš„-go-ç‰ˆæœ¬"><a href="#æŸ¥è¯¢å½“å‰å¯ä¾›å®‰è£…çš„stableçŠ¶æ€çš„-go-ç‰ˆæœ¬" class="headerlink" title="æŸ¥è¯¢å½“å‰å¯ä¾›å®‰è£…çš„stableçŠ¶æ€çš„ go ç‰ˆæœ¬"></a>æŸ¥è¯¢å½“å‰å¯ä¾›å®‰è£…çš„<code>stable</code>çŠ¶æ€çš„ go ç‰ˆæœ¬</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">g ls-remote stable<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…ç›®æ ‡-go-ç‰ˆæœ¬1-20-5"><a href="#å®‰è£…ç›®æ ‡-go-ç‰ˆæœ¬1-20-5" class="headerlink" title="å®‰è£…ç›®æ ‡ go ç‰ˆæœ¬1.20.5"></a>å®‰è£…ç›®æ ‡ go ç‰ˆæœ¬<code>1.20.5</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">g install 1.14.7</span><br>Downloading 100% [===============] (92/92 MB, 12 MB/s)               <br>Computing checksum with SHA256<br>Checksums matched<br>Now using go1.20.5<br></code></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢å·²å®‰è£…çš„-go-ç‰ˆæœ¬"><a href="#æŸ¥è¯¢å·²å®‰è£…çš„-go-ç‰ˆæœ¬" class="headerlink" title="æŸ¥è¯¢å·²å®‰è£…çš„ go ç‰ˆæœ¬"></a>æŸ¥è¯¢å·²å®‰è£…çš„ <code>go</code> ç‰ˆæœ¬</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">g <span class="hljs-built_in">ls</span></span><br>  1.19.10<br>* 1.20.5<br></code></pre></td></tr></table></figure><h3 id="åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå·²å®‰è£…çš„-go-ç‰ˆæœ¬"><a href="#åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå·²å®‰è£…çš„-go-ç‰ˆæœ¬" class="headerlink" title="åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå·²å®‰è£…çš„ go ç‰ˆæœ¬"></a>åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå·²å®‰è£…çš„ <code>go</code> ç‰ˆæœ¬</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">g use 1.19.10</span><br>go version go1.19.10 darwin/arm64<br></code></pre></td></tr></table></figure><h3 id="å¸è½½ä¸€ä¸ªå·²å®‰è£…çš„-go-ç‰ˆæœ¬"><a href="#å¸è½½ä¸€ä¸ªå·²å®‰è£…çš„-go-ç‰ˆæœ¬" class="headerlink" title="å¸è½½ä¸€ä¸ªå·²å®‰è£…çš„ go ç‰ˆæœ¬"></a>å¸è½½ä¸€ä¸ªå·²å®‰è£…çš„ go ç‰ˆæœ¬</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">g uninstall 1.19.10</span><br>Uninstalled go1.19.10<br></code></pre></td></tr></table></figure><h3 id="æ¸…ç©º-go-å®‰è£…åŒ…æ–‡ä»¶ç¼“å­˜"><a href="#æ¸…ç©º-go-å®‰è£…åŒ…æ–‡ä»¶ç¼“å­˜" class="headerlink" title="æ¸…ç©º go å®‰è£…åŒ…æ–‡ä»¶ç¼“å­˜"></a>æ¸…ç©º go å®‰è£…åŒ…æ–‡ä»¶ç¼“å­˜</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">g clean</span> <br>Remove go1.18.10.darwin-arm64.tar.gz<br>Remove go1.19.10.darwin-arm64.tar.gz<br>Remove go1.20.5.darwin-arm64.tar.gz<br></code></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-g-ç‰ˆæœ¬ä¿¡æ¯"><a href="#æŸ¥çœ‹-g-ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ g ç‰ˆæœ¬ä¿¡æ¯"></a>æŸ¥çœ‹ g ç‰ˆæœ¬ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">g version 1.5.0<br>build: 2023-01-01T21:01:52+08:00<br>branch: master<br>commit: cec84a3f4f927adb05018731a6f60063fd2fa216<br></code></pre></td></tr></table></figure><h3 id="æ›´æ–°-g-è½¯ä»¶æœ¬èº«"><a href="#æ›´æ–°-g-è½¯ä»¶æœ¬èº«" class="headerlink" title="æ›´æ–° g è½¯ä»¶æœ¬èº«"></a>æ›´æ–° g è½¯ä»¶æœ¬èº«</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">g self update</span><br>You are up to date! g v1.5.0 is the latest version.<br></code></pre></td></tr></table></figure><h3 id="å¸è½½-g-è½¯ä»¶æœ¬èº«"><a href="#å¸è½½-g-è½¯ä»¶æœ¬èº«" class="headerlink" title="å¸è½½ g è½¯ä»¶æœ¬èº«"></a>å¸è½½ g è½¯ä»¶æœ¬èº«</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">g self uninstall</span><br>Are you sure you want to uninstall g? (Y/n)<br>y<br>Remove /Users/voidint/.g/bin/g<br>Remove /Users/voidint/.g<br></code></pre></td></tr></table></figure><h2 id="3ã€GoLandé…ç½®-goè§£é‡Šå™¨"><a href="#3ã€GoLandé…ç½®-goè§£é‡Šå™¨" class="headerlink" title="3ã€GoLandé…ç½® goè§£é‡Šå™¨"></a>3ã€GoLandé…ç½® goè§£é‡Šå™¨</h2><h3 id="ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹è§£é‡Šå™¨è·¯å¾„"><a href="#ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹è§£é‡Šå™¨è·¯å¾„" class="headerlink" title="ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹è§£é‡Šå™¨è·¯å¾„"></a>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹è§£é‡Šå™¨è·¯å¾„</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">mhd@mhd-VirtualBox:~/.g$ which go<br><br><span class="hljs-regexp">/home/m</span>hd<span class="hljs-regexp">/.g/g</span>o<span class="hljs-regexp">/bin/g</span>o<span class="hljs-comment">#è·¯å¾„åœ°å€</span><br><br></code></pre></td></tr></table></figure><h3 id="GOland-ä¸­é…ç½®è§£é‡Šå™¨åœ°å€"><a href="#GOland-ä¸­é…ç½®è§£é‡Šå™¨åœ°å€" class="headerlink" title="GOland ä¸­é…ç½®è§£é‡Šå™¨åœ°å€"></a>GOland ä¸­é…ç½®è§£é‡Šå™¨åœ°å€</h3><p><img src="https://raw.githubusercontent.com/gondmhd/blogImage/main/img/202310241722115.png" alt="image-20231024172234898"></p><h3 id="è®¾ç½®ä»£ç†åŠå¼€å¯modleæ¨¡å¼"><a href="#è®¾ç½®ä»£ç†åŠå¼€å¯modleæ¨¡å¼" class="headerlink" title="è®¾ç½®ä»£ç†åŠå¼€å¯modleæ¨¡å¼"></a>è®¾ç½®ä»£ç†åŠå¼€å¯modleæ¨¡å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs she">go env -w GO111MODULE=on<br>go env -w GOPROXY=https://goproxy.io,direct<br><br>goproxy<br>https://goproxy.io/zh/<br>é˜¿é‡Œäº‘<br>https://mirrors.aliyun.com/goproxy/<br>ä¸ƒç‰›äº‘<br>https://goproxy.cn<br></code></pre></td></tr></table></figure><h3 id="ä¸‹è½½ä¾èµ–"><a href="#ä¸‹è½½ä¾èµ–" class="headerlink" title="ä¸‹è½½ä¾èµ–"></a>ä¸‹è½½ä¾èµ–</h3><p>ä»¥ go çš„ web æ¡†æ¶ gin ä¸ºä¾‹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> go get <span class="hljs-literal">-u</span> github.com/<span class="hljs-built_in">gin</span><span class="hljs-literal">-gonic</span>/<span class="hljs-built_in">gin</span><br></code></pre></td></tr></table></figure><h3 id="æ¿€æ´»ç "><a href="#æ¿€æ´»ç " class="headerlink" title="æ¿€æ´»ç "></a><strong>æ¿€æ´»ç </strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">X96MBT55FM-eyJsaWNlbnNlSWQiOiJYOTZNQlQ1NUZNIiwibGljZW5zZWVOYW1lIjoiQWRtaW4iLCJhc3NpZ25lZU5hbWUiOiJndXJnbGVzIHR1bWJsZXMiLCJhc3NpZ25lZUVtYWlsIjoiIiwibGljZW5zZVJlc3RyaWN0aW9uIjoiIiwiY2hlY2tDb25jdXJyZW50VXNlIjpmYWxzZSwicHJvZHVjdHMiOlt7ImNvZGUiOiJJSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjYtMTItMzEiLCJwYWlkVXBUbyI6IjIwMjYtMTItMzEiLCJleHRlbmRlZCI6ZmFsc2UsInByb3BlcnRpZXMiOnt9fSx7ImNvZGUiOiJBQyIsImZhbGxiYWNrRGF0ZSI6IjIwMjYtMTItMzEiLCJwYWlkVXBUbyI6IjIwMjYtMTItMzEiLCJleHRlbmRlZCI6ZmFsc2UsInByb3BlcnRpZXMiOnt9fSx7ImNvZGUiOiJEUE4iLCJmYWxsYmFja0RhdGUiOiIyMDI2LTEyLTMxIiwicGFpZFVwVG8iOiIyMDI2LTEyLTMxIiwiZXh0ZW5kZWQiOmZhbHNlLCJwcm9wZXJ0aWVzIjp7fX0seyJjb2RlIjoiUFMiLCJmYWxsYmFja0RhdGUiOiIyMDI2LTEyLTMxIiwicGFpZFVwVG8iOiIyMDI2LTEyLTMxIiwiZXh0ZW5kZWQiOmZhbHNlLCJwcm9wZXJ0aWVzIjp7fX0seyJjb2RlIjoiR08iLCJmYWxsYmFja0RhdGUiOiIyMDI2LTEyLTMxIiwicGFpZFVwVG8iOiIyMDI2LTEyLTMxIiwiZXh0ZW5kZWQiOmZhbHNlLCJwcm9wZXJ0aWVzIjp7fX0seyJjb2RlIjoiQ0wiLCJmYWxsYmFja0RhdGUiOiIyMDI2LTEyLTMxIiwicGFpZFVwVG8iOiIyMDI2LTEyLTMxIiwiZXh0ZW5kZWQiOmZhbHNlLCJwcm9wZXJ0aWVzIjp7fX0seyJjb2RlIjoiRE0iLCJmYWxsYmFja0RhdGUiOiIyMDI2LTEyLTMxIiwicGFpZFVwVG8iOiIyMDI2LTEyLTMxIiwiZXh0ZW5kZWQiOmZhbHNlLCJwcm9wZXJ0aWVzIjp7fX0seyJjb2RlIjoiUlMwIiwiZmFsbGJhY2tEYXRlIjoiMjAyNi0xMi0zMSIsInBhaWRVcFRvIjoiMjAyNi0xMi0zMSIsImV4dGVuZGVkIjpmYWxzZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IkRTIiwiZmFsbGJhY2tEYXRlIjoiMjAyNi0xMi0zMSIsInBhaWRVcFRvIjoiMjAyNi0xMi0zMSIsImV4dGVuZGVkIjpmYWxzZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IlJDIiwiZmFsbGJhY2tEYXRlIjoiMjAyNi0xMi0zMSIsInBhaWRVcFRvIjoiMjAyNi0xMi0zMSIsImV4dGVuZGVkIjpmYWxzZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IlJEIiwiZmFsbGJhY2tEYXRlIjoiMjAyNi0xMi0zMSIsInBhaWRVcFRvIjoiMjAyNi0xMi0zMSIsImV4dGVuZGVkIjpmYWxzZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IlBDIiwiZmFsbGJhY2tEYXRlIjoiMjAyNi0xMi0zMSIsInBhaWRVcFRvIjoiMjAyNi0xMi0zMSIsImV4dGVuZGVkIjpmYWxzZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IlJNIiwiZmFsbGJhY2tEYXRlIjoiMjAyNi0xMi0zMSIsInBhaWRVcFRvIjoiMjAyNi0xMi0zMSIsImV4dGVuZGVkIjpmYWxzZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IldTIiwiZmFsbGJhY2tEYXRlIjoiMjAyNi0xMi0zMSIsInBhaWRVcFRvIjoiMjAyNi0xMi0zMSIsImV4dGVuZGVkIjpmYWxzZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IkRCIiwiZmFsbGJhY2tEYXRlIjoiMjAyNi0xMi0zMSIsInBhaWRVcFRvIjoiMjAyNi0xMi0zMSIsImV4dGVuZGVkIjpmYWxzZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IkRDIiwiZmFsbGJhY2tEYXRlIjoiMjAyNi0xMi0zMSIsInBhaWRVcFRvIjoiMjAyNi0xMi0zMSIsImV4dGVuZGVkIjpmYWxzZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IlBEQiIsImZhbGxiYWNrRGF0ZSI6IjIwMjYtMTItMzEiLCJwYWlkVXBUbyI6IjIwMjYtMTItMzEiLCJleHRlbmRlZCI6dHJ1ZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IkFJTCIsImZhbGxiYWNrRGF0ZSI6IjIwMjYtMTItMzEiLCJwYWlkVXBUbyI6IjIwMjYtMTItMzEiLCJleHRlbmRlZCI6dHJ1ZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjYtMTItMzEiLCJwYWlkVXBUbyI6IjIwMjYtMTItMzEiLCJleHRlbmRlZCI6dHJ1ZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IkFJUCIsImZhbGxiYWNrRGF0ZSI6IjIwMjYtMTItMzEiLCJwYWlkVXBUbyI6IjIwMjYtMTItMzEiLCJleHRlbmRlZCI6dHJ1ZSwicHJvcGVydGllcyI6e319LHsiY29kZSI6IlBDV01QIiwiZmFsbGJhY2tEYXRlIjoiMjAyNi0xMi0zMSIsInBhaWRVcFRvIjoiMjAyNi0xMi0zMSIsImV4dGVuZGVkIjp0cnVlLCJwcm9wZXJ0aWVzIjp7fX1dLCJtZXRhZGF0YSI6IjAxMjAyMzA1MTFQU0FOMDAwMDA1IiwiaGFzaCI6IlRSSUFMOjIwMTYuMSIsImdyYWNlUGVyaW9kRGF5cyI6MywiYXV0b1Byb2xvbmdhdGVkIjpmYWxzZSwiaXNBdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlfQ==-H9cXz3HGk4xN+0HYnyyYfhzVvXIIxr5xy1B5v/dxKU9rGr/nxnKBSlw6fVNvlNVS4tHDEYA3WEFap2xRO01Geoa9Sg1QPMQKDtfjCEKIDAKvbZLqp/coHX0pAS13tW1ILvyjGDaPhSo2UiXLHWMymW1m0iGJFHphbW2wWFlF5qqVnL15/iV5FNt9xFOwU6R1s2BTBpnHj/UUxrrv4x4m7jv9y3FvN4/Gn9U6SmUmvrla7K2Rn/yvn7DoAnV7z1A65x3BkMfaQVzsmJcjz7APnb/bnuKQckCGBovsy7FeqQqARg/WQRovQdkw2xeV/2txX6NxdEX8K0smrbqSIV2v7A==-MIIETzCCAjegAwIBAgIEU7kY4TANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIyMTAxMDE2MDU0NFoXDTI0MTAxMTE2MDU0NFowHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMjEwMTAwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCojNikMNM0jfXiA2dNmAi0vGQovFKiSkpw1vlr8LmIdkgGoUhlLQi45oHJgvLQOqqXEW7SmbZIRf7eKW0txBkhryKIWDh3VbcpvySP8fJ27gRfx4+1f3zBxWLvMnlyTMlsmXkm8uSKg0aHRBlqzAtLdpWGAFf11V3CfAA/UNPKDvVGfLC2nAwzVYz3DBpHHp4fq3eRglSJ77nKj8pAuLi/Kj6eq3EAXcxFR/2LXY6FydezbCMTaAQWRAuYLcrOpXiQYXGaohmmjXluxmDo3vB/H13mPohCpC9eFWXD4LWRnyr3AaxLDUTmYkVEYzN7r7bneh6pJXrdxL8T+fQ/uYzPAgMBAAGjgZkwgZYwSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TAJBgNVHRMEAjAAMBMGA1UdJQQMMAoGCCsGAQUFBwMBMAsGA1UdDwQEAwIFoDAdBgNVHQ4EFgQUrr79B9v2lrPP+wiumX6HlmSazsYwDQYJKoZIhvcNAQELBQADggIBACThwgi/0iU8tdgJ4BvSK236PuI0VmyK+uuluf0w3Ywr7VGs8oVj++EqRYQlMQMbtleRmrWQjg/86E1gO0MSVqua9rMti7AJEkq8nnslgvxqqr3mu9afre+hNDWJZTaOd5UaUtyCR61hPnonMyeZG7jmbgKsf2LML/9Bcbfjvpf7NqkWwssafzmyiq9PSJ/VFdWilahOFcaS2r88hL83b8/9W89sCCHxAq7O+FIygm0qhxw+WdGlvJDlF/YW73fb+aC2wNxzGt6X1aQoU/D/RfxoqpMVUrk+KoR0CSzhGp2NuLC2BeBa4XfsBpkyiQykLr2iWrgz7YjKCCf3kRoR1UPWOTC9sW4peivHBzOjDzRxEuxqU/Ue4DcQXkXWsgMbhRJPwSxEIsLhU7AfV78mGPaVmrTP/T9gDjvK0kIjJnvklElVL0yj7IW6dRJY3S+sjRwE9s1EBNXqoJvyA8FL6uUmNoBP3U6usxuGPLwpWh/jVQSM4KTccYBJmS+VBYmOoPSgBPGAMgPhkv9IBpGNVdhKx+QsituMvoXnR9OMOH8wKQWxWcqFlg88jZPkoxBu3X4mDx189BOr64Vc+CfKSVIhckAItafNR70Two8lEn61aNNTk2zZ/bvsYsEivOSEeHAxOj8g4YbLt3ptkI/BbiOChGFZlTN3h/l41M6zt04M<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éªŒè¯æœºåˆ¶</title>
    <link href="/2024/05/27/go/Session%E3%80%81Cookie%E3%80%81Token%E4%BB%8B%E7%BB%8D/"/>
    <url>/2024/05/27/go/Session%E3%80%81Cookie%E3%80%81Token%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="Sessionã€Cookieã€Token"><a href="#Sessionã€Cookieã€Token" class="headerlink" title="Sessionã€Cookieã€Token"></a>Sessionã€Cookieã€Token</h1><p><strong>Cookie å’Œ Session</strong></p><p>HTTP åè®®æ˜¯ä¸€ç§<code>æ— çŠ¶æ€åè®®</code>ï¼Œå³æ¯æ¬¡æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œéƒ½æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¹¶ä¸çŸ¥é“å®¢æˆ·ç«¯çš„å†å²è¯·æ±‚è®°å½•ï¼›Session å’Œ Cookie çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†å¼¥è¡¥ HTTP çš„æ— çŠ¶æ€ç‰¹æ€§ã€‚</p><p><img src="https://raw.githubusercontent.com/gondmhd/blogImage/main/img/202401300936290.png" alt="image-20240130093625230"></p><p><strong>Session æ˜¯ä»€ä¹ˆ</strong></p><p>å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¼šä¸ºè¿™æ¬¡è¯·æ±‚å¼€è¾Ÿä¸€å—<code>å†…å­˜ç©ºé—´</code>ï¼Œè¿™ä¸ªå¯¹è±¡ä¾¿æ˜¯ Session å¯¹è±¡ï¼Œå­˜å‚¨ç»“æ„ä¸º <code>ConcurrentHashMap</code>ã€‚Session å¼¥è¡¥äº† HTTP æ— çŠ¶æ€ç‰¹æ€§ï¼ŒæœåŠ¡å™¨å¯ä»¥åˆ©ç”¨ Session å­˜å‚¨å®¢æˆ·ç«¯åœ¨åŒä¸€ä¸ªä¼šè¯æœŸé—´çš„ä¸€äº›æ“ä½œè®°å½•ã€‚</p><p><strong>Session å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¼šè¯</strong></p><p>æœåŠ¡å™¨ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå¼€è¾Ÿäº†ä¸€å— Session ç©ºé—´ï¼ˆåˆ›å»ºäº†Sessionå¯¹è±¡ï¼‰ï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ª sessionId ï¼Œå¹¶é€šè¿‡å“åº”å¤´çš„ **Set-Cookieï¼šJSESSIONID&#x3D;XXXXXXX **å‘½ä»¤ï¼Œå‘å®¢æˆ·ç«¯å‘é€è¦æ±‚è®¾ç½® Cookie çš„å“åº”ï¼› å®¢æˆ·ç«¯æ”¶åˆ°å“åº”åï¼Œåœ¨æœ¬æœºå®¢æˆ·ç«¯è®¾ç½®äº†ä¸€ä¸ª **JSESSIONID&#x3D;XXXXXXX **çš„ Cookie ä¿¡æ¯ï¼Œè¯¥ Cookie çš„è¿‡æœŸæ—¶é—´ä¸ºæµè§ˆå™¨ä¼šè¯ç»“æŸï¼›</p><p><img src="https://raw.githubusercontent.com/gondmhd/blogImage/main/img/202401300938228.png" alt="image-20240130093802188"></p><p>æ¥ä¸‹æ¥å®¢æˆ·ç«¯æ¯æ¬¡å‘åŒä¸€ä¸ªç½‘ç«™å‘é€è¯·æ±‚æ—¶ï¼Œè¯·æ±‚å¤´éƒ½ä¼šå¸¦ä¸Šè¯¥ Cookieä¿¡æ¯ï¼ˆåŒ…å« sessionId ï¼‰ï¼Œ ç„¶åï¼ŒæœåŠ¡å™¨é€šè¿‡è¯»å–è¯·æ±‚å¤´ä¸­çš„ Cookie ä¿¡æ¯ï¼Œè·å–åç§°ä¸º JSESSIONID çš„å€¼ï¼Œå¾—åˆ°æ­¤æ¬¡è¯·æ±‚çš„ sessionIdã€‚</p><p><strong>Session çš„ç¼ºç‚¹</strong></p><p>Session æœºåˆ¶æœ‰ä¸ªç¼ºç‚¹ï¼Œæ¯”å¦‚ A æœåŠ¡å™¨å­˜å‚¨äº† Sessionï¼Œå°±æ˜¯åšäº†<a href="https://cloud.tencent.com/product/clb?from_column=20065&from=20065">è´Ÿè½½å‡è¡¡</a>åï¼Œå‡å¦‚ä¸€æ®µæ—¶é—´å†… A çš„è®¿é—®é‡æ¿€å¢ï¼Œä¼šè½¬å‘åˆ° B è¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯ B æœåŠ¡å™¨å¹¶æ²¡æœ‰å­˜å‚¨ A çš„ Sessionï¼Œä¼šå¯¼è‡´ Session çš„å¤±æ•ˆã€‚</p><p><strong>Cookies æ˜¯ä»€ä¹ˆ</strong></p><p>HTTP åè®®ä¸­çš„ Cookie åŒ…æ‹¬ <code>Web Cookie</code> å’Œ<code>æµè§ˆå™¨ Cookie</code>ï¼Œå®ƒæ˜¯æœåŠ¡å™¨å‘é€åˆ° Web æµè§ˆå™¨çš„ä¸€å°å—æ•°æ®ã€‚æœåŠ¡å™¨å‘é€åˆ°æµè§ˆå™¨çš„ Cookieï¼Œæµè§ˆå™¨ä¼šè¿›è¡Œå­˜å‚¨ï¼Œå¹¶ä¸ä¸‹ä¸€ä¸ªè¯·æ±‚ä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨ã€‚é€šå¸¸ï¼Œå®ƒç”¨äºåˆ¤æ–­ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªäºåŒä¸€ä¸ªæµè§ˆå™¨ï¼Œä¾‹å¦‚ç”¨æˆ·ä¿æŒç™»å½•çŠ¶æ€ã€‚</p><ul><li>HTTP Cookie æœºåˆ¶æ˜¯ HTTP åè®®æ— çŠ¶æ€çš„ä¸€ç§è¡¥å……å’Œæ”¹è‰¯</li></ul><p>Cookie ä¸»è¦ç”¨äºä¸‹é¢ä¸‰ä¸ªç›®çš„</p><ul><li><code>ä¼šè¯ç®¡ç†</code></li></ul><p>ç™»é™†ã€è´­ç‰©è½¦ã€æ¸¸æˆå¾—åˆ†æˆ–è€…æœåŠ¡å™¨åº”è¯¥è®°ä½çš„å…¶ä»–å†…å®¹</p><ul><li><code>ä¸ªæ€§åŒ–</code></li></ul><p>ç”¨æˆ·åå¥½ã€ä¸»é¢˜æˆ–è€…å…¶ä»–è®¾ç½®</p><ul><li><code>è¿½è¸ª</code></li></ul><p>è®°å½•å’Œåˆ†æç”¨æˆ·è¡Œä¸º</p><p>Cookie æ›¾ç»ç”¨äºä¸€èˆ¬çš„å®¢æˆ·ç«¯å­˜å‚¨ã€‚è™½ç„¶è¿™æ˜¯åˆæ³•çš„ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨å®¢æˆ·ç«¯ä¸Šå­˜å‚¨æ•°æ®çš„å”¯ä¸€æ–¹æ³•ï¼Œä½†å¦‚ä»Šå»ºè®®ä½¿ç”¨ç°ä»£å­˜å‚¨ APIã€‚Cookie éšæ¯ä¸ªè¯·æ±‚ä¸€èµ·å‘é€ï¼Œå› æ­¤å®ƒä»¬å¯èƒ½ä¼šé™ä½æ€§èƒ½ï¼ˆå°¤å…¶æ˜¯å¯¹äºç§»åŠ¨æ•°æ®è¿æ¥è€Œè¨€ï¼‰ã€‚</p><p><strong>åˆ›å»º Cookie</strong></p><p>å½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘å‡ºçš„ HTTP è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘é€å¸¦æœ‰å“åº”çš„ <code>Set-Cookie</code> æ ‡å¤´ï¼ŒCookie é€šå¸¸ç”±æµè§ˆå™¨å­˜å‚¨ï¼Œç„¶åå°† Cookie ä¸ HTTP æ ‡å¤´ä¸€åŒå‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ã€‚</p><p><strong>Set-Cookie å’Œ Cookie æ ‡å¤´</strong></p><p><code>Set-Cookie</code> HTTP å“åº”æ ‡å¤´å°† cookie ä»æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·ä»£ç†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå‘é€ Cookie çš„ä¾‹å­</p><p><img src="https://raw.githubusercontent.com/gondmhd/blogImage/main/img/202401300939222.png" alt="image-20240130093928179"></p><p>æ­¤æ ‡å¤´å‘Šè¯‰å®¢æˆ·ç«¯å­˜å‚¨ Cookie</p><p>ç°åœ¨ï¼Œéšç€å¯¹æœåŠ¡å™¨çš„æ¯ä¸ªæ–°è¯·æ±‚ï¼Œæµè§ˆå™¨å°†ä½¿ç”¨ Cookie å¤´å°†æ‰€æœ‰ä»¥å‰å­˜å‚¨çš„ Cookie å‘é€å›æœåŠ¡å™¨ã€‚</p><p><img src="https://raw.githubusercontent.com/gondmhd/blogImage/main/img/202401300939966.png" alt="image-20240130093948900"></p><p>æœ‰ä¸¤ç§ç±»å‹çš„ Cookiesï¼Œä¸€ç§æ˜¯ Session Cookiesï¼Œä¸€ç§æ˜¯ Persistent Cookiesï¼Œå¦‚æœ Cookie ä¸åŒ…å«åˆ°æœŸæ—¥æœŸï¼Œåˆ™å°†å…¶è§†ä¸ºä¼šè¯ Cookieã€‚ä¼šè¯ Cookie å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ°¸è¿œä¸ä¼šå†™å…¥ç£ç›˜ï¼Œå½“æµè§ˆå™¨å…³é—­æ—¶ï¼Œæ­¤å Cookie å°†æ°¸ä¹…ä¸¢å¤±ã€‚å¦‚æœ Cookie åŒ…å«<code>æœ‰æ•ˆæœŸ</code> ï¼Œåˆ™å°†å…¶è§†ä¸ºæŒä¹…æ€§ Cookieã€‚åœ¨åˆ°æœŸæŒ‡å®šçš„æ—¥æœŸï¼ŒCookie å°†ä»ç£ç›˜ä¸­åˆ é™¤ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ˜¯ <code>Cookieçš„ Secure å’Œ HttpOnly æ ‡è®°</code></p><p><strong>ä¼šè¯ Cookies</strong></p><p>ä¸Šé¢çš„ç¤ºä¾‹åˆ›å»ºçš„æ˜¯ä¼šè¯ Cookie ï¼Œä¼šè¯ Cookie æœ‰ä¸ªç‰¹å¾ï¼Œå®¢æˆ·ç«¯å…³é—­æ—¶ Cookie ä¼šåˆ é™¤ï¼Œå› ä¸ºå®ƒæ²¡æœ‰æŒ‡å®š<code>Expires</code>æˆ– <code>Max-Age</code> æŒ‡ä»¤ã€‚</p><p>ä½†æ˜¯ï¼ŒWeb æµè§ˆå™¨å¯èƒ½ä¼šä½¿ç”¨ä¼šè¯è¿˜åŸï¼Œè¿™ä¼šä½¿å¤§å¤šæ•°ä¼šè¯ Cookie ä¿æŒæ°¸ä¹…çŠ¶æ€ï¼Œå°±åƒä»æœªå…³é—­è¿‡æµè§ˆå™¨ä¸€æ ·ã€‚</p><p><strong>æ°¸ä¹…æ€§ Cookies</strong></p><p>æ°¸ä¹…æ€§ Cookie ä¸ä¼šåœ¨å®¢æˆ·ç«¯å…³é—­æ—¶è¿‡æœŸï¼Œè€Œæ˜¯åœ¨<code>ç‰¹å®šæ—¥æœŸï¼ˆExpiresï¼‰</code>æˆ–<code>ç‰¹å®šæ—¶é—´é•¿åº¦ï¼ˆMax-Ageï¼‰</code>å¤–è¿‡æœŸã€‚ä¾‹å¦‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Set</span>-<span class="hljs-title class_">Cookie</span>: id=a3fWa; <span class="hljs-title class_">Expires</span>=<span class="hljs-title class_">Wed</span>, <span class="hljs-number">21</span> <span class="hljs-title class_">Oct</span> <span class="hljs-number">2015</span> <span class="hljs-number">07</span>:<span class="hljs-number">28</span>:<span class="hljs-number">00</span> <span class="hljs-variable constant_">GMT</span>;<br></code></pre></td></tr></table></figure><p><strong>Cookie çš„ Secure å’Œ HttpOnly æ ‡è®°</strong></p><p>å®‰å…¨çš„ Cookie éœ€è¦ç»è¿‡ HTTPS åè®®é€šè¿‡åŠ å¯†çš„æ–¹å¼å‘é€åˆ°æœåŠ¡å™¨ã€‚å³ä½¿æ˜¯å®‰å…¨çš„ï¼Œä¹Ÿä¸åº”è¯¥å°†æ•æ„Ÿä¿¡æ¯å­˜å‚¨åœ¨cookie ä¸­ï¼Œå› ä¸ºå®ƒä»¬æœ¬è´¨ä¸Šæ˜¯ä¸å®‰å…¨çš„ï¼Œå¹¶ä¸”æ­¤æ ‡å¿—ä¸èƒ½æä¾›çœŸæ­£çš„ä¿æŠ¤ã€‚</p><p><strong>HttpOnly çš„ä½œç”¨</strong></p><ul><li>ä¼šè¯ Cookie ä¸­ç¼ºå°‘ HttpOnly å±æ€§ä¼šå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡ç¨‹åº(JSè„šæœ¬ã€Appletç­‰)è·å–åˆ°ç”¨æˆ·çš„ Cookie ä¿¡æ¯ï¼Œé€ æˆç”¨æˆ· Cookie ä¿¡æ¯æ³„éœ²ï¼Œå¢åŠ æ”»å‡»è€…çš„è·¨ç«™è„šæœ¬æ”»å‡»å¨èƒã€‚ </li><li>HttpOnly æ˜¯å¾®è½¯å¯¹ Cookie åšçš„æ‰©å±•ï¼Œè¯¥å€¼æŒ‡å®š Cookie æ˜¯å¦å¯é€šè¿‡å®¢æˆ·ç«¯è„šæœ¬è®¿é—®ã€‚ </li><li>å¦‚æœåœ¨ Cookie ä¸­æ²¡æœ‰è®¾ç½® HttpOnly å±æ€§ä¸º trueï¼Œå¯èƒ½å¯¼è‡´ Cookie è¢«çªƒå–ã€‚çªƒå–çš„ Cookie å¯ä»¥åŒ…å«æ ‡è¯†ç«™ç‚¹ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ ASP.NET ä¼šè¯ ID æˆ– Forms <a href="https://cloud.tencent.com/product/mfas?from_column=20065&from=20065">èº«ä»½éªŒè¯</a>ç¥¨è¯ï¼Œæ”»å‡»è€…å¯ä»¥é‡æ’­çªƒå–çš„ Cookieï¼Œä»¥ä¾¿ä¼ªè£…æˆç”¨æˆ·æˆ–è·å–æ•æ„Ÿä¿¡æ¯ï¼Œè¿›è¡Œè·¨ç«™è„šæœ¬æ”»å‡»ç­‰ã€‚</li></ul><h4 id="Cookie-çš„ä½œç”¨åŸŸ"><a href="#Cookie-çš„ä½œç”¨åŸŸ" class="headerlink" title="Cookie çš„ä½œç”¨åŸŸ"></a>Cookie çš„ä½œç”¨åŸŸ</h4><p><code>Domain</code> å’Œ <code>Path</code> æ ‡è¯†å®šä¹‰äº† Cookie çš„ä½œç”¨åŸŸï¼šå³ Cookie åº”è¯¥å‘é€ç»™å“ªäº› URLã€‚</p><p><code>Domain</code> æ ‡è¯†æŒ‡å®šäº†å“ªäº›ä¸»æœºå¯ä»¥æ¥å— Cookieã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸ºå½“å‰ä¸»æœº(ä¸åŒ…å«å­åŸŸåï¼‰ã€‚å¦‚æœæŒ‡å®šäº†<code>Domain</code>ï¼Œåˆ™ä¸€èˆ¬åŒ…å«å­åŸŸåã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½® <code>Domain=mozilla.org</code>ï¼Œåˆ™ Cookie ä¹ŸåŒ…å«åœ¨å­åŸŸåä¸­ï¼ˆå¦‚<code>developer.mozilla.org</code>ï¼‰ã€‚</p><p>ä¾‹å¦‚ï¼Œè®¾ç½® <code>Path=/docs</code>ï¼Œåˆ™ä»¥ä¸‹åœ°å€éƒ½ä¼šåŒ¹é…ï¼š</p><ul><li><code>/docs</code></li><li><code>/docs/Web/</code></li><li><code>/docs/Web/HTTP</code></li></ul><p><strong>JWT å’Œ Session Cookies çš„ç›¸åŒä¹‹å¤„</strong></p><p>åœ¨æ¢è®¨ JWT å’Œ Session Cookies ä¹‹å‰ï¼Œæœ‰å¿…è¦éœ€è¦å…ˆå»ç†è§£ä¸€ä¸‹å®ƒä»¬çš„ç›¸åŒä¹‹å¤„ã€‚</p><p>å®ƒä»¬æ—¢å¯ä»¥å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åœ¨ç”¨æˆ·å•å‡»è¿›å…¥ä¸åŒé¡µé¢æ—¶ä»¥åŠç™»é™†ç½‘ç«™æˆ–åº”ç”¨ç¨‹åºåè¿›è¡Œèº«ä»½éªŒè¯ã€‚</p><p>å¦‚æœæ²¡æœ‰è¿™ä¸¤è€…ï¼Œé‚£ä½ å¯èƒ½éœ€è¦åœ¨æ¯ä¸ªé¡µé¢åˆ‡æ¢æ—¶éƒ½éœ€è¦è¿›è¡Œç™»å½•äº†ã€‚å› ä¸º HTTP æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åè®®ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€å½“ä½ è®¿é—®æŸä¸ªç½‘é¡µï¼Œç„¶åå•å‡»åŒä¸€ç«™ç‚¹ä¸Šçš„å¦ä¸€ä¸ªé¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨çš„<code>å†…å­˜ä¸­</code>å°†ä¸ä¼šè®°ä½ä½ ä¹‹å‰çš„æ“ä½œã€‚</p><p><img src="https://raw.githubusercontent.com/gondmhd/blogImage/main/img/202401300942289.png" alt="image-20240130094231244"></p><p>å› æ­¤ï¼Œå¦‚æœä½ ç™»å½•å¹¶è®¿é—®äº†ä½ æœ‰æƒè®¿é—®çš„å¦ä¸€ä¸ªé¡µé¢ï¼Œç”±äº HTTP ä¸ä¼šè®°å½•ä½ åˆšåˆšç™»å½•çš„ä¿¡æ¯ï¼Œå› æ­¤ä½ å°†å†æ¬¡ç™»å½•ã€‚</p><p><strong>JWT å’Œ Session Cookies å°±æ˜¯ç”¨æ¥å¤„ç†åœ¨ä¸åŒé¡µé¢ä¹‹é—´åˆ‡æ¢ï¼Œä¿å­˜ç”¨æˆ·ç™»å½•ä¿¡æ¯çš„æœºåˆ¶ã€‚</strong></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸¤ç§æŠ€æœ¯éƒ½æ˜¯ç”¨æ¥ä¿å­˜ä½ çš„ç™»å½•çŠ¶æ€ï¼Œèƒ½å¤Ÿè®©ä½ åœ¨æµè§ˆä»»æ„å—å¯†ç ä¿æŠ¤çš„ç½‘ç«™ã€‚é€šè¿‡åœ¨æ¯æ¬¡äº§ç”Ÿæ–°çš„è¯·æ±‚æ—¶å¯¹ç”¨æˆ·æ•°æ®è¿›è¡Œèº«ä»½éªŒè¯æ¥è§£å†³æ­¤é—®é¢˜ã€‚</p><p>æ‰€ä»¥ JWT å’Œ Session Cookies çš„ç›¸åŒä¹‹å¤„æ˜¯ä»€ä¹ˆï¼Ÿé‚£å°±æ˜¯å®ƒä»¬èƒ½å¤Ÿæ”¯æŒä½ åœ¨å‘é€ä¸åŒè¯·æ±‚ä¹‹é—´ï¼Œè®°å½•å¹¶éªŒè¯ä½ çš„ç™»å½•çŠ¶æ€çš„ä¸€ç§æœºåˆ¶ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯-Session-Cookies"><a href="#ä»€ä¹ˆæ˜¯-Session-Cookies" class="headerlink" title="ä»€ä¹ˆæ˜¯ Session Cookies"></a>ä»€ä¹ˆæ˜¯ Session Cookies</h4><p>Session Cookies ä¹Ÿç§°ä¸º<code>ä¼šè¯ Cookies</code>ï¼Œåœ¨ Session Cookies ä¸­ï¼Œç”¨æˆ·çš„ç™»å½•çŠ¶æ€ä¼šä¿å­˜åœ¨<code>æœåŠ¡å™¨</code>çš„<code>å†…å­˜</code>ä¸­ã€‚å½“ç”¨æˆ·ç™»å½•æ—¶ï¼ŒSession å°±è¢«æœåŠ¡ç«¯å®‰å…¨çš„åˆ›å»ºã€‚</p><p>åœ¨æ¯æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨éƒ½ä¼šä»ä¼šè¯ Cookie ä¸­è¯»å– SessionIdï¼Œå¦‚æœæœåŠ¡ç«¯çš„æ•°æ®å’Œè¯»å–çš„ SessionId ç›¸åŒï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šå‘é€å“åº”ç»™æµè§ˆå™¨ï¼Œå…è®¸ç”¨æˆ·ç™»å½•ã€‚</p><p><img src="https://raw.githubusercontent.com/gondmhd/blogImage/main/img/202401300944091.png" alt="image-20240130094404035"></p><p><strong>token</strong> ä»¤ç‰Œï¼Œæ˜¯ç”¨æˆ·èº«ä»½çš„éªŒè¯æ–¹å¼ã€‚ æœ€ç®€å•çš„tokenç»„æˆ:uid(ç”¨æˆ·å”¯ä¸€çš„<a href="https://cloud.tencent.com/solution/tb-digitalid?from_column=20065&from=20065">èº«ä»½æ ‡è¯†</a>)ã€timeï¼ˆå½“å‰æ—¶é—´çš„æ—¶é—´æˆ³ï¼‰ã€signï¼ˆç­¾åï¼‰ã€‚ <strong>å¯¹Tokenè®¤è¯çš„äº”ç‚¹è®¤è¯†</strong></p><ul><li>ä¸€ä¸ªTokenå°±æ˜¯ä¸€äº›ä¿¡æ¯çš„é›†åˆï¼›</li><li>åœ¨Tokenä¸­åŒ…å«è¶³å¤Ÿå¤šçš„ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨åç»­è¯·æ±‚ä¸­å‡å°‘æŸ¥è¯¢æ•°æ®åº“çš„å‡ ç‡ï¼›</li><li>æœåŠ¡ç«¯éœ€è¦å¯¹cookieå’ŒHTTP Authrorization Headerè¿›è¡ŒTokenä¿¡æ¯çš„æ£€æŸ¥ï¼›</li><li>åŸºäºä¸Šä¸€ç‚¹ï¼Œä½ å¯ä»¥ç”¨ä¸€å¥—tokenè®¤è¯ä»£ç æ¥é¢å¯¹æµè§ˆå™¨ç±»å®¢æˆ·ç«¯å’Œéæµè§ˆå™¨ç±»å®¢æˆ·ç«¯ï¼›</li><li>å› ä¸ºtokenæ˜¯è¢«ç­¾åçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¤ä¸ºä¸€ä¸ªå¯ä»¥è§£ç è®¤è¯é€šè¿‡çš„tokenæ˜¯ç”±æˆ‘ä»¬ç³»ç»Ÿå‘æ”¾çš„ï¼Œå…¶ä¸­å¸¦çš„ä¿¡æ¯æ˜¯åˆæ³•æœ‰æ•ˆçš„ï¼›</li></ul><p><strong>session</strong></p><ul><li>ä¼šè¯ï¼Œä»£è¡¨æœåŠ¡å™¨ä¸æµè§ˆå™¨çš„ä¸€æ¬¡ä¼šè¯è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯è¿ç»­çš„ï¼Œä¹Ÿå¯ä»¥æ—¶æ–­æ—¶ç»­ã€‚</li><li>cookieä¸­å­˜æ”¾ç€ä¸€ä¸ªsessionIDï¼Œè¯·æ±‚æ—¶ä¼šå‘é€è¿™ä¸ªIDï¼›</li><li>sessionå› ä¸ºè¯·æ±‚ï¼ˆrequestå¯¹è±¡ï¼‰è€Œäº§ç”Ÿï¼›</li><li>sessionæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥å­˜æ”¾ä¼šè¯è¿‡ç¨‹ä¸­çš„ä»»ä½•å¯¹è±¡ï¼›</li><li>sessionçš„åˆ›å»ºä¸ä½¿ç”¨æ€»æ˜¯åœ¨æœåŠ¡ç«¯ï¼Œæµè§ˆå™¨ä»æ¥éƒ½æ²¡æœ‰å¾—åˆ°è¿‡sessionå¯¹è±¡ï¼›</li><li>sessionæ˜¯ä¸€ç§httpå­˜å‚¨æœºåˆ¶ï¼Œç›®çš„æ˜¯ä¸ºæ­¦è£…çš„httpæä¾›æŒä¹…æœºåˆ¶ã€‚</li></ul><p><strong>cookie</strong></p><p>å‚¨å­˜åœ¨ç”¨æˆ·æœ¬åœ°ç»ˆç«¯ä¸Šçš„æ•°æ®ï¼ŒæœåŠ¡å™¨ç”Ÿæˆï¼Œå‘é€ç»™æµè§ˆå™¨ï¼Œä¸‹æ¬¡è¯·æ±‚ç»Ÿä¸€ç½‘ç«™ç»™æœåŠ¡å™¨ã€‚</p><p><strong>cookieä¸sessionåŒºåˆ«</strong> cookieæ•°æ®å­˜æ”¾åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œsessionæ•°æ®æ”¾åœ¨æœåŠ¡å™¨ä¸Šï¼› cookieä¸æ˜¯å¾ˆå®‰å…¨ï¼Œä¸”ä¿å­˜æ•°æ®æœ‰é™ï¼› sessionä¸€å®šæ—¶é—´å†…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Š,å½“è®¿é—®å¢å¤šï¼Œå ç”¨æœåŠ¡å™¨æ€§èƒ½ã€‚</p><p><strong>sessionä¸token</strong> ä½œä¸ºèº«ä»½è®¤è¯ï¼Œtokenå®‰å…¨è¡Œæ¯”sessionå¥½ï¼› Session è®¤è¯åªæ˜¯ç®€å•çš„æŠŠUser ä¿¡æ¯å­˜å‚¨åˆ°Session é‡Œï¼Œå› ä¸ºSID çš„ä¸å¯é¢„æµ‹æ€§ï¼Œæš‚ä¸”è®¤ä¸ºæ˜¯å®‰å…¨çš„ã€‚è¿™æ˜¯ä¸€ç§è®¤è¯æ‰‹æ®µã€‚ è€ŒToken ï¼Œå¦‚æœæŒ‡çš„æ˜¯OAuth Token æˆ–ç±»ä¼¼çš„æœºåˆ¶çš„è¯ï¼Œæä¾›çš„æ˜¯ è®¤è¯ å’Œ æˆæƒ ï¼Œè®¤è¯æ˜¯é’ˆå¯¹ç”¨æˆ·ï¼Œæˆæƒæ˜¯é’ˆå¯¹App ã€‚å…¶ç›®çš„æ˜¯è®© æŸAppæœ‰æƒåˆ©è®¿é—® æŸç”¨æˆ· çš„ä¿¡æ¯ã€‚</p><p><strong>tokenä¸cookie</strong> Cookieæ˜¯ä¸å…è®¸å®åŸŸè®¿é—®çš„ï¼Œä½†æ˜¯tokenæ˜¯æ”¯æŒçš„ï¼Œ å‰ææ˜¯ä¼ è¾“çš„ç”¨æˆ·è®¤è¯ä¿¡æ¯é€šè¿‡HTTPå¤´ä¼ è¾“ï¼›</p><p>tokenå°±æ˜¯ä»¤ç‰Œï¼Œæ¯”å¦‚ä½ æˆæƒï¼ˆç™»å½•ï¼‰ä¸€ä¸ªç¨‹åºæ—¶ï¼Œä»–å°±æ˜¯ä¸ªä¾æ®ï¼Œåˆ¤æ–­ä½ æ˜¯å¦å·²ç»æˆæƒè¯¥è½¯ä»¶ï¼›cookieå°±æ˜¯å†™åœ¨å®¢æˆ·ç«¯çš„ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œé‡Œé¢åŒ…æ‹¬ä½ ç™»å½•ä¿¡æ¯ä¹‹ç±»çš„ï¼Œè¿™æ ·ä½ ä¸‹æ¬¡åœ¨ç™»å½•æŸä¸ªç½‘ç«™ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨cookieè‡ªåŠ¨ç™»å½•ç”¨æˆ·åï¼›sessionå’Œcookieå·®ä¸å¤šï¼Œåªæ˜¯sessionæ˜¯å†™åœ¨æœåŠ¡å™¨ç«¯çš„æ–‡ä»¶ï¼Œä¹Ÿéœ€è¦åœ¨å®¢æˆ·ç«¯å†™å…¥cookieæ–‡ä»¶ï¼Œä½†æ˜¯æ–‡ä»¶é‡Œæ˜¯ä½ çš„æµè§ˆå™¨ç¼–å·.Sessionçš„çŠ¶æ€æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯åªæœ‰session idï¼›è€ŒTokençš„çŠ¶æ€æ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯ã€‚</p><p>HTTPåè®®ä¸çŠ¶æ€ä¿æŒï¼šHttpæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®® </p><ul><li><ol><li>å®ç°çŠ¶æ€ä¿æŒçš„æ–¹æ¡ˆï¼š</li></ol><ul><li>1)ä¿®æ”¹Httpåè®®ï¼Œä½¿å¾—å®ƒæ”¯æŒçŠ¶æ€ä¿æŒ(éš¾åšåˆ°)</li><li>2)Cookiesï¼šé€šè¿‡å®¢æˆ·ç«¯æ¥ä¿æŒçŠ¶æ€ä¿¡æ¯</li><li>Cookieæ˜¯æœåŠ¡å™¨å‘ç»™å®¢æˆ·ç«¯çš„ç‰¹æ®Šä¿¡æ¯</li><li>cookieæ˜¯ä»¥æ–‡æœ¬çš„æ–¹å¼ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶éƒ½å¸¦ä¸Šå®ƒ</li><li>3)Sessionï¼šé€šè¿‡æœåŠ¡å™¨ç«¯æ¥ä¿æŒçŠ¶æ€ä¿¡æ¯</li><li>Sessionæ˜¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„ä¸€ç³»åˆ—çš„äº¤äº’åŠ¨ä½œ</li><li>æœåŠ¡å™¨ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯å¼€è¾Ÿå†…å­˜ç©ºé—´ï¼Œä»è€Œä¿æŒçŠ¶æ€ä¿¡æ¯</li><li>ç”±äºéœ€è¦å®¢æˆ·ç«¯ä¹Ÿè¦æŒæœ‰ä¸€ä¸ªæ ‡è¯†(id)ï¼Œå› æ­¤ï¼Œä¹Ÿè¦æ±‚æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¼ è¾“è¯¥æ ‡è¯†ï¼Œ</li><li>æ ‡è¯†(id)å¯ä»¥å€ŸåŠ©Cookieæœºåˆ¶æˆ–è€…å…¶ä»–çš„é€”å¾„æ¥ä¿å­˜</li></ul><p>2ã€COOKIEæœºåˆ¶ </p><ul><li>Cookieçš„åŸºæœ¬ç‰¹ç‚¹</li><li>Cookieä¿å­˜åœ¨å®¢æˆ·ç«¯</li><li>åªèƒ½ä¿å­˜å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¸èƒ½ä¿å­˜å¯¹è±¡ç±»å‹</li><li>éœ€è¦å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ”¯æŒï¼šå®¢æˆ·ç«¯å¯ä»¥ä¸æ”¯æŒï¼Œæµè§ˆå™¨ç”¨æˆ·å¯èƒ½ä¼šç¦ç”¨Cookie</li></ul><h4 id="JWT-å’Œ-Session-Cookies-çš„ä¸åŒ"><a href="#JWT-å’Œ-Session-Cookies-çš„ä¸åŒ" class="headerlink" title="JWT å’Œ Session Cookies çš„ä¸åŒ"></a>JWT å’Œ Session Cookies çš„ä¸åŒ</h4><p>JWT å’Œ Session Cookies éƒ½æä¾›å®‰å…¨çš„ç”¨æˆ·èº«ä»½éªŒè¯ï¼Œä½†æ˜¯å®ƒä»¬æœ‰ä»¥ä¸‹å‡ ç‚¹ä¸åŒ</p><p><strong>å¯†ç ç­¾å</strong></p><p>JWT å…·æœ‰åŠ å¯†ç­¾åï¼Œè€Œ Session Cookies åˆ™æ²¡æœ‰ã€‚</p><p><strong>JSON æ˜¯æ— çŠ¶æ€çš„</strong></p><p>JWT æ˜¯<code>æ— çŠ¶æ€</code>çš„ï¼Œå› ä¸ºå£°æ˜è¢«å­˜å‚¨åœ¨<code>å®¢æˆ·ç«¯</code>ï¼Œè€Œä¸æ˜¯æœåŠ¡ç«¯å†…å­˜ä¸­ã€‚</p><p>èº«ä»½éªŒè¯å¯ä»¥åœ¨<code>æœ¬åœ°</code>è¿›è¡Œï¼Œè€Œä¸æ˜¯åœ¨è¯·æ±‚å¿…é¡»é€šè¿‡æœåŠ¡å™¨æ•°æ®åº“æˆ–ç±»ä¼¼ä½ç½®ä¸­è¿›è¡Œã€‚ è¿™æ„å‘³ç€å¯ä»¥å¯¹ç”¨æˆ·è¿›è¡Œå¤šæ¬¡èº«ä»½éªŒè¯ï¼Œè€Œæ— éœ€ä¸ç«™ç‚¹æˆ–åº”ç”¨ç¨‹åºçš„æ•°æ®åº“è¿›è¡Œé€šä¿¡ï¼Œä¹Ÿæ— éœ€åœ¨æ­¤è¿‡ç¨‹ä¸­æ¶ˆè€—å¤§é‡èµ„æºã€‚</p><p><strong>å¯æ‰©å±•æ€§</strong></p><p>Session Cookies æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœç½‘ç«™æˆ–è€…åº”ç”¨å¾ˆå¤§çš„æƒ…å†µä¸‹ä¼šè€—è´¹å¤§é‡çš„èµ„æºã€‚ç”±äº JWT æ˜¯æ— çŠ¶æ€çš„ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå®ƒä»¬å¯ä»¥èŠ‚çœæœåŠ¡å™¨èµ„æºã€‚å› æ­¤ JWT è¦æ¯” Session Cookies å…·æœ‰æ›´å¼ºçš„<code>å¯æ‰©å±•æ€§</code>ã€‚</p><p><strong>JWT æ”¯æŒè·¨åŸŸè®¤è¯</strong></p><p>Session Cookies åªèƒ½ç”¨åœ¨<code>å•ä¸ªèŠ‚ç‚¹çš„åŸŸ</code>æˆ–è€…å®ƒçš„<code>å­åŸŸ</code>ä¸­æœ‰æ•ˆã€‚å¦‚æœå®ƒä»¬å°è¯•é€šè¿‡ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹è®¿é—®ï¼Œå°±ä¼šè¢«ç¦æ­¢ã€‚å¦‚æœä½ å¸Œæœ›è‡ªå·±çš„ç½‘ç«™å’Œå…¶ä»–ç«™ç‚¹å»ºç«‹å®‰å…¨è¿æ¥æ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p><p>ä½¿ç”¨ JWT å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨ JWT èƒ½å¤Ÿé€šè¿‡<code>å¤šä¸ªèŠ‚ç‚¹</code>è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<code>è·¨åŸŸè®¤è¯</code>ã€‚</p><h4 id="JWT-å’Œ-Session-Cookies-çš„é€‰å‹"><a href="#JWT-å’Œ-Session-Cookies-çš„é€‰å‹" class="headerlink" title="JWT å’Œ Session Cookies çš„é€‰å‹"></a>JWT å’Œ Session Cookies çš„é€‰å‹</h4><p>æˆ‘ä»¬ä¸Šé¢æ¢è®¨äº† JWT å’Œ Cookies çš„ä¸åŒç‚¹ï¼Œç›¸ä¿¡ä½ ä¹Ÿä¼šå¯¹é€‰å‹æœ‰äº†æ›´æ·±çš„è®¤è¯†ï¼Œå¤§è‡´æ¥è¯´ </p><p>å¯¹äºåªéœ€è¦ç™»å½•ç”¨æˆ·å¹¶è®¿é—®å­˜å‚¨åœ¨ç«™ç‚¹æ•°æ®åº“ä¸­çš„ä¸€äº›ä¿¡æ¯çš„ä¸­å°å‹ç½‘ç«™æ¥è¯´ï¼ŒSession Cookies é€šå¸¸å°±èƒ½æ»¡è¶³ã€‚</p><p>å¦‚æœä½ æœ‰ä¼ä¸šçº§ç«™ç‚¹ï¼Œåº”ç”¨ç¨‹åºæˆ–é™„è¿‘çš„ç«™ç‚¹ï¼Œå¹¶ä¸”éœ€è¦å¤„ç†å¤§é‡çš„è¯·æ±‚ï¼Œå°¤å…¶æ˜¯ç¬¬ä¸‰æ–¹æˆ–å¾ˆå¤šç¬¬ä¸‰æ–¹ï¼ˆåŒ…æ‹¬ä½äºä¸åŒåŸŸçš„APIï¼‰ï¼Œåˆ™ JWT æ˜¾ç„¶æ›´é€‚åˆã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Swagger</title>
    <link href="/2024/05/27/go/%E4%BE%9D%E8%B5%96%E7%AC%94%E8%AE%B0/"/>
    <url>/2024/05/27/go/%E4%BE%9D%E8%B5%96%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¾èµ–é—®é¢˜"><a href="#ä¾èµ–é—®é¢˜" class="headerlink" title="ä¾èµ–é—®é¢˜"></a>ä¾èµ–é—®é¢˜</h1><h2 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h2><h2 id="å®‰è£…-swag"><a href="#å®‰è£…-swag" class="headerlink" title="å®‰è£… swag"></a>å®‰è£… swag</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">go get -u github.com<span class="hljs-regexp">/swaggo/</span>swag<span class="hljs-regexp">/cmd/</span>swag@v1.<span class="hljs-number">6.5</span><br></code></pre></td></tr></table></figure><p><code>swag -v</code> æ—¶æç¤ºæ‰¾ä¸åˆ°è¯¥å‘½ä»¤</p><p>å¯èƒ½æ˜¯å› ä¸º <code>$PATH</code> ç¯å¢ƒå˜é‡æ²¡æœ‰åŒ…å« Go å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶çš„ç›®å½•ã€‚</p><p>åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼ŒGo ä¼šå°†ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨ <code>$GOPATH/bin</code> æˆ–ä½¿ç”¨ Go modules åçš„ <code>$(go env GOPATH)/bin</code> æˆ– <code>$(go env GOBIN)</code> ç›®å½•ä¸‹ã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ‰¾åˆ° <code>swag</code> çš„å®‰è£…ä½ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> $(go <span class="hljs-built_in">env</span> GOPATH)/bin<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">echo <span class="hljs-constructor">$(<span class="hljs-params">go</span> <span class="hljs-params">env</span> GOBIN)</span><br></code></pre></td></tr></table></figure><p>æ‰¾åˆ°ç›®å½•åï¼Œç¡®ä¿è¯¥è·¯å¾„å·²ç»æ·»åŠ åˆ°äº†ä½ çš„ç³»ç»Ÿ <code>$PATH</code> ç¯å¢ƒå˜é‡ä¸­ã€‚å¦‚æœè¿˜æ²¡æœ‰æ·»åŠ ï¼Œå¯ä»¥å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°ä½ çš„ shell é…ç½®æ–‡ä»¶ä¸­ï¼ˆå¦‚ <code>.bashrc</code>ã€<code>.bash_profile</code> æˆ– <code>.zshrc</code>ï¼‰ï¼Œç„¶åé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆé€šè¿‡è¿è¡Œ <code>. ~/.bashrc</code>ã€<code>source ~/.bash_profile</code> æˆ– <code>source ~/.zshrc</code>ï¼‰ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$PATH</span>:$(go env GOPATH)/bin<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Goç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo blog</title>
    <link href="/2024/05/27/tools/Hexo%E7%BB%93%E5%90%88Github%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/"/>
    <url>/2024/05/27/tools/Hexo%E7%BB%93%E5%90%88Github%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="Hexoç»“åˆGithubæ­å»ºåšå®¢"><a href="#Hexoç»“åˆGithubæ­å»ºåšå®¢" class="headerlink" title="Hexoç»“åˆGithubæ­å»ºåšå®¢"></a>Hexoç»“åˆGithubæ­å»ºåšå®¢</h1><h2 id="1ã€é…ç½®hexoã€githubç¯å¢ƒ"><a href="#1ã€é…ç½®hexoã€githubç¯å¢ƒ" class="headerlink" title="1ã€é…ç½®hexoã€githubç¯å¢ƒ"></a>1ã€é…ç½®hexoã€githubç¯å¢ƒ</h2><p><a href="https://zhuanlan.zhihu.com/p/60578464">å‚è€ƒåœ°å€</a></p><h2 id="2ã€hexoå¸¸ç”¨å‘½ä»¤"><a href="#2ã€hexoå¸¸ç”¨å‘½ä»¤" class="headerlink" title="2ã€hexoå¸¸ç”¨å‘½ä»¤"></a>2ã€hexoå¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo new <span class="hljs-string">&quot;name&quot;</span>     <span class="hljs-comment"># æ–°å»ºæ–‡ç« </span><br>hexo new page <span class="hljs-string">&quot;name&quot;</span>  <span class="hljs-comment"># æ–°å»ºé¡µé¢</span><br>hexo g                <span class="hljs-comment"># ç”Ÿæˆé¡µé¢</span><br>hexo d                <span class="hljs-comment"># éƒ¨ç½²</span><br>hexo g &amp;&amp; hexo d            <span class="hljs-comment"># ç”Ÿæˆé¡µé¢å¹¶éƒ¨ç½²</span><br>hexo s                <span class="hljs-comment"># æœ¬åœ°é¢„è§ˆ</span><br>hexo clean            <span class="hljs-comment"># æ¸…é™¤ç¼“å­˜å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶</span><br>hexo <span class="hljs-built_in">help</span>             <span class="hljs-comment"># å¸®åŠ©</span><br></code></pre></td></tr></table></figure><h2 id="3ã€æ–‡ç« é…ç½®"><a href="#3ã€æ–‡ç« é…ç½®" class="headerlink" title="3ã€æ–‡ç« é…ç½®"></a>3ã€æ–‡ç« é…ç½®</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">å‚æ•°é…ç½®</span><br><span class="hljs-string">æ–‡ç« æœ€å¼€å§‹Front-Matter</span> <span class="hljs-string">ä½¿ç”¨---</span> <span class="hljs-string">å›è½¦é…ç½®</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">javaä¸‰å¤§ç‰¹æ€§</span> <span class="hljs-comment"># é…ç½®æ˜¾ç¤ºæ–‡ç« æ ‡é¢˜</span><br><span class="hljs-attr">tags:</span> [<span class="hljs-string">Java</span>]    <span class="hljs-comment"># é…ç½®æ ‡ç­¾</span><br><span class="hljs-attr">categories:</span> [<span class="hljs-string">Javaç¬”è®°</span>]  <span class="hljs-comment"># é…ç½®åˆ†ç±»</span><br><span class="hljs-attr">published:</span> <span class="hljs-literal">true</span><span class="hljs-comment"># é…ç½®æ˜¯å¦æ‰€æœ‰å¯è¯»</span><br><span class="hljs-attr">excerpt:</span> <span class="hljs-string">hello</span><span class="hljs-comment"># æ–‡ç« æ‘˜è¦ã€‚å¦‚æœæä¾›ï¼Œè¿™ä¸ªå­—æ®µçš„æ–‡æœ¬å°†ä½œä¸ºæ–‡ç« åˆ—è¡¨é¡µé¢ä¸Šçš„ç®€ä»‹</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>KafKa å®æˆ˜1</title>
    <link href="/2024/05/27/tools/Kafka%E5%AE%9E%E6%88%981/"/>
    <url>/2024/05/27/tools/Kafka%E5%AE%9E%E6%88%981/</url>
    
    <content type="html"><![CDATA[<h2 id="1-éƒ¨ç½²kafka"><a href="#1-éƒ¨ç½²kafka" class="headerlink" title="1 éƒ¨ç½²kafka"></a>1 éƒ¨ç½²kafka</h2><ul><li>docker</li><li>docker-compose</li></ul><h3 id="docker-éƒ¨ç½²"><a href="#docker-éƒ¨ç½²" class="headerlink" title="docker  éƒ¨ç½²"></a>docker  éƒ¨ç½²</h3><p>dockeréƒ¨ç½²kafkaéå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸¤æ¡å‘½ä»¤å³å¯å®ŒæˆkafkaæœåŠ¡å™¨çš„éƒ¨ç½²ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -d --name zookeeper \<br>  -v zookeeper-data:/bitnami \<br>  -e ALLOW_ANONYMOUS_LOGIN=yes \<br>  bitnami/zookeeper<br>  <br>docker run -d --name broker \<br>  -p 9092:9092 \<br>  -v kafka-data:/bitnami \<br>  -e KAFKA_ENABLE_KRAFT=no \<br>  -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092 \<br>  -e KAFKA_LISTENERS=PLAINTEXT://:9092 \<br>  -e KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181 \<br>  -e ALLOW_PLAINTEXT_LISTENER=yes \<br>  --link zookeeper:zookeeper \<br>  bitnami/kafka<br></code></pre></td></tr></table></figure><h3 id="docker-composeéƒ¨ç½²"><a href="#docker-composeéƒ¨ç½²" class="headerlink" title="docker-composeéƒ¨ç½²"></a>docker-composeéƒ¨ç½²</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">zookeeper:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">bitnami/zookeeper</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;zookeeper:/bitnami&quot;</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">ALLOW_ANONYMOUS_LOGIN:</span> <span class="hljs-literal">yes</span><br>  <span class="hljs-attr">kafka:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">bitnami/kafka</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">broker</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">broker</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9092:9092&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;kafka:/bitnami&quot;</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">KAFKA_ENABLE_KRAFT:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">KAFKA_ADVERTISED_LISTENERS:</span> <span class="hljs-string">PLAINTEXT://kafka:9092</span><br>      <span class="hljs-attr">KAFKA_LISTENERS:</span> <span class="hljs-string">PLAINTEXT://:9092</span><br>      <span class="hljs-attr">KAFKA_CFG_ZOOKEEPER_CONNECT:</span> <span class="hljs-string">zookeeper:2181</span><br>      <span class="hljs-attr">ALLOW_PLAINTEXT_LISTENER:</span> <span class="hljs-literal">yes</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">zookeeper</span><br><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">kafka:</span><br>  <span class="hljs-attr">zookeeper:</span><br></code></pre></td></tr></table></figure><p><strong><code>kafka-map</code>å¯è§†åŒ–å·¥å…·</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.8&#x27;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">kafka-map:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dushixiang/kafka-map:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">kafka-map</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;38080:8080&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/opt/kafka-map/data:/usr/local/kafka-map/data</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">DEFAULT_USERNAME=admin</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">DEFAULT_PASSWORD=admin</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br></code></pre></td></tr></table></figure><p>éƒ¨ç½²èµ·æ¥å¾ˆç®€å•,åœ¨docker-compose.ymlæ–‡ä»¶çš„ç›®å½•ä¸‹æ‰§è¡Œdocker-compose up -då°±å¯ä»¥äº†ã€‚<br>è¿™ä¸ªdocker-composeåšçš„ä¸œè¥¿æ¯”ä¸Šé¢dockeræ–¹å¼éƒ¨ç½²çš„ä¸œè¥¿è¦å¤šä¸€äº›</p><ol><li><p>æ•°æ®æŒä¹…åŒ–ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹æŒ‚åœ¨äº†ä¸¤ä¸ªç›®å½•åˆ†åˆ«å­˜å‚¨zookeeperå’Œkafkaçš„æ•°æ®,å½“ç„¶åœ¨docker run å‘½ä»¤ä¸­æ·»åŠ  -v é€‰é¡¹ä¹Ÿæ˜¯å¯ä»¥åšåˆ°è¿™æ ·çš„æ•ˆæœçš„</p><p>2.kafkaåœ¨å¯åŠ¨åä¼šåˆå§‹åŒ–ä¸€ä¸ªæœ‰åˆ†åŒºçš„topic,åŒæ ·çš„,docker runçš„æ—¶å€™æ·»åŠ  -e KAFKA<em>CREATE</em>TOPICS&#x3D;kafeidou:2:0 ä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„ã€‚</p></li></ol><blockquote><p>æ€»ç»“:ä¼˜å…ˆæ¨èdocker-composeæ–¹å¼éƒ¨ç½²,ä¾¿äºè‡ªå®šä¹‰è°ƒæ•´</p></blockquote><h3 id="é€šè¿‡kafkaè‡ªå¸¦å·¥å…·ç”Ÿäº§æ¶ˆè´¹æ¶ˆæ¯æµ‹è¯•"><a href="#é€šè¿‡kafkaè‡ªå¸¦å·¥å…·ç”Ÿäº§æ¶ˆè´¹æ¶ˆæ¯æµ‹è¯•" class="headerlink" title="é€šè¿‡kafkaè‡ªå¸¦å·¥å…·ç”Ÿäº§æ¶ˆè´¹æ¶ˆæ¯æµ‹è¯•"></a>é€šè¿‡kafkaè‡ªå¸¦å·¥å…·ç”Ÿäº§æ¶ˆè´¹æ¶ˆæ¯æµ‹è¯•</h3><p>é¦–å…ˆ,è¿›å…¥åˆ°kafkaçš„dockerå®¹å™¨ä¸­</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker-compose <span class="hljs-built_in">exec</span> -it kafka bash<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ¶ˆè´¹è€…,è¿›è¡Œæ¶ˆæ¯çš„ç›‘å¬</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kafka-console-consumer.sh --bootstrap-server 192.168.0.185:9092 --topic test1 --from-beginning   <span class="hljs-comment"># ipä¸ºæœºå™¨iç‰‡æ‹¼æ¥æš´éœ²ç«¯å£</span><br></code></pre></td></tr></table></figure><p>æ‰“å¼€ä¸€ä¸ªæ–°çš„sshçª—å£,åŒæ ·è¿›å…¥kafkaçš„å®¹å™¨ä¸­,æ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ç”Ÿäº§æ¶ˆæ¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kafka-console-producer.sh --broker-list 192.168.0.185:9092 --topic test1<span class="hljs-comment"># ipä¸ºæœºå™¨iç‰‡æ‹¼æ¥æš´éœ²ç«¯å£</span><br></code></pre></td></tr></table></figure><p>è¾“å…¥å®Œè¿™æ¡å‘½ä»¤åä¼šè¿›å…¥åˆ°æ§åˆ¶å°ï¼Œå¯ä»¥è¾“å…¥ä»»ä½•æƒ³å‘é€çš„æ¶ˆæ¯,è¿™é‡Œå‘é€ä¸€ä¸ªhello</p><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta prompt_">&gt;</span><br>&gt;hello<br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°,åœ¨ç”Ÿäº§è€…çš„æ§åˆ¶å°ä¸­è¾“å…¥æ¶ˆæ¯å,æ¶ˆè´¹è€…çš„æ§åˆ¶å°ç«‹åˆ»çœ‹åˆ°äº†æ¶ˆæ¯</p><p>åˆ°ç›®å‰ä¸ºæ­¢,ä¸€ä¸ªkafkaå®Œæ•´çš„hello worldå°±å®Œæˆäº†.kafkaçš„éƒ¨ç½²åŠ ä¸Šç”Ÿäº§è€…æ¶ˆè´¹è€…æµ‹è¯•.</p><p>å·¥å…·å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">1ã€ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ Kafka ä¸»é¢˜ï¼š<br>kafka-topics.sh --list --bootstrap-server localhost:9092<br>2ã€åˆªé™¤ä¸»é¡Œ<br>kafka-topics.sh --delete --bootstrap-server localhost:9092 --topic your_topic_name<br>3ã€åˆ›å»ºä¸»é¢˜<br>kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic my-topic<br><br>    --createï¼šåˆ›å»ºä¸€ä¸ªæ–°ä¸»é¢˜ã€‚<br>    --bootstrap-serverï¼šæŒ‡å®šè¦ç”¨äºè¿æ¥åˆ° Kafka é›†ç¾¤çš„å¼•å¯¼æœåŠ¡å™¨åœ°å€ã€‚è¿™åº”è¯¥æ˜¯ Kafka æ¶ˆæ¯ä»£ç†çš„ä¸»æœºåå’Œç«¯å£å·ï¼Œä¾‹å¦‚ localhost:9092ã€‚<br>    --replication-factorï¼šæŒ‡å®šè¦ä¸ºæ¯ä¸ªåˆ†åŒºä¿ç•™å¤šå°‘ä¸ªå‰¯æœ¬ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸å°†å‰¯æœ¬å› å­è®¾ç½®ä¸º 2 æˆ–æ›´é«˜ï¼Œä»¥ç¡®ä¿æ•°æ®å†—ä½™æ€§å’Œé«˜å¯ç”¨æ€§ã€‚å•ä¸€å‰¯æœ¬çš„ä¸»é¢˜åªæœ‰åœ¨æµ‹è¯•æˆ–å¼€å‘ç¯å¢ƒä¸­æ‰æœ‰æ„ä¹‰ã€‚<br>    --partitionsï¼šæŒ‡å®šè¦ä¸ºä¸»é¢˜åˆ›å»ºçš„åˆ†åŒºæ•°ã€‚å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œè¯·åœ¨ç”Ÿäº§ä¸­åˆ›å»ºå¤šä¸ªåˆ†åŒºä»¥æ”¯æŒæ›´å¥½çš„ä¼¸ç¼©æ€§å’Œååé‡ã€‚<br>    --topicï¼šæŒ‡å®šè¦åˆ›å»ºçš„ä¸»é¢˜åç§°ã€‚<br>4ã€æŸ¥çœ‹ä¸»é¢˜æ•°æ®<br>kafka-console-consumer.sh \<br>  --bootstrap-server localhost:9092 \<br>  --topic sarama \<br>  [--from-beginning] \#å‚æ•°æ˜¯å¯é€‰çš„ï¼Œå¦‚æœåŠ ä¸Šè¿™ä¸ªå‚æ•°ï¼Œæ¶ˆè´¹è€…ä¼šä»ä¸»é¢˜çš„èµ·å§‹å¤„å¼€å§‹è¯»å–æ¶ˆæ¯ï¼›é»˜è®¤ä»æœ€æ–°çš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ã€‚<br>  [--property print.key=true] \#å‚æ•°ç”¨äºæŒ‡å®šæ¶ˆæ¯çš„ååºåˆ—åŒ–æ–¹å¼ï¼Œé€šå¸¸å­—ç¬¦ä¸²æ˜¯æœ€å¸¸ç”¨çš„ï¼Œä½†ä¹Ÿå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ä¸ºå…¶ä»–åºåˆ—åŒ–ç±»<br>  [--property print.value=true] \<br>  [--property key.deserializer=org.apache.kafka.common.serialization.StringDeserializer] \<br>  [--property value.deserializer=org.apache.kafka.common.serialization.StringDeserializer]<br><br></code></pre></td></tr></table></figure><h2 id="2-kafka-client"><a href="#2-kafka-client" class="headerlink" title="2 kafka client"></a>2 kafka client</h2><blockquote><p>å…³äº go çš„ kafka client æœ‰å¾ˆå¤šå¼€æºé¡¹ç›®ï¼Œä¾‹å¦‚</p><ol><li><a href="https://github.com/Shopify/sarama">sarama</a>: å…·æœ‰å®Œæ•´åè®®æ”¯æŒçš„çº¯ Go å®ç°ã€‚åŒ…æ‹¬æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…å®æ–½ï¼Œæ”¯æŒ GZIP å’Œ Snappy å‹ç¼©ã€‚</li><li><a href="https://github.com/confluentinc/confluent-kafka-go">confluent-kafka-go</a>: Confluent çš„ Golang Kafka å®¢æˆ·ç«¯åŒ…è£…äº† librdkafka C åº“ï¼Œæä¾›å®Œæ•´çš„ Kafka åè®®æ”¯æŒï¼Œå…·æœ‰å‡ºè‰²çš„æ€§èƒ½å’Œå¯é æ€§ã€‚æä¾›äº†é«˜çº§ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œæ”¯æŒ Apache Kafka 0.9 åŠæ›´é«˜ç‰ˆæœ¬çš„å¹³è¡¡æ¶ˆè´¹è€…ç»„ã€‚</li><li><a href="https://github.com/twmb/franz-go">franz-go</a>: çº¯ Go å®ç°æä¾›å®Œæ•´çš„åè®®æ”¯æŒã€å‡ºè‰²çš„æ€§èƒ½ä»¥åŠå¯¹æ‰€æœ‰é¢å‘å®¢æˆ·ç«¯çš„ KI P çš„æ”¯æŒã€‚</li></ol></blockquote><p>æœ¬æ–‡ä½¿ç”¨ sarama ä½œä¸º kafka client</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">go get github.com/Shopify/sarama<br></code></pre></td></tr></table></figure><p>æœ¬åœ°è¿è¡Œéœ€è¦å°†hosts kafkaä¸»æœºåé‡å®šå‘åˆ°å®¿ä¸»æœºä¸Š,å¦åˆ™å†™å…¥çš„æ—¶å€™å‡ºç°æ— æ³•å†™å…¥,å¯èƒ½æ˜¯Saramaåœ¨å†…éƒ¨å¯èƒ½å› ä¸ºæŸäº›åŸå› ï¼ˆæ¯”å¦‚è‡ªåŠ¨å‘ç°æœºåˆ¶æˆ–é”™è¯¯çš„é…ç½®ä¼ æ’­ï¼‰å°è¯•è¿æ¥åˆ° <code>kafka:9092</code>ï¼Œè¿™ä¸ªä¸»æœºåæœªèƒ½æ­£ç¡®è§£æï¼Œå¼•å‘äº†é”™è¯¯ã€‚</p><h3 id="producer"><a href="#producer" class="headerlink" title="producer"></a>producer</h3><p>sarama æä¾›ä¸¤ç§ producer çš„å®ç°ï¼š<code>AsyncProducer</code>å’Œ<code>SyncProducer</code>ï¼Œå³åŒæ­¥å’Œå¼‚æ­¥çš„ç”Ÿäº§è€…ï¼Œæœ¬æ–‡åªä»‹ç»<code>AsyncProducer</code>çš„ä½¿ç”¨ï¼Œé€šè¿‡<code>sarama.NewAsyncProducer</code>è·å–ç”Ÿäº§è€…å®ä¾‹ï¼Œå…¶ä¸­è¦æ±‚ä¼ å…¥ä¸¤ä¸ªå‚æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAsyncProducer</span><span class="hljs-params">(addrs []<span class="hljs-type">string</span>, conf *Config)</span></span> (AsyncProducer, <span class="hljs-type">error</span>) &#123;<br>client, err := NewClient(addrs, conf)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br><span class="hljs-keyword">return</span> newAsyncProducer(client)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>addrs: å³ä¸º kafka broker åœ°å€ï¼Œå¯¹äº kafka é›†ç¾¤å¯ä»¥å…¨éƒ¨éƒ½å¡«ï¼Œä¹Ÿå¯ä»¥åªå¡«ä¸€ä¸ªï¼Œä¿è¯æœ‰ä¸€ä¸ªåœ°å€å¯ç”¨å³å¯</li><li>conf: ä¸º sarama å°è£…çš„ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€å®¢æˆ·ç«¯ã€ç½‘ç»œä¸ä¸€ä½“çš„é…ç½®ï¼Œé€šè¿‡<code>sarama.NewConfig</code>å¿«é€Ÿè·å–é»˜è®¤å€¼çš„é…ç½®æ–‡ä»¶</li></ul><p>å¯¹äºç”Ÿäº§è€…æˆ‘ä»¬é€šå¸¸ä¿®æ”¹çš„é…ç½®å°±æ˜¯ ack äº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ç”Ÿäº§è€…é»˜è®¤é…ç½®</span><br>config := sarama.NewConfig()<br><span class="hljs-comment">// é…ç½® ack</span><br>config.Producer.RequiredAcks = sarama.WaitForAll<br></code></pre></td></tr></table></figure><p><code>config.Producer.RequiredAcks</code>çš„ç±»å‹æœ¬è´¨ä¸Šæ˜¯ int16ï¼Œæ‰€ä»¥ä¹ æƒ¯<code>0,1,-1</code>è¿™ç§é…ç½®ä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œä½†ä¸ºäº†æ¶ˆé™¤é­”æ•°çš„å½±å“ï¼Œå»ºè®®ä½¿ç”¨ sarama å°è£…çš„å¸¸æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> (<br>NoResponse RequiredAcks = <span class="hljs-number">0</span><br>  <br>WaitForLocal RequiredAcks = <span class="hljs-number">1</span><br>  <br>WaitForAll RequiredAcks = <span class="hljs-number">-1</span><br>)<br>acks=<span class="hljs-number">0</span>:<br>ç”Ÿäº§è€…åœ¨å°†æ¶ˆæ¯å‘é€ç»™Kafka brokeråï¼Œä¸ç­‰å¾…ä»»ä½•ç¡®è®¤å°±ç»§ç»­å¤„ç†ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚è¿™æ„å‘³ç€ç”Ÿäº§è€…æ— æ³•çŸ¥é“æ¶ˆæ¯æ˜¯å¦åˆ°è¾¾brokerï¼Œæä¾›äº†æœ€ä½çš„å»¶è¿Ÿä½†ä¸ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ã€‚<br>acks=<span class="hljs-number">1</span>:<br>ç”Ÿäº§è€…åœ¨è‡³å°‘ä¸€ä¸ªå‰¯æœ¬ï¼ˆé€šå¸¸æ˜¯leaderå‰¯æœ¬ï¼‰ç¡®è®¤æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œè®¤ä¸ºæ¶ˆæ¯å‘é€æˆåŠŸã€‚è¿™ç§æ–¹å¼æä¾›äº†åŸºæœ¬çš„å¯é æ€§ä¿éšœï¼Œå› ä¸ºè‡³å°‘æ¶ˆæ¯è¢«ä¸€ä¸ªå‰¯æœ¬æ¥æ”¶äº†ï¼Œä½†å¦‚æœè¿™ä¸ªå‰¯æœ¬åœ¨ç¡®è®¤åç«‹å³å¤±è´¥ä¸”æ²¡æœ‰åŒæ­¥åˆ°å…¶ä»–å‰¯æœ¬ï¼Œæ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ã€‚<br>acks=all æˆ– acks=<span class="hljs-number">-1</span>:<br>ç”Ÿäº§è€…åœ¨æ‰€æœ‰åŒæ­¥å‰¯æœ¬ï¼ˆin-sync replicasï¼ŒISRåˆ—è¡¨ä¸­çš„å‰¯æœ¬ï¼‰éƒ½ç¡®è®¤æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œæ‰è®¤ä¸ºæ¶ˆæ¯å‘é€æˆåŠŸã€‚è¿™æ˜¯æœ€å®‰å…¨ä½†ä¹Ÿæœ€æ…¢çš„æ¨¡å¼ï¼Œå› ä¸ºå®ƒç¡®ä¿å³ä½¿leaderå‰¯æœ¬å¤±è´¥ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œå› ä¸ºè‡³å°‘è¿˜æœ‰ä¸€ä¸ªåŒæ­¥å‰¯æœ¬æ‹¥æœ‰è¿™æ¡æ¶ˆæ¯ã€‚<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å¼€å¯å¼€å¯å¼‚æ­¥å›è°ƒï¼Œåˆ™éœ€è¦å¼€å¯<code>config.Producer.Return.Successes</code>å’Œ<code>config.Producer.Return.Errors</code>ï¼Œä¾‹å¦‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// å¼€å¯å¼‚æ­¥å›è°ƒ</span><br>config.Producer.Return.Successes = <span class="hljs-literal">true</span><br>config.Producer.Return.Errors = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>ç”Ÿäº§è€…å†…éƒ¨å¯¹ Successes å’Œ Errors åˆ†åˆ«ç»´æŠ¤ä¸¤ä¸ª channelï¼Œä¸‹é¢æ˜¯<code>AsyncProducer</code>éœ€è¦å®ç°çš„æ–¹æ³•</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> AsyncProducer <span class="hljs-keyword">interface</span> &#123;<br><br>AsyncClose()<br><br>Close() <span class="hljs-type">error</span><br><br>Input() <span class="hljs-keyword">chan</span>&lt;- *ProducerMessage<br><br>Successes() &lt;-<span class="hljs-keyword">chan</span> *ProducerMessage<br><br>Errors() &lt;-<span class="hljs-keyword">chan</span> *ProducerError<br><br>IsTransactional() <span class="hljs-type">bool</span><br><br>TxnStatus() ProducerTxnStatusFlag<br><br>BeginTxn() <span class="hljs-type">error</span><br><br>CommitTxn() <span class="hljs-type">error</span><br><br>AbortTxn() <span class="hljs-type">error</span><br><br>AddOffsetsToTxn(offsets <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>][]*PartitionOffsetMetadata, groupId <span class="hljs-type">string</span>) <span class="hljs-type">error</span><br><br>AddMessageToTxn(msg *ConsumerMessage, groupId <span class="hljs-type">string</span>, metadata *<span class="hljs-type">string</span>) <span class="hljs-type">error</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ­£å¸¸å›è°ƒä¿¡æ¯ä¼šæŠ•é€’åˆ°<code>Successes</code>çš„ channel ä¸­ï¼Œé”™è¯¯å›è°ƒä¿¡æ¯ä¼šæŠ•é€’åˆ°<code>Errors</code>çš„ channel ä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœå¼€å¯äº†å¼‚æ­¥å›è°ƒåˆ™ä¸€å®šè¦å»æ¶ˆè´¹è¿™ä¸¤ä¸ª channel çš„æ•°æ®å¦åˆ™ä¼šé˜»å¡ producerï¼ŒåŒæ—¶ä¸‹é¢æ˜¯<code>AsyncProducer</code>å®ç°è€…çš„åˆå§‹åŒ–</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go">p := &amp;asyncProducer&#123;<br>  client:          client,<br>  conf:            client.Config(),<br>  errors:          <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> *ProducerError),<br>  input:           <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> *ProducerMessage),<br>  successes:       <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> *ProducerMessage),<br>  retries:         <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> *ProducerMessage),<br>  brokers:         <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[*Broker]*brokerProducer),<br>  brokerRefs:      <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[*brokerProducer]<span class="hljs-type">int</span>),<br>  txnmgr:          txnmgr,<br>  metricsRegistry: newCleanupRegistry(client.Config().MetricRegistry),<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>Successes</code>å’Œ<code>Errors</code>æ˜¯ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ï¼Œå› æ­¤å¯¹è¿™ä¸¤ä¸ª channel çš„å›è°ƒä¸€å®šä¸è¦æœ‰è¿‡é‡çš„é€»è¾‘ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// æä¸€ä¸ªä¸Šä¸‹æ–‡ç”¨äºé€€å‡ºå¼‚æ­¥å›è°ƒ</span><br>ctx, cancelFunc := context.WithCancel(context.Background())<br><span class="hljs-keyword">defer</span> cancelFunc()<br><span class="hljs-comment">// å¼‚æ­¥å›è°ƒ</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>EXITED:<br>  <span class="hljs-keyword">for</span> &#123;<br>    <span class="hljs-keyword">select</span> &#123;<br>    <span class="hljs-keyword">case</span> message := &lt;-producer.Successes():<br>      logger.Println(<span class="hljs-string">&quot;success: &quot;</span>, message.Value, message.Partition, message.Offset)<br>    <span class="hljs-keyword">case</span> err := &lt;-producer.Errors():<br>      logger.Println(<span class="hljs-string">&quot;errors: &quot;</span>, err.Err.Error())<br>    <span class="hljs-keyword">case</span> &lt;-ctx.Done():<br>      logger.Println(<span class="hljs-string">&quot;exited:&quot;</span>, ctx.Err())<br>      <span class="hljs-keyword">break</span> EXITED<br>    &#125;<br>  &#125;<br>&#125;()<br></code></pre></td></tr></table></figure><blockquote><p>Tips: å¦‚ä½•æƒ³è¦æŸ¥çœ‹ sarama å†…éƒ¨æ—¥å¿—ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢æ–¹å¼å°†å…¶è¾“å…¥åˆ°æ§åˆ¶å°ï¼Œé»˜è®¤æ˜¯<code>io.Discard</code>ç›¸å½“äº&#x2F;dev&#x2F;null</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">sarama.Logger = log.New(os.Stdout, <span class="hljs-string">&quot;[Sarama] &quot;</span>, log.LstdFlags)<br></code></pre></td></tr></table></figure></blockquote><p>è€Œå‘é€æ¶ˆæ¯åˆ™æ˜¯å‘<code>Input</code>çš„ channel å‘é€æ•°æ®å³å¯ï¼Œæˆ‘ä»¬åªéœ€è¦æ„å»ºç‰¹å®šçš„æ¶ˆæ¯ç»“æ„ä½“å³å¯</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> ProducerMessage <span class="hljs-keyword">struct</span> &#123;<br>Topic <span class="hljs-type">string</span><br><br>Key Encoder<br><br>Value Encoder<br><br>Headers []RecordHeader<br><br>Metadata <span class="hljs-keyword">interface</span>&#123;&#125;<br><br><span class="hljs-comment">// Below this point are filled in by the producer as the message is processed</span><br>Offset <span class="hljs-type">int64</span><br><br>Partition <span class="hljs-type">int32</span><br>  <br>Timestamp time.Time<br><br>retries        <span class="hljs-type">int</span><br>flags          flagSet<br>expectation    <span class="hljs-keyword">chan</span> *ProducerError<br>sequenceNumber <span class="hljs-type">int32</span><br>producerEpoch  <span class="hljs-type">int16</span><br>hasSequence    <span class="hljs-type">bool</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç”¨æˆ·åªéœ€è¦æ„å»ºè¯¥ç»“æ„ä½“å¯¼å‡ºå­—æ®µä¸­çš„<code>Topic</code>ã€<code>Key</code>ã€<code>Value</code>ã€<code>Headers</code>ä»¥åŠ<code>Metadata</code>ï¼Œå¯¹äº<code>Metadata</code>æ˜¯ sarama å†…éƒ¨ç»´æŠ¤çš„ä¸€ä¸ªå­—æ®µï¼Œåœ¨å‘é€æ•°æ®æ—¶ä¼šè¢«å¿½ç•¥ç”¨ä½œåœ¨å›è°ƒæ—¶è¿›è¡Œå¡«å……ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸æ˜¯ kafka æ‰€éœ€è¦çš„å­—æ®µåªåœ¨å®¢æˆ·ç«¯å†…éƒ¨æ‰­è½¬ã€‚è€Œ<code>Offset</code>ã€<code>Partition</code>å’Œ<code>Timestamp</code>åˆ™æ˜¯åœ¨å¤„ç†æ¶ˆæ¯æ—¶ sarama è‡ªåŠ¨è¿›è¡Œå¡«å……ã€‚</p><p>å› æ­¤å‘é€æ¶ˆæ¯ä¼ªä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// å‘é€æ•°æ®</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; maxRecordNum; i++ &#123;<br>  producer.Input() &lt;- &amp;sarama.ProducerMessage&#123;<br>    Topic: topic,<br>    Value: sarama.StringEncoder(fmt.Sprintf(<span class="hljs-string">&quot;srama-%v&quot;</span>, i)),<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> example<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/Shopify/sarama&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> maxRecordNum = <span class="hljs-number">1000</span><br><span class="hljs-keyword">var</span> topic = <span class="hljs-string">&quot;sarama&quot;</span><br><br><span class="hljs-comment">// SimpleProducer ç®€å•ç”Ÿäº§ç”Ÿ</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SimpleProducer</span><span class="hljs-params">()</span></span> &#123;<br>brokers := []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;127.0.0.1:9092&quot;</span>&#125;<br><span class="hljs-comment">// ç”Ÿäº§è€…é»˜è®¤é…ç½®</span><br>config := sarama.NewConfig()<br>config.ClientID = <span class="hljs-string">&quot;demo-producer&quot;</span><br><span class="hljs-comment">// é…ç½® ack</span><br>config.Producer.RequiredAcks = sarama.WaitForAll<br><span class="hljs-comment">// å¼€å¯å¼‚æ­¥å›è°ƒ</span><br>config.Producer.Return.Successes = <span class="hljs-literal">true</span><br>config.Producer.Return.Errors = <span class="hljs-literal">true</span><br><span class="hljs-comment">// å¼€å¯æ—¥å¿—</span><br>logger := log.New(os.Stdout, <span class="hljs-string">&quot;[Sarama] &quot;</span>, log.LstdFlags)<br>sarama.Logger = logger<br>producer, err := sarama.NewAsyncProducer(brokers, config)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; _ = producer.Close() &#125;()<br><span class="hljs-comment">// æä¸€ä¸ªä¸Šä¸‹æ–‡ç”¨äºé€€å‡ºå¼‚æ­¥å›è°ƒ</span><br>ctx, cancelFunc := context.WithCancel(context.Background())<br><span class="hljs-keyword">defer</span> cancelFunc()<br><span class="hljs-comment">// å¼‚æ­¥å›è°ƒ</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>EXITED:<br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> message := &lt;-producer.Successes():<br>logger.Println(<span class="hljs-string">&quot;success: &quot;</span>, message.Value, message.Partition, message.Offset)<br><span class="hljs-keyword">case</span> err := &lt;-producer.Errors():<br>logger.Println(<span class="hljs-string">&quot;errors: &quot;</span>, err.Err.Error())<br><span class="hljs-keyword">case</span> &lt;-ctx.Done():<br>logger.Println(<span class="hljs-string">&quot;exited:&quot;</span>, ctx.Err())<br><span class="hljs-keyword">break</span> EXITED<br>&#125;<br>&#125;<br>&#125;()<br><span class="hljs-comment">// å‘é€æ•°æ®</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; maxRecordNum; i++ &#123;<br>producer.Input() &lt;- &amp;sarama.ProducerMessage&#123;<br>Topic: topic,<br>Value: sarama.StringEncoder(fmt.Sprintf(<span class="hljs-string">&quot;srama-%v&quot;</span>, i)),<br>&#125;<br>&#125;<br><span class="hljs-comment">// ç­‰ 5 s</span><br>time.Sleep(<span class="hljs-number">5</span> * time.Second)<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ç­‰å¾…æ˜¯ä¸ºäº†å°†å›è°ƒä¿¡æ¯å…¨éƒ¨æ‰“å°å®Œæ¯•ï¼Œç»è¿‡ç ”ç©¶å‘ç°å½“è°ƒç”¨<code>producer.Close()</code>æ—¶ä¼šå°†å†…éƒ¨ç»´æŠ¤çš„ channel éƒ½å…³é—­</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *asyncProducer)</span></span> shutdown() &#123;<br>Logger.Println(<span class="hljs-string">&quot;Producer shutting down.&quot;</span>)<br>p.inFlight.Add(<span class="hljs-number">1</span>)<br>p.input &lt;- &amp;ProducerMessage&#123;flags: shutdown&#125;<br><br>p.inFlight.Wait()<br><br>err := p.client.Close()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>Logger.Println(<span class="hljs-string">&quot;producer/shutdown failed to close the embedded client:&quot;</span>, err)<br>&#125;<br><br><span class="hljs-built_in">close</span>(p.input)<br><span class="hljs-built_in">close</span>(p.retries)<br><span class="hljs-built_in">close</span>(p.errors)<br><span class="hljs-built_in">close</span>(p.successes)<br><br>p.metricsRegistry.UnregisterAll()<br>&#125;<br></code></pre></td></tr></table></figure><p>å› æ­¤å¯ä»¥ä½¿ç”¨<code>sync.WaitGroup</code>è¿›è¡Œæ”¹é€ </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> example<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/Shopify/sarama&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> maxRecordNum = <span class="hljs-number">1000</span><br><span class="hljs-keyword">var</span> topic = <span class="hljs-string">&quot;sarama&quot;</span><br><br><span class="hljs-comment">// SimpleProducer ç®€å•ç”Ÿäº§ç”Ÿ</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SimpleProducer</span><span class="hljs-params">()</span></span> &#123;<br>brokers := []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;127.0.0.1:9092&quot;</span>&#125;<br><span class="hljs-comment">// ç”Ÿäº§è€…é»˜è®¤é…ç½®</span><br>config := sarama.NewConfig()<br>config.ClientID = <span class="hljs-string">&quot;demo-producer&quot;</span><br><span class="hljs-comment">// é…ç½® ack</span><br>config.Producer.RequiredAcks = sarama.WaitForAll<br><span class="hljs-comment">// å¼€å¯å¼‚æ­¥å›è°ƒ</span><br>config.Producer.Return.Successes = <span class="hljs-literal">true</span><br>config.Producer.Return.Errors = <span class="hljs-literal">true</span><br><span class="hljs-comment">// å¼€å¯æ—¥å¿—</span><br>logger := log.New(os.Stdout, <span class="hljs-string">&quot;[Sarama] &quot;</span>, log.LstdFlags)<br>sarama.Logger = logger<br>producer, err := sarama.NewAsyncProducer(brokers, config)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br><span class="hljs-comment">// å¼‚æ­¥å›è°ƒ</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> message := <span class="hljs-keyword">range</span> producer.Successes() &#123;<br>logger.Println(<span class="hljs-string">&quot;success: &quot;</span>, message.Value, message.Partition, message.Offset)<br>&#125;<br>wg.Done()<br>&#125;()<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> err := <span class="hljs-keyword">range</span> producer.Errors() &#123;<br>logger.Println(<span class="hljs-string">&quot;errors: &quot;</span>, err.Err.Error())<br>&#125;<br>wg.Done()<br>&#125;()<br><span class="hljs-comment">// å‘é€æ•°æ®</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; maxRecordNum; i++ &#123;<br>producer.Input() &lt;- &amp;sarama.ProducerMessage&#123;<br>Topic: topic,<br>Value: sarama.StringEncoder(fmt.Sprintf(<span class="hljs-string">&quot;srama-%v&quot;</span>, i)),<br>&#125;<br>&#125;<br><span class="hljs-comment">// å…³é—­ç”Ÿäº§è€…</span><br>_ = producer.Close()<br><span class="hljs-comment">// ç­‰å¾…å¤„ç†å®Œæ‰€æœ‰çš„å›è°ƒä¿¡æ¯</span><br>wg.Wait()<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="consumer"><a href="#consumer" class="headerlink" title="consumer"></a>consumer</h3><p>sarama çš„ consumer å°†ä¼šå˜å¾—å¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦æˆ‘ä»¬å»å®ç°å®ƒçš„æ¶ˆè´¹ handler æ¥å£ï¼ŒåŒæ—¶æä¾›<code>Consumer</code>å’Œ<code>ConsumerGroup</code>ä¸¤ç§ï¼Œä¸åœ¨èµ˜è¿°æ¶ˆè´¹è€…å’Œæ¶ˆè´¹è€…ç»„çš„æ¦‚å¿µï¼Œè¿™é‡Œä½¿ç”¨<code>ConsumerGroup</code>æ¥æ¼”ç¤ºã€‚åˆ›å»ºæ–¹å¼å’Œ producer åŸºæœ¬ä¸€è‡´</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> groupID = <span class="hljs-string">&quot;sarama-consumer&quot;</span><br><span class="hljs-keyword">var</span> brokers = []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;127.0.0.1:9092&quot;</span>&#125;<br><span class="hljs-keyword">var</span> config = sarama.NewConfig()<br>sarama.NewConsumerGroup(brokers, groupID, config)<br></code></pre></td></tr></table></figure><p>å¯¹äº consumer æ¥è¯´é€šå¸¸çš„é…ç½®å°±æ˜¯å…³é—­è‡ªåŠ¨æäº¤å’Œåç§»é‡åˆå§‹åŒ–ç­–ç•¥(oldestæˆ–latest)ï¼Œé…ç½®å¦‚ä¸‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// å…³é—­è‡ªåŠ¨æäº¤</span><br>config.Consumer.Offsets.AutoCommit.Enable = <span class="hljs-literal">false</span><br>config.Consumer.Offsets.Initial = sarama.OffsetOldest<br><br></code></pre></td></tr></table></figure><p><code>config.Consumer.Offsets.Initial</code>å’Œ ack ä¸€è‡´ï¼Œæœ¬è´¨ä¸Šæ˜¯ int64ï¼Œè¿™é‡ŒåŒæ ·æ˜¯ä¸ºäº†æ¶ˆé™¤é­”æ•°</p><p>ä¸‹é¢å¼€å§‹æ¶ˆè´¹æ•°æ®ï¼Œå…¶æ–¹æ³•å¦‚ä¸‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">Consume(ctx context.Context, topics []<span class="hljs-type">string</span>, handler ConsumerGroupHandler) <span class="hljs-type">error</span><br></code></pre></td></tr></table></figure><ul><li>ctx: ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå› ä¸ºæ¶ˆè´¹é€»è¾‘åœ¨ goroutine ä¸­è¿›è¡Œï¼Œéœ€è¦ä½¿ç”¨ context æ¥æ§åˆ¶</li><li>topics: éœ€è¦æ¶ˆè´¹çš„ topic</li><li>handler: å°è£…æ¶ˆè´¹é€»è¾‘</li></ul><p>å¯¹äº ctx ä¸ºäº†è®© consumer ä¼˜é›…é€€å‡º</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// æä¸€ä¸ªä¸Šä¸‹æ–‡ç”¨äºç»ˆæ­¢æ¶ˆè´¹è€…</span><br>ctx, cancelFunc := context.WithCancel(context.Background())<br><span class="hljs-comment">// ç›‘å¬ç»ˆæ­¢ä¿¡å·</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>  quit := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)<br>  signal.Notify(quit, syscall.SIGHUP, syscall.SIGINT, syscall.SIGTERM, syscall.SIGQUIT)<br>  &lt;-quit<br>  cancelFunc()<br>&#125;()<br></code></pre></td></tr></table></figure><p>å½“ç›‘å¬åˆ°ç³»ç»Ÿç»ˆæ­¢ç­‰ä¿¡å·æ—¶æ‰§è¡Œ<code>cancelFunc</code>åœæ­¢<code>handler</code>çš„æ¶ˆè´¹é€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦å®ç°<code>ConsumerGroupHandler</code>çš„æ¥å£</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> ConsumerGroupHandler <span class="hljs-keyword">interface</span> &#123;<br><span class="hljs-comment">// Setup is run at the beginning of a new session, before ConsumeClaim.</span><br>Setup(ConsumerGroupSession) <span class="hljs-type">error</span><br><br><span class="hljs-comment">// Cleanup is run at the end of a session, once all ConsumeClaim goroutines have exited</span><br><span class="hljs-comment">// but before the offsets are committed for the very last time.</span><br>Cleanup(ConsumerGroupSession) <span class="hljs-type">error</span><br><br><span class="hljs-comment">// ConsumeClaim must start a consumer loop of ConsumerGroupClaim&#x27;s Messages().</span><br><span class="hljs-comment">// Once the Messages() channel is closed, the Handler must finish its processing</span><br><span class="hljs-comment">// loop and exit.</span><br>ConsumeClaim(ConsumerGroupSession, ConsumerGroupClaim) <span class="hljs-type">error</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªç©ºç»“æ„ä½“å»å®ç°è¿™ä¸ªæ¥å£ï¼Œæš‚æ—¶å…ˆä¸å…³æ³¨<code>Setup</code>å’Œ<code>Cleanup</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Consumer <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Consumer)</span></span> ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) <span class="hljs-type">error</span> &#123;<br>EXIT:<br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> message := &lt;-claim.Messages():<br>log.Printf(<span class="hljs-string">&quot;Message claimed: value = %s, timestamp = %v, topic = %s&quot;</span>, <span class="hljs-type">string</span>(message.Value), message.Timestamp, message.Topic)<br><span class="hljs-comment">// æ ‡è®°æ¶ˆæ¯ï¼Œå¹¶ä¸æ˜¯æäº¤åç§»é‡</span><br>session.MarkMessage(message, <span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-comment">// åŒæ­¥æäº¤</span><br>      session.Commit()<br><span class="hljs-keyword">case</span> &lt;-session.Context().Done():<br>log.Println(<span class="hljs-string">&quot;cancel consumer&quot;</span>)<br><span class="hljs-keyword">break</span> EXIT<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>Tips: <code>session.MarkMessage(message, &quot;&quot;)</code>æ˜¯å¾ˆé‡è¦çš„æ“ä½œï¼Œæ ‡è®°å½“å‰æ¶ˆæ¯å·²ç»å¤„ç†å®Œæˆå¹¶åœ¨å†…éƒ¨è®°å½•å½“å‰åˆ†åŒºçš„åç§»é‡ï¼Œä½†å¹¶ä¸æ˜¯æäº¤åç§»é‡ï¼ŒMark çš„ä½œç”¨ç›¸å½“äº flink çš„çŠ¶æ€ï¼Œå½“è°ƒç”¨<code>session.Commit()</code>æ—¶æ‰ä¼šå°†å†…éƒ¨ä¿å­˜çš„ offset æäº¤åˆ° kafka ä¸­ã€‚ä¸ºäº†ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ä¸€å®šæ˜¯å…ˆå¤„ç†æ•°æ®å†æ ‡è®°æ¶ˆæ¯</p></blockquote><p>ä¸ºäº†æé«˜æ•ˆç‡éœ€è¦å°†<code>session.Commit()</code>è¿›è¡Œå¼‚æ­¥å¤„ç†ï¼Œå› æ­¤åœ¨<code>Setup</code>ä¸­å¯åŠ¨ä¸€ä¸ª goroutine ä¸“é—¨ç”¨äºå¼‚æ­¥æäº¤ï¼Œå½“æ¶ˆæ¯å¤„ç†å®Œå‘ŠçŸ¥è¿™ä¸ª goroutine è¿›è¡Œä¸€æ¬¡ Commitï¼Œå› æ­¤éœ€è¦ç»´æŠ¤ä¸€ä¸ª channel</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> asyncOffset <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;<br><span class="hljs-keyword">var</span> wg sync.WaitGroup <span class="hljs-comment">// åé¢å†è§£é‡Š</span><br><span class="hljs-keyword">const</span> defaultOffsetChannelSize = math.MaxInt<br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Consumer)</span></span> Setup(session sarama.ConsumerGroupSession) <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">// åˆå§‹åŒ–å¼‚æ­¥æäº¤çš„channel</span><br>asyncOffset = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;, defaultOffsetChannelSize)<br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-comment">// å¼‚æ­¥æäº¤åç§»é‡</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">range</span> asyncOffset &#123;<br>session.Commit()<br>&#125;<br>wg.Done()<br>&#125;()<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Cleanup</code>ç”¨äºå…³é—­é€šé“</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Consumer)</span></span> Cleanup(_ sarama.ConsumerGroupSession) <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">// å…³é—­é€šé“</span><br><span class="hljs-built_in">close</span>(asyncOffset)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>ConsumeClaim</code>åˆ™è§¦å‘æäº¤åç§»é‡</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Consumer)</span></span> ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) <span class="hljs-type">error</span> &#123;<br>EXIT:<br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> message := &lt;-claim.Messages():<br>log.Printf(<span class="hljs-string">&quot;Message claimed: value = %s, timestamp = %v, topic = %s&quot;</span>, <span class="hljs-type">string</span>(message.Value), message.Timestamp, message.Topic)<br><span class="hljs-comment">// æ ‡è®°æ¶ˆæ¯ï¼Œå¹¶ä¸æ˜¯æäº¤åç§»é‡</span><br>session.MarkMessage(message, <span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-comment">// å¼‚æ­¥æäº¤</span><br>asyncOffset &lt;- <span class="hljs-keyword">struct</span>&#123;&#125;&#123;&#125;<br><span class="hljs-keyword">case</span> &lt;-session.Context().Done():<br>log.Println(<span class="hljs-string">&quot;cancel consumer&quot;</span>)<br><span class="hljs-keyword">break</span> EXIT<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p> Tips: ç©º struct{} åœ¨ go ä¸­æ˜¯ä¸å ç”¨å†…å­˜ç©ºé—´çš„</p></blockquote><p>ä¸ºäº†å½“å®¢æˆ·ç«¯åœæ­¢æ¶ˆè´¹æ—¶æ‰€æœ‰çš„åç§»é‡éƒ½èƒ½æäº¤åˆ™ä½¿ç”¨<code>sync.WaitGroup</code>ï¼Œæœ€ç»ˆå®Œæ•´ä»£ç å¦‚ä¸‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> example<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;github.com/Shopify/sarama&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;math&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;os/signal&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;syscall&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> groupID = <span class="hljs-string">&quot;sarama-consumer&quot;</span><br><span class="hljs-keyword">var</span> asyncOffset <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;<br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br><br><span class="hljs-keyword">const</span> defaultOffsetChannelSize = math.MaxInt<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SimpleConsumer</span><span class="hljs-params">()</span></span> &#123;<br>brokers := []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;127.0.0.1:9092&quot;</span>&#125;<br><span class="hljs-comment">// æ¶ˆè´¹è€…é…ç½®</span><br>config := sarama.NewConfig()<br><span class="hljs-comment">// å…³é—­è‡ªåŠ¨æäº¤</span><br>config.Consumer.Offsets.AutoCommit.Enable = <span class="hljs-literal">false</span><br>config.Consumer.Offsets.Initial = sarama.OffsetOldest<br><span class="hljs-comment">// å¼€å¯æ—¥å¿—</span><br>logger := log.New(os.Stdout, <span class="hljs-string">&quot;[Sarama] &quot;</span>, log.LstdFlags)<br>sarama.Logger = logger<br>consumer, err := sarama.NewConsumerGroup(brokers, groupID, config)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; _ = consumer.Close() &#125;()<br><span class="hljs-comment">// æä¸€ä¸ªä¸Šä¸‹æ–‡ç”¨äºç»ˆæ­¢æ¶ˆè´¹è€…</span><br>ctx, cancelFunc := context.WithCancel(context.Background())<br><span class="hljs-comment">// ç›‘å¬ç»ˆæ­¢ä¿¡å·</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>logger.Println(<span class="hljs-string">&quot;monitor signal&quot;</span>)<br>quit := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)<br>signal.Notify(quit, syscall.SIGHUP, syscall.SIGINT, syscall.SIGTERM, syscall.SIGQUIT)<br>&lt;-quit<br>logger.Println(<span class="hljs-string">&quot;stop consumer&quot;</span>)<br>cancelFunc()<br>&#125;()<br><span class="hljs-comment">// æ¶ˆè´¹æ•°æ®</span><br>err = consumer.Consume(ctx, []<span class="hljs-type">string</span>&#123;topic&#125;, &amp;Consumer&#123;&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰åç§»é‡éƒ½æäº¤å®Œæ¯•å†é€€å‡º</span><br>logger.Println(<span class="hljs-string">&quot;å½“å‰å­˜åœ¨æœªæäº¤çš„åç§»é‡&quot;</span>)<br>wg.Wait()<br>&#125;<br><br><span class="hljs-keyword">type</span> Consumer <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Consumer)</span></span> Setup(session sarama.ConsumerGroupSession) <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">// åˆå§‹åŒ–å¼‚æ­¥æäº¤çš„channel</span><br>asyncOffset = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;, defaultOffsetChannelSize)<br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-comment">// å¼‚æ­¥æäº¤åç§»é‡</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">range</span> asyncOffset &#123;<br>session.Commit()<br>&#125;<br>wg.Done()<br>&#125;()<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Consumer)</span></span> Cleanup(_ sarama.ConsumerGroupSession) <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">// å…³é—­é€šé“</span><br><span class="hljs-built_in">close</span>(asyncOffset)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Consumer)</span></span> ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) <span class="hljs-type">error</span> &#123;<br>EXIT:<br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> message := &lt;-claim.Messages():<br>log.Printf(<span class="hljs-string">&quot;Message claimed: value = %s, timestamp = %v, topic = %s&quot;</span>, <span class="hljs-type">string</span>(message.Value), message.Timestamp, message.Topic)<br><span class="hljs-comment">// æ ‡è®°æ¶ˆæ¯ï¼Œå¹¶ä¸æ˜¯æäº¤åç§»é‡</span><br>session.MarkMessage(message, <span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-comment">// å¼‚æ­¥æäº¤</span><br>asyncOffset &lt;- <span class="hljs-keyword">struct</span>&#123;&#125;&#123;&#125;<br><span class="hljs-keyword">case</span> &lt;-session.Context().Done():<br>log.Println(<span class="hljs-string">&quot;cancel consumer&quot;</span>)<br><span class="hljs-keyword">break</span> EXIT<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>KafKa ä»‹ç»</title>
    <link href="/2024/05/27/tools/Kafka%E6%98%AF%E4%BB%80%E4%B9%88/"/>
    <url>/2024/05/27/tools/Kafka%E6%98%AF%E4%BB%80%E4%B9%88/</url>
    
    <content type="html"><![CDATA[<p><strong>ä½ æ˜¯ä¸€ä¸ªç¨‹åºå‘˜ï¼Œå‡è®¾ä½ ç»´æŠ¤äº†ä¸¤ä¸ªæœåŠ¡ A å’Œ Bã€‚B æœåŠ¡æ¯ç§’åªèƒ½å¤„ç† 100 ä¸ªæ¶ˆæ¯ï¼Œä½† A æœåŠ¡å´æ¯ç§’å‘å‡º 200 ä¸ªæ¶ˆæ¯ï¼ŒB æœåŠ¡å“ªé‡Œé¡¶å¾—ä½ï¼Œåˆ†åˆ†é’Ÿè¢«å‹å®ã€‚é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œæœ‰æ²¡æœ‰åŠæ³•è®© B åœ¨ä¸è¢«å‹å®çš„åŒæ—¶ï¼Œè¿˜èƒ½å¤„ç†æ‰ A çš„æ¶ˆæ¯ï¼Ÿå½“ç„¶æœ‰ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€å±‚ä¸­é—´å±‚ä¸èƒ½è§£å†³çš„ï¼Œå¦‚æœæœ‰ï¼Œé‚£å°±å†åŠ ä¸€å±‚ã€‚è¿™æ¬¡æˆ‘ä»¬è¦åŠ çš„ä¸­é—´å±‚æ˜¯ æ¶ˆæ¯é˜Ÿåˆ— Kafkaã€‚</strong></p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514092819890.png?raw=true" alt="image-20240514092819890"></p><h2 id="ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—"><a href="#ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—"></a>ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—</h2><p>ä¸ºäº†ä¿æŠ¤ B æœåŠ¡ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°å¯ä»¥åœ¨ B æœåŠ¡çš„å†…å­˜ä¸­åŠ å…¥ä¸€ä¸ª<strong>é˜Ÿåˆ—</strong>ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514092948006.png?raw=true" alt="image-20240514092948006"></p><p>è¯´ç™½äº†ï¼Œå®ƒå…¶å®æ˜¯ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨çš„æ¯ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªæ¶ˆæ¯ã€‚æ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªåºå·ï¼Œæˆ‘ä»¬å«å®ƒ <code>Offset(ç›¸å½“ä¸€ä¸ªä¹¦ç­¾)</code>ï¼Œè®°å½•æ¶ˆæ¯çš„ä½ç½®ã€‚B æœåŠ¡ä¾æ®è‡ªå·±çš„å¤„ç†èƒ½åŠ›ï¼Œæ¶ˆè´¹é“¾è¡¨é‡Œçš„æ¶ˆæ¯ã€‚èƒ½å¤„ç†å¤šå°‘æ˜¯å¤šå°‘ï¼Œä¸æ–­æ›´æ–°å·²å¤„ç† Offset çš„å€¼ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514093303221.png?raw=true" alt="image-20240514093303221"></p><p>ä½†è¿™æœ‰ä¸ªé—®é¢˜ï¼Œæ¥ä¸åŠå¤„ç†çš„æ¶ˆæ¯ä¼šå †ç§¯åœ¨å†…å­˜é‡Œï¼Œå¦‚æœ B æœåŠ¡æ›´æ–°<strong>é‡å¯</strong>ï¼Œè¿™äº›æ¶ˆæ¯å°±éƒ½ä¸¢äº†ã€‚è¿™ä¸ªå¥½è§£å†³ï¼Œå°†é˜Ÿåˆ—æŒªå‡ºæ¥ï¼Œå˜æˆä¸€ä¸ª<strong>å•ç‹¬çš„è¿›ç¨‹</strong>ã€‚å°±ç®— B æœåŠ¡é‡å¯ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°äº†é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514093434298.png?raw=true" alt="image-20240514093434298"></p><p>è¿™æ ·ä¸€ä¸ªç®€é™‹çš„é˜Ÿåˆ—è¿›ç¨‹ï¼Œå…¶å®å°±æ˜¯æ‰€è°“çš„<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ã€‚è€Œåƒ A æœåŠ¡è¿™æ ·è´Ÿè´£å‘æ•°æ®åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„è§’è‰²ï¼Œå°±æ˜¯<strong>ç”Ÿäº§è€…</strong>ï¼Œåƒ B æœåŠ¡è¿™æ ·å¤„ç†æ¶ˆæ¯çš„è§’è‰²ï¼Œå°±æ˜¯<strong>æ¶ˆè´¹è€…</strong>ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514094020978.png?raw=true" alt="image-20240514094020978"></p><p>ä½†è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å±å®è¿‡äºç®€é™‹ï¼Œåƒä»€ä¹ˆé«˜æ€§èƒ½ï¼Œé«˜æ‰©å±•æ€§ï¼Œé«˜å¯ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªéƒ½ä¸æ²¾ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹æ€ä¹ˆä¼˜åŒ–å®ƒã€‚</p><h2 id="é«˜æ€§èƒ½"><a href="#é«˜æ€§èƒ½" class="headerlink" title="é«˜æ€§èƒ½"></a>é«˜æ€§èƒ½</h2><p>B æœåŠ¡ç”±äºæ€§èƒ½è¾ƒå·®ï¼Œæ¶ˆæ¯é˜Ÿåˆ—é‡Œä¼šä¸æ–­å †ç§¯æ•°æ®ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•æ›´å¤šçš„æ¶ˆè´¹è€…, è¿™æ ·æ¶ˆè´¹é€Ÿåº¦å°±ä¸Šå»äº†ï¼Œç›¸å¯¹çš„æˆ‘ä»¬å°±å¯ä»¥å¢åŠ æ›´å¤šç”Ÿäº§è€…ï¼Œæå‡æ¶ˆæ¯é˜Ÿåˆ—çš„ååé‡ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514094125035.png?raw=true" alt="image-20240514094125035"></p><p>éšç€ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½å˜å¤šï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒä»¬ä¼šåŒæ—¶äº‰æŠ¢åŒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒæŠ¢ä¸åˆ°çš„ä¸€æ–¹å°±å¾—ç­‰å¾…ï¼Œè¿™ä¸çº¯çº¯æµªè´¹æ—¶é—´å—ï¼æœ‰è§£å†³æ–¹æ¡ˆå—ï¼Ÿæœ‰ï¼é¦–å…ˆæ˜¯å¯¹æ¶ˆæ¯è¿›è¡Œåˆ†ç±»ï¼Œæ¯ä¸€ç±»æ˜¯ä¸€ä¸ª <strong>topic</strong>ï¼Œç„¶åæ ¹æ® topic æ–°å¢é˜Ÿåˆ—çš„æ•°é‡ï¼Œç”Ÿäº§è€…å°†æ•°æ®æŒ‰ topic æŠ•é€’åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…åˆ™æ ¹æ®éœ€è¦è®¢é˜…ä¸åŒçš„ topicã€‚è¿™å°±å¤§å¤§é™ä½äº† topic é˜Ÿåˆ—çš„å‹åŠ›ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514100259038.png?raw=true" alt="image-20240514100259038"></p><p>ä½†å•ä¸ª topic çš„æ¶ˆæ¯è¿˜æ˜¯å¯èƒ½è¿‡å¤šï¼Œæˆ‘ä»¬å¯ä»¥å°†å•ä¸ªé˜Ÿåˆ—ï¼Œæ‹†æˆå¥½å‡ æ®µï¼Œæ¯æ®µå°±æ˜¯ä¸€ä¸ª <strong>partitionåˆ†åŒº</strong>ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£ä¸€ä¸ª partitionã€‚è¿™å°±å¤§å¤§é™ä½äº†äº‰æŠ¢ï¼Œæå‡äº†æ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½ã€‚</p><ul><li>Partitionæ˜¯Topicå†…éƒ¨çš„ç‰©ç†åˆ†ç‰‡ï¼Œæ¯ä¸ªTopicå¯ä»¥è¢«åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªPartitionã€‚è¿™æ ·åšä¸ä»…å…è®¸æ•°æ®å¹¶è¡Œå¤„ç†ï¼Œè¿˜ä¸ºæ•°æ®çš„è§„æ¨¡æ‰©å±•æä¾›äº†åŸºç¡€ã€‚</li><li>æ¯ä¸ªPartitionéƒ½æ˜¯ä¸€ä¸ªæœ‰åºçš„ã€ä¸å¯å˜çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯åœ¨Partitionå†…éƒ¨æ˜¯ä¸¥æ ¼æœ‰åºçš„ï¼Œä½†ä¸åŒPartitioné—´çš„æ¶ˆæ¯é¡ºåºä¸ä¿è¯ã€‚</li><li>Partitionçš„æ•°é‡å¯ä»¥åœ¨åˆ›å»ºTopicæ—¶æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åç»­è°ƒæ•´ï¼ˆå°½ç®¡è¿™é€šå¸¸éœ€è¦é‡æ–°åˆ†é…æ•°æ®ï¼Œå¯èƒ½å½±å“åˆ°å®æ—¶æ¶ˆæ¯å¤„ç†ï¼‰ã€‚</li><li>Partitionçš„æ•°æ®åˆ†å¸ƒåœ¨ä¸åŒçš„Brokerä¸Šï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡å’Œæ•…éšœéš”ç¦»ã€‚æ¯ä¸ªPartitionéƒ½æœ‰ä¸€ä¸ªLeaderå’Œé›¶ä¸ªæˆ–å¤šä¸ªFollowerï¼ŒLeaderè´Ÿè´£è¯»å†™æ“ä½œï¼ŒFollowerè´Ÿè´£æ•°æ®å¤åˆ¶ä»¥ç¡®ä¿æ•°æ®å®‰å…¨ã€‚</li></ul><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514104614344.png?raw=true" alt="image-20240514104614344"></p><blockquote><p>Broker æ˜¯Kafkaé›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè´Ÿè´£æ¶ˆæ¯çš„æ¥æ”¶ã€å­˜å‚¨ã€åˆ†å‘ä»¥åŠç›¸å…³çš„ç®¡ç†å·¥ä½œã€‚</p></blockquote><h2 id="é«˜æ‰©å±•æ€§"><a href="#é«˜æ‰©å±•æ€§" class="headerlink" title="é«˜æ‰©å±•æ€§"></a>é«˜æ‰©å±•æ€§</h2><p>éšç€ partition å˜å¤šï¼Œå¦‚æœ partition éƒ½åœ¨åŒä¸€å°æœºå™¨ä¸Šçš„è¯ï¼Œå°±ä¼šå¯¼è‡´å•æœº cpu å’Œå†…å­˜è¿‡é«˜ï¼Œå½±å“æ•´ä½“ç³»ç»Ÿæ€§èƒ½ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514104741761.png?raw=true" alt="image-20240514104741761"></p><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥ç”³è¯·æ›´å¤šçš„æœºå™¨ï¼Œå°† partition åˆ†æ•£éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šï¼Œè¿™æ¯ä¸€å°æœºå™¨ï¼Œå°±ä»£è¡¨ä¸€ä¸ª <strong>broker</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ  broker ç¼“è§£æœºå™¨ cpu è¿‡é«˜å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514104846414.png?raw=true" alt="image-20240514104846414"></p><h2 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h2><p>åˆ°è¿™é‡Œï¼Œå…¶å®è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ª partition æ‰€åœ¨çš„ broker æŒ‚äº†ï¼Œé‚£ broker é‡Œæ‰€æœ‰ partition çš„æ¶ˆæ¯å°±éƒ½æ²¡äº†ã€‚è¿™é«˜å¯ç”¨è¿˜ä»ä½•è°ˆèµ·ï¼Ÿæœ‰è§£å†³æ–¹æ¡ˆå—ï¼Ÿæœ‰ï¼Œè¿ä½ å–œæ¬¢çš„å¥³ç”Ÿéƒ½çŸ¥é“æ‰‹æœºé‡Œå¤šèŠå‡ ä¸ªæ²¸ç¾Šç¾Šï¼Œä½ å´ä¸çŸ¥é“è¦ç»™ partition åŠ å¤‡èƒå—ï¼Ÿæˆ‘ä»¬å¯ä»¥ç»™ partition å¤šåŠ å‡ ä¸ªå‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯ replicasï¼Œå°†å®ƒä»¬åˆ†ä¸º Leader å’Œ Followerã€‚Leader è´Ÿè´£åº”ä»˜ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„è¯»å†™è¯·æ±‚ï¼Œè€Œ Follower åªç®¡åŒæ­¥ Leader çš„æ¶ˆæ¯ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514105013986.png?raw=true" alt="image-20240514105013986"></p><p>å°† Leader å’Œ Follower åˆ†æ•£åˆ°ä¸åŒçš„ broker ä¸Šï¼Œè¿™æ · Leader æ‰€åœ¨çš„ broker æŒ‚äº†ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ° Follower æ‰€åœ¨çš„ broker, å¹¶ä¸”è¿˜èƒ½ä» Follower ä¸­é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„ Leader partition é¡¶ä¸Šã€‚è¿™æ ·å°±ä¿è¯äº†æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514105052593.png?raw=true" alt="image-20240514105052593"></p><h2 id="æŒä¹…åŒ–å’Œè¿‡æœŸç­–ç•¥"><a href="#æŒä¹…åŒ–å’Œè¿‡æœŸç­–ç•¥" class="headerlink" title="æŒä¹…åŒ–å’Œè¿‡æœŸç­–ç•¥"></a>æŒä¹…åŒ–å’Œè¿‡æœŸç­–ç•¥</h2><p>åˆšåˆšæåˆ°çš„æ˜¯å‡ ä¸ª broker æŒ‚æ‰çš„æƒ…å†µï¼Œé‚£æå¤§ç‚¹ï¼Œå‡è®¾æ‰€æœ‰ broker éƒ½æŒ‚äº†ï¼Œé‚£å²‚ä¸æ˜¯æ•°æ®å…¨ä¸¢äº†ï¼Ÿä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸èƒ½å…‰æŠŠæ•°æ®æ”¾å†…å­˜é‡Œï¼Œè¿˜è¦æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œè¿™æ ·å“ªæ€•å…¨éƒ¨ broker éƒ½æŒ‚äº†ï¼Œæ•°æ®ä¹Ÿä¸ä¼šå…¨ä¸¢ï¼Œé‡å¯æœåŠ¡åï¼Œä¹Ÿèƒ½ä»ç£ç›˜é‡Œè¯»å‡ºæ•°æ®ï¼Œç»§ç»­å·¥ä½œã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514105125764.png?raw=true" alt="image-20240514105125764"></p><p>ä½†é—®é¢˜åˆæ¥äº†ï¼Œç£ç›˜æ€»æ˜¯æœ‰é™çš„ï¼Œè¿™ä¸€ç›´å¾€é‡Œå†™æ•°æ®è¿Ÿæ—©æœ‰ä¸€å¤©å¾—ç‚¸ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥ç»™æ•°æ®åŠ ä¸Šä¿ç•™ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ <code>retention policy</code>ï¼Œæ¯”å¦‚ç£ç›˜æ•°æ®è¶…è¿‡ä¸€å®šå¤§å°æˆ–æ¶ˆæ¯æ”¾ç½®è¶…è¿‡ä¸€å®šæ—¶é—´å°±ä¼šè¢«æ¸…ç†æ‰ã€‚</p><h2 id="consumer-group"><a href="#consumer-group" class="headerlink" title="consumer group"></a>consumer group</h2><p>åˆ°è¿™é‡Œï¼Œè¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å¥½åƒå°±æŒºå®Œç¾äº†ã€‚ä½†å…¶å®è¿˜æœ‰ä¸ªé—®é¢˜ï¼ŒæŒ‰ç°åœ¨çš„æ¶ˆè´¹æ–¹å¼ï¼Œæ¯æ¬¡æ–°å¢çš„æ¶ˆè´¹è€…åªèƒ½è·Ÿç€<strong>æœ€æ–°çš„</strong>æ¶ˆè´¹ Offset æ¥ç€æ¶ˆè´¹ã€‚å¦‚æœæˆ‘æƒ³è®©æ–°å¢çš„æ¶ˆè´¹è€…ä»æŸä¸ª Offset å¼€å§‹æ¶ˆè´¹å‘¢ï¼Ÿå¬èµ·æ¥è¿™ä¸ªéœ€æ±‚å¾ˆåˆé’»ï¼Ÿæˆ‘ä¸¾ä¸ªä¾‹å­ä½ å°±æ˜ç™½äº†ã€‚</p><p>å“ªæ€• B æœåŠ¡æœ‰å¤šä¸ªå®ä¾‹ï¼Œä½†æœ¬è´¨ä¸Šï¼Œå®ƒåªæœ‰ä¸€ä¸ªæ¶ˆè´¹ä¸šåŠ¡æ–¹ï¼Œæ–°å¢å®ä¾‹ä¸€èˆ¬ä¹Ÿæ˜¯æ¥ç€ä¹‹å‰çš„ offset ç»§ç»­æ¶ˆè´¹ã€‚å‡è®¾ç°åœ¨æ¥äº†ä¸ªæ–°çš„ä¸šåŠ¡æ–¹ï¼ŒC æœåŠ¡ï¼Œå®ƒæƒ³ä»å¤´å¼€å§‹æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„æ•°æ®ï¼Œè¿™æ—¶å€™å°±ä¸èƒ½è·Ÿåœ¨ B æœåŠ¡çš„ offset åè¾¹ç»§ç»­æ¶ˆè´¹äº†ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥ç»™æ¶ˆæ¯é˜Ÿåˆ—åŠ å…¥æ¶ˆè´¹è€…ç»„ï¼ˆconsumer groupï¼‰çš„æ¦‚å¿µï¼ŒB å’Œ C æœåŠ¡å„è‡ªæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¶ˆè´¹è€…ç»„ï¼Œä¸åŒæ¶ˆè´¹è€…ç»„ç»´æŠ¤è‡ªå·±çš„æ¶ˆè´¹è¿›åº¦ï¼Œäº’ä¸æ‰“æ…ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514110710406.png?raw=true" alt="image-20240514110710406"></p><h2 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h2><p>ç›¸ä¿¡ä½ ä¹Ÿå‘ç°äº†ï¼Œç»„ä»¶å¤ªå¤šäº†ï¼Œè€Œä¸”æ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„æ•°æ®å’ŒçŠ¶æ€ï¼Œæ‰€ä»¥è¿˜éœ€è¦æœ‰ä¸ªç»„ä»¶å»ç»Ÿä¸€ç»´æŠ¤è¿™äº›ç»„ä»¶çš„çŠ¶æ€ä¿¡æ¯ï¼Œäºæ˜¯æˆ‘ä»¬å¼•å…¥ <strong>ZooKeeper</strong> ç»„ä»¶ã€‚å®ƒä¼šå®šæœŸå’Œ broker é€šä¿¡ï¼Œè·å– æ•´ä¸ª kafka é›†ç¾¤çš„çŠ¶æ€ï¼Œä»¥æ­¤åˆ¤æ–­ æŸäº› broker æ˜¯ä¸æ˜¯è·ªäº†ï¼ŒæŸäº›æ¶ˆè´¹ç»„æ¶ˆè´¹åˆ°å“ªäº†ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514110818882.png?raw=true" alt="image-20240514110818882"></p><h2 id="Kafka-æ˜¯ä»€ä¹ˆ"><a href="#Kafka-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Kafka æ˜¯ä»€ä¹ˆ"></a>Kafka æ˜¯ä»€ä¹ˆ</h2><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œå½“åˆé‚£ä¸ªç®€é™‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°±æˆäº†ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œé«˜æ‰©å±•æ€§ï¼Œé«˜å¯ç”¨ï¼Œæ”¯æŒæŒä¹…åŒ–çš„è¶…å¼ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ²¡é”™ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ¶ˆæ¯é˜Ÿåˆ— <strong>Kafka</strong>ï¼Œä¸Šé¢æ¶‰åŠåˆ°å„ç§æ¦‚å¿µï¼Œæ¯”å¦‚ partition å’Œ broker ä»€ä¹ˆçš„ï¼Œéƒ½å‡ºè‡ªå®ƒã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240514110952706.png?raw=true" alt="image-20240514110952706"></p><h2 id="kafka-çš„åº”ç”¨åœºæ™¯"><a href="#kafka-çš„åº”ç”¨åœºæ™¯" class="headerlink" title="kafka çš„åº”ç”¨åœºæ™¯"></a>kafka çš„åº”ç”¨åœºæ™¯</h2><p>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ¶æ„ä¸­æœ€å¸¸è§çš„ä¸­é—´ä»¶ä¹‹ä¸€ï¼Œä½¿ç”¨åœºæ™¯ä¹‹å¤šï¼Œå ªç§°ä¸‡é‡‘æ²¹ï¼æ¯”å¦‚ä¸Šæ¸¸æµé‡å¿½é«˜å¿½ä½ï¼Œæƒ³è¦<strong>å‰Šå³°å¡«è°·</strong>ï¼Œæå‡ cpu&#x2F;gpu åˆ©ç”¨ç‡ï¼Œç”¨å®ƒã€‚åˆæ¯”å¦‚ç³»ç»Ÿè¿‡å¤§ï¼Œæ¶ˆæ¯æµå‘ç›˜æ ¹é”™èŠ‚ï¼Œæƒ³è¦æ‹†è§£ç»„ä»¶ï¼Œ<strong>é™ä½ç³»ç»Ÿè€¦åˆ</strong>ï¼Œè¿˜æ˜¯ç”¨å®ƒã€‚å†æ¯”å¦‚ç§’æ€æ´»åŠ¨ï¼Œè¯·æ±‚æ¿€å¢ï¼Œæƒ³è¦<strong>ä¿æŠ¤æœåŠ¡</strong>çš„åŒæ—¶åˆå°½é‡ä¸å½±å“ç”¨æˆ·ï¼Œè¿˜å¾—ç”¨å®ƒã€‚å½“ç„¶ï¼Œå‡¡äº‹æ— ç»å¯¹ï¼Œæ–¹æ¡ˆè¿˜å¾—æ ¹æ®å®é™…æƒ…å†µæ¥å®šï¼Œåšæ¶æ„åšåˆ°æœ€åï¼Œéƒ½æ˜¯åœ¨åš<strong>æŠ˜ä¸­</strong>ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>â€¢ kafka æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåƒæ¶ˆæ¯é˜Ÿåˆ—æŠ•é€’æ¶ˆæ¯çš„æ˜¯ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹æ¶ˆæ¯çš„æ˜¯æ¶ˆè´¹è€…ã€‚å¢åŠ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å®ä¾‹ä¸ªæ•°å¯ä»¥æå‡ç³»ç»Ÿååã€‚å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥ç»„æˆä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼Œä¸åŒæ¶ˆè´¹è€…ç»„ç»´æŠ¤è‡ªå·±çš„æ¶ˆè´¹è¿›åº¦ï¼Œäº’ä¸æ‰“æ…ã€‚</li><li>â€¢ kafka å°†æ¶ˆæ¯åˆ†ä¸ºå¤šä¸ª topicï¼Œæ¯ä¸ª topic å†…éƒ¨æ‹†åˆ†ä¸ºå¤šä¸ª partitionï¼Œæ¯ä¸ª partition åˆæœ‰è‡ªå·±çš„å‰¯æœ¬ï¼Œä¸åŒçš„ partition ä¼šåˆ†å¸ƒåœ¨ä¸åŒçš„ broker ä¸Šï¼Œæå‡æ€§èƒ½çš„åŒæ—¶ï¼Œè¿˜å¢åŠ äº†ç³»ç»Ÿå¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlé«˜çº§1</title>
    <link href="/2024/05/27/tools/Mysql%E9%AB%98%E7%BA%A71/"/>
    <url>/2024/05/27/tools/Mysql%E9%AB%98%E7%BA%A71/</url>
    
    <content type="html"><![CDATA[<h1 id="Mysqlé«˜çº§1"><a href="#Mysqlé«˜çº§1" class="headerlink" title="Mysqlé«˜çº§1"></a>Mysqlé«˜çº§1</h1><h3 id="MySQLé«˜çº§"><a href="#MySQLé«˜çº§" class="headerlink" title="MySQLé«˜çº§"></a>MySQLé«˜çº§</h3><table><thead><tr><th align="center">åºå·</th><th>Day01</th><th>Day02</th><th>Day03</th><th>Day04</th></tr></thead><tbody><tr><td align="center">1</td><td>Linuxç³»ç»Ÿå®‰è£…MySQL</td><td>ä½“ç³»ç»“æ„</td><td>åº”ç”¨ä¼˜åŒ–</td><td>MySQL å¸¸ç”¨å·¥å…·</td></tr><tr><td align="center">2</td><td>ç´¢å¼•</td><td>å­˜å‚¨å¼•æ“</td><td>æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–</td><td>MySQL æ—¥å¿—</td></tr><tr><td align="center">3</td><td>è§†å›¾</td><td>ä¼˜åŒ–SQLæ­¥éª¤</td><td>å†…å­˜ç®¡ç†åŠä¼˜åŒ–</td><td>MySQL ä¸»ä»å¤åˆ¶</td></tr><tr><td align="center">4</td><td>å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</td><td>ç´¢å¼•ä½¿ç”¨</td><td>MySQLé”é—®é¢˜</td><td>ç»¼åˆæ¡ˆä¾‹</td></tr><tr><td align="center">5</td><td>è§¦å‘å™¨</td><td>SQLä¼˜åŒ–</td><td>å¸¸ç”¨SQLæŠ€å·§</td><td></td></tr></tbody></table><h3 id="1-Linux-ç³»ç»Ÿå®‰è£…MySQL"><a href="#1-Linux-ç³»ç»Ÿå®‰è£…MySQL" class="headerlink" title="1. Linux ç³»ç»Ÿå®‰è£…MySQL"></a>1. Linux ç³»ç»Ÿå®‰è£…MySQL</h3><h4 id="1-1-ä¸‹è½½Linux-å®‰è£…åŒ…"><a href="#1-1-ä¸‹è½½Linux-å®‰è£…åŒ…" class="headerlink" title="1.1 ä¸‹è½½Linux å®‰è£…åŒ…"></a>1.1 ä¸‹è½½Linux å®‰è£…åŒ…</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>dev.mysql.com<span class="hljs-regexp">/downloads/my</span>sql/<span class="hljs-number">5.7</span>.html<span class="hljs-comment">#downloads</span><br></code></pre></td></tr></table></figure><h4 id="1-2-å®‰è£…MySQL"><a href="#1-2-å®‰è£…MySQL" class="headerlink" title="1.2 å®‰è£…MySQL"></a>1.2 å®‰è£…MySQL</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>). å¸è½½ centos ä¸­é¢„å®‰è£…çš„ mysql<br><br><span class="hljs-attribute">rpm</span> -qa | grep -i mysql<br><br><span class="hljs-attribute">rpm</span> -e mysql-libs-<span class="hljs-number">5</span>.<span class="hljs-number">1</span>.<span class="hljs-number">71</span>-<span class="hljs-number">1</span>.el6.x86_64 --nodeps<br><br><span class="hljs-attribute">2</span>). ä¸Šä¼  mysql çš„å®‰è£…åŒ…<br><br><span class="hljs-attribute">alt</span> + p -------&gt; put  E:/test/MySQL-<span class="hljs-number">5</span>.<span class="hljs-number">6</span>.<span class="hljs-number">22</span>-<span class="hljs-number">1</span>.el6.i686.rpm-bundle.tar<br><br><span class="hljs-attribute">3</span>). è§£å‹ mysql çš„å®‰è£…åŒ… <br><br><span class="hljs-attribute">mkdir</span> mysql<br><br><span class="hljs-attribute">tar</span> -xvf MySQL-<span class="hljs-number">5</span>.<span class="hljs-number">6</span>.<span class="hljs-number">22</span>-<span class="hljs-number">1</span>.el6.i686.rpm-bundle.tar -C /root/mysql<br><br><span class="hljs-attribute">4</span>). å®‰è£…ä¾èµ–åŒ… <br><br><span class="hljs-attribute">yum</span> -y install libaio.so.<span class="hljs-number">1</span> libgcc_s.so.<span class="hljs-number">1</span> libstdc++.so.<span class="hljs-number">6</span> libncurses.so.<span class="hljs-number">5</span> --setopt=protected_multilib=false<br><br><span class="hljs-attribute">yum</span>  update libstdc++-<span class="hljs-number">4</span>.<span class="hljs-number">4</span>.<span class="hljs-number">7</span>-<span class="hljs-number">4</span>.el6.x86_64<br><br><span class="hljs-attribute">5</span>). å®‰è£… mysql-client<br><br><span class="hljs-attribute">rpm</span> -ivh MySQL-client-<span class="hljs-number">5</span>.<span class="hljs-number">6</span>.<span class="hljs-number">22</span>-<span class="hljs-number">1</span>.el6.i686.rpm<br><br><span class="hljs-attribute">6</span>). å®‰è£… mysql-server<br><br><span class="hljs-attribute">rpm</span> -ivh MySQL-server-<span class="hljs-number">5</span>.<span class="hljs-number">6</span>.<span class="hljs-number">22</span>-<span class="hljs-number">1</span>.el6.i686.rpm<br><br></code></pre></td></tr></table></figure><h4 id="1-3-å¯åŠ¨-MySQL-æœåŠ¡"><a href="#1-3-å¯åŠ¨-MySQL-æœåŠ¡" class="headerlink" title="1.3 å¯åŠ¨ MySQL æœåŠ¡"></a>1.3 å¯åŠ¨ MySQL æœåŠ¡</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs SQL">service mysql <span class="hljs-keyword">start</span><br><br>service mysql stop<br><br>service mysql status<br><br>service mysql restart<br></code></pre></td></tr></table></figure><h4 id="1-4-ç™»å½•MySQL"><a href="#1-4-ç™»å½•MySQL" class="headerlink" title="1.4 ç™»å½•MySQL"></a>1.4 ç™»å½•MySQL</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql å®‰è£…å®Œæˆä¹‹å, ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„å¯†ç , å¹¶ä¸”ä¿å­˜åœ¨ä¸€ä¸ªå¯†ç æ–‡ä»¶ä¸­ : /root/.mysql_secret<br><br>mysql -u root -p <br><br>ç™»å½•ä¹‹å, ä¿®æ”¹å¯†ç  :<br><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">password</span> = <span class="hljs-keyword">password</span>(<span class="hljs-string">&#x27;itcast&#x27;</span>);<br><br>æˆæƒè¿œç¨‹è®¿é—® : <br><br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;root&#x27;</span> @<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;itcast&#x27;</span>;<br>flush <span class="hljs-keyword">privileges</span>;<br><br></code></pre></td></tr></table></figure><h3 id="2-ç´¢å¼•"><a href="#2-ç´¢å¼•" class="headerlink" title="2. ç´¢å¼•"></a>2. ç´¢å¼•</h3><h4 id="2-1-ç´¢å¼•æ¦‚è¿°"><a href="#2-1-ç´¢å¼•æ¦‚è¿°" class="headerlink" title="2.1 ç´¢å¼•æ¦‚è¿°"></a>2.1 ç´¢å¼•æ¦‚è¿°</h4><p>MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ï¼ˆæœ‰åºï¼‰ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤è€…æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚å¦‚ä¸‹é¢çš„&#x3D;&#x3D;ç¤ºæ„å›¾&#x3D;&#x3D;æ‰€ç¤º : </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093105938.png?raw=true" alt="image-20240511093105938"></p><p>å·¦è¾¹æ˜¯æ•°æ®è¡¨ï¼Œä¸€å…±æœ‰ä¸¤åˆ—ä¸ƒæ¡è®°å½•ï¼Œæœ€å·¦è¾¹çš„æ˜¯æ•°æ®è®°å½•çš„ç‰©ç†åœ°å€ï¼ˆæ³¨æ„é€»è¾‘ä¸Šç›¸é‚»çš„è®°å½•åœ¨ç£ç›˜ä¸Šä¹Ÿå¹¶ä¸æ˜¯ä¸€å®šç‰©ç†ç›¸é‚»çš„ï¼‰ã€‚ä¸ºäº†åŠ å¿«Col2çš„æŸ¥æ‰¾ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå³è¾¹æ‰€ç¤ºçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹åˆ†åˆ«åŒ…å«ç´¢å¼•é”®å€¼å’Œä¸€ä¸ªæŒ‡å‘å¯¹åº”æ•°æ®è®°å½•ç‰©ç†åœ°å€çš„æŒ‡é’ˆï¼Œè¿™æ ·å°±å¯ä»¥è¿ç”¨äºŒå‰æŸ¥æ‰¾å¿«é€Ÿè·å–åˆ°ç›¸åº”æ•°æ®ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­ç”¨æ¥æé«˜æ€§èƒ½çš„æœ€å¸¸ç”¨çš„å·¥å…·ã€‚</p><h4 id="2-2-ç´¢å¼•ä¼˜åŠ¿åŠ£åŠ¿"><a href="#2-2-ç´¢å¼•ä¼˜åŠ¿åŠ£åŠ¿" class="headerlink" title="2.2 ç´¢å¼•ä¼˜åŠ¿åŠ£åŠ¿"></a>2.2 ç´¢å¼•ä¼˜åŠ¿åŠ£åŠ¿</h4><p>ä¼˜åŠ¿</p><p>1ï¼‰ ç±»ä¼¼äºä¹¦ç±çš„ç›®å½•ç´¢å¼•ï¼Œæé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„IOæˆæœ¬ã€‚</p><p>2ï¼‰ é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œé™ä½CPUçš„æ¶ˆè€—ã€‚</p><p>åŠ£åŠ¿</p><p>1ï¼‰ å®é™…ä¸Šç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¸­ä¿å­˜äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“ç±»çš„è®°å½•ï¼Œæ‰€ä»¥ç´¢å¼•åˆ—ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„ã€‚</p><p>2ï¼‰ è™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢æ•ˆç‡ï¼ŒåŒæ—¶å´ä¹Ÿé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEã€DELETEã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQL ä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶æ¯æ¬¡æ›´æ–°æ·»åŠ äº†ç´¢å¼•åˆ—çš„å­—æ®µï¼Œéƒ½ä¼šè°ƒæ•´å› ä¸ºæ›´æ–°æ‰€å¸¦æ¥çš„é”®å€¼å˜åŒ–åçš„ç´¢å¼•ä¿¡æ¯ã€‚</p><h4 id="2-3-ç´¢å¼•ç»“æ„"><a href="#2-3-ç´¢å¼•ç»“æ„" class="headerlink" title="2.3 ç´¢å¼•ç»“æ„"></a>2.3 ç´¢å¼•ç»“æ„</h4><p>ç´¢å¼•æ˜¯åœ¨MySQLçš„å­˜å‚¨å¼•æ“å±‚ä¸­å®ç°çš„ï¼Œè€Œä¸æ˜¯åœ¨æœåŠ¡å™¨å±‚å®ç°çš„ã€‚æ‰€ä»¥æ¯ç§å­˜å‚¨å¼•æ“çš„ç´¢å¼•éƒ½ä¸ä¸€å®šå®Œå…¨ç›¸åŒï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰çš„å­˜å‚¨å¼•æ“éƒ½æ”¯æŒæ‰€æœ‰çš„ç´¢å¼•ç±»å‹çš„ã€‚MySQLç›®å‰æä¾›äº†ä»¥ä¸‹4ç§ç´¢å¼•ï¼š</p><ul><li>BTREE ç´¢å¼• ï¼š æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œå¤§éƒ¨åˆ†ç´¢å¼•éƒ½æ”¯æŒ B æ ‘ç´¢å¼•ã€‚</li><li>HASH ç´¢å¼•ï¼šåªæœ‰Memoryå¼•æ“æ”¯æŒ ï¼Œ ä½¿ç”¨åœºæ™¯ç®€å• ã€‚</li><li>R-tree ç´¢å¼•ï¼ˆç©ºé—´ç´¢å¼•ï¼‰ï¼šç©ºé—´ç´¢å¼•æ˜¯MyISAMå¼•æ“çš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹ï¼Œé€šå¸¸ä½¿ç”¨è¾ƒå°‘ï¼Œä¸åšç‰¹åˆ«ä»‹ç»ã€‚</li><li>Full-text ï¼ˆå…¨æ–‡ç´¢å¼•ï¼‰ ï¼šå…¨æ–‡ç´¢å¼•ä¹Ÿæ˜¯MyISAMçš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºå…¨æ–‡ç´¢å¼•ï¼ŒInnoDBä»Mysql5.6ç‰ˆæœ¬å¼€å§‹æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚</li></ul><center><b>MyISAMã€InnoDBã€Memoryä¸‰ç§å­˜å‚¨å¼•æ“å¯¹å„ç§ç´¢å¼•ç±»å‹çš„æ”¯æŒ</b></center><table><thead><tr><th>ç´¢å¼•</th><th>InnoDBå¼•æ“</th><th>MyISAMå¼•æ“</th><th>Memoryå¼•æ“</th></tr></thead><tbody><tr><td>BTREEç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>HASH ç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>R-tree ç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>Full-text</td><td>5.6ç‰ˆæœ¬ä¹‹åæ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table><p>æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡æ˜ï¼Œéƒ½æ˜¯æŒ‡B+æ ‘ï¼ˆå¤šè·¯æœç´¢æ ‘ï¼Œå¹¶ä¸ä¸€å®šæ˜¯äºŒå‰çš„ï¼‰ç»“æ„ç»„ç»‡çš„ç´¢å¼•ã€‚å…¶ä¸­èšé›†ç´¢å¼•ã€å¤åˆç´¢å¼•ã€å‰ç¼€ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•é»˜è®¤éƒ½æ˜¯ä½¿ç”¨ B+tree ç´¢å¼•ï¼Œç»Ÿç§°ä¸º ç´¢å¼•ã€‚</p><h5 id="2-3-1-BTREE-ç»“æ„"><a href="#2-3-1-BTREE-ç»“æ„" class="headerlink" title="2.3.1 BTREE ç»“æ„"></a>2.3.1 BTREE ç»“æ„</h5><p>BTreeåˆå«å¤šè·¯å¹³è¡¡æœç´¢æ ‘ï¼Œä¸€é¢—må‰çš„BTreeç‰¹æ€§å¦‚ä¸‹ï¼š</p><ul><li>æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåŒ…å«mä¸ªå­©å­ã€‚</li><li>é™¤æ ¹èŠ‚ç‚¹ä¸å¶å­èŠ‚ç‚¹å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰[ceil(m&#x2F;2)]ä¸ªå­©å­ã€‚</li><li>è‹¥æ ¹èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™è‡³å°‘æœ‰ä¸¤ä¸ªå­©å­ã€‚</li><li>æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ã€‚</li><li>æ¯ä¸ªéå¶å­èŠ‚ç‚¹ç”±nä¸ªkeyä¸n+1ä¸ªæŒ‡é’ˆç»„æˆï¼Œå…¶ä¸­[ceil(m&#x2F;2)-1] &lt;&#x3D; n &lt;&#x3D; m-1</li></ul><p>ä»¥5å‰BTreeä¸ºä¾‹ï¼Œkeyçš„æ•°é‡ï¼šå…¬å¼æ¨å¯¼[ceil(m&#x2F;2)-1] &lt;&#x3D; n &lt;&#x3D; m-1ã€‚æ‰€ä»¥ 2 &lt;&#x3D; n &lt;&#x3D;4 ã€‚å½“n&gt;4æ—¶ï¼Œä¸­é—´èŠ‚ç‚¹åˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ï¼Œä¸¤è¾¹èŠ‚ç‚¹åˆ†è£‚ã€‚</p><p>æ’å…¥ C N G A H E K Q M F W L T Z D P R X Y S æ•°æ®ä¸ºä¾‹ã€‚</p><p>æ¼”å˜è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>1). æ’å…¥å‰4ä¸ªå­—æ¯ C N G A </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093133875.png?raw=true" alt="image-20240511093133875"></p><p>2). æ’å…¥Hï¼Œn&gt;4ï¼Œä¸­é—´å…ƒç´ Gå­—æ¯å‘ä¸Šåˆ†è£‚åˆ°æ–°çš„èŠ‚ç‚¹</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093226560.png?raw=true" alt="image-20240511093226560"></p><p>3). æ’å…¥Eï¼ŒKï¼ŒQä¸éœ€è¦åˆ†è£‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093242231.png?raw=true" alt="image-20240511093242231"></p><p>4). æ’å…¥Mï¼Œä¸­é—´å…ƒç´ Må­—æ¯å‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹G</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093256714.png?raw=true" alt="image-20240511093256714"></p><p>5). æ’å…¥Fï¼ŒWï¼ŒLï¼ŒTä¸éœ€è¦åˆ†è£‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093311693.png?raw=true" alt="image-20240511093311693"></p><p>6). æ’å…¥Zï¼Œä¸­é—´å…ƒç´ Tå‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ä¸­ </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093325753.png?raw=true" alt="image-20240511093325753"></p><p>7). æ’å…¥Dï¼Œä¸­é—´å…ƒç´ Då‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ä¸­ã€‚ç„¶åæ’å…¥Pï¼ŒRï¼ŒXï¼ŒYä¸éœ€è¦åˆ†è£‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093339035.png?raw=true" alt="image-20240511093339035"> </p><p>8). æœ€åæ’å…¥Sï¼ŒNPQRèŠ‚ç‚¹n&gt;5ï¼Œä¸­é—´èŠ‚ç‚¹Qå‘ä¸Šåˆ†è£‚ï¼Œä½†åˆ†è£‚åçˆ¶èŠ‚ç‚¹DGMTçš„n&gt;5ï¼Œä¸­é—´èŠ‚ç‚¹Må‘ä¸Šåˆ†è£‚</p><p> <img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093408372.png?raw=true" alt="image-20240511093408372"></p><p>åˆ°æ­¤ï¼Œè¯¥BTREEæ ‘å°±å·²ç»æ„å»ºå®Œæˆäº†ï¼Œ BTREEæ ‘ å’Œ äºŒå‰æ ‘ ç›¸æ¯”ï¼Œ æŸ¥è¯¢æ•°æ®çš„æ•ˆç‡æ›´é«˜ï¼Œ å› ä¸ºå¯¹äºç›¸åŒçš„æ•°æ®é‡æ¥è¯´ï¼ŒBTREEçš„å±‚çº§ç»“æ„æ¯”äºŒå‰æ ‘å°ï¼Œå› æ­¤æœç´¢é€Ÿåº¦å¿«ã€‚</p><h5 id="2-3-3-B-TREE-ç»“æ„"><a href="#2-3-3-B-TREE-ç»“æ„" class="headerlink" title="2.3.3 B+TREE ç»“æ„"></a>2.3.3 B+TREE ç»“æ„</h5><p>B+Treeä¸ºBTreeçš„å˜ç§ï¼ŒB+Treeä¸BTreeçš„åŒºåˆ«ä¸ºï¼š</p><p>1). nå‰B+Treeæœ€å¤šå«æœ‰nä¸ªkeyï¼Œè€ŒBTreeæœ€å¤šå«æœ‰n-1ä¸ªkeyã€‚</p><p>2). B+Treeçš„å¶å­èŠ‚ç‚¹ä¿å­˜æ‰€æœ‰çš„keyä¿¡æ¯ï¼Œä¾keyå¤§å°é¡ºåºæ’åˆ—ã€‚</p><p>3). æ‰€æœ‰çš„éå¶å­èŠ‚ç‚¹éƒ½å¯ä»¥çœ‹ä½œæ˜¯keyçš„ç´¢å¼•éƒ¨åˆ†ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511095521998.png?raw=true" alt="image-20240511095521998"></p><p>ç”±äºB+Treeåªæœ‰å¶å­èŠ‚ç‚¹ä¿å­˜keyä¿¡æ¯ï¼ŒæŸ¥è¯¢ä»»ä½•keyéƒ½è¦ä»rootèµ°åˆ°å¶å­ã€‚æ‰€ä»¥B+Treeçš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®šã€‚</p><h5 id="2-3-3-MySQLä¸­çš„B-Tree"><a href="#2-3-3-MySQLä¸­çš„B-Tree" class="headerlink" title="2.3.3 MySQLä¸­çš„B+Tree"></a>2.3.3 MySQLä¸­çš„B+Tree</h5><p>MySqlç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„B+Treeè¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸB+Treeçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ã€‚</p><p>MySQLä¸­çš„ B+Tree ç´¢å¼•ç»“æ„ç¤ºæ„å›¾: </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093508330.png?raw=true" alt="image-20240511093508330">  </p><h4 id="2-4-ç´¢å¼•åˆ†ç±»"><a href="#2-4-ç´¢å¼•åˆ†ç±»" class="headerlink" title="2.4 ç´¢å¼•åˆ†ç±»"></a>2.4 ç´¢å¼•åˆ†ç±»</h4><p>1ï¼‰ å•å€¼ç´¢å¼• ï¼šå³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•</p><p>2ï¼‰ å”¯ä¸€ç´¢å¼• ï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼</p><p>3ï¼‰ å¤åˆç´¢å¼• ï¼šå³ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—</p><h4 id="2-5-ç´¢å¼•è¯­æ³•"><a href="#2-5-ç´¢å¼•è¯­æ³•" class="headerlink" title="2.5 ç´¢å¼•è¯­æ³•"></a>2.5 ç´¢å¼•è¯­æ³•</h4><p>ç´¢å¼•åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œå¯ä»¥åŒæ—¶åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥éšæ—¶å¢åŠ æ–°çš„ç´¢å¼•ã€‚</p><p>å‡†å¤‡ç¯å¢ƒ:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">create</span> database demo_01 <span class="hljs-keyword">default</span> charset<span class="hljs-operator">=</span>utf8mb4;<br><br>use demo_01;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `city` (<br>  `city_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `city_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `country_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`city_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `country` (<br>  `country_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `country_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`country_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br><br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `city` (`city_id`, `city_name`, `country_id`) <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;è¥¿å®‰&#x27;</span>,<span class="hljs-number">1</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `city` (`city_id`, `city_name`, `country_id`) <span class="hljs-keyword">values</span>(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;NewYork&#x27;</span>,<span class="hljs-number">2</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `city` (`city_id`, `city_name`, `country_id`) <span class="hljs-keyword">values</span>(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;åŒ—äº¬&#x27;</span>,<span class="hljs-number">1</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `city` (`city_id`, `city_name`, `country_id`) <span class="hljs-keyword">values</span>(<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;ä¸Šæµ·&#x27;</span>,<span class="hljs-number">1</span>);<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `country` (`country_id`, `country_name`) <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;China&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `country` (`country_id`, `country_name`) <span class="hljs-keyword">values</span>(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;America&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `country` (`country_id`, `country_name`) <span class="hljs-keyword">values</span>(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;Japan&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `country` (`country_id`, `country_name`) <span class="hljs-keyword">values</span>(<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;UK&#x27;</span>);<br></code></pre></td></tr></table></figure><h5 id="2-5-1-åˆ›å»ºç´¢å¼•"><a href="#2-5-1-åˆ›å»ºç´¢å¼•" class="headerlink" title="2.5.1 åˆ›å»ºç´¢å¼•"></a>2.5.1 åˆ›å»ºç´¢å¼•</h5><p>è¯­æ³• ï¼š </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">UNIQUE</span><span class="hljs-operator">|</span>FULLTEXT<span class="hljs-operator">|</span>SPATIAL]  INDEX index_name <br>[<span class="hljs-keyword">USING</span>  index_type]<br><span class="hljs-keyword">ON</span> tbl_name(index_col_name,...)<br><br><br>index_col_name : column_name[(length)][<span class="hljs-keyword">ASC</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">DESC</span>]<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ ï¼š ä¸ºcityè¡¨ä¸­çš„city_nameå­—æ®µåˆ›å»ºç´¢å¼• ï¼›</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093540046.png?raw=true" alt="image-20240511093540046">      </p><p>â€‹</p><h5 id="2-5-2-æŸ¥çœ‹ç´¢å¼•"><a href="#2-5-2-æŸ¥çœ‹ç´¢å¼•" class="headerlink" title="2.5.2 æŸ¥çœ‹ç´¢å¼•"></a>2.5.2 æŸ¥çœ‹ç´¢å¼•</h5><p>è¯­æ³•ï¼š </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">index</span>  <span class="hljs-keyword">from</span>  <span class="hljs-built_in">table_name</span>;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šæŸ¥çœ‹cityè¡¨ä¸­çš„ç´¢å¼•ä¿¡æ¯ï¼›</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093603250.png?raw=true" alt="image-20240511093603250"> </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093619542.png?raw=true" alt="image-20240511093619542">  </p><h5 id="2-5-3-åˆ é™¤ç´¢å¼•"><a href="#2-5-3-åˆ é™¤ç´¢å¼•" class="headerlink" title="2.5.3 åˆ é™¤ç´¢å¼•"></a>2.5.3 åˆ é™¤ç´¢å¼•</h5><p>è¯­æ³• ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">DROP</span>  <span class="hljs-keyword">INDEX</span>  index_name  <span class="hljs-keyword">ON</span>  tbl_name;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ ï¼š æƒ³è¦åˆ é™¤cityè¡¨ä¸Šçš„ç´¢å¼•idx_city_nameï¼Œå¯ä»¥æ“ä½œå¦‚ä¸‹ï¼š</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093636153.png?raw=true" alt="image-20240511093636153">  </p><h5 id="2-5-4-ALTERå‘½ä»¤"><a href="#2-5-4-ALTERå‘½ä»¤" class="headerlink" title="2.5.4 ALTERå‘½ä»¤"></a>2.5.4 ALTERå‘½ä»¤</h5><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sas">1). <span class="hljs-keyword">alter</span>  <span class="hljs-keyword">table</span>  tb_name  <span class="hljs-keyword">add</span>  <span class="hljs-keyword">primary</span>  <span class="hljs-keyword">key</span>(column_list); <br><br>è¯¥è¯­å¥æ·»åŠ ä¸€ä¸ªä¸»é”®ï¼Œè¿™æ„å‘³ç€ç´¢å¼•å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸”ä¸èƒ½ä¸º<span class="hljs-keyword">NULL</span><br><br>2). <span class="hljs-keyword">alter</span>  <span class="hljs-keyword">table</span>  tb_name  <span class="hljs-keyword">add</span>  <span class="hljs-keyword">unique</span> index_name(column_list);<br><br>è¿™æ¡è¯­å¥åˆ›å»ºç´¢å¼•çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼ˆé™¤äº†<span class="hljs-keyword">NULL</span>å¤–ï¼Œ<span class="hljs-keyword">NULL</span>å¯èƒ½ä¼šå‡ºç°å¤šæ¬¡ï¼‰<br><br>3). <span class="hljs-keyword">alter</span>  <span class="hljs-keyword">table</span>  tb_name  <span class="hljs-keyword">add</span>  <span class="hljs-keyword">index</span> index_name(column_list);<br><br>æ·»åŠ æ™®é€šç´¢å¼•ï¼Œ ç´¢å¼•å€¼å¯ä»¥å‡ºç°å¤šæ¬¡ã€‚<br><br>4). <span class="hljs-keyword">alter</span>  <span class="hljs-keyword">table</span>  tb_name  <span class="hljs-keyword">add</span>  fulltext  index_name(column_list);<br><br>è¯¥è¯­å¥æŒ‡å®šäº†ç´¢å¼•ä¸ºFULLTEXTï¼Œ ç”¨äºå…¨æ–‡ç´¢å¼•<br><br></code></pre></td></tr></table></figure><h4 id="2-6-ç´¢å¼•è®¾è®¡åŸåˆ™"><a href="#2-6-ç´¢å¼•è®¾è®¡åŸåˆ™" class="headerlink" title="2.6 ç´¢å¼•è®¾è®¡åŸåˆ™"></a>2.6 ç´¢å¼•è®¾è®¡åŸåˆ™</h4><p>â€‹ç´¢å¼•çš„è®¾è®¡å¯ä»¥éµå¾ªä¸€äº›å·²æœ‰çš„åŸåˆ™ï¼Œåˆ›å»ºç´¢å¼•çš„æ—¶å€™è¯·å°½é‡è€ƒè™‘ç¬¦åˆè¿™äº›åŸåˆ™ï¼Œä¾¿äºæå‡ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡ï¼Œæ›´é«˜æ•ˆçš„ä½¿ç”¨ç´¢å¼•ã€‚</p><ul><li><p>å¯¹æŸ¥è¯¢é¢‘æ¬¡è¾ƒé«˜ï¼Œä¸”æ•°æ®é‡æ¯”è¾ƒå¤§çš„è¡¨å»ºç«‹ç´¢å¼•ã€‚</p></li><li><p>ç´¢å¼•å­—æ®µçš„é€‰æ‹©ï¼Œæœ€ä½³å€™é€‰åˆ—åº”å½“ä»whereå­å¥çš„æ¡ä»¶ä¸­æå–ï¼Œå¦‚æœwhereå­å¥ä¸­çš„ç»„åˆæ¯”è¾ƒå¤šï¼Œé‚£ä¹ˆåº”å½“æŒ‘é€‰æœ€å¸¸ç”¨ã€è¿‡æ»¤æ•ˆæœæœ€å¥½çš„åˆ—çš„ç»„åˆã€‚</p></li><li><p>ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜ã€‚</p></li><li><p>ç´¢å¼•å¯ä»¥æœ‰æ•ˆçš„æå‡æŸ¥è¯¢æ•°æ®çš„æ•ˆç‡ï¼Œä½†ç´¢å¼•æ•°é‡ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•çš„ä»£ä»·è‡ªç„¶ä¹Ÿå°±æ°´æ¶¨èˆ¹é«˜ã€‚å¯¹äºæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰DMLæ“ä½œæ¯”è¾ƒé¢‘ç¹çš„è¡¨æ¥è¯´ï¼Œç´¢å¼•è¿‡å¤šï¼Œä¼šå¼•å…¥ç›¸å½“é«˜çš„ç»´æŠ¤ä»£ä»·ï¼Œé™ä½DMLæ“ä½œçš„æ•ˆç‡ï¼Œå¢åŠ ç›¸åº”æ“ä½œçš„æ—¶é—´æ¶ˆè€—ã€‚å¦å¤–ç´¢å¼•è¿‡å¤šçš„è¯ï¼ŒMySQLä¹Ÿä¼šçŠ¯é€‰æ‹©å›°éš¾ç—…ï¼Œè™½ç„¶æœ€ç»ˆä»ç„¶ä¼šæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„ç´¢å¼•ï¼Œä½†æ— ç–‘æé«˜äº†é€‰æ‹©çš„ä»£ä»·ã€‚</p></li><li><p>ä½¿ç”¨çŸ­ç´¢å¼•ï¼Œç´¢å¼•åˆ›å»ºä¹‹åä¹Ÿæ˜¯ä½¿ç”¨ç¡¬ç›˜æ¥å­˜å‚¨çš„ï¼Œå› æ­¤æå‡ç´¢å¼•è®¿é—®çš„I&#x2F;Oæ•ˆç‡ï¼Œä¹Ÿå¯ä»¥æå‡æ€»ä½“çš„è®¿é—®æ•ˆç‡ã€‚å‡å¦‚æ„æˆç´¢å¼•çš„å­—æ®µæ€»é•¿åº¦æ¯”è¾ƒçŸ­ï¼Œé‚£ä¹ˆåœ¨ç»™å®šå¤§å°çš„å­˜å‚¨å—å†…å¯ä»¥å­˜å‚¨æ›´å¤šçš„ç´¢å¼•å€¼ï¼Œç›¸åº”çš„å¯ä»¥æœ‰æ•ˆçš„æå‡MySQLè®¿é—®ç´¢å¼•çš„I&#x2F;Oæ•ˆç‡ã€‚</p></li><li><p>åˆ©ç”¨æœ€å·¦å‰ç¼€ï¼ŒNä¸ªåˆ—ç»„åˆè€Œæˆçš„ç»„åˆç´¢å¼•ï¼Œé‚£ä¹ˆç›¸å½“äºæ˜¯åˆ›å»ºäº†Nä¸ªç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢æ—¶whereå­å¥ä¸­ä½¿ç”¨äº†ç»„æˆè¯¥ç´¢å¼•çš„å‰å‡ ä¸ªå­—æ®µï¼Œé‚£ä¹ˆè¿™æ¡æŸ¥è¯¢SQLå¯ä»¥åˆ©ç”¨ç»„åˆç´¢å¼•æ¥æå‡æŸ¥è¯¢æ•ˆç‡ã€‚</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs fortran">åˆ›å»ºå¤åˆç´¢å¼•:<br><br>CREATE <span class="hljs-built_in">INDEX</span> idx_name_email_status ON tb_seller(<span class="hljs-keyword">NAME</span>,email,<span class="hljs-keyword">STATUS</span>);<br><br>å°±ç›¸å½“äº<br>å¯¹<span class="hljs-keyword">name</span> åˆ›å»ºç´¢å¼• ;<br>å¯¹<span class="hljs-keyword">name</span> , email åˆ›å»ºäº†ç´¢å¼• ;<br>å¯¹<span class="hljs-keyword">name</span> , email, <span class="hljs-keyword">status</span> åˆ›å»ºäº†ç´¢å¼• ;<br></code></pre></td></tr></table></figure></li></ul><h3 id="3-è§†å›¾"><a href="#3-è§†å›¾" class="headerlink" title="3. è§†å›¾"></a>3. è§†å›¾</h3><h4 id="3-1-è§†å›¾æ¦‚è¿°"><a href="#3-1-è§†å›¾æ¦‚è¿°" class="headerlink" title="3.1 è§†å›¾æ¦‚è¿°"></a>3.1 è§†å›¾æ¦‚è¿°</h4><p>â€‹è§†å›¾ï¼ˆViewï¼‰æ˜¯ä¸€ç§è™šæ‹Ÿå­˜åœ¨çš„è¡¨ã€‚è§†å›¾å¹¶ä¸åœ¨æ•°æ®åº“ä¸­å®é™…å­˜åœ¨ï¼Œè¡Œå’Œåˆ—æ•°æ®æ¥è‡ªå®šä¹‰è§†å›¾çš„æŸ¥è¯¢ä¸­ä½¿ç”¨çš„è¡¨ï¼Œå¹¶ä¸”æ˜¯åœ¨ä½¿ç”¨è§†å›¾æ—¶åŠ¨æ€ç”Ÿæˆçš„ã€‚é€šä¿—çš„è®²ï¼Œè§†å›¾å°±æ˜¯ä¸€æ¡SELECTè¯­å¥æ‰§è¡Œåè¿”å›çš„ç»“æœé›†ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨åˆ›å»ºè§†å›¾çš„æ—¶å€™ï¼Œä¸»è¦çš„å·¥ä½œå°±è½åœ¨åˆ›å»ºè¿™æ¡SQLæŸ¥è¯¢è¯­å¥ä¸Šã€‚</p><p>è§†å›¾ç›¸å¯¹äºæ™®é€šçš„è¡¨çš„ä¼˜åŠ¿ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ é¡¹ã€‚</p><ul><li>ç®€å•ï¼šä½¿ç”¨è§†å›¾çš„ç”¨æˆ·å®Œå…¨ä¸éœ€è¦å…³å¿ƒåé¢å¯¹åº”çš„è¡¨çš„ç»“æ„ã€å…³è”æ¡ä»¶å’Œç­›é€‰æ¡ä»¶ï¼Œå¯¹ç”¨æˆ·æ¥è¯´å·²ç»æ˜¯è¿‡æ»¤å¥½çš„å¤åˆæ¡ä»¶çš„ç»“æœé›†ã€‚</li><li>å®‰å…¨ï¼šä½¿ç”¨è§†å›¾çš„ç”¨æˆ·åªèƒ½è®¿é—®ä»–ä»¬è¢«å…è®¸æŸ¥è¯¢çš„ç»“æœé›†ï¼Œå¯¹è¡¨çš„æƒé™ç®¡ç†å¹¶ä¸èƒ½é™åˆ¶åˆ°æŸä¸ªè¡ŒæŸä¸ªåˆ—ï¼Œä½†æ˜¯é€šè¿‡è§†å›¾å°±å¯ä»¥ç®€å•çš„å®ç°ã€‚</li><li>æ•°æ®ç‹¬ç«‹ï¼šä¸€æ—¦è§†å›¾çš„ç»“æ„ç¡®å®šäº†ï¼Œå¯ä»¥å±è”½è¡¨ç»“æ„å˜åŒ–å¯¹ç”¨æˆ·çš„å½±å“ï¼Œæºè¡¨å¢åŠ åˆ—å¯¹è§†å›¾æ²¡æœ‰å½±å“ï¼›æºè¡¨ä¿®æ”¹åˆ—åï¼Œåˆ™å¯ä»¥é€šè¿‡ä¿®æ”¹è§†å›¾æ¥è§£å†³ï¼Œä¸ä¼šé€ æˆå¯¹è®¿é—®è€…çš„å½±å“ã€‚</li></ul><h4 id="3-2-åˆ›å»ºæˆ–è€…ä¿®æ”¹è§†å›¾"><a href="#3-2-åˆ›å»ºæˆ–è€…ä¿®æ”¹è§†å›¾" class="headerlink" title="3.2 åˆ›å»ºæˆ–è€…ä¿®æ”¹è§†å›¾"></a>3.2 åˆ›å»ºæˆ–è€…ä¿®æ”¹è§†å›¾</h4><p>åˆ›å»ºè§†å›¾çš„è¯­æ³•ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">OR</span> REPLACE] [ALGORITHM <span class="hljs-operator">=</span> &#123;UNDEFINED <span class="hljs-operator">|</span> <span class="hljs-keyword">MERGE</span> <span class="hljs-operator">|</span> TEMPTABLE&#125;]<br><br><span class="hljs-keyword">VIEW</span> view_name [(column_list)]<br><br><span class="hljs-keyword">AS</span> select_statement<br><br>[<span class="hljs-keyword">WITH</span> [<span class="hljs-keyword">CASCADED</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">LOCAL</span>] <span class="hljs-keyword">CHECK</span> OPTION]<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹è§†å›¾çš„è¯­æ³•ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> [ALGORITHM <span class="hljs-operator">=</span> &#123;UNDEFINED <span class="hljs-operator">|</span> <span class="hljs-keyword">MERGE</span> <span class="hljs-operator">|</span> TEMPTABLE&#125;]<br><br><span class="hljs-keyword">VIEW</span> view_name [(column_list)]<br><br><span class="hljs-keyword">AS</span> select_statement<br><br>[<span class="hljs-keyword">WITH</span> [<span class="hljs-keyword">CASCADED</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">LOCAL</span>] <span class="hljs-keyword">CHECK</span> OPTION]<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">é€‰é¡¹ : <br><span class="hljs-keyword">WITH</span> [<span class="hljs-keyword">CASCADED</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">LOCAL</span>] <span class="hljs-keyword">CHECK</span> OPTION å†³å®šäº†æ˜¯å¦å…è®¸æ›´æ–°æ•°æ®ä½¿è®°å½•ä¸å†æ»¡è¶³è§†å›¾çš„æ¡ä»¶ã€‚<br><br><span class="hljs-keyword">LOCAL</span> ï¼š åªè¦æ»¡è¶³æœ¬è§†å›¾çš„æ¡ä»¶å°±å¯ä»¥æ›´æ–°ã€‚<br><span class="hljs-keyword">CASCADED</span> ï¼š å¿…é¡»æ»¡è¶³æ‰€æœ‰é’ˆå¯¹è¯¥è§†å›¾çš„æ‰€æœ‰è§†å›¾çš„æ¡ä»¶æ‰å¯ä»¥æ›´æ–°ã€‚ é»˜è®¤å€¼.<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ , åˆ›å»ºcity_country_viewè§†å›¾ , æ‰§è¡Œå¦‚ä¸‹SQL : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">view</span> city_country_view <br><span class="hljs-keyword">as</span> <br><span class="hljs-keyword">select</span> t.<span class="hljs-operator">*</span>,c.country_name <span class="hljs-keyword">from</span> country c , city t <span class="hljs-keyword">where</span> c.country_id <span class="hljs-operator">=</span> t.country_id;<br><br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢è§†å›¾ : </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093657857.png?raw=true" alt="image-20240511093657857"> </p><h4 id="3-3-æŸ¥çœ‹è§†å›¾"><a href="#3-3-æŸ¥çœ‹è§†å›¾" class="headerlink" title="3.3 æŸ¥çœ‹è§†å›¾"></a>3.3 æŸ¥çœ‹è§†å›¾</h4><p>â€‹ä» MySQL 5.1 ç‰ˆæœ¬å¼€å§‹ï¼Œä½¿ç”¨ SHOW TABLES å‘½ä»¤çš„æ—¶å€™ä¸ä»…æ˜¾ç¤ºè¡¨çš„åå­—ï¼ŒåŒæ—¶ä¹Ÿä¼šæ˜¾ç¤ºè§†å›¾çš„åå­—ï¼Œè€Œä¸å­˜åœ¨å•ç‹¬æ˜¾ç¤ºè§†å›¾çš„ SHOW VIEWS å‘½ä»¤ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093713607.png?raw=true" alt="image-20240511093713607"> </p><p>åŒæ ·ï¼Œåœ¨ä½¿ç”¨ SHOW TABLE STATUS å‘½ä»¤çš„æ—¶å€™ï¼Œä¸ä½†å¯ä»¥æ˜¾ç¤ºè¡¨çš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ˜¾ç¤ºè§†å›¾çš„ä¿¡æ¯ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093736277.png?raw=true" alt="image-20240511093736277"> </p><p>å¦‚æœéœ€è¦æŸ¥è¯¢æŸä¸ªè§†å›¾çš„å®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨ SHOW CREATE VIEW å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ ï¼š </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240511093747136.png?raw=true" alt="image-20240511093747136">  </p><h4 id="3-4-åˆ é™¤è§†å›¾"><a href="#3-4-åˆ é™¤è§†å›¾" class="headerlink" title="3.4 åˆ é™¤è§†å›¾"></a>3.4 åˆ é™¤è§†å›¾</h4><p>è¯­æ³• : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> [IF <span class="hljs-keyword">EXISTS</span>] view_name [, view_name] ...[RESTRICT <span class="hljs-operator">|</span> CASCADE]<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ , åˆ é™¤è§†å›¾city_country_view :</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-built_in">DROP</span> <span class="hljs-built_in">VIEW</span> city_country_view ;<br></code></pre></td></tr></table></figure><h3 id="4-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"><a href="#4-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°" class="headerlink" title="4. å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"></a>4. å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</h3><h4 id="4-1-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ¦‚è¿°"><a href="#4-1-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ¦‚è¿°" class="headerlink" title="4.1 å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ¦‚è¿°"></a>4.1 å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ¦‚è¿°</h4><p>â€‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ˜¯  äº‹å…ˆç»è¿‡ç¼–è¯‘å¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ä¸€æ®µ SQL è¯­å¥çš„é›†åˆï¼Œè°ƒç”¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°å¯ä»¥ç®€åŒ–åº”ç”¨å¼€å‘äººå‘˜çš„å¾ˆå¤šå·¥ä½œï¼Œå‡å°‘æ•°æ®åœ¨æ•°æ®åº“å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“ï¼Œå¯¹äºæé«˜æ•°æ®å¤„ç†çš„æ•ˆç‡æ˜¯æœ‰å¥½å¤„çš„ã€‚</p><p>â€‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„åŒºåˆ«åœ¨äºå‡½æ•°å¿…é¡»æœ‰è¿”å›å€¼ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹æ²¡æœ‰ã€‚</p><p>â€‹å‡½æ•° ï¼š æ˜¯ä¸€ä¸ªæœ‰è¿”å›å€¼çš„è¿‡ç¨‹ ï¼›</p><p>â€‹è¿‡ç¨‹ ï¼š æ˜¯ä¸€ä¸ªæ²¡æœ‰è¿”å›å€¼çš„å‡½æ•° ï¼›</p><h4 id="4-2-åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"><a href="#4-2-åˆ›å»ºå­˜å‚¨è¿‡ç¨‹" class="headerlink" title="4.2 åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"></a>4.2 åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> procedure_name ([proc_parameter[,...]])<br><span class="hljs-keyword">begin</span><br><span class="hljs-comment">-- SQLè¯­å¥</span><br><span class="hljs-keyword">end</span> ;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">delimiter $<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_test1()<br><span class="hljs-keyword">begin</span><br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;Hello Mysql&#x27;</span> ;<br><span class="hljs-keyword">end</span>$<br><br>delimiter ;<br></code></pre></td></tr></table></figure><p><strong><font color="red">çŸ¥è¯†å°è´´å£«</font></strong></p><p>DELIMITER</p><p>â€‹è¯¥å…³é”®å­—ç”¨æ¥å£°æ˜SQLè¯­å¥çš„åˆ†éš”ç¬¦ , å‘Šè¯‰ MySQL è§£é‡Šå™¨ï¼Œè¯¥æ®µå‘½ä»¤æ˜¯å¦å·²ç»ç»“æŸäº†ï¼Œmysqlæ˜¯å¦å¯ä»¥æ‰§è¡Œäº†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œdelimiteræ˜¯åˆ†å·;ã€‚åœ¨å‘½ä»¤è¡Œå®¢æˆ·ç«¯ä¸­ï¼Œå¦‚æœæœ‰ä¸€è¡Œå‘½ä»¤ä»¥åˆ†å·ç»“æŸï¼Œé‚£ä¹ˆå›è½¦åï¼Œmysqlå°†ä¼šæ‰§è¡Œè¯¥å‘½ä»¤ã€‚</p><p>dbeaver å›¾å½¢å·¥å…·æ–°ä¿®æ”¹æ‰§è¡Œå‘½ä»¤å³å¯</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/4570978019.jpg?raw=true" alt="img"></p><h4 id="4-3-è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"><a href="#4-3-è°ƒç”¨å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="4.3 è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"></a>4.3 è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">call</span> procedure_name() ;<br></code></pre></td></tr></table></figure><h4 id="4-4-æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹"><a href="#4-4-æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="4.4 æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹"></a>4.4 æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- æŸ¥è¯¢db_nameæ•°æ®åº“ä¸­çš„æ‰€æœ‰çš„å­˜å‚¨è¿‡ç¨‹</span><br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> mysql.proc <span class="hljs-keyword">where</span> db<span class="hljs-operator">=</span><span class="hljs-string">&#x27;db_name&#x27;</span>;<br><br><br><span class="hljs-comment">-- æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹çš„çŠ¶æ€ä¿¡æ¯</span><br><span class="hljs-keyword">show</span> <span class="hljs-keyword">procedure</span> status;<br><br><br><span class="hljs-comment">-- æŸ¥è¯¢æŸä¸ªå­˜å‚¨è¿‡ç¨‹çš„å®šä¹‰</span><br><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> test.pro_test1 \G;<br></code></pre></td></tr></table></figure><h4 id="4-5-åˆ é™¤å­˜å‚¨è¿‡ç¨‹"><a href="#4-5-åˆ é™¤å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="4.5 åˆ é™¤å­˜å‚¨è¿‡ç¨‹"></a>4.5 åˆ é™¤å­˜å‚¨è¿‡ç¨‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PROCEDURE</span>  [IF <span class="hljs-keyword">EXISTS</span>] sp_name ï¼›<br></code></pre></td></tr></table></figure><h4 id="4-6-è¯­æ³•"><a href="#4-6-è¯­æ³•" class="headerlink" title="4.6 è¯­æ³•"></a>4.6 è¯­æ³•</h4><p>å­˜å‚¨è¿‡ç¨‹æ˜¯å¯ä»¥ç¼–ç¨‹çš„ï¼Œæ„å‘³ç€å¯ä»¥ä½¿ç”¨å˜é‡ï¼Œè¡¨è¾¾å¼ï¼Œæ§åˆ¶ç»“æ„ ï¼Œ æ¥å®Œæˆæ¯”è¾ƒå¤æ‚çš„åŠŸèƒ½ã€‚</p><h5 id="4-6-1-å˜é‡"><a href="#4-6-1-å˜é‡" class="headerlink" title="4.6.1 å˜é‡"></a>4.6.1 å˜é‡</h5><ul><li>DECLARE</li></ul><p>  é€šè¿‡ DECLARE å¯ä»¥å®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œè¯¥å˜é‡çš„ä½œç”¨èŒƒå›´åªèƒ½åœ¨ BEGINâ€¦END å—ä¸­ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DECLARE</span> var_name[,...] type [<span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">value</span>]<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">delimiter $<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_test2() <br><span class="hljs-keyword">begin</span> <br><span class="hljs-keyword">declare</span> num <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">5</span>;<br><span class="hljs-keyword">select</span> num<span class="hljs-operator">+</span> <span class="hljs-number">10</span>; <br><span class="hljs-keyword">end</span>$<br><br>delimiter ; <br></code></pre></td></tr></table></figure><ul><li>SET</li></ul><p>ç›´æ¥èµ‹å€¼ä½¿ç”¨ SETï¼Œå¯ä»¥èµ‹å¸¸é‡æˆ–è€…èµ‹è¡¨è¾¾å¼ï¼Œå…·ä½“è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">SET var_name = <span class="hljs-built_in">expr</span> [, var_name = <span class="hljs-built_in">expr</span>] ...<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER $<br><br><span class="hljs-keyword">CREATE</span>  <span class="hljs-keyword">PROCEDURE</span> pro_test3()<br><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> NAME <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>);<br><span class="hljs-keyword">SET</span> NAME <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;MYSQL&#x27;</span>;<br><span class="hljs-keyword">SELECT</span> NAME ;<br><span class="hljs-keyword">END</span>$<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é€šè¿‡select â€¦ into æ–¹å¼è¿›è¡Œèµ‹å€¼æ“ä½œ :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs SQL">DELIMITER $<br><br><span class="hljs-keyword">CREATE</span>  <span class="hljs-keyword">PROCEDURE</span> pro_test5()<br><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">declare</span>  countnum <span class="hljs-type">int</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> countnum <span class="hljs-keyword">from</span> city;<br><span class="hljs-keyword">select</span> countnum;<br><span class="hljs-keyword">END</span>$<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><h5 id="4-6-2-ifæ¡ä»¶åˆ¤æ–­"><a href="#4-6-2-ifæ¡ä»¶åˆ¤æ–­" class="headerlink" title="4.6.2 ifæ¡ä»¶åˆ¤æ–­"></a>4.6.2 ifæ¡ä»¶åˆ¤æ–­</h5><p>è¯­æ³•ç»“æ„ : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">if search_condition <span class="hljs-keyword">then</span> statement_list<br><br>[elseif search_condition <span class="hljs-keyword">then</span> statement_list] ...<br><br>[<span class="hljs-keyword">else</span> statement_list]<br><br><span class="hljs-keyword">end</span> if;<br></code></pre></td></tr></table></figure><p>éœ€æ±‚ï¼š </p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ada">æ ¹æ®å®šä¹‰çš„èº«é«˜å˜é‡ï¼Œåˆ¤å®šå½“å‰èº«é«˜çš„æ‰€å±çš„èº«æç±»å‹ <br><br><span class="hljs-number">180</span> åŠä»¥ä¸Š <span class="hljs-comment">----------&gt; èº«æé«˜æŒ‘</span><br><br><span class="hljs-number">170</span> - <span class="hljs-number">180</span>  <span class="hljs-comment">---------&gt; æ ‡å‡†èº«æ</span><br><br><span class="hljs-number">170</span> ä»¥ä¸‹  <span class="hljs-comment">----------&gt; ä¸€èˆ¬èº«æ</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">delimiter $<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_test6()<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">declare</span>  height  <span class="hljs-type">int</span>  <span class="hljs-keyword">default</span>  <span class="hljs-number">175</span>; <br>  <span class="hljs-keyword">declare</span>  description  <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>);<br>  <br>  if  height <span class="hljs-operator">&gt;=</span> <span class="hljs-number">180</span>  <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">set</span> description <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;èº«æé«˜æŒ‘&#x27;</span>;<br>  elseif height <span class="hljs-operator">&gt;=</span> <span class="hljs-number">170</span> <span class="hljs-keyword">and</span> height <span class="hljs-operator">&lt;</span> <span class="hljs-number">180</span>  <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">set</span> description <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;æ ‡å‡†èº«æ&#x27;</span>;<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">set</span> description <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ä¸€èˆ¬èº«æ&#x27;</span>;<br>  <span class="hljs-keyword">end</span> if;<br>  <br>  <span class="hljs-keyword">select</span> description ;<br><span class="hljs-keyword">end</span>$<br><br>delimiter ;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨ç»“æœä¸º : </p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240510165046431.png?raw=true" alt="image-20240510165046431"></p><h5 id="4-6-3-ä¼ é€’å‚æ•°"><a href="#4-6-3-ä¼ é€’å‚æ•°" class="headerlink" title="4.6.3 ä¼ é€’å‚æ•°"></a>4.6.3 ä¼ é€’å‚æ•°</h5><p>è¯­æ³•æ ¼å¼ : </p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> <span class="hljs-title function_">procedure_name</span><span class="hljs-params">([<span class="hljs-keyword">in</span>/<span class="hljs-keyword">out</span>/inout] å‚æ•°å   å‚æ•°ç±»å‹)</span><br>...<br><br><br><span class="hljs-title function_">IN</span> :   è¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¾“å…¥ï¼Œä¹Ÿå°±æ˜¯éœ€è¦è°ƒç”¨æ–¹ä¼ å…¥å€¼ , é»˜è®¤<br><span class="hljs-keyword">OUT</span>:   è¯¥å‚æ•°ä½œä¸ºè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¿”å›å€¼<br>INOUT: æ—¢å¯ä»¥ä½œä¸ºè¾“å…¥å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè¾“å‡ºå‚æ•°<br></code></pre></td></tr></table></figure><p><strong>IN - è¾“å…¥</strong></p><p>éœ€æ±‚ :</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">æ ¹æ®å®šä¹‰çš„èº«é«˜å˜é‡ï¼Œåˆ¤å®šå½“å‰èº«é«˜çš„æ‰€å±çš„èº«æç±»å‹ <br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹  : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql">delimiter $<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_test5(<span class="hljs-keyword">in</span> height <span class="hljs-type">int</span>)<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">declare</span> description <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>;<br>  if height <span class="hljs-operator">&gt;=</span> <span class="hljs-number">180</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">set</span> description<span class="hljs-operator">=</span><span class="hljs-string">&#x27;èº«æé«˜æŒ‘&#x27;</span>;<br>  elseif height <span class="hljs-operator">&gt;=</span> <span class="hljs-number">170</span> <span class="hljs-keyword">and</span> height <span class="hljs-operator">&lt;</span> <span class="hljs-number">180</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">set</span> description<span class="hljs-operator">=</span><span class="hljs-string">&#x27;æ ‡å‡†èº«æ&#x27;</span>;<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">set</span> description<span class="hljs-operator">=</span><span class="hljs-string">&#x27;ä¸€èˆ¬èº«æ&#x27;</span>;<br>  <span class="hljs-keyword">end</span> if;<br>  <span class="hljs-keyword">select</span> concat(<span class="hljs-string">&#x27;èº«é«˜ &#x27;</span>, height , <span class="hljs-string">&#x27;å¯¹åº”çš„èº«æç±»å‹ä¸º:&#x27;</span>,description);<br><span class="hljs-keyword">end</span>$<br><br>delimiter ;<br><br><span class="hljs-keyword">CALL</span> pro_test5(<span class="hljs-number">180</span>); #è°ƒç”¨<br><br># è¿”å›<br>èº«é«˜ <span class="hljs-number">180</span>å¯¹åº”çš„èº«æç±»å‹ä¸º:èº«æé«˜æŒ‘<br></code></pre></td></tr></table></figure><p><strong>OUT-è¾“å‡º</strong></p><p> éœ€æ±‚ :</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">æ ¹æ®ä¼ å…¥çš„èº«é«˜å˜é‡ï¼Œè·å–å½“å‰èº«é«˜çš„æ‰€å±çš„èº«æç±»å‹  <br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_test5(<span class="hljs-keyword">in</span> height <span class="hljs-type">int</span> , <span class="hljs-keyword">out</span> description <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>))<br><span class="hljs-keyword">begin</span><br>  if height <span class="hljs-operator">&gt;=</span> <span class="hljs-number">180</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">set</span> description<span class="hljs-operator">=</span><span class="hljs-string">&#x27;èº«æé«˜æŒ‘&#x27;</span>;<br>  elseif height <span class="hljs-operator">&gt;=</span> <span class="hljs-number">170</span> <span class="hljs-keyword">and</span> height <span class="hljs-operator">&lt;</span> <span class="hljs-number">180</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">set</span> description<span class="hljs-operator">=</span><span class="hljs-string">&#x27;æ ‡å‡†èº«æ&#x27;</span>;<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">set</span> description<span class="hljs-operator">=</span><span class="hljs-string">&#x27;ä¸€èˆ¬èº«æ&#x27;</span>;<br>  <span class="hljs-keyword">end</span> if;<br><span class="hljs-keyword">end</span>$<br></code></pre></td></tr></table></figure><p>è°ƒç”¨:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">call</span> <span class="hljs-selector-tag">pro_test5</span>(<span class="hljs-number">168</span>, <span class="hljs-variable">@description</span>);<br><span class="hljs-selector-tag">select</span> @<span class="hljs-selector-tag">description</span>;<br></code></pre></td></tr></table></figure><p><font color='red'><strong>å°çŸ¥è¯†</strong>Â </font></p><p>@description :  è¿™ç§å˜é‡è¦åœ¨å˜é‡åç§°å‰é¢åŠ ä¸Šâ€œ@â€ç¬¦å·ï¼Œå«åšç”¨æˆ·ä¼šè¯å˜é‡ï¼Œä»£è¡¨æ•´ä¸ªä¼šè¯è¿‡ç¨‹ä»–éƒ½æ˜¯æœ‰ä½œç”¨çš„ï¼Œè¿™ä¸ªç±»ä¼¼äºå…¨å±€å˜é‡ä¸€æ ·ã€‚</p><p>@@global.sort_buffer_size : è¿™ç§åœ¨å˜é‡å‰åŠ ä¸Š â€œ@@â€ ç¬¦å·, å«åš ç³»ç»Ÿå˜é‡ </p><h5 id="4-6-4-caseç»“æ„"><a href="#4-6-4-caseç»“æ„" class="headerlink" title="4.6.4 caseç»“æ„"></a>4.6.4 caseç»“æ„</h5><p>è¯­æ³•ç»“æ„ : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs SQL">æ–¹å¼ä¸€ : <br><br><span class="hljs-keyword">CASE</span> case_value<br><br>  <span class="hljs-keyword">WHEN</span> when_value <span class="hljs-keyword">THEN</span> statement_list<br>  <br>  [<span class="hljs-keyword">WHEN</span> when_value <span class="hljs-keyword">THEN</span> statement_list] ...<br>  <br>  [<span class="hljs-keyword">ELSE</span> statement_list]<br>  <br><span class="hljs-keyword">END</span> <span class="hljs-keyword">CASE</span>;<br><br><br>æ–¹å¼äºŒ : <br><br><span class="hljs-keyword">CASE</span><br><br>  <span class="hljs-keyword">WHEN</span> search_condition <span class="hljs-keyword">THEN</span> statement_list<br>  <br>  [<span class="hljs-keyword">WHEN</span> search_condition <span class="hljs-keyword">THEN</span> statement_list] ...<br>  <br>  [<span class="hljs-keyword">ELSE</span> statement_list]<br>  <br><span class="hljs-keyword">END</span> <span class="hljs-keyword">CASE</span>;<br><br></code></pre></td></tr></table></figure><p>éœ€æ±‚:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ç»™å®šä¸€ä¸ªæœˆä»½, ç„¶åè®¡ç®—å‡ºæ‰€åœ¨çš„å­£åº¦<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹  :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sql">delimiter $<br><br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_test9(<span class="hljs-keyword">month</span> <span class="hljs-type">int</span>)<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">declare</span> <span class="hljs-keyword">result</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>);<br>  <span class="hljs-keyword">case</span> <br>    <span class="hljs-keyword">when</span> <span class="hljs-keyword">month</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">month</span> <span class="hljs-operator">&lt;=</span><span class="hljs-number">3</span> <span class="hljs-keyword">then</span> <br>      <span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç¬¬ä¸€å­£åº¦&#x27;</span>;<br>    <span class="hljs-keyword">when</span> <span class="hljs-keyword">month</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-number">4</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">month</span> <span class="hljs-operator">&lt;=</span><span class="hljs-number">6</span> <span class="hljs-keyword">then</span> <br>      <span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç¬¬äºŒå­£åº¦&#x27;</span>;<br>    <span class="hljs-keyword">when</span> <span class="hljs-keyword">month</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-number">7</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">month</span> <span class="hljs-operator">&lt;=</span><span class="hljs-number">9</span> <span class="hljs-keyword">then</span> <br>      <span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç¬¬ä¸‰å­£åº¦&#x27;</span>;<br>    <span class="hljs-keyword">when</span> <span class="hljs-keyword">month</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">month</span> <span class="hljs-operator">&lt;=</span><span class="hljs-number">12</span> <span class="hljs-keyword">then</span> <br>      <span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç¬¬å››å­£åº¦&#x27;</span>;<br>  <span class="hljs-keyword">end</span> <span class="hljs-keyword">case</span>;<br>  <br>  <span class="hljs-keyword">select</span> concat(<span class="hljs-string">&#x27;æ‚¨è¾“å…¥çš„æœˆä»½ä¸º :&#x27;</span>, <span class="hljs-keyword">month</span> , <span class="hljs-string">&#x27; , è¯¥æœˆä»½ä¸º : &#x27;</span> , <span class="hljs-keyword">result</span>) <span class="hljs-keyword">as</span> content ;<br>  <br><span class="hljs-keyword">end</span>$<br><br><br>delimiter ;<br><br><br><span class="hljs-keyword">call</span> pro_test9(<span class="hljs-number">3</span>);<br><br># è¿”å›<br>content<br>æ‚¨è¾“å…¥çš„æœˆä»½ä¸º :<span class="hljs-number">3</span> , è¯¥æœˆä»½ä¸º : ç¬¬ä¸€å­£åº¦<br></code></pre></td></tr></table></figure><h5 id="4-6-5-whileå¾ªç¯"><a href="#4-6-5-whileå¾ªç¯" class="headerlink" title="4.6.5 whileå¾ªç¯"></a>4.6.5 whileå¾ªç¯</h5><p>è¯­æ³•ç»“æ„: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">while search_condition do<br><br>statement_list<br><br><span class="hljs-keyword">end</span> while;<br></code></pre></td></tr></table></figure><p>éœ€æ±‚:</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel">è®¡ç®—ä»<span class="hljs-number">1</span>åŠ åˆ°<span class="hljs-built_in">n</span>çš„å€¼<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹  : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql">delimiter $<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_test8(n <span class="hljs-type">int</span>)<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">declare</span> total <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">declare</span> num <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">1</span>;<br>  while num<span class="hljs-operator">&lt;=</span>n do<br>    <span class="hljs-keyword">set</span> total <span class="hljs-operator">=</span> total <span class="hljs-operator">+</span> num;<br><span class="hljs-keyword">set</span> num <span class="hljs-operator">=</span> num <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">end</span> while;<br>  <span class="hljs-keyword">select</span> total;<br><span class="hljs-keyword">end</span>$<br><br>delimiter ;<br><br># è°ƒç”¨<br><span class="hljs-keyword">call</span> pro_test8(<span class="hljs-number">3</span>);<br><br>#è¿”å›<br>totle<br><span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><h5 id="4-6-6-repeatç»“æ„"><a href="#4-6-6-repeatç»“æ„" class="headerlink" title="4.6.6 repeatç»“æ„"></a>4.6.6 repeatç»“æ„</h5><p>æœ‰æ¡ä»¶çš„å¾ªç¯æ§åˆ¶è¯­å¥, å½“æ»¡è¶³æ¡ä»¶çš„æ—¶å€™é€€å‡ºå¾ªç¯ ã€‚while æ˜¯æ»¡è¶³æ¡ä»¶æ‰æ‰§è¡Œï¼Œrepeat æ˜¯æ»¡è¶³æ¡ä»¶å°±é€€å‡ºå¾ªç¯ã€‚</p><p>è¯­æ³•ç»“æ„ : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs SQL">REPEAT<br><br>  statement_list<br><br>  UNTIL search_condition<br><br><span class="hljs-keyword">END</span> REPEAT;<br></code></pre></td></tr></table></figure><p>éœ€æ±‚: </p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel">è®¡ç®—ä»<span class="hljs-number">1</span>åŠ åˆ°<span class="hljs-built_in">n</span>çš„å€¼<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹  : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql">delimiter $<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_test10(n <span class="hljs-type">int</span>)<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">declare</span> total <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br>  <br>  repeat <br>    <span class="hljs-keyword">set</span> total <span class="hljs-operator">=</span> total <span class="hljs-operator">+</span> n;<br>    <span class="hljs-keyword">set</span> n <span class="hljs-operator">=</span> n <span class="hljs-operator">-</span> <span class="hljs-number">1</span>;<br>    until n<span class="hljs-operator">=</span><span class="hljs-number">0</span>  <br>  <span class="hljs-keyword">end</span> repeat;<br>  <br>  <span class="hljs-keyword">select</span> total ;<br>  <br><span class="hljs-keyword">end</span>$<br><br><br>delimiter ;<br><br># è°ƒç”¨<br><span class="hljs-keyword">call</span> pro_test10(<span class="hljs-number">5</span>);<br><br># è¿”å›<br>totle<br><span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><h5 id="4-6-7-loopè¯­å¥"><a href="#4-6-7-loopè¯­å¥" class="headerlink" title="4.6.7 loopè¯­å¥"></a>4.6.7 loopè¯­å¥</h5><p>LOOP å®ç°ç®€å•çš„å¾ªç¯ï¼Œé€€å‡ºå¾ªç¯çš„æ¡ä»¶éœ€è¦ä½¿ç”¨å…¶ä»–çš„è¯­å¥å®šä¹‰ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨ LEAVE è¯­å¥å®ç°ï¼Œå…·ä½“è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">[begin_label:] LOOP<br><br>  statement_list<br><br><span class="hljs-keyword">END</span> LOOP [end_label]<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸åœ¨ statement_list ä¸­å¢åŠ é€€å‡ºå¾ªç¯çš„è¯­å¥ï¼Œé‚£ä¹ˆ LOOP è¯­å¥å¯ä»¥ç”¨æ¥å®ç°ç®€å•çš„æ­»å¾ªç¯ã€‚</p><h5 id="4-6-8-leaveè¯­å¥"><a href="#4-6-8-leaveè¯­å¥" class="headerlink" title="4.6.8 leaveè¯­å¥"></a>4.6.8 leaveè¯­å¥</h5><p>ç”¨æ¥ä»æ ‡æ³¨çš„æµç¨‹æ„é€ ä¸­é€€å‡ºï¼Œé€šå¸¸å’Œ BEGIN â€¦ END æˆ–è€…å¾ªç¯ä¸€èµ·ä½¿ç”¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ LOOP å’Œ LEAVE çš„ç®€å•ä¾‹å­ , é€€å‡ºå¾ªç¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs SQL">delimiter $<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> pro_test11(n <span class="hljs-type">int</span>)<br><span class="hljs-keyword">BEGIN</span><br>  <span class="hljs-keyword">declare</span> total <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br>  <br>  ins: LOOP<br>    <br>    IF n <span class="hljs-operator">&lt;=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br>      leave ins;<br>    <span class="hljs-keyword">END</span> IF;<br>    <br>    <span class="hljs-keyword">set</span> total <span class="hljs-operator">=</span> total <span class="hljs-operator">+</span> n;<br>    <span class="hljs-keyword">set</span> n <span class="hljs-operator">=</span> n <span class="hljs-operator">-</span> <span class="hljs-number">1</span>;<br>  <br>  <span class="hljs-keyword">END</span> LOOP ins;<br>  <br>  <span class="hljs-keyword">select</span> total;<br><span class="hljs-keyword">END</span>$<br><br>delimiter ;<br></code></pre></td></tr></table></figure><h5 id="4-6-9-æ¸¸æ ‡-å…‰æ ‡"><a href="#4-6-9-æ¸¸æ ‡-å…‰æ ‡" class="headerlink" title="4.6.9 æ¸¸æ ‡&#x2F;å…‰æ ‡"></a>4.6.9 æ¸¸æ ‡&#x2F;å…‰æ ‡</h5><p>æ¸¸æ ‡æ˜¯ç”¨æ¥å­˜å‚¨æŸ¥è¯¢ç»“æœé›†çš„æ•°æ®ç±»å‹ , åœ¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨å…‰æ ‡å¯¹ç»“æœé›†è¿›è¡Œå¾ªç¯çš„å¤„ç†ã€‚å…‰æ ‡çš„ä½¿ç”¨åŒ…æ‹¬å…‰æ ‡çš„å£°æ˜ã€OPENã€FETCH å’Œ CLOSEï¼Œå…¶è¯­æ³•åˆ†åˆ«å¦‚ä¸‹ã€‚</p><p>å£°æ˜å…‰æ ‡ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DECLARE</span> cursor_name <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> select_statement ;<br></code></pre></td></tr></table></figure><p>OPEN å…‰æ ‡ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">OPEN</span> cursor_name ;<br></code></pre></td></tr></table></figure><p>FETCH å…‰æ ‡ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">FETCH</span> cursor_name <span class="hljs-keyword">INTO</span> var_name [, var_name] ...<br></code></pre></td></tr></table></figure><p>CLOSE å…‰æ ‡ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CLOSE</span> cursor_name ;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ : </p><p>åˆå§‹åŒ–è„šæœ¬:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp(<br>  id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment ,<br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å§“å&#x27;</span>,<br>  age <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;å¹´é¾„&#x27;</span>,<br>  salary <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;è–ªæ°´&#x27;</span>,<br>  <span class="hljs-keyword">primary</span> key(`id`)<br>)engine<span class="hljs-operator">=</span>innodb <span class="hljs-keyword">default</span> charset<span class="hljs-operator">=</span>utf8 ;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> emp(id,name,age,salary) <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;é‡‘æ¯›ç‹®ç‹&#x27;</span>,<span class="hljs-number">55</span>,<span class="hljs-number">3800</span>),(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;ç™½çœ‰é¹°ç‹&#x27;</span>,<span class="hljs-number">60</span>,<span class="hljs-number">4000</span>),(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;é’ç¿¼è ç‹&#x27;</span>,<span class="hljs-number">38</span>,<span class="hljs-number">2800</span>),(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;ç´«è¡«é¾™ç‹&#x27;</span>,<span class="hljs-number">42</span>,<span class="hljs-number">1800</span>);<br><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">-- æŸ¥è¯¢empè¡¨ä¸­æ•°æ®, å¹¶é€è¡Œè·å–è¿›è¡Œå±•ç¤º</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_test11()<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">declare</span> e_id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>);<br>  <span class="hljs-keyword">declare</span> e_name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>);<br>  <span class="hljs-keyword">declare</span> e_age <span class="hljs-type">int</span>(<span class="hljs-number">11</span>);<br>  <span class="hljs-keyword">declare</span> e_salary <span class="hljs-type">int</span>(<span class="hljs-number">11</span>);<br>  <span class="hljs-keyword">declare</span> emp_result <span class="hljs-keyword">cursor</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp;<br>  <br>  <span class="hljs-keyword">open</span> emp_result;<br>  <br>  <span class="hljs-keyword">fetch</span> emp_result <span class="hljs-keyword">into</span> e_id,e_name,e_age,e_salary;<br>  <span class="hljs-keyword">select</span> concat(<span class="hljs-string">&#x27;id=&#x27;</span>,e_id , <span class="hljs-string">&#x27;, name=&#x27;</span>,e_name, <span class="hljs-string">&#x27;, age=&#x27;</span>, e_age, <span class="hljs-string">&#x27;, è–ªèµ„ä¸º: &#x27;</span>,e_salary);<br>  <br>  <span class="hljs-keyword">fetch</span> emp_result <span class="hljs-keyword">into</span> e_id,e_name,e_age,e_salary;<br>  <span class="hljs-keyword">select</span> concat(<span class="hljs-string">&#x27;id=&#x27;</span>,e_id , <span class="hljs-string">&#x27;, name=&#x27;</span>,e_name, <span class="hljs-string">&#x27;, age=&#x27;</span>, e_age, <span class="hljs-string">&#x27;, è–ªèµ„ä¸º: &#x27;</span>,e_salary);<br>  <br>  <span class="hljs-keyword">fetch</span> emp_result <span class="hljs-keyword">into</span> e_id,e_name,e_age,e_salary;<br>  <span class="hljs-keyword">select</span> concat(<span class="hljs-string">&#x27;id=&#x27;</span>,e_id , <span class="hljs-string">&#x27;, name=&#x27;</span>,e_name, <span class="hljs-string">&#x27;, age=&#x27;</span>, e_age, <span class="hljs-string">&#x27;, è–ªèµ„ä¸º: &#x27;</span>,e_salary);<br>  <br>  <span class="hljs-keyword">fetch</span> emp_result <span class="hljs-keyword">into</span> e_id,e_name,e_age,e_salary;<br>  <span class="hljs-keyword">select</span> concat(<span class="hljs-string">&#x27;id=&#x27;</span>,e_id , <span class="hljs-string">&#x27;, name=&#x27;</span>,e_name, <span class="hljs-string">&#x27;, age=&#x27;</span>, e_age, <span class="hljs-string">&#x27;, è–ªèµ„ä¸º: &#x27;</span>,e_salary);<br>  <br>  <span class="hljs-keyword">fetch</span> emp_result <span class="hljs-keyword">into</span> e_id,e_name,e_age,e_salary;<br>  <span class="hljs-keyword">select</span> concat(<span class="hljs-string">&#x27;id=&#x27;</span>,e_id , <span class="hljs-string">&#x27;, name=&#x27;</span>,e_name, <span class="hljs-string">&#x27;, age=&#x27;</span>, e_age, <span class="hljs-string">&#x27;, è–ªèµ„ä¸º: &#x27;</span>,e_salary);<br>  <br>  <span class="hljs-keyword">close</span> emp_result;<br><span class="hljs-keyword">end</span>$<br><br># è°ƒç”¨<br><span class="hljs-keyword">call</span> pro_test11();<br><br># è¿”å› <br><span class="hljs-keyword">No</span> data <span class="hljs-operator">-</span> zero <span class="hljs-keyword">rows</span> fetched, selected, <span class="hljs-keyword">or</span> processed    # å› ä¸ºå¤šå‡ºä¸€æ¬¡è·å–æ¸¸æ ‡æ•°æ® å››æ¬¡è¿”å›æ­£å¸¸<br><br><br></code></pre></td></tr></table></figure><p>é€šè¿‡å¾ªç¯ç»“æ„ , è·å–æ¸¸æ ‡ä¸­çš„æ•°æ® : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER $<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_test12()<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">DECLARE</span> id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>);<br>  <span class="hljs-keyword">DECLARE</span> name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>);<br>  <span class="hljs-keyword">DECLARE</span> age <span class="hljs-type">int</span>(<span class="hljs-number">11</span>);<br>  <span class="hljs-keyword">DECLARE</span> salary <span class="hljs-type">int</span>(<span class="hljs-number">11</span>);<br>  <span class="hljs-keyword">DECLARE</span> has_data <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">1</span>;<br>  <br>  <span class="hljs-keyword">DECLARE</span> emp_result <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp;<br>  <span class="hljs-keyword">DECLARE</span> EXIT HANDLER <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">NOT</span> FOUND <span class="hljs-keyword">set</span> has_data <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>  <br>  <span class="hljs-keyword">open</span> emp_result;<br>  <br>  repeat<br>    <span class="hljs-keyword">fetch</span> emp_result <span class="hljs-keyword">into</span> id , name , age , salary;<br>    <span class="hljs-keyword">select</span> concat(<span class="hljs-string">&#x27;idä¸º&#x27;</span>,id, <span class="hljs-string">&#x27;, name ä¸º&#x27;</span> ,name , <span class="hljs-string">&#x27;, ageä¸º &#x27;</span> ,age , <span class="hljs-string">&#x27;, è–ªæ°´ä¸º: &#x27;</span>, salary);<br>    until has_data <span class="hljs-operator">=</span> <span class="hljs-number">0</span><br>  <span class="hljs-keyword">end</span> repeat;<br>  <br>  <span class="hljs-keyword">close</span> emp_result;<br><span class="hljs-keyword">end</span>$<br><br>DELIMITER ; <br># è°ƒç”¨<br><span class="hljs-keyword">call</span> pro_test11();<br><br># è¿”å› <br>idä¸º<span class="hljs-number">1</span>, name ä¸ºé‡‘æ¯›ç‹®ç‹, ageä¸º <span class="hljs-number">55</span>, è–ªæ°´ä¸º: <span class="hljs-number">3800</span><br>idä¸º<span class="hljs-number">2</span>, name ä¸ºç™½çœ‰é¹°ç‹, ageä¸º <span class="hljs-number">60</span>, è–ªæ°´ä¸º: <span class="hljs-number">4000</span><br>idä¸º<span class="hljs-number">3</span>, name ä¸ºé’ç¿¼è ç‹, ageä¸º <span class="hljs-number">38</span>, è–ªæ°´ä¸º: <span class="hljs-number">2800</span><br>idä¸º<span class="hljs-number">4</span>, name ä¸ºç´«è¡«é¾™ç‹, ageä¸º <span class="hljs-number">42</span>, è–ªæ°´ä¸º: <span class="hljs-number">1800</span><br></code></pre></td></tr></table></figure><h4 id="4-7-å­˜å‚¨å‡½æ•°"><a href="#4-7-å­˜å‚¨å‡½æ•°" class="headerlink" title="4.7 å­˜å‚¨å‡½æ•°"></a>4.7 å­˜å‚¨å‡½æ•°</h4><p>è¯­æ³•ç»“æ„:</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> function_name([param <span class="hljs-built_in">type</span> ... ]) <br>RETURNS <span class="hljs-built_in">type</span> <br><span class="hljs-keyword">BEGIN</span><br>...<br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ : </p><p>å®šä¹‰ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹, è¯·æ±‚æ»¡è¶³æ¡ä»¶çš„æ€»è®°å½•æ•° ;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><br>delimiter $<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> count_city(countryId <span class="hljs-type">int</span>)<br><span class="hljs-keyword">returns</span> <span class="hljs-type">int</span> <span class="hljs-keyword">READS</span> <span class="hljs-keyword">SQL</span> DATA<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">declare</span> cnum <span class="hljs-type">int</span> ;<br>  <br>  <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> cnum <span class="hljs-keyword">from</span> city <span class="hljs-keyword">where</span> country_id <span class="hljs-operator">=</span> countryId;<br>  <br>  <span class="hljs-keyword">return</span> cnum;<br><span class="hljs-keyword">end</span>$<br><br>delimiter ;<br><br># ç¡®å®šå‡½æ•°å±æ€§ ä¸ç¡®å®šæ— æ³•åˆ›å»º<br><span class="hljs-keyword">DETERMINISTIC</span>: å¦‚æœä½ çš„å‡½æ•°å¯¹äºç›¸åŒçš„è¾“å…¥å‚æ•°ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½è¿”å›ç›¸åŒçš„ç»“æœï¼Œä¸”ä¸ä¾èµ–äºå¤–éƒ¨çŠ¶æ€æˆ–æ•°æ®åº“çŠ¶æ€çš„å˜åŒ–ï¼Œå°±å¯ä»¥å£°æ˜ä¸º <span class="hljs-keyword">DETERMINISTIC</span>ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè®¡ç®—ä¸¤ä¸ªæ•°å­—ç›¸åŠ çš„å‡½æ•°å°±æ˜¯ç¡®å®šæ€§çš„ã€‚<br><br><span class="hljs-keyword">NO</span> <span class="hljs-keyword">SQL</span>: å¦‚æœä½ çš„å‡½æ•°å®Œå…¨ä¸åŒ…å«ä»»ä½• <span class="hljs-keyword">SQL</span> è¯­å¥ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸è¯»å–ä¹Ÿä¸ä¿®æ”¹æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå¯ä»¥å£°æ˜ä¸º <span class="hljs-keyword">NO</span> <span class="hljs-keyword">SQL</span>ã€‚<br><br><span class="hljs-keyword">READS</span> <span class="hljs-keyword">SQL</span> DATA: å¦‚æœä½ çš„å‡½æ•°è¯»å–æ•°æ®åº“ä¸­çš„æ•°æ®ä½†ä¸ä¿®æ”¹æ•°æ®ï¼Œåº”å£°æ˜ä¸º <span class="hljs-keyword">READS</span> <span class="hljs-keyword">SQL</span> DATAã€‚<br></code></pre></td></tr></table></figure><p>è°ƒç”¨: </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-title">count_city</span>(<span class="hljs-params"><span class="hljs-number">1</span></span>)</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-title">count_city</span>(<span class="hljs-params"><span class="hljs-number">2</span></span>)</span>;<br></code></pre></td></tr></table></figure><h3 id="5-è§¦å‘å™¨"><a href="#5-è§¦å‘å™¨" class="headerlink" title="5. è§¦å‘å™¨"></a>5. è§¦å‘å™¨</h3><h4 id="5-1-ä»‹ç»"><a href="#5-1-ä»‹ç»" class="headerlink" title="5.1 ä»‹ç»"></a>5.1 ä»‹ç»</h4><p>è§¦å‘å™¨æ˜¯ä¸è¡¨æœ‰å…³çš„æ•°æ®åº“å¯¹è±¡ï¼ŒæŒ‡åœ¨ insert&#x2F;update&#x2F;delete ä¹‹å‰æˆ–ä¹‹åï¼Œè§¦å‘å¹¶æ‰§è¡Œè§¦å‘å™¨ä¸­å®šä¹‰çš„SQLè¯­å¥é›†åˆã€‚è§¦å‘å™¨çš„è¿™ç§ç‰¹æ€§å¯ä»¥ååŠ©åº”ç”¨åœ¨æ•°æ®åº“ç«¯ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ , æ—¥å¿—è®°å½• , æ•°æ®æ ¡éªŒç­‰æ“ä½œ ã€‚</p><p>ä½¿ç”¨åˆ«å OLD å’Œ NEW æ¥å¼•ç”¨è§¦å‘å™¨ä¸­å‘ç”Ÿå˜åŒ–çš„è®°å½•å†…å®¹ï¼Œè¿™ä¸å…¶ä»–çš„æ•°æ®åº“æ˜¯ç›¸ä¼¼çš„ã€‚ç°åœ¨è§¦å‘å™¨è¿˜åªæ”¯æŒè¡Œçº§è§¦å‘ï¼Œä¸æ”¯æŒè¯­å¥çº§è§¦å‘ã€‚</p><table><thead><tr><th>è§¦å‘å™¨ç±»å‹</th><th>NEW å’Œ OLDçš„ä½¿ç”¨</th></tr></thead><tbody><tr><td>INSERT å‹è§¦å‘å™¨</td><td>NEW è¡¨ç¤ºå°†è¦æˆ–è€…å·²ç»æ–°å¢çš„æ•°æ®</td></tr><tr><td>UPDATE å‹è§¦å‘å™¨</td><td>OLD è¡¨ç¤ºä¿®æ”¹ä¹‹å‰çš„æ•°æ® , NEW è¡¨ç¤ºå°†è¦æˆ–å·²ç»ä¿®æ”¹åçš„æ•°æ®</td></tr><tr><td>DELETE å‹è§¦å‘å™¨</td><td>OLD è¡¨ç¤ºå°†è¦æˆ–è€…å·²ç»åˆ é™¤çš„æ•°æ®</td></tr></tbody></table><h4 id="5-2-åˆ›å»ºè§¦å‘å™¨"><a href="#5-2-åˆ›å»ºè§¦å‘å™¨" class="headerlink" title="5.2 åˆ›å»ºè§¦å‘å™¨"></a>5.2 åˆ›å»ºè§¦å‘å™¨</h4><p>è¯­æ³•ç»“æ„ : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> trigger_name <br><br>before<span class="hljs-operator">/</span>after <span class="hljs-keyword">insert</span><span class="hljs-operator">/</span><span class="hljs-keyword">update</span><span class="hljs-operator">/</span><span class="hljs-keyword">delete</span><br><br><span class="hljs-keyword">on</span> tbl_name <br><br>[ <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-type">row</span> ]  <span class="hljs-comment">-- è¡Œçº§è§¦å‘å™¨</span><br><br><span class="hljs-keyword">begin</span><br><br>trigger_stmt ;<br><br><span class="hljs-keyword">end</span>;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ </p><p>éœ€æ±‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">é€šè¿‡è§¦å‘å™¨è®°å½• emp è¡¨çš„æ•°æ®å˜æ›´æ—¥å¿— , åŒ…å«å¢åŠ , ä¿®æ”¹ , åˆ é™¤ ;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆåˆ›å»ºä¸€å¼ æ—¥å¿—è¡¨ : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp_logs(<br>  id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment,<br>  operation <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ“ä½œç±»å‹, insert/update/delete&#x27;</span>,<br>  operate_time datetime <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ“ä½œæ—¶é—´&#x27;</span>,<br>  operate_id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ“ä½œè¡¨çš„ID&#x27;</span>,<br>  operate_params <span class="hljs-type">varchar</span>(<span class="hljs-number">500</span>) comment <span class="hljs-string">&#x27;æ“ä½œå‚æ•°&#x27;</span>,<br>  <span class="hljs-keyword">primary</span> key(`id`)<br>)engine<span class="hljs-operator">=</span>innodb <span class="hljs-keyword">default</span> charset<span class="hljs-operator">=</span>utf8;<br></code></pre></td></tr></table></figure><p>åˆ›å»º insert å‹è§¦å‘å™¨ï¼Œå®Œæˆæ’å…¥æ•°æ®æ—¶çš„æ—¥å¿—è®°å½• : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER $<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> emp_logs_insert_trigger<br>after <span class="hljs-keyword">insert</span> <br><span class="hljs-keyword">on</span> emp <br><span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-type">row</span> <br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> emp_logs (id,operation,operate_time,operate_id,operate_params) <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;insert&#x27;</span>,now(),new.id,concat(<span class="hljs-string">&#x27;æ’å…¥å(id:&#x27;</span>,new.id,<span class="hljs-string">&#x27;, name:&#x27;</span>,new.name,<span class="hljs-string">&#x27;, age:&#x27;</span>,new.age,<span class="hljs-string">&#x27;, salary:&#x27;</span>,new.salary,<span class="hljs-string">&#x27;)&#x27;</span>));<br><span class="hljs-keyword">end</span> $<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>åˆ›å»º update å‹è§¦å‘å™¨ï¼Œå®Œæˆæ›´æ–°æ•°æ®æ—¶çš„æ—¥å¿—è®°å½• : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER $<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> emp_logs_update_trigger<br>after <span class="hljs-keyword">update</span> <br><span class="hljs-keyword">on</span> emp <br><span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-type">row</span> <br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> emp_logs (id,operation,operate_time,operate_id,operate_params) <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;update&#x27;</span>,now(),new.id,concat(<span class="hljs-string">&#x27;ä¿®æ”¹å‰(id:&#x27;</span>,old.id,<span class="hljs-string">&#x27;, name:&#x27;</span>,old.name,<span class="hljs-string">&#x27;, age:&#x27;</span>,old.age,<span class="hljs-string">&#x27;, salary:&#x27;</span>,old.salary,<span class="hljs-string">&#x27;) , ä¿®æ”¹å(id&#x27;</span>,new.id, <span class="hljs-string">&#x27;name:&#x27;</span>,new.name,<span class="hljs-string">&#x27;, age:&#x27;</span>,new.age,<span class="hljs-string">&#x27;, salary:&#x27;</span>,new.salary,<span class="hljs-string">&#x27;)&#x27;</span>));                                                                      <br><span class="hljs-keyword">end</span> $<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºdelete è¡Œçš„è§¦å‘å™¨ , å®Œæˆåˆ é™¤æ•°æ®æ—¶çš„æ—¥å¿—è®°å½• : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER $<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> emp_logs_delete_trigger<br>after <span class="hljs-keyword">delete</span> <br><span class="hljs-keyword">on</span> emp <br><span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-type">row</span> <br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> emp_logs (id,operation,operate_time,operate_id,operate_params) <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;delete&#x27;</span>,now(),old.id,concat(<span class="hljs-string">&#x27;åˆ é™¤å‰(id:&#x27;</span>,old.id,<span class="hljs-string">&#x27;, name:&#x27;</span>,old.name,<span class="hljs-string">&#x27;, age:&#x27;</span>,old.age,<span class="hljs-string">&#x27;, salary:&#x27;</span>,old.salary,<span class="hljs-string">&#x27;)&#x27;</span>));                                                                      <br><span class="hljs-keyword">end</span> $<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> emp(id,name,age,salary) <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;å…‰æ˜å·¦ä½¿&#x27;</span>,<span class="hljs-number">30</span>,<span class="hljs-number">3500</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> emp(id,name,age,salary) <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;å…‰æ˜å³ä½¿&#x27;</span>,<span class="hljs-number">33</span>,<span class="hljs-number">3200</span>);<br><br><span class="hljs-keyword">update</span> emp <span class="hljs-keyword">set</span> age <span class="hljs-operator">=</span> <span class="hljs-number">39</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br></code></pre></td></tr></table></figure><h4 id="5-3-åˆ é™¤è§¦å‘å™¨"><a href="#5-3-åˆ é™¤è§¦å‘å™¨" class="headerlink" title="5.3 åˆ é™¤è§¦å‘å™¨"></a>5.3 åˆ é™¤è§¦å‘å™¨</h4><p>è¯­æ³•ç»“æ„ : </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">trigger</span> [<span class="hljs-built_in">schema_name</span>.]trigger_name<br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰æŒ‡å®š schema_nameï¼Œé»˜è®¤ä¸ºå½“å‰æ•°æ®åº“ ã€‚</p><h4 id="5-4-æŸ¥çœ‹è§¦å‘å™¨"><a href="#5-4-æŸ¥çœ‹è§¦å‘å™¨" class="headerlink" title="5.4 æŸ¥çœ‹è§¦å‘å™¨"></a>5.4 æŸ¥çœ‹è§¦å‘å™¨</h4><p>å¯ä»¥é€šè¿‡æ‰§è¡Œ SHOW TRIGGERS å‘½ä»¤æŸ¥çœ‹è§¦å‘å™¨çš„çŠ¶æ€ã€è¯­æ³•ç­‰ä¿¡æ¯ã€‚</p><p>è¯­æ³•ç»“æ„ ï¼š </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">show</span> triggers ï¼›<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis å…¥é—¨</title>
    <link href="/2024/05/27/tools/Redis%E5%85%A5%E9%97%A8/"/>
    <url>/2024/05/27/tools/Redis%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="RedisåŸºæœ¬ä»‹ç»å’ŒåŸºæœ¬ä½¿ç”¨æ–¹æ³•"><a href="#RedisåŸºæœ¬ä»‹ç»å’ŒåŸºæœ¬ä½¿ç”¨æ–¹æ³•" class="headerlink" title="RedisåŸºæœ¬ä»‹ç»å’ŒåŸºæœ¬ä½¿ç”¨æ–¹æ³•"></a>RedisåŸºæœ¬ä»‹ç»å’ŒåŸºæœ¬ä½¿ç”¨æ–¹æ³•</h2><h2 id="ä»€ä¹ˆæ˜¯Redis"><a href="#ä»€ä¹ˆæ˜¯Redis" class="headerlink" title="ä»€ä¹ˆæ˜¯Redis?"></a>ä»€ä¹ˆæ˜¯Redis?</h2><p>Redisæ˜¯ä¸€ä¸ªå¼€æºçš„<a href="https://so.csdn.net/so/search?q=%E5%86%85%E5%AD%98%E6%95%B0%E6%8D%AE%E5%BA%93&spm=1001.2101.3001.7020">å†…å­˜æ•°æ®åº“</a>ï¼Œå±äºNoSQLæ•°æ®åº“çš„ä¸€ç§ã€‚å®ƒä»¥é«˜æ€§èƒ½ã€æ”¯æŒä¸°å¯Œçš„æ•°æ®ç»“æ„ã€æŒä¹…åŒ–ç‰¹æ€§ã€å¤åˆ¶ã€é›†ç¾¤ä»¥åŠå‘å¸ƒ&#x2F;è®¢é˜…ç­‰ç‰¹æ€§è€Œé—»åã€‚ï¼Œéµå®ˆBSDåè®®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„key-valueéå…³ç³»å‹æ•°æ®åº“ã€‚</p><h3 id="Redisç‰¹ç‚¹ï¼š"><a href="#Redisç‰¹ç‚¹ï¼š" class="headerlink" title="Redisç‰¹ç‚¹ï¼š"></a>Redisç‰¹ç‚¹ï¼š</h3><p>Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ã€‚</p><p>Redisä¸ä»…ä»…æ”¯æŒç®€å•çš„key-valueç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›Stringï¼Œlistï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚</p><p>Redisæ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³master-slaveæ¨¡å¼çš„æ•°æ®å¤‡ä»½ã€‚</p><p>æ€§èƒ½æé«˜ â€“ Redisèƒ½è¯»çš„é€Ÿåº¦æ˜¯110000æ¬¡&#x2F;s,å†™çš„é€Ÿåº¦æ˜¯81000æ¬¡&#x2F;s ã€‚</p><p>åŸå­ â€“ Redisçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼ŒåŒæ—¶Redisè¿˜æ”¯æŒå¯¹å‡ ä¸ªæ“ä½œå…¨å¹¶åçš„åŸå­æ€§æ‰§è¡Œã€‚</p><p>ä¸°å¯Œçš„ç‰¹æ€§ â€“ Redisè¿˜æ”¯æŒ publish&#x2F;subscribe, é€šçŸ¥, è®¾ç½®keyæœ‰æ•ˆæœŸç­‰ç­‰ç‰¹æ€§ã€‚</p><h3 id="redisä½œç”¨"><a href="#redisä½œç”¨" class="headerlink" title="redisä½œç”¨:"></a>redisä½œç”¨:</h3><p>å¯ä»¥å‡è½»æ•°æ®åº“å‹åŠ›ï¼ŒæŸ¥è¯¢å†…å­˜æ¯”æŸ¥è¯¢æ•°æ®åº“æ•ˆç‡é«˜ã€‚</p><h3 id="Redisåº”ç”¨ï¼š"><a href="#Redisåº”ç”¨ï¼š" class="headerlink" title="Redisåº”ç”¨ï¼š"></a>Redisåº”ç”¨ï¼š</h3><p>tokenç”Ÿæˆã€sessionå…±äº«ã€åˆ†å¸ƒå¼é”ã€è‡ªå¢idã€éªŒè¯ç ç­‰ã€‚</p><h3 id="æ¯”è¾ƒé‡è¦çš„3ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼š"><a href="#æ¯”è¾ƒé‡è¦çš„3ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼š" class="headerlink" title="æ¯”è¾ƒé‡è¦çš„3ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼š"></a>æ¯”è¾ƒé‡è¦çš„3ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼š</h3><p>redis-serverï¼šRedisæœåŠ¡å™¨ç¨‹åº</p><p>redis-cliï¼šRediså®¢æˆ·ç«¯ç¨‹åºï¼Œå®ƒæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œæ“ä½œå·¥å…·ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨telnetæ ¹æ®å…¶çº¯æ–‡æœ¬åè®®æ“ä½œã€‚</p><p>redis-benchmarkï¼šRedisæ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œæµ‹è¯•Redisåœ¨ä½ çš„ç³»ç»ŸåŠé…ç½®ä¸‹çš„è¯»å†™æ€§èƒ½ã€‚</p><h2 id="key"><a href="#key" class="headerlink" title="key"></a>key</h2><h3 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h3><p>Redis keyå€¼æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œå³å¯ä»¥ç”¨ä»»ä½•äºŒè¿›åˆ¶åºåˆ—ä½œä¸ºkeyå€¼ï¼Œä»å½¢å¦‚â€fooâ€çš„ç®€å•å­—ç¬¦ä¸²åˆ°ä¸€ä¸ªJPEGæ–‡ä»¶çš„å†…å®¹éƒ½å¯ä»¥ã€‚ç©ºå­—ç¬¦ä¸²ä¹Ÿæ˜¯æœ‰æ•ˆkeyå€¼</p><p>æ³¨ï¼š<br>å®šä¹‰keyçš„è§„åˆ™ï¼š<br>â€ƒâ€ƒé¿å…å¤ªé•¿çš„é”®ï¼Œä¸ä»…å› ä¸ºæ¶ˆè€—å†…å­˜ï¼Œè€Œä¸”åœ¨æ•°æ®ä¸­æŸ¥æ‰¾è¿™ç±»é”®å€¼çš„è®¡ç®—æˆæœ¬å¾ˆé«˜ï¼›<br>â€ƒâ€ƒé¿å…å¤ªçŸ­çš„é”®ï¼Œå¦‚ä½¿ç”¨u:1000:pwdä»£æ›¿user:1000:passwordï¼Œä½†åè€…æ›´æ˜“é˜…è¯»ï¼Œå¹¶ä¸”ç”±æ­¤å¢åŠ çš„ç©ºé—´æ¶ˆè€—ç›¸å¯¹äºkey objectå’Œvalue objectæœ¬èº«æ¥è¯´å¾ˆå°ï¼›<br>â€ƒâ€ƒæœ€å¥½åšæŒä¸€ç§æ¨¡å¼ã€‚å¦‚ï¼š<code>object-type:id:field</code></p><h3 id="2-keyä½¿ç”¨"><a href="#2-keyä½¿ç”¨" class="headerlink" title="2 keyä½¿ç”¨"></a>2 keyä½¿ç”¨</h3><h4 id="2-1-æŒ‰æ¨¡å¼åŒ¹é…å¯¹åº”çš„key"><a href="#2-1-æŒ‰æ¨¡å¼åŒ¹é…å¯¹åº”çš„key" class="headerlink" title="2.1 æŒ‰æ¨¡å¼åŒ¹é…å¯¹åº”çš„key"></a>2.1 æŒ‰æ¨¡å¼åŒ¹é…å¯¹åº”çš„key</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"> keys <span class="hljs-keyword">pattern</span><br> <br> gva164:db0<span class="hljs-operator">&gt;</span> keys <span class="hljs-operator">*</span><span class="hljs-number">1</span><br><span class="hljs-number">1</span>) &quot;k1:1&quot;<br><span class="hljs-number">2</span>) &quot;k11&quot;<br><span class="hljs-number">3</span>) &quot;k1&quot;<br>gva164:db0<span class="hljs-operator">&gt;</span> keys <span class="hljs-operator">*</span><span class="hljs-number">2</span><br><span class="hljs-number">1</span>) &quot;k12&quot;<br><span class="hljs-number">2</span>) &quot;k2&quot;<br></code></pre></td></tr></table></figure><h4 id="2-2-åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨"><a href="#2-2-åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨" class="headerlink" title="2.2 åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨"></a>2.2 åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">exists</span> key<br><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">exists</span> k1 k2 k5<br><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h4 id="2-3-æŸ¥çœ‹keyçš„ç±»å‹"><a href="#2-3-æŸ¥çœ‹keyçš„ç±»å‹" class="headerlink" title="2.3 æŸ¥çœ‹keyçš„ç±»å‹"></a>2.3 æŸ¥çœ‹keyçš„ç±»å‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">type key<br><br>gva164:db0<span class="hljs-operator">&gt;</span> type k2<br>string<br></code></pre></td></tr></table></figure><h4 id="2-4åˆ é™¤æŒ‡å®šçš„key"><a href="#2-4åˆ é™¤æŒ‡å®šçš„key" class="headerlink" title="2.4åˆ é™¤æŒ‡å®šçš„key"></a>2.4åˆ é™¤æŒ‡å®šçš„key</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">del key<br><br>gva164:db0<span class="hljs-operator">&gt;</span> del k3 k13<br><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h4 id="2-5-æ ¹æ®valueé€‰æ‹©éé˜»å¡åˆ é™¤"><a href="#2-5-æ ¹æ®valueé€‰æ‹©éé˜»å¡åˆ é™¤" class="headerlink" title="2.5 æ ¹æ®valueé€‰æ‹©éé˜»å¡åˆ é™¤"></a>2.5 æ ¹æ®valueé€‰æ‹©éé˜»å¡åˆ é™¤</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">unlink key  <br></code></pre></td></tr></table></figure><p>ä»…å°†keysä»keyspaceå…ƒæ•°æ®ä¸­åˆ é™¤ï¼ŒçœŸæ­£çš„åˆ é™¤ä¼šåœ¨åç»­å¼‚æ­¥æ“ä½œ</p><h4 id="2-6-ä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå•ä½-ç§’ï¼‰"><a href="#2-6-ä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå•ä½-ç§’ï¼‰" class="headerlink" title="2.6 ä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ ç§’ï¼‰"></a>2.6 ä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ ç§’ï¼‰</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">expire key <span class="hljs-number">10</span> <br><br>gva164:db0<span class="hljs-operator">&gt;</span> expire k1 <span class="hljs-number">10</span><br><span class="hljs-number">1</span><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k1<br>hello<br>gva164:db0<span class="hljs-operator">&gt;</span> ttl k1# æŸ¥çœ‹keyè¿˜æœ‰å¤šå°‘ç§’åˆ°æœŸ,<span class="hljs-number">-1</span>è¡¨ç¤ºç”¨ä¸è¿‡æœŸ,<span class="hljs-number">-2</span>è¡¨ç¤ºå·²ç»è¿‡æœŸ<br><span class="hljs-number">1</span><br>gva164:db0<span class="hljs-operator">&gt;</span> ttl k1<br><span class="hljs-number">-2</span><br></code></pre></td></tr></table></figure><h3 id="3-redis-åŸå­æ€§"><a href="#3-redis-åŸå­æ€§" class="headerlink" title="3 redis åŸå­æ€§"></a>3 redis åŸå­æ€§</h3><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240515171954888.png?raw=true" alt="image-20240515171954888"></p><p>â€ƒâ€ƒåŸå­æ“ä½œæ˜¯æŒ‡ä¸ä¼šè¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­çš„æ“ä½œï¼›è¿™ç§æ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°ç»“æŸï¼Œä¸­é—´ä¸ä¼šæœ‰ä»»ä½• context switch ï¼ˆåˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼‰ã€‚<br>ï¼ˆ1ï¼‰åœ¨å•çº¿ç¨‹ä¸­ï¼Œ èƒ½å¤Ÿåœ¨å•æ¡æŒ‡ä»¤ä¸­å®Œæˆçš„æ“ä½œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯â€åŸå­æ“ä½œâ€ï¼Œå› ä¸ºä¸­æ–­åªèƒ½å‘ç”ŸäºæŒ‡ä»¤ä¹‹é—´<br>ï¼ˆ2ï¼‰åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä¸èƒ½è¢«å…¶å®ƒè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰æ‰“æ–­çš„æ“ä½œå°±å«åŸå­æ“ä½œ</p><p>â€‹<strong>Rediså‘½ä»¤çš„åŸå­æ€§ä¸»è¦å¾—ç›ŠäºRedisçš„å•çº¿ç¨‹</strong></p><h2 id="valueçš„äº”ç§æ•°æ®ç±»å‹"><a href="#valueçš„äº”ç§æ•°æ®ç±»å‹" class="headerlink" title="valueçš„äº”ç§æ•°æ®ç±»å‹"></a>valueçš„äº”ç§æ•°æ®ç±»å‹</h2><h3 id="1-String"><a href="#1-String" class="headerlink" title="1 String"></a>1 String</h3><h4 id="1-1-ç®€ä»‹"><a href="#1-1-ç®€ä»‹" class="headerlink" title="1.1 ç®€ä»‹"></a>1.1 ç®€ä»‹</h4><p>â€ƒâ€ƒStringæ˜¯Redis valueçš„æœ€åŸºæœ¬ç±»å‹<br>â€ƒâ€ƒStringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œæ„å‘³ç€Redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ï¼Œæ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚<br>â€ƒâ€ƒStringç±»å‹æ˜¯Redisæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªRedisä¸­å­—ç¬¦ä¸²valueæœ€å¤šå¯ä»¥æ˜¯512M<br>â€ƒâ€ƒå­—ç¬¦ä¸²ç±»å‹çš„å†…éƒ¨ç¼–ç æœ‰3ç§ï¼šintï¼š8ä¸ªå­—èŠ‚çš„é•¿æ•´å‹ï¼›embstrï¼šå°äºç­‰äº39ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²ï¼›rawï¼šå¤§äº39ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²</p><h4 id="1-2-å¸¸ç”¨å‘½ä»¤"><a href="#1-2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="1.2 å¸¸ç”¨å‘½ä»¤"></a>1.2 å¸¸ç”¨å‘½ä»¤</h4><p><strong>æ·»åŠ é”®å€¼å¯¹</strong></p><p>è‹¥åŸæ¥å­˜åœ¨ï¼Œé»˜è®¤ä¼šå­˜åœ¨è¦†ç›–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> k1 hello<br>OK<br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k1<br>hello<br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> k1 hello world<br>ERR syntax error<br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> k1 hello,world<br>OK<br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k1<br>hello,world<br></code></pre></td></tr></table></figure><p>NXï¼šå½“æ•°æ®åº“ä¸­keyä¸å­˜åœ¨æ—¶ï¼Œå¯ä»¥å°†key-valueæ·»åŠ æ•°æ®åº“ï¼Œ<code>å¯ç”¨äºåˆ†å¸ƒå¼é”</code><br>XXï¼šå½“æ•°æ®åº“ä¸­keyå­˜åœ¨æ—¶ï¼Œå¯ä»¥å°†key-valueæ·»åŠ æ•°æ®åº“ï¼Œä¸NXå‚æ•°äº’æ–¥<br>EXï¼škeyçš„è¶…æ—¶ç§’æ•°<br>PXï¼škeyçš„è¶…æ—¶æ¯«ç§’æ•°ï¼Œä¸EXäº’æ–¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k1<br>v10000<br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> k1 v100 ex <span class="hljs-number">20</span> nx<br><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k1<br>v10000<br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> k1 v100 ex <span class="hljs-number">20</span> xx<br>OK<br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k1<br>v100<br>gva164:db0<span class="hljs-operator">&gt;</span> ttl k1<br><span class="hljs-number">13</span><br>gva164:db0<span class="hljs-operator">&gt;</span> <br></code></pre></td></tr></table></figure><p><strong>æŸ¥è¯¢å¯¹åº”é”®å€¼</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">get</span> <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k1<br>v10000<br></code></pre></td></tr></table></figure><p><strong>å°†ç»™å®šçš„value è¿½åŠ åˆ°åŸå€¼çš„æœ«å°¾</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">append  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> k1 v1<br>OK<br>gva164:db0<span class="hljs-operator">&gt;</span> append k1 v2<br><span class="hljs-number">4</span><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k1<br>v1v2<br></code></pre></td></tr></table></figure><p><strong>è·å¾—å€¼çš„é•¿åº¦</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">strlen  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><br>gva164:db0<span class="hljs-operator">&gt;</span> strlen k1<br><span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p><strong>å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢1</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">incr  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> k2 <span class="hljs-number">2</span><br>OK<br>gva164:db0<span class="hljs-operator">&gt;</span> incr k2<br><span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p>INCR å‘½ä»¤å°†å­—ç¬¦ä¸²å€¼è§£ææˆæ•´å‹ï¼Œå°†å…¶åŠ ä¸€ï¼Œæœ€åå°†ç»“æœä¿å­˜ä¸ºæ–°çš„å­—ç¬¦ä¸²å€¼ï¼Œç±»ä¼¼çš„å‘½ä»¤æœ‰INCRBY, DECR å’Œ DECRBYï¼Œå®é™…ä¸Šä»–ä»¬åœ¨å†…éƒ¨å°±æ˜¯åŒä¸€ä¸ªå‘½ä»¤ã€‚<br>â€ƒâ€ƒINCRæ˜¯åŸå­æ“ä½œæ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿå³ä½¿å¤šä¸ªå®¢æˆ·ç«¯å¯¹åŒä¸€ä¸ªkeyå‘å‡ºINCRå‘½ä»¤ï¼Œä¹Ÿå†³ä¸ä¼šå¯¼è‡´ç«äº‰çš„æƒ…å†µã€‚å®¢æˆ·ç«¯1å’Œå®¢æˆ·ç«¯2åŒæ—¶è¯»å‡ºâ€œ10â€ï¼ŒäºŒè€…å‡å¯¹å…¶åŠ åˆ°11ï¼Œç„¶åå°†æ–°å€¼æœ€ç»ˆè®¾ç½®ä¸º11æ°¸è¿œä¸å¯èƒ½å‘ç”Ÿï¼Œæœ€ç»ˆçš„å€¼ä¸€å®šæ˜¯12ã€‚read-increment-setæ“ä½œå®Œæˆæ—¶ï¼Œå…¶ä»–å®¢æˆ·ç«¯ä¸ä¼šåœ¨åŒä¸€æ—¶é—´æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚</p><p><strong>å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡1</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">decr  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k3<br><br>gva164:db0<span class="hljs-operator">&gt;</span> decr k3<br><span class="hljs-number">-1</span><br></code></pre></td></tr></table></figure><p>åªèƒ½å¯¹æ•°å­—å€¼æ“ä½œï¼Œå¦‚æœä¸ºç©ºï¼Œå€¼ä¸º-1</p><p><strong>å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢å‡ï¼Œè‡ªå®šä¹‰æ­¥é•¿</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">incrby <span class="hljs-operator">/</span> decrby  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span>  <span class="hljs-operator">&lt;</span>æ­¥é•¿<span class="hljs-operator">&gt;</span><br><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k2<br><span class="hljs-number">3</span><br>gva164:db0<span class="hljs-operator">&gt;</span> incrby k2 <span class="hljs-number">3</span><br><span class="hljs-number">6</span><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> k3 <span class="hljs-number">2</span><br>OK<br>gva164:db0<span class="hljs-operator">&gt;</span> decrby k3 <span class="hljs-number">5</span><br><span class="hljs-number">-3</span><br></code></pre></td></tr></table></figure><p><strong>åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-valueå¯¹</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mset  <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>value1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>value2<span class="hljs-operator">&gt;</span>  ..... <br>gva164:db0<span class="hljs-operator">&gt;</span> mset k1 v1 k2 v2 k3 v3<br>OK<br></code></pre></td></tr></table></figure><p><strong>åŒæ—¶è·å–ä¸€ä¸ªæˆ–å¤šä¸ªvalue</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mget <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span><br><br>gva164:db0<span class="hljs-operator">&gt;</span> mget k1 k2 k3<br><span class="hljs-number">1</span>) &quot;v1&quot;<br><span class="hljs-number">2</span>) &quot;v2&quot;<br><span class="hljs-number">3</span>) &quot;v3&quot;<br></code></pre></td></tr></table></figure><p><strong>åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®š key éƒ½ä¸å­˜åœ¨</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">msetnx <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>value1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>value2<span class="hljs-operator">&gt;</span>  ..... <br></code></pre></td></tr></table></figure><p>åŸå­æ€§ï¼Œæœ‰ä¸€ä¸ªå¤±è´¥åˆ™éƒ½å¤±è´¥</p><p><strong>æˆªå–å­—ç¬¦ä¸²</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">getrange  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>èµ·å§‹ä½ç½®<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>ç»“æŸä½ç½®<span class="hljs-operator">&gt;</span><br><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> ks abcdef<br>OK<br>gva164:db0<span class="hljs-operator">&gt;</span> getrange ks <span class="hljs-number">13</span><br>ERR wrong number <span class="hljs-keyword">of</span> arguments <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;getrange&#x27;</span> command<br>gva164:db0<span class="hljs-operator">&gt;</span> getrange ks <span class="hljs-number">1</span> <span class="hljs-number">3</span><br>bcd<br></code></pre></td></tr></table></figure><p><strong>ç”¨ value è¦†å†™keyæ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œä»èµ·å§‹ä½ç½®å¼€å§‹(ç´¢å¼•ä»0å¼€å§‹)</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">setrange  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>èµ·å§‹ä½ç½®<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p><strong>è®¾ç½®é”®å€¼çš„åŒæ—¶ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">setex  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>è¿‡æœŸæ—¶é—´<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p><strong>ä»¥æ–°æ¢æ—§ï¼Œè®¾ç½®äº†æ–°å€¼åŒæ—¶è·å¾—æ—§å€¼</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">getset <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br><br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k1<br>v1<br>gva164:db0<span class="hljs-operator">&gt;</span> getset k1 v100<br>v1<br>gva164:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">get</span> k1<br>v100<br></code></pre></td></tr></table></figure><p>å¦‚ï¼šç³»ç»Ÿä¸­æ¯å½“æœ‰æ–°ç”¨æˆ·è®¿é—®æ—¶å°±ç”¨INCRå‘½ä»¤æ“ä½œä¸€ä¸ªRedis keyã€‚è‹¥æ¯å°æ—¶å¯¹è¿™ä¸ªä¿¡æ¯æ”¶é›†ä¸€æ¬¡ã€‚å¯ä½¿ç”¨GETSETç»™å…¶èµ‹å€¼0å¹¶è¯»å–åŸå€¼ã€‚</p><h4 id="1-3-æ•°æ®ç»“æ„"><a href="#1-3-æ•°æ®ç»“æ„" class="headerlink" title="1.3  æ•°æ®ç»“æ„"></a>1.3  æ•°æ®ç»“æ„</h4><p>Stringçš„æ•°æ®ç»“æ„ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²(Simple Dynamic String,ç¼©å†™SDS)ã€‚é‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240515175615866.png?raw=true" alt="image-20240515175615866"></p><p>å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œä¸ºStringç±»å‹å®é™…åˆ†é…çš„ç©ºé—´ä¸€èˆ¬è¦é«˜äºå®é™…å­—ç¬¦ä¸²é•¿åº¦lenã€‚å½“å­—ç¬¦ä¸²é•¿åº¦å°äº1Mæ—¶ï¼Œæ‰©å®¹éƒ½æ˜¯åŠ å€ç°æœ‰çš„ç©ºé—´ï¼Œå¦‚æœè¶…è¿‡1Mï¼Œæ‰©å®¹æ—¶ä¸€æ¬¡åªä¼šå¤šæ‰©1Mçš„ç©ºé—´ã€‚</p><h3 id="2-List"><a href="#2-List" class="headerlink" title="2 List"></a>2 List</h3><h4 id="2-1-ç®€ä»‹"><a href="#2-1-ç®€ä»‹" class="headerlink" title="2.1 ç®€ä»‹"></a>2.1 ç®€ä»‹</h4><p><strong>å•é”®å¤šå€¼</strong></p><p>Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹).</p><p>Redis listsåŸºäºLinkedListå®ç°ã€‚è¿™æ„å‘³ç€å³ä½¿åœ¨ä¸€ä¸ªlistä¸­æœ‰æ•°ç™¾ä¸‡ä¸ªå…ƒç´ ï¼Œåœ¨å¤´éƒ¨æˆ–å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ“ä½œï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯å¸¸æ•°çº§åˆ«çš„ã€‚ç”¨LPUSH å‘½ä»¤åœ¨åä¸ªå…ƒç´ çš„listå¤´éƒ¨æ·»åŠ æ–°å…ƒç´ ï¼Œå’Œåœ¨åƒä¸‡å…ƒç´ listå¤´éƒ¨æ·»åŠ æ–°å…ƒç´ çš„é€Ÿåº¦ç›¸åŒã€‚</p><p>ç›¸å¯¹åº”çš„ï¼Œåœ¨æ•°ç»„å®ç°çš„listä¸­åˆ©ç”¨ç´¢å¼•è®¿é—®å…ƒç´ çš„é€Ÿåº¦æå¿«ï¼Œè€ŒåŒæ ·çš„æ“ä½œåœ¨linkedlistå®ç°çš„listä¸Šæ²¡æœ‰é‚£ä¹ˆå¿«ã€‚</p><blockquote><p>æ‰€ä»¥ï¼šå¦‚ä½•å¿«é€Ÿåœ°åœ¨å¾ˆå¤§çš„åˆ—è¡¨ä¸Šæ·»åŠ å…ƒç´ ï¼Œå»ºè®®ä½¿ç”¨List;å¦‚æœå¿«é€Ÿè®¿é—®é›†åˆå…ƒç´ å¾ˆé‡è¦ï¼Œå»ºè®®ä½¿ç”¨å¯æ’åºé›†åˆ(sorted sets)ã€‚</p></blockquote><h4 id="2-2-å¸¸ç”¨å‘½ä»¤"><a href="#2-2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.2 å¸¸ç”¨å‘½ä»¤"></a>2.2 å¸¸ç”¨å‘½ä»¤</h4><p><strong>ä»å·¦è¾¹&#x2F;å³è¾¹æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql">lpush<span class="hljs-operator">/</span>rpush  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>value1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>value2<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>value3<span class="hljs-operator">&gt;</span> .... <br><br>localhost:db0<span class="hljs-operator">&gt;</span> lrange k1 <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;v3&quot;<br><span class="hljs-number">2</span>) &quot;v2&quot;<br><span class="hljs-number">3</span>) &quot;v1&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> lpush k1 v<span class="hljs-number">-3</span> v<span class="hljs-number">-2</span> v<span class="hljs-number">-1</span> <span class="hljs-number">0</span><br><span class="hljs-number">7</span><br>localhost:db0<span class="hljs-operator">&gt;</span> lrange k1 <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;0&quot;<br><span class="hljs-number">2</span>) &quot;v-1&quot;<br><span class="hljs-number">3</span>) &quot;v-2&quot;<br><span class="hljs-number">4</span>) &quot;v-3&quot;<br><span class="hljs-number">5</span>) &quot;v3&quot;<br><span class="hljs-number">6</span>) &quot;v2&quot;<br><span class="hljs-number">7</span>) &quot;v1&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> rpush k1 v8 v9 v10<br><span class="hljs-number">10</span><br>localhost:db0<span class="hljs-operator">&gt;</span> lrange k1 <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;0&quot;<br><span class="hljs-number">2</span>) &quot;v-1&quot;<br><span class="hljs-number">3</span>) &quot;v-2&quot;<br><span class="hljs-number">4</span>) &quot;v-3&quot;<br><span class="hljs-number">5</span>) &quot;v3&quot;<br><span class="hljs-number">6</span>) &quot;v2&quot;<br><span class="hljs-number">7</span>) &quot;v1&quot;<br><span class="hljs-number">8</span>) &quot;v8&quot;<br><span class="hljs-number">9</span>) &quot;v9&quot;<br><span class="hljs-number">10</span>) &quot;v10&quot;<br></code></pre></td></tr></table></figure><p>å¦‚ï¼šåœ¨åšå®¢å¼•æ“å®ç°ä¸­ï¼Œå¯ä¸ºæ¯ç¯‡æ—¥å¿—è®¾ç½®ä¸€ä¸ªlistï¼Œæ¨å…¥åšå®¢è¯„è®º</p><p>æ³¨ï¼š<br>â€ƒâ€ƒä½¿ç”¨LPUSHå’ŒRPOPå®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹ï¼Œä¼šé‡åˆ°è¿™ç§æƒ…æ™¯ï¼šlistæ˜¯ç©ºï¼Œè¿™æ—¶å€™æ¶ˆè´¹è€…å°±éœ€è¦è½®è¯¢æ¥è·å–æ•°æ®ï¼Œè¿™æ ·å°±ä¼šå¢åŠ redisçš„è®¿é—®å‹åŠ›ã€å¢åŠ æ¶ˆè´¹ç«¯çš„cpuæ—¶é—´ï¼Œè€Œå¾ˆå¤šè®¿é—®éƒ½æ˜¯æ— ç”¨çš„ã€‚ä¸ºæ­¤redisæä¾›äº†é˜»å¡å¼è®¿é—® BRPOP å’Œ BLPOP å‘½ä»¤ã€‚ æ¶ˆè´¹è€…å¯ä»¥åœ¨è·å–æ•°æ®æ—¶æŒ‡å®šå¦‚æœæ•°æ®ä¸å­˜åœ¨é˜»å¡çš„æ—¶é—´ï¼Œå¦‚æœåœ¨æ—¶é™å†…è·å¾—æ•°æ®åˆ™ç«‹å³è¿”å›ï¼Œå¦‚æœè¶…æ—¶è¿˜æ²¡æœ‰æ•°æ®åˆ™è¿”å›null, 0è¡¨ç¤ºä¸€ç›´é˜»å¡ã€‚</p><p><strong>ä»å·¦è¾¹&#x2F;å³è¾¹åå‡ºä¸€ä¸ªå€¼ã€‚å€¼åœ¨é”®åœ¨ï¼Œå€¼å…‰é”®äº¡</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">lpop<span class="hljs-operator">/</span>rpop  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> lrange k2 <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;v1&quot;<br><span class="hljs-number">2</span>) &quot;v2&quot;<br><span class="hljs-number">3</span>) &quot;v3&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> lpop k2<br>v1<br>localhost:db0<span class="hljs-operator">&gt;</span> rpop k2<br>v3<br>localhost:db0<span class="hljs-operator">&gt;</span> lrange k2 <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;v2&quot;<br></code></pre></td></tr></table></figure><p><strong>ä»key1åˆ—è¡¨å³è¾¹åå‡ºä¸€ä¸ªå€¼ï¼Œæ’åˆ°key2åˆ—è¡¨å·¦è¾¹</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">rpoplpush  <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> lpush <span class="hljs-keyword">order</span> a1 a2 a3 a4<br><span class="hljs-number">4</span><br>localhost:db0<span class="hljs-operator">&gt;</span> lrange <span class="hljs-keyword">order</span> <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;a4&quot;<br><span class="hljs-number">2</span>) &quot;a3&quot;<br><span class="hljs-number">3</span>) &quot;a2&quot;<br><span class="hljs-number">4</span>) &quot;a1&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> rpoplpush <span class="hljs-keyword">order</span> history_order<br>a1<br>localhost:db0<span class="hljs-operator">&gt;</span> rpoplpush <span class="hljs-keyword">order</span> history_order<br>a2<br>localhost:db0<span class="hljs-operator">&gt;</span> rpoplpush <span class="hljs-keyword">order</span> history_order<br>a3<br>localhost:db0<span class="hljs-operator">&gt;</span> rpoplpush <span class="hljs-keyword">order</span> history_order<br>a4<br>localhost:db0<span class="hljs-operator">&gt;</span> lrange history_order <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;a4&quot;<br><span class="hljs-number">2</span>) &quot;a3&quot;<br><span class="hljs-number">3</span>) &quot;a2&quot;<br><span class="hljs-number">4</span>) &quot;a1&quot;<br></code></pre></td></tr></table></figure><p><strong>æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³)</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">lrange <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span><span class="hljs-keyword">start</span><span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>stop<span class="hljs-operator">&gt;</span><br><br></code></pre></td></tr></table></figure><p>0å·¦è¾¹ç¬¬ä¸€ä¸ªï¼Œ-1å³è¾¹ç¬¬ä¸€ä¸ªï¼Œï¼ˆ0 -1è¡¨ç¤ºè·å–æ‰€æœ‰ï¼‰</p><p>å¦‚æ–°é—»ç½‘ç«™,å¯ä»¥æŠŠæ¯ä¸ªæ–°æäº¤çš„é“¾æ¥æ·»åŠ åˆ°ä¸€ä¸ªlistï¼Œç”¨LRANGEå¯ç®€å•çš„å¯¹ç»“æœåˆ†é¡µã€‚</p><p><strong>æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³)</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">lindex <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>index<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> lrange history_order <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;a4&quot;<br><span class="hljs-number">2</span>) &quot;a3&quot;<br><span class="hljs-number">3</span>) &quot;a2&quot;<br><span class="hljs-number">4</span>) &quot;a1&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> lindex history_order <span class="hljs-number">1</span><br>a3<br>localhost:db0<span class="hljs-operator">&gt;</span> lindex history_order <span class="hljs-number">3</span><br>a1<br></code></pre></td></tr></table></figure><p><strong>è·å¾—åˆ—è¡¨é•¿åº¦</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">llen <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> llen history_order<br><span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p><strong>åœ¨ valueçš„å‰é¢æˆ–åé¢æ’å…¥ newvalue</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">linsert <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span>  before<span class="hljs-operator">/</span>after <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>newvalue<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> linsert history_order before a3 mya3<br><span class="hljs-number">5</span><br>localhost:db0<span class="hljs-operator">&gt;</span> lrange history_order <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;a4&quot;<br><span class="hljs-number">2</span>) &quot;mya3&quot;<br><span class="hljs-number">3</span>) &quot;a3&quot;<br><span class="hljs-number">4</span>) &quot;a2&quot;<br><span class="hljs-number">5</span>) &quot;a1&quot;<br></code></pre></td></tr></table></figure><p><strong>ä»å·¦åˆ°å³åˆ é™¤nä¸ªvalue</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">lrem <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>n<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> lpush a a b a b a b<br><span class="hljs-number">6</span><br>localhost:db0<span class="hljs-operator">&gt;</span> lrange a <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;b&quot;<br><span class="hljs-number">2</span>) &quot;a&quot;<br><span class="hljs-number">3</span>) &quot;b&quot;<br><span class="hljs-number">4</span>) &quot;a&quot;<br><span class="hljs-number">5</span>) &quot;b&quot;<br><span class="hljs-number">6</span>) &quot;a&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> lrem a <span class="hljs-number">3</span> b<br><span class="hljs-number">3</span><br>localhost:db0<span class="hljs-operator">&gt;</span> lrange a <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;a&quot;<br><span class="hljs-number">2</span>) &quot;a&quot;<br><span class="hljs-number">3</span>) &quot;a&quot;<br></code></pre></td></tr></table></figure><p><strong>å°†åˆ—è¡¨keyä¸‹æ ‡ä¸ºindexçš„å€¼æ›¿æ¢æˆvalue</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">lset<span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>index<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> lrange a <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;a&quot;<br><span class="hljs-number">2</span>) &quot;a&quot;<br><span class="hljs-number">3</span>) &quot;a&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> lset a <span class="hljs-number">1</span> bbb<br>OK<br>localhost:db0<span class="hljs-operator">&gt;</span> lrange a <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br><span class="hljs-number">1</span>) &quot;a&quot;<br><span class="hljs-number">2</span>) &quot;bbb&quot;<br><span class="hljs-number">3</span>) &quot;a<br></code></pre></td></tr></table></figure><h4 id="2-3-æ•°æ®ç»“æ„"><a href="#2-3-æ•°æ®ç»“æ„" class="headerlink" title="2.3 æ•°æ®ç»“æ„"></a>2.3 æ•°æ®ç»“æ„</h4><p>â€‹Listçš„æ•°æ®ç»“æ„ä¸ºå¿«é€Ÿé“¾è¡¨quickList</p><p>â€‹    é¦–å…ˆåœ¨åˆ—è¡¨å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä½¿ç”¨ziplistï¼Œå³å‹ç¼©åˆ—è¡¨ã€‚å®ƒå°†æ‰€æœ‰çš„å…ƒç´ ç´§æŒ¨åœ¨ä¸€èµ·å­˜å‚¨ï¼Œåˆ†é…çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ã€‚å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™æ‰ä¼šæ”¹æˆquicklistã€‚å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œéœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆprevå’Œnextã€‚Rediså°†é“¾è¡¨å’Œziplistç»“åˆèµ·æ¥ç»„æˆäº†quicklistã€‚ä¹Ÿå°±æ˜¯å°†å¤šä¸ªziplistä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™ã€‚</p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240516095854166.png?raw=true" alt="image-20240516095854166"></p><h3 id="3-Set"><a href="#3-Set" class="headerlink" title="3 Set"></a>3 Set</h3><h4 id="3-1-ç®€ä»‹"><a href="#3-1-ç®€ä»‹" class="headerlink" title="3.1 ç®€ä»‹"></a>3.1 ç®€ä»‹</h4><p>â€‹setå¯¹å¤–æä¾›çš„åŠŸèƒ½ä¸listç±»ä¼¼æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„åŠŸèƒ½ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äºsetæ˜¯å¯ä»¥è‡ªåŠ¨æ’é‡çš„,ä¸”setæä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ªseté›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯listæ‰€ä¸èƒ½æä¾›çš„ã€‚</p><p>â€‹</p><p>â€‹Redisçš„Setæ˜¯stringç±»å‹çš„æ— åºé›†åˆ,åº•å±‚å…¶å®æ˜¯ä¸€ä¸ªvalueä¸ºnullçš„hashè¡¨ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯O(1) ï¼ŒO(1)ï¼Œæ•°æ®å¢åŠ ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ—¶é—´ä¸å˜</p><h4 id="3-2-å¸¸ç”¨å‘½ä»¤"><a href="#3-2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="3.2 å¸¸ç”¨å‘½ä»¤"></a>3.2 å¸¸ç”¨å‘½ä»¤</h4><p><strong>å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠ å…¥åˆ°é›†åˆ key ä¸­ï¼Œå·²ç»å­˜åœ¨çš„ member å…ƒç´ å°†è¢«å¿½ç•¥</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">sadd <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>value1<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>value2<span class="hljs-operator">&gt;</span> ..... <br>localhost:db0<span class="hljs-operator">&gt;</span> sadd k1 v1 v1 v2 v3<br><span class="hljs-number">3</span><br>localhost:db0<span class="hljs-operator">&gt;</span> smembers k1<br><span class="hljs-number">1</span>) &quot;v2&quot;<br><span class="hljs-number">2</span>) &quot;v1&quot;<br><span class="hljs-number">3</span>) &quot;v3&quot;<br><br></code></pre></td></tr></table></figure><p><strong>å–å‡ºè¯¥é›†åˆçš„æ‰€æœ‰å€¼</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">smembers <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> sadd k1 v1 v1 v2 v3<br><span class="hljs-number">3</span><br>localhost:db0<span class="hljs-operator">&gt;</span> smembers k1<br><span class="hljs-number">1</span>) &quot;v2&quot;<br><span class="hljs-number">2</span>) &quot;v1&quot;<br><span class="hljs-number">3</span>) &quot;v3&quot;<br></code></pre></td></tr></table></figure><p> <strong>åˆ¤æ–­é›†åˆkeyæ˜¯å¦ä¸ºå«æœ‰è¯¥valueå€¼ï¼Œæœ‰1ï¼Œæ²¡æœ‰0</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">sismember <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> sismember<br>k1 v1<br><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><strong>è¿”å›è¯¥é›†åˆçš„å…ƒç´ ä¸ªæ•°</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">scard <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> scard k1<br><span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p><strong>åˆ é™¤é›†åˆä¸­çš„æŸä¸ªå…ƒç´ </strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">srem <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>value1<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>value2<span class="hljs-operator">&gt;</span> .... <br><br>localhost:db0<span class="hljs-operator">&gt;</span> srem k1 v1<br><span class="hljs-number">1</span><br>localhost:db0<span class="hljs-operator">&gt;</span> smembers k1<br><span class="hljs-number">1</span>) &quot;v2&quot;<br><span class="hljs-number">2</span>) &quot;v3&quot;<br></code></pre></td></tr></table></figure><p><strong>éšæœºä»è¯¥é›†åˆä¸­åå‡ºnä¸ªå€¼</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">spop <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> [n]<br><br>localhost:db0<span class="hljs-operator">&gt;</span> spop k1 <span class="hljs-number">2</span><br><span class="hljs-number">1</span>) &quot;v2&quot;<br><span class="hljs-number">2</span>) &quot;v3&quot;<br></code></pre></td></tr></table></figure><p><strong>éšæœºä»è¯¥é›†åˆä¸­å–å‡ºnä¸ªå€¼ï¼Œä¸ä¼šä»é›†åˆä¸­åˆ é™¤</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">srandmember <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> [n]<br><br>localhost:db0<span class="hljs-operator">&gt;</span> srandmember k1 <span class="hljs-number">2</span><br><span class="hljs-number">1</span>) &quot;v1&quot;<br><span class="hljs-number">2</span>) &quot;v2&quot;<br></code></pre></td></tr></table></figure><p><strong>æŠŠé›†åˆä¸­ä¸€ä¸ªå€¼ä»ä¸€ä¸ªé›†åˆç§»åŠ¨åˆ°å¦ä¸€ä¸ªé›†åˆ</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">smove <span class="hljs-operator">&lt;</span>source<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>destination<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">value</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> smembers k1<br><span class="hljs-number">1</span>) &quot;v2&quot;<br><span class="hljs-number">2</span>) &quot;v1&quot;<br><span class="hljs-number">3</span>) &quot;v3&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> sadd k2 p1 p2 p3<br><span class="hljs-number">3</span><br>localhost:db0<span class="hljs-operator">&gt;</span> smembers k2<br><span class="hljs-number">1</span>) &quot;p2&quot;<br><span class="hljs-number">2</span>) &quot;p3&quot;<br><span class="hljs-number">3</span>) &quot;p1&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> smove k1 k2 v1<br><span class="hljs-number">1</span><br>localhost:db0<span class="hljs-operator">&gt;</span> smembers k2<br><span class="hljs-number">1</span>) &quot;v1&quot;<br><span class="hljs-number">2</span>) &quot;p2&quot;<br><span class="hljs-number">3</span>) &quot;p3&quot;<br><span class="hljs-number">4</span>) &quot;p1&quot;<br></code></pre></td></tr></table></figure><p><strong>è¿”å›ä¸¤ä¸ªé›†åˆçš„äº¤é›†å…ƒç´ </strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">sinter <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> smembers k2<br><span class="hljs-number">1</span>) &quot;v1&quot;<br><span class="hljs-number">2</span>) &quot;p2&quot;<br><span class="hljs-number">3</span>) &quot;p3&quot;<br><span class="hljs-number">4</span>) &quot;p1&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> sinter k1 k2<br><br>localhost:db0<span class="hljs-operator">&gt;</span> sadd k1 p1<br><span class="hljs-number">1</span><br>localhost:db0<span class="hljs-operator">&gt;</span> sinter k1 k2<br><span class="hljs-number">1</span>) &quot;p1&quot;<br></code></pre></td></tr></table></figure><p><strong>è¿”å›ä¸¤ä¸ªé›†åˆçš„å¹¶é›†å…ƒç´ </strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">sunion <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> smembers k1<br><span class="hljs-number">1</span>) &quot;v2&quot;<br><span class="hljs-number">2</span>) &quot;v3&quot;<br><span class="hljs-number">3</span>) &quot;p1&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> smembers k2<br><span class="hljs-number">1</span>) &quot;v1&quot;<br><span class="hljs-number">2</span>) &quot;p2&quot;<br><span class="hljs-number">3</span>) &quot;p3&quot;<br><span class="hljs-number">4</span>) &quot;p1&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> sunion k1 k2<br><span class="hljs-number">1</span>) &quot;p1&quot;<br><span class="hljs-number">2</span>) &quot;v2&quot;<br><span class="hljs-number">3</span>) &quot;v3&quot;<br><span class="hljs-number">4</span>) &quot;v1&quot;<br><span class="hljs-number">5</span>) &quot;p2&quot;<br><span class="hljs-number">6</span>) &quot;p3&quot;<br></code></pre></td></tr></table></figure><p><strong>è¿”å›ä¸¤ä¸ªé›†åˆçš„å·®é›†å…ƒç´ (key1ä¸­ä¸key2ä¸é‡å¤çš„value)</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">sdiff <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> smembers k1<br><span class="hljs-number">1</span>) &quot;v2&quot;<br><span class="hljs-number">2</span>) &quot;v3&quot;<br><span class="hljs-number">3</span>) &quot;p1&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> smembers k2<br><span class="hljs-number">1</span>) &quot;v1&quot;<br><span class="hljs-number">2</span>) &quot;p2&quot;<br><span class="hljs-number">3</span>) &quot;p3&quot;<br><span class="hljs-number">4</span>) &quot;p1&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> sdiff k1 k2<br><span class="hljs-number">1</span>) &quot;v2&quot;<br><span class="hljs-number">2</span>) &quot;v3&quot;<br>localhost:db0<span class="hljs-operator">&gt;</span> sdiff k2 k1<br><span class="hljs-number">1</span>) &quot;p2&quot;<br><span class="hljs-number">2</span>) &quot;v1&quot;<br><span class="hljs-number">3</span>) &quot;p3&quot;<br></code></pre></td></tr></table></figure><h4 id="2-3-æ•°æ®ç»“æ„-1"><a href="#2-3-æ•°æ®ç»“æ„-1" class="headerlink" title="2.3 æ•°æ®ç»“æ„"></a>2.3 æ•°æ®ç»“æ„</h4><p>â€‹Setæ•°æ®ç»“æ„æ˜¯dictå­—å…¸ï¼Œå­—å…¸æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„</p><p>â€‹Javaä¸­HashSetçš„å†…éƒ¨å®ç°ä½¿ç”¨çš„æ˜¯HashMapï¼Œåªä¸è¿‡æ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚Redisçš„setç»“æ„ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå®ƒçš„å†…éƒ¨ä¹Ÿä½¿ç”¨hashç»“æ„ï¼Œæ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå†…éƒ¨å€¼ã€‚</p><h3 id="4-å“ˆå¸Œ-hash"><a href="#4-å“ˆå¸Œ-hash" class="headerlink" title="4 å“ˆå¸Œ(hash)"></a>4 å“ˆå¸Œ(hash)</h3><h4 id="4-1-ç®€ä»‹"><a href="#4-1-ç®€ä»‹" class="headerlink" title="4.1 ç®€ä»‹"></a>4.1 ç®€ä»‹</h4><p>â€‹Redis hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆ</p><p>â€‹Redis hash æ˜¯ä¸€ä¸ªstring ç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ ,hash ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡,ç±»ä¼¼javaé‡Œé¢çš„Map&lt;string,Object&gt;</p><h4 id="4-2-å¸¸ç”¨å‘½ä»¤"><a href="#4-2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="4.2 å¸¸ç”¨å‘½ä»¤"></a>4.2 å¸¸ç”¨å‘½ä»¤</h4><p><strong>ç»™keyé›†åˆä¸­çš„ fieldé”®èµ‹å€¼value</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">hset key [field <span class="hljs-keyword">value</span> ...]<br><br>localhost:db0<span class="hljs-operator">&gt;</span> hset <span class="hljs-keyword">user</span>:<span class="hljs-number">1</span> name cz grade <span class="hljs-number">88</span><br><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><strong>ä»é›†åˆå–å‡º value</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">hget <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>field<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> hget <span class="hljs-keyword">user</span>:<span class="hljs-number">1</span> name<br>cz<br></code></pre></td></tr></table></figure><p><strong>æ‰¹é‡è®¾ç½®hashçš„å€¼</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">hmset <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>field1<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>value1<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>field2<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>value2<span class="hljs-operator">&gt;</span>... <br><br>localhost:db0<span class="hljs-operator">&gt;</span> hmset <span class="hljs-keyword">user</span>:<span class="hljs-number">2</span> name yu grade <span class="hljs-number">90</span><br>OK<br></code></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼Œç»™å®šåŸŸ field æ˜¯å¦å­˜åœ¨</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">hexists<span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>field<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> hexists <span class="hljs-keyword">user</span>:<span class="hljs-number">1</span> name<br><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><strong>åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰field</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">hkeys <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> hkeys <span class="hljs-keyword">user</span>:<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) &quot;name&quot;<br><span class="hljs-number">2</span>) &quot;grade&quot;<br></code></pre></td></tr></table></figure><p><strong>åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰value</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">hvals <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> hvals <span class="hljs-keyword">user</span>:<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) &quot;cz&quot;<br><span class="hljs-number">2</span>) &quot;88&quot;<br></code></pre></td></tr></table></figure><p><strong>ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼åŠ ä¸Šå¢é‡</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">hincrby <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>field<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>increment<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> hincrby <span class="hljs-keyword">user</span>:<span class="hljs-number">1</span> grade <span class="hljs-number">4</span><br><span class="hljs-number">92</span><br>localhost:db0<span class="hljs-operator">&gt;</span> hget <span class="hljs-keyword">user</span>:<span class="hljs-number">1</span> grade<br><span class="hljs-number">92</span><br></code></pre></td></tr></table></figure><p><strong>å°†å“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼è®¾ç½®ä¸º value ï¼Œå½“ä¸”ä»…å½“åŸŸ field ä¸å­˜åœ¨</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">hsetnx <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>field<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span>.<br><br>localhost:db0<span class="hljs-operator">&gt;</span> hsetnx <span class="hljs-keyword">user</span>:<span class="hljs-number">1</span> name io<br><span class="hljs-number">0</span><br>localhost:db0<span class="hljs-operator">&gt;</span> hget <span class="hljs-keyword">user</span>:<span class="hljs-number">1</span> name<br>cz<br></code></pre></td></tr></table></figure><h4 id="4-3-æ•°æ®ç»“æ„"><a href="#4-3-æ•°æ®ç»“æ„" class="headerlink" title="4.3 æ•°æ®ç»“æ„"></a>4.3 æ•°æ®ç»“æ„</h4><p>â€‹Hashç±»å‹å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯ä¸¤ç§ï¼šziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ï¼Œhashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰ã€‚å½“field-valueé•¿åº¦è¾ƒçŸ­ä¸”ä¸ªæ•°è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨hashtableã€‚</p><h3 id="5-æœ‰åºé›†åˆ-Zset-sorted-set"><a href="#5-æœ‰åºé›†åˆ-Zset-sorted-set" class="headerlink" title="5 æœ‰åºé›†åˆ(Zset(sorted set))"></a>5 æœ‰åºé›†åˆ(Zset(sorted set))</h3><h4 id="5-1-ç®€ä»‹"><a href="#5-1-ç®€ä»‹" class="headerlink" title="5.1 ç®€ä»‹"></a>5.1 ç®€ä»‹</h4><p>â€‹åºé›†åˆzsetä¸æ™®é€šé›†åˆsetéå¸¸ç›¸ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„å­—ç¬¦ä¸²é›†åˆã€‚</p><p>â€‹ä¸åŒä¹‹å¤„æ˜¯æœ‰åºé›†åˆçš„æ¯ä¸ªæˆå‘˜éƒ½å…³è”äº†ä¸€ä¸ªè¯„åˆ†ï¼ˆscoreï¼‰,è¿™ä¸ªè¯„åˆ†ï¼ˆscoreï¼‰è¢«ç”¨æ¥æŒ‰ç…§ä»æœ€ä½åˆ†åˆ°æœ€é«˜åˆ†çš„æ–¹å¼æ’åºé›†åˆä¸­çš„æˆå‘˜ã€‚é›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯è¯„åˆ†å¯é‡å¤å› ä¸ºå…ƒç´ æ˜¯æœ‰åºçš„, æ‰€ä»¥ä½ ä¹Ÿå¯ä»¥å¾ˆå¿«çš„æ ¹æ®è¯„åˆ†ï¼ˆscoreï¼‰æˆ–è€…æ¬¡åºï¼ˆpositionï¼‰æ¥è·å–ä¸€ä¸ªèŒƒå›´çš„å…ƒç´ ã€‚è®¿é—®æœ‰åºé›†åˆçš„ä¸­é—´å…ƒç´ ä¹Ÿæ˜¯éå¸¸å¿«çš„,å› æ­¤ä½ èƒ½å¤Ÿä½¿ç”¨æœ‰åºé›†åˆä½œä¸ºä¸€ä¸ªæ²¡æœ‰é‡å¤æˆå‘˜çš„æ™ºèƒ½åˆ—è¡¨ã€‚</p><h4 id="5-2-å¸¸ç”¨å‘½ä»¤"><a href="#5-2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="5.2 å¸¸ç”¨å‘½ä»¤"></a>5.2 å¸¸ç”¨å‘½ä»¤</h4><p><strong>å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠå…¶ score å€¼åŠ å…¥åˆ°æœ‰åºé›† key å½“ä¸­</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">zadd  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>score1<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>value1<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>score2<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>value2<span class="hljs-operator">&gt;</span>â€¦<br><br>localhost:db0<span class="hljs-operator">&gt;</span> zadd topn <span class="hljs-number">200</span> java <span class="hljs-number">300</span> python <span class="hljs-number">150</span> c<br><span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p><strong>è¿”å›æœ‰åºé›† key ä¸­ï¼Œä¸‹æ ‡åœ¨ start stopä¹‹é—´çš„å…ƒç´ </strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">zrange <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span><span class="hljs-keyword">start</span><span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>stop<span class="hljs-operator">&gt;</span>  [WITHSCORES]  <br><br>localhost:db0<span class="hljs-operator">&gt;</span> zrange topn <span class="hljs-number">0</span> <span class="hljs-number">-1</span> withscores<br><span class="hljs-number">1</span>) <span class="hljs-number">1</span>) &quot;c&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">150</span><br><span class="hljs-number">2</span>) <span class="hljs-number">1</span>) &quot;java&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">200</span><br><span class="hljs-number">3</span>) <span class="hljs-number">1</span>) &quot;python&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">300</span><br></code></pre></td></tr></table></figure><p><strong>è¿”å›æœ‰åºé›† key ä¸­ï¼Œæ‰€æœ‰ score å€¼ä»‹äº min å’Œ max ä¹‹é—´(åŒ…æ‹¬ç­‰äº min æˆ– max )çš„æˆå‘˜ã€‚</strong></p><p>æœ‰åºé›†æˆå‘˜æŒ‰ score å€¼é€’å¢(ä»å°åˆ°å¤§)æ¬¡åºæ’åˆ—ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">zrangebyscore key min max [withscores] [limit <span class="hljs-keyword">offset</span> count]<br><br>localhost:db0<span class="hljs-operator">&gt;</span> zrangebyscore topn <span class="hljs-number">200</span> <span class="hljs-number">500</span> withscores<br><span class="hljs-number">1</span>) <span class="hljs-number">1</span>) &quot;java&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">200</span><br><span class="hljs-number">2</span>) <span class="hljs-number">1</span>) &quot;python&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">300</span><br></code></pre></td></tr></table></figure><p><strong>æœ‰åºé›†æˆå‘˜æŒ‰ score å€¼é€’å¢(ä»å¤§åˆ°å°)æ¬¡åºæ’åˆ—ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">zrevrangebyscore key max min [withscores] [limit <span class="hljs-keyword">offset</span> count]    <br><br>localhost:db0<span class="hljs-operator">&gt;</span> zrevrangebyscore topn <span class="hljs-number">500</span> <span class="hljs-number">200</span> withscores<br><span class="hljs-number">1</span>) <span class="hljs-number">1</span>) &quot;python&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">300</span><br><span class="hljs-number">2</span>) <span class="hljs-number">1</span>) &quot;java&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">200</span><br></code></pre></td></tr></table></figure><p><strong>ä¸ºå…ƒç´ çš„scoreåŠ ä¸Šå¢é‡</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">zincrby <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>increment<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span>    <br><br>localhost:db0<span class="hljs-operator">&gt;</span> zincrby topn <span class="hljs-number">50</span> java<br><span class="hljs-number">250</span><br>localhost:db0<span class="hljs-operator">&gt;</span> zrange topn <span class="hljs-number">0</span> <span class="hljs-number">-1</span> withscores<br><span class="hljs-number">1</span>) <span class="hljs-number">1</span>) &quot;c&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">150</span><br><span class="hljs-number">2</span>) <span class="hljs-number">1</span>) &quot;java&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">250</span><br><span class="hljs-number">3</span>) <span class="hljs-number">1</span>) &quot;python&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">300</span><br></code></pre></td></tr></table></figure><p><strong>åˆ é™¤è¯¥é›†åˆä¸‹ï¼ŒæŒ‡å®šå€¼çš„å…ƒç´ </strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">zrem  <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> zrem topc c<br><span class="hljs-number">0</span><br>localhost:db0<span class="hljs-operator">&gt;</span> zrange topn <span class="hljs-number">0</span> <span class="hljs-number">-1</span> withscores<br><span class="hljs-number">1</span>) <span class="hljs-number">1</span>) &quot;c&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">150</span><br><span class="hljs-number">2</span>) <span class="hljs-number">1</span>) &quot;java&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">250</span><br><span class="hljs-number">3</span>) <span class="hljs-number">1</span>) &quot;python&quot;<br><span class="hljs-number">2</span>) <span class="hljs-number">300</span><br></code></pre></td></tr></table></figure><p><strong>ç»Ÿè®¡è¯¥é›†åˆï¼Œåˆ†æ•°åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•°</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">zcount <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>min<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>max<span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> zcount topn <span class="hljs-number">100</span> <span class="hljs-number">500</span><br><span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p><strong>è¿”å›è¯¥å€¼åœ¨é›†åˆä¸­çš„æ’åï¼Œä»0å¼€å§‹</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">zrank <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br><br>localhost:db0<span class="hljs-operator">&gt;</span> zrank topn python<br><span class="hljs-number">2</span><br>localhost:db0<span class="hljs-operator">&gt;</span> zrank topn java<br><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h4 id="5-3-æ•°æ®ç»“æ„"><a href="#5-3-æ•°æ®ç»“æ„" class="headerlink" title="5.3 æ•°æ®ç»“æ„"></a>5.3 æ•°æ®ç»“æ„</h4><p>â€‹SortedSet(zset)æ˜¯Redisæä¾›çš„ä¸€ä¸ªéå¸¸ç‰¹åˆ«çš„æ•°æ®ç»“æ„,ä¸€æ–¹é¢å®ƒç­‰ä»·äºJavaçš„æ•°æ®ç»“æ„Map&lt;String, Double&gt;ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªå…ƒç´ valueèµ‹äºˆä¸€ä¸ªæƒé‡scoreï¼Œå¦ä¸€æ–¹é¢å®ƒåˆç±»ä¼¼äºTreeSetï¼Œå†…éƒ¨çš„å…ƒç´ ä¼šæŒ‰ç…§æƒé‡scoreè¿›è¡Œæ’åºï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå…ƒç´ çš„åæ¬¡ï¼Œè¿˜å¯ä»¥é€šè¿‡scoreçš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚</p><p>setåº•å±‚ä½¿ç”¨äº†ä¸¤ä¸ªæ•°æ®ç»“æ„<br>ï¼ˆ1ï¼‰<strong>hash</strong>ï¼Œhashçš„ä½œç”¨å°±æ˜¯å…³è”å…ƒç´ valueå’Œæƒé‡scoreï¼Œä¿éšœå…ƒç´ valueçš„å”¯ä¸€æ€§ï¼Œå¯ä»¥é€šè¿‡å…ƒç´ valueæ‰¾åˆ°ç›¸åº”çš„scoreå€¼ã€‚<br>ï¼ˆ2ï¼‰<strong>è·³è·ƒè¡¨</strong>ï¼Œè·³è·ƒè¡¨çš„ç›®çš„åœ¨äºç»™å…ƒç´ valueæ’åºï¼Œæ ¹æ®scoreçš„èŒƒå›´è·å–å…ƒç´ åˆ—è¡¨</p><h5 id="è·³è·ƒè¡¨ï¼ˆè·³è¡¨ï¼‰"><a href="#è·³è·ƒè¡¨ï¼ˆè·³è¡¨ï¼‰" class="headerlink" title="è·³è·ƒè¡¨ï¼ˆè·³è¡¨ï¼‰"></a><strong>è·³è·ƒè¡¨ï¼ˆè·³è¡¨ï¼‰</strong></h5><p>1 ç®€ä»‹</p><pre><code class="hljs">      æœ‰åºé›†åˆåœ¨ç”Ÿæ´»ä¸­æ¯”è¾ƒå¸¸è§ï¼Œä¾‹å¦‚æ ¹æ®æˆç»©å¯¹å­¦ç”Ÿæ’åï¼Œæ ¹æ®å¾—åˆ†å¯¹ç©å®¶æ’åç­‰ã€‚å¯¹äºæœ‰åºé›†åˆçš„åº•å±‚å®ç°ï¼Œå¯ä»¥ç”¨æ•°ç»„ã€å¹³è¡¡æ ‘ã€é“¾è¡¨ç­‰ã€‚æ•°ç»„ä¸ä¾¿å…ƒç´ çš„æ’å…¥ã€åˆ é™¤ï¼›å¹³è¡¡æ ‘æˆ–çº¢é»‘æ ‘è™½ç„¶æ•ˆç‡é«˜ä½†ç»“æ„å¤æ‚ï¼›é“¾è¡¨æŸ¥è¯¢éœ€è¦éå†æ‰€æœ‰æ•ˆç‡ä½ã€‚Redisé‡‡ç”¨çš„æ˜¯è·³è·ƒè¡¨ã€‚è·³è·ƒè¡¨æ•ˆç‡å ªæ¯”çº¢é»‘æ ‘ï¼Œå®ç°è¿œæ¯”çº¢é»‘æ ‘ç®€å•ã€‚</code></pre><p>2ã€å®ä¾‹<br>         å¯¹æ¯”æœ‰åºé“¾è¡¨å’Œè·³è·ƒè¡¨ï¼Œä»é“¾è¡¨ä¸­æŸ¥è¯¢å‡º51<br>        ï¼ˆ1ï¼‰æœ‰åºé“¾è¡¨<br>      è¦æŸ¥æ‰¾å€¼ä¸º51çš„å…ƒç´ ï¼Œéœ€è¦ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ä¾æ¬¡æŸ¥æ‰¾ã€æ¯”è¾ƒæ‰èƒ½æ‰¾åˆ°ã€‚å…±éœ€è¦6æ¬¡æ¯”è¾ƒã€‚</p><p>â€‹<img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240516110419403.png?raw=true" alt="image-20240516110419403"></p><p>â€‹ï¼ˆ2ï¼‰è·³è·ƒè¡¨</p><p>â€‹   <img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240516110521024.png?raw=true" alt="image-20240516110521024">  </p><p>â€‹</p><p>ä»ç¬¬2å±‚å¼€å§‹ï¼Œ1èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œå‘åæ¯”è¾ƒã€‚<br>21èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åæ¯”è¾ƒï¼Œåé¢å°±æ˜¯NULLäº†ï¼Œæ‰€ä»¥ä»21èŠ‚ç‚¹å‘ä¸‹åˆ°ç¬¬1å±‚<br>åœ¨ç¬¬1å±‚ï¼Œ41èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åï¼Œ61èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å¤§ï¼Œæ‰€ä»¥ä»41å‘ä¸‹<br>åœ¨ç¬¬0å±‚ï¼Œ51èŠ‚ç‚¹ä¸ºè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹è¢«æ‰¾åˆ°ï¼Œå…±æŸ¥æ‰¾4æ¬¡ã€‚</p><p>è·³è·ƒè¡¨æ¯”æœ‰åºé“¾è¡¨æ•ˆç‡è¦é«˜</p><h2 id="reids-æ“ä½œå‘½ä»¤"><a href="#reids-æ“ä½œå‘½ä»¤" class="headerlink" title="reids æ“ä½œå‘½ä»¤"></a>reids æ“ä½œå‘½ä»¤</h2><blockquote><p>redis é»˜è®¤ä¸º 16 ä¸ªåº“ (åœ¨ redis.conf æ–‡ä»¶å¯é…ç½®ï¼Œè¯¥æ–‡ä»¶å¾ˆé‡è¦ï¼Œåç»­å¾ˆå¤šæ“ä½œéƒ½æ˜¯è¿™ä¸ªé…ç½®æ–‡ä»¶) redis é»˜è®¤è‡ªåŠ¨ä½¿ç”¨ 0 å·åº“</p></blockquote><p><strong>æ²Ÿé€šå‘½ä»¤ï¼ŒæŸ¥çœ‹çŠ¶æ€</strong></p><p>è¿æ¥åˆ°å®¢æˆ·ç«¯ä¹‹åï¼Œè¾“å…¥pingï¼Œredisè¿”å›pongã€‚è¡¨ç¤ºredisèƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">localhost:db0<span class="hljs-operator">&gt;</span> ping<br>PONG<br></code></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­keyçš„æ•°é‡ï¼šdbsize</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">localhost:db0<span class="hljs-operator">&gt;</span> dbsize<br><span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><p><strong>åˆ‡æ¢åº“å‘½ä»¤ï¼šselect db</strong></p><p>åº“çš„ä¸‹æ ‡ä»0å¼€å§‹ï¼Œredis.confé…ç½®ä¸­é»˜è®¤16ä¸ªåº“ã€‚ä¸‹æ ‡0-15</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">localhost:db0<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-number">5</span><br>OK<br>localhost:db5<span class="hljs-operator">&gt;</span> dbsize<br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><strong>åˆ é™¤å½“å‰æ•°æ®åº“çš„æ‰€æœ‰æ•°æ®ï¼šflushdb</strong></p><p><strong>é€€å‡ºå®¢æˆ·ç«¯è¿æ¥ï¼šexitæˆ–è€…quit</strong></p>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>typora å›¾åºŠ</title>
    <link href="/2024/05/27/tools/github%20%E5%9B%BE%E5%BA%8A/"/>
    <url>/2024/05/27/tools/github%20%E5%9B%BE%E5%BA%8A/</url>
    
    <content type="html"><![CDATA[<h1 id="typora-å›¾åºŠ"><a href="#typora-å›¾åºŠ" class="headerlink" title="typora å›¾åºŠ"></a>typora å›¾åºŠ</h1><h2 id="1ã€é…ç½®Github"><a href="#1ã€é…ç½®Github" class="headerlink" title="1ã€é…ç½®Github"></a>1ã€é…ç½®Github</h2><p>è¿›å…¥githubå¹³å° <a href="https://github.com/">github</a></p><p>ç™»å½•è´¦å· åˆ›å»ºä»“åº“</p><p>é…ç½®ä»“åº“å å‹¾é€‰ Add a README file ç‚¹å‡»create</p><p>ç‚¹å‡»å¤´åƒ åˆ›å»ºtoken ç•Œé¢åˆ’åˆ°æœ€ä¸‹é¢ ç‚¹å‡»&lt;&gt;Developer settings è®¾ç½®tokenæ°¸ä¸è¿‡æœŸ</p><p>åˆ›å»ºå®Œä¿å­˜å¥½ ä»…å¯è§ä¸€æ¬¡</p><h2 id="2ã€é…ç½®PicGo"><a href="#2ã€é…ç½®PicGo" class="headerlink" title="2ã€é…ç½®PicGo"></a>2ã€<strong>é…ç½®PicGo</strong></h2><p>å®˜ç½‘ç½‘ç«™ä¸‹è½½ <a href="https://picgo.github.io/PicGo-Doc/zh/guide/#%E7%89%B9%E8%89%B2%E5%8A%9F%E8%83%BD">PicGo</a></p><p>å®‰è£…å®Œæˆä¹‹åé…ç½®Githubå›¾åºŠé…ç½®</p><p>è®¾å®šä»“åº“åï¼šGithubç”¨æˆ·å&#x2F;ä»“åº“å</p><p>è®¾å®šåˆ†æ”¯åï¼šmain </p><p>è®¾å®šToken: å‰é¢ä¿å­˜çš„tokenä¿¡æ¯</p><p>è®¾å®šå­˜å‚¨è·¯å¾„ï¼šimg&#x2F;</p><p>è®¾å®šè‡ªå®šä¹‰åŸŸåï¼šä½¿ç”¨cdnåŠ é€ŸåŸŸå   </p><p><a href="https://cdn.staticaly.com/gh/gondmhd/blogImage@main">https://cdn.staticaly.com/gh/gondmhd/blogImage@main</a></p><h2 id="3ã€é…ç½®typora"><a href="#3ã€é…ç½®typora" class="headerlink" title="3ã€é…ç½®typora"></a>3ã€é…ç½®typora</h2><p>æ–‡ä»¶-åå¥½è®¾ç½®-å›¾åƒè®¾ç½®å›¾åºŠé…ç½® </p><p>å¤–è§‚ è‡ªå®šä¹‰å­—æ®µå¤§å°</p><h3 id="3-1-typoraé¢œè‰²æ ·å¼"><a href="#3-1-typoraé¢œè‰²æ ·å¼" class="headerlink" title="3.1 typoraé¢œè‰²æ ·å¼"></a>3.1 typoraé¢œè‰²æ ·å¼</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;cornflowerblue&quot;</span>&gt;</span>è“è‰²<span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;orange&quot;</span>&gt;</span>æ©˜è‰²<span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;red&quot;</span>&gt;</span>çº¢è‰²<span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span><br></code></pre></td></tr></table></figure><p>&#x3D;&#x3D;<font color="cornflowerblue">è“è‰²</font>&#x3D;&#x3D;<br>&#x3D;&#x3D;<font color="orange">æ©˜è‰²</font>&#x3D;&#x3D;<br>&#x3D;&#x3D;<font color="red">çº¢è‰²</font>&#x3D;&#x3D;</p><h3 id="3-2-ä»£ç å—Macé£æ ¼ä¸‰ä¸ªåœ†ç‚¹"><a href="#3-2-ä»£ç å—Macé£æ ¼ä¸‰ä¸ªåœ†ç‚¹" class="headerlink" title="3.2 ä»£ç å—Macé£æ ¼ä¸‰ä¸ªåœ†ç‚¹"></a>3.2 ä»£ç å—Macé£æ ¼ä¸‰ä¸ªåœ†ç‚¹</h3><p><strong>åå¥½è®¾ç½®-å¤–è§‚-æ‰“å¼€ä¸»é¢˜-æ‰¾åˆ°åœ¨ä½¿ç”¨ä¸»é¢˜css-ä¿®æ”¹ä»£ç å—æ ·å¼</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/* ä»£ç å—ä¸»é¢˜ */</span><br><span class="hljs-comment">/* é¡¶éƒ¨ */</span><br><span class="hljs-selector-class">.md-fences</span> &#123;<br>    <span class="hljs-attribute">color</span>: <span class="hljs-number">#c5c8c6</span>;<br>    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#21252b</span>;<br>    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;<br>    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">30px</span> <span class="hljs-number">0</span> <span class="hljs-built_in">rgb</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> / <span class="hljs-number">40%</span>);<br>    <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">30px</span>;<br>    <span class="hljs-attribute">font-family</span>: monospace, <span class="hljs-string">&#x27;PingFang SC&#x27;</span>, <span class="hljs-string">&#x27;Microsoft YaHei&#x27;</span>;<br>&#125;<br><br><span class="hljs-selector-class">.md-fences</span><span class="hljs-selector-pseudo">::before</span> &#123;<br>    <span class="hljs-attribute">background</span>: <span class="hljs-number">#fc625d</span>;<br>    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;<br>    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span> <span class="hljs-number">#fdbc40</span>, <span class="hljs-number">40px</span> <span class="hljs-number">0</span> <span class="hljs-number">#35cd4b</span>;<br>    <span class="hljs-attribute">content</span>: <span class="hljs-string">&#x27; &#x27;</span>;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">12px</span>;<br>    <span class="hljs-attribute">left</span>: <span class="hljs-number">12px</span>;<br>    <span class="hljs-attribute">margin-top</span>: -<span class="hljs-number">20px</span>;<br>    <span class="hljs-attribute">position</span>: absolute;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">12px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é—­æ‰€æœ‰typoraçª—å£ é‡æ–°æ‰“å¼€ å³å¯è·å–å°åœ†ç‚¹</p><h2 id="4ã€é…ç½®Pandoc"><a href="#4ã€é…ç½®Pandoc" class="headerlink" title="4ã€é…ç½®Pandoc"></a>4ã€é…ç½®Pandoc</h2><p><a href="https://github.com/jgm/pandoc/releases/tag/3.1.6.1">Pandocä¸‹è½½åœ°å€</a></p><p>å°†è§£å‹å®‰è£…è·¯å¾„é…ç½®windowç¯å¢ƒå˜é‡path</p><p>pandoc â€“version# æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ</p><p>é‡å¯Typora</p><h2 id="5ã€ubuntuæƒ…å†µä¸‹-picgo-å­˜åœ¨é—®é¢˜"><a href="#5ã€ubuntuæƒ…å†µä¸‹-picgo-å­˜åœ¨é—®é¢˜" class="headerlink" title="5ã€ubuntuæƒ…å†µä¸‹ picgo å­˜åœ¨é—®é¢˜"></a>5ã€ubuntuæƒ…å†µä¸‹ picgo å­˜åœ¨é—®é¢˜</h2><blockquote><p>æ‰‹åŠ¨æ–¹æ¡ˆ</p></blockquote><p><strong>5.1 git clone å›¾ç‰‡ä»“åº“</strong></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">clone</span> <span class="hljs-title">git</span>@github.com:gondmhd/XXXX.git<br></code></pre></td></tr></table></figure><p><strong>5.2 typoraä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°ä»“åº“è·¯å¾„ä¸‹</strong></p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240508164956733.png?raw=true" alt="image-20240508164956733"></p><p><strong>5.3 ä½¿ç”¨typoraæ­£å¸¸ç¼–è¾‘ä¿å­˜å›¾ç‰‡</strong></p><p><strong>5.4 git push å›¾ç‰‡åˆ°ä»“åº“ å¤åˆ¶å›¾ç‰‡é“¾æ¥åˆ°mdæ–‡æ¡£</strong></p><p><img src="https://github.com/gondmhd/blogImage/blob/main/img/image-20240508165232708.png?raw=true" alt="image-20240508165232708"></p><p><strong>5.5 å°†å›¾ç‰‡è·¯å¾„ä¿®æ”¹</strong></p><p>ä¿®æ”¹æˆå¤åˆ¶çš„ç½‘ç»œåœ°å€(ä¹Ÿå¯ä¿®æ”¹è·¯å¾„æ‹¼æ¥åé¢ ?raw&#x3D;true)</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">https://github.com/gondmhd/blogImage/blob/main/img/image-20240508165232708.png?raw=true<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerfileæ„å»ºæŠ€å·§</title>
    <link href="/2024/05/27/docker/Dockfile%E6%9E%84%E5%BB%BA%E6%8A%80%E5%B7%A7/"/>
    <url>/2024/05/27/docker/Dockfile%E6%9E%84%E5%BB%BA%E6%8A%80%E5%B7%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="Dockerfileæ„å»ºæŠ€å·§"><a href="#Dockerfileæ„å»ºæŠ€å·§" class="headerlink" title="Dockerfileæ„å»ºæŠ€å·§"></a>Dockerfileæ„å»ºæŠ€å·§</h1><h2 id="1ã€ä¸ä½¿ç”¨å¤šé˜¶æ®µæ„å»º"><a href="#1ã€ä¸ä½¿ç”¨å¤šé˜¶æ®µæ„å»º" class="headerlink" title="1ã€ä¸ä½¿ç”¨å¤šé˜¶æ®µæ„å»º"></a>1ã€ä¸ä½¿ç”¨å¤šé˜¶æ®µæ„å»º</h2><p>æˆ‘ä»¬çŸ¥é“åœ¨Dockerfile ä¸­æ²¡æ–°å¢ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šåœ¨é•œåƒä¸­ç”Ÿäº§æ–°çš„å±‚ï¼Œä¸€ä¸ªé«˜æ ¡çš„Dockerfileåº”è¯¥åœ¨ç»§ç»­ä¸‹ä¸€å±‚ä¹‹å‰æ¸…æ¥šä¹‹å‰æ‰€æœ‰ä¸éœ€è¦çš„èµ„æº </p><p>ä¸ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºæ—¶ï¼Œ<strong>æˆ‘ä»¬é€šå¸¸ä¼šåˆ›å»ºä¸¤ä¸ªdockerfileæ–‡ä»¶ï¼Œä¸€ä¸ªç”¨äºå¼€å‘åŠç¼–ç¨‹åº”ç”¨ï¼Œå¦ä¸€ä¸ªç”¨äºæ„å»ºç²¾ç®€çš„ç”Ÿæˆé•œåƒï¼Œ</strong>è¿™æ ·èƒ½æ¯”è¾ƒå¤§é™åº¦çš„å‡å°é•œåƒçš„å¤§å°ã€‚</p><p>æˆ‘ä»¬ä»¥ä¸€ä¸ªgoåº”ç”¨æ¥çœ‹çœ‹ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªdockerfile,æ„å»ºè¿™ä¸ªé•œåƒçš„ä¸»è¦ç›®çš„å°±æ˜¯ç¼–è¯‘æˆ‘ä»¬çš„åº”ç”¨ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> golang:<span class="hljs-number">1.16</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /go/src</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> app.go ./</span><br><span class="hljs-comment">#goç¼–è¯‘</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> go build  -o myapp app.go</span><br></code></pre></td></tr></table></figure><p><strong>æ„å»ºé•œåƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@localhost dockerfiles]<span class="hljs-comment"># docker build -t builder_app:v1 .</span><br>Sending build context to Docker daemon  3.072kB<br>Step 1/4 : FROM golang:1.16<br> ---&gt; 019c7b2e3cb8<br>Step 2/4 : WORKDIR /go/src<br> ---&gt; Using cache<br> ---&gt; 15362720e897<br>Step 3/4 : COPY app.go ./<br> ---&gt; Using cache<br> ---&gt; 8f14ac97a68a<br>Step 4/4 : RUN go build  -o myapp app.go<br> ---&gt; Running <span class="hljs-keyword">in</span> 4368cc4617a7<br>Removing intermediate container 4368cc4617a7<br> ---&gt; 631f67587803<br>Successfully built 631f67587803<br>Successfully tagged builder_app:v1<br></code></pre></td></tr></table></figure><p>è¿™æ ·åœ¨è¿™ä¸ªé•œåƒä¸­å°±åŒ…å«äº†æˆ‘ä»¬ç¼–è¯‘åçš„åº”ç”¨myappï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºå®¹å™¨å°†myappæ‹·è´åˆ°å®¿ä¸»æœºç­‰å¾…åç»­ä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># docker create --name builder builder_app:v1# åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œä½†å¹¶ä¸å¯åŠ¨å®ƒ --name builder  builder_app:v1ï¼šè¿™æ˜¯æŒ‡å®šè¦åˆ›å»ºçš„å®¹å™¨æ‰€ä½¿ç”¨çš„é•œåƒåç§°å’Œæ ‡ç­¾</span><br>fafc1cf7ffa42e06d19430b807d24eafe0bf731fc45ff0ecf31ada5a6075f1d5<br><span class="hljs-comment"># docker cp builder:/go/src/myapp ./ # ä»ä¸€ä¸ªå®¹å™¨ä¸­å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•åˆ°æœ¬åœ°ä¸»æœºã€‚</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æœ‰äº†åº”ç”¨ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ„å»ºç”Ÿäº§é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">FROM scratch<br>WORKDIR /server<br>COPY myapp ./<br>CMD [<span class="hljs-string">&quot;./myapp&quot;</span>]<br></code></pre></td></tr></table></figure><p>ç”±äºæ­¤æ—¶æˆ‘ä»¬ä¸éœ€è¦å…¶ä»–ä¾èµ–ç¯å¢ƒï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨scratchè¿™ä¸ªç©ºé•œåƒï¼Œä¸ä»…å¯ä»¥å‡å°å®¹å™¨å°ºå¯¸ï¼Œè¿˜å¯ä»¥æé«˜å®‰å…¨æ€§ã€‚</p><p>æ„å»ºé•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># docker build  --no-cache -t server_app:v1 .   #  --no-cache æŒ‡ç¤ºDockeråœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¸ä½¿ç”¨ä»»ä½•ç¼“å­˜ã€‚é€šå¸¸ï¼ŒDockerä¼šç¼“å­˜ä¹‹å‰æ­¥éª¤çš„ç»“æœæ¥åŠ é€Ÿè¿ç»­æ„å»ºè¿‡ç¨‹ï¼Œä½†æ˜¯ä½¿ç”¨è¿™ä¸ªæ ‡å¿—ä¼šå¼ºåˆ¶Dockerå¿½ç•¥æ‰€æœ‰ç¼“å­˜ï¼Œä»å¤´å¼€å§‹æ„å»ºæ¯ä¸ªå±‚ã€‚</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€æ¬¡æ„å»ºçš„ä¸¤ä¸ªé•œåƒå¤§å°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># docker images </span><br>REPOSITORY            TAG       IMAGE ID       CREATED          SIZE<br>server_app            v1        6ebc0833cad0   6 minutes ago    1.94MB<br>builder_app           v1        801f0b615004   23 minutes ago   921MB<br></code></pre></td></tr></table></figure><p><strong>æ˜¾ç„¶åœ¨ä¸ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ„å»ºå‡ºç”Ÿäº§é•œåƒï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸¤ä¸ªdockerfileï¼Œéœ€è¦å°†appé—ç•™åˆ°æœ¬åœ°ï¼Œå¹¶ä¸”å¸¦æ¥äº†æ›´å¤šå­˜å‚¨ç©ºé—´å¼€é”€ã€‚åœ¨ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºæ—¶èƒ½æ¯”è¾ƒå¥½çš„è§£å†³ä»¥ä¸Šé—®é¢˜ã€‚</strong></p><h2 id="2ã€ä½¿ç”¨å¤šé˜¶æ®µæ„å»º"><a href="#2ã€ä½¿ç”¨å¤šé˜¶æ®µæ„å»º" class="headerlink" title="2ã€ä½¿ç”¨å¤šé˜¶æ®µæ„å»º"></a>2ã€ä½¿ç”¨å¤šé˜¶æ®µæ„å»º</h2><p>åœ¨ä¸€ä¸ªDockfile ä¸­ä½¿ç”¨å¤šä¸ªFROM æŒ‡ä»¤ï¼Œæ¯ä¸ªFROM éƒ½å¯ä»¥ä½¿ç”¨ä¸åŒçš„åŸºé•œåƒï¼Œå¹¶ä¸”æ¯æ¡æŒ‡ä»¤éƒ½å°†å¼€å§‹æ–°é˜¶æ®µæ„å»ºã€‚åœ¨å¤šé˜¶æ®µæ„å»ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†èµ„æºä»ä¸€ä¸ªé˜¶æ®µå¤åˆ¶åˆ°å¦ä¸€ä¸ªé˜¶æ®µï¼Œåœ¨æœ€ç»ˆé•œåƒä¸­åªä¿ç•™æˆ‘ä»¬æ‰€éœ€è¦çš„å†…å®¹ã€‚</p><p>æˆ‘ä»¬å°†ä¸Šé¢å®ä¾‹çš„ä¸¤ä¸ªDockfileåˆå¹¶å¦‚ä¸‹ä¸ºï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment">#é˜¶æ®µ1</span><br><span class="hljs-keyword">FROM</span> golang:<span class="hljs-number">1.16</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /go/src</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> app.go ./</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> go build app.go -o myapp</span><br><span class="hljs-comment">#é˜¶æ®µ2</span><br><span class="hljs-keyword">FROM</span> scratch<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /server</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=0 /go/src/myapp ./</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;./myapp&quot;</span>]</span><br></code></pre></td></tr></table></figure><p><strong>æ„å»ºé•œåƒ</strong></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># docker build --no-cache  -t server_app:v2 .</span><br></code></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹æ„å»ºå¥½çš„é•œåƒ</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># docker images</span><br><span class="hljs-attribute">REPOSITORY</span>            TAG       IMAGE ID       CREATED              SIZE<br><span class="hljs-attribute">server_app</span>            v2        <span class="hljs-number">20225</span>cb1ea6b   <span class="hljs-number">12</span> seconds ago       <span class="hljs-number">1</span>.<span class="hljs-number">94</span>MB<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬æ— éœ€åˆ›å»ºé¢å¤–é•œåƒï¼Œä»¥æ›´ç®€å•çš„æ–¹å¼æ„å»ºå‡ºäº†åŒæ ·å¾®å°çš„ç›®æ ‡é•œåƒã€‚å¯ä»¥çœ‹åˆ°åœ¨å¤šé˜¶æ®µæ„å»ºdockerfileä¸­æœ€å…³é”®çš„æ˜¯<code>COPY --from=0 /go/src/myapp ./</code> é€šè¿‡<code>--from=0</code>æŒ‡å®šæˆ‘ä»¬èµ„æºæ¥æºï¼Œè¿™é‡Œçš„0å³æ˜¯æŒ‡ç¬¬ä¸€é˜¶æ®µã€‚</p><p><strong>å‘½ä»¤æ„å»ºé˜¶æ®µ</strong></p><p>é»˜è®¤æƒ…å†µä¸‹æ„å»ºé˜¶æ®µæ²¡æœ‰åç§°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ•´æ•°0~Næ¥å¼•ç”¨ï¼Œå³ç¬¬ä¸€ä¸ªfromä»0å¼€å§‹ã€‚å…¶å®æˆ‘ä»¬è¿˜å¯ä»¥åœ¨<code>FROM</code>æŒ‡ä»¤ä¸­æ·»åŠ <code>AS &lt;NAME&gt;</code> æ¥å‘½åæ„å»ºé˜¶æ®µï¼Œæ¥ç€åœ¨COPYæŒ‡ä»¤ä¸­é€šè¿‡<code>&lt;NAME&gt;</code>å¼•ç”¨ã€‚æˆ‘ä»¬å¯¹ä¸Šé¢dockerfileä¿®æ”¹å¦‚ä¸‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment">#é˜¶æ®µ1å‘½åä¸ºbuilder</span><br><span class="hljs-keyword">FROM</span> golang:<span class="hljs-number">1.16</span> as builder<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /go/src</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> app.go ./</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> go build app.go -o myapp</span><br><span class="hljs-comment">#é˜¶æ®µ2</span><br><span class="hljs-keyword">FROM</span> scratch<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /server</span><br><span class="hljs-comment">#é€šè¿‡åç§°å¼•ç”¨</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=builder /go/src/myapp ./</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;./myapp&quot;</span>]</span><br></code></pre></td></tr></table></figure><p><strong>åªæ„å»ºæŸä¸ªæ¥è¹²</strong></p><p>æ„å»ºé•œåƒæ—¶ï¼Œä¸ä¸€å®šéœ€è¦æ„å»ºæ•´ä¸ª Dockerfileï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>--target</code>å‚æ•°æŒ‡å®šæŸä¸ªç›®æ ‡é˜¶æ®µæ„å»ºï¼Œæ¯”å¦‚æˆ‘ä»¬å¼€å‘é˜¶æ®µæˆ‘ä»¬åªæ„å»ºbuilderé˜¶æ®µè¿›è¡Œæµ‹è¯•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#docker build --target builder -t builder_app:v2 .</span><br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨å¤–éƒ¨é•œåƒ</strong></p><p>ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºæ—¶ï¼Œæˆ‘ä»¬å±€é™äºä»ä¹‹å‰åœ¨ Dockerfile ä¸­åˆ›å»ºçš„é˜¶æ®µè¿›è¡Œå¤åˆ¶ã€‚è¿˜å¯ä»¥ä½¿ç”¨<code>COPY --from</code>æŒ‡ä»¤ä»å•ç‹¬çš„é•œåƒå¤åˆ¶ï¼Œå¦‚æœ¬åœ°é•œåƒåç§°ã€æœ¬åœ°æˆ– Dockerhubä¸Šå¯ç”¨çš„æ ‡ç­¾æˆ–æ ‡ç­¾ IDã€‚Docker å®¢æˆ·ç«¯åœ¨å¿…è¦æ—¶ä¼šæ‹‰å–éœ€è¦çš„é•œåƒåˆ°æœ¬åœ°ã€‚</p><p><strong>ä»ä¸Šä¸€é˜¶æ®µåˆ›å»ºæ–°çš„é˜¶æ®µ</strong></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡FROMæŒ‡ä»¤æ¥å¼•ç”¨ä¸Šä¸€é˜¶æ®µä½œä¸ºæ–°é˜¶æ®µçš„å¼€å§‹</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment">#é˜¶æ®µ1å‘½åä¸ºbuilder</span><br><span class="hljs-keyword">FROM</span> golang:<span class="hljs-number">1.16</span> as builder<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /go/src</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> app.go ./</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> go build app.go -o myapp</span><br><span class="hljs-comment">#é˜¶æ®µ2</span><br><span class="hljs-keyword">FROM</span> builder as builder_ex<br><span class="hljs-keyword">ADD</span><span class="language-bash"> dest.tar ./</span><br>...<br><br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æœ¬åœ°ç¯å¢ƒæ„å»ºé•œåƒ</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment">#é˜¶æ®µ1</span><br><span class="hljs-keyword">FROM</span> golang:<span class="hljs-number">1.16</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /go/src</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> app.go ./</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> go build app.go -o myapp</span><br><span class="hljs-comment">#é˜¶æ®µ2</span><br><span class="hljs-keyword">FROM</span> scratch<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /server</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=0 /go/src/myapp ./</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;./myapp&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æœ¬åœ°è„šæœ¬æ§åˆ¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment"># æ ¹æ®æ˜¯å¦æœ‰é˜¶æ®µå‚æ•°æ‰§è¡Œæ„å»º</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$#</span>&quot;</span> -gt 0 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-comment"># å¦‚æœæœ‰å‚æ•°ï¼Œåˆ™æ‰§è¡Œå¸¦æœ‰ --cache-from çš„æ„å»ºï¼Œå‡å®šå‚æ•°æ˜¯æœŸæœ›çš„æ„å»ºé˜¶æ®µåï¼ˆè¿™é‡Œå‡è®¾ä¸º builderï¼‰</span><br>    docker build --cache-from=builder_app:v3 --target final -t work:dev .<br><span class="hljs-keyword">else</span><br>    <span class="hljs-comment"># æ²¡æœ‰å‚æ•°ï¼Œæ‰§è¡Œå®Œæ•´çš„æ„å»ºæµç¨‹</span><br>    <span class="hljs-comment"># å…ˆæ„å»º builder é˜¶æ®µ</span><br>    docker build --target builder -t builder_app:v3 .<br>    <span class="hljs-comment"># ä½¿ç”¨ builder é•œåƒä½œä¸ºç¼“å­˜æ¥æºï¼Œæ„å»ºæœ€ç»ˆé•œåƒ</span><br>    docker build --cache-from=builder_app:v3 --target final -t work:dev .<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
